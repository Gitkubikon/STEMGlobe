const __vite__fileDeps=["assets/IdentityManager-W7gdkvxR.js","assets/substitute-BKlXSAeq.js","assets/statsWorker-CPOxChLJ.js","assets/utils-B32FhCah.js","assets/heatmapUtils-CLpt7VGl.js","assets/utils-Ban-Uh74.js","assets/utils-DP7yP6Sb.js","assets/ClassBreaksDefinition-BGj8t6zS.js","assets/geometryEngineWorker-BXfxVZay.js","assets/geometryEngineJSON-B-7dXK-n.js","assets/geometryEngineBase-CMwAYyhg.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-BRofyGua.js","assets/date-M6n_RqpC.js","assets/FeatureStore-CiTGOpJU.js","assets/BoundsStore-NtCwdQc4.js","assets/PooledRBush-DcY4tWH0.js","assets/quickselect-DybCkMWO.js","assets/QueryEngine-DMYW9h14.js","assets/WhereClause-By2MRARG.js","assets/TimeOnly-CP1ZqeV6.js","assets/UnknownTimeZone-RX3smWvm.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/FieldsIndex-DgebUazG.js","assets/optimizedFeatureQueryEngineAdapter-CG9gLyo7.js","assets/number-NHI268dm.js","assets/clientSideDefaults-BTrID3LU.js","assets/ElevationSamplerWorker-Dz4Vfn95.js","assets/FeatureServiceSnappingSourceWorker-CWfFh4M0.js","assets/symbologySnappingCandidates-Cagm_874.js","assets/pbfQueryUtils-Dy-XNmPP.js","assets/pbf-LYnuVcsp.js","assets/query-CDf56oOj.js","assets/queryZScale-e0tKE7Wf.js","assets/GeoJSONSourceWorker-DFR_sHdS.js","assets/geojson-j8tMdiLo.js","assets/sourceUtils-BOXam1Vk.js","assets/MemorySourceWorker-TafZEJOL.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-CXYhGJcp.js","assets/FeaturePipelineWorker-BMnR2JUs.js","assets/diffUtils-NPeBUV7Z.js","assets/TurboLine-CUJHjv73.js","assets/constants-D5zmR9t2.js","assets/Rect-BAnET0xx.js","assets/geohashUtils--RQztSGg.js","assets/ogcFeatureUtils-45HG8pjb.js","assets/StreamFeatureManager-CypRRnIe.js","assets/createConnection-DAH8xATq.js","assets/PointCloudWorker-CxU5DyX1.js","assets/PointCloudWorkerUtil-DYIlQbGx.js","assets/PointCloudUniqueValueRenderer-7KXwMf3M.js","assets/ColorStop-BufQc-Q1.js","assets/I3SBinaryReader-D_-yauvZ.js","assets/RasterWorker-aWU9e0Ps.js","assets/dataUtils-DYAupDH7.js","assets/utils-YkFVdlTa.js","assets/colorRamps-B37W641P.js","assets/rasterProjectionHelper-DoCKyBaD.js","assets/SceneLayerWorker-BeOC7Wsz.js","assets/I3SNode-J9atpqNC.js","assets/I3SUtil-BXqqT6Gz.js","assets/WFSSourceWorker-D8Iku73T.js","assets/wfsUtils-CAcHwTpE.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-DnkfSR09.js","assets/Lyr3DWorker-CvKkbMnx.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/Lyr3DModule-C8UhcUKU.js","assets/Popup-D3CONZOT.js","assets/unitFormatUtils-BfCFjfSx.js","assets/AttachmentInfo-Dnx6syys.js","assets/AttachmentQuery-C4AgtjDZ.js","assets/jsonUtils-VUi-Ju6c.js","assets/UniqueValueRenderer-CRE99QGz.js","assets/executeQueryJSON-BSwWQm6u.js","assets/FeatureSet-CdFFv-Qc.js","assets/RelationshipQuery-BVmqzwGB.js","assets/TopFeaturesQuery-CBoUdUje.js","assets/FeatureLayer-BOw6Ni-W.js","assets/FormTemplate-DAN2JsSQ.js","assets/editsZScale-Cbd95mT2.js","assets/EditBusLayer-D4dQB0u3.js","assets/FeatureEffectLayer-DpI6bfYW.js","assets/FeatureEffect-CpiPPg_X.js","assets/FeatureFilter-CA8ztIfO.js","assets/FeatureLayerBase-BkGHKvON.js","assets/featureLayerUtils-B1MLk4Ne.js","assets/featureQueryAll-QK3rWwwF.js","assets/LayerFloorInfo-Dhsf61Jd.js","assets/serviceCapabilitiesUtils-CQxtMP8f.js","assets/FeatureReductionLayer-DyF-Ps6m.js","assets/FeatureReductionSelection-CuJNqq74.js","assets/LabelClass-7_Am5iul.js","assets/MD5-C9MwAd2G.js","assets/OrderedLayer-eA6Czb_N.js","assets/TemporalLayer-GhlUcMZT.js","assets/TimeInfo-Bhjs8OY5.js","assets/FeatureTemplate-CDS3L1I6.js","assets/FeatureType-BM52uulu.js","assets/fieldProperties-Cfjhtz3T.js","assets/labelingInfo-BOxmbD_4.js","assets/versionUtils-BVmW4eDt.js","assets/styleUtils-DImJHVou.js","assets/popupUtils-DWuNmfNN.js","assets/interfaces-CL2NbQte.js","assets/ReactiveSet-BfQ5Z-X7.js","assets/layersCreator-B1eOsYjS.js","assets/portalLayers-EQuNU6bx.js","assets/associatedFeatureServiceUtils-BB1Rtfgf.js","assets/lazyLayerLoader-EjRIfgqU.js","assets/arcgisLayers-_7AmdA8i.js","assets/fetchService-sykjPTvt.js","assets/arcadeUtils-CU4A39Om.js","assets/ImmutableArray-BlMso3qf.js","assets/hash-CcEbRgUF.js","assets/TileLayerView3D-DbdFhMXO.js","assets/LayerView3D-BQ1Of7ue.js","assets/TiledLayerView3D-BElfyL-k.js","assets/LayerView-DwEONtsO.js","assets/RefreshableLayerView-CZ-MpkvD.js","assets/MapServiceLayerViewHelper-RfDTzBW2.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/sublayerUtils-CWTIQAEi.js","assets/popupUtils-CR06Flu3.js","assets/drapedUtils-DXQL6UI_.js","assets/ElevationLayerView3D-xGRYqi-l.js","assets/BaseDynamicLayerView3D-DLkES8RG.js","assets/DynamicLayerView3D-BVMppvdl.js","assets/projectExtentUtils-CVOjNWt4.js","assets/ImageMaterial.glsl-BvVQJRsB.js","assets/BuildingSceneLayerView3D-CIZ6olt_.js","assets/BuildingGroupSublayer-CMF4kbd9.js","assets/BuildingComponentSublayer-BtrVzadv.js","assets/capabilities-BVWdKgNx.js","assets/I3SIndexInfo-DrZ-qz_t.js","assets/I3SLayerDefinitions-BW19m3dp.js","assets/I3SMeshView3D-DWfQOvPD.js","assets/LayerElevationProvider-B4f-BQtW.js","assets/RenderTexture-DS_ddPXl.js","assets/I3SOverrides-CcPZ_piC.js","assets/meshFeatureSet-V5rX_Qv4.js","assets/Mesh-5IHevq20.js","assets/External-D_8ZRbD1.js","assets/infoFor3D-DsOdlPuA.js","assets/FeatureLayerView3D-Ba5gV_cV.js","assets/FeatureLayerViewBase3D-BkHTUojB.js","assets/HeatmapDensity.glsl-TYW_A6wm.js","assets/dehydratedFeatureComparison-BR9ZOpHb.js","assets/queryForSymbologySnapping-CpWX_vWh.js","assets/Graphics3DObjectStates-CO--U7V5.js","assets/EventedSet-Cu7cQ3vR.js","assets/SceneModification-C_Ig6DJi.js","assets/persistable-D9xThwYW.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-DXu6rjkl.js","assets/makeScheduleFunction-CggzEh3c.js","assets/I3SQueryFeatureStore-CYBQG10N.js","assets/TemporalSceneLayerView-CzundIdz.js","assets/CSVLayerView3D-CZB9T9qk.js","assets/DimensionLayerView3D-C4cfpr0O.js","assets/GeoJSONLayerView3D-mQvWjwRR.js","assets/GraphicsLayerView3D-CT9SSmEX.js","assets/GraphicsProcessor-DQ6n5n6J.js","assets/GroupLayerView-D2ckovJh.js","assets/ImageryLayerView3D-DbpG1TSz.js","assets/IntegratedMeshLayerView3D-1mP66TmA.js","assets/IntegratedMesh3DTilesLayerView3D-CtsidEsv.js","assets/LineOfSightLayerView3D-BUf-7PIs.js","assets/MapImageLayerView3D-w9wQU-0g.js","assets/ExportImageParameters-kaAARs89.js","assets/MediaLayerView3D-VaATM5l7.js","assets/MediaElementView-BWxGX9SU.js","assets/normalizeUtilsSync-D5dCQYqB.js","assets/OGCFeatureLayerView3D-4mWlfGJl.js","assets/PointCloudLayerView3D-CDSK1T1g.js","assets/PopupSceneLayerView-Xs6yVPZD.js","assets/VoxelLayerView3D-D5Up1YJu.js","assets/RouteLayerView3D-BiOu8IIm.js","assets/Stop-BpPbl35k.js","assets/SceneLayerView3D-Bi7wSRwJ.js","assets/SceneLayerView-DuRWPzvM.js","assets/SceneLayerGraphicsView3D-D6vDASfR.js","assets/StreamLayerView3D-DkfIckxz.js","assets/ImageryTileLayerView3D-CpkoKv9J.js","assets/VectorTileLayerView3D-Djno2sW-.js","assets/vec4f32-CjrfB-0a.js","assets/WFSLayerView3D-DoDiebzU.js","assets/WMSLayerView3D-Dp-LtpLH.js","assets/ExportWMSImageParameters-BrHb-vbF.js","assets/WMTSLayerView3D-Eiv5hUmn.js","assets/AreaMeasurementAnalysisView3D-DWtF8FN8.js","assets/UnitNormalizer-DPLYLuBo.js","assets/Segment-DuFbs9fA.js","assets/LineVisualElement-89CQy93w.js","assets/geometryEngine-nerZSbro.js","assets/hydrated-BP9lQ5ek.js","assets/EditGeometryOperations-DDGwBLYw.js","assets/DimensionAnalysisView3D-BRq8XYQY.js","assets/LengthDimension-DE1idIoo.js","assets/RightAngleQuadVisualElement-BVbNburw.js","assets/ShadedColorMaterial.glsl-MsRkL63W.js","assets/ToolIntersector-2yX4_X-O.js","assets/Laserlines.glsl-D5fPmsKW.js","assets/DirectLineMeasurementAnalysisView3D-D1-IWCkT.js","assets/LineOfSightAnalysisView3D-YR14FJnt.js","assets/LineOfSightAnalysisTarget-BT-mGYih.js","assets/SliceAnalysisView3D-Du4FtzdP.js","assets/TerrainTileTree3DDebugger-D_TNOhTi.js","assets/TileTreeDebugger-CXNhuqrr.js","assets/Lyr3DWasmPerSceneView-BPxog9d7.js","assets/calcite-button-OAaA1yER.js","assets/form-CBIxpf38.js","assets/dom-DUJaLYyf.js","assets/guid-0nyEKVNn.js","assets/interactive-B9yyQfmN.js","assets/label2-C1AihiOQ.js","assets/component-D7GwCcph.js","assets/loadable-CettHGCs.js","assets/t9n-rWjNSbGI.js","assets/observers-DlXN1wSz.js","assets/icon-Lkhq8ah7.js","assets/loader-DxL2QQkK.js","assets/calcite-icon-WalIfmVe.js","assets/FeatureTileTree3DDebugger-CNYtCSV7.js","assets/GraphicsView3D-Dki-6eUM.js","assets/layersLoader-CYBOe_9H.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var YRe=Object.defineProperty;var XRe=(t,e,r)=>e in t?YRe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var B8=(t,e,r)=>XRe(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function Tc(){}const vpe=t=>t;function bpe(t){return t()}function JQ(){return Object.create(null)}function Xw(t){t.forEach(bpe)}function zW(t){return typeof t=="function"}function GO(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ZRe(t){return Object.keys(t).length===0}function JRe(t,...e){if(t==null){for(const i of e)i(void 0);return Tc}const r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function KRe(t,e,r){t.$$.on_destroy.push(JRe(e,r))}function KQ(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}const wpe=typeof window<"u";let QRe=wpe?()=>window.performance.now():()=>Date.now(),BW=wpe?t=>requestAnimationFrame(t):Tc;const HT=new Set;function xpe(t){HT.forEach(e=>{e.c(t)||(HT.delete(e),e.f())}),HT.size!==0&&BW(xpe)}function e$e(t){let e;return HT.size===0&&BW(xpe),{promise:new Promise(r=>{HT.add(e={c:t,f:r})}),abort(){HT.delete(e)}}}function Zr(t,e){t.appendChild(e)}function Tpe(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function t$e(t){const e=As("style");return e.textContent="/* empty */",r$e(Tpe(t),e),e.sheet}function r$e(t,e){return Zr(t.head||t,e),e.sheet}function jO(t,e,r){t.insertBefore(e,r||null)}function Zw(t){t.parentNode&&t.parentNode.removeChild(t)}function As(t){return document.createElement(t)}function Spe(t){return document.createTextNode(t)}function Va(){return Spe(" ")}function i$e(){return Spe("")}function sD(t,e,r,i){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r,i)}function s$e(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function Xs(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function n$e(t){return Array.from(t.childNodes)}function gx(t,e,r,i){r==null?t.style.removeProperty(e):t.style.setProperty(e,r,"")}function o$e(t,e,{bubbles:r=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:i})}const l4=new Map;let c4=0;function a$e(t){let e=5381,r=t.length;for(;r--;)e=(e<<5)-e^t.charCodeAt(r);return e>>>0}function l$e(t,e){const r={stylesheet:t$e(e),rules:{}};return l4.set(t,r),r}function QQ(t,e,r,i,s,n,o,a=0){const l=16.666/i;let c=`{
`;for(let v=0;v<=1;v+=l){const b=e+(r-e)*n(v);c+=v*100+`%{${o(b,1-b)}}
`}const u=c+`100% {${o(r,1-r)}}
}`,h=`__svelte_${a$e(u)}_${a}`,p=Tpe(t),{stylesheet:f,rules:g}=l4.get(p)||l$e(p,t);g[h]||(g[h]=!0,f.insertRule(`@keyframes ${h} ${u}`,f.cssRules.length));const _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${h} ${i}ms linear ${s}ms 1 both`,c4+=1,h}function c$e(t,e){const r=(t.style.animation||"").split(", "),i=r.filter(e?n=>n.indexOf(e)<0:n=>n.indexOf("__svelte")===-1),s=r.length-i.length;s&&(t.style.animation=i.join(", "),c4-=s,c4||u$e())}function u$e(){BW(()=>{c4||(l4.forEach(t=>{const{ownerNode:e}=t.stylesheet;e&&Zw(e)}),l4.clear())})}let RM;function PP(t){RM=t}function Epe(){if(!RM)throw new Error("Function called outside component initialization");return RM}function h$e(t){Epe().$$.on_mount.push(t)}function d$e(t){Epe().$$.on_destroy.push(t)}function p$e(t,e){const r=t.$$.callbacks[e.type];r&&r.slice().forEach(i=>i.call(this,e))}const P2=[],u4=[];let qT=[];const oV=[],f$e=Promise.resolve();let aV=!1;function m$e(){aV||(aV=!0,f$e.then(Cpe))}function OS(t){qT.push(t)}function g$e(t){oV.push(t)}const V8=new Set;let yx=0;function Cpe(){if(yx!==0)return;const t=RM;do{try{for(;yx<P2.length;){const e=P2[yx];yx++,PP(e),y$e(e.$$)}}catch(e){throw P2.length=0,yx=0,e}for(PP(null),P2.length=0,yx=0;u4.length;)u4.pop()();for(let e=0;e<qT.length;e+=1){const r=qT[e];V8.has(r)||(V8.add(r),r())}qT.length=0}while(P2.length);for(;oV.length;)oV.pop()();aV=!1,V8.clear(),PP(t)}function y$e(t){if(t.fragment!==null){t.update(),Xw(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(OS)}}function _$e(t){const e=[],r=[];qT.forEach(i=>t.indexOf(i)===-1?e.push(i):r.push(i)),r.forEach(i=>i()),qT=e}let vC;function v$e(){return vC||(vC=Promise.resolve(),vC.then(()=>{vC=null})),vC}function G8(t,e,r){t.dispatchEvent(o$e(`${e?"intro":"outro"}${r}`))}const nD=new Set;let Ng;function b$e(){Ng={r:0,c:[],p:Ng}}function w$e(){Ng.r||Xw(Ng.c),Ng=Ng.p}function qb(t,e){t&&t.i&&(nD.delete(t),t.i(e))}function MP(t,e,r,i){if(t&&t.o){if(nD.has(t))return;nD.add(t),Ng.c.push(()=>{nD.delete(t),i&&(r&&t.d(1),i())}),t.o(e)}else i&&i()}const x$e={duration:0};function QR(t,e,r,i){let n=e(t,r,{direction:"both"}),o=i?0:1,a=null,l=null,c=null,u;function h(){c&&c$e(t,c)}function p(g,_){const v=g.b-o;return _*=Math.abs(v),{a:o,b:g.b,d:v,duration:_,start:g.start,end:g.start+_,group:g.group}}function f(g){const{delay:_=0,duration:v=300,easing:b=vpe,tick:w=Tc,css:T}=n||x$e,S={start:QRe()+_,b:g};g||(S.group=Ng,Ng.r+=1),"inert"in t&&(g?u!==void 0&&(t.inert=u):(u=t.inert,t.inert=!0)),a||l?l=S:(T&&(h(),c=QQ(t,o,g,v,_,b,T)),g&&w(0,1),a=p(S,v),OS(()=>G8(t,g,"start")),e$e(C=>{if(l&&C>l.start&&(a=p(l,v),l=null,G8(t,a.b,"start"),T&&(h(),c=QQ(t,o,a.b,a.duration,0,b,n.css))),a){if(C>=a.end)w(o=a.b,1-o),G8(t,a.b,"end"),l||(a.b?h():--a.group.r||Xw(a.group.c)),a=null;else if(C>=a.start){const P=C-a.start;o=a.a+a.d*b(P/a.duration),w(o,1-o)}}return!!(a||l)}))}return{run(g){zW(n)?v$e().then(()=>{n=n({direction:g?"in":"out"}),f(g)}):f(g)},end(){h(),a=l=null}}}function T$e(t,e,r){const i=t.$$.props[e];i!==void 0&&(t.$$.bound[i]=r,r(t.$$.ctx[i]))}function j8(t){t&&t.c()}function oD(t,e,r){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,r),OS(()=>{const n=t.$$.on_mount.map(bpe).filter(zW);t.$$.on_destroy?t.$$.on_destroy.push(...n):Xw(n),t.$$.on_mount=[]}),s.forEach(OS)}function aD(t,e){const r=t.$$;r.fragment!==null&&(_$e(r.after_update),Xw(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function S$e(t,e){t.$$.dirty[0]===-1&&(P2.push(t),m$e(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function t6(t,e,r,i,s,n,o=null,a=[-1]){const l=RM;PP(t);const c=t.$$={fragment:null,ctx:[],props:n,update:Tc,not_equal:s,bound:JQ(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:JQ(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=r?r(t,e.props||{},(h,p,...f)=>{const g=f.length?f[0]:p;return c.ctx&&s(c.ctx[h],c.ctx[h]=g)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](g),u&&S$e(t,h)),p}):[],c.update(),u=!0,Xw(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const h=n$e(e.target);c.fragment&&c.fragment.l(h),h.forEach(Zw)}else c.fragment&&c.fragment.c();e.intro&&qb(t.$$.fragment),oD(t,e.target,e.anchor),Cpe()}PP(l)}class r6{constructor(){B8(this,"$$");B8(this,"$$set")}$destroy(){aD(this,1),this.$destroy=Tc}$on(e,r){if(!zW(r))return Tc;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(r),()=>{const s=i.indexOf(r);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!ZRe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const E$e="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(E$e);function C$e(t){let e,r,i,s,n,o,a,l,c,u,h,p,f,g,_,v,b,w,T;return{c(){e=As("div"),r=As("div"),r.textContent="Legend",i=Va(),s=As("div"),n=As("div"),o=Va(),a=As("div"),a.textContent="0% Female STEM Graduates",l=Va(),c=As("div"),u=As("div"),h=Va(),p=As("div"),p.textContent="50% Female STEM Graduates",f=Va(),g=As("div"),_=As("div"),v=Va(),b=As("div"),b.textContent="100% Female STEM Graduates",w=Va(),T=As("div"),T.innerHTML='<div class="hexagon-example svelte-1elw0yl"></div> <div>Estimated Student Count</div>',Xs(r,"class","legend-title svelte-1elw0yl"),Xs(n,"class","color-box svelte-1elw0yl"),gx(n,"background-color",t[0](0)),Xs(s,"class","legend-item svelte-1elw0yl"),Xs(u,"class","color-box svelte-1elw0yl"),gx(u,"background-color",t[0](50)),Xs(c,"class","legend-item svelte-1elw0yl"),Xs(_,"class","color-box svelte-1elw0yl"),gx(_,"background-color",t[0](100)),Xs(g,"class","legend-item svelte-1elw0yl"),Xs(T,"class","hexagon-size svelte-1elw0yl"),Xs(e,"class","legend-container svelte-1elw0yl")},m(S,C){jO(S,e,C),Zr(e,r),Zr(e,i),Zr(e,s),Zr(s,n),Zr(s,o),Zr(s,a),Zr(e,l),Zr(e,c),Zr(c,u),Zr(c,h),Zr(c,p),Zr(e,f),Zr(e,g),Zr(g,_),Zr(g,v),Zr(g,b),Zr(e,w),Zr(e,T)},p(S,[C]){C&1&&gx(n,"background-color",S[0](0)),C&1&&gx(u,"background-color",S[0](50)),C&1&&gx(_,"background-color",S[0](100))},i:Tc,o:Tc,d(S){S&&Zw(e)}}}function A$e(t,e,r){let{colorScale:i}=e;return t.$$set=s=>{"colorScale"in s&&r(0,i=s.colorScale)},[i]}class P$e extends r6{constructor(e){super(),t6(this,e,A$e,C$e,GO,{colorScale:0})}}const M$e="modulepreload",O$e=function(t){return"https://gitkubikon.github.io/STEMGlobe/"+t},eee={},me=function(e,r,i){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));s=Promise.all(r.map(a=>{if(a=O$e(a),a in eee)return;eee[a]=!0;const l=a.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":M$e,l||(u.as="script",u.crossOrigin=""),u.href=a,o&&u.setAttribute("nonce",o),document.head.appendChild(u),l)return new Promise((h,p)=>{u.addEventListener("load",h),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})}))}return s.then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function d(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function BAt(t,e){return function(r,i){e(r,i,t)}}function VAt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{c(i.next(u))}catch(h){o(h)}}function l(u){try{c(i.throw(u))}catch(h){o(h)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((i=i.apply(t,[])).next())})}let s_;function se(t){return typeof s_[t]=="function"?s_[t]=s_[t](globalThis):s_[t]}var hpe,dpe,ppe,fpe;s_=(hpe=globalThis.dojoConfig)!=null&&hpe.has||(dpe=globalThis.esriConfig)!=null&&dpe.has?{...(ppe=globalThis.dojoConfig)==null?void 0:ppe.has,...(fpe=globalThis.esriConfig)==null?void 0:fpe.has}:{},se.add=(t,e,r,i)=>((i||s_[t]===void 0)&&(s_[t]=e),r&&se(t)),se.cache=s_,se.add("big-integer-warning-enabled",!0),se.add("esri-deprecation-warnings",!0),se.add("esri-tests-disable-screenshots",!1),se.add("esri-tests-use-full-window",!1),se.add("esri-tests-post-to-influx",!0),(()=>{var e;se.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(se.add("host-browser",t),se.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),se.add("dom",t),se("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(se.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),se.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),se.add("khtml",s.includes("Konqueror")?n:void 0),se.add("edge",parseFloat(i.split("Edge/")[1])||void 0),se.add("opr",parseFloat(i.split("OPR/")[1])||void 0),se.add("webkit",!se("wp")&&!se("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),se.add("chrome",!se("edge")&&!se("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),se.add("android",!se("wp")&&parseFloat(i.split("Android ")[1])||void 0),se.add("safari",!s.includes("Safari")||se("wp")||se("chrome")||se("android")||se("edge")||se("opr")?void 0:parseFloat(s.split("Version/")[1])),se.add("mac",s.includes("Macintosh")),!se("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));se.add(o,l),se.add("ios",l)}se("webkit")||(!i.includes("Gecko")||se("wp")||se("khtml")||se("edge")||se.add("mozilla",n),se("mozilla")&&se.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&se.add("esri-mobile",e),r&&se.add("esri-iPhone",r),se.add("esri-geolocation",!!navigator.geolocation)}se.add("esri-wasm","WebAssembly"in globalThis),se.add("esri-performance-mode-frames-between-render",20),se.add("esri-force-performance-mode",!1),se.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),se.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),se.add("esri-atomics","Atomics"in globalThis),se.add("esri-workers","Worker"in globalThis),se.add("web-feat:cache","caches"in globalThis),se.add("esri-workers-arraybuffer-transfer",!se("safari")||Number(se("safari"))>=12),se.add("workers-pool-size",8),se.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),se.add("featurelayer-simplify-payload-size-factors",[1,1,4]),se.add("featurelayer-fast-triangulation-enabled",!0),se.add("featurelayer-animation-enabled",!0),se.add("featurelayer-snapshot-enabled",!0),se.add("featurelayer-snapshot-point-min-threshold",8e4),se.add("featurelayer-snapshot-point-max-threshold",4e5),se.add("featurelayer-snapshot-point-coverage",.1),se.add("featurelayer-query-max-depth",4),se.add("featurelayer-query-pausing-enabled",!1),se.add("hittest-2d-mobile-tolerance",3),se.add("hittest-2d-desktop-tolerance",1),se.add("hittest-2d-small-symbol-tolerance",3),se.add("hittest-2d-small-symbol-tolerance-threshold",3),se.add("featurelayer-advanced-symbols",!1),se.add("featurelayer-pbf",!0),se.add("featurelayer-pbf-statistics",!1),se.add("feature-layers-workers",!0),se.add("feature-polyline-generalization-factor",1),se.add("mapview-transitions-duration",200),se.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),se.add("mapserver-pbf-version-support",10.81),se.add("mapservice-popup-identify-max-tolerance",20),se("host-webworker")||se("host-browser")&&(se.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),se.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{se.add("esri-image-decode",!0,!0,!0)}).catch(()=>{se.add("esri-image-decode",!1,!0,!0)})}return!1}),se.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();const tee=new WeakMap;function R$e(t,e,r=!1){const i=`ðŸ›‘ DEPRECATED - ${e}`;if(!r)return void t.warn(i);let s=tee.get(t);s||(s=new Set,tee.set(t,s)),s.has(e)||(s.add(e),t.warn(i))}function Ape(t,e,r={}){if(se("esri-deprecation-warnings")){const{moduleName:i}=r;$_(t,`Function: ${(i?i+"::":"")+e+"()"}`,r)}}function n_(t,e,r={}){if(se("esri-deprecation-warnings")){const{moduleName:i}=r;$_(t,`Property: ${(i?i+"::":"")+e}`,r)}}function $_(t,e,r={}){if(se("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	ðŸ› ï¸ Replacement: ${i}`),s&&(a+=`
	âš™ï¸ Version: ${s}`),n&&(a+=`
	ðŸ”— See ${n} for more details.`),R$e(t,a,o)}}function GAt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function $$e(t,e){for(const r of t)if(r!=null&&e(r))return r}function lV(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let c1=class cV{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(lV(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&lV(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof cV)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof cV?r.removeAll():r.remove()}},Wb=class yv{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*yv._m}getInt(){return this._seed=(yv._a*this._seed+yv._c)%yv._m,this._seed}getFloat(){return this.getInt()/(yv._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/yv._m*i}};Wb._m=2147483647,Wb._a=48271,Wb._c=0;const i6=1.5,I$e=1/i6,L$e=.5;function jAt(t,e){for(let r=t.length-1;r>=0;r--){const i=t[r];if(e(i))return i}}function s6(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):Array.from(new Set(t))}function e0(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Ppe(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function uV(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function D$e(t){return t&&typeof t.length=="number"}function HAt(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const N$e=!!Array.prototype.fill;function F$e(t,e){if(N$e)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function k$e(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function U$e(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let Mpe=class{constructor(){this.last=0}};const Ope=new Mpe;function hV(t,e,r,i){i=i||Ope;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function $M(t,e,r,i){const s=t.length,n=hV(t,e,s,i);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const ed=new Set;function z$e(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;ed.clear();for(let a=0;a<i;++a)ed.add(e[a]);s=s||Ope;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(ed.has(t[a])&&(n==null||n.push(t[a]),ed.delete(t[a]),t[a]=t[r-1],--r,--a,ed.size===0||r===0))return ed.clear(),r;for(let a=0;a<o;++a)if(ed.has(t[a])&&(n==null||n.push(t[a]),ed.delete(t[a]),t[a]=t[r-1],--r,--a,ed.size===0||r===0))return ed.clear(),r;return ed.clear(),r}function B$e(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function V$e(t){return ree.seed=t,()=>ree.getFloat()}function WAt(t,e){const r=V$e(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const ree=new Wb;function VW(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function YAt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function kE(t,e){return t!=null}const G$e=[];function Rpe(t){return 32+t.length}function GW(){return 16}function $pe(t){if(!t)return 0;let e=Dpe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=Rpe(i);break;case"number":e+=GW();break;case"boolean":e+=4}}return e}function Ipe(t){if(!t)return 0;if(Array.isArray(t))return j$e(t);let e=Dpe;for(const r in t)t.hasOwnProperty(r)&&(e+=Lpe(t[r]));return e}function j$e(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=Npe;for(let i=0;i<e;i++)r+=Lpe(t[i]);return r}function Lpe(t){switch(typeof t){case"object":return Ipe(t);case"string":return Rpe(t);case"number":return GW();case"boolean":return 4;default:return 8}}function H$e(t,e){return Npe+t.length*e}const Dpe=32,Npe=16;function gT(t){return t instanceof ArrayBuffer}function jW(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function o_(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function HW(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function qW(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function n6(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function WW(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function o6(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function HO(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function qO(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function Oh(t){return!("buffer"in t)}function t0(...t){return t.reduce((e,r)=>e+(r?Oh(r)?H$e(r,GW()):r.byteLength+Fpe:0),0)}const Fpe=145,Cc=1024;function q$e(t){return qO(t)||HO(t)||WW(t)||qW(t)||jW(t)}function W$e(t){return qO(t)||HO(t)}function Y$e(t){return qO(t)?179769e303:HO(t)?3402823e32:o6(t)?4294967295:n6(t)?65535:o_(t)||HW(t)?255:WW(t)?2147483647:qW(t)?32767:jW(t)?127:256}function X$e(t,e){let r;for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ge(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=zpe(t);if(e!=null)return e;if(h4(t))return t.clone();if(kpe(t))return t.map(ge);if(Upe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ge(t[i]);return r}function dV(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=zpe(t);if(e!=null)return e;if(kpe(t)){let r=!0;const i=t.map(s=>{const n=dV(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(h4(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Upe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=dV(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function h4(t){return typeof t.clone=="function"}function kpe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Upe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function iee(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function zpe(t){if(jW(t)||o_(t)||HW(t)||qW(t)||n6(t)||WW(t)||o6(t)||HO(t)||qO(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ge(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ge(r));return e}return null}function YW(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function Bpe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&e0(t,e):t instanceof Set?e instanceof Set&&J$e(t,e):t instanceof Map?e instanceof Map&&K$e(t,e):!!iee(t)&&iee(e)&&Z$e(t,e))}function Z$e(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function J$e(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function K$e(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function Q$e(t,e,r=!1){return Gpe(t,e,r)}function a6(t,e){if(e!=null)return e[t]||Vpe(t.split("."),!1,e)}function Jw(t,e,r){const i=t.split("."),s=i.pop(),n=Vpe(i,!0,r);n&&s&&(n[s]=e)}function Vpe(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function Gpe(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=ge(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=Gpe(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}var mpe;const ii={apiKey:void 0,applicationName:"",applicationUrl:(mpe=globalThis.location)==null?void 0:mpe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Q$e(ii,globalThis.esriConfig,!0),delete ii.has),!ii.assetsPath){{const t="4.29";ii.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}ii.defaultAssetsPath=ii.assetsPath}const eIe=/\{([^\}]+)\}/g;function see(t){return t??""}function XW(t,e){return e?t.replaceAll(eIe,typeof e=="object"?(r,i)=>see(a6(i,e)):(r,i)=>see(e(i))):t}function XAt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function ZW(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function ZAt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function JAt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const nee={info:0,warn:1,error:2,none:3};let ae=class Ra{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Ra._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Ra.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=Ra._loggers;return Ra._loggers=e,r},set throttlingDisabled(e){Ra._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Ra._loggers.get(e)||new Ra({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Ra._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=Ra._tickCounter)return;this._loggedMessages[e].set(s,Ra._tickCounter),Ra._scheduleTickCounterIncrement()}for(const s of ii.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=ii.log.level||"warn";return nee[this._parentWithMember("level",r)]<=nee[e]}_argsToKey(...e){return ZW(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){Ra._tickCounterScheduled||(Ra._tickCounterScheduled=!0,Promise.resolve().then(()=>{Ra._tickCounter++,Ra._tickCounterScheduled=!1}))}};ae._loggers=new Map,ae._tickCounter=0,ae._tickCounterScheduled=!1,ae._throttlingDisabled=!1;function l6(t,e){if(t==null)throw new Error(e??"value is None")}function Ae(t){return t==null||t.destroy(),null}function ft(t){return t==null||t.dispose(),null}function wi(t){return t==null||t.remove(),null}function Ja(t){return t==null||t.abort(),null}function er(t){return t==null||t.release(),null}function tIe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function oee(t,e){return t==null?void 0:t[e]}function rIe(t,e){let r;return t.some((i,s)=>(r=e(i,s),r!=null)),r??void 0}const jpe=Symbol("Accessor-beforeDestroy"),iIe={remove:()=>{}};function Yr(t){return t?{remove(){t&&(t(),t=void 0)}}:iIe}function sIe(t){t.forEach(e=>e==null?void 0:e.remove())}function mw(t){return Yr(()=>sIe(t))}function Hpe(t){return Yr(t!=null?()=>t.destroy():void 0)}function Nl(t){return t.__accessor__??null}function nIe(t,e){var r;return((r=t==null?void 0:t.metadata)==null?void 0:r[e])!=null}function lD(t,e,r){return r?d4(t,e,{policy:r,path:""}):d4(t,e,null)}function d4(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=ge(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[n]=d4(l,c,r),r.path=u}else i[n]=d4(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function qpe(t){return Array.isArray(t)?t:t.split(".")}function aee(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function oIe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...aee(r));return e}return aee(t)}function Wpe(t,e,r,i){const s=oIe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return mw(n)}return i(t,s[0],r)}function Ype(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=Nl(e);return nIe(i,r)?i.get(r):e[r]}function Xpe(t,e,r){if(t==null)return t;const i=Ype(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:Xpe(i,e,r+1)}function WO(t,e,r=0){return typeof e!="string"||e.includes(".")?Xpe(t,qpe(e),r):Ype(e,t)}function up(t,e){return WO(t,e)}function lee(t,e){return WO(e,t)!==void 0}var dc;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(dc||(dc={}));function YO(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ge(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function c6(t,e){const r=YO(t);let i=r[e];return i||(i=r[e]={}),i}function aIe(t,e){return lD(t,e,cIe)}const lIe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function cIe(t){return lIe.test(t)?"replace":"merge"}function uIe(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function hIe(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let qo=class pV{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(pV.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):hIe(r)&&r.acquire(...e),r}release(e){e&&!pV.test.disabled&&(this._releaseFunction?this._releaseFunction(e):uIe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};qo.test={disabled:!1};let dIe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){VW(this._observers,this._observer)}},Zpe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return pIe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new dIe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const pIe=Yr();var xr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(xr||(xr={}));const fV=xr.USER+1;function a_(t){switch(t){case"defaults":return xr.DEFAULTS;case"service":return xr.SERVICE;case"portal-item":return xr.PORTAL_ITEM;case"web-scene":return xr.WEB_SCENE;case"web-map":return xr.WEB_MAP;case"link-chart":return xr.LINK_CHART;case"user":return xr.USER;default:return null}}function p4(t){switch(t){case xr.DEFAULTS:return"defaults";case xr.SERVICE:return"service";case xr.PORTAL_ITEM:return"portal-item";case xr.WEB_SCENE:return"web-scene";case xr.WEB_MAP:return"web-map";case xr.LINK_CHART:return"link-chart";case xr.USER:return"user"}}function fIe(t){return p4(t)}var Gi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Gi||(Gi={}));const f4={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},O3=[];let OP=f4;function Ot(t){OP.onObservableAccessed(t)}let cD=!1,uD=!1;function r0(t,e,r){if(cD)return JW(t,e,r);Jpe(t);const i=e.call(r);return Kpe(),i}function mIe(t,e){return r0(f4,t,e)}function JW(t,e,r){const i=cD;cD=!0,Jpe(t);let s=null;try{s=e.call(r)}catch(n){uD&&ae.getLogger("esri.core.accessorSupport.tracking").error(n)}return Kpe(),cD=i,s}function Jpe(t){OP=t,O3.push(t)}function Kpe(){const t=O3.length;if(t>1){const e=O3.pop();OP=O3[t-2],e.onTrackingEnd()}else if(t===1){const e=O3.pop();OP=f4,e.onTrackingEnd()}else OP=f4}function Qpe(t,e){if(e.flags&Gi.DepTrackingInitialized)return;const r=uD;uD=!1,e.flags&Gi.AutoTracked?JW(e,e.metadata.get,t):efe(t,e),uD=r}const gIe=[];function efe(t,e){e.flags&Gi.ExplicitlyTracking||(e.flags|=Gi.ExplicitlyTracking,JW(e,()=>{const r=e.metadata.dependsOn||gIe;for(const i of r)if(typeof i!="string"||i.includes(".")){const s=qpe(i);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=cee(o,s[n],n!==s.length-1)}else cee(t,i,!1)}),e.flags&=~Gi.ExplicitlyTracking)}function cee(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=Nl(t);if(s){const n=s.propertiesByName.get(i);n&&(Ot(n),Qpe(t,n))}return r?t[i]:void 0}let uee=class extends Zpe{constructor(e,r){super(),this.propertyName=e,this.metadata=r,this._accessed=null,this._handles=null,this.flags=0,this.flags=Gi.Dirty|(r.nonNullable?Gi.NonNullable:0)|(r.hasOwnProperty("value")?Gi.HasDefaultValue:0)|(r.get===void 0?Gi.DepTrackingInitialized:0)|(r.dependsOn===void 0?Gi.AutoTracked:0)}destroy(){this.flags&Gi.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Ot(this);const r=e.store,i=this.propertyName,s=this.flags,n=r.get(i);if(s&Gi.Computing||~s&Gi.Dirty&&r.has(i))return n;this.flags|=Gi.Computing;const o=e.host;let a;s&Gi.AutoTracked?a=r0(this,this.metadata.get,o):(efe(o,this),a=this.metadata.get.call(o)),r.set(i,a,xr.COMPUTED);const l=r.get(i);return l===n?this.flags&=~Gi.Dirty:mIe(this.commit,this),this.flags&=~Gi.Computing,l}onObservableAccessed(e){if(e===this)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Gi.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let r=this._handles;r==null&&(r=[],this._handles=r);for(let i=0;i<e.length;++i)r.push(e[i].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~Gi.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}onInvalidated(){~this.flags&Gi.Overridden&&(this.flags|=Gi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}},yIe=class tfe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new tfe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ge(i))}),r}get(e){return this._values.get(e)}originOf(){return xr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function e$(t,e,r){return t!==void 0}function hee(t,e,r,i){return t!==void 0&&(!(r==null&&t.flags&Gi.NonNullable)||(i.lifecycle,dc.INITIALIZING,!1))}let _Ie=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=dc.INITIALIZING,this.store=new yIe,this._origin=xr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new uee(i,r[i]);this.propertiesByName.set(i,s)}this.metadata=r}initialize(){this.lifecycle=dc.CONSTRUCTING}constructed(){this.lifecycle=dc.CONSTRUCTED}destroy(){this.lifecycle=dc.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==dc.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Ot(r);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.flags&Gi.HasDefaultValue)return"defaults"}return p4(r)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(e$(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);e$(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!e$(s))return"";const n=new Set,o=r0({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof uee&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(e$(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.flags&Gi.Overridden)}clearOverride(e){const r=this.propertiesByName.get(e);r&&r.flags&Gi.Overridden&&(r.flags&=~Gi.Overridden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!hee(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(H8.release(n),!o)return;r=a}i.flags|=Gi.Overridden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!hee(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(H8.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=a_(e)}getDefaultOrigin(){return p4(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==dc.INITIALIZING?this._origin:xr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&YW(r,s.get(n))&&~e.flags&Gi.Overridden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),Qpe(this.host,e))}_cast(e,r){const i=H8.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},vIe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const H8=new qo(vIe);function bIe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(a6(i,e)??"").toString())}let rfe=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&bIe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},J=class ife extends rfe{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ge(r)}catch{return"[object]"}}))}}catch(e){throw ae.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new ife(e.name,e.message,e.details)}};J.prototype.type="error";function m4(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))m4(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void m4(up(t,s),n,r)}const i=t.__accessor__;i!=null&&wIe(e,i),t[e]=r}}function wIe(t,e){if(se("esri-unknown-property-errors")&&!xIe(t,e))throw new J("set:unknown-property",TIe(t,e))}function xIe(t,e){return e.metadata[t]!=null}function TIe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let SIe;function EIe(){return SIe}var dee;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(dee||(dee={}));function CIe(t){t.length=0}let pc=class{constructor(e=50,r=50){this._pool=new qo(Array,void 0,CIe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return q8.acquire()}static release(e){return q8.release(e)}static prune(){q8.prune()}};const q8=new pc(100);let sfe=class extends qo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const t$=[];function RS(t){t$.push(t),t$.length===1&&queueMicrotask(()=>{const e=t$.slice();t$.length=0;for(const r of e)r()})}let Fg=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var mV;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const h=a>>>1,p=n[c-1];for(;u<=h;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const f=n[u-1];if(l(f,p)<=0)break;n[c-1]=f,c=u}n[c-1]=p},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const h=n[o];n[o]=n[u],n[u]=h,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const h=n[o];n[o]=n[u],n[u]=h,e(n,c,u,l),yield}}t.sort=i,t.iterableSort=s})(mV||(mV={}));const pee=mV,AIe=1.5,PIe=1.1;let kt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Mpe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>fee(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,fee(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=hV(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(hV(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=z$e(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){pee.sort(this.data,0,this.length,e)}iterableSort(e){return pee.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const{data:i,length:s}=this;for(let n=0;n<s;++n)e.call(r,i[n],n,i)}forEach(e,r){this.data.slice(0,this.length).forEach(e,r)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function fee(t){t.data.length>AIe*t.length&&(t.data.length=Math.floor(t.length*PIe))}function MIe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return Yr(()=>t.clearTimeout(i))}}}const XO=MIe(globalThis);function u6(t){return OIe(t)||nfe(t)}function OIe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function nfe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function UE(t,e,r){if(!u6(t))throw new TypeError("target is not a Evented or EventTarget object");return nfe(t)?RIe(t,e,r):t.on(e,r)}function RIe(t,e,r,i){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,r,i);return Yr(()=>{for(const n of s)t.removeEventListener(n,r,i)})}return t.addEventListener(e,r,i),Yr(()=>t.removeEventListener(e,r,i))}function ofe(t,e,r){if(!u6(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=UE(t,e,s=>{i.remove(),r.call(t,s)});return i}function hr(t="Aborted"){return new J("AbortError",t)}function vt(t,e="Aborted"){if(Zs(t))throw hr(e)}function h6(t){return t instanceof AbortSignal?t:t==null?void 0:t.signal}function Zs(t){const e=h6(t);return e!=null&&e.aborted}function Uo(t){if(ns(t))throw t}function mee(t){if(!ns(t))throw t}function lo(t,e){const r=h6(t);if(r!=null){if(!r.aborted)return ofe(r,"abort",()=>e());e()}}function d6(t,e){const r=h6(t);if(r!=null)return vt(r),ofe(r,"abort",()=>e(hr()))}function $Ie(t,e){return h6(e)==null?t:new Promise((r,i)=>{let s=lo(e,()=>i(hr()));const n=()=>{s=wi(s)};t.then(n,n),t.then(r,i)})}function ns(t){return(t==null?void 0:t.name)==="AbortError"}async function IM(t){try{return await t}catch(e){if(!ns(e))throw e;return}}async function lPt(t,e=ae.getLogger("esri")){try{return await t}catch(r){ns(r)||e.error(r)}}async function KW(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await KW(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function gV(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function cPt(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function LM(t,e=void 0,r){const i=new AbortController;return lo(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);lo(i,()=>{o&&(clearTimeout(o),n(hr()))})})}function IIe(t,e){const r=new AbortController,i=setTimeout(()=>r.abort(),e);return lo(t,()=>{r.abort(),clearTimeout(i)}),{...t,signal:r.signal}}function Rc(t){return t&&typeof t.then=="function"}function yV(t){return Rc(t)?t:Promise.resolve(t)}function afe(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(hr()),n=Wo();const p=n.promise;if(o){const f=o;o=null,f.abort()}return p}if(s=n||Wo(),n=null,e>0){const p=new AbortController;r=yV(t(...l,p.signal));const f=r;LM(e).then(()=>{r===f&&(n?p.abort():o=p)})}else r=1,r=yV(t(...l));const c=()=>{const p=i;i=s=r=o=null,p!=null&&a(...p)},u=r,h=s;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return a}function Wo(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>XO.setTimeout(()=>i.reject(n),s),i.promise=r,i}function uPt(t,e){return t.then(e,e)}async function g4(t){await Promise.resolve(),vt(t)}function hPt(t){return t}function lfe(t){return 1e3*t}function dPt(t){return t}function QW(t){return .001*t}let LIe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},DIe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},_V=0,vV=0;const bC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},bV=["prepare","preRender","render","postRender","update","finish"],wV=[],gw=new kt;let NIe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function FIe(){Yb!=null&&(cancelAnimationFrame(Yb),Yb=requestAnimationFrame(eY))}const y4={frameTasks:gw,willDispatch:!1,clearFrameTasks:kIe,dispatch:ufe,executeFrameTasks:zIe,reschedule:FIe};function zE(t){const e=new DIe(t);return wV.push(e),y4.willDispatch||(y4.willDispatch=!0,RS(ufe)),e}function yw(t){const e=new LIe(t);return gw.push(e),Yb==null&&(_V=performance.now(),Yb=requestAnimationFrame(eY)),new NIe(e)}let Yb=null;function kIe(t=!1){gw.forAll(e=>{e.removed=!0}),t&&cfe()}function UIe(t){vV=Math.max(0,t)}function eY(){const t=performance.now();Yb=null,Yb=gw.length>0?requestAnimationFrame(eY):null,y4.executeFrameTasks(t)}function zIe(t){const e=t-_V;_V=t;const r=vV>0?vV:1e3/60,i=Math.max(0,e-r);bC.time=t,bC.frameDuration=r-i;for(let s=0;s<bV.length;s++){const n=performance.now(),o=bV[s];gw.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(bC.elapsedFrameTime=performance.now()-t,bC.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,bC)))}),VIe[s].record(performance.now()-n)}cfe(),GIe.record(performance.now()-t)}const r$=new kt;function cfe(){gw.forAll(t=>{t.removed&&r$.push(t)}),gw.removeUnorderedMany(r$.data,r$.length),r$.clear()}function ufe(){for(;wV.length;){const t=wV.shift();t.isActive&&t.callback()}y4.willDispatch=!1}function BIe(t=1,e){const r=Wo(),i=()=>{Zs(e)?r.reject(hr()):t===0?r():(--t,RS(()=>i()))};return i(),r.promise}const VIe=bV.map(t=>new Fg(t)),GIe=new Fg("total");function hD(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}function gee(t,e){if(!e)return t;for(const r of e)t.add(r);return t}function hfe(t,e){const r=new Set;return gee(r,t),gee(r,e),r}function jIe(t,e){const r=new Set;for(const i of e)t.has(i)&&r.add(i);return r}function gPt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const r of t)if(!e.has(r))return!1;return!0}function yPt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function HIe(t,e){const r=new Set(t);for(const i of e)r.delete(i);return r}function qIe(t,e){return HIe(hfe(t,e),jIe(t,e))}let WIe=0;const YIe=0;function fu(){return++WIe}let p6=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new XIe(e),yee.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;yee.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},XIe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=ZIe}};const yee=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function ZIe(){}let WT=!1;const _4=[];function dfe(t,e){let r=new p6(n),i=null,s=!1;function n(){if(!r||s)return;if(WT)return void mfe(n);const a=i;r.clear(),WT=!0,s=!0,i=r0(r,t),s=!1,WT=!1,e(i,a),gfe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=r0(r,t),s=!1,Yr(o)}function pfe(t,e){let r=new p6(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=r0(r,t),i):null}return o(),Yr(n)}function ffe(t){let e=new p6(i),r=!1;function i(){e&&!r&&(WT?mfe(i):(e.clear(),WT=!0,r=!0,r0(e,t),r=!1,WT=!1,gfe()))}function s(){e&&(e.destroy(),e=null)}return r=!0,r0(e,t),r=!1,Yr(s)}function mfe(t){_4.includes(t)||_4.unshift(t)}function gfe(){for(;_4.length;)_4.pop()()}var RP;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(RP||(RP={}));let DM=class{constructor(){this.uid=fu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(RP.Untracked,e,r,i,s,n,YW)}static acquireTracked(e,r,i,s){return this.pool.acquire(RP.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===RP.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=fu(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=fu(),this.removed=!0}};DM.pool=new sfe(DM);const dD=new pc,Bg=new Set;let v4;function b4(t){Bg.delete(t),Bg.add(t),v4||(v4=zE(QIe))}function JIe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function KIe(t){for(const e of Bg.values())e.target===t&&(e.removed=!0)}function QIe(){let t=10;for(;v4&&t--;){v4=null;const e=eLe(),r=dD.acquire();for(const i of e){const s=i.uid;JIe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of Bg)i.removed&&(r.push(i),Bg.delete(i));for(const i of r)DM.pool.release(i);dD.release(r),dD.release(e),xV.forEach(i=>i())}}function eLe(){const t=dD.acquire();t.length=Bg.size;let e=0;for(const r of Bg)t[e]=r,++e;return Bg.clear(),t}const xV=new Set;function yfe(t){return xV.add(t),Yr(()=>xV.delete(t))}function tLe(t,e,r){let i=Wpe(t,e,r,(s,n,o)=>{let a,l,c=pfe(()=>WO(s,n),(u,h)=>{var p;((p=s.__accessor__)==null?void 0:p.lifecycle)===dc.DESTROYED||a&&a.uid!==l?i.remove():(a||(a=DM.acquireUntracked(u,o,h,s,n),l=a.uid),b4(a))});return Yr(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,b4(a)),a=null),i=c=null})});return i}function rLe(t,e,r){const i=Wpe(t,e,r,(s,n,o)=>{let a=!1;return dfe(()=>WO(s,n),(l,c)=>{s.__accessor__.lifecycle!==dc.DESTROYED?a||(a=!0,YW(c,l)||o.call(s,l,c,n,s),a=!1):i.remove()})});return i}function iLe(t,e,r,i=!1){return t.__accessor__&&t.__accessor__.lifecycle!==dc.DESTROYED?i?rLe(t,e,r):tLe(t,e,r):Yr()}function sLe(t,e,r){let i,s,n=pfe(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=DM.acquireTracked(o,e,a,r),s=i.uid),b4(i))});return Yr(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,b4(i)),i=null),n=null})}function nLe(t,e,r){let i=!1;return dfe(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function oLe(t,e,r=!1,i=Bpe){return r?nLe(t,e,i):sLe(t,e,i)}function _ee(t){return hD(Bg,e=>e.oldValue===t)}function vh(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function wPt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function f6(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}function xPt(t){const e=new Map;return r=>(e.has(r)||e.set(r,t(r)),e.get(r))}const YT=()=>ae.getLogger("esri.core.accessorSupport.ensureTypes");function aLe(t){return t==null?t:new Date(t)}function lLe(t){return t==null?t:!!t}function cLe(t){return t==null?t:t.toString()}function jd(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function tY(t){return t==null?t:Math.round(parseFloat(t))}function _fe(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function w4(t,e){return e!=null&&t&&!(e instanceof t)}function vfe(t){return t&&"isCollection"in t}function vee(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function uLe(t,e){if(!(e!=null&&e.constructor)||!vfe(e.constructor))return TV(t,e)?e:new t(e);const r=vee(t.prototype.itemType),i=vee(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(TV(t,e),e):new t(e):e}function TV(t,e){return!!_fe(e)&&(YT().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+m6(t)+"'"),!0)}function _w(t,e){return e==null?e:vfe(t)?uLe(t,e):w4(t,e)?TV(t,e)?e:new t(e):e}function m6(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const hLe=new WeakMap;function dLe(t){switch(t){case Number:return jd;case an:return tY;case Boolean:return lLe;case String:return cLe;case Date:return aLe;default:return f6(hLe,t,()=>_w.bind(null,t))}}function ma(t,e){const r=dLe(t);return arguments.length===1?r:r(e)}function NM(t,e,r){return arguments.length===1?NM.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function pLe(t,e){return arguments.length===1?NM(r=>ma(t,r)):NM(r=>ma(t,r),e)}function bfe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>bfe(t,e-1,i)):t(r)}function x4(t,e,r){if(arguments.length===2)return n=>x4(t,e,n);if(!r)return r;r=bfe(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function fLe(t,e,r){return arguments.length===2?x4(i=>ma(t,i),e):x4(i=>ma(t,i),e,r)}function wfe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function SV(t,e){if(arguments.length===2)return SV(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||s.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&s.some(h=>!w4(a,h))?a:(u&&i.length?(n||(n=i.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),YT().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(h=>m6(h)).join(", ")),YT().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):YT().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function gm(t,e){if(arguments.length===2)return gm(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=ma(c),i.push(m6(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!w4(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return YT().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!w4(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!_fe(l)){const h={};for(const p in l)p!==t.key&&(h[p]=l[p]);return u(h)}return u(l)}}let an=class{};const SPt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function mLe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function xfe(t){switch(t.type){case"native":return ma(t.value);case"array":return NM(xfe(t.value));case"one-of":return gLe(t);default:return null}}function gLe(t){let e=null;return(r,i)=>CV(r,t)?r:(e==null&&(e=EV(t)),YT().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function EV(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case an:return"integer";case Date:return"date";default:return m6(t.value)}case"array":return`array of ${EV(t.value)}`;case"one-of":{const e=t.values.map(r=>EV(r));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function CV(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case an:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!CV(r,e.value));case"one-of":return e.values.some(r=>CV(t,r))}}function m(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=c6(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&ae.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let h=up(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=up(this,u);p&&(h=h.bind(p))}return h},s.readOnly||(s.set=c?function(h){this._override(r,h)}:function(h){m4(this,l,h)})}const o=t.type,a=t.types;s.cast||(o?s.cast=yLe(o):a&&(Array.isArray(a)?s.cast=NM(gm(a[0])):s.cast=gm(a))),aIe(s,t),t.range&&(s.cast=_Le(s.cast,t.range))}}function Tfe(t,e,r){const i=c6(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function yLe(t){let e=0,r=t;if(mLe(t))return xfe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(wfe(i))return e===0?SV(i):x4(SV(i),e);if(e===1)return pLe(i);if(e>1)return fLe(i,e);const s=t;return s.from?s.from:ma(s)}function _Le(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function vLe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let vw=class extends rfe{constructor(e,r,i){super(e,r,i)}};vw.prototype.type="warning";function Sfe(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const AV=()=>ae.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function bee(t,e,r){var i,s;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((s=e.read)==null?void 0:s.enabled)===!1||xLe(t)&&Jw("read.reader",rY(t),e))}function rY(t){var r,i;const e=t.ndimArray??0;if(e>1)return wLe(t);if(e===1)return wee(t);if("type"in t&&Cfe(t.type)){const s=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,n=wee(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return iY(t)}function iY(t){return"type"in t?bLe(t.type):TLe(t.types)}function bLe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void AV().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Efe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Efe(t,s,r,i-1)):t(e,void 0,r)}function wLe(t){const e=iY(t),r=Efe.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function wee(t){const e=iY(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function Cfe(t){if(!Sfe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?sY(e.Type):Afe(e.Type))}function xLe(t){return"types"in t?Afe(t.types):sY(t.type)}function sY(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Cfe(t))}function Afe(t){for(const e in t.typeMap)if(!sY(t.typeMap[e]))return!1;return!0}function TLe(t){let e=null;const r=t.errorContext??"type",i=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void AV().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=SLe(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&s&&o.messages.push(new vw(`${r}:unsupported`,p,{definition:s,context:o})),void AV().error(p)}const h=new u;return h.read(s,o),i?i(h):h}}function SLe(t){var r,i;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=YO(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!(l!=null&&l.writer)){e[s]=n;continue}const c=l.target,u=typeof c=="string"?c:t.key,h={};l.writer(s,h,u),h[u]&&(e[h[u]]=n)}return e}function ELe(t){if(t.json||(t.json={}),Tee(t.json),See(t.json),xee(t.json),t.json.origins)for(const e in t.json.origins)Tee(t.json.origins[e]),See(t.json.origins[e]),xee(t.json.origins[e]);return!0}function xee(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Tee(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function See(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Eee(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&Sfe(t.type))?e.write.writer=PLe:r>1?e.write.writer=MLe(r):e.types?Array.isArray(e.types)?e.write.writer=ALe(e.types[0]):e.write.writer=CLe(e.types):e.write.writer=FM}function CLe(t){return(e,r,i,s)=>e?Pfe(e,t,s)?FM(e,r,i,s):void 0:FM(e,r,i,s)}function Pfe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new J(`${i}:unsupported`,s,{definition:t,context:r})),ae.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function ALe(t){return(e,r,i,s)=>!e||!Array.isArray(e)?FM(e,r,i,s):FM(e.filter(n=>Pfe(n,t,s)),r,i,s)}function FM(t,e,r,i){Jw(r,T4(t,i),e)}function T4(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?S4(t):t}function S4(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function PLe(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>T4(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[T4(t,i)],Jw(r,s,e)}function Mfe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>Mfe(i,e,r-1)):T4(t,e)}function MLe(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=Mfe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Jw(i,n,r)}}function OLe(t,e){return nY(t,"any",e==null?void 0:e.origin)}function PV(t,e){return nY(t,"read",e==null?void 0:e.origin)}function Ofe(t,e){return nY(t,"write",e==null?void 0:e.origin)}function nY(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function RLe(t){const e=$Le(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?ILe(i):e;bee(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Eee(s,i)}bee(e,t.json,!0),Eee(e,t.json)}function $Le(t){return t.json.types?MV(t.json):t.type?Rfe(t):MV(t)}function ILe(t){return t.type?Rfe(t):MV(t)}function Rfe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!wfe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function MV(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function LLe(t){ELe(t)&&(vLe(t),RLe(t))}const W8=new Set,Y8=new Set;function V(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,NLe(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!W8.has(s.initialize)&&(W8.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!Y8.has(s.destroy)&&(Y8.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);W8.clear(),Y8.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[jpe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript(...a)}}};n.__accessorMetadata__=YO(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function DLe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Ot(i);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function NLe(t){const e=t.prototype,r=YO(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];LLe(n),i[s]={enumerable:!0,configurable:!0,get:DLe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===dc.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var $fe,Ife;function FLe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const gy=Symbol("Accessor-Handles"),OV=Symbol("Accessor-Initialized");let Me=class Lfe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}YO(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{h=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,h}:e[a]}for(const a in r){const l=FLe(r[a]);m(l)(o.prototype,a)}return V(i)(o)}constructor(...e){if(this[$fe]=null,this[Ife]=!1,this.constructor===Lfe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new _Ie(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[OV]=!0}initialize(){}[jpe](){this[gy]=Ae(this[gy])}destroy(){var e;this.destroyed||(KIe(this),this.__accessor__.destroy(),(e=EIe())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[OV]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===dc.DESTROYED||!1}commitProperty(e){up(this,e)}get(e){return Ape(ae.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),up(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return m4(this,e,r),this}watch(e,r,i){return iLe(this,e,r,i)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[gy];i==null&&(i=this[gy]=new c1),i.add(e,r)}removeHandles(e){const r=this[gy];r!=null&&r.remove(e)}removeAllHandles(){const e=this[gy];e!=null&&e.removeAll()}hasHandles(e){const r=this[gy];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};$fe=gy,Ife=OV;const Au=t=>{let e=class extends t{clone(){var l;const r=Nl(this);l6(r,"unable to clone instance of non-accessor class");const i=r.metadata,s=r.store,n={},o=new Map;for(const c in i){const u=i[c],h=s==null?void 0:s.originOf(c),p=u.clonable;if(u.readOnly||p===!1||h!==xr.USER&&h!==xr.DEFAULTS&&h!==xr.WEB_MAP&&h!==xr.WEB_SCENE)continue;const f=this[c];let g=null;g=typeof p=="function"?p(f):p==="reference"?f:dV(f),f!=null&&g==null||(h===xr.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Nl(a))==null?void 0:l.store;if(c)for(const[u,h]of o)c.set(u,h,xr.DEFAULTS)}return a}};return e=d([V("esri.core.Clonable")],e),e};let bw=class extends Au(Me){};bw=d([V("esri.core.Clonable")],bw);let _v=class extends bw{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],_v.prototype,"row",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],_v.prototype,"column",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],_v.prototype,"rows",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],_v.prototype,"columns",void 0),_v=d([V("esri.CameraLayout")],_v);const Dfe=_v;function E(){return[0,0,0]}function qi(t){return[t[0],t[1],t[2]]}function Pe(t,e,r){return[t,e,r]}function la(t,e=E()){const r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function kLe(t,e){return new Float64Array(t,e,3)}function Nfe(){return E()}function Ffe(){return Pe(1,1,1)}function kfe(){return Pe(1,0,0)}function Ufe(){return Pe(0,1,0)}function oY(){return Pe(0,0,1)}const Cn=Nfe(),kg=Ffe(),aY=kfe(),lY=Ufe(),$S=oY();Object.freeze(Object.defineProperty({__proto__:null,ONES:kg,UNIT_X:aY,UNIT_Y:lY,UNIT_Z:$S,ZEROS:Cn,clone:qi,create:E,createView:kLe,fromArray:la,fromValues:Pe,ones:Ffe,unitX:kfe,unitY:Ufe,unitZ:oY,zeros:Nfe},Symbol.toStringTag,{value:"Module"}));let cY=1e-6;function wa(){return cY}function ULe(t){cY=t}const ZO=Math.random,zLe=Math.PI/180,BLe=180/Math.PI;function g6(t){return t*zLe}function VLe(t){return t*BLe}function GLe(t,e){return Math.abs(t-e)<=cY*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:ZO,equals:GLe,getEpsilon:wa,setEpsilon:ULe,toDegree:VLe,toRadian:g6},Symbol.toStringTag,{value:"Module"}));function Se(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ce(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function te(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function pe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ye(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function y6(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function E4(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function jLe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function zfe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function IS(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function Bfe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function Vfe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Gfe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function HLe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function re(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function kn(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function $i(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function So(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function pa(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Eo(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qLe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function fe(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function de(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ze(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function li(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function WLe(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*u,t}function YLe(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,h=3*l*o,p=l*n;return t[0]=e[0]*c+r[0]*u+i[0]*h+s[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*h+s[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*h+s[2]*p,t}function XLe(t,e){e=e||1;const r=ZO,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function Ge(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function Bo(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function lc(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2],u=s*c-n*l,h=n*a-i*c,p=i*l-s*a,f=s*p-n*h,g=n*u-i*p,_=i*h-s*u,v=2*o;return t[0]=a+u*v+2*f,t[1]=l+h*v+2*g,t[2]=c+p*v+2*_,t}function ZLe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function JLe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function KLe(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function jfe(t,e){fe(Cee,t),fe(Aee,e);const r=de(Cee,Aee);return r>1?0:r<-1?Math.PI:Math.acos(r)}const Cee=E(),Aee=E();function QLe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function To(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ww(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=wa();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function m0(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Hi=ye,eDe=y6,tDe=E4,Vg=$i,kM=So,nc=Se,C4=pa,Pee=Object.freeze(Object.defineProperty({__proto__:null,abs:IS,add:pe,angle:jfe,bezier:YLe,ceil:jLe,copy:ce,cross:Ze,direction:m0,dist:Vg,distance:$i,div:tDe,divide:E4,dot:de,equals:ww,exactEquals:To,floor:zfe,hermite:WLe,inverse:qLe,len:nc,length:Se,lerp:li,max:Gfe,min:Vfe,mul:eDe,multiply:y6,negate:Eo,normalize:fe,random:XLe,rotateX:ZLe,rotateY:JLe,rotateZ:KLe,round:HLe,scale:re,scaleAndAdd:kn,set:te,sign:Bfe,sqrDist:kM,sqrLen:C4,squaredDistance:So,squaredLength:pa,str:QLe,sub:Hi,subtract:ye,transformMat3:Bo,transformMat4:Ge,transformQuat:lc},Symbol.toStringTag,{value:"Module"})),Mee=new Float32Array(1);function Hfe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function we(t,e,r){return Math.min(Math.max(t,e),r)}function UM(t){return(t&t-1)==0}function PPt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function MPt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Pt(t,e,r){return t+(e-t)*r}function OPt(t,e,r,i,s){return Pt(i,s,(t-e)/(r-e))}function Lt(t){return t*Math.PI/180}function ga(t){return 180*t/Math.PI}function RV(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Bn(t){return Math.acos(we(t,-1,1))}function Rh(t){return Math.asin(we(t,-1,1))}function w_(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const A4=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function $V(t){return A4.setFloat64(0,t),A4.getBigInt64(0)}function rDe(t){return A4.setBigInt64(0,t),A4.getFloat64(0)}const pD=BigInt("1000000"),iDe=qfe(1);function qfe(t){const e=$V(t=Math.abs(t)),r=rDe(e<=pD?pD:e-pD);return Math.abs(t-r)}function RPt(t,e,r=iDe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&qfe(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=$V(t),s=$V(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>pD)}function sDe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function nDe(t){return Wfe(Math.max(-IV,Math.min(t,IV)))}function Wfe(t){return Mee[0]=t,Mee[0]}function zM(t,e,r){const i=we((r-t)/(e-t),0,1);return i*i*(3-2*i)}function Oee(t,e){const r=Se(t),i=Rh(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return te(e,r,i,s),e}function $Pt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(w_(e,1)&&w_(r,1)&&w_(i,1))}const IV=Wfe(34028234663852886e22);let I_=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return we(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function uY(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const oDe=uY(new I_(0,2*Math.PI)),L_=uY(new I_(-Math.PI,Math.PI)),hY=uY(new I_(0,360));let aDe=class Yfe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Yfe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ge(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??xr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===xr.DEFAULTS){const s=this._values.get(e);if((s==null?void 0:s.origin)!=null&&s.origin>i)return}this._values.set(e,new lDe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===xr.DEFAULTS?e:xr.USER}},lDe=class{constructor(e,r){this.value=e,this.origin=r}};function Xfe(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),xr.DEFAULTS)});const i=t.metadata;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),xr.DEFAULTS)})}function cDe(t,e,r){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&lee(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&lee(s,r))return!0;return!1}function uDe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function hDe(t,e,r,i,s){let n=PV(e[r],s);uDe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=PV(e[o],s),cDe(n,r,i)&&(t[o]=!0)}function dDe(t,e,r,i){const s=r.metadata,n=OLe(s[e],i),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const Zfe={origin:"service"};function Jfe(t,e,r=Zfe){if(!e||typeof e!="object")return;const i=Nl(t),s=i.metadata,n={};for(const o of Object.getOwnPropertyNames(e))hDe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=PV(s[o],r).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?WO(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||dDe(t,o,i,r)}i.setDefaultOrigin("user")}function pDe(t,e,r,i=Zfe){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?i!=null&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function fDe(t,e,r,i,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,n,r,s),n}function Kfe(t,e,r,i,s,n){if(!(i!=null&&i.write))return!1;const o=up(t,r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1||s.layerContainerTypes&&(n!=null&&n.layerContainerType)&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new J("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&(n!=null&&n.messages)?n.messages.push(a):a&&!n&&ae.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===xr.DEFAULTS)&&mDe(t,r,n,i,o)||!s.ignoreOrigin&&(n!=null&&n.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(r)<a_(n.origin))}function mDe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return e0(o,s)}return!1}return n===s}function gDe(t,e,r,i){const s=Nl(t),n=s.metadata,o=Ofe(n[e],i);return!!o&&Kfe(t,s,e,o,r,i)}function Qfe(t,e,r){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return lD(e,t.toJSON(r));const i=Nl(t),s=i.metadata;for(const a in s){const l=Ofe(s[a],r);if(!Kfe(t,i,a,l,void 0,r))continue;const c=up(t,a),u=fDe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=lD(e,u),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>lD(e,u,()=>"replace-arrays"))),r!=null&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:fIe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const JO=t=>{let e=class extends t{constructor(...r){super(...r);const i=Nl(this),s=i.store,n=new aDe;i.store=n,Xfe(i,s,n)}read(r,i){Jfe(this,r,i)}write(r,i){return Qfe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return yDe.call(this,r,i)}};return e=d([V("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function yDe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}function LV(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let We=class extends JO(Me){};We=d([V("esri.core.JSONSupport")],We);const _De=Object.prototype.toString;function vDe(t){const e="__accessorMetadata__"in t?ma(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return bDe.apply(this,r)}}function bDe(t,e,r,i){c6(t,e).cast=i}function wDe(t){return(e,r)=>{c6(e,t).cast=e[r]}}function zi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&_De.call(t[0])==="[object Function]"?vDe(t[0]):t.length===1&&typeof t[0]=="string"?wDe(t[0]):void 0}function Tr(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=Tfe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}function lr(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=Tfe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Yo=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Jw(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Ul(){return function(t,e){return new Yo(t,{ignoreUnknown:!0,...e})}}let dY=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Kr=new dY(6378137,1/298.257223563,3e5,.006694379990137799),hp=new dY(3396190,1/169.8944472236118,23e4),i0=new dY(1737400,0,0),xDe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,TDe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function DV(t){const e=t==null?void 0:t.match(xDe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=TDe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function SDe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function eme(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}function EDe(t){const e=new Uint8Array(t);let r="";for(let i=0;i<e.length;i++)r+=String.fromCharCode(e[i]);return btoa(r)}const CDe=()=>ae.getLogger("esri.core.urlUtils"),BE=ii.request,Ree="esri/config: esriConfig.request.proxyUrl is not set.",tme=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,rme=/^\s*http:/i,ADe=/^\s*https:/i,PDe=/^\s*file:/i,MDe=/:\d+$/,ODe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,RDe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),$De=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let XT=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(RDe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match($De),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const i$={},IDe=new XT(ii.applicationUrl);let Ha=IDe;const LDe=DDe();let pY=LDe;const fY=()=>Ha,ime=()=>pY;function DDe(){const t=Ha.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Ha.scheme}://${Ha.host}${Ha.port!=null?`:${Ha.port}`:""}`}${e}`}function $s(t){if(!t)return null;const e={path:null,query:null},r=new XT(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=mY(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function mY(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function xw(t,e){return t?Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e==null?void 0:e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>LV(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):LV(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function NDe(t=!1){let e,r=BE.proxyUrl;if(typeof t=="string"){e=VDe(t);const i=_6(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw CDe().warn(Ree),new J("urlUtils:proxy-not-set",Ree);return e&&NV()&&(r=wY(r)),$s(r)}function UPt(t){const e=_6(t);let r,i;if(e){const s=gY(e.proxyUrl);r=s.path,i=s.query?mY(s.query):null}if(r){const s=$s(t);t=r+"?"+s.path;const n=xw({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const wC={path:"",query:""};function gY(t){const e=t.indexOf("?");return e!==-1?(wC.path=t.slice(0,e),wC.query=t.slice(e+1)):(wC.path=t,wC.query=null),wC}function sme(t){return t=(t=M4(t=WDe(t=gY(t).path),!0)).toLowerCase()}function FDe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:sme(t.urlPrefix)},r=BE.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function _6(t){const e=BE.proxyRules,r=sme(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function kDe(t,e){if(!t||!e)return!1;t=P4(t),e=P4(e);const r=DV(t),i=DV(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&LS(t,e,!0)}function nme(t,e){return t=P4(t),e=P4(e),M4(t)===M4(e)}function P4(t){const e=(t=mu(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function ome(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=BE.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function LS(t,e,r=!1){if(!t||!e)return!1;const i=kV(t),s=kV(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function yY(t){if(typeof t=="string"){if(!Rl(t))return!0;t=kV(t)}if(LS(t,Ha))return!0;const e=BE.trustedServers||[];for(let r=0;r<e.length;r++){const i=UDe(e[r]);for(let s=0;s<i.length;s++)if(LS(t,i[s]))return!0}return!1}function UDe(t){return i$[t]||(bY(t)||$h(t)?i$[t]=[new XT(au(t))]:i$[t]=[new XT(`http://${t}`),new XT(`https://${t}`)]),i$[t]}function au(t,e=pY,r){return $h(t)?r&&r.preserveProtocolRelative?t:Ha.scheme==="http"&&Ha.authority===dp(t).slice(2)?`http:${t}`:`https:${t}`:bY(t)?t:Tw(t[0]==="/"?qDe(e):e,t)}function _Y(t,e=pY,r){if(t==null||!Rl(t))return t;const i=mu(t),s=i.toLowerCase(),n=mu(e).toLowerCase().replace(/\/+$/,""),o=r?mu(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(h,p,f)=>(f=h.indexOf(p,f))===-1?h.length:f;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)t=`../${t}`;else t=`./${t}`;return t}function mu(t){return t=ZDe(t=XDe(t=YDe(t=au(t=t.trim()))))}function Tw(...t){const e=t.filter(kE);if(!(e!=null&&e.length))return;const r=[];if(Rl(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),jDe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function dp(t,e=!1){if(t==null||DS(t)||Cm(t))return null;let r=t.indexOf("://");if(r===-1&&$h(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=M4(t,!0)),t}function Rl(t){return $h(t)||bY(t)}function DS(t){return t!=null&&t.slice(0,5)==="blob:"}function Cm(t){return t!=null&&t.slice(0,5)==="data:"}function vY(t){const e=D_(t);return e&&e.isBase64?eme(e.data):null}function zPt(t){return EDe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const zDe=/^data:(.*?)(;base64)?,(.*)$/;function D_(t){const e=t.match(zDe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function ame(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function BPt(t){return(await fetch(t)).blob()}function VPt(t){const e=vY(t);if(!e)return null;const r=D_(t);return new Blob([e],{type:r.mediaType})}function GPt(t,e){BDe(t,e)}function BDe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function $h(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function bY(t){return t!=null&&tme.test(t)}function VDe(t){return t!=null&&ADe.test(t)||Ha.scheme==="https"&&$h(t)}function GDe(t){return t!=null&&rme.test(t)||Ha.scheme==="http"&&$h(t)}function jDe(t){return t!=null&&PDe.test(t)}function wY(t){return $h(t)?`https:${t}`:t.replace(rme,"https:")}function HDe(){return Ha.scheme==="http"}function NV(){return Ha.scheme==="https"}function M4(t,e=!1){return $h(t)?t.slice(2):(t=t.replace(tme,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function qDe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function v6(t){let e=0;if(Rl(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function jPt(t,e){if(!t)return"";const r=$s(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function WDe(t){return t.endsWith("/")?t:`${t}/`}function b6(t){return t.replace(/\/+$/,"")}function YDe(t){if(/^https?:\/\//i.test(t)){const e=gY(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function XDe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function ZDe(t){const e=BE.httpsDomains;if(!GDe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),MDe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return HDe()&&i===Ha.authority&&!ODe.test(t)||(NV()&&i===Ha.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||NV()&&!_6(t))&&(t=wY(t)),t}function FV(t,e,r){if(!(e&&r&&t&&Rl(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function kV(t){return typeof t=="string"?new XT(au(t)):(t.scheme||(t.scheme=Ha.scheme),t)}function lme(t){return KDe.test(t)}function cme(t,e){const r=$s(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function JDe(t,e,r){const i=$s(t),s=i.query||{};return s[e]=String(r),`${i.path}?${xw(s)}`}function em(t,e){if(!e)return t;const r=$s(t),i=r.query||{};for(const[n,o]of Object.entries(e))o!=null&&(i[n]=o);const s=xw(i);return s?`${r.path}?${s}`:r.path}function HPt(t){if(t==null)return null;const e=t.match(ume);return e?e[2]:null}function $ee(t){if(t==null)return null;const e=t.match(ume);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function qPt(t){return typeof t=="string"?D_(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(D_(i.result)),i.onerror=s=>r(s)})}const ume=/([^.]*)\.([^\/]*)$/,KDe=/(^data:image\/svg|\.svg$)/i,hme="20240321",dme="9cf5a4b8555fda94595b625a40b922e012baf071";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const QDe="4.29";let Jr,xY=QDe;xY="4.29.10";function WPt(t){Jr=t}function YPt(t){const e=Jr==null?void 0:Jr.findCredential(t);return e!=null&&e.token?JDe(t,"token",e.token):t}se("host-webworker");const eNe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function pme(t){const e=dp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!eNe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function fme(t,e,r=!1,i){return new Promise((s,n)=>{if(Zs(i))return void n(Iee());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(Iee())};const c=()=>{se("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),se("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Iee(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const mme="Timeout exceeded";function tNe(){return new Error(mme)}function XPt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===mme}function rNe(t){ii.request.crossOriginNoCorsDomains||(ii.request.crossOriginNoCorsDomains={});const e=ii.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[dp(r)??""]=0:(e[dp("http://"+r)??""]=0,e[dp("https://"+r)??""]=0)}function iNe(t){const e=ii.request.crossOriginNoCorsDomains;if(e){let r=dp(t);if(r)return r=r.toLowerCase(),!LS(r,fY())&&e[r]<Date.now()-36e5}return!1}async function sNe(t){var s;const e=ii.request.crossOriginNoCorsDomains,r=dp(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=$s(t);t=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Wr(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=mY(e.query.toString().replaceAll("+"," ")));const r=Cm(t),i=DS(t);i||r||(t=mu(t));const s={url:t,requestOptions:{...e}};let n=ome(t);if(n){const u=await dNe(n,s);if(u!=null)return{data:u,getAllHeaders:NS,getHeader:NS,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(se("host-webworker")||se("host-node")))throw tm("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw tm("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw tm("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await cNe(),O4)return O4.execute(t,e);const o=new AbortController;lo(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Fd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await fNe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let O4;const Fd=ii.request,gme="FormData"in globalThis,nNe=new Set([499,498,403,401]),oNe=new Set(["COM_0056","COM_0057","SB_0008"]),aNe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],NS=()=>null,R4=Symbol();function lNe(t){const e=dp(t);e&&!Wr._corsServers.includes(e)&&Wr._corsServers.push(e)}function Lee(t){const e=dp(t);return!e||e.endsWith(".arcgis.com")||Wr._corsServers.includes(e)||yY(e)}function tm(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getAllHeaders:NS,getHeader:NS,ssl:!1};if(e instanceof J)return e.details?(e.details=ge(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(()=>Array.from(i.headers)),a=i&&(u=>i.headers.get(u)),l=i==null?void 0:i.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=R4 in e?e[R4]:e}return ns(e)?hr():new J(t,s,n)}async function cNe(){se("host-webworker")&&!O4&&(O4=await me(()=>import("./request-BCVun0Zs.js"),[]))}async function UV(){Jr||await me(()=>import("./IdentityManager-W7gdkvxR.js"),__vite__mapDeps([0,1]))}async function uNe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(gme&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Fd.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&ii.apiKey&&pme(e)&&(r.query||(r.query={}),r.query.token=ii.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!yme(e)&&!Zs(i)){let l;r.authMode==="immediate"?(await UV(),l=await Jr.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await UV(),l=await Jr.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Jr&&(l=Jr.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function yme(t){return aNe.some(e=>e.test(t))}async function hNe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=DS(e)||Cm(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Fd.timeout;let a=!1;if(!s){t.useSSL&&(e=wY(e));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let f=xw(p);se("esri-url-encodes-apostrophe")&&(f=f.replaceAll("'","%27"));const g=e.length+1+f.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>Fd.maxUrlLength;const v=r.useProxy||!!_6(e);if(v){const b=NDe(e);_=b.path,!a&&_.length+1+g>Fd.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw g>Fd.maxUrlLength?tm("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):tm("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw tm("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=em(e,p):(i.body=xw(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=em(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&gme&&i.body instanceof FormData&&!SDe(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!LS(e,fY())){if(yY(e))t.withCredentials=!0;else if(Jr){const b=Jr.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",iNe(e)&&await sNe(a?em(e,p):e))}let l,c,u=0,h=!1;o>0&&(u=setTimeout(()=>{h=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||pNe(r.headers)||!s&&!t.useProxy&&Fd.proxyUrl&&!Lee(e)){if(Wr._beforeFetch&&await Wr._beforeFetch(e,i),l=await fetch(e,i),Wr._afterFetch&&await Wr._afterFetch(l),t.useProxy||lNe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Dee(c,"application/xml");break;case"document":c=Dee(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const f=await new Response(c).json();f.error&&(c=f)}catch{}}n==="image"&&c instanceof Blob&&(c=await Nee(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Nee(e,t)}catch(p){if(p.name==="AbortError")throw h?tNe():hr("Request canceled");if(!(!l&&p instanceof TypeError&&Fd.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Lee(e))throw p;t.redoRequest=!0,FDe({proxyUrl:Fd.proxyUrl,urlPrefix:dp(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function dNe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=tm("request:interceptor",s,e)}if((i instanceof Error||i instanceof J)&&(r=tm("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function pNe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Dee(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function fNe(t){var n,o;let e,r;await uNe(t);try{do[e,r]=await hNe(t);while(!await mNe(t,e,r))}catch(a){const l=tm("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!yY(i)){const a=dp(i,!0);a&&Fd.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&rNe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Jr){const a=Jr.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Jr.findCredential(l,s.userId);c&&Jr._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getAllHeaders:e?()=>Array.from(e.headers):NS,getHeader:e?a=>e.headers.get(a):NS,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function mNe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[R4]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[R4]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&nNe.has(n)&&!yme(t.params.url)&&(n!==403||(!o||!oNe.has(o))&&(a==null||a===2&&t.credentialToken))){await UV();try{const u=await Jr.getCredential(t.params.url,{error:tm("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function Nee(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Fd.priority,s.src=t,fme(s,t,r,i)}Wr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Wr._beforeFetch=void 0,Wr._afterFetch=void 0;function gNe(t,e){return Wr(ai(t),e)}function ai(t){if(!ii.assetsPath)throw ae.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new J("assets:path-not-set","config.assetsPath is not set");return Tw(ii.assetsPath,t)}let X8,ne=null;function _me(){return!!ne}function yNe(){return!!se("esri-wasm")}function vme(){return X8||(X8=me(()=>import("./pe-wasm-BzAVcFBU.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>ai(`esri/geometry/support/${e}`)})).then(t=>{wme(t)}),X8)}var zV,Fs,BV;(function(t){function e(n,o,a){ne.ensureCache.prepare();const l=ub(a),c=a===l,u=ne.ensureFloat64(l),h=ne._pe_geog_to_proj(ne.getPointer(n),o,u);return h&&Ky(a,o,u,c),h}function r(n,o,a,l){switch(l){case Fs.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Fs.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ne.ensureCache.prepare();const c=ub(a),u=a===c,h=ne.ensureFloat64(c),p=ne._pe_proj_to_geog_center(ne.getPointer(n),o,h,l);return p&&Ky(a,o,h,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(zV||(zV={})),function(t){function e(){t.PE_BUFFER_MAX=ne.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ne.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ne.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ne.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ne.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ne.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ne.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ne.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ne.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ne.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ne.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ne.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ne.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ne.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ne.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ne.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ne.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ne.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ne.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ne.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=ne.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=ne.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=ne.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ne.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ne.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ne.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ne.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ne.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ne.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ne.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ne.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ne.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Fs||(Fs={})),function(t){const e={},r={},i=f=>{if(f){const g=f.getType();switch(g){case Fs.PE_TYPE_GEOGCS:f=ne.castObject(f,ne.PeGeogcs);break;case Fs.PE_TYPE_PROJCS:f=ne.castObject(f,ne.PeProjcs);break;case Fs.PE_TYPE_GEOGTRAN:f=ne.castObject(f,ne.PeGeogtran);break;default:g&Fs.PE_TYPE_UNIT&&(f=ne.castObject(f,ne.PeUnit))}}return f};function s(){ne.PeFactory.prototype.initialize(null)}function n(f){return o(Fs.PE_TYPE_COORDSYS,f)}function o(f,g){let _=null,v=e[f];if(v||(v={},e[f]=v),v.hasOwnProperty(String(g)))_=v[g];else{const b=ne.PeFactory.prototype.factoryByType(f,g);ne.compare(b,ne.NULL)||(_=b,v[g]=_)}return _=i(_),_}function a(f,g){let _=null,v=r[f];if(v||(v={},r[f]=v),v.hasOwnProperty(g))_=v[g];else{const b=ne.PeFactory.prototype.fromString(f,g);ne.compare(b,ne.NULL)||(_=b,v[g]=_)}return _=i(_),_}function l(f){return o(Fs.PE_TYPE_GEOGCS,f)}function c(f){return o(Fs.PE_TYPE_GEOGTRAN,f)}function u(f){return ne.PeFactory.prototype.getCode(f)}function h(f){return o(Fs.PE_TYPE_PROJCS,f)}function p(f){return o(Fs.PE_TYPE_UNIT,f)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=h,t.unit=p}(BV||(BV={}));let bme=null;var $4,VV,GV,jV,I4,HV,L4,D4,qV;function wme(t){function e(n,o,a){n[o]=a(n[o])}ne=t,Fs.init(),$4.init(),I4.init(),L4.init(),D4.init(),bme=class extends ne.PeGCSExtent{destroy(){ne.destroy(this)}};const r=[ne.PeDatum,ne.PeGeogcs,ne.PeGeogtran,ne.PeObject,ne.PeParameter,ne.PePrimem,ne.PeProjcs,ne.PeSpheroid,ne.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Fs.PE_NAME_MAX))});for(const n of[ne.PeGeogtran,ne.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Fs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ne.getValue(l,"*");a[c]=u?ne.wrapPointer(u,ne.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ne.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Ky(a,o,n.call(this)),a}),e(ne.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ne._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ne.getPointer(l);for(let h=1;h<c;h++)a.push(ne.wrapPointer(u+o*h,ne.PeGTlistExtendedGTs))}}return a}});const i=ne._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ne.getPointer(l);for(let h=1;h<c;h++)a.push(ne.wrapPointer(u+i*h,ne.PeHorizon))}}return o.set(n,a),a};e(ne.PeProjcs.prototype,"horizonGcsGenerate",s),e(ne.PeProjcs.prototype,"horizonPcsGenerate",s),ne.PeObject.prototype.toString=function(n=Fs.PE_STR_OPTS_NONE){ne.ensureCache.prepare();const o=ne.getPointer(this),a=ne.ensureInt8(new Array(Fs.PE_BUFFER_MAX));return ne.UTF8ToString(ne._pe_object_to_string_ext(o,n,a))}}function Um(t){if(!t)return;const e=ne.getClass(t);if(!e)return;const r=ne.getCache(e);if(!r)return;const i=ne.getPointer(t);i&&delete r[i]}function s$(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(ne.ensureInt8(i));return r}function ub(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function Ky(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=ne.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ne.getValue(r,"double"),t[n][1]=ne.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ne.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ne._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let u=null;const h=new ne.PeInteger(c);try{const p=ne.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,h);if((c=h.val)&&(u=[p],c>1)){const f=ne.getPointer(p);for(let g=1;g<c;g++)u.push(ne.wrapPointer(f+e*g,ne.PeGTlistExtendedEntry))}}finally{ne.destroy(h)}return u}t.init=r,t.getGTlist=i})($4||($4={})),function(t){function e(r){if(r!=null&&r.length){for(const i of r)Um(i),i.getEntries().forEach(s=>{Um(s);const n=s.getGeogtran();Um(n),n.getParameters().forEach(Um),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Um(o);const a=o.getDatum();Um(a),Um(a.getSpheroid()),Um(o.getPrimem()),Um(o.getUnit())})});ne.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(VV||(VV={})),function(t){function e(r,i,s,n,o){ne.ensureCache.prepare();const a=ub(s),l=s===a,c=ne.ensureFloat64(a);let u=0;n&&(u=ne.ensureFloat64(n));const h=ne._pe_geog_to_geog(ne.getPointer(r),i,c,u,o);return h&&Ky(s,i,c,l),h}t.geogToGeog=e}(GV||(GV={})),function(t){const e=(c,u,h,p,f,g)=>{let _,v;switch(ne.ensureCache.prepare(),c){case"dd":_=ne._pe_geog_to_dd,v=Fs.PE_DD_MAX;break;case"ddm":_=ne._pe_geog_to_ddm,v=Fs.PE_DDM_MAX;break;case"dms":_=ne._pe_geog_to_dms,v=Fs.PE_DMS_MAX}let b=0;u&&(b=ne.getPointer(u));const w=ub(p),T=ne.ensureFloat64(w),S=s$(h,v),C=_(b,h,T,f,ne.ensureInt32(S));if(C)for(let P=0;P<h;P++)g[P]=ne.UTF8ToString(S[P]);return C},r=(c,u,h,p,f)=>{let g;switch(ne.ensureCache.prepare(),c){case"dd":g=ne._pe_dd_to_geog;break;case"ddm":g=ne._pe_ddm_to_geog;break;case"dms":g=ne._pe_dms_to_geog}let _=0;u&&(_=ne.getPointer(u));const v=p.map(S=>ne.ensureString(S)),b=ne.ensureInt32(v),w=ne.ensureFloat64(new Array(2*h)),T=g(_,h,b,w);return T&&Ky(f,h,w),T};function i(c,u,h,p,f){return e("dms",c,u,h,p,f)}function s(c,u,h,p){return r("dms",c,u,h,p)}function n(c,u,h,p,f){return e("ddm",c,u,h,p,f)}function o(c,u,h,p){return r("ddm",c,u,h,p)}function a(c,u,h,p,f){return e("dd",c,u,h,p,f)}function l(c,u,h,p){return r("dd",c,u,h,p)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(jV||(jV={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ne.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ne.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,u){ne.ensureCache.prepare();let h=0;s&&(h=ne.getPointer(s));const p=ub(o),f=ne.ensureFloat64(p),g=s$(n,Fs.PE_MGRS_MAX),_=ne.ensureInt32(g),v=ne._pe_geog_to_mgrs_extended(h,n,f,a,l,c,_);if(v)for(let b=0;b<n;b++)u[b]=ne.UTF8ToString(g[b]);return v}function i(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const u=o.map(g=>ne.ensureString(g)),h=ne.ensureInt32(u),p=ne.ensureFloat64(new Array(2*n)),f=ne._pe_mgrs_to_geog_extended(c,n,h,a,p);return f&&Ky(l,n,p),f}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(I4||(I4={})),function(t){function e(i,s,n,o,a,l,c){ne.ensureCache.prepare();let u=0;i&&(u=ne.getPointer(i));const h=ub(n),p=ne.ensureFloat64(h),f=s$(s,Fs.PE_MGRS_MAX),g=ne.ensureInt32(f),_=ne._pe_geog_to_usng(u,s,p,o,a,l,g);if(_)for(let v=0;v<s;v++)c[v]=ne.UTF8ToString(f[v]);return _}function r(i,s,n,o){ne.ensureCache.prepare();let a=0;i&&(a=ne.getPointer(i));const l=n.map(p=>ne.ensureString(p)),c=ne.ensureInt32(l),u=ne.ensureFloat64(new Array(2*s)),h=ne._pe_usng_to_geog(a,s,c,u);return h&&Ky(o,s,u),h}t.geogToUsng=e,t.usngToGeog=r}(HV||(HV={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ne.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const u=ub(o),h=ne.ensureFloat64(u),p=s$(n,Fs.PE_UTM_MAX),f=ne.ensureInt32(p),g=ne._pe_geog_to_utm(c,n,h,a,f);if(g)for(let _=0;_<n;_++)l[_]=ne.UTF8ToString(p[_]);return g}function i(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const u=o.map(g=>ne.ensureString(g)),h=ne.ensureInt32(u),p=ne.ensureFloat64(new Array(2*n)),f=ne._pe_utm_to_geog(c,n,h,a,p);return f&&Ky(l,n,p),f}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(L4||(L4={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ne.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ne.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=ne.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(D4||(D4={})),function(t){function e(){return ne.PeVersion.prototype.version_string()}t.versionString=e}(qV||(qV={}));const _Ne=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return zV},get PeDefs(){return Fs},get PeFactory(){return BV},get PeGCSExtent(){return bme},get PeGTTransformations(){return GV},get PeGTlistExtended(){return $4},get PeGTlistExtendedEntry(){return VV},get PeNotationDms(){return jV},get PeNotationMgrs(){return I4},get PeNotationUsng(){return HV},get PeNotationUtm(){return L4},get PePCSInfo(){return D4},get PeVersion(){return qV},_init:wme,get _pe(){return ne},isLoaded:_me,isSupported:yNe,load:vme},Symbol.toStringTag,{value:"Module"}));var gh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(gh||(gh={}));let y;const D={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(y=2e3;y<=2045;y++)D[y]=0;for(y=2056;y<=2065;y++)D[y]=0;for(y=2067;y<=2135;y++)D[y]=0;for(y=2137;y<=2154;y++)D[y]=0;for(y=2161;y<=2170;y++)D[y]=0;for(y=2172;y<=2193;y++)D[y]=0;for(y=2195;y<=2198;y++)D[y]=0;for(y=2200;y<=2203;y++)D[y]=0;for(y=2205;y<=2217;y++)D[y]=0;for(y=2222;y<=2224;y++)D[y]=1;for(y=2225;y<=2250;y++)D[y]=2;for(y=2251;y<=2253;y++)D[y]=1;for(y=2257;y<=2264;y++)D[y]=2;for(y=2274;y<=2279;y++)D[y]=2;for(y=2280;y<=2282;y++)D[y]=1;for(y=2283;y<=2289;y++)D[y]=2;for(y=2290;y<=2292;y++)D[y]=0;for(y=2308;y<=2313;y++)D[y]=0;for(y=2315;y<=2491;y++)D[y]=0;for(y=2494;y<=2866;y++)D[y]=0;for(y=2867;y<=2869;y++)D[y]=1;for(y=2870;y<=2888;y++)D[y]=2;for(y=2891;y<=2895;y++)D[y]=2;for(y=2896;y<=2898;y++)D[y]=1;for(y=2902;y<=2908;y++)D[y]=2;for(y=2915;y<=2920;y++)D[y]=2;for(y=2921;y<=2923;y++)D[y]=1;for(y=2924;y<=2930;y++)D[y]=2;for(y=2931;y<=2962;y++)D[y]=0;for(y=2964;y<=2968;y++)D[y]=2;for(y=2969;y<=2973;y++)D[y]=0;for(y=2975;y<=2991;y++)D[y]=0;for(y=2995;y<=3051;y++)D[y]=0;for(y=3054;y<=3079;y++)D[y]=0;for(y=3081;y<=3088;y++)D[y]=0;for(y=3092;y<=3101;y++)D[y]=0;for(y=3106;y<=3138;y++)D[y]=0;for(y=3146;y<=3151;y++)D[y]=0;for(y=3153;y<=3166;y++)D[y]=0;for(y=3168;y<=3172;y++)D[y]=0;for(y=3174;y<=3203;y++)D[y]=0;for(y=3294;y<=3358;y++)D[y]=0;for(y=3367;y<=3403;y++)D[y]=0;for(y=3408;y<=3416;y++)D[y]=0;for(y=3417;y<=3438;y++)D[y]=2;for(y=3441;y<=3446;y++)D[y]=2;for(y=3447;y<=3450;y++)D[y]=0;for(y=3451;y<=3459;y++)D[y]=2;for(y=3460;y<=3478;y++)D[y]=0;for(y=3554;y<=3559;y++)D[y]=0;for(y=3560;y<=3570;y++)D[y]=2;for(y=3571;y<=3581;y++)D[y]=0;for(y=3594;y<=3597;y++)D[y]=0;for(y=3601;y<=3604;y++)D[y]=0;for(y=3637;y<=3639;y++)D[y]=0;for(y=3665;y<=3667;y++)D[y]=0;for(y=3693;y<=3695;y++)D[y]=0;for(y=3701;y<=3727;y++)D[y]=0;for(y=3728;y<=3739;y++)D[y]=2;for(y=3740;y<=3751;y++)D[y]=0;for(y=3753;y<=3760;y++)D[y]=2;for(y=3761;y<=3773;y++)D[y]=0;for(y=3775;y<=3777;y++)D[y]=0;for(y=3779;y<=3781;y++)D[y]=0;for(y=3783;y<=3785;y++)D[y]=0;for(y=3788;y<=3791;y++)D[y]=0;for(y=3797;y<=3802;y++)D[y]=0;for(y=3814;y<=3816;y++)D[y]=0;for(y=3825;y<=3829;y++)D[y]=0;for(y=3832;y<=3841;y++)D[y]=0;for(y=3844;y<=3852;y++)D[y]=0;for(y=3873;y<=3885;y++)D[y]=0;for(y=3890;y<=3893;y++)D[y]=0;for(y=3907;y<=3912;y++)D[y]=0;for(y=3942;y<=3950;y++)D[y]=0;for(y=3968;y<=3970;y++)D[y]=0;for(y=3973;y<=3976;y++)D[y]=0;for(y=3986;y<=3989;y++)D[y]=0;for(y=3994;y<=3997;y++)D[y]=0;for(y=4048;y<=4051;y++)D[y]=0;for(y=4056;y<=4063;y++)D[y]=0;for(y=4093;y<=4096;y++)D[y]=0;for(y=4390;y<=4398;y++)D[y]=0;for(y=4399;y<=4413;y++)D[y]=2;for(y=4418;y<=4433;y++)D[y]=2;for(y=4455;y<=4457;y++)D[y]=2;for(y=4484;y<=4489;y++)D[y]=0;for(y=4491;y<=4554;y++)D[y]=0;for(y=4568;y<=4589;y++)D[y]=0;for(y=4652;y<=4656;y++)D[y]=0;for(y=4766;y<=4800;y++)D[y]=0;for(y=5014;y<=5016;y++)D[y]=0;for(y=5069;y<=5072;y++)D[y]=0;for(y=5105;y<=5130;y++)D[y]=0;for(y=5167;y<=5188;y++)D[y]=0;for(y=5253;y<=5259;y++)D[y]=0;for(y=5269;y<=5275;y++)D[y]=0;for(y=5292;y<=5311;y++)D[y]=0;for(y=5329;y<=5331;y++)D[y]=0;for(y=5343;y<=5349;y++)D[y]=0;for(y=5355;y<=5357;y++)D[y]=0;for(y=5387;y<=5389;y++)D[y]=0;for(y=5459;y<=5463;y++)D[y]=0;for(y=5479;y<=5482;y++)D[y]=0;for(y=5518;y<=5520;y++)D[y]=0;for(y=5530;y<=5539;y++)D[y]=0;for(y=5550;y<=5552;y++)D[y]=0;for(y=5562;y<=5583;y++)D[y]=0;for(y=5623;y<=5625;y++)D[y]=2;for(y=5631;y<=5639;y++)D[y]=0;for(y=5649;y<=5653;y++)D[y]=0;for(y=5663;y<=5680;y++)D[y]=0;for(y=5682;y<=5685;y++)D[y]=0;for(y=5875;y<=5877;y++)D[y]=0;for(y=5896;y<=5899;y++)D[y]=0;for(y=5921;y<=5940;y++)D[y]=0;for(y=6050;y<=6125;y++)D[y]=0;for(y=6244;y<=6275;y++)D[y]=0;for(y=6328;y<=6348;y++)D[y]=0;for(y=6350;y<=6356;y++)D[y]=0;for(y=6366;y<=6372;y++)D[y]=0;for(y=6381;y<=6387;y++)D[y]=0;for(y=6393;y<=6404;y++)D[y]=0;for(y=6480;y<=6483;y++)D[y]=0;for(y=6511;y<=6514;y++)D[y]=0;for(y=6579;y<=6581;y++)D[y]=0;for(y=6619;y<=6624;y++)D[y]=0;for(y=6625;y<=6627;y++)D[y]=2;for(y=6628;y<=6632;y++)D[y]=0;for(y=6634;y<=6637;y++)D[y]=0;for(y=6669;y<=6692;y++)D[y]=0;for(y=6707;y<=6709;y++)D[y]=0;for(y=6720;y<=6723;y++)D[y]=0;for(y=6732;y<=6738;y++)D[y]=0;for(y=6931;y<=6933;y++)D[y]=0;for(y=6956;y<=6959;y++)D[y]=0;for(y=7005;y<=7007;y++)D[y]=0;for(y=7057;y<=7070;y++)D[y]=2;for(y=7074;y<=7082;y++)D[y]=0;for(y=7109;y<=7118;y++)D[y]=0;for(y=7119;y<=7127;y++)D[y]=1;for(y=7374;y<=7376;y++)D[y]=0;for(y=7528;y<=7586;y++)D[y]=0;for(y=7587;y<=7645;y++)D[y]=2;for(y=7692;y<=7696;y++)D[y]=0;for(y=7755;y<=7787;y++)D[y]=0;for(y=7791;y<=7795;y++)D[y]=0;for(y=7799;y<=7801;y++)D[y]=0;for(y=7803;y<=7805;y++)D[y]=0;for(y=7825;y<=7831;y++)D[y]=0;for(y=7845;y<=7859;y++)D[y]=0;for(y=8013;y<=8032;y++)D[y]=0;for(y=8065;y<=8068;y++)D[y]=1;for(y=8518;y<=8529;y++)D[y]=2;for(y=8533;y<=8536;y++)D[y]=2;for(y=8538;y<=8540;y++)D[y]=2;for(y=8677;y<=8679;y++)D[y]=0;for(y=8836;y<=8840;y++)D[y]=0;for(y=8857;y<=8859;y++)D[y]=0;for(y=8908;y<=8910;y++)D[y]=0;for(y=9154;y<=9159;y++)D[y]=0;for(y=9205;y<=9218;y++)D[y]=0;for(y=9271;y<=9273;y++)D[y]=0;for(y=9295;y<=9297;y++)D[y]=0;for(y=9356;y<=9360;y++)D[y]=0;for(y=9404;y<=9407;y++)D[y]=0;for(y=9476;y<=9482;y++)D[y]=0;for(y=9487;y<=9494;y++)D[y]=0;for(y=9697;y<=9699;y++)D[y]=0;for(y=9821;y<=9865;y++)D[y]=0;for(y=10285;y<=10291;y++)D[y]=0;for(y=10314;y<=10317;y++)D[y]=0;for(y=10448;y<=10465;y++)D[y]=0;for(y=11114;y<=11118;y++)D[y]=0;for(y=20004;y<=20032;y++)D[y]=0;for(y=20047;y<=20049;y++)D[y]=0;for(y=20062;y<=20092;y++)D[y]=0;for(y=20135;y<=20138;y++)D[y]=0;for(y=20248;y<=20258;y++)D[y]=0;for(y=20348;y<=20358;y++)D[y]=0;for(y=20436;y<=20440;y++)D[y]=0;for(y=20822;y<=20824;y++)D[y]=0;for(y=20904;y<=20932;y++)D[y]=0;for(y=20934;y<=20936;y++)D[y]=0;for(y=21004;y<=21032;y++)D[y]=0;for(y=21035;y<=21037;y++)D[y]=0;for(y=21095;y<=21097;y++)D[y]=0;for(y=21148;y<=21150;y++)D[y]=0;for(y=21207;y<=21264;y++)D[y]=0;for(y=21307;y<=21364;y++)D[y]=0;for(y=21413;y<=21423;y++)D[y]=0;for(y=21453;y<=21463;y++)D[y]=0;for(y=21473;y<=21483;y++)D[y]=0;for(y=21780;y<=21782;y++)D[y]=0;for(y=21891;y<=21894;y++)D[y]=0;for(y=21896;y<=21899;y++)D[y]=0;for(y=22171;y<=22177;y++)D[y]=0;for(y=22181;y<=22187;y++)D[y]=0;for(y=22191;y<=22197;y++)D[y]=0;for(y=22207;y<=22222;y++)D[y]=0;for(y=22229;y<=22232;y++)D[y]=0;for(y=22234;y<=22236;y++)D[y]=0;for(y=22243;y<=22250;y++)D[y]=0;for(y=22262;y<=22265;y++)D[y]=0;for(y=22307;y<=22322;y++)D[y]=0;for(y=22348;y<=22357;y++)D[y]=0;for(y=22407;y<=22422;y++)D[y]=0;for(y=22462;y<=22465;y++)D[y]=0;for(y=22521;y<=22525;y++)D[y]=0;for(y=22607;y<=22622;y++)D[y]=0;for(y=22641;y<=22646;y++)D[y]=0;for(y=22648;y<=22657;y++)D[y]=0;for(y=22707;y<=22722;y++)D[y]=0;for(y=22762;y<=22765;y++)D[y]=0;for(y=22807;y<=22822;y++)D[y]=0;for(y=22991;y<=22994;y++)D[y]=0;for(y=23028;y<=23038;y++)D[y]=0;for(y=23301;y<=23333;y++)D[y]=2;for(y=23830;y<=23853;y++)D[y]=0;for(y=23866;y<=23872;y++)D[y]=0;for(y=23877;y<=23884;y++)D[y]=0;for(y=23886;y<=23894;y++)D[y]=0;for(y=23946;y<=23948;y++)D[y]=0;for(y=24311;y<=24313;y++)D[y]=0;for(y=24342;y<=24347;y++)D[y]=0;for(y=24370;y<=24374;y++)D[y]=10;for(y=24375;y<=24381;y++)D[y]=0;for(y=24718;y<=24721;y++)D[y]=0;for(y=24817;y<=24821;y++)D[y]=0;for(y=24877;y<=24882;y++)D[y]=0;for(y=24891;y<=24893;y++)D[y]=0;for(y=25391;y<=25395;y++)D[y]=0;for(y=25828;y<=25838;y++)D[y]=0;for(y=26191;y<=26195;y++)D[y]=0;for(y=26391;y<=26393;y++)D[y]=0;for(y=26701;y<=26722;y++)D[y]=0;for(y=26729;y<=26799;y++)D[y]=2;for(y=26801;y<=26803;y++)D[y]=2;for(y=26811;y<=26813;y++)D[y]=2;for(y=26847;y<=26870;y++)D[y]=2;for(y=26891;y<=26899;y++)D[y]=0;for(y=26901;y<=26923;y++)D[y]=0;for(y=26929;y<=26946;y++)D[y]=0;for(y=26948;y<=26998;y++)D[y]=0;for(y=27037;y<=27040;y++)D[y]=0;for(y=27205;y<=27232;y++)D[y]=0;for(y=27258;y<=27260;y++)D[y]=0;for(y=27391;y<=27398;y++)D[y]=0;for(y=27561;y<=27564;y++)D[y]=0;for(y=27571;y<=27574;y++)D[y]=0;for(y=27581;y<=27584;y++)D[y]=0;for(y=27591;y<=27594;y++)D[y]=0;for(y=28191;y<=28193;y++)D[y]=0;for(y=28348;y<=28358;y++)D[y]=0;for(y=28402;y<=28432;y++)D[y]=0;for(y=28462;y<=28492;y++)D[y]=0;for(y=29118;y<=29122;y++)D[y]=0;for(y=29168;y<=29172;y++)D[y]=0;for(y=29177;y<=29185;y++)D[y]=0;for(y=29187;y<=29195;y++)D[y]=0;for(y=29900;y<=29903;y++)D[y]=0;for(y=30161;y<=30179;y++)D[y]=0;for(y=30491;y<=30494;y++)D[y]=0;for(y=30729;y<=30732;y++)D[y]=0;for(y=31251;y<=31259;y++)D[y]=0;for(y=31265;y<=31268;y++)D[y]=0;for(y=31275;y<=31279;y++)D[y]=0;for(y=31281;y<=31297;y++)D[y]=0;for(y=31461;y<=31469;y++)D[y]=0;for(y=31491;y<=31495;y++)D[y]=0;for(y=31917;y<=31922;y++)D[y]=0;for(y=31965;y<=32e3;y++)D[y]=0;for(y=32001;y<=32003;y++)D[y]=2;for(y=32005;y<=32031;y++)D[y]=2;for(y=32033;y<=32060;y++)D[y]=2;for(y=32064;y<=32067;y++)D[y]=2;for(y=32074;y<=32077;y++)D[y]=2;for(y=32081;y<=32086;y++)D[y]=0;for(y=32107;y<=32130;y++)D[y]=0;for(y=32133;y<=32159;y++)D[y]=0;for(y=32164;y<=32167;y++)D[y]=2;for(y=32180;y<=32199;y++)D[y]=0;for(y=32201;y<=32260;y++)D[y]=0;for(y=32301;y<=32360;y++)D[y]=0;for(y=32401;y<=32460;y++)D[y]=0;for(y=32501;y<=32560;y++)D[y]=0;for(y=32601;y<=32662;y++)D[y]=0;for(y=32664;y<=32667;y++)D[y]=2;for(y=32701;y<=32761;y++)D[y]=0;for(y=53001;y<=53004;y++)D[y]=0;for(y=53008;y<=53019;y++)D[y]=0;for(y=53021;y<=53032;y++)D[y]=0;for(y=53034;y<=53037;y++)D[y]=0;for(y=53042;y<=53046;y++)D[y]=0;for(y=53074;y<=53080;y++)D[y]=0;for(y=54001;y<=54004;y++)D[y]=0;for(y=54008;y<=54019;y++)D[y]=0;for(y=54021;y<=54032;y++)D[y]=0;for(y=54034;y<=54037;y++)D[y]=0;for(y=54042;y<=54046;y++)D[y]=0;for(y=54048;y<=54053;y++)D[y]=0;for(y=54074;y<=54080;y++)D[y]=0;for(y=54098;y<=54101;y++)D[y]=0;for(y=102001;y<=102040;y++)D[y]=0;for(y=102042;y<=102063;y++)D[y]=0;for(y=102065;y<=102067;y++)D[y]=0;for(y=102070;y<=102117;y++)D[y]=0;for(y=102122;y<=102216;y++)D[y]=0;for(y=102221;y<=102377;y++)D[y]=0;for(y=102382;y<=102388;y++)D[y]=0;for(y=102389;y<=102398;y++)D[y]=2;for(y=102399;y<=102444;y++)D[y]=0;for(y=102445;y<=102447;y++)D[y]=2;for(y=102448;y<=102458;y++)D[y]=0;for(y=102459;y<=102468;y++)D[y]=2;for(y=102469;y<=102499;y++)D[y]=0;for(y=102500;y<=102519;y++)D[y]=1;for(y=102520;y<=102524;y++)D[y]=0;for(y=102525;y<=102529;y++)D[y]=2;for(y=102530;y<=102588;y++)D[y]=0;for(y=102590;y<=102598;y++)D[y]=0;for(y=102601;y<=102603;y++)D[y]=0;for(y=102605;y<=102628;y++)D[y]=0;for(y=102629;y<=102646;y++)D[y]=2;for(y=102648;y<=102700;y++)D[y]=2;for(y=102701;y<=102703;y++)D[y]=0;for(y=102707;y<=102730;y++)D[y]=2;for(y=102733;y<=102758;y++)D[y]=2;for(y=102767;y<=102900;y++)D[y]=0;for(y=102901;y<=102933;y++)D[y]=2;for(y=102934;y<=102950;y++)D[y]=13;for(y=102951;y<=102955;y++)D[y]=0;for(y=102961;y<=102963;y++)D[y]=0;for(y=102965;y<=102969;y++)D[y]=0;for(y=102971;y<=102973;y++)D[y]=0;for(y=102975;y<=102989;y++)D[y]=0;for(y=102990;y<=102992;y++)D[y]=1;for(y=102997;y<=103002;y++)D[y]=0;for(y=103003;y<=103008;y++)D[y]=2;for(y=103009;y<=103011;y++)D[y]=0;for(y=103012;y<=103014;y++)D[y]=2;for(y=103019;y<=103021;y++)D[y]=0;for(y=103022;y<=103024;y++)D[y]=2;for(y=103029;y<=103031;y++)D[y]=0;for(y=103032;y<=103034;y++)D[y]=2;for(y=103065;y<=103068;y++)D[y]=0;for(y=103074;y<=103076;y++)D[y]=0;for(y=103077;y<=103079;y++)D[y]=1;for(y=103080;y<=103082;y++)D[y]=0;for(y=103083;y<=103085;y++)D[y]=2;for(y=103090;y<=103093;y++)D[y]=0;for(y=103097;y<=103099;y++)D[y]=0;for(y=103100;y<=103102;y++)D[y]=2;for(y=103107;y<=103109;y++)D[y]=0;for(y=103110;y<=103112;y++)D[y]=2;for(y=103113;y<=103116;y++)D[y]=0;for(y=103117;y<=103120;y++)D[y]=2;for(y=103153;y<=103157;y++)D[y]=0;for(y=103158;y<=103162;y++)D[y]=2;for(y=103163;y<=103165;y++)D[y]=0;for(y=103166;y<=103168;y++)D[y]=1;for(y=103169;y<=103171;y++)D[y]=2;for(y=103186;y<=103188;y++)D[y]=0;for(y=103189;y<=103191;y++)D[y]=2;for(y=103192;y<=103195;y++)D[y]=0;for(y=103196;y<=103199;y++)D[y]=2;for(y=103200;y<=103224;y++)D[y]=0;for(y=103225;y<=103227;y++)D[y]=1;for(y=103232;y<=103237;y++)D[y]=0;for(y=103238;y<=103243;y++)D[y]=2;for(y=103244;y<=103246;y++)D[y]=0;for(y=103247;y<=103249;y++)D[y]=2;for(y=103254;y<=103256;y++)D[y]=0;for(y=103257;y<=103259;y++)D[y]=2;for(y=103264;y<=103266;y++)D[y]=0;for(y=103267;y<=103269;y++)D[y]=2;for(y=103300;y<=103375;y++)D[y]=0;for(y=103381;y<=103383;y++)D[y]=0;for(y=103384;y<=103386;y++)D[y]=1;for(y=103387;y<=103389;y++)D[y]=0;for(y=103390;y<=103392;y++)D[y]=2;for(y=103397;y<=103399;y++)D[y]=0;for(y=103400;y<=103471;y++)D[y]=2;for(y=103476;y<=103478;y++)D[y]=0;for(y=103479;y<=103481;y++)D[y]=2;for(y=103486;y<=103488;y++)D[y]=0;for(y=103489;y<=103491;y++)D[y]=2;for(y=103492;y<=103495;y++)D[y]=0;for(y=103496;y<=103499;y++)D[y]=2;for(y=103528;y<=103543;y++)D[y]=0;for(y=103544;y<=103548;y++)D[y]=2;for(y=103549;y<=103551;y++)D[y]=0;for(y=103552;y<=103554;y++)D[y]=1;for(y=103555;y<=103557;y++)D[y]=2;for(y=103558;y<=103560;y++)D[y]=0;for(y=103571;y<=103573;y++)D[y]=0;for(y=103574;y<=103576;y++)D[y]=2;for(y=103577;y<=103580;y++)D[y]=0;for(y=103581;y<=103583;y++)D[y]=2;for(y=103595;y<=103694;y++)D[y]=0;for(y=103696;y<=103699;y++)D[y]=0;for(y=103700;y<=103793;y++)D[y]=2;for(y=103794;y<=103890;y++)D[y]=0;for(y=103891;y<=103896;y++)D[y]=2;for(y=103900;y<=103971;y++)D[y]=2;for(y=103972;y<=103977;y++)D[y]=0;for(y=112e3;y<=112101;y++)D[y]=0;const xme=[102100,102113,3857,3785],vNe=[104905,104971],bNe=[4326,...xme,...vNe],Fee='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',n$=[-20037508342788905e-9,20037508342788905e-9],o$=[-20037508342787e-6,20037508342787e-6],Tme={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:n$,origin:o$,dx:1e-5},102100:{wkTemplate:Fee,valid:n$,origin:o$,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:n$,origin:o$,dx:1e-5},3857:{wkTemplate:Fee,valid:n$,origin:o$,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function co(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const r=t.wkid,i=e.wkid;if(r!=null||i!=null){if(r===i||Sw(t)&&Sw(e))return!0;const o=t.latestWkid;if(o!=null&&i===o)return!0;const a=e.latestWkid;return a!=null&&r===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function pp(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&Tme[e]||null}function N4(t){if(!t)return;const{wkid:e,vcsWkid:r}=t;if(e)return r?JSON.stringify({wkid:e,vcsWkid:r}):String(e);const i=t.wkt||t.wkt2;return JSON.stringify(i?r?{wkt:i,vcsWkid:r}:{wkt:i}:{})}function TY(t){if(!qf(t))return!1;const{wkid:e}=t;if(e)return D[e]==null;const r=t.wkt2||t.wkt;return!!r&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(r)}function BM(t){return!(u1(t)||h1(t))}function VM(t){return(t==null?void 0:t.wkid)===4326}function ZPt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function Sme(t){return(t==null?void 0:t.wkid)===gh.CGCS2000}function Sw(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&xme.includes(e)}function GM(t){return(t==null?void 0:t.wkid)===32662}function FS(t){return t===gh.GCSMARS2000||t===gh.GCSMARS2000_SPHERE}function u1(t){return FS(t==null?void 0:t.wkid)}function kS(t){return t===gh.GCSMOON2000}function h1(t){return kS(t==null?void 0:t.wkid)}function wNe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&bNe.includes(e)}function qf(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const F4={wkid:4326,wkt:XW(Tme[4326].wkTemplate,{Central_Meridian:"0.0"})},k4={wkid:102100,latestWkid:3857},xNe={wkid:32662};function SY(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Eme=SY(Kr),w6=SY(hp),x6=SY(i0),Cme={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Kr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},TNe=w6.wkt.toUpperCase(),SNe=x6.wkt.toUpperCase();function Vr(t){if(t!=null&&qf(t)){const e=t.wkid,r=t.wkt2??t.wkt;if(FS(e))return hp;const i=r==null?void 0:r.toUpperCase();if(r&&i===TNe)return hp;if(kS(e)||i&&i===SNe)return i0}return Kr}function JPt(t){return FS(t)?hp:kS(t)?i0:Kr}function U4(t){return co(t,Eme)}function N_(t){return U4(t)||co(t,w6)||co(t,x6)}const EY=39.37,ENe=Kr.radius*Math.PI/200,Ame=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,Xb=D,Pme=/UNIT\[([^\]]+)]/i,CNe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),ANe=Ul()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),kp=t=>t*t,L0=t=>t*t*t,jM={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:kp(.001)},"square-centimeters":{inBaseUnits:kp(.01)},"square-decimeters":{inBaseUnits:kp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:kp(1e3)},"square-inches":{inBaseUnits:kp(.0254)},"square-feet":{inBaseUnits:kp(.3048)},"square-yards":{inBaseUnits:kp(.9144)},"square-miles":{inBaseUnits:kp(1609.344)},"square-us-feet":{inBaseUnits:kp(1200/3937)},acres:{inBaseUnits:.0015625*kp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*L0(.001)},"cubic-centimeters":{inBaseUnits:1e3*L0(.01)},"cubic-decimeters":{inBaseUnits:1e3*L0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*L0(1e3)},"cubic-inches":{inBaseUnits:1e3*L0(.0254)},"cubic-feet":{inBaseUnits:1e3*L0(.3048)},"cubic-yards":{inBaseUnits:1e3*L0(.9144)},"cubic-miles":{inBaseUnits:1e3*L0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},PNe=(()=>{const t={};for(const e in jM)for(const r in jM[e].units)t[r]=e;return t})();function MNe(t,e,r){return t*jM[r].units[e].inBaseUnits}function ONe(t,e,r){return t/jM[r].units[e].inBaseUnits}const Mme=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function WV(t){const e=PNe[t];if(!e)throw new Error("unknown type");return e}function kee(t,e=null){return e=e||WV(t),jM[e].baseUnit===t}function ro(t,e,r){if(e===r)return t;const i=WV(e);if(i!==WV(r))throw new Error("incompatible units");const s=kee(e,i)?t:MNe(t,e,i);return kee(r,i)?s:ONe(s,r,i)}function KPt(t,e,r){switch(r){case"metric":return RNe(t,e);case"imperial":return INe(t,e);default:return r}}function QPt(t,e,r){switch(r){case"metric":return $Ne(t,e);case"imperial":return LNe(t,e);default:return r}}function RNe(t,e){const r=ro(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function $Ne(t,e){const r=ro(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function INe(t,e){const r=ro(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function LNe(t,e){const r=ro(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function eMt(t,e){const r=ro(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function tMt(t,e){const r=ro(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function DNe(t,e,r){return ro(t,e,"meters")/(r*Math.PI/180)}function Ome(t){return ANe.fromJSON(t.toLowerCase())||null}function HM(t){if(t!=null&&!BM(t))return 1;const e=xa(t);return e>1e5?1:e}function Rme(t){return xa(t)>=Vr(t).metersPerDegree?"meters":T6(t)}function xa(t,e=Kr.metersPerDegree){return NNe(t,!0)??e}function NNe(t,e=!1){const r=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let s=null;if(r){if(FS(r))return hp.metersPerDegree;if(kS(r))return i0.metersPerDegree;s=Xb.values[Xb[r]],!s&&e&&CNe.has(r)&&(s=ENe)}else i&&(Lme(i)?s=Uee(Ame.exec(i),s):Ime(i)&&(s=Uee(Pme.exec(i),s)));return s}function YV(t){return TY(t)?1:xa(t)}function Uee(t,e){return t!=null&&t[1]?$me(t[1]):e}function $me(t){return parseFloat(t.split(",")[1])}function T6(t){const e=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let i=null;if(e)i=Xb.units[Xb[e]];else if(r){const s=Lme(r)?Ame:Ime(r)?Pme:null;if(s){const n=s.exec(r);n!=null&&n[1]&&(i=UNe(n[1]))}}return i!=null?Ome(i):null}function rMt(t){const e=T6(t);return e!=null&&Mme.includes(e)?e:null}function FNe(t){const e=Rme(t);return e!=null&&Mme.includes(e)?e:null}function Ime(t){return/^GEOCCS/i.test(t)}function Lme(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const kNe=1e-7;function UNe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let r=e==null?void 0:e[1];if(!r||!Xb.units.includes(r)){const i=$me(t);r=null;const s=Xb.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<kNe){r=Xb.units[n];break}}return r}function iMt(t){const e=T6(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const zNe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},BNe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},VNe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},sMt=Ul()(zNe),nMt=Ul()(BNe),oMt=Ul()(VNe);var lf;let _i=lf=class extends We{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return lf.WebMercator;if(t.wkid===4326)return lf.WGS84}const e=new lf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return VM(this)}get isWebMercator(){return Sw(this)}get isGeographic(){return TY(this)}get isWrappable(){return wNe(this)}get metersPerUnit(){return xa(this)}get unit(){return T6(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===lf.WGS84)return new lf(F4);if(this===lf.WebMercator)return new lf(k4);const t=new lf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ge(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return co(this,t)}toJSON(t){return this.write(void 0,t)}};_i.GCS_NAD_1927=null,_i.WGS84=null,_i.WebMercator=null,_i.PlateCarree=null,d([m({readOnly:!0})],_i.prototype,"isWGS84",null),d([m({readOnly:!0})],_i.prototype,"isWebMercator",null),d([m({readOnly:!0})],_i.prototype,"isGeographic",null),d([m({readOnly:!0})],_i.prototype,"isWrappable",null),d([m({type:an,json:{write:!0}})],_i.prototype,"latestWkid",void 0),d([m({readOnly:!0})],_i.prototype,"metersPerUnit",null),d([m({readOnly:!0})],_i.prototype,"unit",null),d([m({type:an,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],_i.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],_i.prototype,"wkt",void 0),d([lr("wkt"),lr("web-scene","wkt")],_i.prototype,"writeWkt",null),d([m({type:String,json:{write:!1}})],_i.prototype,"wkt2",void 0),d([m({type:an,json:{write:!0}})],_i.prototype,"vcsWkid",void 0),d([m({type:an,json:{write:!0}})],_i.prototype,"latestVcsWkid",void 0),d([m()],_i.prototype,"imageCoordinateSystem",void 0),_i=lf=d([V("esri.geometry.SpatialReference")],_i),_i.prototype.toJSON.isDefaultToJSON=!0,_i.GCS_NAD_1927=new _i({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),_i.WGS84=new _i(F4),_i.WebMercator=new _i(k4),_i.PlateCarree=new _i(xNe),Object.freeze&&(Object.freeze(_i.GCS_NAD_1927),Object.freeze(_i.WGS84),Object.freeze(_i.WebMercator),Object.freeze(_i.PlateCarree));const Xe=_i;let cf=class extends We{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Xe.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof Xe)return e;if(e!=null){const i=new Xe;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};d([m()],cf.prototype,"type",void 0),d([m({readOnly:!0})],cf.prototype,"cache",null),d([m({readOnly:!0})],cf.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],cf.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],cf.prototype,"hasZ",void 0),d([m({type:Xe,json:{write:!0},value:Xe.WGS84})],cf.prototype,"spatialReference",void 0),d([Tr("spatialReference")],cf.prototype,"readSpatialReference",null),cf=d([V("esri.geometry.Geometry")],cf);const d1=cf;function GNe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const jNe=57.29577951308232,HNe=.017453292519943;function zee(t){return t*jNe}function Bee(t){return t*HNe}function Vee(t){return t/Kr.radius}function z4(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Kr.radius))}function XV(t){return t.wkid!=null||t.wkt!=null}const Z8=[0,0];function B4(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,Z8,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,Z8,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,Z8,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const h=a[u];c=[],l.push(c);for(let p=0;p<h.length;p++)c.push(e(h[p][0],h[p][1],[0,0],i)),h[p].length>2&&c[p].push(h[p][2]),h[p].length>3&&c[p].push(h[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function fD(t,e){const r=t&&(XV(t)?t:t.spatialReference),i=e&&(XV(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!co(i,r)||Sw(i)&&VM(r)||Sw(r)&&VM(i))}function KO(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(XV(e)?e:e.spatialReference);return fD(r,i)?co(r,i)?ge(t):Sw(i)?B4(t,yT,Xe.WebMercator,!1,ge(t)):VM(i)?B4(t,$P,Xe.WGS84,!1,ge(t)):null:null}function yT(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Bee(e);return r[0]=Bee(t)*Kr.radius,r[1]=Kr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function $P(t,e,r=[0,0],i=!1){const s=zee(t/Kr.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=zee(Math.PI/2-2*Math.atan(Math.exp(-e/Kr.radius))),r}function rm(t,e=!1,r=ge(t)){return B4(t,yT,Xe.WebMercator,e,r)}function _T(t,e=!1,r=ge(t)){return B4(t,$P,Xe.WGS84,e,r)}var mD;const xC=[0,0];function Gee(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let dl=mD=class extends d1{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Xe(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)ae.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)ae.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=yT(n.longitude,n.latitude,xC);t=a[0],e=a[1]}}}else Gee(r)?(s=r,r=null):Gee(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ae.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ae.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return $P(e,r,xC)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",yT(r,t,xC)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return $P(t,e,xC)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",yT(t,e,xC)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new mD;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return mD.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=yT(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=$P(l,c),u=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=pp(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return GNe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],dl.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],dl.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],dl.prototype,"hasZ",null),d([m({type:Number})],dl.prototype,"latitude",null),d([m({type:Number})],dl.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),zi(t=>isNaN(t)?t:jd(t))],dl.prototype,"x",void 0),d([lr("x")],dl.prototype,"writeX",null),d([Tr("x")],dl.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],dl.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],dl.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],dl.prototype,"m",void 0),dl=mD=d([V("esri.geometry.Point")],dl),dl.prototype.toJSON.isDefaultToJSON=!0;const Ke=dl;let uf=class extends Au(We){constructor(...e){super(...e),this.position=new Ke([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new Dfe}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=jd(e.x||0),n.y=jd(e.y||0),n.z=e.hasZ?jd(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new Ke;return i.read(e,r),i.x=jd(i.x||0),i.y=jd(i.y||0),i.z=i.hasZ?jd(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};d([m({type:Ke,json:{write:{isRequired:!0}}})],uf.prototype,"position",void 0),d([lr("position")],uf.prototype,"writePosition",null),d([Tr("position")],uf.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),zi(t=>hY.normalize(jd(t)))],uf.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),zi(t=>we(jd(t),-180,180))],uf.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],uf.prototype,"fov",void 0),d([m({type:Dfe,nonNullable:!0,json:{read:!1,write:!1}})],uf.prototype,"layout",void 0),uf=d([V("esri.Camera")],uf);const xu=uf,J8=[0,0];function CY(t,e){return e!=null&&ka(t,e.x,e.y,e.z)}function cMt(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!US(t,r))return!1;return!0}function qNe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?ka(t,r,i,s)&&ka(t,r,o,s)&&ka(t,n,o,s)&&ka(t,n,i,s)&&ka(t,r,i,a)&&ka(t,r,o,a)&&ka(t,n,o,a)&&ka(t,n,i,a):ka(t,r,i)&&ka(t,r,o)&&ka(t,n,o)&&ka(t,n,i)}function US(t,e){return ka(t,e[0],e[1])}function WNe(t,e){return ka(t,e[0],e[1],e[2])}function ka(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function YNe(t,e){return J8[1]=e.y,J8[0]=e.x,XNe(t,J8)}function XNe(t,e){return Dme(t.rings,e)}function Dme(t,e){if(!t)return!1;if(ZNe(t))return jee(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=jee(r,t[i],e);return r}function ZNe(t){return!Array.isArray(t[0][0])}function jee(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[h,p]=e[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(h-c)<i&&(n=!n)}return n}function JNe(t,e){return CY(t,e)}function KNe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function QNe(t,e){const{points:r,hasZ:i}=e,s=i?WNe:US;for(const n of r)if(s(t,n))return!0;return!1}const Ew=[0,0],Cw=[0,0],Aw=[0,0],Pw=[0,0],e4e=[Ew,Cw,Aw,Pw],Nme=[[Aw,Ew],[Ew,Cw],[Cw,Pw],[Pw,Aw]];function t4e(t,e){return r4e(t,e.rings)}function r4e(t,e){Ew[0]=t.xmin,Ew[1]=t.ymax,Cw[0]=t.xmax,Cw[1]=t.ymax,Aw[0]=t.xmin,Aw[1]=t.ymin,Pw[0]=t.xmax,Pw[1]=t.ymin;for(const r of e4e)if(Dme(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(US(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(US(t,n)||Fme(i,n,Nme))return!0;i=n}}return!1}function i4e(t,e){Ew[0]=t.xmin,Ew[1]=t.ymax,Cw[0]=t.xmax,Cw[1]=t.ymax,Aw[0]=t.xmin,Aw[1]=t.ymin,Pw[0]=t.xmax,Pw[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(US(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(US(t,o)||Fme(s,o,Nme))return!0;s=o}}return!1}const Oo=[0,0];function s4e(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(V4(n,o,c,u,Oo)&&!(Oo[0]===n[0]&&Oo[1]===n[1]||Oo[0]===c[0]&&Oo[1]===c[1]||Oo[0]===o[0]&&Oo[1]===o[1]||Oo[0]===u[0]&&Oo[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],u=r[l+1];if(V4(o,a,c,u,Oo)&&!(Oo[0]===o[0]&&Oo[1]===o[1]||Oo[0]===c[0]&&Oo[1]===c[1]||Oo[0]===a[0]&&Oo[1]===a[1]||Oo[0]===u[0]&&Oo[1]===u[1]))return!0}}}return!1}function Fme(t,e,r){for(let i=0;i<r.length;i++)if(V4(t,e,r[i][0],r[i][1]))return!0;return!1}function V4(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,u]=r,[h,p]=i,f=h-c,g=n-c,_=a-n,v=p-u,b=o-u,w=l-o,T=v*_-f*w;if(T===0)return!1;const S=(f*b-v*g)/T,C=(_*b-w*g)/T;return S>=0&&S<=1&&C>=0&&C<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function n4e(t){switch(t){case"esriGeometryEnvelope":case"extent":return KNe;case"esriGeometryMultipoint":case"multipoint":return QNe;case"esriGeometryPoint":case"point":return JNe;case"esriGeometryPolygon":case"polygon":return t4e;case"esriGeometryPolyline":case"polyline":return i4e}}var Bu;function o4e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function D0(t,e,r){return e==null?r:r==null?e:t(e,r)}let mo=Bu=class extends d1{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return o4e(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Xe.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??Xe.WGS84}}static fromBounds(t,e){return new Bu({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Bu({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Ke({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Bu;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&fD(e,r)&&(t=e.isWebMercator?rm(t):_T(t,!0)),t.type==="point"?CY(this,t):t.type==="extent"&&qNe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&fD(e,r)&&(t=e.isWebMercator?rm(t):_T(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!co(e,r)&&fD(e,r)&&(t=e.isWebMercator?rm(t):_T(t,!0)),n4e(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=D0(Math.min,this.zmin,t.zmin),this.zmax=D0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=D0(Math.min,this.mmin,t.mmin),this.mmax=D0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=D0(Math.max,this.zmin,t.zmin),this.zmax=D0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=D0(Math.max,this.mmin,t.mmin),this.mmax=D0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=pp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?_T(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new Xe(XW((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??pp(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||pp(o);const[h,p]=t.valid;u=this._normalizeX(this.xmin,t);const f=u.x,g=u.frameId;u=this._normalizeX(this.xmax,t);const _=u.x,v=u.frameId,b=f===_&&a>0;if(a>2*p){const w=new Bu(l<c?f:_,s,p,n,o),T=new Bu(h,s,l<c?_:f,n,o),S=new Bu(0,s,p,n,o),C=new Bu(h,s,0,n,o),P=[],R=[];w.contains(S)&&P.push(g),w.contains(C)&&R.push(g),T.contains(S)&&P.push(v),T.contains(C)&&R.push(v);for(let L=g+1;L<v;L++)P.push(L),R.push(L);e.push({extent:w,frameIds:[g]},{extent:T,frameIds:[v]},{extent:S,frameIds:P},{extent:C,frameIds:R})}else f>_||b?e.push({extent:new Bu(f,s,p,n,o),frameIds:[g]},{extent:new Bu(h,s,_,n,o),frameIds:[v]}):e.push({extent:new Bu(f,s,_,n,o),frameIds:[g]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};d([m({readOnly:!0})],mo.prototype,"cache",null),d([m({readOnly:!0})],mo.prototype,"center",null),d([m({readOnly:!0})],mo.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],mo.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],mo.prototype,"hasZ",null),d([m({readOnly:!0})],mo.prototype,"height",null),d([m({readOnly:!0})],mo.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],mo.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],mo.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],mo.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],mo.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],mo.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],mo.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],mo.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],mo.prototype,"zmax",void 0),mo=Bu=d([V("esri.geometry.Extent")],mo),mo.prototype.toJSON.isDefaultToJSON=!0;const $r=mo;function zS(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var ZV;function Hee(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function a4e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let yy=ZV=class extends d1{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var s;if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):a4e(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=(s=r.points)==null?void 0:s[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new $r,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=Hee(Math.min),a=Hee(Math.max);let l,c,u,h,[p,f]=n,[g,_]=n;for(let v=0,b=t.length;v<b;v++){const w=t[v],[T,S]=w;if(p=o(p,T),f=o(f,S),g=a(g,T),_=a(_,S),r&&w.length>2){const C=w[2];l=o(l,C),u=a(u,C)}if(i&&w.length>s){const C=w[s];c=o(c,C),h=a(h,C)}}return e.xmin=p,e.ymin=f,e.xmax=g,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=h):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ge(this.points)}addPoint(t){return zS(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ge(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new ZV(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new Ke(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Ke(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(zS(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],yy.prototype,"cache",null),d([m()],yy.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],yy.prototype,"points",void 0),d([lr("points")],yy.prototype,"writePoints",null),yy=ZV=d([V("esri.geometry.Multipoint")],yy),yy.prototype.toJSON.isDefaultToJSON=!0;const VE=yy;function S6(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function x_(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var ls;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(ls||(ls={}));function E6(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function kme(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function l4e(t,e,r,i){const[s,n]=e,[o,a]=r,[l,c]=i,u=l-o,h=c-a,p=u*u+h*h,f=(s-o)*u+(n-a)*h,g=Math.min(1,Math.max(0,f/p));return t[0]=o+u*g,t[1]=a+h*g,t}function c4e(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function Ume(t,e){return kme(t,e,.5)}function zme(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=E6(t[i],t[i+1]);return r}function Bme(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=E6(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return kme(t[s],t[s+1],o)}i+=n}return t[r-1]}function gD(t,e=ls.X,r=ls.Y){let i=0;const s=t.length;let n=t[0];for(let o=0;o<s-1;o++){const a=t[o+1];i+=(a[e]-n[e])*(a[r]+n[r]),n=a}return i>=0}function u4e(t){const e=t.length;return e>2&&e0(t[0],t[e-1])}function uMt(t){if("rings"in t)for(const e of t.rings)u4e(e)||e.push(e[0].slice())}function hMt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function Vme(t){return t?Gme(t.rings,t.hasZ??!1):null}function Gme(t,e){if(!(t!=null&&t.length))return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=jme(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?d4e(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function jme(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const f=t[p],g=t[(p+1)%t.length],[_,v,b]=f,w=_-l,T=v-c,[S,C,P]=g,R=S-l,L=C-c,F=w*L-R*T;if(o+=F,i+=(w+R)*F,s+=(T+L)*F,e&&f.length>2&&g.length>2){const U=b-u,j=P-u,z=w*j-R*U;n+=(U+j)*z,a+=z}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(h[3]=(r[4]+r[5])/2,h[4]=0):(h[3]=n/(6*a)+u,h[4]=a)),h}function h4e(t,e){let r=0,i=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,h]=l,p=u-n,f=h-o,[g,_]=c,v=g-n,b=_-o,w=p*b-v*f;s+=w,r+=(p+v)*w,i+=(f+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),h<e[2]&&(e[2]=h),h>e[3]&&(e[3]=h)}return s>0&&(s*=-1),s?(s*=.5,[r/(6*s)+n,i/(6*s)+o,s]):null}function d4e(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],h=t[l+1];if(u&&h){r[0]=u[0],r[1]=u[1],i[0]=h[0],i[1]=h[1],e&&u.length>2&&h.length>2&&(r[2]=u[2],i[2]=h[2]);const p=E6(r,i);if(p){s+=p;const f=Ume(u,h);n+=p*f[0],o+=p*f[1],e&&f.length>2&&(a+=p*f[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function p4e(t){const{hasZ:e,totalSize:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=jme(x_(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.pathSize?f4e(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function f4e(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const h=t.x,p=t.y,f=t.z;r[0]=l,r[1]=c,i[0]=h,i[1]=p,e&&(r[2]=u,i[2]=f);const g=E6(r,i);if(g){s+=g;const _=Ume(r,i);n+=g*_[0],o+=g*_[1],e&&_.length>2&&(a+=g*_[2])}l=h,c=p,u=f}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const m4e=1e-6;function g4e(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<m4e){const s=p4e(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)_4e(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const y4e=1/3;function _4e(t,e,r){if(!t||!r||r.pathSize<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*y4e*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=r.getCurrentRingArea(),h=[i,s];return h[0]-=e[0],h[1]-=e[1],h[0]*=u,h[1]*=u,t[0]+=h[0],t[1]+=h[1],t}function jt(t=x4e){return[t[0],t[1],t[2],t[3]]}function dMt(t){return[t[0],t[1],t[2],t[3]]}function s0(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function QO(t,e,r,i,s=jt()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Hme(t,e=jt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function C6(t,e){return new $r({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function AY(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function T_(t,e,r){if(e!=null)if("length"in e)QV(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else s0(r,t)}function K8(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function JV(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function fa(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Pl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function pMt(t){return fa(t)*Pl(t)}function G4(t){return fa(t)>0&&Pl(t)>0}function PY(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function qme(t,e){return A6(t,e[0],e[1])}function qee(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=r*r}function fMt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,h=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=h(i,o),f=h(n,o),g=h(n,s),_=h(i,s);return!(p===f&&f===g&&g===_&&_===p||a<i&&c<i||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function mMt(t,e){return A6(t,e.x,e.y)}function A6(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function v4e(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function P6(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Wee(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function KV(t,e,r){if(e==null)return s0(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=we(t[0],i,n),r[1]=we(t[1],s,o),r[2]=we(t[2],i,n),r[3]=we(t[3],s,o),r}function b4e(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-fa(t)/2,0),n=Math.max(Math.abs(e[1]-i)-Pl(t)/2,0);return Math.sqrt(s*s+n*n)}function j4(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Tu(t){return t?s0(t,eG):jt(eG)}function QV(t){return t!=null&&t.length===4}function w4e(t){return!(fa(t)!==0&&isFinite(t[0])||Pl(t)!==0&&isFinite(t[1]))}function Zb(t,e){return QV(t)&&QV(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const gMt=[-1/0,-1/0,1/0,1/0],eG=[1/0,1/0,-1/0,-1/0],x4e=[0,0,0,0];function Wme(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Yme(t){return t.points!==void 0}function Xme(t){return t.x!==void 0&&t.y!==void 0}function Zme(t){return t.paths!==void 0}function Jme(t){return t.rings!==void 0}function Kme(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const l_=Kme(Math.min),c_=Kme(Math.max);function T4e(t,e){return Zme(e)?BS(t,e.paths,!1,!1):Jme(e)?BS(t,e.rings,!1,!1):Yme(e)?MY(t,e.points,!1,!1,!1,!1):Wme(e)?ege(t,e):(Xme(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function M6(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=Qme(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return jt([e,i,r,s])}function Qme(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return jt([e,i,r,s])}function yMt(t,e){return Zme(e)?BS(t,e.paths,!0,!1):Jme(e)?BS(t,e.rings,!0,!1):Yme(e)?MY(t,e.points,!0,!1,!0,!1):Wme(e)?ege(t,e,!0,!1,!0,!1):(Xme(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function BS(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[h,p]=e[0][0];for(let f=0;f<e.length;f++){const g=e[f];for(let _=0;_<g.length;_++){const v=g[_],[b,w]=v;if(c=l_(c,b),u=l_(u,w),h=c_(h,b),p=c_(p,w),r&&v.length>2){const T=v[2];n=l_(n,T),o=c_(o,T)}if(i&&v.length>s){const T=v[s];a=l_(n,T),l=c_(o,T)}}}return r?i?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=h,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=h,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=h,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=h,t[3]=p,t.length=4,t)}function ege(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,h=e.zmax,p=e.mmin,f=e.mmax;return s?(u=u||0,h=h||0,n?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=h,t[7]=f,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=f,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function MY(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,u,h,p,[f,g]=e[0],[_,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[T,S]=w;if(f=l_(f,T),g=l_(g,S),_=c_(_,T),v=c_(v,S),l&&w.length>2){const C=w[2];c=l_(c,C),u=c_(u,C)}if(a&&w.length>o){const C=w[o];h=l_(c,C),p=c_(u,C)}}return s?(c=c||0,u=u||0,n?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=c,t[3]=h,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=f,t[1]=g,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):n?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=h,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=f,t[1]=g,t[2]=_,t[3]=v,t)}function S4e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function E4e(t){return t.points!==void 0}function C4e(t){return t.x!==void 0&&t.y!==void 0}function A4e(t){return t.paths!==void 0}function P4e(t){return t.rings!==void 0}const OY=[];function tge(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function rge(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function ige(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function sge(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function RY(t,e=!1,r=!1){return e?r?sge(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):rge(t[0],t[1],t[2],t[3],t[4],t[5]):r?ige(t[0],t[1],t[2],t[3],t[4],t[5]):tge(t[0],t[1],t[2],t[3])}function _Mt(t){return t?S4e(t)?t:C4e(t)?O4e(t):P4e(t)?nge(t):A4e(t)?oge(t):E4e(t)?M4e(t):null:null}function M4e(t){const{hasZ:e,hasM:r,points:i}=t;return RY(MY(OY,i,e??!1,r??!1),e,r)}function O4e(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?sge(e,r,i,s,e,r,i,s):rge(e,r,i,e,r,i):n?ige(e,r,s,e,r,s):tge(e,r,e,r)}function nge(t){const{hasZ:e,hasM:r,rings:i}=t,s=BS(OY,i,e??!1,r??!1);return s?RY(s,e,r):null}function oge(t){const{hasZ:e,hasM:r,paths:i}=t,s=BS(OY,i,e??!1,r??!1);return s?RY(s,e,r):null}var yD;function Yee(t){return!Array.isArray(t[0])}let hf=yD=class extends d1{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new yD(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||Xe.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=Vme(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Ke;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=nge(this);if(!e)return null;const r=new $r(e);return r.spatialReference=t,r}get isSelfIntersecting(){return s4e(this.rings)}writeRings(t,e){e.rings=ge(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(Yee(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new yD;return t.spatialReference=this.spatialReference,t.rings=ge(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,u,h])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&h==null||a===h);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!e0(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=KO(t,this.spatialReference);return YNe(this,e??t)}isClockwise(t){let e;return e=Yee(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,gD(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new Ke(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new Ke(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new Ke(r[0],r[1],r[2],r[3],this.spatialReference):new Ke(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(zS(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ke(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new Ke(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(zS(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],hf.prototype,"cache",null),d([m({readOnly:!0})],hf.prototype,"centroid",null),d([m({readOnly:!0})],hf.prototype,"extent",null),d([m({readOnly:!0})],hf.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],hf.prototype,"rings",void 0),d([lr("rings")],hf.prototype,"writeRings",null),hf=yD=d([V("esri.geometry.Polygon")],hf),hf.prototype.toJSON.isDefaultToJSON=!0;const bp=hf;var tG;function R4e(t){return!Array.isArray(t[0])}let _y=tG=class extends d1{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||Xe.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=oge(this);if(!e)return null;const r=new $r(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ge(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(R4e(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new tG;return t.spatialReference=this.spatialReference,t.paths=ge(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new Ke(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new Ke(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new Ke(r[0],r[1],r[2],r[3],this.spatialReference):new Ke(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(zS(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new Ke(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Ke(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(zS(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],_y.prototype,"cache",null),d([m({readOnly:!0})],_y.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],_y.prototype,"paths",void 0),d([lr("paths")],_y.prototype,"writePaths",null),_y=tG=d([V("esri.geometry.Polyline")],_y),_y.prototype.toJSON.isDefaultToJSON=!0;const tp=_y,age=Ul()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),vMt=Ul()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Xd(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Jb(t){return t.points!==void 0}function VS(t){return t.x!==void 0&&t.y!==void 0}function Zd(t){return t.paths!==void 0}function yc(t){return t.rings!==void 0}function Mw(t){return t==null?null:t instanceof d1?t:VS(t)?Ke.fromJSON(t):Zd(t)?tp.fromJSON(t):yc(t)?bp.fromJSON(t):Jb(t)?VE.fromJSON(t):Xd(t)?$r.fromJSON(t):null}function eR(t){return t?VS(t)?"esriGeometryPoint":Zd(t)?"esriGeometryPolyline":yc(t)?"esriGeometryPolygon":Xd(t)?"esriGeometryEnvelope":Jb(t)?"esriGeometryMultipoint":null:null}const $4e={esriGeometryPoint:Ke,esriGeometryPolyline:tp,esriGeometryPolygon:bp,esriGeometryEnvelope:$r,esriGeometryMultipoint:VE};function I4e(t){return t&&$4e[t]||null}const O6={base:d1,key:"type",typeMap:{extent:$r,multipoint:VE,point:Ke,polyline:tp,polygon:bp}};gm(O6);var rG;let vy=rG=class extends We{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new rG({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function Q8(){return{enabled:!this.camera}}d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Q8}}}}})],vy.prototype,"rotation",void 0),d([zi("rotation")],vy.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Q8}}}}})],vy.prototype,"scale",void 0),d([m({types:O6,json:{read:Mw,write:!0,origins:{"web-scene":{read:Mw,write:{overridePolicy:Q8}}}}})],vy.prototype,"targetGeometry",void 0),d([m({type:xu,json:{write:!0}})],vy.prototype,"camera",void 0),vy=rG=d([V("esri.Viewpoint")],vy);const wp=vy;let _D=class lge{constructor(){this._emitter=new lge.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){var c;let o=(c=this._listenersMap)==null?void 0:c.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const h="deref"in u?u.deref():u;h?h==null||h.call(a,n):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return mw(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Yr(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(s),l=(a==null?void 0:a.indexOf(n))??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove();const l="deref"in n?n.deref():n;l==null||l.call(null,a)});return o}hasEventListener(s){var o;const n=(o=this._listenersMap)==null?void 0:o.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=d([V("esri.core.Evented")],s),s};let r=class extends Me{constructor(){super(...arguments),this._emitter=new _D.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=d([V("esri.core.Evented")],r),t.EventedAccessor=r})(_D||(_D={}));const Gs=_D;var vi;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(vi||(vi={}));function cge(t){return(e,r)=>{e[r]=t}}let tR=class extends Zpe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var Pg;let L4e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},D4e=class{constructor(e,r,i,s,n){this.target=e,this.added=r,this.removed=i,this.start=s,this.deleteCount=n}};const Ou=new qo(L4e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function eU(t){return t?t instanceof xg?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function tU(t){if(t!=null&&t.length)return t[0]}function N4e(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function uge(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),uge(t,r.call(i,s,n,o),r,i)})}const N0=new Set,F0=new Set,k0=new Set,rU=new Map;let F4e=0,xg=Pg=class extends Gs.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Pg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new tR,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:F4e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Pg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Ot(this._observable),this._items}set items(t){this._emitBeforeChanges(vi.ADD)||(this._splice(0,this.length,eU(t)),this._emitAfterChanges(vi.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),Yr(()=>{i.removed=!0,r.splice(r.indexOf(i),1)})}return this._emitter.on(t,e)}once(t,e){const r="deref"in e?()=>e.deref():()=>e,i=this.on(t,s=>{var n;(n=r())==null||n.call(null,s),i.remove()});return i}add(t,e){if(Ot(this._observable),this._emitBeforeChanges(vi.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(vi.ADD),this}addMany(t,e=this._items.length){if(Ot(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(vi.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,eU(t)),this._emitAfterChanges(vi.ADD),this}at(t){if(Ot(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(vi.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ot(this._observable),this._createNewInstance({items:this._items.map(ge)})}concat(...t){Ot(this._observable);const e=t.map(eU);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(vi.REMOVE)}every(t,e){return Ot(this._observable),this._items.every(t,e)}filter(t,e){let r;return Ot(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Ot(this._observable),this._items.find(t,e)}findIndex(t,e){return Ot(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ot(this._observable);const r=[];return uge(r,this,t,e),new Pg(r)}forEach(t,e){return Ot(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ot(this._observable),this._items[t]}getNextIndex(t){Ot(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ot(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ot(this._observable),this._items.indexOf(t,e)}join(t=","){return Ot(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ot(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ot(this._observable);const r=this._items.map(t,e);return new Pg({items:r})}reorder(t,e=this.length-1){Ot(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(vi.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(vi.MOVE)}return t}}pop(){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const t=tU(this._splice(this.length-1,1));return this._emitAfterChanges(vi.REMOVE),t}push(...t){return Ot(this._observable),this._emitBeforeChanges(vi.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(vi.ADD)),this.length}reduce(t,e){Ot(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Ot(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Ot(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ot(this._observable),t<0||t>=this.length||this._emitBeforeChanges(vi.REMOVE))return;const e=tU(this._splice(t,1));return this._emitAfterChanges(vi.REMOVE),e}removeMany(t){if(Ot(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(vi.REMOVE))return[];const e=t instanceof Pg?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+N4e(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(vi.REMOVE),i}reverse(){if(Ot(this._observable),this._emitBeforeChanges(vi.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(vi.MOVE),this}shift(){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const t=tU(this._splice(0,1));return this._emitAfterChanges(vi.REMOVE),t}slice(t=0,e=this.length){return Ot(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ot(this._observable),this._items.some(t,e)}sort(t){if(Ot(this._observable),!this.length||this._emitBeforeChanges(vi.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(vi.MOVE),this}splice(t,e,...r){Ot(this._observable);const i=(e?vi.REMOVE:0)|(r.length?vi.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return Ot(this._observable),this._items.slice()}toJSON(){return Ot(this._observable),this.toArray()}toLocaleString(){return Ot(this._observable),this._items.toLocaleString()}toString(){return Ot(this._observable),this._items.toString()}unshift(...t){return Ot(this._observable),!t.length||this._emitBeforeChanges(vi.ADD)||(this._splice(0,0,t),this._emitAfterChanges(vi.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=zE(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Ou.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);Ou.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Ou.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Ou.release(a)}}if(r!=null&&r.length){if(s){const u=[];for(const h of r){const p=s.ensureType(h);p==null&&h!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Ou.acquire();u.target=this,u.cancellable=!0;const h=Ou.acquire();h.target=this,h.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(h.reset(p),this.emit("after-add",h)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),h.reset(p),this.emit("after-add",h));Ou.release(h),Ou.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}if((r!=null&&r.length||o!=null&&o.length)&&this._notifyChangeEvent(r,o),this.hasEventListener("after-splice")){const a=new D4e(this,r,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Ou.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Ou.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Ou.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Ou.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;N0.clear(),F0.clear(),k0.clear();for(const{added:l,removed:c}of r){if(l)if(k0.size===0&&F0.size===0)for(const u of l)N0.add(u);else for(const u of l)F0.has(u)?(k0.add(u),F0.delete(u)):k0.has(u)||N0.add(u);if(c)if(k0.size===0&&N0.size===0)for(const u of c)F0.add(u);else for(const u of c)N0.has(u)?N0.delete(u):(k0.delete(u),F0.add(u))}const i=pc.acquire();N0.forEach(l=>{i.push(l)});const s=pc.acquire();F0.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=pc.acquire();if(k0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const h=e.listeners[u];h.removed||h.callback.call(this,l)}}pc.release(i),pc.release(s),pc.release(a)}N0.clear(),F0.clear(),k0.clear()}};xg.ofType=t=>{if(!t)return Pg;if(rU.has(t))return rU.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends Pg{};return d([cge({Type:t,ensureType:typeof t=="function"?ma(t):gm(t)})],r.prototype,"itemType",void 0),r=d([V(`esri.core.Collection<${e}>`)],r),rU.set(t,r),r},d([m()],xg.prototype,"_updating",void 0),d([m()],xg.prototype,"length",void 0),d([m()],xg.prototype,"items",null),d([m({readOnly:!0})],xg.prototype,"updating",null),xg=Pg=d([V("esri.core.Collection")],xg);const Mt=xg;function R6(t){return typeof t=="string"?document.getElementById(t):t??null}function hge(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Xee(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Zee(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function $6(t,e,r){return KW(t.map((i,s)=>e.apply(r,[i,s])))}async function k4e(t,e,r){return(await KW(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function $Y(t){return{ok:!0,value:t}}function IY(t){return{ok:!1,error:t}}function U4e(t){return t!=null&&t.ok===!0?t.value:null}function z4e(t){return t!=null&&t.ok===!1?t.error:null}async function xp(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return $Y(await t)}catch(e){return IY(e)}}async function TMt(t){try{return $Y(await t)}catch(e){return Uo(e),IY(e)}}function SMt(t){if(t.ok===!0)return t.value;throw t.error}function Am(t,e){return new by(t,e)}let by=class extends Me{get value(){return U4e(this._result)}get error(){return z4e(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Ja(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=$Y(s),this._cleanup()},s=>{this._result=IY(s),this._cleanup()}),this._abortHandle=lo(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=wi(this._abortHandle),this._abortController=null}};d([m()],by.prototype,"value",null),d([m()],by.prototype,"error",null),d([m()],by.prototype,"finished",null),d([m()],by.prototype,"promise",void 0),d([m()],by.prototype,"_result",void 0),by=d([V("esri.core.asyncUtils.ReactiveTask")],by);function he(t,e,r={}){return LY(t,e,r,dge)}function Ih(t,e,r={}){return LY(t,e,r,pge)}function LY(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(wi(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=oLe(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function Ho(t,e,r,i={}){let s=null,n=null,o=null;function a(){var u;s&&n&&(n.remove(),(u=i.onListenerRemove)==null||u.call(i,s),s=null,n=null)}function l(u){i.once&&i.once&&wi(o),r(u)}const c=he(t,(u,h)=>{var p;a(),u6(u)&&(s=u,n=UE(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=Yr(()=>{c.remove(),a()}),o}function GS(t,e){return B4e(t,pge,e)}function B4e(t,e,r){if(Zs(r))return Promise.reject(hr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let s=null;function n(){s=wi(s)}return new Promise((o,a)=>{s=mw([lo(r,()=>{n(),a(hr())}),LY(t,l=>{n(),o(l)},{sync:!1,once:!0},e??dge)])})}function dge(t){return!0}function pge(t){return!!t}function V4e(t,e){const r=new Mt,i=Ho(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=r.splice(n,o);for(const l of a)l.remove();if(s!=null&&s.length){const l=s.map(e);r.addMany(l,n)}},{sync:!0,onListenerRemove:()=>r.drain(s=>s.remove()),onListenerAdd:s=>r.addMany(s.items.map(e))});return r.addHandles(i),r}function CMt(t,e){const r=new Mt,i=V4e(t,a=>Am(async l=>{const c=await e(a,l);if(Zs(l))throw c.remove(),hr();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=i.indexOf(a);c<0||r.splice(c,1,l)};r.addMany(i.items.map(s));for(const a of i)IM(n(a));const o=i.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=r.splice(l,c);for(const h of u)h==null||h.remove();if(a!=null&&a.length){r.addMany(a.map(s),l);for(const h of a)IM(n(h))}});return r.addHandles([Hpe(i),o]),r}const ti={sync:!0},ui={initial:!0},si={sync:!0,initial:!0},G4e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,j4e="screenUtils.toPt: input not recognized!",fge=96;function on(t){return t?t/72*fge:0}function Ka(t){return t?72*t/fge:0}function Js(t){if(typeof t=="string"){const e=t.match(G4e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?Ka(r):r;return s?-n:n}return console.warn(j4e),null}return t}function Lh(t=0,e=0){return{x:t,y:e}}function us(t=0,e=0){return[t,e]}function mge(t=0,e=0){return[t,e]}function Go(t=0,e=0,r=0){return[t,e,r]}function AMt(t){return t}function PMt(t){return t}function MMt(t){return t}function Jd(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}let H4=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new tR,this._items=new Set}get length(){return Ot(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ot(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ot(this._observable),yield*this._items}};const gge=new FinalizationRegistry(t=>{t.close()});function H4e(t,e){gge.register(t,e,e)}function q4e(t){gge.unregister(t)}const yge="worker:port-closed";var zo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(zo||(zo={}));let W4e=0;function _ge(){return W4e++}function Y4e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function qM(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function DY(t,e,r,i){if(e.type===zo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==zo.INVOKE&&e.type!==zo.RESPONSE)return void t.postMessage(e);let s;if(Y4e(r)?(s=Jee(r.transferList),e.data=r.result):(s=Jee(i),e.data=r),s){if(se("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case zo.INVOKE:throw o;case zo.RESPONSE:return void DY(t,{type:zo.RESPONSE,jobId:e.jobId,error:qM(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function WM(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Jee(t){if(!(t!=null&&t.length))return null;if(se("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!X4e(r));return e.length?e:null}function X4e(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function Z4e(t){try{return await t}catch(e){const r=(e==null?void 0:e.name)===yge;if(!(ns(e)||r))throw e;return}}function vge(t,e,r){return new Proxy({},{get:(i,s,n)=>(...o)=>{let a,l;const c=o[o.length-1];J4e(c)&&(a=c.signal,l=c.transferList,o.pop());const u=t.apply(e?`${e}.${s.toString()}`:s.toString(),o,{transferList:l,signal:a});return r!=null&&r.ignoreConnectionErrors?Z4e(u):u}})}function J4e(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const K4e={statsWorker:()=>me(()=>import("./statsWorker-CPOxChLJ.js"),__vite__mapDeps([2,3,4,5,6,7])),geometryEngineWorker:()=>me(()=>import("./geometryEngineWorker-BXfxVZay.js"),__vite__mapDeps([8,9,10,11])),CSVSourceWorker:()=>me(()=>import("./CSVSourceWorker-BRofyGua.js"),__vite__mapDeps([12,13,11,14,15,16,17,18,19,20,21,22,3,4,5,6,7,23,24,25,26])),EdgeProcessingWorker:()=>me(()=>import("./EdgeProcessingWorker-HSX345Vk.js"),[]),ElevationSamplerWorker:()=>me(()=>import("./ElevationSamplerWorker-Dz4Vfn95.js"),__vite__mapDeps([27,16,17])),FeatureServiceSnappingSourceWorker:()=>me(()=>import("./FeatureServiceSnappingSourceWorker-CWfFh4M0.js"),__vite__mapDeps([28,14,15,16,17,18,19,20,21,11,22,3,4,5,6,7,23,24,29,30,31,32,33])),GeoJSONSourceWorker:()=>me(()=>import("./GeoJSONSourceWorker-DFR_sHdS.js"),__vite__mapDeps([34,14,15,16,17,18,19,20,21,11,22,3,4,5,6,7,23,24,35,13,26,36])),LercWorker:()=>me(()=>import("./LercWorker-oEwajnxj.js"),[]),MemorySourceWorker:()=>me(()=>import("./MemorySourceWorker-TafZEJOL.js"),__vite__mapDeps([37,38,14,15,16,17,18,19,20,21,11,22,3,4,5,6,7,23,24,26,36,13])),PBFDecoderWorker:()=>me(()=>import("./PBFDecoderWorker-CXYhGJcp.js"),__vite__mapDeps([39,30,31])),FeaturePipelineWorker:()=>me(()=>import("./FeaturePipelineWorker-BMnR2JUs.js"),__vite__mapDeps([40,41,42,43,44,45,18,19,20,21,11,22,3,4,5,6,7,23,24,17,32,30,31,33,46,35,13,26,36,47,48])),PointCloudWorker:()=>me(()=>import("./PointCloudWorker-CxU5DyX1.js"),__vite__mapDeps([49,50,51,52,53])),RasterWorker:()=>me(()=>import("./RasterWorker-aWU9e0Ps.js"),__vite__mapDeps([54,55,56,57,58])),SceneLayerSnappingSourceWorker:()=>me(()=>import("./SceneLayerSnappingSourceWorker-CUL_Uxvi.js"),[]),SceneLayerWorker:()=>me(()=>import("./SceneLayerWorker-BeOC7Wsz.js").then(t=>t.S),__vite__mapDeps([59,60,61,53])),WFSSourceWorker:()=>me(()=>import("./WFSSourceWorker-D8Iku73T.js"),__vite__mapDeps([62,14,15,16,17,18,19,20,21,11,22,3,4,5,6,7,23,24,35,13,36,63,64])),WorkerTileHandler:()=>me(()=>import("./WorkerTileHandler-DnkfSR09.js"),__vite__mapDeps([65,44,31,42])),Lyr3DWorker:()=>me(()=>import("./Lyr3DWorker-CvKkbMnx.js"),__vite__mapDeps([66,67,68]))},{CLOSE:Kee,ABORT:Qee,INVOKE:ete,RESPONSE:TC,OPEN_PORT:tte,ON:Q4e}=zo,e5e=2;let t5e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===zo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},F_=class M2{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new M2(r.port1,{channel:r,client:i});return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),M2.clients.set(s,i),r.port2}static loadWorker(e){const r=K4e[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._jobQueue=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new t5e(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Kee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){return this.apply(e,[r],i)}apply(e,r,i){const s=i==null?void 0:i.signal,n=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new J(yge,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=_ge();return new Promise((a,l)=>{if(Zs(s))return this._processWork(),void l(hr());const c=lo(s,()=>{const h=this._outJobs.get(o);h&&(this._outJobs.delete(o),this._processWork(),wi(h.abortHandle),this._post({type:Qee,jobId:o}),l(hr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:ete,jobId:o,methodName:e,abortable:s!=null},r,n)})}createInvokeProxy(e,r){return vge(this,e,r)}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:zo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),Yr(()=>{i.port1.postMessage({type:zo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:tte,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=e5e)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.apply(r,i,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{wi(e.abortHandle),e.reject(hr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=WM(e);if(r)switch(r.type){case TC:this._onResponseMessage(r);break;case ete:this._invokeQueue.push(r);break;case Qee:this._onAbortMessage(r);break;case Kee:this._onCloseMessage();break;case tte:this._onOpenPortMessage(r);break;case Q4e:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&M2.clients.get(this)===e&&e.destroy(),M2.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const h=r.split(".");for(let p=0;p<h.length-1;p++)c=c[h[p]],u=c[h[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=u.apply(c,s)}catch(h){return void this._post({type:TC,jobId:i,error:qM(h)})}Rc(l)?(a.set(i,{controller:o,promise:l}),l.then(h=>{a.has(i)&&(a.delete(i),this._post({type:TC,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),ns(h)||this._post({type:TC,jobId:i,error:qM(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:TC,jobId:i},l)}_onOpenPortMessage(e){new M2(e.port,{client:this._client})}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=UE(e.port,"message",n=>{const o=WM(n);(o==null?void 0:o.type)===zo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),wi(o.abortHandle),i?o.reject(J.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return DY(this._port,e,r,i)}};F_.kernelInfo={buildDate:hme,fullVersion:xY,revision:dme},F_.clients=new Map;let r5e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new H4}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{vt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Rc(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new F_(c,r,this._ongoingJobsQueue),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new F_(l,r,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(hr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,q4e(this)}invoke(e,r,i){return this.apply(e,[r],i)}apply(e,r,i){const s=Wo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:i,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return s.promise}createInvokeProxy(e){return vge(this,e)}on(e,r){return Promise.all(this._clientPromises).then(()=>mw(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const i5e={async request(t,e){var o,a;const r=t.options,i=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=i==="native"||i==="native-request-init"?"native-request-init":i&&["blob","json","text"].includes(i)&&((o=ome(t.url))!=null&&o.after)?i:"array-buffer";const s=await Wr(t.url,r),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((a=s.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}};let IP;var gpe,ype;const s5e=((gpe=globalThis.esriConfig)==null?void 0:gpe.locale)??((ype=globalThis.dojoConfig)==null?void 0:ype.locale);function bge(){var t;return s5e??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function gu(){return IP===void 0&&(IP=bge()),IP}function n5e(t=gu()){const e=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const LP=[];function NY(t){return LP.push(t),Yr(()=>LP.splice(LP.indexOf(t),1))}const iG=[];function FY(t){return iG.push(t),Yr(()=>LP.splice(iG.indexOf(t),1))}function o5e(){const t=bge();IP!==t&&(IP=t,[...iG].forEach(e=>{e.call(null,t)}),[...LP].forEach(e=>{e.call(null,t)}))}var _pe;(_pe=globalThis.addEventListener)==null||_pe.call(globalThis,"languagechange",o5e);const rte=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class Kw extends Error{}class a5e extends Kw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class l5e extends Kw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class c5e extends Kw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class vT extends Kw{}class wge extends Kw{constructor(e){super(`Invalid unit ${e}`)}}class fc extends Kw{}class U0 extends Kw{constructor(){super("Zone is an abstract class")}}const rt="numeric",Tp="short",yu="long",q4={year:rt,month:rt,day:rt},xge={year:rt,month:Tp,day:rt},u5e={year:rt,month:Tp,day:rt,weekday:Tp},Tge={year:rt,month:yu,day:rt},Sge={year:rt,month:yu,day:rt,weekday:yu},Ege={hour:rt,minute:rt},Cge={hour:rt,minute:rt,second:rt},Age={hour:rt,minute:rt,second:rt,timeZoneName:Tp},Pge={hour:rt,minute:rt,second:rt,timeZoneName:yu},Mge={hour:rt,minute:rt,hourCycle:"h23"},Oge={hour:rt,minute:rt,second:rt,hourCycle:"h23"},Rge={hour:rt,minute:rt,second:rt,hourCycle:"h23",timeZoneName:Tp},$ge={hour:rt,minute:rt,second:rt,hourCycle:"h23",timeZoneName:yu},Ige={year:rt,month:rt,day:rt,hour:rt,minute:rt},Lge={year:rt,month:rt,day:rt,hour:rt,minute:rt,second:rt},Dge={year:rt,month:Tp,day:rt,hour:rt,minute:rt},Nge={year:rt,month:Tp,day:rt,hour:rt,minute:rt,second:rt},h5e={year:rt,month:Tp,day:rt,weekday:Tp,hour:rt,minute:rt},Fge={year:rt,month:yu,day:rt,hour:rt,minute:rt,timeZoneName:Tp},kge={year:rt,month:yu,day:rt,hour:rt,minute:rt,second:rt,timeZoneName:Tp},Uge={year:rt,month:yu,day:rt,weekday:yu,hour:rt,minute:rt,timeZoneName:yu},zge={year:rt,month:yu,day:rt,weekday:yu,hour:rt,minute:rt,second:rt,timeZoneName:yu};class rR{get type(){throw new U0}get name(){throw new U0}get ianaName(){return this.name}get isUniversal(){throw new U0}offsetName(e,r){throw new U0}formatOffset(e,r){throw new U0}offset(e){throw new U0}equals(e){throw new U0}get isValid(){throw new U0}}let iU=null;class I6 extends rR{static get instance(){return iU===null&&(iU=new I6),iU}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return Xge(e,r,i)}formatOffset(e,r){return DP(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let vD={};function d5e(t){return vD[t]||(vD[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),vD[t]}const p5e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function f5e(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,u]=i;return[o,s,n,a,l,c,u]}function m5e(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=p5e[n];n==="era"?i[a]=o:gr(a)||(i[a]=parseInt(o,10))}return i}let a$={};class Sp extends rR{static create(e){return a$[e]||(a$[e]=new Sp(e)),a$[e]}static resetCache(){a$={},vD={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Sp.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return Xge(e,r,i,this.name)}formatOffset(e,r){return DP(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=d5e(this.name);let[s,n,o,a,l,c,u]=i.formatToParts?m5e(i,r):f5e(i,r);a==="BC"&&(s=-Math.abs(s)+1);const p=D6({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let f=+r;const g=f%1e3;return f-=g>=0?g:1e3+g,(p-f)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let ite={};function g5e(t,e={}){const r=JSON.stringify([t,e]);let i=ite[r];return i||(i=new Intl.ListFormat(t,e),ite[r]=i),i}let sG={};function nG(t,e={}){const r=JSON.stringify([t,e]);let i=sG[r];return i||(i=new Intl.DateTimeFormat(t,e),sG[r]=i),i}let oG={};function y5e(t,e={}){const r=JSON.stringify([t,e]);let i=oG[r];return i||(i=new Intl.NumberFormat(t,e),oG[r]=i),i}let aG={};function _5e(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=aG[s];return n||(n=new Intl.RelativeTimeFormat(t,e),aG[s]=n),n}let R3=null;function v5e(){return R3||(R3=new Intl.DateTimeFormat().resolvedOptions().locale,R3)}let ste={};function b5e(t){let e=ste[t];if(!e){const r=new Intl.Locale(t);e="getWeekInfo"in r?r.getWeekInfo():r.weekInfo,ste[t]=e}return e}function w5e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=nG(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=nG(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function x5e(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function T5e(t){const e=[];for(let r=1;r<=12;r++){const i=Qt.utc(2009,r,1);e.push(t(i))}return e}function S5e(t){const e=[];for(let r=1;r<=7;r++){const i=Qt.utc(2016,11,13+r);e.push(t(i))}return e}function l$(t,e,r,i){const s=t.listingMode();return s==="error"?null:s==="en"?r(e):i(e)}function E5e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class C5e{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=y5e(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):BY(e,3);return so(r,this.padTo)}}}class A5e{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Sp.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=nG(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class P5e{constructor(e,r,i){this.opts={style:"long",...i},!r&&Wge()&&(this.rtf=_5e(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):Y5e(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}const M5e={firstDay:1,minimalDays:4,weekend:[6,7]};class as{static fromOpts(e){return as.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,r,i,s,n=!1){const o=e||Ln.defaultLocale,a=o||(n?"en-US":v5e()),l=r||Ln.defaultNumberingSystem,c=i||Ln.defaultOutputCalendar,u=lG(s)||Ln.defaultWeekSettings;return new as(a,l,c,u,o)}static resetCache(){R3=null,sG={},oG={},aG={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i,weekSettings:s}={}){return as.create(e,r,i,s)}constructor(e,r,i,s,n){const[o,a,l]=w5e(e);this.locale=o,this.numberingSystem=r||a||null,this.outputCalendar=i||l||null,this.weekSettings=s,this.intl=x5e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=E5e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:as.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,lG(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1){return l$(this,e,Kge,()=>{const i=r?{month:e,day:"numeric"}:{month:e},s=r?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=T5e(n=>this.extract(n,i,"month"))),this.monthsCache[s][e]})}weekdays(e,r=!1){return l$(this,e,t0e,()=>{const i=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=r?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=S5e(n=>this.extract(n,i,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return l$(this,void 0,()=>r0e,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Qt.utc(2016,11,13,9),Qt.utc(2016,11,13,19)].map(r=>this.extract(r,e,"dayperiod"))}return this.meridiemCache})}eras(e){return l$(this,e,i0e,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[Qt.utc(-40,1,1),Qt.utc(2017,1,1)].map(i=>this.extract(i,r,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new C5e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new A5e(e,this.intl,r)}relFormatter(e={}){return new P5e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return g5e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:Yge()?b5e(this.locale):M5e}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let sU=null;class Ya extends rR{static get utcInstance(){return sU===null&&(sU=new Ya(0)),sU}static instance(e){return e===0?Ya.utcInstance:new Ya(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Ya(N6(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${DP(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${DP(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return DP(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class O5e extends rR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Qy(t,e){if(gr(t)||t===null)return e;if(t instanceof rR)return t;if(I5e(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?I6.instance:r==="utc"||r==="gmt"?Ya.utcInstance:Ya.parseSpecifier(r)||Sp.create(t)}else return Kb(t)?Ya.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new O5e(t)}let nte=()=>Date.now(),ote="system",ate=null,lte=null,cte=null,ute=60,hte,dte=null;class Ln{static get now(){return nte}static set now(e){nte=e}static set defaultZone(e){ote=e}static get defaultZone(){return Qy(ote,I6.instance)}static get defaultLocale(){return ate}static set defaultLocale(e){ate=e}static get defaultNumberingSystem(){return lte}static set defaultNumberingSystem(e){lte=e}static get defaultOutputCalendar(){return cte}static set defaultOutputCalendar(e){cte=e}static get defaultWeekSettings(){return dte}static set defaultWeekSettings(e){dte=lG(e)}static get twoDigitCutoffYear(){return ute}static set twoDigitCutoffYear(e){ute=e%100}static get throwOnInvalid(){return hte}static set throwOnInvalid(e){hte=e}static resetCaches(){as.resetCache(),Sp.resetCache()}}class rp{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Bge=[0,31,59,90,120,151,181,212,243,273,304,334],Vge=[0,31,60,91,121,152,182,213,244,274,305,335];function bh(t,e){return new rp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function kY(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function Gge(t,e,r){return r+(iR(t)?Vge:Bge)[e-1]}function jge(t,e){const r=iR(t)?Vge:Bge,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function UY(t,e){return(t-e+7)%7+1}function W4(t,e=4,r=1){const{year:i,month:s,day:n}=t,o=Gge(i,s,n),a=UY(kY(i,s,n),r);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=i-1,l=YM(c,e,r)):l>YM(i,e,r)?(c=i+1,l=1):c=i,{weekYear:c,weekNumber:l,weekday:a,...F6(t)}}function pte(t,e=4,r=1){const{weekYear:i,weekNumber:s,weekday:n}=t,o=UY(kY(i,1,e),r),a=ZT(i);let l=s*7+n-o-7+e,c;l<1?(c=i-1,l+=ZT(c)):l>a?(c=i+1,l-=ZT(i)):c=i;const{month:u,day:h}=jge(c,l);return{year:c,month:u,day:h,...F6(t)}}function nU(t){const{year:e,month:r,day:i}=t,s=Gge(e,r,i);return{year:e,ordinal:s,...F6(t)}}function fte(t){const{year:e,ordinal:r}=t,{month:i,day:s}=jge(e,r);return{year:e,month:i,day:s,...F6(t)}}function mte(t,e){if(!gr(t.localWeekday)||!gr(t.localWeekNumber)||!gr(t.localWeekYear)){if(!gr(t.weekday)||!gr(t.weekNumber)||!gr(t.weekYear))throw new vT("Cannot mix locale-based week fields with ISO-based week fields");return gr(t.localWeekday)||(t.weekday=t.localWeekday),gr(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),gr(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function R5e(t,e=4,r=1){const i=L6(t.weekYear),s=wh(t.weekNumber,1,YM(t.weekYear,e,r)),n=wh(t.weekday,1,7);return i?s?n?!1:bh("weekday",t.weekday):bh("week",t.weekNumber):bh("weekYear",t.weekYear)}function $5e(t){const e=L6(t.year),r=wh(t.ordinal,1,ZT(t.year));return e?r?!1:bh("ordinal",t.ordinal):bh("year",t.year)}function Hge(t){const e=L6(t.year),r=wh(t.month,1,12),i=wh(t.day,1,Y4(t.year,t.month));return e?r?i?!1:bh("day",t.day):bh("month",t.month):bh("year",t.year)}function qge(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=wh(e,0,23)||e===24&&r===0&&i===0&&s===0,o=wh(r,0,59),a=wh(i,0,59),l=wh(s,0,999);return n?o?a?l?!1:bh("millisecond",s):bh("second",i):bh("minute",r):bh("hour",e)}function gr(t){return typeof t>"u"}function Kb(t){return typeof t=="number"}function L6(t){return typeof t=="number"&&t%1===0}function I5e(t){return typeof t=="string"}function L5e(t){return Object.prototype.toString.call(t)==="[object Date]"}function Wge(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Yge(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function D5e(t){return Array.isArray(t)?t:[t]}function gte(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function N5e(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function jS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function lG(t){if(t==null)return null;if(typeof t!="object")throw new fc("Week settings must be an object");if(!wh(t.firstDay,1,7)||!wh(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!wh(e,1,7)))throw new fc("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function wh(t,e,r){return L6(t)&&t>=e&&t<=r}function F5e(t,e){return t-e*Math.floor(t/e)}function so(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function Gy(t){if(!(gr(t)||t===null||t===""))return parseInt(t,10)}function $1(t){if(!(gr(t)||t===null||t===""))return parseFloat(t)}function zY(t){if(!(gr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function BY(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function iR(t){return t%4===0&&(t%100!==0||t%400===0)}function ZT(t){return iR(t)?366:365}function Y4(t,e){const r=F5e(e-1,12)+1,i=t+(e-r)/12;return r===2?iR(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function D6(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function yte(t,e,r){return-UY(kY(t,1,e),r)+e-1}function YM(t,e=4,r=1){const i=yte(t,e,r),s=yte(t+1,e,r);return(ZT(t)-i+s)/7}function cG(t){return t>99?t:t>Ln.twoDigitCutoffYear?1900+t:2e3+t}function Xge(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function N6(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Zge(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new fc(`Invalid unit value ${t}`);return e}function X4(t,e){const r={};for(const i in t)if(jS(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=Zge(s)}return r}function DP(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${so(r,2)}:${so(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${so(r,2)}${so(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function F6(t){return N5e(t,["hour","minute","second","millisecond"])}const k5e=["January","February","March","April","May","June","July","August","September","October","November","December"],Jge=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U5e=["J","F","M","A","M","J","J","A","S","O","N","D"];function Kge(t){switch(t){case"narrow":return[...U5e];case"short":return[...Jge];case"long":return[...k5e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Qge=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],e0e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],z5e=["M","T","W","T","F","S","S"];function t0e(t){switch(t){case"narrow":return[...z5e];case"short":return[...e0e];case"long":return[...Qge];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const r0e=["AM","PM"],B5e=["Before Christ","Anno Domini"],V5e=["BC","AD"],G5e=["B","A"];function i0e(t){switch(t){case"narrow":return[...G5e];case"short":return[...V5e];case"long":return[...B5e];default:return null}}function j5e(t){return r0e[t.hour<12?0:1]}function H5e(t,e){return t0e(e)[t.weekday-1]}function q5e(t,e){return Kge(e)[t.month-1]}function W5e(t,e){return i0e(e)[t.year<0?0:1]}function Y5e(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const h=t==="days";switch(e){case 1:return h?"tomorrow":`next ${s[t][0]}`;case-1:return h?"yesterday":`last ${s[t][0]}`;case 0:return h?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function _te(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const X5e={D:q4,DD:xge,DDD:Tge,DDDD:Sge,t:Ege,tt:Cge,ttt:Age,tttt:Pge,T:Mge,TT:Oge,TTT:Rge,TTTT:$ge,f:Ige,ff:Dge,fff:Fge,ffff:Uge,F:Lge,FF:Nge,FFF:kge,FFFF:zge};class qa{static create(e,r={}){return new qa(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return X5e[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}dtFormatter(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r})}formatDateTime(e,r){return this.dtFormatter(e,r).format()}formatDateTimeParts(e,r){return this.dtFormatter(e,r).formatToParts()}formatInterval(e,r){return this.dtFormatter(e.start,r).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r){return this.dtFormatter(e,r).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return so(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(f,g)=>this.loc.extract(e,f,g),o=f=>e.isOffsetFixed&&e.offset===0&&f.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,f.format):"",a=()=>i?j5e(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(f,g)=>i?q5e(e,f):n(g?{month:f}:{month:f,day:"numeric"},"month"),c=(f,g)=>i?H5e(e,f):n(g?{weekday:f}:{weekday:f,month:"long",day:"numeric"},"weekday"),u=f=>{const g=qa.macroTokenToFormatOpts(f);return g?this.formatWithSystemDefault(e,g):f},h=f=>i?W5e(e,f):n({era:f},"era"),p=f=>{switch(f){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(f)}};return _te(qa.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},n=qa.parseFormat(r),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return _te(n,s(a))}}const s0e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function GE(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function jE(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function HE(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function n0e(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=Gy(e[r+s]);return[i,null,r+s]}}const o0e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Z5e=`(?:${o0e.source}?(?:\\[(${s0e.source})\\])?)?`,VY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,a0e=RegExp(`${VY.source}${Z5e}`),GY=RegExp(`(?:T${a0e.source})?`),J5e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,K5e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Q5e=/(\d{4})-?(\d{3})/,eFe=n0e("weekYear","weekNumber","weekDay"),tFe=n0e("year","ordinal"),rFe=/(\d{4})-(\d\d)-(\d\d)/,l0e=RegExp(`${VY.source} ?(?:${o0e.source}|(${s0e.source}))?`),iFe=RegExp(`(?: ${l0e.source})?`);function JT(t,e,r){const i=t[e];return gr(i)?r:Gy(i)}function sFe(t,e){return[{year:JT(t,e),month:JT(t,e+1,1),day:JT(t,e+2,1)},null,e+3]}function qE(t,e){return[{hours:JT(t,e,0),minutes:JT(t,e+1,0),seconds:JT(t,e+2,0),milliseconds:zY(t[e+3])},null,e+4]}function sR(t,e){const r=!t[e]&&!t[e+1],i=N6(t[e+1],t[e+2]),s=r?null:Ya.instance(i);return[{},s,e+3]}function nR(t,e){const r=t[e]?Sp.create(t[e]):null;return[{},r,e+1]}const nFe=RegExp(`^T?${VY.source}$`),oFe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function aFe(t){const[e,r,i,s,n,o,a,l,c]=t,u=e[0]==="-",h=l&&l[0]==="-",p=(f,g=!1)=>f!==void 0&&(g||f&&u)?-f:f;return[{years:p($1(r)),months:p($1(i)),weeks:p($1(s)),days:p($1(n)),hours:p($1(o)),minutes:p($1(a)),seconds:p($1(l),l==="-0"),milliseconds:p(zY(c),h)}]}const lFe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function jY(t,e,r,i,s,n,o){const a={year:e.length===2?cG(Gy(e)):Gy(e),month:Jge.indexOf(r)+1,day:Gy(i),hour:Gy(s),minute:Gy(n)};return o&&(a.second=Gy(o)),t&&(a.weekday=t.length>3?Qge.indexOf(t)+1:e0e.indexOf(t)+1),a}const cFe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function uFe(t){const[,e,r,i,s,n,o,a,l,c,u,h]=t,p=jY(e,s,i,r,n,o,a);let f;return l?f=lFe[l]:c?f=0:f=N6(u,h),[p,new Ya(f)]}function hFe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const dFe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,pFe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,fFe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function vte(t){const[,e,r,i,s,n,o,a]=t;return[jY(e,s,i,r,n,o,a),Ya.utcInstance]}function mFe(t){const[,e,r,i,s,n,o,a]=t;return[jY(e,a,r,i,s,n,o),Ya.utcInstance]}const gFe=GE(J5e,GY),yFe=GE(K5e,GY),_Fe=GE(Q5e,GY),vFe=GE(a0e),c0e=jE(sFe,qE,sR,nR),bFe=jE(eFe,qE,sR,nR),wFe=jE(tFe,qE,sR,nR),xFe=jE(qE,sR,nR);function TFe(t){return HE(t,[gFe,c0e],[yFe,bFe],[_Fe,wFe],[vFe,xFe])}function SFe(t){return HE(hFe(t),[cFe,uFe])}function EFe(t){return HE(t,[dFe,vte],[pFe,vte],[fFe,mFe])}function CFe(t){return HE(t,[oFe,aFe])}const AFe=jE(qE);function PFe(t){return HE(t,[nFe,AFe])}const MFe=GE(rFe,iFe),OFe=GE(l0e),RFe=jE(qE,sR,nR);function $Fe(t){return HE(t,[MFe,c0e],[OFe,RFe])}const bte="Invalid Duration",u0e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},IFe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...u0e},Ru=146097/400,_x=146097/4800,LFe={years:{quarters:4,months:12,weeks:Ru/7,days:Ru,hours:Ru*24,minutes:Ru*24*60,seconds:Ru*24*60*60,milliseconds:Ru*24*60*60*1e3},quarters:{months:3,weeks:Ru/28,days:Ru/4,hours:Ru*24/4,minutes:Ru*24*60/4,seconds:Ru*24*60*60/4,milliseconds:Ru*24*60*60*1e3/4},months:{weeks:_x/7,days:_x,hours:_x*24,minutes:_x*24*60,seconds:_x*24*60*60,milliseconds:_x*24*60*60*1e3},...u0e},Rb=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],DFe=Rb.slice(0).reverse();function z0(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ti(i)}function h0e(t,e){let r=e.milliseconds??0;for(const i of DFe.slice(1))e[i]&&(r+=e[i]*t[i].milliseconds);return r}function wte(t,e){const r=h0e(t,e)<0?-1:1;Rb.reduceRight((i,s)=>{if(gr(e[s]))return i;if(i){const n=e[i]*r,o=t[s][i],a=Math.floor(n/o);e[s]+=a*r,e[i]-=a*o*r}return s},null),Rb.reduce((i,s)=>{if(gr(e[s]))return i;if(i){const n=e[i]%1;e[i]-=n,e[s]+=n*t[i][s]}return s},null)}function NFe(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Ti{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?LFe:IFe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||as.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Ti.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new fc(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ti({values:X4(e,Ti.normalizeUnit),loc:as.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(Kb(e))return Ti.fromMillis(e);if(Ti.isDuration(e))return e;if(typeof e=="object")return Ti.fromObject(e);throw new fc(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=CFe(e);return i?Ti.fromObject(i,r):Ti.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=PFe(e);return i?Ti.fromObject(i,r):Ti.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new fc("need to specify a reason the Duration is invalid");const i=e instanceof rp?e:new rp(e,r);if(Ln.throwOnInvalid)throw new c5e(i);return new Ti({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new wge(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?qa.create(this.loc,i).formatDurationFromString(this,e):bte}toHuman(e={}){if(!this.isValid)return bte;const r=Rb.map(i=>{const s=this.values[i];return gr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=BY(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();return r<0||r>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},Qt.fromMillis(r,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?h0e(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e),i={};for(const s of Rb)(jS(r.values,s)||jS(this.values,s))&&(i[s]=r.get(s)+this.get(s));return z0(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Zge(e(this.values[i],i));return z0(this,{values:r},!0)}get(e){return this[Ti.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...X4(e,Ti.normalizeUnit)};return z0(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return z0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return wte(this.matrix,e),z0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=NFe(this.normalize().shiftToAll().toObject());return z0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Ti.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of Rb)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;Kb(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3}else Kb(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return wte(this.matrix,r),z0(this,{values:r},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return z0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of Rb)if(!r(this.values[i],e.values[i]))return!1;return!0}}const vx="Invalid Interval";function FFe(t,e){return!t||!t.isValid?gn.invalid("missing or invalid start"):!e||!e.isValid?gn.invalid("missing or invalid end"):e<t?gn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class gn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new fc("need to specify a reason the Interval is invalid");const i=e instanceof rp?e:new rp(e,r);if(Ln.throwOnInvalid)throw new l5e(i);return new gn({invalid:i})}static fromDateTimes(e,r){const i=EC(e),s=EC(r),n=FFe(i,s);return n??new gn({start:i,end:s})}static after(e,r){const i=Ti.fromDurationLike(r),s=EC(e);return gn.fromDateTimes(s,s.plus(i))}static before(e,r){const i=Ti.fromDurationLike(r),s=EC(e);return gn.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=Qt.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=Qt.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return gn.fromDateTimes(n,a);if(o){const c=Ti.fromISO(s,r);if(c.isValid)return gn.after(n,c)}else if(l){const c=Ti.fromISO(i,r);if(c.isValid)return gn.before(a,c)}}return gn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",r){if(!this.isValid)return NaN;const i=this.start.startOf(e,r);let s;return r!=null&&r.useLocaleWeeks?s=this.end.reconfigure({locale:i.locale}):s=this.end,s=s.startOf(e,r),Math.floor(s.diff(i,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?gn.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(EC).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(gn.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=Ti.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(gn.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:gn.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return gn.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(gn.fromDateTimes(r,l.time)),r=null);return gn.merge(s)}difference(...e){return gn.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} â€“ ${this.e.toISO()})`:vx}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=q4,r={}){return this.isValid?qa.create(this.s.loc.clone(r),e).formatInterval(this):vx}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:vx}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:vx}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:vx}toFormat(e,{separator:r=" â€“ "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:vx}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Ti.invalid(this.invalidReason)}mapEndpoints(e){return gn.fromDateTimes(e(this.s),e(this.e))}}class c${static hasDST(e=Ln.defaultZone){const r=Qt.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return Sp.isValidZone(e)}static normalizeZone(e){return Qy(e,Ln.defaultZone)}static getStartOfWeek({locale:e=null,locObj:r=null}={}){return(r||as.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:r=null}={}){return(r||as.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:r=null}={}){return(r||as.create(e)).getWeekendDays().slice()}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||as.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||as.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||as.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||as.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return as.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return as.create(r,null,"gregory").eras(e)}static features(){return{relative:Wge(),localeWeek:Yge()}}}function xte(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Ti.fromMillis(i).as("days"))}function kFe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=xte(l,c);return(u-u%7)/7}],["days",xte]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function UFe(t,e,r,i){let[s,n,o,a]=kFe(t,e,r);const l=e-s,c=r.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=Ti.fromObject(n,i);return c.length>0?Ti.fromMillis(l,i).shiftTo(...c).plus(u):u}const HY={arab:"[Ù -Ù©]",arabext:"[Û°-Û¹]",bali:"[á­-á­™]",beng:"[à§¦-à§¯]",deva:"[à¥¦-à¥¯]",fullwide:"[ï¼-ï¼™]",gujr:"[à«¦-à«¯]",hanidec:"[ã€‡|ä¸€|äºŒ|ä¸‰|å››|äº”|å…­|ä¸ƒ|å…«|ä¹]",khmr:"[áŸ -áŸ©]",knda:"[à³¦-à³¯]",laoo:"[à»-à»™]",limb:"[á¥†-á¥]",mlym:"[àµ¦-àµ¯]",mong:"[á -á ™]",mymr:"[á€-á‰]",orya:"[à­¦-à­¯]",tamldec:"[à¯¦-à¯¯]",telu:"[à±¦-à±¯]",thai:"[à¹-à¹™]",tibt:"[à¼ -à¼©]",latn:"\\d"},Tte={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},zFe=HY.hanidec.replace(/[\[|\]]/g,"").split("");function BFe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(HY.hanidec)!==-1)e+=zFe.indexOf(t[r]);else for(const s in Tte){const[n,o]=Tte[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function td({numberingSystem:t},e=""){return new RegExp(`${HY[t||"latn"]}${e}`)}const VFe="missing Intl.DateTimeFormat.formatToParts support";function Di(t,e=r=>r){return{regex:t,deser:([r])=>e(BFe(r))}}const GFe="Â ",d0e=`[ ${GFe}]`,p0e=new RegExp(d0e,"g");function jFe(t){return t.replace(/\./g,"\\.?").replace(p0e,d0e)}function Ste(t){return t.replace(/\./g,"").replace(p0e," ").toLowerCase()}function rd(t,e){return t===null?null:{regex:RegExp(t.map(jFe).join("|")),deser:([r])=>t.findIndex(i=>Ste(r)===Ste(i))+e}}function Ete(t,e){return{regex:t,deser:([,r,i])=>N6(r,i),groups:e}}function u$(t){return{regex:t,deser:([e])=>e}}function HFe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function qFe(t,e){const r=td(e),i=td(e,"{2}"),s=td(e,"{3}"),n=td(e,"{4}"),o=td(e,"{6}"),a=td(e,"{1,2}"),l=td(e,"{1,3}"),c=td(e,"{1,6}"),u=td(e,"{1,9}"),h=td(e,"{2,4}"),p=td(e,"{4,6}"),f=v=>({regex:RegExp(HFe(v.val)),deser:([b])=>b,literal:!0}),_=(v=>{if(t.literal)return f(v);switch(v.val){case"G":return rd(e.eras("short"),0);case"GG":return rd(e.eras("long"),0);case"y":return Di(c);case"yy":return Di(h,cG);case"yyyy":return Di(n);case"yyyyy":return Di(p);case"yyyyyy":return Di(o);case"M":return Di(a);case"MM":return Di(i);case"MMM":return rd(e.months("short",!0),1);case"MMMM":return rd(e.months("long",!0),1);case"L":return Di(a);case"LL":return Di(i);case"LLL":return rd(e.months("short",!1),1);case"LLLL":return rd(e.months("long",!1),1);case"d":return Di(a);case"dd":return Di(i);case"o":return Di(l);case"ooo":return Di(s);case"HH":return Di(i);case"H":return Di(a);case"hh":return Di(i);case"h":return Di(a);case"mm":return Di(i);case"m":return Di(a);case"q":return Di(a);case"qq":return Di(i);case"s":return Di(a);case"ss":return Di(i);case"S":return Di(l);case"SSS":return Di(s);case"u":return u$(u);case"uu":return u$(a);case"uuu":return Di(r);case"a":return rd(e.meridiems(),0);case"kkkk":return Di(n);case"kk":return Di(h,cG);case"W":return Di(a);case"WW":return Di(i);case"E":case"c":return Di(r);case"EEE":return rd(e.weekdays("short",!1),1);case"EEEE":return rd(e.weekdays("long",!1),1);case"ccc":return rd(e.weekdays("short",!0),1);case"cccc":return rd(e.weekdays("long",!0),1);case"Z":case"ZZ":return Ete(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Ete(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return u$(/[a-z_+-/]{1,256}?/i);case" ":return u$(/[^\S\n\r]/);default:return f(v)}})(t)||{invalidReason:VFe};return _.token=t,_}const WFe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function YFe(t,e,r){const{type:i,value:s}=t;if(i==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[i];let o=i;i==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=r.hour12?"hour12":"hour24");let a=WFe[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function XFe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function ZFe(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(jS(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function JFe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return gr(t.z)||(r=Sp.create(t.z)),gr(t.Z)||(r||(r=new Ya(t.Z)),i=t.Z),gr(t.q)||(t.M=(t.q-1)*3+1),gr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),gr(t.u)||(t.S=zY(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let oU=null;function KFe(){return oU||(oU=Qt.fromMillis(1555555555555)),oU}function QFe(t,e){if(t.literal)return t;const r=qa.macroTokenToFormatOpts(t.val),i=g0e(r,e);return i==null||i.includes(void 0)?t:i}function f0e(t,e){return Array.prototype.concat(...t.map(r=>QFe(r,e)))}function m0e(t,e,r){const i=f0e(qa.parseFormat(r),t),s=i.map(o=>qFe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=XFe(s),l=RegExp(o,"i"),[c,u]=ZFe(e,l,a),[h,p,f]=u?JFe(u):[null,null,void 0];if(jS(u,"a")&&jS(u,"H"))throw new vT("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:h,zone:p,specificOffset:f}}}function e6e(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=m0e(t,e,r);return[i,s,n,o]}function g0e(t,e){if(!t)return null;const i=qa.create(e,t).dtFormatter(KFe()),s=i.formatToParts(),n=i.resolvedOptions();return s.map(o=>YFe(o,t,n))}const aU="Invalid DateTime",Cte=864e13;function h$(t){return new rp("unsupported zone",`the zone "${t.name}" is not supported`)}function lU(t){return t.weekData===null&&(t.weekData=W4(t.c)),t.weekData}function cU(t){return t.localWeekData===null&&(t.localWeekData=W4(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function I1(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Qt({...r,...e,old:r})}function y0e(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function d$(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function bD(t,e,r){return y0e(D6(t),e,r)}function Ate(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,Y4(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Ti.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=D6(n);let[l,c]=y0e(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function SC(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=Qt.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Qt.invalid(new rp("unparsable",`the input "${s}" can't be parsed as ${i}`))}function p$(t,e,r=!0){return t.isValid?qa.create(as.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function uU(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=so(t.c.year,r?6:4),e?(i+="-",i+=so(t.c.month),i+="-",i+=so(t.c.day)):(i+=so(t.c.month),i+=so(t.c.day)),i}function Pte(t,e,r,i,s,n){let o=so(t.c.hour);return e?(o+=":",o+=so(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=":")):o+=so(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=so(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=so(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=so(Math.trunc(-t.o/60)),o+=":",o+=so(Math.trunc(-t.o%60))):(o+="+",o+=so(Math.trunc(t.o/60)),o+=":",o+=so(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const _0e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},t6e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},r6e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},v0e=["year","month","day","hour","minute","second","millisecond"],i6e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],s6e=["year","ordinal","hour","minute","second","millisecond"];function n6e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new wge(t);return e}function Mte(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return n6e(t)}}function Ote(t,e){const r=Qy(e.zone,Ln.defaultZone),i=as.fromObject(e),s=Ln.now();let n,o;if(gr(t.year))n=s;else{for(const c of v0e)gr(t[c])&&(t[c]=_0e[c]);const a=Hge(t)||qge(t);if(a)return Qt.invalid(a);const l=r.offset(s);[n,o]=bD(t,l,r)}return new Qt({ts:n,zone:r,loc:i,o})}function Rte(t,e,r){const i=gr(r.round)?!0:r.round,s=(o,a)=>(o=BY(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function $te(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class Qt{constructor(e){const r=e.zone||Ln.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new rp("invalid input"):null)||(r.isValid?null:h$(r));this.ts=gr(e.ts)?Ln.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=d$(this.ts,a),i=Number.isNaN(s.year)?new rp("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||as.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Qt({})}static local(){const[e,r]=$te(arguments),[i,s,n,o,a,l,c]=r;return Ote({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=$te(arguments),[i,s,n,o,a,l,c]=r;return e.zone=Ya.utcInstance,Ote({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=L5e(e)?e.valueOf():NaN;if(Number.isNaN(i))return Qt.invalid("invalid input");const s=Qy(r.zone,Ln.defaultZone);return s.isValid?new Qt({ts:i,zone:s,loc:as.fromObject(r)}):Qt.invalid(h$(s))}static fromMillis(e,r={}){if(Kb(e))return e<-Cte||e>Cte?Qt.invalid("Timestamp out of range"):new Qt({ts:e,zone:Qy(r.zone,Ln.defaultZone),loc:as.fromObject(r)});throw new fc(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(Kb(e))return new Qt({ts:e*1e3,zone:Qy(r.zone,Ln.defaultZone),loc:as.fromObject(r)});throw new fc("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=Qy(r.zone,Ln.defaultZone);if(!i.isValid)return Qt.invalid(h$(i));const s=as.fromObject(r),n=X4(e,Mte),{minDaysInFirstWeek:o,startOfWeek:a}=mte(n,s),l=Ln.now(),c=gr(r.specificOffset)?i.offset(l):r.specificOffset,u=!gr(n.ordinal),h=!gr(n.year),p=!gr(n.month)||!gr(n.day),f=h||p,g=n.weekYear||n.weekNumber;if((f||u)&&g)throw new vT("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&u)throw new vT("Can't mix ordinal dates with month/day");const _=g||n.weekday&&!f;let v,b,w=d$(l,c);_?(v=i6e,b=t6e,w=W4(w,o,a)):u?(v=s6e,b=r6e,w=nU(w)):(v=v0e,b=_0e);let T=!1;for(const U of v){const j=n[U];gr(j)?T?n[U]=b[U]:n[U]=w[U]:T=!0}const S=_?R5e(n,o,a):u?$5e(n):Hge(n),C=S||qge(n);if(C)return Qt.invalid(C);const P=_?pte(n,o,a):u?fte(n):n,[R,L]=bD(P,c,i),F=new Qt({ts:R,zone:i,o:L,loc:s});return n.weekday&&f&&e.weekday!==F.weekday?Qt.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${F.toISO()}`):F}static fromISO(e,r={}){const[i,s]=TFe(e);return SC(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=SFe(e);return SC(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=EFe(e);return SC(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(gr(e)||gr(r))throw new fc("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=as.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=e6e(o,e,r);return u?Qt.invalid(u):SC(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return Qt.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=$Fe(e);return SC(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new fc("need to specify a reason the DateTime is invalid");const i=e instanceof rp?e:new rp(e,r);if(Ln.throwOnInvalid)throw new a5e(i);return new Qt({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=g0e(e,as.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return f0e(qa.parseFormat(e),as.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?lU(this).weekYear:NaN}get weekNumber(){return this.isValid?lU(this).weekNumber:NaN}get weekday(){return this.isValid?lU(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?cU(this).weekday:NaN}get localWeekNumber(){return this.isValid?cU(this).weekNumber:NaN}get localWeekYear(){return this.isValid?cU(this).weekYear:NaN}get ordinal(){return this.isValid?nU(this.c).ordinal:NaN}get monthShort(){return this.isValid?c$.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?c$.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?c$.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?c$.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,r=6e4,i=D6(this.c),s=this.zone.offset(i-e),n=this.zone.offset(i+e),o=this.zone.offset(i-s*r),a=this.zone.offset(i-n*r);if(o===a)return[this];const l=i-o*r,c=i-a*r,u=d$(l,o),h=d$(c,a);return u.hour===h.hour&&u.minute===h.minute&&u.second===h.second&&u.millisecond===h.millisecond?[I1(this,{ts:l}),I1(this,{ts:c})]:[this]}get isInLeapYear(){return iR(this.year)}get daysInMonth(){return Y4(this.year,this.month)}get daysInYear(){return this.isValid?ZT(this.year):NaN}get weeksInWeekYear(){return this.isValid?YM(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?YM(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=qa.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(Ya.instance(e),r)}toLocal(){return this.setZone(Ln.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=Qy(e,Ln.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=bD(o,n,e)}return I1(this,{ts:s,zone:e})}else return Qt.invalid(h$(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return I1(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=X4(e,Mte),{minDaysInFirstWeek:i,startOfWeek:s}=mte(r,this.loc),n=!gr(r.weekYear)||!gr(r.weekNumber)||!gr(r.weekday),o=!gr(r.ordinal),a=!gr(r.year),l=!gr(r.month)||!gr(r.day),c=a||l,u=r.weekYear||r.weekNumber;if((c||o)&&u)throw new vT("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new vT("Can't mix ordinal dates with month/day");let h;n?h=pte({...W4(this.c,i,s),...r},i,s):gr(r.ordinal)?(h={...this.toObject(),...r},gr(r.day)&&(h.day=Math.min(Y4(h.year,h.month),h.day))):h=fte({...nU(this.c),...r});const[p,f]=bD(h,this.o,this.zone);return I1(this,{ts:p,o:f})}plus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e);return I1(this,Ate(this,r))}minus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e).negate();return I1(this,Ate(this,r))}startOf(e,{useLocaleWeeks:r=!1}={}){if(!this.isValid)return this;const i={},s=Ti.normalizeUnit(e);switch(s){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(s==="weeks")if(r){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(i.weekNumber=this.weekNumber-1),i.weekday=n}else i.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);i.month=(n-1)*3+1}return this.set(i)}endOf(e,r){return this.isValid?this.plus({[e]:1}).startOf(e,r).minus(1):this}toFormat(e,r={}){return this.isValid?qa.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):aU}toLocaleString(e=q4,r={}){return this.isValid?qa.create(this.loc.clone(r),e).formatDateTime(this):aU}toLocaleParts(e={}){return this.isValid?qa.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=uU(this,o);return a+="T",a+=Pte(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?uU(this,e==="extended"):null}toISOWeekDate(){return p$(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Pte(this,o==="extended",r,e,i,n):null}toRFC2822(){return p$(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return p$(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?uU(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),p$(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():aU}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Ti.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=D5e(r).map(Ti.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=UFe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(Qt.now(),e,r)}until(e){return this.isValid?gn.fromDateTimes(this,e):this}hasSame(e,r,i){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(r,i)<=s&&s<=n.endOf(r,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||Qt.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Rte(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Rte(e.base||Qt.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Qt.isDateTime))throw new fc("min requires all arguments be DateTimes");return gte(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(Qt.isDateTime))throw new fc("max requires all arguments be DateTimes");return gte(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=as.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return m0e(o,e,r)}static fromStringExplain(e,r,i={}){return Qt.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return q4}static get DATE_MED(){return xge}static get DATE_MED_WITH_WEEKDAY(){return u5e}static get DATE_FULL(){return Tge}static get DATE_HUGE(){return Sge}static get TIME_SIMPLE(){return Ege}static get TIME_WITH_SECONDS(){return Cge}static get TIME_WITH_SHORT_OFFSET(){return Age}static get TIME_WITH_LONG_OFFSET(){return Pge}static get TIME_24_SIMPLE(){return Mge}static get TIME_24_WITH_SECONDS(){return Oge}static get TIME_24_WITH_SHORT_OFFSET(){return Rge}static get TIME_24_WITH_LONG_OFFSET(){return $ge}static get DATETIME_SHORT(){return Ige}static get DATETIME_SHORT_WITH_SECONDS(){return Lge}static get DATETIME_MED(){return Dge}static get DATETIME_MED_WITH_SECONDS(){return Nge}static get DATETIME_MED_WITH_WEEKDAY(){return h5e}static get DATETIME_FULL(){return Fge}static get DATETIME_FULL_WITH_SECONDS(){return kge}static get DATETIME_HUGE(){return Uge}static get DATETIME_HUGE_WITH_SECONDS(){return zge}}function EC(t){if(Qt.isDateTime(t))return t;if(t&&t.valueOf&&Kb(t.valueOf()))return Qt.fromJSDate(t);if(t&&typeof t=="object")return Qt.fromObject(t);throw new fc(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const ym="system",qY="unknown",XM="UTC",o6e=Intl.DateTimeFormat().resolvedOptions().timeZone,a6e="shortOffset";function l6e(t){return"timeZoneIANA"in t}function c6e(t){return t.startsWith("UTC")}function IMt(t,e=!1){return{json:{read:{source:t,reader:(r,i)=>i[t]?u6e(i[t]):null},write:!!e&&{allowNull:!0,writer(r,i){i[t]=r?h6e(r):null}}}}}function u6e(t,e=ym){return t?l6e(t)?t.timeZoneIANA:d6e(t,e):e}function h6e(t){return{timeZoneIANA:t}}function d6e(t,e=ym){if(!t||!rte.has(t.timeZone))return e;const r=rte.get(t.timeZone);return c6e(t.timeZone)||t.respectsDaylightSaving?r:p6e(r)}function p6e(t){const e=Qt.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${Ya.instance(-r).formatOffset(0,"narrow")}`}function LMt(t,e,r,i,s){if(e&&s==="date")return{timeZone:XM,timeZoneName:void 0};const n=i.timeStyle||i.hour,o=r===qY;return{timeZone:o?s==="timestamp-offset"?void 0:t??XM:r,timeZoneName:o&&n?a6e:void 0}}const f6e={year:void 0,month:void 0,day:void 0,weekday:void 0},m6e={hour:void 0,minute:void 0,second:void 0},b0e={timeZone:XM},Up={year:"numeric",month:"numeric",day:"numeric"},CC={year:"numeric",month:"long",day:"numeric"},AC={year:"numeric",month:"short",day:"numeric"},PC={year:"numeric",month:"long",weekday:"long",day:"numeric"},jy={hour:"numeric",minute:"numeric"},vv={...jy,second:"numeric"},w0e={hourCycle:"h23"},MC={...jy,...w0e},OC={...vv,...w0e},x0e={"short-date":Up,"short-date-short-time":{...Up,...jy},"short-date-short-time-24":{...Up,...MC},"short-date-long-time":{...Up,...vv},"short-date-long-time-24":{...Up,...OC},"short-date-le":Up,"short-date-le-short-time":{...Up,...jy},"short-date-le-short-time-24":{...Up,...MC},"short-date-le-long-time":{...Up,...vv},"short-date-le-long-time-24":{...Up,...OC},"long-month-day-year":CC,"long-month-day-year-short-time":{...CC,...jy},"long-month-day-year-short-time-24":{...CC,...MC},"long-month-day-year-long-time":{...CC,...vv},"long-month-day-year-long-time-24":{...CC,...OC},"day-short-month-year":AC,"day-short-month-year-short-time":{...AC,...jy},"day-short-month-year-short-time-24":{...AC,...MC},"day-short-month-year-long-time":{...AC,...vv},"day-short-month-year-long-time-24":{...AC,...OC},"long-date":PC,"long-date-short-time":{...PC,...jy},"long-date-short-time-24":{...PC,...MC},"long-date-long-time":{...PC,...vv},"long-date-long-time-24":{...PC,...OC},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":jy,"long-time":vv},g6e=Ul()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),T0e={ar:"ar-u-nu-latn-ca-gregory"};let uG=new WeakMap;const k6=x0e["short-date-short-time"];function y6e(t){let e=uG.get(t);if(!e){const r=gu(),i=T0e[r]||r,s=WY(t.timeZone??ym),n={...t,timeZone:s};e=new Intl.DateTimeFormat(i,n),uG.set(t,e)}return e}function _6e(t){return x0e[t]}function U6(t,e=k6){return y6e(e).format(t)}function DMt(t,e=k6){return U6(new Date(t),{...e,...b0e,...m6e})}function NMt(t,e=k6){return U6(new Date(`1970-01-01T${t}Z`),{...e,...b0e,...f6e})}function FMt(t,e=k6){if(e.timeZone)return U6(new Date(t),e);const r=Qt.fromISO(t,{setZone:!0}),i=gu(),s=T0e[i]??i,n=r.offset===0?XM:e.timeZone,o={...e,timeZone:n};return r.toLocaleString(o,{locale:s})}function WY(t){switch(t){case ym:return o6e;case qY:return XM;default:return t}}FY(()=>{uG=new WeakMap});const v6e={ar:"ar-u-nu-latn"};let wD=new WeakMap,S0e={};function b6e(t){const e=t||S0e;if(!wD.has(e)){const r=gu(),i=v6e[gu()]||r;wD.set(e,new Intl.NumberFormat(i,t))}return wD.get(e)}function kMt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function w6e(t,e){return Object.is(t,-0)&&(t=0),b6e(e).format(t)}FY(()=>{wD=new WeakMap,S0e={}});const Ite=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,x6e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Lte(t){return t in x6e}const $3=[],KT=new Map;function Dte(t){for(const e of KT.keys())E0e(t.pattern,e)&&KT.delete(e)}function T6e(t){return $3.includes(t)||(Dte(t),$3.unshift(t)),Yr(()=>{const e=$3.indexOf(t);e>-1&&($3.splice(e,1),Dte(t))})}async function YY(t){const e=gu();KT.has(t)||KT.set(t,E6e(t,e));const r=KT.get(t);return r&&await C6e.add(r),r}function S6e(t){if(!Ite.test(t))return null;const e=Ite.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return Lte(s)?s:Lte(r)?r:null}async function E6e(t,e){const r=[];for(const i of $3)if(E0e(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new J("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new J("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function E0e(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}FY(()=>{KT.clear()});const C6e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Wo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function A6e(t,e,r,i){const s=e.exec(r);if(!s)throw new J("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=S6e(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await Nte(t(c))}catch(h){if(c===l)throw new J("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h});try{u=await Nte(t(l))}catch(p){throw new J("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function Nte(t){if(Fte.fetchBundleAsset!=null)return Fte.fetchBundleAsset(t);const e=await Wr(t,{responseType:"text"});return JSON.parse(e.data)}let P6e=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return A6e(this.getAssetUrl,this.matcher,e,r)}};function M6e(t){return new P6e(t)}const Fte={};T6e(M6e({pattern:"esri/",location:ai}));const O6e={};function R6e(t){var r;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((r=t.packages)==null?void 0:r.concat())||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=O6e.baseUrl),e}let $6e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},xD=class{constructor(){this._dispatcher=new $6e,this._workerPostMessage({type:zo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){RS(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){RS(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=WM(e);if(r&&r.type===zo.OPEN){const{modulePath:i,jobId:s}=r;let n=await F_.loadWorker(i);n||(n=await import(i));const o=F_.connect(n);this._workerPostMessage({type:zo.OPENED,jobId:s,data:o})}}};const hG=()=>ae.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:I6e}=zo,L6e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let f$,m$;const kte="Failed to create Worker. Fallback to execute module in main thread";async function D6e(){if(!se("esri-workers"))return Ute(new xD);if(!f$&&!m$)try{const e=L6e.split('"{CONFIGURATION}"').join(`'${N6e()}'`);f$=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){m$=e||{}}let t;if(f$)try{t=new Worker(f$,{name:"esri-worker-"+F6e++})}catch{hG().warn(kte,m$),t=new xD}else hG().warn(kte,m$),t=new xD;return Ute(t)}async function Ute(t){return new Promise(e=>{function r(s){const n=WM(s);n&&n.type===I6e&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),hG().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new xD).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function N6e(){let t;if(ii.default!=null){const s={...ii};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(ii));t.assetsPath=au(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?au(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=gu(),t.has={"esri-csp-restrictions":se("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":se("esri-2d-update-debug"),"esri-2d-log-updating":se("esri-2d-log-updating"),"featurelayer-pbf":se("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":se("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":se("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":se("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":se("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":se("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":se("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":se("featurelayer-snapshot-enabled"),"esri-atomics":se("esri-atomics"),"esri-shared-array-buffer":se("esri-shared-array-buffer"),"esri-tiles-debug":se("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":se("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":se("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=au(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=au(t.workers.workerPath):t.workers.workerPath=au(ai("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=ii.workers.loaderConfig,r=R6e({baseUrl:e==null?void 0:e.baseUrl,locale:gu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:hme,fullVersion:xY,revision:dme}})}let F6e=0;const{ABORT:zte,INVOKE:k6e,OPEN:U6e,OPENED:z6e,RESPONSE:RC}=zo;let B6e=class C0e{static async create(e){const r=await D6e();return new C0e(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),ae.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=_ge();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:d6(i,()=>{this._outJobs.delete(s),this._post({type:zte,jobId:s})})};this._outJobs.set(s,a),this._post({type:U6e,jobId:s,modulePath:e})})}_onMessage(e){const r=WM(e);if(r)switch(r.type){case z6e:this._onOpenedMessage(r);break;case RC:this._onResponseMessage(r);break;case zte:this._onAbortMessage(r);break;case k6e:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=i5e[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:RC,jobId:i,error:qM(u)})}Rc(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:RC,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),ns(u)||this._post({type:RC,jobId:i,error:qM(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:RC,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),wi(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),wi(n.abortHandle),i?n.reject(J.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return DY(this.worker,e,r,i)}};const Bte=se("host-browser")?Math.min(navigator.hardwareConcurrency-1,se("workers-pool-size")):0;let $b=se("esri-mobile")?Math.min(Bte,3):Bte;$b||($b=se("safari")&&se("mac")?7:2);let Vte=0;const TD=[];function V6e(){A0e()}async function g$(t,e){const r=new r5e,{registryTarget:i,...s}=e;return await r.open(t,s),i&&H4e(i,r),r}async function G6e(t,e={}){if(typeof t!="string")throw new J("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(se("host-webworker")&&!se("esri-workers")&&(r="local"),r==="local"){let i=await F_.loadWorker(t);i||(i=await import(t)),vt(e.signal);const s=e.client||i;return g$([F_.connect(i)],{...e,client:s})}if(await A0e(),vt(e.signal),r==="dedicated"){const i=Vte++%$b;return g$([await TD[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,$b);if(i<$b){const s=new Array(i);for(let n=0;n<i;++n){const o=Vte++%$b;s[n]=TD[o].open(t,e)}return g$(s,e)}}return g$(TD.map(i=>i.open(t,e)),e)}let y$=null;async function A0e(){if(y$)return y$;new AbortController;const t=[];for(let e=0;e<$b;e++){const r=B6e.create(e).then(i=>(TD[e]=i,i));t.push(r)}return y$=Promise.all(t),y$}function P0e(t,e){const r=Nl(t),i=Nl(e),s=r.store,n=i.store,o=i.metadata;for(const a in o){const l=o[a],c=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==xr.DEFAULTS)if(c===xr.DEFAULTS)t.set(a,n.get(a));else{const h=s.get(a),p=n.get(a);h&&p&&p instanceof Me&&h instanceof Me&&h instanceof p.constructor&&P0e(h,p)}}}function Ow(t,e,r=Mt){return e||(e=new r),e===t||(e.removeAll(),j6e(t)?e.addMany(t):t&&e.add(t)),e}function M0e(t){return t}function j6e(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}let NP=class extends Mt{constructor(e){super(e),this.addHandles([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Mt.ofType(this.itemType.Type))(e):new Mt(e)}};function Z4(t,e){return{type:t,cast:M0e,set(r){const i=Ow(r,this._get(e),t);i.owner=this,this._set(e,i)}}}d([m()],NP.prototype,"owner",null),NP=d([V("esri.core.support.OwningCollection")],NP);var I3;const J4=Ul()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),O0e=J4.jsonValues.slice();$M(O0e,"orthometric");const FP=Ul()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let gd=I3=class extends We{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return J4.write(t,e,r)}readHeightModel(t,e,r){return J4.read(t)||(r!=null&&r.messages&&r.messages.push(H6e(t,{context:r})),null)}readHeightUnit(t,e,r){return FP.read(t)||(r!=null&&r.messages&&r.messages.push(Gte(t,{context:r})),null)}readHeightUnitService(t,e,r){return Ome(t)||FP.read(t)||(r!=null&&r.messages&&r.messages.push(Gte(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new I3({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=Rme(e);return new I3({heightModel:t.heightModel,heightUnit:r??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new I3;return e.read(t,{origin:"web-scene"}),e}};function Gte(t,e){return new vw("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function H6e(t,e){return new vw("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:J4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:O0e,default:"ellipsoidal"}}}})],gd.prototype,"heightModel",void 0),d([lr("web-scene","heightModel")],gd.prototype,"writeHeightModel",null),d([Tr(["web-scene","service"],"heightModel")],gd.prototype,"readHeightModel",null),d([m({type:FP.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:FP.jsonValues,write:FP.write}}}})],gd.prototype,"heightUnit",void 0),d([Tr("web-scene","heightUnit")],gd.prototype,"readHeightUnit",null),d([Tr("service","heightUnit")],gd.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],gd.prototype,"vertCRS",void 0),d([Tr("service","vertCRS",["vertCRS","ellipsoid","geoid"])],gd.prototype,"readVertCRS",null),gd=I3=d([V("esri.geometry.HeightModelInfo")],gd);const oR=gd,GMt=Math.PI/180,jMt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,B0=Kr.radius,id=Kr.eccentricitySquared,q6e={a1:B0*id,a2:B0*id*B0*id,a3:B0*id*id/2,a4:B0*id*B0*id*2.5,a5:B0*id+B0*id*id/2,a6:1-id},HMt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Kr.radius,f:Kr.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:i0.radius,f:i0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:hp.radius,f:hp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:hp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var K;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(K||(K={}));const bT={[K.WGS84]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Ni,[K.WGS84_COMPARABLE_LON_LAT]:Ni,[K.SPHERICAL_ECEF]:Lb,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:HS,[K.PLATE_CARREE]:u_,[K.WGS84]:Ni,[K.WGS84_ECEF]:d_},[K.CGCS2000]:{[K.CGCS2000]:Ni,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Ni,[K.WGS84_COMPARABLE_LON_LAT]:Ni,[K.SPHERICAL_ECEF]:Lb,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:u_,[K.WGS84]:null,[K.WGS84_ECEF]:d_},[K.GCSMARS2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:Ni,[K.GCSMOON2000]:null,[K.LON_LAT]:Ni,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:pG,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.GCSMOON2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:Ni,[K.LON_LAT]:Ni,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:dG,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.WEB_MERCATOR]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:QT,[K.WGS84_COMPARABLE_LON_LAT]:QT,[K.SPHERICAL_ECEF]:$0e,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Ni,[K.PLATE_CARREE]:L0e,[K.WGS84]:QT,[K.WGS84_ECEF]:I0e},[K.WGS84_ECEF]:{[K.CGCS2000]:p_,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:p_,[K.WGS84_COMPARABLE_LON_LAT]:p_,[K.SPHERICAL_ECEF]:F0e,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:k0e,[K.PLATE_CARREE]:W6e,[K.WGS84]:p_,[K.WGS84_ECEF]:Ni},[K.SPHERICAL_ECEF]:{[K.CGCS2000]:h_,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:h_,[K.WGS84_COMPARABLE_LON_LAT]:h_,[K.SPHERICAL_ECEF]:Ni,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:D0e,[K.PLATE_CARREE]:Y6e,[K.WGS84]:h_,[K.WGS84_ECEF]:N0e},[K.SPHERICAL_MARS_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:mG,[K.GCSMOON2000]:null,[K.LON_LAT]:mG,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:Ni,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.SPHERICAL_MOON_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:fG,[K.LON_LAT]:fG,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:Ni,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.UNKNOWN]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:null,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:Ni,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.LON_LAT]:{[K.CGCS2000]:Ni,[K.GCSMARS2000]:Ni,[K.GCSMOON2000]:Ni,[K.LON_LAT]:Ni,[K.WGS84_COMPARABLE_LON_LAT]:Ni,[K.SPHERICAL_ECEF]:Lb,[K.SPHERICAL_MARS_PCPF]:pG,[K.SPHERICAL_MOON_PCPF]:dG,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:HS,[K.PLATE_CARREE]:u_,[K.WGS84]:Ni,[K.WGS84_ECEF]:d_},[K.WGS84_COMPARABLE_LON_LAT]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Ni,[K.WGS84_COMPARABLE_LON_LAT]:Ni,[K.SPHERICAL_ECEF]:Lb,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:u_,[K.WGS84]:Ni,[K.WGS84_ECEF]:d_},[K.PLATE_CARREE]:{[K.CGCS2000]:Ib,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Ib,[K.WGS84_COMPARABLE_LON_LAT]:Ib,[K.SPHERICAL_ECEF]:X6e,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Z6e,[K.PLATE_CARREE]:Ni,[K.WGS84]:Ib,[K.WGS84_ECEF]:J6e}};function R0e(t){const e=ZM(t,U0e);return bT[e][K.WGS84_COMPARABLE_LON_LAT]}function k_(t,e,r=KY()){return t==null||e==null?null:Q6e(t,e,r).projector}function qMt(t,e){switch(k_(t,e,z6)){case Ni:return"copy3";case Lb:return"wgs84ToSphericalECEF";case HS:return"wgs84ToWebMercator";case u_:return"wgs84ToPlateCarree";case d_:return"wgs84ToWGS84ECEF";case QT:return"webMercatorToWGS84";case $0e:return"webMercatorToSphericalECEF";case I0e:return"webMercatorToWGS84ECEF";case L0e:return"webMercatorToPlateCarree";case p_:return"wgs84ECEFToWGS84";case F0e:return"wgs84ECEFToSphericalECEF";case k0e:return"wgs84ECEFToWebMercator";case h_:return"sphericalECEFToWGS84";case D0e:return"sphericalECEFToWebMercator";case mG:return"sphericalMarsPCPFToMars2000";case fG:return"sphericalMoonPCPFToMoon2000";case N0e:return"sphericalECEFToWGS84ECEF";case pG:return"mars2000ToSphericalPCPF";case dG:return"moon2000ToSphericalPCPF";default:return null}}function ZM(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=xa(t,1)),U4(t)?e.spatialReferenceId=K.SPHERICAL_ECEF:VM(t)?e.spatialReferenceId=K.WGS84:Sw(t)?e.spatialReferenceId=K.WEB_MERCATOR:GM(t)?e.spatialReferenceId=K.PLATE_CARREE:t.wkt===Cme.wkt?e.spatialReferenceId=K.WGS84_ECEF:t.wkid===gh.CGCS2000?e.spatialReferenceId=K.CGCS2000:t.wkt===w6.wkt?e.spatialReferenceId=K.SPHERICAL_MARS_PCPF:t.wkt===x6.wkt?e.spatialReferenceId=K.SPHERICAL_MOON_PCPF:u1(t)?e.spatialReferenceId=K.GCSMARS2000:h1(t)?e.spatialReferenceId=K.GCSMOON2000:e.spatialReferenceId=K.UNKNOWN):K.UNKNOWN}function Ni(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function QT(t,e,r,i){r[i]=WS*(t[e]/Qb),r[i+1]=WS*(z0e-2*Math.atan(Math.exp(-t[e+1]/Qb))),r[i+2]=t[e+2]}function $0e(t,e,r,i){const s=t[e]/Qb,n=z0e-2*Math.atan(Math.exp(-t[e+1]/Qb)),o=Qb+t[e+2],a=Math.cos(n)*o;r[i]=Math.cos(s)*a,r[i+1]=Math.sin(s)*a,r[i+2]=Math.sin(n)*o}function I0e(t,e,r,i){QT(t,e,r,i),d_(r,i,r,i)}function XY(t,e,r,i,s){const n=.4999999*B6,o=we(qS*t[e+1],-n,n),a=Math.sin(o);r[i++]=qS*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function HS(t,e,r,i){XY(t,e,r,i,Kr)}function u_(t,e,r,i){r[i]=t[e]*jte,r[i+1]=t[e+1]*jte,r[i+2]=t[e+2]}function Ib(t,e,r,i){r[i]=t[e]*Hte,r[i+1]=t[e+1]*Hte,r[i+2]=t[e+2]}function L0e(t,e,r,i){QT(t,e,r,i),u_(r,i,r,i)}function W6e(t,e,r,i){p_(t,e,r,i),u_(r,i,r,i)}function Y6e(t,e,r,i){h_(t,e,r,i),u_(r,i,r,i)}function X6e(t,e,r,i){Ib(t,e,r,i),Lb(r,i,r,i)}function Z6e(t,e,r,i){Ib(t,e,r,i),HS(r,i,r,i)}function J6e(t,e,r,i){Ib(t,e,r,i),d_(r,i,r,i)}function ZY(t,e,r,i,s){const n=s+t[e+2],o=qS*t[e+1],a=qS*t[e],l=Math.cos(o)*n;r[i]=Math.cos(a)*l,r[i+1]=Math.sin(a)*l,r[i+2]=Math.sin(o)*n}function dG(t,e,r,i){ZY(t,e,r,i,i0.radius)}function pG(t,e,r,i){ZY(t,e,r,i,hp.radius)}function Lb(t,e,r,i){ZY(t,e,r,i,Kr.radius)}function JY(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Rh(a/(l===0?1:l)),u=Math.atan2(o,n);r[i++]=WS*u,r[i++]=WS*c,r[i]=l-s}function fG(t,e,r,i){JY(t,e,r,i,i0.radius)}function mG(t,e,r,i){JY(t,e,r,i,hp.radius)}function h_(t,e,r,i){JY(t,e,r,i,Kr.radius)}function D0e(t,e,r,i){h_(t,e,r,i),HS(r,i,r,i)}function N0e(t,e,r,i){h_(t,e,r,i),d_(r,i,r,i)}function K6e(t,e,r,i,s){const n=qS*t[e],o=qS*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(n),r[i++]=(u+a)*c*Math.sin(n),r[i++]=(u*(1-s.eccentricitySquared)+a)*l}function d_(t,e,r,i){K6e(t,e,r,i,Kr)}function p_(t,e,r,i){const s=q6e,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,h,p,f,g,_,v,b,w,T,S,C,P,R,L,F,U,j,z;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),h=c+a*a,p=Math.sqrt(h),j=Math.atan2(o,n),f=a*a/h,g=c/h,C=s.a2/p,P=s.a3-s.a4/p,g>.3?(_=l/p*(1+g*(s.a1+C+f*P)/p),U=Math.asin(_),b=_*_,v=Math.sqrt(1-b)):(v=u/p*(1-f*(s.a5-C-g*P)/p),U=Math.acos(v),b=1-v*v,_=Math.sqrt(b)),w=1-Kr.eccentricitySquared*b,T=Kr.radius/Math.sqrt(w),S=s.a6*T,C=u-T*v,P=l-S*_,L=v*C+_*P,R=v*P-_*C,F=R/(S/w+L),U+=F,z=L+R*F/2,a<0&&(U=-U),r[i++]=WS*j,r[i++]=WS*U,r[i]=z}function F0e(t,e,r,i){p_(t,e,r,i),Lb(r,i,r,i)}function k0e(t,e,r,i){p_(t,e,r,i),HS(r,i,r,i)}function Q6e(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=ZM(t,r.source),s=ZM(e,r.dest);return i===K.UNKNOWN&&s===K.UNKNOWN?co(t,e)?r.projector=Ni:r.projector=null:r.projector=bT[i][s],r}function KY(){return{source:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},projector:Ni}}const U0e={spatialReference:null,spatialReferenceId:K.UNKNOWN},eke={spatialReference:null,spatialReferenceId:K.UNKNOWN},z6=KY(),qS=Lt(1),WS=ga(1),B6=Math.PI,z0e=.5*B6,Qb=Kr.radius,jte=Qb*B6/180,Hte=180/(Qb*B6);function Wi(t,e,r,i,s,n,o=1){const a=k_(e,s,z6);if(a==null)return!1;if(a===Ni){if(t===i&&r===n)return!0;const c=r+3*o;for(let u=r,h=n;u<c;u++,h++)i[h]=t[u];return!0}const l=r+3*o;for(let c=r,u=n;c<l;c+=3,u+=3)a(t,c,i,u);return!0}const WMt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Wi},Symbol.toStringTag,{value:"Module"}));function qte(t,e,r,i,s,n){return _$[0]=t,_$[1]=e,_$[2]=r,Wi(_$,i,0,s,n,0,1)}const _$=E();let v$=0,hU=class gG{static fromGE(e){const r=new gG;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=v$++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=v$++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=v$++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=v$++}getInverse(){const e=new gG;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},K4=class L3{static cacheKey(e,r){var i,s,n,o,a,l;return[((i=e.wkid)==null?void 0:i.toString())??"-1",((s=e.wkt)==null?void 0:s.toString())??"",((n=e.wkt2)==null?void 0:n.toString())??"",((o=r.wkid)==null?void 0:o.toString())??"-1",((a=r.wkt)==null?void 0:a.toString())??"",((l=r.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const r=new L3;let i="";for(const s of e.steps){const n=hU.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const r of e.steps)r instanceof hU?this.steps.push(r):this.steps.push(new hU({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new L3;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[L3.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[L3.cacheKey(e,r)];return s===void 0?null:s}};function tke(t,e,r){if(e==null||r==null||r.vcsWkid||co(e,r)||N_(e)||N_(r))return null;const i=HM(e)/HM(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>rke(s,i);case"polyline":case"esriGeometryPolyline":return s=>ske(s,i);case"polygon":case"esriGeometryPolygon":return s=>ike(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>nke(s,i);case"extent":case"esriGeometryEnvelope":return s=>oke(s,i);default:return null}}function rke(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function ike(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function ske(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function nke(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function oke(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let fp=null,U_=null,kP=null,SD={};const QY=new tR;function WE(){return!!fp&&_me()}function B0e(){return!!WE()||(Ot(QY),YS(),!1)}function O2(t,e){return!t||!e||Dh(t,e)||B0e()}function V0e(t,e){return!Dh(t,e)&&!WE()}function YS(t){return kP==null&&(kP=Promise.all([vme(),me(()=>import("./geometryEngineBase-CMwAYyhg.js"),[]).then(e=>e.g),me(()=>import("./hydrated-BP9lQ5ek.js"),[])])),kP.then(([,e,{hydratedAdapter:r}])=>{vt(t),U_=r,fp=e.default,fp._enableProjection(_Ne),QY.notify()})}function p1(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:yG(U_,t,t[0].spatialReference,e,r,i):yG(U_,[t],t.spatialReference,e,r,i)[0]}function yG(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(Dh(r,i,s))return e.map(o=>UP(o,r,i));if(s==null&&U4(r))return e.map(o=>UP(o,r,Xe.WGS84)).map(o=>z_(o,i));if(s==null&&U4(i))return e.map(o=>z_(o,Xe.WGS84)).map(o=>UP(o,Xe.WGS84,i));if(s==null){const o=K4.cacheKey(r,i);SD[o]!==void 0?s=SD[o]:((s=j0e(r,i,void 0))==null&&(s=new K4),SD[o]=s)}if(fp==null||t==null)throw new V6;return n!=null?fp._project(t,e,r,i,s,n):fp._project(t,e,r,i,s)}function ake(t,e){const r=G0e([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function G0e(t,e){if(!WE()){for(const r of t)if(r!=null&&!co(r.spatialReference,e)&&qf(r.spatialReference)&&qf(e)&&!Dh(r.spatialReference,e))return Ot(QY),{pending:YS(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:co(r.spatialReference,e)?r:qf(r.spatialReference)&&qf(e)?z_(r,e):null)}}function j0e(t,e,r=null){if(t==null||e==null)return null;if(fp==null||U_==null)throw new V6;const i=fp._getTransformation(U_,t,e,r,r==null?void 0:r.spatialReference);return i!==null?K4.fromGE(i):null}function lke(t,e,r=null){if(fp==null||U_==null)throw new V6;const i=fp._getTransformationBySuitability(U_,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(K4.fromGE(n));return s}return[]}let V6=class extends J{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function cke(){fp=null,U_=null,kP=null,SD={}}const uke={get loadPromise(){return kP}};function z_(t,e){try{const r=p1(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=tke(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof V6))throw r;return null}}async function B_(t,e,r){const i=t.spatialReference;return i!=null&&e!=null&&await aR(i,e,null,r),z_(t,e)}function Dh(t,e,r){return!r&&(!!co(t,e)||qf(t)&&qf(e)&&!!k_(t,e,z6))}async function aR(t,e,r,i){if(WE())return g4(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!Dh(s,n,o))return YS(i)}else if(t&&e&&!Dh(t,e,r))return YS(i);return g4(i)}function UP(t,e,r){return t?"x"in t?q0e(t,e,new Ke,r,0):"xmin"in t?Z0e(t,e,new $r,r,0):"rings"in t?X0e(t,e,new bp,r,0):"paths"in t?Y0e(t,e,new tp,r,0):"points"in t?W0e(t,e,new VE,r,0):null:null}function H0e(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&q0e(t,t.spatialReference,e,r,i)!=null}function q0e(t,e,r,i,s){za[0]=t.x,za[1]=t.y;const n=t.z;return za[2]=n!==void 0?n:s,Wi(za,e,0,za,i,0,1)?(r.x=za[0],r.y=za[1],r.spatialReference=i,n!==void 0||N_(i)?(r.z=za[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function hke(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&W0e(t,t.spatialReference,e,r,i)!=null}function W0e(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const p of n)u.push(p[0],p[1],o?p[2]:s);if(!Wi(u,e,0,u,i,0,c))return null;const h=o||N_(i);for(let p=0;p<c;++p){const f=3*p,g=u[f],_=u[f+1];h&&a?l.push([g,_,u[f+2],n[p][3]]):h?l.push([g,_,u[f+2]]):a?l.push([g,_,n[p][2]]):l.push([g,_])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function dke(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Y0e(t,t.spatialReference,e,r,i)!=null}function Y0e(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!J0e(n,o??!1,a??!1,e,l,i,s))return null;const c=o||N_(i);return r.paths=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function pke(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&X0e(t,t.spatialReference,e,r,i)!=null}function X0e(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!J0e(n,o??!1,a??!1,e,l,i,s))return null;const c=o||N_(i);return r.rings=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function fke(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Z0e(t,t.spatialReference,e,r,i)!=null}function Z0e(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,h=c?t.zmin:s;if(!qte(n,o,h,e,za,i))return null;const p=c||N_(i);r.xmin=za[0],r.ymin=za[1],p&&(r.zmin=za[2]);const f=c?t.zmax:s;return qte(a,l,f,e,za,i)?(r.xmax=za[0],r.ymax=za[1],p&&(r.zmax=za[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null}function J0e(t,e,r,i,s,n,o=0){const a=new Array;for(const u of t)for(const h of u)a.push(h[0],h[1],e?h[2]:o);if(!Wi(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||N_(n);for(const u of t){const h=new Array;for(const p of u)c&&r?h.push([a[l++],a[l++],a[l++],p[3]]):c?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function V_(t){return t!=null&&R0e(t)!=null}const za=E(),XMt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:V_,canProjectWithoutEngine:Dh,getTransformation:j0e,getTransformations:lke,initializeProjection:aR,isLoaded:WE,isLoadedOrLoad:B0e,isLoadedOrLoadFor:O2,load:YS,project:p1,projectExtent:fke,projectMany:yG,projectMultipoint:hke,projectOrLoad:ake,projectOrLoadMany:G0e,projectPoint:H0e,projectPolygon:pke,projectPolyline:dke,projectWithZConversion:B_,projectWithoutEngine:UP,requiresLoad:V0e,test:uke,tryProjectWithZConversion:z_,unload:cke},Symbol.toStringTag,{value:"Module"}));function G6(t,e,r,i){return t!=null&&(co(e,i)?(s0(r,t),!0):(Gl[0]=t[0],Gl[1]=t[1],Gl[2]=0,!!Wi(Gl,e,0,Gl,i,0,1)&&(r[0]=Gl[0],r[1]=Gl[1],Gl[0]=t[2],Gl[1]=t[3],Gl[2]=0,!!Wi(Gl,e,0,Gl,i,0,1)&&(r[2]=Gl[0],r[3]=Gl[1],!0))))}const Gl=E();function Qa(t,e,r,i){if(Dh(t.spatialReference,r)){b$[0]=t.x,b$[1]=t.y;const n=t.z;return b$[2]=n??i??0,Wi(b$,t.spatialReference,0,e,r,0,1)}const s=z_(t,r);return!!s&&(e[0]=s==null?void 0:s.x,e[1]=s==null?void 0:s.y,e[2]=(s==null?void 0:s.z)??i??0,!0)}async function Q4(t,e,r,i,s){return await aR(t.spatialReference,r,null,s),Qa(t,e,r,i)}const b$=E();let g0=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&RS(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Wte);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Wte));e++)this._items.push(this._allocator())}};const Wte=1024;function Bs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Pm(t,e,r,i,s,n,o,a,l,c,u,h,p,f,g,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=f,t[13]=g,t[14]=_,t[15]=v,t}function Nh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ac(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function YE(t,e){return cn(t,e)||Nh(t),t}function cn(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15],w=r*a-i*o,T=r*l-s*o,S=r*c-n*o,C=i*l-s*a,P=i*c-n*a,R=s*c-n*l,L=u*_-h*g,F=u*v-p*g,U=u*b-f*g,j=h*v-p*_,z=h*b-f*_,Z=p*b-f*v;let W=w*Z-T*z+S*j+C*U-P*F+R*L;return W?(W=1/W,t[0]=(a*Z-l*z+c*j)*W,t[1]=(s*z-i*Z-n*j)*W,t[2]=(_*R-v*P+b*C)*W,t[3]=(p*P-h*R-f*C)*W,t[4]=(l*U-o*Z-c*F)*W,t[5]=(r*Z-s*U+n*F)*W,t[6]=(v*S-g*R-b*T)*W,t[7]=(u*R-p*S+f*T)*W,t[8]=(o*z-a*U+c*L)*W,t[9]=(i*U-r*z-n*L)*W,t[10]=(g*P-_*S+b*w)*W,t[11]=(h*S-u*P-f*w)*W,t[12]=(a*F-o*j-l*L)*W,t[13]=(r*j-i*F+s*L)*W,t[14]=(_*T-g*C-v*w)*W,t[15]=(u*C-h*T+p*w)*W,t):null}function mke(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-f*v)-h*(l*b-c*v)+_*(l*f-c*p),t[1]=-(i*(p*b-f*v)-h*(s*b-n*v)+_*(s*f-n*p)),t[2]=i*(l*b-c*v)-a*(s*b-n*v)+_*(s*c-n*l),t[3]=-(i*(l*f-c*p)-a*(s*f-n*p)+h*(s*c-n*l)),t[4]=-(o*(p*b-f*v)-u*(l*b-c*v)+g*(l*f-c*p)),t[5]=r*(p*b-f*v)-u*(s*b-n*v)+g*(s*f-n*p),t[6]=-(r*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=r*(l*f-c*p)-o*(s*f-n*p)+u*(s*c-n*l),t[8]=o*(h*b-f*_)-u*(a*b-c*_)+g*(a*f-c*h),t[9]=-(r*(h*b-f*_)-u*(i*b-n*_)+g*(i*f-n*h)),t[10]=r*(a*b-c*_)-o*(i*b-n*_)+g*(i*c-n*a),t[11]=-(r*(a*f-c*h)-o*(i*f-n*h)+u*(i*c-n*a)),t[12]=-(o*(h*v-p*_)-u*(a*v-l*_)+g*(a*p-l*h)),t[13]=r*(h*v-p*_)-u*(i*v-s*_)+g*(i*p-s*h),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+g*(i*l-s*a)),t[15]=r*(a*p-l*h)-o*(i*p-s*h)+u*(i*l-s*a),t}function gke(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],_=t[14],v=t[15];return(e*o-r*n)*(h*v-p*_)-(e*a-i*n)*(u*v-p*g)+(e*l-s*n)*(u*_-h*g)+(r*a-i*o)*(c*v-p*f)-(r*l-s*o)*(c*_-h*f)+(i*l-s*a)*(c*g-u*f)}function ri(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],f=e[10],g=e[11],_=e[12],v=e[13],b=e[14],w=e[15];let T=r[0],S=r[1],C=r[2],P=r[3];return t[0]=T*i+S*a+C*h+P*_,t[1]=T*s+S*l+C*p+P*v,t[2]=T*n+S*c+C*f+P*b,t[3]=T*o+S*u+C*g+P*w,T=r[4],S=r[5],C=r[6],P=r[7],t[4]=T*i+S*a+C*h+P*_,t[5]=T*s+S*l+C*p+P*v,t[6]=T*n+S*c+C*f+P*b,t[7]=T*o+S*u+C*g+P*w,T=r[8],S=r[9],C=r[10],P=r[11],t[8]=T*i+S*a+C*h+P*_,t[9]=T*s+S*l+C*p+P*v,t[10]=T*n+S*c+C*f+P*b,t[11]=T*o+S*u+C*g+P*w,T=r[12],S=r[13],C=r[14],P=r[15],t[12]=T*i+S*a+C*h+P*_,t[13]=T*s+S*l+C*p+P*v,t[14]=T*n+S*c+C*f+P*b,t[15]=T*o+S*u+C*g+P*w,t}function Fl(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],_=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=p,t[7]=f,t[8]=g,t[9]=_,t[10]=v,t[11]=b,t[12]=o*i+u*s+g*n+e[12],t[13]=a*i+h*s+_*n+e[13],t[14]=l*i+p*s+v*n+e[14],t[15]=c*i+f*s+b*n+e[15]}return t}function lR(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function bc(t,e,r,i){let s,n,o,a,l,c,u,h,p,f,g,_,v,b,w,T,S,C,P,R,L,F,U,j,z=i[0],Z=i[1],W=i[2],Y=Math.sqrt(z*z+Z*Z+W*W);return Y<wa()?null:(Y=1/Y,z*=Y,Z*=Y,W*=Y,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],_=e[8],v=e[9],b=e[10],w=e[11],T=z*z*o+n,S=Z*z*o+W*s,C=W*z*o-Z*s,P=z*Z*o-W*s,R=Z*Z*o+n,L=W*Z*o+z*s,F=z*W*o+Z*s,U=Z*W*o-z*s,j=W*W*o+n,t[0]=a*T+h*S+_*C,t[1]=l*T+p*S+v*C,t[2]=c*T+f*S+b*C,t[3]=u*T+g*S+w*C,t[4]=a*P+h*R+_*L,t[5]=l*P+p*R+v*L,t[6]=c*P+f*R+b*L,t[7]=u*P+g*R+w*L,t[8]=a*F+h*U+_*j,t[9]=l*F+p*U+v*j,t[10]=c*F+f*U+b*j,t[11]=u*F+g*U+w*j,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function XS(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+u*i,t[6]=a*s+h*i,t[7]=l*s+p*i,t[8]=c*s-n*i,t[9]=u*s-o*i,t[10]=h*s-a*i,t[11]=p*s-l*i,t}function j6(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-u*i,t[2]=a*s-h*i,t[3]=l*s-p*i,t[8]=n*i+c*s,t[9]=o*i+u*s,t[10]=a*i+h*s,t[11]=l*i+p*s,t}function ZS(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+u*i,t[2]=a*s+h*i,t[3]=l*s+p*i,t[4]=c*s-n*i,t[5]=u*s-o*i,t[6]=h*s-a*i,t[7]=p*s-l*i,t}function cR(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function yke(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Su(t,e,r){if(e===0)return Nh(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<wa()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function K0e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _ke(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Q0e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eye(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,u=i*a,h=i*l,p=i*c,f=s*l,g=s*c,_=n*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(f+_),t[1]=h+w,t[2]=p-b,t[3]=0,t[4]=h-w,t[5]=1-(u+_),t[6]=g+v,t[7]=0,t[8]=p+b,t[9]=g-v,t[10]=1-(u+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function vke(t,e){const r=bke,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=i*i+s*s+n*n+o*o;return h>0?(r[0]=2*(a*o+u*i+l*n-c*s)/h,r[1]=2*(l*o+u*s+c*i-a*n)/h,r[2]=2*(c*o+u*n+a*s-l*i)/h):(r[0]=2*(a*o+u*i+l*n-c*s),r[1]=2*(l*o+u*s+c*i-a*n),r[2]=2*(c*o+u*n+a*s-l*i)),eye(t,e,r),t}const bke=E();function e5(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function tye(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function rye(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function iye(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,h=s*l,p=s*c,f=s*u,g=n*c,_=n*u,v=o*u,b=a*l,w=a*c,T=a*u,S=i[0],C=i[1],P=i[2];return t[0]=(1-(g+v))*S,t[1]=(p+T)*S,t[2]=(f-w)*S,t[3]=0,t[4]=(p-T)*C,t[5]=(1-(h+v))*C,t[6]=(_+b)*C,t[7]=0,t[8]=(f+w)*P,t[9]=(_-b)*P,t[10]=(1-(h+g))*P,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function wke(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,h=a+a,p=n*c,f=n*u,g=n*h,_=o*u,v=o*h,b=a*h,w=l*c,T=l*u,S=l*h,C=i[0],P=i[1],R=i[2],L=s[0],F=s[1],U=s[2],j=(1-(_+b))*C,z=(f+S)*C,Z=(g-T)*C,W=(f-S)*P,Y=(1-(p+b))*P,le=(v+w)*P,I=(g+T)*R,N=(v-w)*R,B=(1-(p+_))*R;return t[0]=j,t[1]=z,t[2]=Z,t[3]=0,t[4]=W,t[5]=Y,t[6]=le,t[7]=0,t[8]=I,t[9]=N,t[10]=B,t[11]=0,t[12]=r[0]+L-(j*L+W*F+I*U),t[13]=r[1]+F-(z*L+Y*F+N*U),t[14]=r[2]+U-(Z*L+le*F+B*U),t[15]=1,t}function xke(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,h=i*a,p=s*o,f=s*a,g=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-h-g,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=f+_,t[7]=0,t[8]=p+v,t[9]=f-_,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sye(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function Tke(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function Ske(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function nye(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function H6(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const u=wa();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Nh(t);let h=1/Math.sqrt(a*a+l*l+c*c);a*=h,l*=h,c*=h;const p=i[0],f=i[1],g=i[2];let _=f*c-g*l,v=g*a-p*c,b=p*l-f*a;h=Math.sqrt(_*_+v*v+b*b),h?(h=1/h,_*=h,v*=h,b*=h):(_=0,v=0,b=0);let w=l*b-c*v,T=c*_-a*b,S=a*v-l*_;h=Math.sqrt(w*w+T*T+S*S),h?(h=1/h,w*=h,T*=h,S*=h):(w=0,T=0,S=0),t[0]=_,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+b*o),t[13]=-(w*s+T*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function oye(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=s-r[0],h=n-r[1],p=o-r[2],f=u*u+h*h+p*p;f>0&&(f=1/Math.sqrt(f),u*=f,h*=f,p*=f);let g=l*p-c*h,_=c*u-a*p,v=a*h-l*u;return f=g*g+_*_+v*v,f>0&&(f=1/Math.sqrt(f),g*=f,_*=f,v*=f),t[0]=g,t[1]=_,t[2]=v,t[3]=0,t[4]=h*v-p*_,t[5]=p*g-u*v,t[6]=u*_-h*g,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function Eke(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Cke(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Ake(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function aye(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Pke(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Mke(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function eX(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function q6(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],f=t[11],g=t[12],_=t[13],v=t[14],b=t[15],w=e[0],T=e[1],S=e[2],C=e[3],P=e[4],R=e[5],L=e[6],F=e[7],U=e[8],j=e[9],z=e[10],Z=e[11],W=e[12],Y=e[13],le=e[14],I=e[15],N=wa();return Math.abs(r-w)<=N*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-T)<=N*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(s-S)<=N*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-C)<=N*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-P)<=N*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(a-R)<=N*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-L)<=N*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-F)<=N*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(u-U)<=N*Math.max(1,Math.abs(u),Math.abs(U))&&Math.abs(h-j)<=N*Math.max(1,Math.abs(h),Math.abs(j))&&Math.abs(p-z)<=N*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(f-Z)<=N*Math.max(1,Math.abs(f),Math.abs(Z))&&Math.abs(g-W)<=N*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(_-Y)<=N*Math.max(1,Math.abs(_),Math.abs(Y))&&Math.abs(v-le)<=N*Math.max(1,Math.abs(v),Math.abs(le))&&Math.abs(b-I)<=N*Math.max(1,Math.abs(b),Math.abs(I))}function tX(t){const e=wa(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function W6(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const Oke=ri,Rke=aye;Object.freeze(Object.defineProperty({__proto__:null,add:Ake,adjoint:mke,copy:Bs,determinant:gke,equals:q6,exactEquals:eX,frob:Cke,fromQuat:xke,fromQuat2:vke,fromRotation:Su,fromRotationTranslation:eye,fromRotationTranslationScale:iye,fromRotationTranslationScaleOrigin:wke,fromScaling:yke,fromTranslation:cR,fromXRotation:K0e,fromYRotation:_ke,fromZRotation:Q0e,frustum:sye,getRotation:rye,getScaling:tye,getTranslation:e5,hasIdentityRotation:W6,identity:Nh,invert:cn,invertOrIdentity:YE,isOrthoNormal:tX,lookAt:H6,mul:Oke,multiply:ri,multiplyScalar:Pke,multiplyScalarAndAdd:Mke,ortho:nye,perspective:Tke,perspectiveFromFieldOfView:Ske,rotate:bc,rotateX:XS,rotateY:j6,rotateZ:ZS,scale:lR,set:Pm,str:Eke,sub:Rke,subtract:aye,targetTo:oye,translate:Fl,transpose:Ac},Symbol.toStringTag,{value:"Module"}));function xe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function JS(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function rX(t,e,r,i,s,n,o,a,l,c,u,h,p,f,g,_){return[t,e,r,i,s,n,o,a,l,c,u,h,p,f,g,_]}function $ke(t,e){return new Float64Array(t,e,16)}const ts=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:ts,clone:JS,create:xe,createView:$ke,fromValues:rX},Symbol.toStringTag,{value:"Module"}));function xi(){return[1,0,0,0,1,0,0,0,1]}function lye(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function zP(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function Ike(t,e){return new Float64Array(t,e,9)}const Qw=xi();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Qw,clone:lye,create:xi,createView:Ike,fromValues:zP},Symbol.toStringTag,{value:"Module"}));function $c(){return[0,0,0,1]}function Lke(t){return[t[0],t[1],t[2],t[3]]}function Dke(t,e,r,i){return[t,e,r,i]}function Nke(t,e){return new Float64Array(t,e,4)}const iX=$c();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:iX,clone:Lke,create:$c,createView:Nke,fromValues:Dke},Symbol.toStringTag,{value:"Module"}));function je(){return[0,0]}function D3(t){return[t[0],t[1]]}function ar(t,e){return[t,e]}function cye(t,e=je()){const r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Fke(t,e){return new Float64Array(t,e,2)}function uye(){return je()}function hye(){return ar(1,1)}function dye(){return ar(1,0)}function pye(){return ar(0,1)}const n0=uye(),Y6=hye(),fye=dye(),kke=pye();Object.freeze(Object.defineProperty({__proto__:null,ONES:Y6,UNIT_X:fye,UNIT_Y:kke,ZEROS:n0,clone:D3,create:je,createView:Fke,fromArray:cye,fromValues:ar,ones:hye,unitX:dye,unitY:pye,zeros:uye},Symbol.toStringTag,{value:"Module"}));function Yt(){return[0,0,0,0]}function uR(t){return[t[0],t[1],t[2],t[3]]}function zt(t,e,r,i){return[t,e,r,i]}function sX(t,e=Yt()){const r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Uke(t,e){return new Float64Array(t,e,4)}function mye(){return Yt()}function gye(){return zt(1,1,1,1)}function yye(){return zt(1,0,0,0)}function _ye(){return zt(0,1,0,0)}function vye(){return zt(0,0,1,0)}function bye(){return zt(0,0,0,1)}const _u=mye(),yh=gye(),zke=yye(),Bke=_ye(),Vke=vye(),Gke=bye();Object.freeze(Object.defineProperty({__proto__:null,ONES:yh,UNIT_W:Gke,UNIT_X:zke,UNIT_Y:Bke,UNIT_Z:Vke,ZEROS:_u,clone:uR,create:Yt,createView:Uke,fromArray:sX,fromValues:zt,ones:gye,unitW:bye,unitX:yye,unitY:_ye,unitZ:vye,zeros:mye},Symbol.toStringTag,{value:"Module"}));let XE=class bv{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&RS(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new bv(je)}static createVec3f64(){return new bv(E)}static createVec4f64(){return new bv(Yt)}static createMat3f64(){return new bv(xi)}static createMat4f64(){return new bv(xe)}static createQuatf64(){return new bv($c)}get test(){return{length:this._items.length}}};const JMt=XE.createVec2f64(),ze=XE.createVec3f64(),nX=XE.createVec4f64();XE.createMat3f64();const oX=XE.createMat4f64(),jke=XE.createQuatf64();function Lp(t){return t?{origin:qi(t.origin),vector:qi(t.vector)}:{origin:E(),vector:E()}}function Hke(t,e){const r=Wke.get();return r.origin=t,r.vector=e,r}function KMt(t,e=Lp()){return qke(t.origin,t.vector,e)}function qke(t,e,r=Lp()){return ce(r.origin,t),ce(r.vector,e),r}function ew(t,e,r=Lp()){return ce(r.origin,t),ye(r.vector,e,t),r}function aX(t,e){const r=ye(ze.get(),e,t.origin),i=de(t.vector,r),s=de(t.vector,t.vector),n=we(i/s,0,1),o=ye(ze.get(),re(ze.get(),t.vector,n),r);return de(o,o)}function QMt(t,e,r){return _G(t,e,0,1,r)}function eOt(t,e,r){return pe(r,t.origin,re(r,t.vector,e))}function _G(t,e,r,i,s){const{vector:n,origin:o}=t,a=ye(ze.get(),e,o),l=de(n,a)/pa(n);return re(s,n,we(l,r,i)),pe(s,s,t.origin)}function tOt(t,e){if(xye(t,Hke(e.origin,e.direction),!1,t5)){const{tA:r,pB:i,distance2:s}=t5;if(r>=0&&r<=1)return s;if(r<0)return So(t.origin,i);if(r>1)return So(pe(ze.get(),t.origin,t.vector),i)}return null}function wye(t,e,r){return!!xye(t,e,!0,t5)&&(ce(r,t5.pA),!0)}function xye(t,e,r,i){const n=t.origin,o=pe(ze.get(),n,t.vector),a=e.origin,l=pe(ze.get(),a,e.vector),c=ze.get(),u=ze.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=ze.get();if(h[0]=o[0]-n[0],h[1]=o[1]-n[1],h[2]=o[2]-n[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*_-f*f;if(Math.abs(v)<1e-6)return!1;let b=(p*f-g*_)/v,w=(p+f*b)/_;r&&(b=we(b,0,1),w=we(w,0,1));const T=ze.get(),S=ze.get();return T[0]=n[0]+b*h[0],T[1]=n[1]+b*h[1],T[2]=n[2]+b*h[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],i.tA=b,i.tB=w,i.pA=T,i.pB=S,i.distance2=So(T,S),!0}const t5={tA:0,tB:0,pA:E(),pB:E(),distance2:0},Wke=new g0(()=>Lp());function xh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Yke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function es(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function lX(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Tye(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Sye(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Eye(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Xke(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Zke(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Jke(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Kke(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Qke(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Rw(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function e8e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Cye(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function r5(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function cX(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function uX(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function t8e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function r8e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Aye(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function Pye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function hX(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function i8e(t,e){const r=ZO;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function wc(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function s8e(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*n-l*s,h=c*s+l*i-o*n,p=c*n+o*s-a*i,f=-o*i-a*s-l*n;return t[0]=u*c+f*-o+h*-l-p*-a,t[1]=h*c+f*-a+p*-o-u*-l,t[2]=p*c+f*-l+u*-a-h*-o,t[3]=e[3],t}function n8e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function eS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function $w(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=wa();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const o8e=Tye,a8e=Sye,l8e=Eye,c8e=Cye,u8e=r5,h8e=cX,d8e=uX,Mye=Object.freeze(Object.defineProperty({__proto__:null,add:lX,ceil:Xke,copy:xh,copyVec3:Yke,dist:c8e,distance:Cye,div:l8e,divide:Eye,dot:Pye,equals:$w,exactEquals:eS,floor:Zke,inverse:r8e,len:h8e,length:cX,lerp:hX,max:Kke,min:Jke,mul:a8e,multiply:Sye,negate:t8e,normalize:Aye,random:i8e,round:Qke,scale:Rw,scaleAndAdd:e8e,set:es,sqrDist:u8e,sqrLen:d8e,squaredDistance:r5,squaredLength:uX,str:n8e,sub:o8e,subtract:Tye,transformMat4:wc,transformQuat:s8e},Symbol.toStringTag,{value:"Module"}));function BP(t,e){return de(t,e)/Se(t)}function X6(t,e){const r=de(t,e)/(Se(t)*Se(e));return-Bn(r)}function Oye(t,e,r){fe(w$,t),fe(dU,e);const i=de(w$,dU),s=Bn(i),n=Ze(w$,w$,dU);return de(n,r)<0?2*Math.PI-s:s}const w$=E(),dU=E();function KS(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function p8e(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return te(t,r,i,s),t}function rOt(t,e,r){r=r||t;const i=de(t,e);te(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),fe(r,r)}function iOt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?te(e,0,1,0):te(e,1,0,0),Ze(r,t,e),Ze(e,r,t),fe(r,r),fe(e,e)}function x$(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function f8e(t,e,r,i=E()){const s=Se(t),n=Se(e),o=de(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),u=l/n*Math.sin(r*a);return re(Db,t,c),re(Nb,e,u),pe(i,Db,Nb)}return li(i,t,e,r)}function sOt(t,e,r,i=E(),s=E()){const n=Se(t),o=Se(e),a=de(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),h=Math.sin((1-r)*l),p=(1-r)*n+r*o;{const f=p/c,g=f/o*u;re(Db,t,f/n*h),re(Nb,e,g),pe(i,Db,Nb)}{const f=1/n*(-Math.cos((1-r)*l)*l*p+h*(-n+o));re(Db,t,f);const g=1/o*(Math.cos(r*l)*l*p+u*(-n+o));re(Nb,e,g),pe(s,Db,Nb),re(s,s,1/c)}return s}return li(i,t,e,r),ye(s,e,t),fe(s,s),s}function i5(t,e,r){t=fe(Db,t),e=fe(Nb,e);const i=Bn(de(t,e));if(r){const s=Ze(m8e,t,e);if(de(s,r)<0)return-i}return i}function ED(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function nOt(t,e,r,i){ye(Yte,e,t),ye(Xte,r,t),Ze(i,Yte,Xte),fe(i,i),i[3]=-de(t,i)}function oOt(t,e){if(te(e,0,0,0),t.length>0){for(let r=0;r<t.length;++r)pe(e,e,t[r]);re(e,e,1/t.length)}}const Yte=E(),Xte=E(),m8e=E(),Db=E(),Nb=E();function zr(t=N3){return[t[0],t[1],t[2],t[3]]}function g8e(t=N3[0],e=N3[1],r=N3[2],i=N3[3]){return dX(t,e,r,i,nX.get())}function Z6(t,e){return dX(e[0],e[1],e[2],e[3],t)}function aOt(t){return t}function dX(t,e,r,i,s=zr()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Rye(t,e,r){return ce(r,t),r[3]=e,r}function hR(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function ha(t,e,r,i=zr()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,h=o*a-s*c,p=s*l-n*a,f=u*u+h*h+p*p,g=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return i[0]=u*g,i[1]=h*g,i[2]=p*g,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function pX(t,e,r,i=0,s=Math.floor(r*(1/3)),n=Math.floor(r*(2/3))){if(r<3)return!1;e($C,i);let o=s,a=!1;for(;o<r-1&&!a;)e(bx,o),o++,a=!To($C,bx);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<r&&!a;)e(hb,o),o++,ye(T$,$C,bx),fe(T$,T$),ye(S$,bx,hb),fe(S$,S$),a=!To($C,hb)&&!To(bx,hb)&&Math.abs(de(T$,S$))<_8e;return a?(ha($C,bx,hb,t),!0):(i!==0||s!==1||n!==2)&&pX(t,e,r,0,1,2)}function y8e(t,e,r=!0){const i=e.length/3;return pX(t,(s,n)=>te(s,e[3*n+0],e[3*n+1],e[3*n+2]),r?i-1:i)}const _8e=.99619469809,$C=E(),bx=E(),hb=E(),T$=E(),S$=E();function vG(t,e,r){return e!==t&&Z6(t,e),t[3]=-de(t,r),t}function bG(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function JM(t,e,r,i){return Ze(hb,e,t),hR(r,hb,i)}function lOt(t,e,r,i){return J6(t,e,ye(ze.get(),r,e),S8e,i)}function ex(t,e,r){return e!=null&&J6(t,e.origin,e.direction,E8e,r)}function v8e(t,e,r){return J6(t,e.origin,e.vector,im.NONE,r)}function b8e(t,e,r){return J6(t,e.origin,e.vector,im.CLAMP,r)}function $ye(t,e){return bi(t,e)>=0}function w8e(t,e){const r=de(t,e.ray.direction),i=-bi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function x8e(t,e){const r=de(t,e.ray.direction),i=-bi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function T8e(t,e,r){const i=re(ze.get(),t,-t[3]),s=wG(t,ye(ze.get(),e,i),ze.get());return pe(r,s,i),r}function wG(t,e,r){const i=re(ze.get(),t,de(t,e));return ye(r,e,i),r}function cOt(t,e){return Math.abs(bi(t,e))}function bi(t,e){return de(t,e)+t[3]}function J6(t,e,r,i,s){const n=de(t,r);if(n===0)return!1;let o=-(de(t,e)+t[3])/n;return i&im.CLAMP&&(o=we(o,0,1)),!(!(i&im.INFINITE_MIN)&&o<0||!(i&im.INFINITE_MAX)&&o>1)&&(pe(s,e,re(s,r,o)),!0)}const N3=[0,0,1,0];var im;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(im||(im={}));const S8e=im.INFINITE_MIN|im.INFINITE_MAX,E8e=im.INFINITE_MAX;function Un(t){return t?Zte(qi(t.origin),qi(t.direction)):Zte(E(),E())}function Zte(t,e){return{origin:t,direction:e}}function uOt(t,e){return e0(t.origin,e.origin)&&e0(t.direction,e.direction)}function Eu(t,e){const r=P8e.get();return r.origin=t,r.direction=e,r}function s5(t,e=Un()){return Lye(t.origin,t.direction,e)}function Iye(t,e,r=Un()){return ce(r.origin,t),ye(r.direction,e,t),r}function Lye(t,e,r=Un()){return ce(r.origin,t),ce(r.direction,e),r}function C8e(t,e){const r=Ze(ze.get(),fe(ze.get(),t.direction),ye(ze.get(),e,t.origin));return de(r,r)}function A8e(t,e,r){const i=de(t.direction,ye(r,e,t.origin));return pe(r,t.origin,re(r,t.direction,i)),r}const P8e=new g0(()=>Un()),pU=()=>ae.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let M8e=class{constructor(){this.plane=zr(),this.origin=E(),this.basis1=E(),this.basis2=E()}};const Dye=M8e;function y0(t=qye){return{plane:zr(t.plane),origin:qi(t.origin),basis1:qi(t.basis1),basis2:qi(t.basis2)}}function O8e(t,e,r){const i=V8e.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=g8e(0,0,0,0),K6(i),i}function tx(t,e=y0()){return fX(t.origin,t.basis1,t.basis2,e)}function R8e(t,e){ce(e.origin,t.origin),ce(e.basis1,t.basis1),ce(e.basis2,t.basis2),Z6(e.plane,t.plane)}function fX(t,e,r,i=y0()){return ce(i.origin,t),ce(i.basis1,e),ce(i.basis2,r),K6(i),z8e(i,"fromValues()"),i}function K6(t){JM(t.basis2,t.basis1,t.origin,t.plane)}function Nye(t,e,r){t!==r&&tx(t,r);const i=re(ze.get(),o0(t),e);return pe(r.origin,r.origin,i),r.plane[3]-=e,r}function $8e(t,e,r){return Fye(e,r),Nye(r,_X(t,t.origin),r),r}function Fye(t,e=y0()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return te(e.origin,t[0]+r,t[1]+i,0),te(e.basis1,r,0,0),te(e.basis2,0,i,0),dX(0,0,1,0,e.plane),e}function mX(t,e,r){return!!ex(t.plane,e,r)&&jye(t,r)}function I8e(t,e,r){if(mX(t,e,r))return r;const i=kye(t,e,ze.get());return pe(r,e.origin,re(ze.get(),e.direction,$i(e.origin,i)/Se(e.direction))),r}function kye(t,e,r){const i=n5.get();Hye(t,e,i,n5.get());let s=Number.POSITIVE_INFINITY;for(const n of bX){const o=vX(t,n,Q6.get()),a=ze.get();if(v8e(i,o,a)){const l=m0(ze.get(),e.origin,a),c=Math.abs(Bn(de(e.direction,l)));c<s&&(s=c,ce(r,a))}}return s===Number.POSITIVE_INFINITY?Uye(t,e,r):r}function Uye(t,e,r){if(mX(t,e,r))return r;const i=n5.get(),s=n5.get();Hye(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of bX){const a=vX(t,o,Q6.get()),l=ze.get();if(b8e(i,a,l)){const c=C8e(e,l);if(!$ye(s,l))continue;c<n&&(n=c,ce(r,l))}}return gX(t,e.origin)<n&&zye(t,e.origin,r),r}function zye(t,e,r){const i=T8e(t.plane,e,ze.get()),s=_G(Jte(t,t.basis1),i,-1,1,ze.get()),n=_G(Jte(t,t.basis2),i,-1,1,ze.get());return ye(r,pe(ze.get(),s,n),t.origin),r}function Bye(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=ye(ze.get(),e,i),a=BP(s,o),l=BP(n,o),c=BP(o0(t),o);return te(r,a,l,c)}function gX(t,e){const r=Bye(t,e,ze.get()),{basis1:i,basis2:s}=t,n=Se(i),o=Se(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function L8e(t,e){return Math.sqrt(gX(t,e))}function D8e(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of bX){const s=vX(t,i,Q6.get()),n=aX(s,e);n>r&&(r=n)}return Math.sqrt(r)}function yX(t,e){return $ye(t.plane,e)&&jye(t,e)}function N8e(t,e,r,i){return U8e(t,r,i)}function _X(t,e){const r=-t.plane[3];return BP(o0(t),e)-r}function F8e(t,e,r,i){const s=_X(t,e),n=re(B8e,o0(t),r-s);return pe(i,e,n),i}function Vye(t,e){return To(t.basis1,e.basis1)&&To(t.basis2,e.basis2)&&To(t.origin,e.origin)}function Gye(t,e,r){return t!==r&&tx(t,r),cn(wx,e),Ac(wx,wx),Ge(r.basis1,t.basis1,wx),Ge(r.basis2,t.basis2,wx),Ge(r.plane,t.plane,wx),Ge(r.origin,t.origin,e),vG(r.plane,r.plane,r.origin),r}function k8e(t,e,r,i){return t!==i&&tx(t,i),Su(fU,e,r),Ge(i.basis1,t.basis1,fU),Ge(i.basis2,t.basis2,fU),K6(i),i}function o0(t){return t.plane}function U8e(t,e,r){switch(e){case ls.X:ce(r,t.basis1),fe(r,r);break;case ls.Y:ce(r,t.basis2),fe(r,r);break;case ls.Z:ce(r,o0(t))}return r}function jye(t,e){const r=ye(ze.get(),e,t.origin),i=pa(t.basis1),s=pa(t.basis2),n=de(t.basis1,r),o=de(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function Jte(t,e){const r=Q6.get();return ce(r.origin,t.origin),ce(r.vector,e),r}function vX(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=re(ze.get(),i,e.origin[0]),a=re(ze.get(),s,e.origin[1]);pe(r.origin,o,a),pe(r.origin,r.origin,n);const l=re(ze.get(),i,e.direction[0]),c=re(ze.get(),s,e.direction[1]);return re(r.vector,pe(l,l,c),2),r}function z8e(t,e){Math.abs(de(t.basis1,t.basis2)/(Se(t.basis1)*Se(t.basis2)))>1e-6&&pU().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(de(t.basis1,o0(t)))>1e-6&&pU().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-de(o0(t),t.origin)-t.plane[3])>1e-6&&pU().warn(e,"Plane offset is not consistent with plane origin")}function Hye(t,e,r,i){const s=o0(t);JM(s,e.direction,e.origin,r),JM(r,s,e.origin,i)}const qye={plane:zr(),origin:Pe(0,0,0),basis1:Pe(1,0,0),basis2:Pe(0,1,0)},n5=new g0(zr),Q6=new g0(Lp),B8e=E(),V8e=new g0(()=>y0()),bX=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],wx=xe(),fU=xe(),G8e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Dye,altitudeAt:_X,axisAt:N8e,closestPoint:Uye,closestPointOnSilhouette:kye,copy:tx,copyWithoutVerify:R8e,create:y0,distance:L8e,distance2:gX,distanceToSilhouette:D8e,elevate:Nye,equals:Vye,extrusionContainsPoint:yX,fromAABoundingRect:Fye,fromValues:fX,intersectRay:mX,intersectRayClosestSilhouette:I8e,normal:o0,projectPoint:zye,projectPointLocal:Bye,rotate:k8e,setAltitudeAt:F8e,setExtent:$8e,transform:Gye,up:qye,updateUnboundedPlane:K6,wrap:O8e},Symbol.toStringTag,{value:"Module"})),j8e=new Xe(Eme),F3=new Xe(w6),k3=new Xe(x6),dOt=new Xe(Cme);function Fh(t){const e=Kte.get(t);if(e)return e;let r=j8e;if(t)if(t===F3)r=F3;else if(t===k3)r=k3;else{const i=t.wkid,s=t.latestWkid;if(i!=null||s!=null)FS(i)||FS(s)?r=F3:(kS(i)||kS(s))&&(r=k3);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===H8e?r=F3:o===q8e&&(r=k3)}}}return Kte.set(t,r),r}const Kte=new Map,H8e=F3.wkt.toUpperCase(),q8e=k3.wkt.toUpperCase(),Wye=Vs();function Vs(){return Yt()}const W8e=$w,Y8e=$w;function Iw(t,e){return xh(e,t)}function Yye(t,e){return zt(t[0],t[1],t[2],e)}function X8e(t){return t}function Z8e(t){t[0]=t[1]=t[2]=t[3]=0}function ek(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Gg(t){return t[3]}function J8e(t){return t}function Xye(t,e,r,i){return zt(t,e,r,i)}function K8e(t,e,r){return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=t[3]+e,r}function Q8e(t,e,r){return ae.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t!==r&&Iw(t,r),r}function f1(t,e,r){if(e==null||!Zye(t,e,o5))return!1;let{t0:i,t1:s}=o5;if((i<0||s<i&&s>0)&&(i=s),i<0)return!1;if(r){const{origin:n,direction:o}=e;r[0]=n[0]+o[0]*i,r[1]=n[1]+o[1]*i,r[2]=n[2]+o[2]*i}return!0}function eUe(t,e,r){const i=Iye(e,r);if(!Zye(t,i,o5))return[];const{origin:s,direction:n}=i,{t0:o,t1:a}=o5,l=c=>{const u=E();return kn(u,s,n,c),wX(t,u,u)};return Math.abs(o-a)<wa()?[l(o)]:[l(o),l(a)]}const o5={t0:0,t1:0};function Zye(t,e,r){const{origin:i,direction:s}=e,n=tUe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*o),r.t1=(-a+c)/(2*o),!0}const tUe=E();function xG(t,e){return f1(t,e,null)}function rUe(t,e,r){if(f1(t,e,r))return r;const i=ZE(t,e,ze.get());return pe(r,e.origin,re(ze.get(),e.direction,$i(e.origin,i)/Se(e.direction))),r}function ZE(t,e,r){const i=ze.get(),s=oX.get();Ze(i,e.origin,e.direction);const n=Gg(t);Ze(r,i,e.origin),re(r,r,1/Se(r)*n);const o=Kye(t,e.origin),a=X6(e.origin,r);return Su(s,a+o,i),Ge(r,r,s),r}function iUe(t,e,r){return f1(t,e,r)?r:(A8e(e,t,r),wX(t,r,r))}function wX(t,e,r){const i=ye(ze.get(),e,t),s=re(ze.get(),i,t[3]/Se(i));return pe(r,s,t)}function Jye(t,e){const r=ye(ze.get(),e,t),i=pa(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function Kye(t,e){const r=ye(ze.get(),e,t),i=Se(r),s=Gg(t),n=s+Math.abs(s-i);return Bn(s/n)}const mU=E();function Qye(t,e,r,i){const s=ye(mU,e,t);switch(r){case ls.X:{const n=Oee(s,mU)[2];return te(i,-Math.sin(n),Math.cos(n),0)}case ls.Y:{const n=Oee(s,mU),o=n[1],a=n[2],l=Math.sin(o);return te(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case ls.Z:return fe(i,s);default:return}}function e_e(t,e){const r=ye(TG,e,t);return Se(r)-t[3]}function sUe(t,e,r,i){const s=e_e(t,e),n=Qye(t,e,ls.Z,TG),o=re(TG,n,r-s);return pe(i,e,o)}function nUe(t,e){const r=So(t,e),i=Gg(t);return r<=i*i}function oUe(t,e,r=Yt()){const i=$i(t,e),s=t[3],n=e[3];return i+n<s?(xh(r,t),r):i+s<n?(xh(r,e),r):(li(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const TG=E(),tk=Vs(),aUe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Wye,altitudeAt:e_e,angleToSilhouette:Kye,axisAt:Qye,clear:Z8e,closestPoint:iUe,closestPointOnSilhouette:ZE,containsPoint:nUe,copy:Iw,create:Vs,distanceToSilhouette:Jye,elevate:K8e,equals:Y8e,exactEquals:W8e,fromCenterAndRadius:Yye,fromRadius:ek,fromValues:Xye,getCenter:J8e,getRadius:Gg,intersectLine:eUe,intersectRay:f1,intersectRayClosestSilhouette:rUe,intersectsRay:xG,projectPoint:wX,setAltitudeAt:sUe,setExtent:Q8e,tmpSphere:tk,union:oUe,wrap:X8e},Symbol.toStringTag,{value:"Module"}));function lUe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function cUe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function uUe(t){return{operations:t,value:t.create()}}function t_e(t,e,r=uUe(t)){return r.operations=t,t.copy(e,r.value),r}function hUe(t){return t_e(aUe,Xye(0,0,0,Vr(t).radius))}const Qte=2**50;function dUe(){return t_e(G8e,fX([0,0,0],[Qte,0,0],[0,Qte,0]))}function pUe(t,e,r){return t.operations.axisAt(t.value,e,ls.Z,r)}function fUe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function mUe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function gUe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function yUe(t,e){return t.operations.altitudeAt(t.value,e)}function r_e(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function _Ue(t,e,r,i){return e!==i&&Bs(i,e),te(xx,i[12],i[13],i[14]),r_e(t,xx,r,xx),i[12]=xx[0],i[13]=xx[1],i[14]=xx[2],i}function gU(t,e,r){return t.operations.elevate(t.value,e,r.value)}const xx=E();function ere(t,e,r,i,s){return s[0]=de(t,e),s[1]=de(t,r),s[2]=de(t,i),s}function SG(t,e,r,i,s){ce(r,t),ce(E$,e),fe(E$,E$),Ze(i,E$,r),Ze(s,i,r)}function vUe(t,e){return t?Fh(e):e.isGeographic?Xe.PlateCarree:e}const E$=E(),xX=96;function pOt(t,e){const r=t.extent,i=t.width,s=xa(r==null?void 0:r.spatialReference);return r&&i?r.width/i*s*EY*xX:0}function bUe(t,e){return t/(xa(e)*EY*xX)}function wUe(t){return t/(EY*xX)}function fOt(t,e,r){return xUe(t,e)&&TUe(t,r)}function xUe(t,e){return e===0||w_(t,e)||t<e}function TUe(t,e){return e===0||w_(t,e)||t>e}function mOt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function SUe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function Tx(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function VP(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function QS(t){return t!=null&&"type"in t&&t.type==="group"}const gOt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function EUe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function CUe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function KM(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function tre(t){return(t==null?void 0:t.type)==="voxel"}function rre(t){return(t==null?void 0:t.type)==="imagery-tile"}function CD(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function rk(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function yOt(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function AUe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function PUe(t,e){const r=Jr==null?void 0:Jr.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Wr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function MUe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function OUe(t){return MUe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function RUe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function $Ue(t){return!!RUe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}let eE=class extends NP{constructor(e){super(e),this.addHandles(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(ae.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};eE=d([V("esri.support.AnalysesCollection")],eE);const AD={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},yU={xsmall:544,small:768,medium:992,large:1200};function IUe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function _U(t,e){return e?AD[t].valueToClassName[e].split(" "):[]}const LUe=t=>{let e=class extends t{constructor(...r){super(...r),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=yU}initialize(){this.addHandles(he(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),ui))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=IUe(r);if(!i){const s=JSON.stringify(yU,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:yU,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=pc.acquire(),i=pc.acquire();let s,n=!1;for(s in AD){const o=this[s],a=AD[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,_U(s,o).forEach(l=>i.push(l)),_U(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),pc.release(r),pc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in AD)_U(i,this[i]).forEach(s=>r.classList.remove(s))}};return d([m()],e.prototype,"breakpoints",null),d([m()],e.prototype,"orientation",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),d([m()],e.prototype,"heightBreakpoint",void 0),e=d([V("esri.views.BreakpointsOwner")],e),e};let mp=class extends Me{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,r,i={}){return this._installWatch(e,r,i,he)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Ih)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([Ho(e,"after-changes",this._createSyncUpdatingCallback(),ti),Ho(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),Yr(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this.addHandles(Yr(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(C$)||this._set("updating",!1))}),r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this.removeHandles(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this.addHandles(o,n),Yr(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=he(e,i,{sync:!0,equals:()=>!1});return this.addHandles(s,r),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(C$),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(zE(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(C$))}),C$)}}};d([m({readOnly:!0})],mp.prototype,"updating",void 0),mp=d([V("esri.core.support.UpdatingHandles")],mp);const C$=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(é›·å®—æ°‘) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var DUe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},db={exports:{}},hn={},QM={exports:{}},rx={};function i_e(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function NUe(t,e,r){}function FUe(t,e,r){}var kUe=/javascript\s*\:/img;function UUe(t,e){return kUe.test(e)?"":e}rx.whiteList=i_e();rx.getDefaultWhiteList=i_e;rx.onAttr=NUe;rx.onIgnoreAttr=FUe;rx.safeAttrValue=UUe;var zUe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},IC=zUe;function BUe(t,e){t=IC.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var u=IC.trim(t.slice(s,n)),h=u.indexOf(":");if(h!==-1){var p=IC.trim(u.slice(0,h)),f=IC.trim(u.slice(h+1));if(p){var g=e(s,o.length,p,f,u);g&&(o+=g+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return IC.trim(o)}var VUe=BUe,A$=rx,GUe=VUe;function ire(t){return t==null}function jUe(t){var e={};for(var r in t)e[r]=t[r];return e}function s_e(t){t=jUe(t||{}),t.whiteList=t.whiteList||A$.whiteList,t.onAttr=t.onAttr||A$.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||A$.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||A$.safeAttrValue,this.options=t}s_e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=GUe(t,function(l,c,u,h,p){var f=i[u],g=!1;if(f===!0?g=f:typeof f=="function"?g=f(h):f instanceof RegExp&&(g=f.test(h)),g!==!0&&(g=!1),h=o(u,h),!!h){var _={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var v=s(u,h,_);return ire(v)?u+":"+h:v}else{var v=n(u,h,_);if(!ire(v))return v}}});return a};var HUe=s_e;(function(t,e){var r=rx,i=HUe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(QM,QM.exports);var TX={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},qUe=QM.exports.FilterCSS,WUe=QM.exports.getDefaultWhiteList,a5=TX;function n_e(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var o_e=new qUe;function YUe(t,e,r){}function XUe(t,e,r){}function ZUe(t,e,r){}function JUe(t,e,r){}function a_e(t){return t.replace(QUe,"&lt;").replace(e9e,"&gt;")}function KUe(t,e,r,i){if(r=p_e(r),e==="href"||e==="src"){if(r=a5.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(P$.lastIndex=0,P$.test(r))return""}else if(e==="style"){if(sre.lastIndex=0,sre.test(r)||(nre.lastIndex=0,nre.test(r)&&(P$.lastIndex=0,P$.test(r))))return"";i!==!1&&(i=i||o_e,r=i.process(r))}return r=f_e(r),r}var QUe=/</g,e9e=/>/g,t9e=/"/g,r9e=/&quot;/g,i9e=/&#([a-zA-Z0-9]*);?/gim,s9e=/&colon;?/gim,n9e=/&newline;?/gim,P$=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,sre=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,nre=/u\s*r\s*l\s*\(.*/gi;function l_e(t){return t.replace(t9e,"&quot;")}function c_e(t){return t.replace(r9e,'"')}function u_e(t){return t.replace(i9e,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function h_e(t){return t.replace(s9e,":").replace(n9e," ")}function d_e(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return a5.trim(e)}function p_e(t){return t=c_e(t),t=u_e(t),t=h_e(t),t=d_e(t),t}function f_e(t){return t=l_e(t),t=a_e(t),t}function o9e(){return""}function a9e(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:a5.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return a5.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function l9e(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function c9e(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}hn.whiteList=n_e();hn.getDefaultWhiteList=n_e;hn.onTag=YUe;hn.onIgnoreTag=XUe;hn.onTagAttr=ZUe;hn.onIgnoreTagAttr=JUe;hn.safeAttrValue=KUe;hn.escapeHtml=a_e;hn.escapeQuote=l_e;hn.unescapeQuote=c_e;hn.escapeHtmlEntities=u_e;hn.escapeDangerHtml5Entities=h_e;hn.clearNonPrintableCharacter=d_e;hn.friendlyAttrValue=p_e;hn.escapeAttrValue=f_e;hn.onIgnoreTagStripAll=o9e;hn.StripTagBody=a9e;hn.stripCommentTag=l9e;hn.stripBlankChar=c9e;hn.cssFilter=o_e;hn.getDefaultCSSWhiteList=WUe;var ik={},Hy=TX;function u9e(t){var e=Hy.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=Hy.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function h9e(t){return t.slice(0,2)==="</"}function d9e(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var h=t.charAt(a);if(n===!1){if(h==="<"){n=a;continue}}else if(o===!1){if(h==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(h===">"){i+=r(t.slice(s,n)),u=t.slice(n,a+1),c=u9e(u),i+=e(n,i.length,c,u,h9e(u)),s=a+1,n=!1;continue}if(h==='"'||h==="'")for(var p=1,f=t.charAt(a-p);f.trim()===""||f==="=";){if(f==="="){o=h;continue e}f=t.charAt(a-++p)}}else if(h===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var p9e=/[^a-zA-Z0-9\\_:.-]/gim;function f9e(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(p,f){if(p=Hy.trim(p),p=p.replace(p9e,"").toLowerCase(),!(p.length<1)){var g=e(p,f||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,h;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:g9e(t,l+1);continue}if(n!==!1&&l===i){if(h=t.indexOf(c,l+1),h===-1)break;u=Hy.trim(t.slice(i+1,h)),a(n,u),n=!1,l=h,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(h=m9e(t,l),h===-1){u=Hy.trim(t.slice(r,l)),a(u),n=!1,r=l+1;continue}else{l=h-1;continue}else if(h=y9e(t,l-1),h===-1){u=Hy.trim(t.slice(r,l)),u=ore(u),a(n,u),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,ore(Hy.trim(t.slice(r))))),Hy.trim(s.join(" "))}function m9e(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function g9e(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function y9e(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function _9e(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function ore(t){return _9e(t)?t.substr(1,t.length-2):t}ik.parseTag=d9e;ik.parseAttr=f9e;var v9e=QM.exports.FilterCSS,Dd=hn,m_e=ik,b9e=m_e.parseTag,w9e=m_e.parseAttr,PD=TX;function M$(t){return t==null}function x9e(t){var e=PD.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=PD.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=PD.trim(t.slice(0,-1))),{html:t,closing:r}}function T9e(t){var e={};for(var r in t)e[r]=t[r];return e}function S9e(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function g_e(t){t=T9e(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Dd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=S9e(t.whiteList||t.allowList):t.whiteList=Dd.whiteList,t.onTag=t.onTag||Dd.onTag,t.onTagAttr=t.onTagAttr||Dd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Dd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Dd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Dd.safeAttrValue,t.escapeHtml=t.escapeHtml||Dd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new v9e(t.css))}g_e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=Dd.stripBlankChar(t)),r.allowCommentTag||(t=Dd.stripCommentTag(t));var h=!1;r.stripIgnoreTagBody&&(h=Dd.StripTagBody(r.stripIgnoreTagBody,n),n=h.onIgnoreTag);var p=b9e(t,function(f,g,_,v,b){var w={sourcePosition:f,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,_)},T=s(_,v,w);if(!M$(T))return T;if(w.isWhite){if(w.isClosing)return"</"+_+">";var S=x9e(v),C=i[_],P=w9e(S.html,function(R,L){var F=PD.indexOf(C,R)!==-1,U=o(_,R,L,F);return M$(U)?F?(L=l(_,R,L,u),L?R+'="'+L+'"':R):(U=a(_,R,L,F),M$(U)?void 0:U):U});return v="<"+_,P&&(v+=" "+P),S.closing&&(v+=" /"),v+=">",v}else return T=n(_,v,w),M$(T)?c(v):T},c);return h&&(p=h.remove(p)),p};var E9e=g_e;(function(t,e){var r=hn,i=ik,s=E9e;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(db,db.exports);var C9e=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):db.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new db.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?db.exports.escapeAttrValue(e):!n&&!s?db.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):db.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(DUe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const sk=new Map;function y_e(){sk.clear()}function A9e(t){return sk.get(t)}function P9e(t,e){sk.set(t,e)}function vU(t){sk.delete(t)}const M9e=()=>ae.getLogger("esri.widgets.support.widgetUtils");function O9e(...t){const e=pc.acquire();for(let i=0;i<t.length;i++){const s=t[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return pc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var s;y_e();for(const n of i)(s=t.get(n.target))==null||s(n)}),r=(i,s,n)=>(t.has(i)&&M9e().error("Already observing element",i),t.set(i,s),e.observe(i,n),Yr(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return mw([he(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,s,n))},si),Yr(()=>o==null?void 0:o.remove())])}})();function R9e(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function bOt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function wOt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const $9e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],I9e=$9e.reduce((t,e)=>(t[e]=[],t),{}),L9e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],__e=new C9e({whiteList:I9e,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(L9e.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function D9e(t){return t==="Enter"||t===" "}const v_e="http://www.w3.org/",nk=`${v_e}2000/svg`,b_e=`${v_e}1999/xlink`;let are=[],SX=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},EX=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),w_e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},N9e=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(EX(t[i],e))return i}return-1},bU=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(EX(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},F9e=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},EG=[],CG=!1,x_e=t=>{(t.children||[]).forEach(x_e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},lre=()=>{CG=!1,EG.forEach(x_e),EG.length=0},cre=t=>{EG.push(t),CG||(CG=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(lre,{timeout:16}):setTimeout(lre,16))},ure=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),cre(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),cre(t))},k9e=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")PG(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h],f=l[p];f&&(w_e(f),r.styleApplyer(t,p,f))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),t[a]=l):r.namespace===nk?a==="href"?t.setAttributeNS(b_e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=__e.sanitize(l):AG(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function AG(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let l5,U9e=(t,e,r)=>{if(e)for(let i of e)wT(i,t,void 0,r)},T_e=(t,e,r)=>{U9e(t,e.children,r),e.text&&(t.textContent=e.text),k9e(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},wT=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),h=o.slice(n,l);u==="."?s.classList.add(h):u==="#"?s.id=h:(h==="svg"&&(i=SX(i,{namespace:nk})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,h):(s=t.domNode=t.domNode||a.createElement(h),h==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}T_e(s,t,i)}},PG=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},z9e=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],u=e[l];if(l==="class")u!==c&&(PG(t,u,!1),PG(t,c,!0));else if(l==="classes"){let h=t.classList,p=Object.keys(c),f=p.length;for(let g=0;g<f;g++){let _=p[g],v=!!c[_];v!==!!u[_]&&(s=!0,v?h.add(_):h.remove(_))}}else if(l==="styles"){let h=Object.keys(c),p=h.length;for(let f=0;f<p;f++){let g=h[f],_=c[g];_!==u[g]&&(s=!0,_?(w_e(_),i.styleApplyer(t,g,_)):i.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||AG(t)){if(c!==u){let h=typeof c;h==="function"&&i.eventHandlerInterceptor||(i.namespace===nk?l==="href"?t.setAttributeNS(b_e,l,c):t.setAttribute(l,c):h==="string"?l==="innerHTML"?t[l]=__e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):AG(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let h=t[l];h!==c&&(t["oninput-value"]?h===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},B9e=(t,e,r,i,s)=>{if(r===i)return!1;i=i||are;let n,o=(r=r||are).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let h=l<o?r[l]:void 0,p=i[c];if(h!==void 0&&EX(h,p))u=l5(h,p,s)||u,l++;else{let f=N9e(r,p,l+1);if(f>=0){for(n=l;n<f;n++)ure(r[n]),bU(r,n,t,"removed");u=l5(r[f],p,s)||u,l=f+1}else wT(p,e,l<o?r[l].domNode:void 0,s),F9e(p),bU(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)ure(r[n]),bU(r,n,t,"removed");return u};l5=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=SX(r,{namespace:nk})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=B9e(e,i,t.children,e.children,r)||n,n=z9e(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let LC=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,l5(i,r,e)},domNode:t.domNode});const V9e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let R2=t=>SX(V9e,t),f_={create:(t,e)=>(e=R2(e),wT(t,document.createElement("div"),void 0,e),LC(t,e)),append:(t,e,r)=>(r=R2(r),wT(e,t,void 0,r),LC(e,r)),insertBefore:(t,e,r)=>(r=R2(r),wT(e,t.parentNode,t,r),LC(e,r)),merge:(t,e,r)=>(r=R2(r),e.domNode=t,T_e(t,e,r),LC(e,r)),replace:(t,e,r)=>(r=R2(r),wT(e,t.parentNode,t,r),t.parentNode.removeChild(t),LC(e,r))},S_e,G9e=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};S_e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let j9e=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?S_e(r.children,s=>s.domNode===i):void 0}),r},H9e=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=G9e(s.currentTarget,n.domNode);o.reverse();let a,l=j9e(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},hre=t=>{let e,r,i=R2(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(h,p,f)=>{let g,_=()=>g;i.eventHandlerInterceptor=H9e(e,_,s),g=h(p,f(),i),a.push(g),l.push(f)},u=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let h=0;h<a.length;h++){let p=l[h]();s("rendered",void 0),a[h].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(h,p)=>{c(f_.append,h,p)},insertBefore:(h,p)=>{c(f_.insertBefore,h,p)},merge:(h,p)=>{c(f_.merge,h,p)},replace:(h,p)=>{c(f_.replace,h,p)},detach:h=>{for(let p=0;p<l.length;p++)if(l[p]===h)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},wy=class extends Me{constructor(){super(...arguments),this.items=new Mt,this._watchUpdatingTracking=new mp,this._callbacks=new Map,this._projector=hre(),this._hiddenProjector=hre()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,r){const i=!!(r!=null&&r.disableDecorations);if(!this.items.some(n=>n.visible&&!(i&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{i&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],wy.prototype,"surface",void 0),d([m({readOnly:!0})],wy.prototype,"items",void 0),d([m({readOnly:!0})],wy.prototype,"needsRender",null),d([m({readOnly:!0})],wy.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],wy.prototype,"updating",null),wy=d([V("esri.views.overlay.ViewOverlay")],wy);const dre=wy,wU=[0,0];function q9e(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return wU[0]=r.left+((e==null?void 0:e.pageXOffset)??0),wU[1]=r.top+((e==null?void 0:e.pageYOffset)??0),wU}function pre(t){t&&(hge(t),t.parentNode&&t.parentNode.removeChild(t))}function W9e(t){const e=document.createElement("div");return t.appendChild(e),e}const DC=16,O$=750,Y9e=512,X9e=2,Z9e=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:DC,time:O$},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([he(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),he(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){const r=se("mac"),i=async()=>{r&&(await GS(()=>this.ready),this.messagesCommon=await YY("esri/t9n/common").catch(()=>{}))};i(),this.addHandles([he(()=>this.ui,(s,n)=>this._handleUIChange(s,n),ui),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),NY(i),he(()=>[this.surface,this.messagesCommon],()=>{var s,n,o;r&&((o=this.surface)==null||o.setAttribute("aria-label",((n=(s=this.messagesCommon)==null?void 0:s.ariaLabels)==null?void 0:n.navigationMacVoiceOver)??""))})])}destroy(){this.destroyed||(this.ui=Ae(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=R6(r);if(s||typeof r!="string"||ae.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(pre(this.root),this._set("root",null)),this.userContent&&(Zee(this.userContent,i),pre(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Zee(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new dre;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(he(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=yw({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=wi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(he(()=>this.root,s=>{r.container=s?W9e(s):null},ui),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=DC,r.time=O$,this.addHandles([UE(window,"resize",()=>{r.freq=DC,r.time=O$}),yw({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=DC,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?DC:Math.min(O$,n.freq*X9e),!s&&n.freq>=Y9e&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&q9e(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],e.prototype,"container",null),d([m({readOnly:!0})],e.prototype,"focused",null),d([m({readOnly:!0})],e.prototype,"height",void 0),d([m()],e.prototype,"messagesCommon",void 0),d([m({type:dre})],e.prototype,"overlay",void 0),d([m({readOnly:!0})],e.prototype,"position",void 0),d([m({readOnly:!0})],e.prototype,"resizing",void 0),d([m({readOnly:!0})],e.prototype,"root",void 0),d([m({value:null,readOnly:!0})],e.prototype,"size",null),d([m({readOnly:!0})],e.prototype,"surface",void 0),d([m({readOnly:!0})],e.prototype,"suspended",void 0),d([m()],e.prototype,"ui",void 0),d([m({readOnly:!0})],e.prototype,"userContent",void 0),d([m({readOnly:!0})],e.prototype,"width",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),e=d([V("esri.views.DOMContainer")],e),e};function m1(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function ya(t,e,r,i,s){return!(e==null||i==null||t.length<2)&&(NC.x=t[0],NC.y=t[1],NC.z=t[2],NC.spatialReference=e,Qa(NC,r,i,s))}const NC=m1(0,0,0,Xe.WGS84);function _m(t,e,r){return!!ya(t,e,R$,r.spatialReference)&&(r.x=R$[0],r.y=R$[1],r.z=R$[2],!0)}async function E_e(t,e,r,i){return await aR(e,r.spatialReference,null,i),_m(t,e,r)}const R$=E();var Ne;function fre(t){return t==="global"?Ne.Global:Ne.Local}function xU(t){return t===Ne.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ne||(Ne={}));var ki,Co;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(ki||(ki={}));let J9e=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Co.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Co||(Co={}));let K9e=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Q9e=class extends K9e{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?qi(s):null}},C_e=class{constructor(e){this.layerUid=e}},dR=class extends C_e{constructor(e,r){super(e),this.graphicUid=r}};function Wh(t){return(t==null?void 0:t.dist)!=null}function mre(t){return(e,r,i)=>(li(gre,e,r,i),!yX(t,gre))}function ok(t){return Wh(t)&&t.intersector===ki.OBJECT&&!!t.target}function ak(t){return Wh(t)&&t.intersector===ki.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const gre=E();function kh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function eze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function CX(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function AX(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Uh(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function ix(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=-u*n+a*l,f=c*n-o*l;let g=r*h+i*p+s*f;return g?(g=1/g,t[0]=h*g,t[1]=(-u*i+s*c)*g,t[2]=(a*i-s*o)*g,t[3]=p*g,t[4]=(u*r-s*l)*g,t[5]=(-a*r+s*n)*g,t[6]=f*g,t[7]=(-c*r+i*l)*g,t[8]=(o*r-i*n)*g,t):null}function tze(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-i*u,t[2]=i*a-s*o,t[3]=a*l-n*u,t[4]=r*u-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function rze(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function tE(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=r[0],f=r[1],g=r[2],_=r[3],v=r[4],b=r[5],w=r[6],T=r[7],S=r[8];return t[0]=p*i+f*o+g*c,t[1]=p*s+f*a+g*u,t[2]=p*n+f*l+g*h,t[3]=_*i+v*o+b*c,t[4]=_*s+v*a+b*u,t[5]=_*n+v*l+b*h,t[6]=w*i+T*o+S*c,t[7]=w*s+T*a+S*u,t[8]=w*n+T*l+S*h,t}function c5(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=r[0],f=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+f*o+c,t[7]=p*s+f*a+u,t[8]=p*n+f*l+h,t}function PX(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=Math.sin(r),f=Math.cos(r);return t[0]=f*i+p*o,t[1]=f*s+p*a,t[2]=f*n+p*l,t[3]=f*o-p*i,t[4]=f*a-p*s,t[5]=f*l-p*n,t[6]=c,t[7]=u,t[8]=h,t}function lk(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function ize(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function sze(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function nze(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function oze(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function aze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function eO(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,h=i*a,p=s*o,f=s*a,g=s*l,_=n*o,v=n*a,b=n*l;return t[0]=1-h-g,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-g,t[7]=f-_,t[2]=p-v,t[5]=f+_,t[8]=1-c-h,t}function A_e(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*o-a*c,p=-u*n+a*l,f=c*n-o*l,g=r*h+i*p+s*f;if(!g)return null;const _=1/g;return t[0]=h*_,t[1]=(-u*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=p*_,t[4]=(u*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=f*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function a0(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15],w=r*a-i*o,T=r*l-s*o,S=r*c-n*o,C=i*l-s*a,P=i*c-n*a,R=s*c-n*l,L=u*_-h*g,F=u*v-p*g,U=u*b-f*g,j=h*v-p*_,z=h*b-f*_,Z=p*b-f*v;let W=w*Z-T*z+S*j+C*U-P*F+R*L;return W?(W=1/W,t[0]=(a*Z-l*z+c*j)*W,t[1]=(l*U-o*Z-c*F)*W,t[2]=(o*z-a*U+c*L)*W,t[3]=(s*z-i*Z-n*j)*W,t[4]=(r*Z-s*U+n*F)*W,t[5]=(i*U-r*z-n*L)*W,t[6]=(_*R-v*P+b*C)*W,t[7]=(v*S-g*R-b*T)*W,t[8]=(g*P-_*S+b*w)*W,t):null}function lze(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function cze(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function uze(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function hze(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function P_e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function dze(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function pze(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function fze(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function mze(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],p=e[1],f=e[2],g=e[3],_=e[4],v=e[5],b=e[6],w=e[7],T=e[8],S=wa();return Math.abs(r-h)<=S*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-f)<=S*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-T)<=S*Math.max(1,Math.abs(u),Math.abs(T))}function MX(t){const e=wa(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const gze=tE,yze=P_e;Object.freeze(Object.defineProperty({__proto__:null,add:hze,adjoint:tze,copy:eze,determinant:rze,equals:mze,exactEquals:fze,frob:uze,fromMat2d:aze,fromMat4:kh,fromQuat:eO,fromRotation:nze,fromScaling:oze,fromTranslation:sze,identity:AX,invert:ix,isOrthoNormal:MX,mul:gze,multiply:tE,multiplyScalar:dze,multiplyScalarAndAdd:pze,normalFromMat4:a0,normalFromMat4Legacy:A_e,projection:lze,rotate:PX,scale:lk,scaleByVec2:ize,set:CX,str:cze,sub:yze,subtract:P_e,translate:c5,transpose:Uh},Symbol.toStringTag,{value:"Module"}));function _ze(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function tO(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function ck(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>wa()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function uk(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-i*c,t[2]=n*u+o*c+i*l-s*a,t[3]=o*u-i*a-s*l-n*c,t}function vze(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function bze(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function wze(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function xze(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function MD(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,h,p,f=r[0],g=r[1],_=r[2],v=r[3];return c=s*f+n*g+o*_+a*v,c<0&&(c=-c,f=-f,g=-g,_=-_,v=-v),1-c>wa()?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(h=1-i,p=i),t[0]=h*s+p*f,t[1]=h*n+p*g,t[2]=h*o+p*_,t[3]=h*a+p*v,t}function Tze(t){const e=ZO,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function Sze(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function S_(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function M_e(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function Eze(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function Cze(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Aze=xh,O_e=es,Pze=lX,Mze=uk,Oze=Rw,Rze=Pye,$ze=hX,R_e=cX,Ize=R_e,$_e=uX,Lze=$_e,OX=Aye,Dze=eS,Nze=$w;function Fze(t,e,r){const i=de(e,r);return i<-.999999?(Ze(zp,kze,e),nc(zp)<1e-6&&Ze(zp,Uze,e),fe(zp,zp),tO(t,zp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ze(zp,e,r),t[0]=zp[0],t[1]=zp[1],t[2]=zp[2],t[3]=1+i,OX(t,t))}const zp=E(),kze=Pe(1,0,0),Uze=Pe(0,1,0);function zze(t,e,r,i,s,n){return MD(yre,e,s,n),MD(_re,r,i,n),MD(t,yre,_re,2*n*(1-n)),t}const yre=$c(),_re=$c();function Bze(t,e,r,i){const s=Vze;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],OX(t,M_e(t,s))}const Vze=xi();Object.freeze(Object.defineProperty({__proto__:null,add:Pze,calculateW:xze,conjugate:S_,copy:Aze,dot:Rze,equals:Nze,exactEquals:Dze,fromEuler:Eze,fromMat3:M_e,getAxisAngle:ck,identity:_ze,invert:Sze,len:Ize,length:R_e,lerp:$ze,mul:Mze,multiply:uk,normalize:OX,random:Tze,rotateX:vze,rotateY:bze,rotateZ:wze,rotationTo:Fze,scale:Oze,set:O_e,setAxes:Bze,setAxisAngle:tO,slerp:MD,sqlerp:zze,sqrLen:Lze,squaredLength:$_e,str:Cze},Symbol.toStringTag,{value:"Module"}));function I_e(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Gze(t,e,r){return I_e(t,e,r),Ac(r,r),r}function $l(t,e,r,i){if(t==null||i==null)return!1;const s=ZM(t,U0e),n=ZM(i,eke);if(s===n&&!vre(n)&&(s!==K.UNKNOWN||co(t,i)))return cR(r,e),!0;if(vre(n)){const o=bT[s][K.LON_LAT],a=bT[K.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,V0,0),a(V0,0,G0,0),I_e($$*V0[0],$$*V0[1],r),r[12]=G0[0],r[13]=G0[1],r[14]=G0[2],!0)}if((n===K.WEB_MERCATOR||n===K.PLATE_CARREE||n===K.WGS84)&&(s===K.WGS84||s===K.CGCS2000&&n===K.PLATE_CARREE||s===K.SPHERICAL_ECEF||s===K.WEB_MERCATOR)){const o=bT[s][K.LON_LAT],a=bT[K.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,V0,0),a(V0,0,G0,0),s===K.SPHERICAL_ECEF?Gze($$*V0[0],$$*V0[1],r):Nh(r),r[12]=G0[0],r[13]=G0[1],r[14]=G0[2],!0)}return!1}function vre(t){return t===K.SPHERICAL_ECEF||t===K.SPHERICAL_MARS_PCPF||t===K.SPHERICAL_MOON_PCPF}const $$=Lt(1),V0=E(),G0=E();let JE=class{constructor(e,r,i=r){this.data=e,this.size=r,this.stride=i}},qe=class extends JE{constructor(e,r,i,s=!1,n=i){super(e,i,n),this.indices=r,this.exclusive=s}};const rE=1e-6,FC=E(),I$=E();function jze(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new eBe(t);OG(FC,n.minProj,n.maxProj),U3(FC,FC,.5),ch(I$,n.maxProj,n.minProj);const o=MG(I$),a=new tBe;a.quality=o,s<14&&(t=new JE(new Float64Array(n.buffer,112,42),3));const l=E(),c=E(),u=E(),h=E(),p=E(),f=E(),g=E();switch(Hze(n,t,g,l,c,u,h,p,f,a)){case 1:return void Tre(FC,I$,e);case 2:return void Kze(t,h,e)}qze(t,g,l,c,u,h,p,f,a),L_e(t,a.b0,a.b1,a.b2,rS,iS);const _=E();ch(_,iS,rS),a.quality=MG(_),a.quality<o?D_e(a.b0,a.b1,a.b2,rS,iS,_,e):Tre(FC,I$,e)}function Hze(t,e,r,i,s,n,o,a,l,c){return Wze(t,i,s),RG(i,s)<rE?1:(ch(o,i,s),Do(o,o),Yze(e,i,o,n)<rE?2:(ch(a,s,n),Do(a,a),ch(l,n,i),Do(l,l),uh(r,a,o),Do(r,r),wv(e,r,o,a,l,c),0))}const kC=E(),UC=E(),$u=E(),Iu=E(),Lu=E(),j0=E(),H0=E(),q0=E();function qze(t,e,r,i,s,n,o,a,l){Xze(t,e,r,kC,UC),kC[0]!==void 0&&(ch($u,kC,r),Do($u,$u),ch(Iu,kC,i),Do(Iu,Iu),ch(Lu,kC,s),Do(Lu,Lu),uh(j0,Iu,n),Do(j0,j0),uh(H0,Lu,o),Do(H0,H0),uh(q0,$u,a),Do(q0,q0),wv(t,j0,n,Iu,$u,l),wv(t,H0,o,Lu,Iu,l),wv(t,q0,a,$u,Lu,l)),UC[0]!==void 0&&(ch($u,UC,r),Do($u,$u),ch(Iu,UC,i),Do(Iu,Iu),ch(Lu,UC,s),Do(Lu,Lu),uh(j0,Iu,n),Do(j0,j0),uh(H0,Lu,o),Do(H0,H0),uh(q0,$u,a),Do(q0,q0),wv(t,j0,n,Iu,$u,l),wv(t,H0,o,Lu,Iu,l),wv(t,q0,a,$u,Lu,l))}function Wze(t,e,r){let i=RG(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=RG(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}du(e,t.minVert[s]),du(r,t.maxVert[s])}const Du=[0,0,0];function Yze(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Du[0]=s[l]-e[0],Du[1]=s[l+1]-e[1],Du[2]=s[l+2]-e[2];const c=r[0]*Du[0]+r[1]*Du[1]+r[2]*Du[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=Du[0]*Du[0]+Du[1]*Du[1]+Du[2]*Du[2]-c*c/u;h>o&&(o=h,a=l)}return du(i,s,a),o}const Dn=je();function Xze(t,e,r,i,s){Jze(t,e,Dn,s,i);const n=F_e(r,e);Dn[1]-rE<=n&&(i[0]=void 0),Dn[0]+rE>=n&&(s[0]=void 0)}const bre=E(),wre=E(),xre=E(),Sx=E(),Ex=E(),L$=E();function wv(t,e,r,i,s,n){if(N_e(e)<rE)return;uh(bre,r,e),uh(wre,i,e),uh(xre,s,e),tS(t,e,Dn),Ex[1]=Dn[0],Sx[1]=Dn[1],L$[1]=Sx[1]-Ex[1];const o=[r,i,s],a=[bre,wre,xre];for(let l=0;l<3;++l){tS(t,o[l],Dn),Ex[0]=Dn[0],Sx[0]=Dn[1],tS(t,a[l],Dn),Ex[2]=Dn[0],Sx[2]=Dn[1],L$[0]=Sx[0]-Ex[0],L$[2]=Sx[2]-Ex[2];const c=MG(L$);c<n.quality&&(du(n.b0,o[l]),du(n.b1,e),du(n.b2,a[l]),n.quality=c)}}const Zze=E();function tS(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Jze(t,e,r,i,s){const{data:n,size:o}=t;du(i,n),du(s,i),r[0]=F_e(Zze,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,du(i,n,a)),l>r[1]&&(r[1]=l,du(s,n,a))}}function Tre(t,e,r){r.center=t,r.halfSize=re(e,e,.5),r.quaternion=iX}const zm=E(),Cx=E(),zC=E(),rS=E(),iS=E(),Sre=E();function Kze(t,e,r){du(zm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?zm[0]=0:Math.abs(e[1])>Math.abs(e[2])?zm[1]=0:zm[2]=0,N_e(zm)<rE&&(zm[0]=zm[1]=zm[2]=1),uh(Cx,e,zm),Do(Cx,Cx),uh(zC,e,Cx),Do(zC,zC),L_e(t,e,Cx,zC,rS,iS),ch(Sre,iS,rS),D_e(e,Cx,zC,rS,iS,Sre,r)}function L_e(t,e,r,i,s,n){tS(t,e,Dn),s[0]=Dn[0],n[0]=Dn[1],tS(t,r,Dn),s[1]=Dn[0],n[1]=Dn[1],tS(t,i,Dn),s[2]=Dn[0],n[2]=Dn[1]}const L1=E(),BC=E(),D$=E(),Bp=zP(1,0,0,0,1,0,0,0,1),Qze=$c();function D_e(t,e,r,i,s,n,o){Bp[0]=t[0],Bp[1]=t[1],Bp[2]=t[2],Bp[3]=e[0],Bp[4]=e[1],Bp[5]=e[2],Bp[6]=r[0],Bp[7]=r[1],Bp[8]=r[2],o.quaternion=rBe(Qze,Bp),OG(L1,i,s),U3(L1,L1,.5),U3(BC,t,L1[0]),U3(D$,e,L1[1]),OG(BC,BC,D$),U3(D$,r,L1[2]),o.center=pe(BC,BC,D$),o.halfSize=re(L1,n,.5)}const Lc=7;let eBe=class{constructor(e){this.minVert=new Array(Lc),this.maxVert=new Array(Lc);const r=64*Lc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Lc),i+=8*Lc,this.maxProj=new Float64Array(this.buffer,i,Lc),i+=8*Lc;for(let l=0;l<Lc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Lc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Lc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Lc),n=new Array(Lc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Lc;++l){let c=s[l];du(this.minVert[l],o,c),c=n[l],du(this.maxVert[l],o,c)}}},tBe=class{constructor(){this.b0=Pe(1,0,0),this.b1=Pe(0,1,0),this.b2=Pe(0,0,1),this.quality=0}};function MG(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function OG(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function ch(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function U3(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function du(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function uh(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function Do(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function N_e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function RG(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function F_e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function rBe(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}return t}let k_e=class OD{constructor(e=Cn,r=dBe,i=iX){this._data=[e[0],e[1],e[2],r[0],r[1],r[2],i[0],i[1],i[2],i[3]]}clone(){const e=new OD;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const r=new OD;return r._data=e.slice(),r}static fromJSON(e){return new OD(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return te(ze.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,r,i){this._data[0]=e,this._data[1]=r,this._data[2]=i}get halfSize(){return te(ze.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return O_e(jke.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const r=Ki,i=this._data;r[0]=i[6],r[1]=i[7],r[2]=i[8],r[3]=i[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*i[3],n[1]=(2&s?-1:1)*i[4],n[2]=(4&s?-1:1)*i[5],lc(n,n,r),n[0]+=i[0],n[1]+=i[1],n[2]+=i[2]}}isVisible(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],r=this._data[4],i=this._data[5];return Math.sqrt(e*e+r*r+i*i)}intersectSphere(e){rr[0]=this._data[0]-e[0],rr[1]=this._data[1]-e[1],rr[2]=this._data[2]-e[2];const r=this.getQuaternion($g);return S_(Ki,r),lc(rr,rr,Ki),IS(rr,rr),Bm[0]=Math.min(rr[0],this._data[3]),Bm[1]=Math.min(rr[1],this._data[4]),Bm[2]=Math.min(rr[2],this._data[5]),kM(Bm,rr)<e[3]*e[3]}intersectSphereWithMBS(e,r=this.radius){const i=this._data;rr[0]=i[0]-e[0],rr[1]=i[1]-e[1],rr[2]=i[2]-e[2];const s=e[3],n=s+r;return!(C4(rr)>n*n)&&(Ki[0]=-i[6],Ki[1]=-i[7],Ki[2]=-i[8],Ki[3]=i[9],lc(rr,rr,Ki),IS(rr,rr),Bm[0]=Math.min(rr[0],i[3]),Bm[1]=Math.min(rr[1],i[4]),Bm[2]=Math.min(rr[2],i[5]),kM(Bm,rr)<s*s)}intersectPlane(e){const r=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],i=this.projectedRadius(e);return r>i?1:r<-i?-1:0}intersectRay(e,r,i=0){const s=this._data,n=Ki;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],rr[0]=e[0]-s[0],rr[1]=e[1]-s[1],rr[2]=e[2]-s[2];const o=lc(rr,rr,Ki),a=lc(Bm,r,Ki);let l=-1/0,c=1/0;const u=this.getHalfSize(sS);for(let h=0;h<3;h++){const p=o[h],f=a[h],g=u[h]+i;if(Math.abs(f)>1e-6){const _=(g-p)/f,v=(-g-p)/f;l=Math.max(l,Math.min(_,v)),c=Math.min(c,Math.max(_,v))}else if(p>g||p<-g)return!1}return l<=c}projectedArea(e,r,i,s){const n=this.getQuaternion($g);S_(Ki,n),rr[0]=e[0]-this._data[0],rr[1]=e[1]-this._data[1],rr[2]=e[2]-this._data[2],lc(rr,rr,Ki);const o=this.getHalfSize(sS),a=rr[0]<-o[0]?-1:rr[0]>o[0]?1:0,l=rr[1]<-o[1]?-1:rr[1]>o[1]?1:0,c=rr[2]<-o[2]?-1:rr[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const h=u===1?4:6,p=6*(a+3*l+9*c+13);eO($2,n),lk($2,$2,o);const f=this.getCenter(Kd);for(let v=0;v<h;v++){const b=nBe[p+v];te(rr,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),Bo(rr,rr,$2),pe(D1,f,rr),D1[3]=1,wc(D1,D1,r);const w=1/Math.max(1e-6,D1[3]);sd[2*v]=D1[0]*w,sd[2*v+1]=D1[1]*w}const g=2*h-2;let _=sd[0]*(sd[3]-sd[g+1])+sd[g]*(sd[1]-sd[g-1]);for(let v=2;v<g;v+=2)_+=sd[v]*(sd[v+3]-sd[v-1]);return Math.abs(_)*i*s*.125}projectedRadius(e){const r=this.getQuaternion($g);return S_(Ki,r),lc(rr,e,Ki),Math.abs(rr[0]*this._data[3])+Math.abs(rr[1]*this._data[4])+Math.abs(rr[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const r=this.getQuaternion($g),i=eO($2,r),s=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),n=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),o=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,r,i,s=0,n=Fh(i),o=Fh(r),a=k_(r,o)){if(i===n)r.isGeographic?cBe(this,e,r,s,o):lBe(this,e,r,s,o,a);else if(r.isWGS84&&(i.isWebMercator||GM(i)))oBe(r,this,i,e,s);else if(r.isWebMercator&&GM(i))aBe(r,this,i,e,s);else{const l=this.getCenter(Kd);l[2]+=s,Wi(l,r,0,l,i,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion($g),e.halfSize=this.getHalfSize(sS))}}};const Ki=$c(),$g=$c(),iBe=$c(),rr=E(),Bm=E(),D1=Yt();function sBe(t,e=new k_e){return jze(t,e),e}const sd=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],nBe=(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function U_e(t,e,r,i,s){const n=t.getQuaternion($g);s.quaternion=n,S_(Ki,n);const o=t.getCenter(Kd),a=t.getHalfSize(sS);if(i===Ne.Global){lc(Oi,o,Ki),IS(kd,Oi),Vfe(Nc,kd,a),Hi(Nc,kd,Nc);const l=Se(Nc);pe(Nc,kd,a);const c=Se(Nc);if(l<r)s.center=o,te(Oi,r,r,r),s.halfSize=pe(Oi,a,Oi);else{const u=c>0?1+e/c:1,h=l>0?1+r/l:1,p=(h+u)/2,f=(h-u)/2;re(Nc,kd,f),s.halfSize=kn(Nc,Nc,a,p),re(Nc,kd,p),kn(Nc,Nc,a,f),Bfe(Oi,Oi),y6(Oi,Nc,Oi);const g=t.getQuaternion(iBe);s.center=lc(Oi,Oi,g)}}else{s.center=kn(Oi,o,$S,(r+e)/2);const l=lc(Oi,$S,Ki);IS(l,l),s.halfSize=kn(kd,a,l,(r-e)/2)}return s}function oBe(t,e,r,i,s){e.getCenter(Kd),Kd[2]+=s;const n=Fh(r);Wi(Kd,t,0,Kd,n,0,1),z_e(n,e,Kd,r,i)}function aBe(t,e,r,i,s){e.getCenter(Kd),Kd[2]+=s,z_e(t,e,Kd,r,i)}function z_e(t,e,r,i,s){const n=e.getQuaternion($g),o=eO($2,n),a=e.getHalfSize(sS);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Nf[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=r[c];for(let h=0;h<3;++h)u+=Nf[h]*o[3*h+c];RD[3*l+c]=u}}Wi(RD,t,0,RD,i,0,8),sBe(uBe,s)}function lBe(t,e,r,i,s=Fh(r),n=k_(r,s)){t.getCorners(Ere),t.getCenter(Nf),Nf[2]+=i,$l(r,Nf,Dc,s),e.setCenter(Dc[12],Dc[13],Dc[14]);const o=2*Math.sqrt(1+Dc[0]+Dc[5]+Dc[10]);Ki[0]=(Dc[6]-Dc[9])/o,Ki[1]=(Dc[8]-Dc[2])/o,Ki[2]=(Dc[1]-Dc[4])/o,Ki[3]=.25*o;const a=t.getQuaternion($g);e.quaternion=uk(Ki,Ki,a),S_(Ki,Ki),te(kd,0,0,0);const l=e.getCenter(hBe);for(const c of Ere)c[2]+=i,n(c,0,c,0),Hi(Oi,c,l),lc(Oi,Oi,Ki),IS(Oi,Oi),Gfe(kd,kd,Oi);e.halfSize=kd}function cBe(t,e,r,i,s=Fh(r)){const n=Vr(r),o=1+Math.max(0,i)/(n.radius+t.centerZ);t.getCenter(Nf),Nf[2]+=i,Wi(Nf,r,0,Nf,s,0,1),e.center=Nf;const a=t.getQuaternion($g);e.quaternion=a,S_(Ki,a),te(Oi,0,0,1),lc(Oi,Oi,Ki);const l=t.getHalfSize(sS);te(Oi,l[0]*Math.abs(Oi[0]),l[1]*Math.abs(Oi[1]),l[2]*Math.abs(Oi[2])),re(Oi,Oi,n.inverseFlattening),pe(Oi,l,Oi),e.halfSize=re(Oi,Oi,o)}const RD=new Array(24),uBe=new JE(RD,3),Nf=E(),Kd=E(),hBe=E(),sS=E(),$2=xi(),Dc=xe(),Ere=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Oi=E(),kd=E(),Nc=E(),dBe=Pe(-1,-1,-1);let pBe=class{constructor(){this._transform=xe(),this._transformInverse=new N$({value:this._transform},cn,xe),this._transformInverseTranspose=new N$(this._transformInverse,Ac,xe),this._transformTranspose=new N$({value:this._transform},Ac,xe),this._transformInverseRotation=new N$({value:this._transform},A_e,xi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Bs(this._transform,e)}multiplyTransform(e){ri(this._transform,this._transform,e)}set(e){Bs(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},N$=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},fBe=class{constructor(e=0){this.offset=e,this.tmpVertex=E()}applyToVertex(e,r,i){const s=te(RX,e,r,i),n=pe(B_e,s,this.localOrigin),o=this.offset/Se(n);return kn(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const r=_Be,i=vBe,s=bBe;for(let l=0;l<3;++l)r[l]=e[0+l]+this.localOrigin[l],i[l]=e[3+l]+this.localOrigin[l],s[l]=r[l];const n=this.applyToVertex(r[0],r[1],r[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?i[c]:r[c];o(s)}let a=0;for(let l=0;l<3;++l)r[l]*i[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?r[c]:i[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},mBe=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=E(),this._tmpMbs=Vs(),this._tmpObb=new k_e,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Se(e)}applyToVertex(e,r,i){const s=te(RX,e,r,i),n=te(B_e,e,r,i+this.componentLocalOriginLength),o=this._totalOffset/Se(n);return kn(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const r=this.componentLocalOriginLength,i=e[0],s=e[1],n=e[2]+r,o=e[3],a=e[4],l=e[5]+r,c=Math.abs(i),u=Math.abs(s),h=Math.abs(n),p=Math.abs(o),f=Math.abs(a),g=Math.abs(l),_=.5*(1+Math.sign(i*o))*Math.min(c,p),v=.5*(1+Math.sign(s*a))*Math.min(u,f),b=.5*(1+Math.sign(n*l))*Math.min(h,g),w=Math.max(c,p),T=Math.max(u,f),S=Math.max(h,g),C=Math.sqrt(_*_+v*v+b*b),P=Math.sign(c+i),R=Math.sign(u+s),L=Math.sign(h+n),F=Math.sign(p+o),U=Math.sign(f+a),j=Math.sign(g+l),z=this._totalOffset;if(C<z)return e[0]-=(1-P)*z,e[1]-=(1-R)*z,e[2]-=(1-L)*z,e[3]+=F*z,e[4]+=U*z,e[5]+=j*z,e;const Z=z/Math.sqrt(w*w+T*T+S*S),W=z/C,Y=W-Z,le=-Y;return e[0]+=i*(P*le+W),e[1]+=s*(R*le+W),e[2]+=n*(L*le+W),e[3]+=o*(F*Y+Z),e[4]+=a*(U*Y+Z),e[5]+=l*(j*Y+Z),e}applyToMbs(e){const r=Se(e),i=this._totalOffset/r;return kn(this._tmpMbs,e,e,i),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/r,this._tmpMbs}applyToObb(e){return U_e(e,this._totalOffset,this._totalOffset,Ne.Global,this._tmpObb),this._tmpObb}},gBe=class{constructor(e=0){this.offset=e,this.sphere=Vs(),this.tmpVertex=E()}applyToVertex(e,r,i){const s=this.objectTransform.transform,n=te(RX,e,r,i),o=Ge(n,n,s),a=this.offset/Se(o);kn(o,o,o,a);const l=this.objectTransform.inverse;return Ge(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Se(e);kn(e,e,e,i);const s=this.offset/Se(r);kn(r,r,r,s)}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Se(e),i=this.offset/r;return kn(this.sphere,e,e,i),this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const Cre=new gBe;function $G(t){return t!=null?(Cre.offset=t,Cre):null}const Are=new mBe;function Pre(t){return t!=null?(Are.offset=t,Are):null}const Mre=new fBe;function yBe(t){return t!=null?(Mre.offset=t,Mre):null}const G_="terrain",RX=E(),B_e=E(),_Be=E(),vBe=E(),bBe=E(),iE=1e-5;let wBe=class{constructor(e){this.options=new J9e,this._results=new xBe,this.transform=new pBe,this.tolerance=iE,this.verticalOffset=null,this._ray=Un(),this._rayEnd=E(),this._rayBeginTransformed=E(),this._rayEndTransformed=E(),this.viewingMode=e??Ne.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(Iye(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&s5(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ne.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,pe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){var a;this.point=r,this.filterPredicate=s,this.tolerance=i??iE;const o=$G(this.verticalOffset);if(e&&e.length>0){const l=n?c=>{n(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(h=>l(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.effectiveTransformation,s=$G(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.transformation),Ge(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ge(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,h,p,f,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?b=>{const w=new Q9e(e,a,h,g);b.set(ki.HUD,w,c,u,ts,f)}:b=>b.set(ki.OBJECT,{object:e,geometryId:a,triangleNr:h},c,u,l,f);if((_.min.drapedLayerOrder==null||f>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==Co.MIN&&(_.max.drapedLayerOrder==null||f<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===Co.ALL)if(p){const b=new IG(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new nS(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?Ore(r.drapedLayerOrder,i.drapedLayerOrder):Ore(r.drapedLayerGraphicOrder,i.drapedLayerGraphicOrder))}};function Ore(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function zh(t){return new wBe(t)}let xBe=class{constructor(){this.min=new nS(Un()),this.max=new nS(Un()),this.hud={min:new IG(Un()),max:new IG(Un()),all:new Array},this.ground=new nS(Un()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},nS=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(re(F$,this.ray.direction,this.dist),Se(F$)):null}getIntersectionPoint(e){return!!Wh(this)&&(re(F$,this.ray.direction,this.dist),pe(e,this.ray.origin,F$),!0)}getTransformedNormal(e){return ce(VC,this.normal),VC[3]=0,wc(VC,VC,this.transformation),ce(e,VC),fe(e,e)}constructor(e){this.intersector=ki.OBJECT,this.normal=E(),this.transformation=xe(),this._ray=Un(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=ki.OBJECT,s5(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,ce(this.normal,s??$S),Bs(this.transformation,n??ts),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){s5(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ce(this.normal,e.normal),Bs(this.transformation,e.transformation)}},IG=class extends nS{constructor(){super(...arguments),this.intersector=ki.HUD}};function $X(t){return new nS(t)}const F$=E(),VC=Yt();function V_e(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,u5,i)!=null&&qme(r,u5)}function hk(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function sx(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),TBe(t,s.ray,W0)||ce(W0,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(So(s.eye,W0)<o){const a=n.collision.enabled;ce(N1,s.viewForward),re(N1,N1,o),a?s.eye=ye(u5,W0,N1):pe(W0,s.eye,N1);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(ye(N1,W0,s.eye),s.eye=l.setAltitude(u5,u,s.eye),pe(W0,s.eye,N1))}return s.center=W0,s}function Rre(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=hk(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,EBe),o=n*n;return So(e,r)>o}function TBe(t,e,r){let i=$re[t.viewingMode];i||(i=zh(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,$re[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||Rre(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||Rre(t,e.origin,r))||!!s&&SBe(e,r,Vr(t.spatialReference).radius)}function SBe(t,e,r){const i=de(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return re(e,t.direction,s/Se(t.direction)),pe(e,e,t.origin),!0}const $re={},u5=E(),W0=E(),N1=E(),EBe={near:0,far:0},CBe=E(),k$=E();function IX(){return{direction:E(),up:E()}}function G_e(t,e,r,i,s){let n=fe(CBe,t),o=de(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(de(e,i)),o<.99?(ce(n,e),a&&re(n,n,-1)):n=null);let l=0;if(n){re(k$,i,de(i,n)),ye(n,n,k$);const u=de(n,s)/(Se(n)*Se(s));Ze(k$,n,s),l=(de(k$,i)>0?1:-1)*ga(Bn(u))}const c=ga(Bn(-de(i,t)/Se(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const j_e=Pe(0,1,0),H_e=Pe(0,0,1),GC=xe(),Vm=E(),Gm=E();function q_e(t,e,r,i=IX()){const{direction:s,up:n}=i;return Q0e(GC,-Lt(e)),XS(GC,GC,Lt(r)),Ge(s,H_e,GC),re(s,s,-1),Ge(n,j_e,GC),i}function ABe(t,e,r,i){return G_e(e,r,i,H_e,j_e)}function PBe(t,e,r,i){const s=q_e(t,r,i),n=E();return re(n,s.direction,-e),pe(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function MBe(t){return ga(t)}function OBe(t){return Lt(t)}function W_e(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Qa(e,Vm,n),Qa(e,Gm,n),Vm[0]-=r/2,Gm[0]+=r/2,Vm[1]-=i/2,Gm[1]+=i/2,ya(Vm,n,Vm,o),ya(Gm,n,Gm,o),s?(s.xmin=Vm[0],s.ymin=Vm[1],s.xmax=Gm[0],s.ymax=Gm[1],s.spatialReference=o):s=new $r(Vm[0],Vm[1],Gm[0],Gm[1],o),s}const RBe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:ABe,eyeForCenterWithHeadingTilt:PBe,eyeTiltToLookAtTilt:OBe,headingTiltToDirectionUp:q_e,lookAtTiltToEyeTilt:MBe,toExtent:W_e},Symbol.toStringTag,{value:"Module"}));function Ire(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return $Be(t,e.longitude,e.latitude,r.longitude,r.latitude)}function $Be(t,e,r,i,s){const n=Lt(r),o=Lt(s),a=n-o,l=Lt(e)-Lt(i),c=Math.sin(a/2),u=Math.sin(l/2),h=2*Rh(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*h)/1e4}function IBe(t,e,r){const i=e.spatialReference,s=Vr(i),n=new Ke(e.x,t.y,i),o=new Ke(r.x,t.y,i),a=new Ke(t.x,e.y,i),l=new Ke(t.x,r.y,i);return{lon:Ire(s.radius,n,o),lat:Ire(s.radius,a,l)}}function LBe(t,e,r){const i=e/r,s=Lt(t),n=Math.sin(i/2),o=Math.cos(s),a=2*Rh(Math.sqrt(n*n/(o*o)));return ga(a)}function DBe(t,e){return t/15}function Lre(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=DBe(r);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const Y_e=Pe(0,0,1),X_e=fe(E(),Pe(1,1,1)),NBe=new I_(-180,180),jC=xe(),qy=E(),Ax=E();function Z_e(t,e,r,i=IX()){Ze(qy,t,Y_e),de(qy,qy)===0&&Ze(qy,t,X_e),Su(jC,-Lt(e),t),bc(jC,jC,-Lt(r),qy);const{up:s,direction:n}=i;return Ze(s,qy,t),fe(s,s),Ge(s,s,jC),fe(n,t),Eo(n,n),Ge(n,n,jC),i}function FBe(t,e,r,i){const s=qy,n=Ax;return fe(s,t),Ze(Ax,s,Y_e),de(Ax,Ax)===0&&Ze(Ax,s,X_e),Ze(n,Ax,s),G_e(e,r,i,s,n)}function kBe(t,e,r,i){const s={eye:E(),up:null,tilt:i,heading:r},n=qy;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Lt(r),l=Lt(i),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),p=Math.cos(l),f=Se(n);let g;if(Math.abs(l)<1e-8)g=o+f;else{const le=f/h,I=Rh(o/le),N=Math.PI-l-I;g=le*Math.sin(N)}const _=p*o,v=o*o*(h*h),b=u*u*v,w=g-_,T=w*w,S=b*(b+T-n[1]*n[1]);if(S<0)return re(s.eye,n,g/f),s.tilt=0,U$(s,t);const C=Math.sqrt(S),P=n[1]*w,R=b+T;let L;if(L=u>0?-C+P:C+P,Math.abs(R)<1e-8)return f<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):re(s.eye,n,g/f),s.tilt=0,TU(s.eye),U$(s,t);s.eye[1]=L/R;const F=c*c*v,U=h*o,j=u*U*s.eye[1],z=s.eye[1]*s.eye[1],Z=1-z,W=Math.sqrt(Z),Y=b*z+F-2*j*W*w+Z*T;return Math.abs(Y)<1e-8?(re(s.eye,n,g/f),s.tilt=0,TU(s.eye),U$(s,t)):(s.eye[0]=(Z*(g*n[0]-_*n[0])-U*W*(n[0]*s.eye[1]*u+n[2]*c))/Y,s.eye[2]=(Z*(g*n[2]-_*n[2])-U*W*(n[2]*s.eye[1]*u-n[0]*c))/Y,re(s.eye,s.eye,g),TU(s.eye),U$(s,t))}function TU(t){const e=t[1];t[1]=-t[2],t[2]=e}function U$(t,e){const r=Z_e(e,t.heading,t.tilt);return t.up=r.up,t}function UBe(t,e,r){const i=Se(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=Rh(r/(s/Math.sin(t)));return ga(t-n)}function zBe(t,e,r){const i=Lt(t),s=Se(e);return Rh(r/(s/Math.sin(i)))+i}function J_e(t,e,r,i,s){let n,o,a,l;const c=e.latitude,u=Vr(t.spatialReference).radius,h=e.longitude,p=LBe(c,r,u)/2;n=h-p,o=h+p;const f=Lt(c),g=(1+Math.sin(f))/(1-Math.sin(f)),_=(g+1)*Math.tan(i/u/2),v=_*_;function b(T){const S=Math.PI/2;return(T=oDe.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+v))),l=a+i/u,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(ga(a),-90),l=Math.min(ga(l),90),o=NBe.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Xe.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new $r(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&rm(s,!1,s),s}const BBe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:FBe,eyeForCenterWithHeadingTilt:kBe,eyeTiltToLookAtTilt:zBe,headingTiltToDirectionUp:Z_e,lookAtTiltToEyeTilt:UBe,toExtent:J_e},Symbol.toStringTag,{value:"Module"}));function h5(t){return t.type==="point"}let LX=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function K_e(t){return"array"in t}function Wf(t,e,r="ground"){if(h5(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(K_e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function LG(t,e){return t!=null&&(e==null||(e===Ne.Local?!t.isGeographic||t.isWGS84||t.wkid===gh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===gh.CGCS2000||t.wkid===gh.GCSMARS2000||t.wkid===gh.GCSMARS2000_SPHERE||t.wkid===gh.GCSMOON2000))}const Q_e=()=>ae.getLogger("esri.views.3d.support.cameraUtils"),e1e=39.37,t1e=96,DG=1,VBe=8,GBe=5,r1e=1,Dre=E(),jBe={heading:0,tilt:0},GP=E(),HBe=new I_(-20037508342788905e-9,20037508342788905e-9),qBe=new I_(-180,180);var jo;function _0(t){return t.spatialReference??Xe.WGS84}function KE(t){return t.viewingMode==="global"?BBe:RBe}function WBe(t,e,r,i,s){return KE(t).headingTiltToDirectionUp(e,r,i,s)}function Tg(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=KE(t).headingTiltToDirectionUp,s=E();if(!Qa(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);re(n.direction,n.direction,t.state.camera.distance),pe(n.direction,n.direction,s);const o=sx(t,s,n.direction,n.up);return o.fov=Lt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(jo||(jo={}));const Px=E();function sE(t,e,r){const i=t.renderSpatialReference,s=pk(t,e.eye,e.viewForward,e.up,jBe);let n=_0(t);return ya(e.eye,i,Px,n)||(n=Xe.WGS84,ya(e.eye,i,Px,n)),r==null?r=new xu(new Ke(Px,n),s.heading,s.tilt,ga(e.fov)):(r.position.x=Px[0],r.position.y=Px[1],r.position.z=Px[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=ga(e.fov)),r.layout.row=e.row,r.layout.rows=e.rows,r.layout.column=e.column,r.layout.columns=e.columns,r}function dk(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Ne.Global&&r!=null&&(e*=Math.cos(Lt(r))),e/=t.renderCoordsHelper.unitInMeters,s/(t1e*e1e/e)/Math.tan(i.fovX/2)}function Lw(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=t1e*e1e/(n/s);return t.renderCoordsHelper.viewingMode===Ne.Global&&r!=null&&(o/=Math.cos(Lt(r))),o*t.renderCoordsHelper.unitInMeters}async function i1e(t,e,r,i,s,n){return s1e(t,e,dk(t,r,e.latitude),i,s,n)}function YBe(t,e,r,i,s,n){return _1e(t,DX(t,i.heading,i.tilt,e,r,s),i.fov,n)}async function s1e(t,e,r,i,s,n){const o=await o1e(t,i.heading,i.tilt,e,r,s,n);return vt(n),v1e(t,o,i.fov,n)}function pk(t,e,r,i,s){return KE(t).directionToHeadingTilt(e,r,i,s)}function n1e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,GP,t.spatialReference)&&t.elevationProvider&&(Wf(t.elevationProvider,GP)??0)>GP[2]-r1e)}async function XBe(t,e,r){if(n1e(t,e))return!0;const{elevationProvider:i,spatialReference:s,renderCoordsHelper:n}=t;if(i==null||!n.fromRenderCoords(e,GP,s))return!1;const[o,a,l]=GP,c=await i.queryElevation(o,a,l,s,"ground",r)??0;return vt(r),c>l-r1e}async function ZBe(t,e,r){const i=E();if(e==null)return ce(i,t.state.camera.center);if(e instanceof Ke){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await Q4(e,i,s,0,{signal:r}),vt(r),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",r);vt(r),l!=null&&t.renderCoordsHelper.setAltitude(i,l)}return i}return ce(i,e)}function JBe(t,e){const r=E();if(e==null)return ce(r,t.state.camera.center);if(e instanceof Ke){if(!Qa(e,r,t.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:s}=t;if(e.z==null&&i!=null&&s!=null){const n=Wf(s,e);n!=null&&t.renderCoordsHelper.setAltitude(r,n)}return r}return ce(r,e)}function DX(t,e,r,i,s,n){return a1e(t,e,r,i instanceof Ke?i:null,JBe(t,i),s,n)}async function o1e(t,e,r,i,s,n,o){const a=i instanceof Ke?i:null,l=await ZBe(t,i,o);return vt(o),l1e(t,e,r,a,l,s,n,o)}function a1e(t,e,r,i,s,n,o){if(s==null||!i&&(i=new Ke({spatialReference:_0(t)}),!_m(s,t.renderSpatialReference,i)))return null;const a=c1e(t,e,r,s,n,o);if(u1e(t,r,o)&&n1e(t,a.eye)){const{tilt:l,mode:c}=h1e(t,r,s,n);return a1e(t,e,l,i,s,n,c)}return d1e(a,s)}async function l1e(t,e,r,i,s,n,o,a){i||(i=new Ke({spatialReference:_0(t)}),await E_e(s,t.renderSpatialReference,i,{signal:a})||(i=null)),vt(a);const l=c1e(t,e,r,s,n,o);if(u1e(t,r,o)&&await XBe(t,l.eye,a)){vt(a);const{tilt:c,mode:u}=h1e(t,r,s,n);return l1e(t,e,c,i,s,n,u,a)}return d1e(l,s)}function c1e(t,e,r,i,s,n){const o=QBe(t,e,r,i,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,KE(t).eyeForCenterWithHeadingTilt)(i,s,o.heading,o.tilt)}function u1e(t,e,r){const i=t.map.ground.navigationConstraint;return r===jo.ADJUST&&t.viewingMode==="global"&&e>0&&(i==null||i.type==="stay-above")}function h1e(t,e,r,i){const s=y1e(t,r,i,tVe(t,i,e,r));return{tilt:s,mode:e-s<1?jo.LOCKED:jo.ADJUST}}function d1e(t,e){return{...t,center:qi(e)}}function p1e(t,e){const{state:r,spatialReference:i}=t,s=e.spatialReference;return r.isGlobal&&LG(s,Ne.Global)||r.isLocal&&i.equals(s)}function f1e(t,e){let r,i,s;if(t.state.isGlobal){const u=new Ke(e.xmin,e.ymin,e.spatialReference),h=new Ke(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?qBe:HBe;r=new Ke({x:p.center(u.x,h.x),y:(h.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const f=Vr(e.spatialReference),g=IBe(r,u,h);i=g.lon,s=g.lat,p.diff(u.x,h.x)>p.range/2&&(i+=f.halfCircumference),i=Math.min(i,f.halfCircumference),s=Math.min(s,f.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=p1(e,u)),i=e.xmax-e.xmin,s=e.ymax-e.ymin;const h=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;r=new Ke({x:e.xmin+.5*i,y:e.ymin+.5*s,z:h,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*i*a,.5*s*l,.5*n*c)/DG}}async function m1e(t,e,r,i,s,n){const o=p1e(t,e)?e:await B_(e,t.spatialReference,{signal:n});vt(n);const{center:a,distance:l}=f1e(t,o),c=await o1e(t,r,i,a,l,s,n);return vt(n),v1e(t,c,t.camera.fov,n)}function $D(t,e,r,i,s,n){let o;try{o=p1e(t,e)?e:p1(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=f1e(t,o),c=DX(t,r,i,a,l,s);return c==null?null:_1e(t,c,t.camera.fov,n)}function g1e(t,e,r){const i=t.renderSpatialReference,s=new Ke({spatialReference:_0(t)});if(!_m(r,i,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=Vg(e.eye,r),l=2*a*n*DG,c=2*a*o*DG;return t.viewingMode==="global"?J_e(t,s,l,c):W_e(t,s,l,c)}function KBe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>VBe)return!0;const s=t.renderSpatialReference,n=_0(t),o=new Ke({spatialReference:n});if(!_m(e,s,o))return!1;const a=new Ke({spatialReference:n});if(!_m(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,a))return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>GBe}function QBe(t,e,r,i,s,n){let o=0;return n===jo.ADJUST&&KBe(t,i,s)?(e=0,o=eVe(t,s,r,i)):o=NX(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=y1e(t,i,s,o)}}const d5=.7;function eVe(t,e,r,i){const s=NX(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-d5)+n.max*d5;return Math.min(s,o)}function tVe(t,e,r,i){let s=NX(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-d5)+s*d5}function y1e(t,e,r,i){return KE(t).lookAtTiltToEyeTilt(i,e,r)}function NX(t,e,r,i){return KE(t).eyeTiltToLookAtTilt(i,e,r)}function _1e(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=new Ke({spatialReference:_0(t)});return _m(e.eye,s,n)?(i??(i=new xu),i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):null}async function v1e(t,e,r,i){const s=t.renderSpatialReference,n=new Ke({spatialReference:_0(t)});return await E_e(e.eye,s,n,{signal:i}),vt(i),new xu(n,e.heading,e.tilt,r)}function rVe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);Q_e().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function b1e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);Q_e().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function w1e(t,e){return ya(e.center,t.renderSpatialReference,Dre,Xe.WGS84),Lw(t,e.distance,Dre[1])}const FX=()=>ae.getLogger("esri.layers.support.ElevationSampler");let x1e=class{queryElevation(e){return T1e(e.clone(),this)}on(){return Yr()}projectIfRequired(e,r){return S1e(e,r)}},iVe=class extends x1e{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=C6(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=xa(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return A6(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return FX().warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},jOt=class extends x1e{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new iVe(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=C6(jt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){let i,s=!1;for(const n of this.samplers)if(n.containsAt(e,r)&&(s=!0,i=n.elevationAt(e,r),i!==n.noDataValue))return i;return i??(s||FX().warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue)}};function T1e(t,e){const r=S1e(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":sVe(t,r,e);break;case"polyline":nVe(t,r,e);break;case"multipoint":oVe(t,r,e)}return t}function S1e(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=KO(t,e);return i||FX().error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function sVe(t,e,r){t.z=r.elevationAt(e.x,e.y)}function nVe(t,e,r){Ff.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Ff.x=c[0],Ff.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Ff.x,Ff.y)}}t.hasZ=!0}function oVe(t,e,r){Ff.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];Ff.x=o[0],Ff.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(Ff.x,Ff.y)}t.hasZ=!0}const Ff=new Ke;var NG;let df=NG=class extends We{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new NG({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],df.prototype,"cols",void 0),d([m({type:an,json:{write:!0}})],df.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],df.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],df.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],df.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],df.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],df.prototype,"scale",void 0),df=NG=d([V("esri.layers.support.LOD")],df);const hh=df;let E1e=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var xy;const Nre=new Yo({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let ea=xy=class extends We{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=Xe.WebMercator,numLODs:n=24}=t;if(!qf(s)){const h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p];h.push(new hh({level:p,scale:f,resolution:f}))}else{let p=5e-4;for(let f=n-1;f>=0;f--)h.unshift(new hh({level:f,scale:p,resolution:p})),p*=2}return new xy({dpi:96,lods:h,origin:new Ke(0,0,s),size:[i,i],spatialReference:s})}const o=pp(s),a=t.origin?new Ke({x:t.origin.x,y:t.origin.y,spatialReference:s}):new Ke(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(xa(s)*39.37*l),u=[];if(r)for(let h=0;h<r.length;h++){const p=r[h],f=p*c;u.push(new hh({level:h,scale:p,resolution:f}))}else{let h=TY(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(n/e);u.push(new hh({level:0,scale:h,resolution:h*c}));for(let f=1;f<p;f++){const g=h/2**e,_=g*c;u.push(new hh({level:f,scale:g,resolution:_})),h=g}}return new xy({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=pp(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return Ke.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(co(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=KO(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new E1e(null,0,0,0,jt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=xy.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===xy.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=jt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return xy.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new hh({level:n.level,scale:n.scale,resolution:o}))}return new xy({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};d([m({type:Number,json:{write:!0}})],ea.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],ea.prototype,"dpi",void 0),d([m({type:String,json:{read:Nre.read,write:Nre.write,origins:{"web-scene":{read:!1,write:!1}}}})],ea.prototype,"format",void 0),d([m({readOnly:!0})],ea.prototype,"isWrappable",null),d([m({type:Ke,json:{write:!0}})],ea.prototype,"origin",void 0),d([Tr("origin")],ea.prototype,"readOrigin",null),d([m({type:[hh],value:null,json:{write:!0}})],ea.prototype,"lods",null),d([m({readOnly:!0})],ea.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],ea.prototype,"size",void 0),d([Tr("size",["rows","cols"])],ea.prototype,"readSize",null),d([lr("size",{cols:{type:an},rows:{type:an}})],ea.prototype,"writeSize",null),d([m({type:Xe,json:{write:!0}})],ea.prototype,"spatialReference",void 0),ea=xy=d([V("esri.layers.support.TileInfo")],ea),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(ea||(ea={}));const sm=ea,aVe=12;let mc=class pl{constructor(e){const r=pl.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=V_(this.spatialReference)||u1(this.spatialReference)||h1(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,u,h)=>(u.level<c.min&&(c.min=u.level,c.minIndex=h),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new pl(this.toTileInfo())}toTileInfo(){return new sm({dpi:this.dpi,origin:new Ke({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new hh({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Vee(e[0]),r[1]=z4(e[1]),r[2]=Vee(e[2]),r[3]=z4(e[3])):this._isGCS&&(r[0]=Lt(e[0]),r[1]=Lt(e[1]),r[2]=Lt(e[2]),r[3]=Lt(e[3]))}getExtentGeometry(e,r,i,s=new $r){return this.getExtent(e,r,i,Vp),s.spatialReference=this.spatialReference,s.xmin=Vp[0],s.ymin=Vp[1],s.xmax=Vp[2],s.ymax=Vp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof pl)){if(pl.checkUnsupported(e))return!1;e=new pl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!w_(e.origin[0],this.origin[0],s)||!w_(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*aVe,w_(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;pl.computeRowColExtent(e,n,this.origin,Vp);let o=Vp[1],a=Vp[3],l=Vp[0],c=Vp[2];const u=c-l,h=a-o;if(u*h>i){const p=Math.floor(Math.sqrt(i));h>p&&(o=o+Math.floor(.5*h)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let f=l;f<c;f++)s.push([0,p,f]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!sDe(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new J("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?kX():e.lods.length<1?new J("tilingscheme:generic","Tiling scheme must have at least one level"):pl.isPowerOfTwo(e)?pl.hasGapInLevels(e)?new J("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):pl.tileSizeSupported(e)?pl.hasOriginPerLODs(e)?new J("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new J("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new J("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=xa(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,u=new pl(new sm({size:[a,a],origin:new Ke({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new hh({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new pl(pl.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new pl(new sm({size:[r,r],origin:new Ke({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new hh({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function kX(){return new J("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}mc.WebMercatorAuxiliarySphereTileInfo=new sm({size:[256,256],origin:new Ke({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Xe.WebMercator}),spatialReference:Xe.WebMercator,lods:[new hh({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),mc.WebMercatorAuxiliarySphere=mc.makeWebMercatorAuxiliarySphere(19);const Vp=jt(),xT=64,z3=512,lVe=2.5,rO=nDe(IV/10),C1e=2,A1e=jt();mc.WebMercatorAuxiliarySphere.getExtent(0,0,0,A1e);const cVe=jt([-180,-90,180,90]),uVe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",hVe="Surface extent is too large for tile resolution at level 0.",dVe=3;let pVe=dVe;function FG(t){return t<4?3:pVe}const _n=4;let Ty=class extends Gs.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=rO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const r=C6(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Xe.WGS84}elevationAt(e,r){var i;if(this.extent==null||!ka(this.extent,e,r)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ae.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return T1e(e.clone(),this)}};d([m({readOnly:!0})],Ty.prototype,"demResolution",void 0),d([m({readOnly:!0})],Ty.prototype,"extent",null),d([m({readOnly:!0})],Ty.prototype,"noDataValue",void 0),d([m()],Ty.prototype,"spatialReference",null),d([m({constructOnly:!0})],Ty.prototype,"view",void 0),Ty=d([V("esri.views.support.GroundViewElevationSampler")],Ty);const fVe=Ty;let sg=class extends Me{constructor(e){super(e),this.view=null,this.layerViews=new Mt}initialize(){this.addHandles(Ih(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new fVe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?g1e(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>he(()=>e.updating,()=>this._updateUpdating(),ti)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([m({readOnly:!0})],sg.prototype,"elevationSampler",null),d([m({readOnly:!0})],sg.prototype,"extent",null),d([m({type:Boolean,readOnly:!0})],sg.prototype,"updating",null),d([m({constructOnly:!0})],sg.prototype,"view",void 0),d([m({type:Mt,readOnly:!0})],sg.prototype,"layerViews",void 0),d([m({readOnly:!0})],sg.prototype,"suspended",null),sg=d([V("esri.views.GroundView")],sg);const mVe=sg;let l0=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new sfe(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=yfe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)_ee(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)_ee(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const gVe=se("mac")?"Meta":"Ctrl",yVe=new Set(["Alt","Ctrl","Meta","Shift","Primary"]),_Ve=t=>yVe.has(t);let vVe=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const Fre=()=>ae.getLogger("esri.views.input.InputHandler");let Mo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Fre().error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new vVe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const h=this._incoming[u.match.eventType];if(h){const p=h.indexOf(u);h.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new bVe(n,i,{onPause:a,onRemove:a,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new wVe(e,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Fre().error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const s of r)if(s.match.matches(e)&&((i=s.callback)==null||i.call(s,e),e.shouldStopPropagation()))break}}},bVe=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},wVe=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},xVe=class extends Mo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},TVe=class{constructor(e,r){this._observable=new tR,this._value=e,this._equalityFunction=r}get value(){return Ot(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function nm(t,e=Bpe){return new TVe(t,e)}let SVe=class extends Mo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=nm(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Vu=class extends Me{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=gVe,this._latestPointerType="mouse",this._propertiesPool=new l0({latestPointerLocation:AVe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=E_.INTERNAL){if(this._nameToGroup[e])return void ae.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void ae.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,h)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,h,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var s;i.removed=!0,(s=i.uninstallCallback)==null||s.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ae.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)_Ve(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new xVe((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new SVe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],E_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,E_.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new EVe(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new H4,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:o}=e.events.pop(),a=(r=n.data)==null?void 0:r.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((s=(i=e.currentHandler).eventCallback)==null||s.call(i,n)),n.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new H4;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};d([m({readOnly:!0})],Vu.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],Vu.prototype,"eventSource",void 0),d([m({constructOnly:!0})],Vu.prototype,"recognizers",void 0),d([m()],Vu.prototype,"_latestPointerType",void 0),d([m()],Vu.prototype,"latestPointerType",null),d([m()],Vu.prototype,"multiTouchActive",null),d([m({readOnly:!0})],Vu.prototype,"latestPointerLocation",void 0),d([m()],Vu.prototype,"_paused",void 0),d([m({readOnly:!0})],Vu.prototype,"updating",null),Vu=d([V("esri.views.input.InputManager")],Vu);let EVe=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=Wy.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Wy.STOPPED}shouldStopPropagation(){return(this._propagationState&Wy.STOPPED)!=0}async(e){this._propagationState|=Wy.PAUSED;const r=(i,s)=>{this._propagationState&=~Wy.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&Wy.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Wy;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(Wy||(Wy={}));const E_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let CVe=class{};const AVe=CVe;function Gp(t){return t!=null&&"open"in t&&"declaredClass"in t}function kre(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const PVe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([he(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&Gp(l)&&(l.view=null,kre(l)&&a.remove(l,n))}r&&Gp(i)&&(i.view=this,kre(i)&&r.add(i,{key:n,position:o,internal:!0}))},ui),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Gp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Gp(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Gp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},E_.WIDGET)]),GS(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{me(()=>import("./Popup-D3CONZOT.js"),__vite__mapDeps([69,1,70,71,72,5,52,73,74,41,57,23,21,4,75,32,30,31,33,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(Gp(this.popup))return this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void ae.getLogger(this).error(new J("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),Gp(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(r,i),i)}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!Gp(this.popup))return this._popupSetupTask=Am(async i=>{const{default:s}=await me(()=>import("./Popup-D3CONZOT.js"),__vite__mapDeps([69,1,70,71,72,5,52,73,74,41,57,23,21,4,75,32,30,31,33,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106]));if(vt(i),!this.popup||Gp(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:i},s){const n=[],o=[];let a=!1;const l=IIe(s,se("popup-view-fetch-timeout")??OVe),c=p=>{const f=new MVe(p);return o.push(f),n.push(f.promise),f},u=p=>{const f=o.at(-1);return f&&f.layerView===p&&!a?f:c(p)};for(const p of i)"graphic"in p?(u(p.layerView).graphics.push(p.graphic),a=!1):(n.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,l)),a=!0);o.map(p=>p.resolve(l));const h=gV(n).then(p=>p.filter(f=>!!f).flat());return{pendingFeatures:n,allGraphicsPromise:h,location:r}}async _getPopupHits(r,i){const{hits:s,location:n}=await this.popupHitTest(r);vt(i);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,i)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};return d([m({cast(r){return!r||Gp(r)||typeof r=="object"&&(r.open=i=>($_(ae.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>($_(ae.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),d([m()],e.prototype,"popupEnabled",void 0),e=d([V("esri.views.PopupView")],e),e};let MVe=class{constructor(e){this.layerView=e,this._resolver=Wo(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:r,graphics:i,_resolver:s}=this;if(!r)return s.resolve(i),s.promise;let n;return r.fetchPopupFeaturesFromGraphics(i,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const OVe=5e3;var Yy;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Yy||(Yy={}));let RVe=class{constructor(){this._resolver=Wo(),this._status=Yy.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Yy.RESOLVED,this._cleanUp()},()=>{this._status=Yy.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Yy.RESOLVED}isRejected(){return this._status===Yy.REJECTED}isFulfilled(){return this._status!==Yy.PENDING}abort(){this._resolver.reject(hr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Wo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||ns(s)||this._resolver.reject(s)}),e.resolve()}};const UX=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new RVe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=d([V("esri.core.Promise")],e),e};let p5=class extends UX(Me){};p5=d([V("esri.core.Promise")],p5);const $Ve="not-loaded",IVe="loading",LVe="failed",Ure="loaded",P1e=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=d6(n,l);this.destroyed&&l(new J("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===$Ve){this._set("loadStatus",IVe);const a=this._loadController=new AbortController;s({signal:a.signal})}return i(),o}})),this.when(()=>{this._set("loadStatus",Ure),this._loadController=null},i=>{this._set("loadStatus",LVe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Ja(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Ure}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new J("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort(),this._promiseProps.abort()),this}};return d([m({readOnly:!0})],e.prototype,"loaded",null),d([m({readOnly:!0})],e.prototype,"loadError",void 0),d([m({clonable:!1})],e.prototype,"loadStatus",void 0),d([m({type:[vw],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([V("esri.core.Loadable")],e),e};let B3=class extends P1e(p5){};B3=d([V("esri.core.Loadable")],B3),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=P1e,t.isLoadable=e}(B3||(B3={}));const j_=B3;async function M1e(t,e){return await t.load(),DVe(t,e)}async function DVe(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Mt.isCollection(o)?o.forEach(a=>i(a)):j_.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await k4e(r,async n=>{const o=await xp(NVe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function NVe(t){return"loadAll"in t&&typeof t.loadAll=="function"}let z$;function FVe(t){return z$&&!z$.destroyed||(z$=t()),z$}var kG;const kVe=new Yo({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Gu=kG=class extends Me{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new kG({categories:this.categories?ge(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=KO(this.extent,Xe.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>kVe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};d([m()],Gu.prototype,"categories",void 0),d([m()],Gu.prototype,"disableExtraQuery",void 0),d([m({type:$r})],Gu.prototype,"extent",void 0),d([m()],Gu.prototype,"filter",void 0),d([m()],Gu.prototype,"num",void 0),d([m()],Gu.prototype,"query",void 0),d([m()],Gu.prototype,"sortField",void 0),d([m()],Gu.prototype,"sortOrder",null),d([m()],Gu.prototype,"start",void 0),Gu=kG=d([V("esri.portal.PortalQueryParams")],Gu);const kf=Gu;var UG;let Yn=UG=class extends We{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const r=e.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):r})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new J("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new UG;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let r=ma(kf,t);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new kf,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",e)):(r=r?r.clone():new kf,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,e))}_fetchCategorySchemaSet(t,e){const r=this.portal;return r.fetchSelf(r.authMode,!0,e).then(i=>{const s=i.contentCategorySetsGroupQuery;if(s){const n=new kf;return n.disableExtraQuery=!0,n.num=1,n.query=s,r.queryGroups(n,e)}throw new J("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const s=i.results[0],n=new kf;return n.num=1,n.query=`typekeywords:"${t}"`,s.queryItems(n,e)}throw new J("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",e).then(s=>{const n=s==null?void 0:s.categorySchema;return n!=null&&n.length?n:[]}):[])}};d([m()],Yn.prototype,"access",void 0),d([m({type:Date})],Yn.prototype,"created",void 0),d([m()],Yn.prototype,"description",void 0),d([m()],Yn.prototype,"id",void 0),d([m()],Yn.prototype,"isInvitationOnly",void 0),d([m({type:Date})],Yn.prototype,"modified",void 0),d([m()],Yn.prototype,"owner",void 0),d([m()],Yn.prototype,"portal",void 0),d([m()],Yn.prototype,"snippet",void 0),d([m()],Yn.prototype,"sortField",void 0),d([m()],Yn.prototype,"sortOrder",void 0),d([m()],Yn.prototype,"sourceJSON",void 0),d([m()],Yn.prototype,"tags",void 0),d([m()],Yn.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Yn.prototype,"thumbnailUrl",null),d([m()],Yn.prototype,"title",void 0),d([m({readOnly:!0})],Yn.prototype,"url",null),Yn=UG=d([V("esri.portal.PortalGroup")],Yn);const zG=Yn;let xv=class extends Me{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],xv.prototype,"nextQueryParams",void 0),d([m()],xv.prototype,"queryParams",void 0),d([m()],xv.prototype,"results",void 0),d([m()],xv.prototype,"total",void 0),xv=d([V("esri.portal.PortalQueryResult")],xv);const UVe=xv;let ng=class extends We{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var r;const e=(r=this.portal)==null?void 0:r.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new J("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],ng.prototype,"created",void 0),d([m()],ng.prototype,"id",void 0),d([m()],ng.prototype,"portal",void 0),d([m()],ng.prototype,"title",void 0),d([m({readOnly:!0})],ng.prototype,"url",null),d([m()],ng.prototype,"username",void 0),ng=d([V("esri.portal.PortalFolder")],ng);const zVe=ng;var BG;let Ts=BG=class extends We{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t==null?void 0:t.data,i=t==null?void 0:t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=zVe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=zG.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),me(()=>Promise.resolve().then(()=>R1e),void 0).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s!=null&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new zG({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new J("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new J("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new BG;return e.sourceJSON=t,e.read(t),e}};d([m()],Ts.prototype,"access",void 0),d([m({type:Date})],Ts.prototype,"created",void 0),d([m()],Ts.prototype,"culture",void 0),d([m()],Ts.prototype,"description",void 0),d([m()],Ts.prototype,"email",void 0),d([m()],Ts.prototype,"favGroupId",void 0),d([m()],Ts.prototype,"fullName",void 0),d([m({type:Date})],Ts.prototype,"modified",void 0),d([m()],Ts.prototype,"orgId",void 0),d([m()],Ts.prototype,"portal",void 0),d([m()],Ts.prototype,"preferredView",void 0),d([m()],Ts.prototype,"privileges",void 0),d([m()],Ts.prototype,"region",void 0),d([m()],Ts.prototype,"role",void 0),d([m()],Ts.prototype,"roleId",void 0),d([m()],Ts.prototype,"sourceJSON",void 0),d([m()],Ts.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Ts.prototype,"thumbnailUrl",null),d([m()],Ts.prototype,"units",void 0),d([m({readOnly:!0})],Ts.prototype,"userContentUrl",null),d([m({readOnly:!0})],Ts.prototype,"url",null),d([m()],Ts.prototype,"username",void 0),d([m()],Ts.prototype,"userType",void 0),Ts=BG=d([V("esri.portal.PortalUser")],Ts);const zX=Ts;var Gc;let B$;const zre={PortalGroup:()=>Promise.resolve({default:zG}),PortalItem:()=>me(()=>Promise.resolve().then(()=>R1e),void 0),PortalUser:()=>Promise.resolve({default:zX})};let ke=Gc=class extends JO(j_){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ii.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Bre.unregister(this),this.defaultBasemap=Ae(this.defaultBasemap),this.defaultDevBasemap=Ae(this.defaultDevBasemap),this.defaultVectorBasemap=Ae(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=wi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)ii.request.trustedServers.includes(e)||ii.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var r;const t=(r=this.user)==null?void 0:r.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=zX.fromJSON(t),e.portal=this),e}load(t){const e=me(()=>Promise.resolve().then(()=>aGe),void 0).then(({default:r})=>{vt(t),B$=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(Jr){const s=Jr;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Gc.AUTH_MODE_AUTO&&this.authMode!==Gc.AUTH_MODE_NO_PROMPT||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",BVe(new WeakRef(this))),Bre.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await me(async()=>{const{default:r}=await import("./ElevationLayer-Vdp_rPnP.js");return{default:r}},[])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Zs(t)?Promise.reject(hr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new kf;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return Zs(t)?Promise.reject(hr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||gu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||gu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return FVe(()=>new Gc)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:gu().toLowerCase()},withCredentials:!0,...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=ma(kf,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new UVe({nextQueryParams:l,queryParams:s,total:a.total,results:Gc._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Uo(l),a)));return r&&zre[r]?zre[r]().then(({default:o})=>(vt(i),n(o))):n()}signIn(){if(this.authMode===Gc.AUTH_MODE_ANONYMOUS||this.authMode===Gc.AUTH_MODE_NO_PROMPT&&!Jr)return Promise.reject(new J("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Jr?Jr.getCredential(this.restUrl,{prompt:this.authMode!==Gc.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var r;const e=(r=this.credential)==null?void 0:r.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=Gc._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===Gc.AUTH_MODE_ANONYMOUS||this.authMode===Gc.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Wr(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new J("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Gc({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new J("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new kf;r.query=t||(ii.apiKey&&pme(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new B$({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new kf({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new B$({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=B$.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};ke.AUTH_MODE_ANONYMOUS="anonymous",ke.AUTH_MODE_AUTO="auto",ke.AUTH_MODE_IMMEDIATE="immediate",ke.AUTH_MODE_NO_PROMPT="no-prompt",d([m()],ke.prototype,"access",void 0),d([m()],ke.prototype,"allSSL",void 0),d([m()],ke.prototype,"authMode",void 0),d([m()],ke.prototype,"authorizedCrossOriginDomains",void 0),d([Tr("authorizedCrossOriginDomains")],ke.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],ke.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],ke.prototype,"basemapGalleryGroupQuery3D",void 0),d([m()],ke.prototype,"bingKey",void 0),d([m()],ke.prototype,"canListApps",void 0),d([m()],ke.prototype,"canListData",void 0),d([m()],ke.prototype,"canListPreProvisionedItems",void 0),d([m()],ke.prototype,"canProvisionDirectPurchase",void 0),d([m()],ke.prototype,"canSearchPublic",void 0),d([m()],ke.prototype,"canShareBingPublic",void 0),d([m()],ke.prototype,"canSharePublic",void 0),d([m()],ke.prototype,"canSignInArcGIS",void 0),d([m()],ke.prototype,"canSignInIDP",void 0),d([m()],ke.prototype,"colorSetsGroupQuery",void 0),d([m()],ke.prototype,"commentsEnabled",void 0),d([m({type:Date})],ke.prototype,"created",void 0),d([m()],ke.prototype,"credential",void 0),d([m()],ke.prototype,"culture",void 0),d([m()],ke.prototype,"currentVersion",void 0),d([m()],ke.prototype,"customBaseUrl",void 0),d([m()],ke.prototype,"defaultBasemap",void 0),d([Tr("defaultBasemap")],ke.prototype,"readDefaultBasemap",null),d([m()],ke.prototype,"defaultDevBasemap",void 0),d([Tr("defaultDevBasemap")],ke.prototype,"readDefaultDevBasemap",null),d([m({type:$r})],ke.prototype,"defaultExtent",void 0),d([m()],ke.prototype,"defaultVectorBasemap",void 0),d([Tr("defaultVectorBasemap")],ke.prototype,"readDefaultVectorBasemap",null),d([m()],ke.prototype,"description",void 0),d([m()],ke.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],ke.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],ke.prototype,"extraQuery",null),d([m()],ke.prototype,"featuredGroups",void 0),d([m()],ke.prototype,"featuredItemsGroupQuery",void 0),d([m()],ke.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],ke.prototype,"layoutGroupQuery",void 0),d([m()],ke.prototype,"livingAtlasGroupQuery",void 0),d([m()],ke.prototype,"hasCategorySchema",void 0),d([m()],ke.prototype,"helpBase",void 0),d([m()],ke.prototype,"helperServices",void 0),d([m()],ke.prototype,"helpMap",void 0),d([m()],ke.prototype,"homePageFeaturedContent",void 0),d([m()],ke.prototype,"homePageFeaturedContentCount",void 0),d([m()],ke.prototype,"httpPort",void 0),d([m()],ke.prototype,"httpsPort",void 0),d([m()],ke.prototype,"id",void 0),d([m()],ke.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],ke.prototype,"isOrganization",null),d([m()],ke.prototype,"isPortal",void 0),d([m()],ke.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],ke.prototype,"itemPageUrl",null),d([m()],ke.prototype,"layerTemplatesGroupQuery",void 0),d([m()],ke.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],ke.prototype,"modified",void 0),d([m()],ke.prototype,"name",void 0),d([m()],ke.prototype,"portalHostname",void 0),d([m()],ke.prototype,"portalMode",void 0),d([m()],ke.prototype,"portalProperties",void 0),d([m()],ke.prototype,"region",void 0),d([m({readOnly:!0})],ke.prototype,"restUrl",null),d([m()],ke.prototype,"rotatorPanels",void 0),d([m()],ke.prototype,"showHomePageDescription",void 0),d([m()],ke.prototype,"sourceJSON",void 0),d([m()],ke.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],ke.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],ke.prototype,"stylesGroupQuery3d",void 0),d([m()],ke.prototype,"supportsHostedServices",void 0),d([m()],ke.prototype,"symbolSetsGroupQuery",void 0),d([m()],ke.prototype,"templatesGroupQuery",void 0),d([m()],ke.prototype,"thumbnail",void 0),d([m({readOnly:!0})],ke.prototype,"thumbnailUrl",null),d([m()],ke.prototype,"units",void 0),d([m()],ke.prototype,"url",void 0),d([m()],ke.prototype,"urlKey",void 0),d([Tr("urlKey")],ke.prototype,"readUrlKey",null),d([m()],ke.prototype,"user",void 0),d([Tr("user")],ke.prototype,"readUser",null),d([m()],ke.prototype,"use3dBasemaps",void 0),d([m()],ke.prototype,"useStandardizedQuery",void 0),d([m()],ke.prototype,"useVectorBasemaps",void 0),d([m()],ke.prototype,"vectorBasemapGalleryGroupQuery",void 0),ke=Gc=d([V("esri.portal.Portal")],ke);const kl=ke,Bre=new FinalizationRegistry(t=>{t.remove()});function BVe(t){const e=Jr;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}let og=class extends Me{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&Rl(e)?ae.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new J("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResources:i}=await me(()=>import("./resourceUtils-CWT7Xw4H.js"),[]);return await i(this.portalItem,[{resource:this,content:e,compress:r==null?void 0:r.compress,access:r==null?void 0:r.access}],"update",r),this}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&Rl(e)&&(e=_Y(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};d([m()],og.prototype,"portalItem",void 0),d([m({type:String,value:null})],og.prototype,"path",null),d([zi("path")],og.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],og.prototype,"url",null),d([m({type:String,readOnly:!0})],og.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],og.prototype,"itemRelativeUrl",null),og=d([V("esri.portal.PortalItemResource")],og);const VVe=og;let V3=class extends Me{constructor(e){super(e),this.created=null,this.rating=null}};d([m()],V3.prototype,"created",void 0),d([m()],V3.prototype,"rating",void 0),V3=d([V("esri.portal.PortalRating")],V3);const SU=V3;function Dw(t,e){var i;const r=(i=e==null?void 0:e.url)==null?void 0:i.path;if(t&&r&&(t=au(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const s=_Y(t,e.portalItem.itemUrl);s!=null&&GVe.test(s)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(s).path)}return(t=VG(t,e==null?void 0:e.portal))&&fk.test(t)?GX(t):t}function nE(t,e,r=iO.YES){var s,n;if((t=t&&fk.test(t)?O1e(t):t)==null)return t;!Rl(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let i=au(t);if(e){const o=((s=e.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((n=e.url)==null?void 0:n.path);if(o){const a=VG(o,e.portal),l=VG(i,e.portal);i=_Y(l,a,a),i!=null&&i!==l&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=VX(i,e==null?void 0:e.portal),Rl(i)&&(i=mu(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Rl(i)&&!Cm(i)&&r===iO.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function BX(t,e,r){return Dw(t,r)}function H_(t,e,r,i){const s=nE(t,i);s!==void 0&&(e[r]=s)}const fk=/\/items\/([^\/]+)\/resources\/(.*)/,GVe=/^\.\/resources\//;function jVe(t){const e=(t==null?void 0:t.match(fk))??null;return(e==null?void 0:e[1])??null}function HVe(t){const e=(t==null?void 0:t.match(fk))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=$ee(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=$ee(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function VX(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?FV(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function VG(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=fY();return LS(i,`${i.scheme}://${r}`)?FV(t,e.portalHostname,r):FV(t,r,e.portalHostname)}function GX(t){if(!t)return t||null;let e=t;return e&&Jr&&!Jr.findCredential(e)&&(e=Jr._normalizeAGOLorgDomain(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function O1e(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Jr&&!Jr.findCredential(e)&&(e=Jr._normalizeAGOLorgDomain(e)),e}var iO;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(iO||(iO={}));const fRt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return iO},ensureMainOnlineDomain:VX,fromCDNUrl:O1e,fromJSON:Dw,itemIdFromResourceUrl:jVe,prefixAndFilenameFromResourceUrl:HVe,read:BX,toCDNUrl:GX,toJSON:nE,write:H_},Symbol.toStringTag,{value:"Module"}));var Tv;const qVe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),WVe=new Set(["KML","GeoJson","CSV"]);let or=Tv=class extends JO(j_){static from(t){return _w(Tv,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Geocoding Service"?r="Locator":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="Raster function template"?r="Raster Function Template":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"?r="Excalibur Project":t==="3DTiles Service"?r="3D tiles layer":t==="3DTiles Package"&&(r="3D tiles package"),r}readExtent(t){return t&&t.length?new $r(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var f;const t=((f=this.type)==null?void 0:f.toLowerCase())||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1,p=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),h=e.includes("Relational"),s=c||h?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s="style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(p=e.includes("Map"),s=p?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?ai(r+s+i+".png"):null}get isLayer(){return this.type!=null&&qVe.has(this.type)}get itemCdnUrl(){return GX(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var r,i,s;const t=(r=this.portal)==null?void 0:r.restUrl;if(!t)return null;const e=this.owner||((s=(i=this.portal)==null?void 0:i.user)==null?void 0:s.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=kl.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof SU&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new SU({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ge(this.applicationProxies),avgRating:this.avgRating,categories:ge(this.categories),created:ge(this.created),culture:this.culture,description:this.description,extent:ge(this.extent),groupCategories:ge(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ge(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ge(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ge(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ge(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Tv({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new SU(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Tv)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new J("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new J("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await e.signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new Tv({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")Cm(e)?i.query={data:e}:i.query={url:au(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new J("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await me(()=>import("./resourceUtils-CWT7Xw4H.js"),[]);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResources:i}=await me(()=>import("./resourceUtils-CWT7Xw4H.js"),[]);return t.portalItem=this,await i(this,[{resource:t,content:e,compress:r==null?void 0:r.compress,access:r==null?void 0:r.access}],"add",r),t}async removeResource(t,e){const{removeResource:r}=await me(()=>import("./resourceUtils-CWT7Xw4H.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new J("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await me(()=>import("./resourceUtils-CWT7Xw4H.js"),[]);return e(this,t)}resourceFromPath(t){return new VVe({portalItem:this,path:t})}toJSON(){var r,i;const t=this.extent,e={accessInformation:this.accessInformation,categories:ge(this.categories),created:(r=this.created)==null?void 0:r.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(i=this.modified)==null?void 0:i.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ge(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ge(this.typeKeywords),url:this.url};return X$e(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Tv({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],or.prototype,"access",void 0),d([m()],or.prototype,"accessInformation",void 0),d([m({type:String})],or.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],or.prototype,"applicationProxies",void 0),d([m()],or.prototype,"avgRating",void 0),d([m()],or.prototype,"categories",void 0),d([m({type:Date})],or.prototype,"created",void 0),d([m()],or.prototype,"culture",void 0),d([m()],or.prototype,"description",void 0),d([m({readOnly:!0})],or.prototype,"displayName",null),d([m({type:$r})],or.prototype,"extent",void 0),d([Tr("extent")],or.prototype,"readExtent",null),d([m()],or.prototype,"groupCategories",void 0),d([m({readOnly:!0})],or.prototype,"iconUrl",null),d([m()],or.prototype,"id",void 0),d([m({readOnly:!0})],or.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],or.prototype,"isOrgItem",void 0),d([m()],or.prototype,"itemControl",void 0),d([m({readOnly:!0})],or.prototype,"itemPageUrl",null),d([m({readOnly:!0})],or.prototype,"itemUrl",null),d([m()],or.prototype,"licenseInfo",void 0),d([m({type:Date})],or.prototype,"modified",void 0),d([m()],or.prototype,"name",void 0),d([m()],or.prototype,"numComments",void 0),d([m()],or.prototype,"numRatings",void 0),d([m()],or.prototype,"numViews",void 0),d([m()],or.prototype,"owner",void 0),d([m()],or.prototype,"ownerFolder",void 0),d([m({type:kl})],or.prototype,"portal",void 0),d([m()],or.prototype,"screenshots",void 0),d([m()],or.prototype,"size",void 0),d([m()],or.prototype,"snippet",void 0),d([m()],or.prototype,"sourceJSON",void 0),d([m({type:String})],or.prototype,"sourceUrl",void 0),d([m({type:String})],or.prototype,"spatialReference",void 0),d([m()],or.prototype,"tags",void 0),d([m()],or.prototype,"thumbnail",void 0),d([m({readOnly:!0})],or.prototype,"thumbnailUrl",null),d([m()],or.prototype,"title",void 0),d([m()],or.prototype,"type",void 0),d([m()],or.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){var r;if(WVe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],or.prototype,"url",void 0),d([m({readOnly:!0})],or.prototype,"userItemUrl",null),or=Tv=d([V("esri.portal.PortalItem")],or);const jP=or,R1e=Object.freeze(Object.defineProperty({__proto__:null,default:jP},Symbol.toStringTag,{value:"Module"}));async function YVe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,r=await YY("esri/t9n/basemaps");return r[t]||r[e]}const GG={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ai("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return ai("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return ai("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return ai("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return ai("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return ai("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return ai("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ai("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ai("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ai("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ai("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ai("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ai("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ai("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ai("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ai("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},XVe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let Sy=class extends Me{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=gu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const r=n5e(e);return r==="pt"?"pt-BR":r&&XVe.has(r)?r:"global"}};d([m()],Sy.prototype,"id",void 0),d([m()],Sy.prototype,"language",void 0),d([m()],Sy.prototype,"places",void 0),d([m()],Sy.prototype,"serviceUrl",void 0),d([m()],Sy.prototype,"worldview",void 0),Sy=d([V("esri.support.BasemapStyle")],Sy);const ZVe=Sy,JVe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),KVe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function QVe(t){return t.layerContainerType==="basemap"?JVe:t.layerContainerType==="operational-layers"?KVe:null}function eGe(t,e){if(e.restrictedWebMapWriting){const r=QVe(e);return r==null||r.has(t.type)&&!rk(t)}return!0}function tGe(t,e){var r;if(e)if(rk(t)){const i=a6("featureCollection.layers",e),s=(r=i==null?void 0:i[0])==null?void 0:r.layerDefinition;s&&Vre(t,s)}else t.type!=="group"&&Vre(t,e)}function Vre(t,e){"maxScale"in t&&(e.maxScale=S4(t.maxScale)??void 0),"minScale"in t&&(e.minScale=S4(t.minScale)??void 0)}function rGe(t,e){if(tGe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=S4(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(rk(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Gre(t,e,r){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return r!=null&&r.messages&&r.messages.push(new J("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(rk(t)&&!t.isTable)e=t.resourceInfo;else if(eGe(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&rGe(t,e=ge(e)),e}var G3;let iGe=0;const sGe="esri.Basemap";let jc=G3=class extends JO(j_){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+iGe++,this.baseLayers=new Mt,this.referenceLayers=new Mt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&ae.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ae.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const r of t)r.destroy();const e=this.referenceLayers.toArray();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Ae(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Ow(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Gre(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=Gre(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Ow(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return M1e(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>h4(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>h4(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new G3({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var r;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((r=this.resourceInfo)!=null&&r.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const s=ge(i);return s.url&&$h(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&$h(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r,style:i}=this;vt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(YVe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else r?s.push(this._loadFromItem(r,t)):i&&s.push(this._loadFromStylesService(i,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,r){var l,c;const i=(l=this.resourceInfo)==null?void 0:l.context,s=((c=this.portalItem)==null?void 0:c.portal)||(i==null?void 0:i.portal)||null,n=oGe[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await me(async()=>{const{populateOperationalLayers:u}=await import("./layersCreator-B1eOsYjS.js");return{populateOperationalLayers:u}},__vite__mapDeps([107,108,109,110,103])),a=[];if(vt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...i,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},h=g=>n==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,p=o(this.baseLayers,t.baseMapLayers.filter(g=>!h(g)),u);a.push(p);const f=o(this.referenceLayers,t.baseMapLayers.filter(h),u);a.push(f)}await Promise.allSettled(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=$s(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:nGe[t.type||""]??"web-map",portal:t.portal||kl.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||kl.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const r=`${t.serviceUrl}/${t.id}`,i=(await Wr(r,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e==null?void 0:e.signal})).data,s=$s(r);return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=GG[t];return e?e.itemId?new G3({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):G3.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};d([m({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Mt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],jc.prototype,"baseLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],jc.prototype,"id",void 0),d([m({type:jP})],jc.prototype,"portalItem",void 0),d([m()],jc.prototype,"referenceLayers",null),d([m({readOnly:!0})],jc.prototype,"resourceInfo",void 0),d([m({type:Xe})],jc.prototype,"spatialReference",void 0),d([m({type:ZVe})],jc.prototype,"style",void 0),d([m()],jc.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],jc.prototype,"title",void 0),d([lr("title")],jc.prototype,"writeTitle",null),jc=G3=d([V(sGe)],jc);const nGe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},oGe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},oS=jc,aGe=Object.freeze(Object.defineProperty({__proto__:null,default:oS},Symbol.toStringTag,{value:"Module"})),f5={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function $1e(t){return!!f5[t]||!!f5[t.toLowerCase()]}function jX(t){return f5[t]??f5[t.toLowerCase()]}function lGe(t){return[...jX(t)]}function EU(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function I1e(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*EU(o,n,s+1/3)),Math.round(255*EU(o,n,s)),Math.round(255*EU(o,n,s-1/3)),i]}function cGe(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function V$(t){return we(tY(t),0,255)}function G$(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}function j$(t,e){const r=t.toString(16).padStart(2,"0");return e?r.substring(0,1):r}let ID=class go{static blendColors(e,r,i,s=new go){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),go.fromArray(a,r)}return go.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return go.fromArray(I1e(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new go){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const i=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return go.fromArray([i+16*i,s+16*s,n+16*n,(o+16*o)/255],r)}case 7:case 9:{const i=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return go.fromArray([i,s,n,o/255],r)}default:return null}}static fromArray(e,r=new go){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=$1e(e)?jX(e):null;return i&&go.fromArray(i,r)||go.fromRgb(e,r)||go.fromHex(e,r)}static fromJSON(e){return e!=null?new go([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?go.fromString(e,this):Array.isArray(e)?go.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof go||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const r=(e==null?void 0:e.capitalize)??!1,i=(e==null?void 0:e.digits)??6,s=i===3||i===4,n=i===4||i===8,o=`#${j$(this.r,s)}${j$(this.g,s)}${j$(this.b,s)}${n?j$(Math.round(255*this.a),s):""}`;return r?o.toUpperCase():o}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=go.AlphaMode.ALWAYS){const r=V$(this.r),i=V$(this.g),s=V$(this.b);return e===go.AlphaMode.ALWAYS||this.a!==1?[r,i,s,V$(255*this.a)]:[r,i,s]}clone(){return new go(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(G$(this.r,0,255)),this.g=Math.round(G$(this.g,0,255)),this.b=Math.round(G$(this.b,0,255)),this.a=G$(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};ID.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(ID||(ID={}));const Fe=ID;function gRt(t){}function uGe(t){return()=>t}function Rt(t,e={}){const r=t instanceof Yo?t:new Yo(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),m(i)}var jG;let LD=jG=class extends We{constructor(t){super(t),this.type="none"}clone(){return new jG({type:this.type})}};d([Rt({none:"none",stayAbove:"stay-above"})],LD.prototype,"type",void 0),LD=jG=d([V("esri.ground.NavigationConstraint")],LD);function L1e(t){const e=tY(100*(1-t));return Math.max(0,Math.min(e,100))}function m5(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var HG;let ag=HG=class extends JO(j_){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Mt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&ae.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ns(t)||ae.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Ae(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Ow(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};uGe(n)().write(o,i)&&s.push(o)}else i!=null&&i.messages&&i.messages.push(new J("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return M1e(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await me(()=>import("./ElevationQuery-CTkwgQvn.js"),[]);vt(e);const i=new r,s=this.layers.filter(jre).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await me(()=>import("./ElevationQuery-CTkwgQvn.js"),[]);vt(e);const i=new r,s=this.layers.filter(jre).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ge(this.surfaceColor),navigationConstraint:ge(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new HG({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,r){const i=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,n=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await me(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-B1eOsYjS.js");return{populateOperationalLayers:l}},__vite__mapDeps([107,108,109,110,103]));vt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function hGe(t){return t&&"createElevationSampler"in t}function jre(t){return t.type==="elevation"||hGe(t)}d([m({json:{read:!1}})],ag.prototype,"layers",null),d([lr("layers")],ag.prototype,"writeLayers",null),d([m({readOnly:!0})],ag.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:an,read:{reader:m5,source:"transparency"},write:{writer:(t,e)=>{e.transparency=L1e(t)},target:"transparency"}}})],ag.prototype,"opacity",void 0),d([m({type:Fe,json:{type:[an],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],ag.prototype,"surfaceColor",void 0),d([m({type:LD,json:{write:!0}})],ag.prototype,"navigationConstraint",void 0),ag=HG=d([V("esri.Ground")],ag);const g5=ag;let I2=class extends Mt{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(ffe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new Mt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};d([m()],I2.prototype,"getCollections",void 0),d([m()],I2.prototype,"getChildrenFunction",void 0),d([m()],I2.prototype,"itemFilterFunction",void 0),I2=d([V("esri.core.CollectionFlattener")],I2);const sO=I2;function dGe(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=OUe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!$Ue(t))}function mk(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function pGe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fGe(t,e,r,i,s,n,o,a,l,c,u,h,p,f,g,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=_,v}function mGe(t,e){return new Float32Array(t,e,16)}const gGe=mk();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:gGe,clone:pGe,create:mk,createView:mGe,fromValues:fGe},Symbol.toStringTag,{value:"Module"}));const yGe=(t,e)=>{const r=Pm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Ac(r,r)},_Ge=(t,e)=>{const r=Pm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Ac(r,r)},vGe=(t,e)=>{const r=1-e,i=Pm(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Ac(i,i)},bGe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=Pm(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Ac(s,s)},wGe=(t,e)=>{const r=1-2*e,i=Pm(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return Ac(i,i)},xGe=(t,e)=>{const r=Pm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Ac(r,r)},TGe=(t,e)=>{const r=1-e,i=Pm(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Ac(i,i)};let D1e=class N1e{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=cc(e.strength,r.strength,i),this.radius=cc(e.radius,r.radius,i),this.threshold=cc(e.threshold,r.threshold,i)}clone(){return new N1e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:HP(this.radius),strength:this.strength,threshold:this.threshold}}},F1e=class k1e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(cc(e.radius,r.radius,i))}clone(){return new k1e(this.radius)}toJSON(){return{type:"blur",radius:HP(this.radius)}}},qG=class U1e{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=cc(e.amount,r.amount,i),this._updateMatrix()}clone(){return new U1e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||mk();switch(this.type){case"brightness":this._colorMatrix=yGe(e,this.amount);break;case"contrast":this._colorMatrix=_Ge(e,this.amount);break;case"grayscale":this._colorMatrix=vGe(e,this.amount);break;case"invert":this._colorMatrix=wGe(e,this.amount);break;case"saturate":this._colorMatrix=xGe(e,this.amount);break;case"sepia":this._colorMatrix=TGe(e,this.amount)}}},z1e=class B1e{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=cc(e.offsetX,r.offsetX,i),this.offsetY=cc(e.offsetY,r.offsetY,i),this.blurRadius=cc(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(cc(e.color[0],r.color[0],i)),this.color[1]=Math.round(cc(e.color[1],r.color[1],i)),this.color[2]=Math.round(cc(e.color[2],r.color[2],i)),this.color[3]=cc(e.color[3],r.color[3],i)}clone(){return new B1e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:HP(this.offsetX),yoffset:HP(this.offsetY),blurRadius:HP(this.blurRadius),color:e}}},V1e=class G1e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=cc(e.angle,r.angle,i),this._updateMatrix()}clone(){return new G1e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||mk();this._colorMatrix=bGe(e,this.angle)}},j1e=class H1e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=cc(e.amount,r.amount,i)}clone(){return new H1e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function cc(t,e,r){return t+(e-t)*r}function HP(t){return Math.round(1e3*Ka(t))/1e3}function SGe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new qG(t.type,0);case"saturate":case"brightness":case"contrast":return new qG(t.type,1);case"opacity":return new j1e(1);case"hue-rotate":return new V1e(0);case"blur":return new F1e(0);case"drop-shadow":return new z1e(0,0,0,[...jX("transparent")]);case"bloom":return new D1e(0,0,1)}}function EGe(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function CGe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(SGe(r[s]))}function AGe(t){const e=t[0];return!!e&&"type"in e}const Hre=()=>ae.getLogger("esri.support.basemapUtils");function PGe(){return{}}function MGe(t){for(const e in t){const r=t[e];Ae(r),delete t[e]}}function OGe(t,e){let r;if(typeof t=="string"){const i=t in GG,s=!i&&t.includes("/");if(!i&&!s){const n=Object.entries(GG).filter(([o,a])=>ii.apiKey&&!a.classic||!ii.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return Hre().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(r=e[t]),r||(r=i?oS.fromId(t):new oS({style:{id:t}}),e&&(e[t]=r))}else r=ma(oS,t);return r!=null&&r.destroyed&&(Hre().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function _Rt(t,e){var r,i,s,n;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function RGe(t){return new sO({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function CU(t){for(const e of t.values())e==null||e.destroy();t.clear()}const qre={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function $Ge(t){let e=null;if(typeof t=="string")if(t in qre){const r=qre[t];e=new g5({resourceInfo:{data:{layers:[r]}}})}else ae.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=ma(g5,t);return e}let q1e=0;const HX=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+q1e++})}};return e=d([V("esri.core.Identifiable")],e),e},vRt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:q1e++})}};return e=d([V("esri.core.NumericIdentifiable")],e),e};let Wre=class extends HX(class{}){};Wre=d([V("esri.core.Identifiable")],Wre);async function IGe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await me(async()=>{const{fromItem:i}=await import("./portalLayers-EQuNU6bx.js").then(s=>s.p);return{fromItem:i}},__vite__mapDeps([108,109,110]));try{return await r(e)}catch(i){const s=e&&e.portalItem,n=(s==null?void 0:s.id)||"unset",o=s&&s.portal&&s.portal.url||ii.portalUrl;throw ae.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let LGe=0,Xn=class extends Gs.EventedMixin(HX(j_)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new $r(-180,-90,180,90,Xe.WGS84),this.id=Date.now().toString(16)+"-layer-"+LGe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Xe.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await me(async()=>{const{fromUrl:i}=await import("./arcgisLayers-_7AmdA8i.js");return{fromUrl:i}},__vite__mapDeps([111,109,112,110]))).fromUrl(r)}static fromPortalItem(e){return IGe(e)}initialize(){this.when().catch(e=>{ns(e)||ae.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const r=this;"layers"in e&&e.layers.includes(r)?e.layers.remove(r):"tables"in e&&e.tables.includes(r)?e.tables.remove(r):"baseLayers"in e&&e.baseLayers.includes(r)?e.baseLayers.remove(r):"referenceLayers"in e&&e.referenceLayers.includes(r)&&e.referenceLayers.remove(r),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return $s(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Wr(e,{query:{f:"json"},responseType:"json"})).data;throw new J("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],Xn.prototype,"attributionDataUrl",void 0),d([m({type:$r})],Xn.prototype,"fullExtent",void 0),d([m({readOnly:!0})],Xn.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],Xn.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],Xn.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],Xn.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],Xn.prototype,"opacity",void 0),d([m({clonable:!1})],Xn.prototype,"parent",void 0),d([m({readOnly:!0})],Xn.prototype,"parsedUrl",null),d([m({type:Boolean,readOnly:!0})],Xn.prototype,"persistenceEnabled",void 0),d([m({type:Boolean})],Xn.prototype,"popupEnabled",void 0),d([m({type:Boolean})],Xn.prototype,"attributionVisible",void 0),d([m({type:Xe})],Xn.prototype,"spatialReference",void 0),d([m({type:String})],Xn.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],Xn.prototype,"type",void 0),d([m()],Xn.prototype,"url",void 0),d([m({type:Boolean,nonNullable:!0})],Xn.prototype,"visible",void 0),Xn=d([V("esri.layers.Layer")],Xn);const qX=Xn;function WG(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(s=WG(i.layers,e,r),s))return s}}const DGe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new Mt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ae.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Ow(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof qX){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Rc(r)?r.then(n=>{this.destroyed||this.add(n,i)}):ae.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return WG(this.layers,"id",r)}findLayerByUid(r){return WG(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return d([m()],e.prototype,"layers",null),e=d([V("esri.support.LayersMixin")],e),e};function YG(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if((n==null?void 0:n.type)==="group"){const o=YG(n.tables,e,r);if(o)return o}}}const NGe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new Mt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ae.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Ow(r,this._get("tables")))}findTableById(r){return YG(this.tables,"id",r)}findTableByUid(r){return YG(this.tables,"uid",r)}};return d([m()],e.prototype,"tables",null),e=d([V("esri.support.TablesMixin")],e),e};let yd=class extends NGe(DGe(Gs.EventedMixin(Me))){constructor(e){super(e),this.allLayers=new sO({getCollections:()=>{var r,i,s;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=RGe(this),this.basemap=null,this.editableLayers=new sO({getCollections:()=>[this.allLayers],itemFilterFunction:dGe}),this.ground=new g5,this._basemapCache=PGe()}destroy(){MGe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Ae(this.basemap),Ae(this.ground),this._set("ground",null)}castBasemap(e){return OGe(e,this._basemapCache)}castGround(e){return $Ge(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};d([m({readOnly:!0,dependsOn:[]})],yd.prototype,"allLayers",void 0),d([m({readOnly:!0})],yd.prototype,"allTables",void 0),d([m({type:oS,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],yd.prototype,"basemap",void 0),d([zi("basemap")],yd.prototype,"castBasemap",null),d([m({readOnly:!0})],yd.prototype,"editableLayers",void 0),d([m({type:g5,nonNullable:!0})],yd.prototype,"ground",void 0),d([zi("ground")],yd.prototype,"castGround",null),d([m()],yd.prototype,"undoRedo",void 0),yd=d([V("esri.Map")],yd);const W1e=yd,Yre={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function tw(t,e,r,i=ym){const s=new Sp(WY(i)),n=Qt.fromJSDate(t,{zone:s}),o=r==="decades"||r==="centuries"?"year":Y1e(r);return r==="decades"&&(e*=10),r==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function Xre(t,e,r=ym){const i=new Sp(WY(r)),s=Qt.fromJSDate(t,{zone:i});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=Y1e(e);return s.startOf(n).toJSDate()}function TRt(t,e,r){return t===0?0:t*Yre[e]/Yre[r]}function SRt(t,e){return t&&e?t.intersection(e):t||e}function Y1e(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var _d;let Qc=_d=class extends We{static get allTime(){return Zre}static get empty(){return FGe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(_d.allTime)}get isEmpty(){return this.equals(_d.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new _d({end:this.end,start:this.start})}equals(t){var n,o,a,l;if(!t)return!1;const e=((n=this.start)==null?void 0:n.getTime())??this.start,r=((o=this.end)==null?void 0:o.getTime())??this.end,i=((a=t.start)==null?void 0:a.getTime())??t.start,s=((l=t.end)==null?void 0:l.getTime())??t.end;return e===i&&r===s}expandTo(t,e=ym){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=Xre(r,t,e));let i=this.end;if(i){const s=Xre(i,t,e);i=i.getTime()===s.getTime()?s:tw(s,1,t,e)}return new _d({start:r,end:i})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return _d.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((u=t.end)==null?void 0:u.getTime())??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const h=new _d;return h.start=n===-1/0?null:new Date(n),h.end=o===1/0?null:new Date(o),h}return _d.empty}offset(t,e,r=ym){if(this.isEmpty||this.isAllTime)return this.clone();const i=new _d,{start:s,end:n}=this;return s!=null&&(i.start=tw(s,t,e,r)),n!=null&&(i.end=tw(n,t,e,r)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Zre.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new _d({start:e,end:r})}};d([m({type:Date,json:{write:{allowNull:!0}}})],Qc.prototype,"end",void 0),d([Tr("end")],Qc.prototype,"readEnd",null),d([lr("end")],Qc.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],Qc.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],Qc.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],Qc.prototype,"start",void 0),d([Tr("start")],Qc.prototype,"readStart",null),d([lr("start")],Qc.prototype,"writeStart",null),Qc=_d=d([V("esri.TimeExtent")],Qc);const Zre=new Qc,FGe=new Qc({start:void 0,end:void 0}),pR=Qc;async function X1e(t,e){const{WhereClause:r}=await me(()=>import("./WhereClause-By2MRARG.js").then(i=>i.W),__vite__mapDeps([19,20,21]));return r.create(t,e)}function ERt(t,e){return t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function CRt(t){return typeof t=="number"}function WX(t){return typeof t=="string"||t instanceof String}const kGe="yyyy-MM-dd",UGe="TT";var qP;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(qP||(qP={}));const zGe=[qP.HMS_MS,qP.HMS,qP.HM,UGe];function Jre(t){if(!t||!WX(t))return null;const e=Qt.fromFormat(t,kGe);return e.isValid?e:null}function Kre(t){return t&&WX(t)?rIe(zGe,e=>{const r=Qt.fromFormat(t,e);return r.isValid?r:null})??null:null}function Qre(t){if(!t||!WX(t))return null;const e=Qt.fromISO(t);return e.isValid?e:null}var oE;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(oE||(oE={}));const BGe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function VGe(t){return t!=null&&BGe.has(t.type)}function Z1e(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function J1e(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function K1e(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function GGe(t,e){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:i,max:s}=Q1e(t);if(i!=null&&+e<i||s!=null&&+e>s)return oE.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(i=>i==null||i.code!==e))return oE.INVALID_CODED_VALUE}return null}function Q1e(t,e){const r=t==null?void 0:t.domain;if(!r||r.type!=="range")return;const i="range"in r?r.range[0]:r.minValue,s="range"in r?r.range[1]:r.maxValue,n=VGe(t);return Z1e(t)||K1e(t)||J1e(t)?{...jGe(t,s,i),isInteger:n}:{min:i!=null&&typeof i=="number"?i:null,max:s!=null&&typeof s=="number"?s:null,rawMin:i,rawMax:s,isInteger:n}}function jGe(t,e,r){var i,s,n,o,a,l;return Z1e(t)?{min:(i=Jre(r))==null?void 0:i.toMillis(),max:(s=Jre(e))==null?void 0:s.toMillis(),rawMin:r,rawMax:e}:K1e(t)?{min:(n=Kre(r))==null?void 0:n.toMillis(),max:(o=Kre(e))==null?void 0:o.toMillis(),rawMin:r,rawMax:e}:J1e(t)?{min:(a=Qre(r))==null?void 0:a.toMillis(),max:(l=Qre(e))==null?void 0:l.toMillis(),rawMin:r,rawMax:e}:{max:null,min:null}}const HGe=()=>ae.getLogger("esri.support.arcadeOnDemand");let AU;function YX(){return AU||(AU=(async()=>{const t=await me(()=>import("./arcadeUtils-CU4A39Om.js").then(e=>e.aK),__vite__mapDeps([113,20,21,114,25,23,115]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),AU}const qGe=(t,e,r)=>XX.create(t,e,r,null,["$feature","$view"],[]),eve=(t,e,r)=>XX.create(t,e,r,null,["$feature","$view"],[]),ARt=(t,e,r,i)=>XX.create(t,e,r,i,["$feature","$view"],[]);let XX=class tve{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await YX(),u=Xe.fromJSON(r);let h;try{h=a.parseScript(e,o)}catch(L){return HGe().error(new J("arcade-bad-expression","Failed to parse arcade script",{script:e,error:L})),null}const p=n.reduce((L,F)=>({...L,[F]:null}),{});let f=null;s!=null&&(f=new c(s),f.immutable=!0,p.$config=null);const g=a.scriptUsesGeometryEngine(h),_=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(h)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(h),w=b&&a.enableAsyncSupport(),T={vars:p,spatialReference:u,useAsync:!!w};await Promise.all([_,v,w]);const S=new Set;await a.loadDependentModules(S,h,null,b,g);const C=new c;C.immutable=!1,C.setField("scale",0);const P=a.compileScript(h,T),R=(L,F)=>{var j;const U=(j=L.$view)==null?void 0:j.timeZone;return"$view"in L&&L.$view&&(C.setField("scale",typeof L.$view=="object"&&"scale"in L.$view?L.$view.scale:void 0),L.$view=C),f&&(L.$config=f),P({vars:L,spatialReference:u,services:F,timeZone:U})};return new tve(e,a,h,R,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const WGe=/^([0-9_])/,YGe=/[^a-z0-9_\u0080-\uffff]+/gi;function PRt(t){return t==null?null:t.trim().replaceAll(YGe,"_").replace(WGe,"F$1")||null}const XGe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ZGe=["field","normalizationField"];function MRt(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(eie(XGe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)eie(ZGe,i,e)}}function eie(t,e,r){if(t)for(const i of t){const s=a6(i,e),n=s&&typeof s!="function"&&r.get(s);n&&Jw(i,n.name,e)}}function ORt(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),s=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const i=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const PU=new Set;function rve(t,e){return t&&e?(PU.clear(),nO(PU,t,e),Array.from(PU).sort()):[]}function nO(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of r)gk(t,e,s);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const s of r)s!=null&&t.add(s)}}function gk(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function RRt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function q_(t,e,r){var n;if(!r)return;const{arcadeUtils:i}=await YX(),s=i.extractFieldNames(r,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)gk(t,e,o)}async function ive(t,e,r){if(r&&r!=="1=1"){const i=await X1e(r,e);if(!i.isStandardized)throw new J("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});nO(t,e,i.fieldNames)}}function $Rt({displayField:t,fields:e}){return t||(e!=null&&e.length?MU(e,"name-or-title")||MU(e,"unique-identifier")||MU(e,"type-or-category")||JGe(e):null)}function JGe(t){for(const e of t){if(!(e!=null&&e.name))continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function MU(t,e){for(const r of t)if(r!=null&&r.valueType&&r.valueType===e)return r.name;return null}async function IRt(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function KGe(t,e,r){r.onStatisticExpression?q_(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function LRt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(QGe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>KGe(t,e.fieldsIndex,n))),await Promise.all(i)}async function QGe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>q_(t,e.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(q_(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function DRt(t,e,r){e&&(e.timeInfo&&(r!=null&&r.timeExtent)&&nO(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&nO(t,e.fieldsIndex,[e.floorInfo.floorField]),(r==null?void 0:r.where)!=null&&await ive(t,e.fieldsIndex,r.where))}async function NRt(t,e,r){e&&r&&await Promise.all(r.map(i=>e7e(t,e,i)))}async function e7e(t,e,r){e&&r&&(r.valueExpression?await q_(t,e.fieldsIndex,r.valueExpression):r.field&&gk(t,e.fieldsIndex,r.field))}function FRt(t){return t?rve(t.fieldsIndex,sve(t)):[]}function t7e(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?rve(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const r7e=new Set(["oid","global-id","guid"]),i7e=new Set(["oid","global-id"]),s7e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function n7e(t){const e=new Set;nve(t).forEach(i=>e.add(i)),t7e(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function sve(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function nve(t){return sve(t).map(e=>e.toLowerCase())}function kRt(t,e){var r;return t.editable&&!r7e.has(t.type)&&!nve(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function URt(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||n7e(e).includes(r)||i7e.has(t.type)||s7e.some(s=>s.test(r)))}async function zRt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r!=null&&r.length&&await Promise.all(r.map(s=>o7e(t,i,s)))}async function o7e(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await q_(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{gk(t,e,o.slice(1,-1))})}await ive(t,e,s)}function BRt(t){const e=t.defaultValue;return e!==void 0&&lve(t,e)?e:t.nullable?null:void 0}function VRt(t){const e=typeof t=="string"?{type:t}:t;return _7e(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function ove(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function a7e(t){return t===null||ove(t)}function l7e(t){return t===null||Number.isInteger(t)}function ave(t){return t!=null&&typeof t=="string"}function c7e(t){return t===null||ave(t)}function u7e(){return!0}function lve(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":r=t.nullable?l7e:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?a7e:ove;break;case"string":case"esriFieldTypeString":r=t.nullable?c7e:ave;break;default:r=u7e}return arguments.length===1?r:r(e)}const h7e=["integer","small-integer","big-integer"],d7e=["single","double"],p7e=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],f7e=["esriFieldTypeSingle","esriFieldTypeDouble"],m7e=new Set([...h7e,...p7e]),g7e=new Set([...d7e,...f7e]),y7e=hfe(m7e,g7e);function cve(t){return t!=null&&y7e.has(t.type)}function _7e(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function v7e(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function GRt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function jRt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function HRt(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function qRt(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function WRt(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function YRt(t,e){return b7e(t,e)===null}var y5,_5;function XRt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function b7e(t,e){return t==null||t.nullable&&e===null?null:cve(t)&&!w7e(t.type,Number(e))?y5.OUT_OF_RANGE:lve(t,e)?t.domain?GGe(t,e):null:_5.INVALID_TYPE}function w7e(t,e){const r=typeof t=="string"?uve(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?Number.isInteger(e)&&e>=i&&e<=s:e>=i&&e<=s}function uve(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return x7e;case"esriFieldTypeInteger":case"integer":return T7e;case"esriFieldTypeBigInteger":case"big-integer":return S7e;case"esriFieldTypeSingle":case"single":return E7e;case"esriFieldTypeDouble":case"double":return C7e}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(y5||(y5={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(_5||(_5={}));const x7e={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},T7e={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},S7e={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},E7e={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},C7e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function ZRt(t,e,r){switch(t){case oE.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case oE.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case _5.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case y5.OUT_OF_RANGE:{const{min:i,max:s}=uve(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function JRt(t,e){return!A7e(t,e,null)}function A7e(t,e,r){if(!(e!=null&&e.attributes)||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!i.has(n)){if(s=!0,r==null)break;r.add(n)}return s}function KRt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let DD=class extends We{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],DD.prototype,"type",void 0),DD=d([V("esri.popup.content.Content")],DD);const g1=DD;var XG;let Sv=XG=class extends g1{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new XG({description:this.description,displayType:this.displayType,title:this.title})}};d([m({type:String,json:{write:!0}})],Sv.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],Sv.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],Sv.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Sv.prototype,"type",void 0),Sv=XG=d([V("esri.popup.content.AttachmentsContent")],Sv);const v5=Sv;var ZG;let Ev=ZG=class extends g1{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new ZG({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ge(this.outFields):null})}};d([m()],Ev.prototype,"creator",void 0),d([m()],Ev.prototype,"destroyer",void 0),d([m()],Ev.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],Ev.prototype,"type",void 0),Ev=ZG=d([V("esri.popup.content.CustomContent")],Ev);const P7e=Ev;var JG;let L2=JG=class extends We{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new JG({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],L2.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],L2.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],L2.prototype,"returnType",void 0),L2=JG=d([V("esri.popup.ElementExpressionInfo")],L2);const M7e=L2;var KG;let j3=KG=class extends g1{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new KG({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};d([m({type:M7e,json:{write:!0}})],j3.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],j3.prototype,"type",void 0),j3=KG=d([V("esri.popup.content.ExpressionContent")],j3);const ZX=j3;let D2=class extends Au(We){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};d([Rt(g6e)],D2.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],D2.prototype,"digitSeparator",void 0),d([m({type:an,json:{write:!0}})],D2.prototype,"places",void 0),D2=d([V("esri.popup.support.FieldInfoFormat")],D2);const O7e=D2;var QG;let vd=QG=class extends We{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new QG({fieldName:this.fieldName,format:this.format?ge(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([m({type:String,json:{write:!0}})],vd.prototype,"fieldName",void 0),d([m({type:O7e,json:{write:!0}})],vd.prototype,"format",void 0),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],vd.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],vd.prototype,"label",void 0),d([Rt(new Yo({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],vd.prototype,"stringFieldOption",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],vd.prototype,"statisticType",void 0),d([m({type:String,json:{write:!0}})],vd.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],vd.prototype,"visible",void 0),vd=QG=d([V("esri.popup.FieldInfo")],vd);const hve=vd;var e7;let lg=e7=class extends g1{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new e7(ge({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],lg.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],lg.prototype,"description",void 0),d([m({type:[hve]})],lg.prototype,"fieldInfos",void 0),d([lr("fieldInfos")],lg.prototype,"writeFieldInfos",null),d([m({type:String,json:{write:!0}})],lg.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],lg.prototype,"type",void 0),lg=e7=d([V("esri.popup.content.FieldsContent")],lg);const b5=lg;let Cv=class extends We{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],Cv.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],Cv.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],Cv.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Cv.prototype,"type",void 0),Cv=d([V("esri.popup.content.mixins.MediaInfo")],Cv);const JX=Cv;var t7;let Av=t7=class extends Me{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new t7({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],Av.prototype,"color",void 0),d([m()],Av.prototype,"fieldName",void 0),d([m()],Av.prototype,"tooltip",void 0),d([m()],Av.prototype,"value",void 0),Av=t7=d([V("esri.popup.content.support.ChartMediaInfoValueSeries")],Av);const R7e=Av;var r7;let Ey=r7=class extends We{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new r7({colors:ge(this.colors),fields:ge(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};d([m({type:[Fe],json:{type:[[an]],write:!0}})],Ey.prototype,"colors",void 0),d([m({type:[String],json:{write:!0}})],Ey.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],Ey.prototype,"normalizeField",void 0),d([m({type:[R7e],json:{read:!1}})],Ey.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],Ey.prototype,"tooltipField",void 0),Ey=r7=d([V("esri.popup.content.support.ChartMediaInfoValue")],Ey);const $7e=Ey;let H3=class extends JX{constructor(e){super(e),this.type=null,this.value=null}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],H3.prototype,"type",void 0),d([m({type:$7e,json:{write:!0}})],H3.prototype,"value",void 0),H3=d([V("esri.popup.content.mixins.ChartMediaInfo")],H3);const yk=H3,_k=Ul()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var i7;let ND=i7=class extends yk{constructor(t){super(t),this.type="bar-chart"}clone(){return new i7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:_k.write}})],ND.prototype,"type",void 0),ND=i7=d([V("esri.popup.content.BarChartMediaInfo")],ND);const dve=ND;var s7;let FD=s7=class extends yk{constructor(t){super(t),this.type="column-chart"}clone(){return new s7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:_k.write}})],FD.prototype,"type",void 0),FD=s7=d([V("esri.popup.content.ColumnChartMediaInfo")],FD);const pve=FD;var n7;let q3=n7=class extends We{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new n7({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],q3.prototype,"linkURL",void 0),d([m({type:String,json:{write:!0}})],q3.prototype,"sourceURL",void 0),q3=n7=d([V("esri.popup.content.support.ImageMediaInfoValue")],q3);const I7e=q3;var o7;let N2=o7=class extends JX{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new o7({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};d([m({type:Number,json:{write:!0}})],N2.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],N2.prototype,"type",void 0),d([m({type:I7e,json:{write:!0}})],N2.prototype,"value",void 0),N2=o7=d([V("esri.popup.content.ImageMediaInfo")],N2);const fve=N2;var a7;let kD=a7=class extends yk{constructor(t){super(t),this.type="line-chart"}clone(){return new a7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:_k.write}})],kD.prototype,"type",void 0),kD=a7=d([V("esri.popup.content.LineChartMediaInfo")],kD);const mve=kD;var l7;let UD=l7=class extends yk{constructor(t){super(t),this.type="pie-chart"}clone(){return new l7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:_k.write}})],UD.prototype,"type",void 0),UD=l7=d([V("esri.popup.content.PieChartMediaInfo")],UD);const gve=UD,yve={base:JX,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":dve,"column-chart":pve,"line-chart":mve,"pie-chart":gve,image:fve}};var c7;let bd=c7=class extends g1{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?fve.fromJSON(e):e.type==="barchart"?dve.fromJSON(e):e.type==="columnchart"?pve.fromJSON(e):e.type==="linechart"?mve.fromJSON(e):e.type==="piechart"?gve.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new c7(ge({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],bd.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],bd.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],bd.prototype,"description",void 0),d([m({types:[yve]})],bd.prototype,"mediaInfos",void 0),d([Tr("mediaInfos")],bd.prototype,"readMediaInfos",null),d([lr("mediaInfos")],bd.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],bd.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],bd.prototype,"type",void 0),bd=c7=d([V("esri.popup.content.MediaContent")],bd);const w5=bd;var u7;let W3=u7=class extends We{constructor(t){super(t),this.field=null,this.order=null}clone(){return new u7({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],W3.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],W3.prototype,"order",void 0),W3=u7=d([V("esri.popup.support.RelatedRecordsInfoFieldOrder")],W3);const _ve=W3;let pf=class extends Au(g1){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],pf.prototype,"description",void 0),d([m({type:Number,json:{type:an,write:!0}})],pf.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],pf.prototype,"displayType",void 0),d([m({type:[_ve],json:{write:!0}})],pf.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:an,write:!0}})],pf.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],pf.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],pf.prototype,"type",void 0),pf=d([V("esri.popup.content.RelationshipContent")],pf);const x5=pf;var h7;let Y3=h7=class extends g1{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new h7({text:this.text})}};d([m({type:String,json:{write:!0}})],Y3.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],Y3.prototype,"type",void 0),Y3=h7=d([V("esri.popup.content.TextContent")],Y3);const T5=Y3,L7e={base:null,key:"type",typeMap:{attachment:v5,media:w5,text:T5,expression:ZX,field:b5,relationship:x5}};var d7;let Pv=d7=class extends We{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new d7({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],Pv.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Pv.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],Pv.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],Pv.prototype,"returnType",void 0),Pv=d7=d([V("esri.popup.ExpressionInfo")],Pv);const D7e=Pv;var p7;let X3=p7=class extends We{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new p7({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],X3.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],X3.prototype,"showNoDataRecords",void 0),X3=p7=d([V("esri.popup.LayerOptions")],X3);const N7e=X3;var f7;let Z3=f7=class extends We{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new f7({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ge(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],Z3.prototype,"showRelatedRecords",void 0),d([m({type:[_ve],json:{write:!0}})],Z3.prototype,"orderByFields",void 0),Z3=f7=d([V("esri.popup.RelatedRecordsInfo")],Z3);const F7e=Z3;var m7;let ju=m7=class extends HX(Me){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new m7({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],ju.prototype,"active",void 0),d([m()],ju.prototype,"className",void 0),d([m()],ju.prototype,"disabled",void 0),d([m()],ju.prototype,"icon",void 0),d([m()],ju.prototype,"id",void 0),d([m()],ju.prototype,"indicator",void 0),d([m()],ju.prototype,"title",void 0),d([m()],ju.prototype,"type",void 0),d([m()],ju.prototype,"visible",void 0),ju=m7=d([V("esri.support.actions.ActionBase")],ju);const KX=ju;var g7;let zD=g7=class extends KX{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new g7({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],zD.prototype,"image",void 0),zD=g7=d([V("esri.support.Action.ActionButton")],zD);const k7e=zD;var y7;let J3=y7=class extends KX{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new y7({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],J3.prototype,"image",void 0),d([m()],J3.prototype,"value",void 0),J3=y7=d([V("esri.support.Action.ActionToggle")],J3);const U7e=J3,HC="relationships/",tie="expression/",z7e=Mt.ofType({key:"type",defaultKeyValue:"button",base:KX,typeMap:{button:k7e,toggle:U7e}}),B7e={base:g1,key:"type",typeMap:{media:w5,custom:P7e,text:T5,attachments:v5,fields:b5,expression:ZX,relationship:x5}},V7e=new Set(["attachments","fields","media","text","expression","relationship"]);let yo=class extends Au(We){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>gm(B7e,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Rc(e)?e:(ae.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>V7e.has(n.type)).map(n=>n==null?void 0:n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),nO(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ge(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var n,o;const i=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ge(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),w5.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),T5.fromJSON(n)):n.type==="attachments"?v5.fromJSON(n):n.type==="fields"?b5.fromJSON(n):n.type==="expression"?ZX.fromJSON(n):n.type==="relationship"?x5.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(HC)))return null;const s=r.replace(HC,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?x5.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${HC}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new T5({text:e})):n.push(new b5),Array.isArray(r)&&r.length&&n.push(w5.fromJSON({mediaInfos:r})),i&&n.push(v5.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,h=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&h.push(a),l&&h.push(l),h}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>q_(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(HC)&&!r.startsWith(tie)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${HC}`)===0||o.indexOf(`{${tie}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};d([m({type:z7e})],yo.prototype,"actions",void 0),d([m()],yo.prototype,"content",void 0),d([zi("content")],yo.prototype,"castContent",null),d([Tr("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],yo.prototype,"readContent",null),d([lr("content",{popupElements:{type:Mt.ofType(L7e)},showAttachments:{type:Boolean},mediaInfos:{type:Mt.ofType(yve)},description:{type:String},relatedRecordsInfo:{type:F7e}})],yo.prototype,"writeContent",null),d([m({type:[D7e],json:{write:!0}})],yo.prototype,"expressionInfos",void 0),d([m({type:[hve]})],yo.prototype,"fieldInfos",void 0),d([lr("fieldInfos")],yo.prototype,"writeFieldInfos",null),d([m({type:N7e})],yo.prototype,"layerOptions",void 0),d([lr("layerOptions")],yo.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],yo.prototype,"lastEditInfoEnabled",void 0),d([m()],yo.prototype,"outFields",void 0),d([m()],yo.prototype,"overwriteActions",void 0),d([m()],yo.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],yo.prototype,"title",void 0),d([lr("title")],yo.prototype,"writeTitle",null),yo=d([V("esri.PopupTemplate")],yo);const G7e=yo,rie=new Yo({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let j7e=0,F2=class extends We{constructor(e){super(e),this.id="sym"+j7e++,this.type=null,this.color=new Fe([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:rie.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:rie.write}}})],F2.prototype,"type",void 0),d([m({type:Fe,json:{write:{allowNull:!0}}})],F2.prototype,"color",void 0),d([Tr("color")],F2.prototype,"readColor",null),F2=d([V("esri.symbols.Symbol")],F2);const Pu=F2;var _7;let Cy=_7=class extends Pu{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return o?q_(t,e,o.expression):null});await Promise.all(s)}}}clone(){return new _7({data:ge(this.data)})}hash(){return ZW(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],Cy.prototype,"color",void 0),d([m({json:{write:!0}})],Cy.prototype,"data",void 0),d([Tr("data",["symbol"])],Cy.prototype,"readData",null),d([lr("data",{})],Cy.prototype,"writeData",null),d([Rt({CIMSymbolReference:"cim"},{readOnly:!0})],Cy.prototype,"type",void 0),Cy=_7=d([V("esri.symbols.CIMSymbol")],Cy);const vk=Cy;let k2=class extends We{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],k2.prototype,"enabled",void 0),d([lr("enabled")],k2.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],k2.prototype,"type",void 0),k2=d([V("esri.symbols.Symbol3DLayer")],k2);const Mm=k2;function H7e(t,e){const r=e.transparency!=null?m5(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new Fe([i[0]||0,i[1]||0,i[2]||0,r]):null}function q7e(t,e){e.color=t.toJSON().slice(0,3);const r=L1e(t.a);r!==0&&(e.transparency=r)}const v0={type:Fe,json:{type:[an],default:null,read:{source:["color","transparency"],reader:H7e},write:{target:{color:{type:[an]},transparency:{type:an}},writer:q7e}}},vm={type:Number,cast:Js,json:{write:!0}};let Mv=class extends We{constructor(e){super(e),this.color=new Fe([0,0,0,1]),this.extensionLength=0,this.size=Ka(1)}clone(){}cloneProperties(){return{color:ge(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Mv.prototype,"type",void 0),d([m(v0)],Mv.prototype,"color",void 0),d([m({...vm,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Mv.prototype,"extensionLength",void 0),d([m(vm)],Mv.prototype,"size",void 0),Mv=d([V("esri.symbols.edges.Edges3D")],Mv);const QX=Mv;var v7;let BD=v7=class extends QX{constructor(t){super(t),this.type="sketch"}clone(){return new v7(this.cloneProperties())}};d([Rt({sketch:"sketch"},{readOnly:!0})],BD.prototype,"type",void 0),BD=v7=d([V("esri.symbols.edges.SketchEdges3D")],BD);const W7e=BD;var b7;let VD=b7=class extends QX{constructor(t){super(t),this.type="solid"}clone(){return new b7(this.cloneProperties())}};d([Rt({solid:"solid"},{readOnly:!0})],VD.prototype,"type",void 0),VD=b7=d([V("esri.symbols.support.SolidEdges3D")],VD);const Y7e=VD,vve={types:{key:"type",base:QX,typeMap:{solid:Y7e,sketch:W7e}},json:{write:!0}};var w7;let vu=w7=class extends We{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new w7(t)}};d([m(v0)],vu.prototype,"color",void 0),vu=w7=d([V("esri.symbols.support.Symbol3DMaterial")],vu);var x7;let Ay=x7=class extends Mm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new x7({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};d([Rt({Extrude:"extrude"},{readOnly:!0})],Ay.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Ay.prototype,"size",void 0),d([m({type:vu,json:{write:!0}})],Ay.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ay.prototype,"castShadows",void 0),d([m(vve)],Ay.prototype,"edges",void 0),Ay=x7=d([V("esri.symbols.ExtrudeSymbol3DLayer")],Ay);const eZ=Ay;let K3=class extends Pu{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([Rt({esriSLS:"simple-line"},{readOnly:!0})],K3.prototype,"type",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],K3.prototype,"width",void 0),K3=d([V("esri.symbols.LineSymbol")],K3);const X7e=K3,Z7e=["begin","end","begin-end"],bve=["arrow","circle","square","diamond","cross","x"];var T7;let ff=T7=class extends We{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new T7({color:ge(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],ff.prototype,"placement",void 0),d([Rt({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],ff.prototype,"type",void 0),d([m({type:bve})],ff.prototype,"style",void 0),d([lr("style")],ff.prototype,"writeStyle",null),d([m({type:Fe,value:null,json:{write:{allowNull:!0}}})],ff.prototype,"color",null),d([Tr("color")],ff.prototype,"readColor",null),d([lr("color")],ff.prototype,"writeColor",null),ff=T7=d([V("esri.symbols.LineSymbolMarker")],ff);const J7e=ff;var S7;const OU=new Yo({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let cg=S7=class extends X7e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Js(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Js(n)),o}clone(){var t;return new S7({color:ge(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};d([Rt({esriSLS:"simple-line"},{readOnly:!0})],cg.prototype,"type",void 0),d([m({type:OU.apiValues,json:{read:OU.read,write:OU.write}})],cg.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],cg.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],cg.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":J7e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],cg.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],cg.prototype,"miterLimit",void 0),cg=S7=d([V("esri.symbols.SimpleLineSymbol")],cg);const b0=cg;let Q3=class extends Pu{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":b0}},json:{default:null,write:!0}})],Q3.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],Q3.prototype,"type",void 0),Q3=d([V("esri.symbols.FillSymbol")],Q3);const wve=Q3;let GD=class extends We{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],GD.prototype,"type",void 0),GD=d([V("esri.symbols.patterns.LinePattern3D")],GD);const xve=GD,K7e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var E7;const Q7e=Ul()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let eA=E7=class extends xve{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new E7(t)}};d([m({type:["style"]})],eA.prototype,"type",void 0),d([Rt(Q7e),m({type:K7e})],eA.prototype,"style",void 0),eA=E7=d([V("esri.symbols.patterns.LineStylePattern3D")],eA);const tZ=eA;let jD=class extends We{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],jD.prototype,"type",void 0),jD=d([V("esri.symbols.patterns.Pattern3D")],jD);const Tve=jD,eje=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var C7;let tA=C7=class extends Tve{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new C7(t)}};d([m({type:["style"]})],tA.prototype,"type",void 0),d([m({type:eje,json:{read:!0,write:!0}})],tA.prototype,"style",void 0),tA=C7=d([V("esri.symbols.patterns.StylePattern3D")],tA);const Sve=tA,tje={types:{key:"type",base:Tve,typeMap:{style:Sve}},json:{write:!0}},Eve={types:{key:"type",base:xve,typeMap:{style:tZ}},json:{write:!0}},WP=new Fe("white");new Fe("black");const rje=new Fe([255,255,255,0]);function ije(t){return t.r===0&&t.g===0&&t.b===0}var A7;let YP=A7=class extends vu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new A7(t)}};d([Rt({multiply:"multiply",replace:"replace",tint:"tint"})],YP.prototype,"colorMixMode",void 0),YP=A7=d([V("esri.symbols.support.Symbol3DFillMaterial")],YP);function Mn(t=Ove){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Nw(t,e,r,i,s,n,o=Mn()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function d$t(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new $r(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function aE(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function sje(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Ep(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function pu(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)s=Math.min(s,e[r+3*u]),n=Math.min(n,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function RU(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const h=e[u];s=Math.min(s,h[0]),n=Math.min(n,h[1]),o=Math.min(o,h[2]),a=Math.max(a,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<i;u++){const h=e[u];s=Math.min(s,h[0]),n=Math.min(n,h[1]),a=Math.max(a,h[0]),l=Math.max(l,h[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function nje(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function nx(t){return t[0]>=t[3]?0:t[3]-t[0]}function ox(t){return t[1]>=t[4]?0:t[4]-t[1]}function y1(t){return t[2]>=t[5]?0:t[5]-t[2]}function Cve(t){const e=nx(t),r=y1(t),i=ox(t);return Math.sqrt(e*e+r*r+i*i)}function ip(t,e=[0,0,0]){return e[0]=t[0]+nx(t)/2,e[1]=t[1]+ox(t)/2,e[2]=t[2]+y1(t)/2,e}function H$(t,e=[0,0,0]){return e[0]=nx(t),e[1]=ox(t),e[2]=y1(t),e}function rZ(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function p$t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function oje(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function sp(t,e){return e==null||oje(t,e)}function Ave(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function f$t(t,e,r=t){const i=t[0]+nx(t)/2,s=t[1]+ox(t)/2,n=t[2]+y1(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Pve(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function Mve(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function bk(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ri(t){return t?bk(t,iie):Mn(iie)}function iZ(t,e){return e||(e=jt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function m$t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function aje(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function P7(t){return t.length===6}function sZ(t){return nx(t)===0&&ox(t)===0&&y1(t)===0}function g$t(t,e,r){if(t==null||e==null)return t===e;if(!P7(t)||!P7(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function lje(t,e,r,i,s,n){return Nw(t,e,r,i,s,n,cje)}const y$t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],iie=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Ove=[0,0,0,0,0,0],cje=Mn();function $U(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Pe(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const uje=Nw(-.5,-.5,-.5,.5,.5,.5),hje=Nw(-.5,-.5,0,.5,.5,1),dje=Nw(-.5,-.5,0,.5,.5,.5);function pje(t){switch(t){case"sphere":case"cube":case"diamond":return uje;case"cylinder":case"cone":case"inverted-cone":return hje;case"tetrahedron":return dje;default:return}}const nZ=["butt","square","round"],fje=[...nZ,"none"],Rve=["miter","bevel","round"];var M7;let Ov=M7=class extends We{constructor(t){super(t),this.color=new Fe([0,0,0,1]),this.size=Ka(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new M7(t)}};d([m(v0)],Ov.prototype,"color",void 0),d([m(vm)],Ov.prototype,"size",void 0),d([m(Eve)],Ov.prototype,"pattern",void 0),d([m({type:nZ,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Ov.prototype,"patternCap",void 0),Ov=M7=d([V("esri.symbols.support.Symbol3DOutline")],Ov);var HD;let ug=HD=class extends Mm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new HD(t)}static fromSimpleFillSymbol(t){var i,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new tZ({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((s=t.outline)==null?void 0:s.color)??WP).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(r.patternCap=t.outline.cap),new HD({material:new YP({color:(t.color??rje).clone()}),pattern:t.style&&t.style!=="solid"?new Sve({style:t.style}):null,outline:r})}};d([Rt({Fill:"fill"},{readOnly:!0})],ug.prototype,"type",void 0),d([m({type:YP,json:{write:!0}})],ug.prototype,"material",void 0),d([m(tje)],ug.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ug.prototype,"castShadows",void 0),d([m({type:Ov,json:{write:!0}})],ug.prototype,"outline",void 0),d([m(vve)],ug.prototype,"edges",void 0),ug=HD=d([V("esri.symbols.FillSymbol3DLayer")],ug);const fR=ug,mje=["none","underline","line-through"],gje=["normal","italic","oblique"],yje=["normal","lighter","bold","bolder"],$ve={type:Number,cast:t=>{const e=jd(t);return e===0?1:we(e,.1,4)},nonNullable:!0},_je=["left","right","center"],vje=["baseline","top","middle","bottom"],Ive={type:_je,nonNullable:!0},Lve={type:vje,nonNullable:!0},bje=8;var O7;let hg=O7=class extends We{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Js(t)}clone(){return new O7({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:mje,json:{default:"none",write:!0}})],hg.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],hg.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],hg.prototype,"size",void 0),d([zi("size")],hg.prototype,"castSize",null),d([m({type:gje,json:{default:"normal",write:!0}})],hg.prototype,"style",void 0),d([m({type:yje,json:{default:"normal",write:!0}})],hg.prototype,"weight",void 0),hg=O7=d([V("esri.symbols.Font")],hg);const mR=hg;var R7;const wje=Ul()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Rv=R7=class extends We{constructor(t){super(t)}readHref(t,e,r){return t?Dw(t,r):e.dataURI}writeHref(t,e,r,i){t&&(Cm(t)?e.dataURI=t:(e.href=nE(t,i),Rl(e.href)&&(e.href=mu(e.href))))}clone(){return new R7({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Rv.prototype,"href",void 0),d([Tr("href")],Rv.prototype,"readHref",null),d([lr("href",{href:{type:String},dataURI:{type:String}})],Rv.prototype,"writeHref",null),d([Rt(wje)],Rv.prototype,"primitive",void 0),Rv=R7=d([V("esri.symbols.support.IconSymbol3DLayerResource")],Rv);const xje="circle";var $7;let Fb=$7=class extends Me{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new $7({x:this.x,y:this.y})}};d([m({type:Number})],Fb.prototype,"x",void 0),d([m({type:Number})],Fb.prototype,"y",void 0),Fb=$7=d([V("esri.symbols.support.Symbol3DAnchorPosition2D")],Fb);var I7;let rA=I7=class extends We{constructor(t){super(t),this.color=new Fe([0,0,0,1]),this.size=Ka(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new I7(t)}};d([m(v0)],rA.prototype,"color",void 0),d([m(vm)],rA.prototype,"size",void 0),rA=I7=d([V("esri.symbols.support.Symbol3DIconOutline")],rA);var U2;const Dve="esri.symbols.IconSymbol3DLayer";let mf=U2=class extends Mm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new U2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||WP,r=sie(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||WP).clone()}:null;return new U2({size:t.size,resource:{primitive:Sje(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||ije(t.color)?WP:t.color,r=sie(t);return new U2({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new U2({resource:{href:ame({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function sie(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=nie(t.xoffset),s=nie(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function nie(t){return isFinite(t)?t:0}d([m({type:vu,json:{write:!0}})],mf.prototype,"material",void 0),d([m({type:Rv,json:{write:!0}})],mf.prototype,"resource",void 0),d([Rt({Icon:"icon"},{readOnly:!0})],mf.prototype,"type",void 0),d([m(vm)],mf.prototype,"size",void 0),d([Rt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),m({json:{default:"center"}})],mf.prototype,"anchor",void 0),d([m({type:Fb,json:{type:[Number],read:{reader:t=>new Fb({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],mf.prototype,"anchorPosition",void 0),d([m({type:rA,json:{write:!0}})],mf.prototype,"outline",void 0),mf=U2=d([V(Dve)],mf);const Tje={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function Sje(t){return Tje[t]||(ae.getLogger(Dve).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const m_=mf;let $v=class extends Au(We){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],$v.prototype,"type",void 0),d([m({type:Z7e,json:{default:"begin-end",write:!0}})],$v.prototype,"placement",void 0),d([m({type:bve,json:{default:"arrow",write:!0}})],$v.prototype,"style",void 0),d([m({type:Fe,json:{type:[an],default:null,write:!0}})],$v.prototype,"color",void 0),$v=d([V("esri.symbols.LineStyleMarker3D")],$v);const L7=$v;var qD;let gf=qD=class extends Mm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Ka(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new qD(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??Ka(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new tZ({style:t.style}):null,material:new vu({color:(t.color||WP).clone()}),marker:t.marker?new L7({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new qD(e)}};d([m({type:vu,json:{write:!0}})],gf.prototype,"material",void 0),d([Rt({Line:"line"},{readOnly:!0})],gf.prototype,"type",void 0),d([m({type:Rve,json:{write:!0,default:"miter"}})],gf.prototype,"join",void 0),d([m({type:nZ,json:{write:!0,default:"butt"}})],gf.prototype,"cap",void 0),d([m(vm)],gf.prototype,"size",void 0),d([m(Eve)],gf.prototype,"pattern",void 0),d([m({types:{key:"type",base:L7,typeMap:{style:L7}},json:{write:!0}})],gf.prototype,"marker",void 0),gf=qD=d([V("esri.symbols.LineSymbol3DLayer")],gf);const gR=gf;var D7;const Eje=Ul()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let iA=D7=class extends We{clone(){return new D7({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:BX,write:H_}})],iA.prototype,"href",void 0),d([Rt(Eje)],iA.prototype,"primitive",void 0),iA=D7=d([V("esri.symbols.support.ObjectSymbol3DLayerResource")],iA);const Nve="sphere";var N7;let pb=N7=class extends Me{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new N7({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],pb.prototype,"x",void 0),d([m({type:Number})],pb.prototype,"y",void 0),d([m({type:Number})],pb.prototype,"z",void 0),pb=N7=d([V("esri.symbols.support.Symbol3DAnchorPosition3D")],pb);var F7;let $a=F7=class extends Mm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,r;return new F7({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(r=this.resource)==null?void 0:r.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([m({type:vu,json:{write:!0}})],$a.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],$a.prototype,"castShadows",void 0),d([m({type:iA,json:{write:!0}})],$a.prototype,"resource",void 0),d([Rt({Object:"object"},{readOnly:!0})],$a.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],$a.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],$a.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],$a.prototype,"depth",void 0),d([Rt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),m({json:{default:"origin"}})],$a.prototype,"anchor",void 0),d([m({type:pb,json:{type:[Number],read:{reader:t=>new pb({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],$a.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],$a.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],$a.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],$a.prototype,"roll",void 0),d([m({readOnly:!0})],$a.prototype,"isPrimitive",null),$a=F7=d([V("esri.symbols.ObjectSymbol3DLayer")],$a);const oZ=$a;var k7;let fl=k7=class extends Mm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new k7({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([m({type:vu,json:{write:!0}})],fl.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],fl.prototype,"castShadows",void 0),d([Rt({Path:"path"},{readOnly:!0})],fl.prototype,"type",void 0),d([m({type:["circle","quad"],json:{write:!0,default:"circle"}})],fl.prototype,"profile",void 0),d([m({type:Rve,json:{write:!0,default:"miter"}})],fl.prototype,"join",void 0),d([m({type:fje,json:{write:!0,default:"butt"}})],fl.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],fl.prototype,"width",void 0),d([Tr("width",["width","size","height"])],fl.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],fl.prototype,"height",void 0),d([Tr("height",["height","size","width"])],fl.prototype,"readHeight",null),d([m({type:["center","bottom","top"],json:{write:!0,default:"center"}})],fl.prototype,"anchor",void 0),d([m({type:["heading","all"],json:{write:!0,default:"all"}})],fl.prototype,"profileRotation",void 0),fl=k7=d([V("esri.symbols.PathSymbol3DLayer")],fl);const aZ=fl;var U7;let TT=U7=class extends We{constructor(){super(...arguments),this.color=new Fe([0,0,0,1]),this.size=0}clone(){const t={color:ge(this.color),size:this.size};return new U7(t)}};d([m(v0)],TT.prototype,"color",void 0),d([m(vm)],TT.prototype,"size",void 0),TT=U7=d([V("esri.symbols.support.Symbol3DHalo")],TT);let XP=class extends Au(We){constructor(e){super(e),this.color=null}};d([m(v0)],XP.prototype,"color",void 0),XP=d([V("esri.symbols.support.Symbol3DTextBackground")],XP);var WD;let Zl=WD=class extends Mm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new WD({enabled:this.enabled,font:this.font&&ge(this.font),halo:this.halo&&ge(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ge(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new WD({font:t.font!=null?t.font.clone():new mR,halo:Cje(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new vu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new XP({color:t.backgroundColor.clone()}):null})}};function Cje(t,e){return t&&e!=null&&e>0?new TT({color:ge(t),size:e}):null}d([m({type:mR,json:{write:!0}})],Zl.prototype,"font",null),d([lr("font")],Zl.prototype,"writeFont",null),d([m({type:TT,json:{write:!0}})],Zl.prototype,"halo",void 0),d([m({...Ive,json:{default:"center",write:!0}})],Zl.prototype,"horizontalAlignment",void 0),d([m({...$ve,json:{default:1,write:!0}})],Zl.prototype,"lineHeight",void 0),d([m({type:vu,json:{write:!0}})],Zl.prototype,"material",void 0),d([m({type:XP,json:{write:!0}})],Zl.prototype,"background",void 0),d([m(vm)],Zl.prototype,"size",null),d([m({type:String,json:{write:!0}})],Zl.prototype,"text",void 0),d([Rt({Text:"text"},{readOnly:!0})],Zl.prototype,"type",void 0),d([m({...Lve,json:{default:"baseline",write:!0}})],Zl.prototype,"verticalAlignment",void 0),Zl=WD=d([V("esri.symbols.TextSymbol3DLayer")],Zl);const ax=Zl;var z7;let Py=z7=class extends Mm{constructor(t){super(t),this.color=B7.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new z7({color:ge(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([m({type:Fe,nonNullable:!0,json:{type:[an],write:(t,e,r)=>e[r]=t.toArray(Fe.AlphaMode.UNLESS_OPAQUE),default:()=>B7.clone(),defaultEquals:t=>t.toCss(!0)===B7.toCss(!0)}})],Py.prototype,"color",void 0),d([Rt({Water:"water"},{readOnly:!0})],Py.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Py.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],Py.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Py.prototype,"waveStrength",void 0),Py=z7=d([V("esri.symbols.WaterSymbol3DLayer")],Py);const B7=new Fe([0,119,190]),Fve=Py;var V7;let Iv=V7=class extends Me{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new V7({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],Iv.prototype,"name",void 0),d([m({type:String})],Iv.prototype,"styleUrl",void 0),d([m({type:String})],Iv.prototype,"styleName",void 0),d([m({type:kl})],Iv.prototype,"portal",void 0),Iv=V7=d([V("esri.symbols.support.StyleOrigin")],Iv);const oO=Iv;var G7;let rw=G7=class extends Me{constructor(){super(...arguments),this.url=""}clone(){return new G7({url:this.url})}};d([m({type:String})],rw.prototype,"url",void 0),rw=G7=d([V("esri.symbols.support.Thumbnail")],rw);const kve={icon:m_,object:oZ,line:gR,path:aZ,fill:fR,extrude:eZ,text:ax,water:Fve},Aje=Mt.ofType({base:Mm,key:"type",typeMap:kve,errorContext:"symbol-layer"});let yf=class extends Pu{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,i=r==null?void 0:r.type,s=i||Mt;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&ae.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Ow(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=Dw(e.styleUrl,i);return new oO({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new oO({portal:(i==null?void 0:i.portal)||kl.getDefault(),styleName:e.styleName,name:e.name});i!=null&&i.messages&&i.messages.push(new vw("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=nE(e.styleUrl,s);Rl(n)&&(n=mu(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&(s!=null&&s.portal)&&!nme(e.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new vw("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Mm||e&&kve[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],yf.prototype,"color",null),d([m({type:Aje,nonNullable:!0,json:{write:!0}}),zi(M0e)],yf.prototype,"symbolLayers",null),d([m({type:oO})],yf.prototype,"styleOrigin",void 0),d([Tr("styleOrigin")],yf.prototype,"readStyleOrigin",null),d([lr("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],yf.prototype,"writeStyleOrigin",null),d([m({type:rw,json:{read:!1}})],yf.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],yf.prototype,"type",void 0),yf=d([V("esri.symbols.Symbol3D")],yf);const QE=yf;let sA=class extends We{constructor(e){super(e),this.visible=!0}clone(){}};d([m({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],sA.prototype,"type",void 0),d([m({readOnly:!0})],sA.prototype,"visible",void 0),sA=d([V("esri.symbols.callouts.Callout3D")],sA);const Uve=sA;var j7;let YD=j7=class extends We{constructor(t){super(t),this.color=new Fe("white")}clone(){return new j7({color:ge(this.color)})}};d([m(v0)],YD.prototype,"color",void 0),YD=j7=d([V("esri.symbols.callouts.LineCallout3DBorder")],YD);const Pje=YD;var H7;let My=H7=class extends Uve{constructor(t){super(t),this.type="line",this.color=new Fe([0,0,0,1]),this.size=Ka(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new H7({color:ge(this.color),size:this.size,border:ge(this.border)})}};d([Rt({line:"line"})],My.prototype,"type",void 0),d([m(v0)],My.prototype,"color",void 0),d([m(vm)],My.prototype,"size",void 0),d([m({type:Pje,json:{write:!0}})],My.prototype,"border",void 0),d([m({readOnly:!0})],My.prototype,"visible",null),My=H7=d([V("esri.symbols.callouts.LineCallout3D")],My);const zve=My;function lZ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Bve(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!lZ(t)}function cZ(t){return t.type==="point-3d"||t.type==="label-3d"}function Vve(t){return t.horizontalAlignment==="center"}const Gve={types:{key:"type",base:Uve,typeMap:{line:zve}},json:{write:!0}};var q7;let z2=q7=class extends We{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new q7({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m(vm)],z2.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],z2.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],z2.prototype,"maxWorldLength",void 0),z2=q7=d([V("esri.symbols.support.Symbol3DVerticalOffset")],z2);const uZ=z2;var XD;const jve=Mt.ofType({base:null,key:"type",typeMap:{text:ax}});let Oy=XD=class extends QE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new jve,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Bve(this)}hasVisibleVerticalOffset(){return lZ(this)}clone(){return new XD({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail),callout:ge(this.callout),verticalOffset:ge(this.verticalOffset)})}static fromTextSymbol(t){return new XD({symbolLayers:new Mt([ax.fromTextSymbol(t)])})}};d([m({type:uZ,json:{write:!0}})],Oy.prototype,"verticalOffset",void 0),d([m(Gve)],Oy.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],Oy.prototype,"styleOrigin",void 0),d([m({type:jve})],Oy.prototype,"symbolLayers",void 0),d([Rt({LabelSymbol3D:"label-3d"},{readOnly:!0})],Oy.prototype,"type",void 0),Oy=XD=d([V("esri.symbols.LabelSymbol3D")],Oy);const wk=Oy;var ZD;const Hve=Mt.ofType({base:null,key:"type",typeMap:{line:gR,path:aZ}}),Mje=Mt.ofType({base:null,key:"type",typeMap:{line:gR,path:aZ}});let nA=ZD=class extends QE{constructor(t){super(t),this.symbolLayers=new Hve,this.type="line-3d"}clone(){return new ZD({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromSimpleLineSymbol(t){return new ZD({symbolLayers:new Mt([gR.fromSimpleLineSymbol(t)])})}};d([m({type:Hve,json:{type:Mje}})],nA.prototype,"symbolLayers",void 0),d([Rt({LineSymbol3D:"line-3d"},{readOnly:!0})],nA.prototype,"type",void 0),nA=ZD=d([V("esri.symbols.LineSymbol3D")],nA);const xk=nA;let Ry=class extends Pu{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Ry.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],Ry.prototype,"type",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Ry.prototype,"xoffset",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Ry.prototype,"yoffset",void 0),d([m({type:Number,cast:t=>t==="auto"?t:Js(t),json:{write:!0}})],Ry.prototype,"size",void 0),Ry=d([V("esri.symbols.MarkerSymbol")],Ry);const qve=Ry;var JD;const Wve=Mt.ofType({base:null,key:"type",typeMap:{fill:fR}});let oA=JD=class extends QE{constructor(t){super(t),this.symbolLayers=new Wve,this.type="mesh-3d"}clone(){return new JD({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromSimpleFillSymbol(t){return new JD({symbolLayers:new Mt([fR.fromSimpleFillSymbol(t)])})}};d([m({type:Wve})],oA.prototype,"symbolLayers",void 0),d([Rt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],oA.prototype,"type",void 0),oA=JD=d([V("esri.symbols.MeshSymbol3D")],oA);const Tk=oA;function Oje(t,e,r){return e.imageData?ame({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):Yve(e.url,r)}function Yve(t,e){if(!Rl(t)){const r=$je(e);if(r)return Tw(r,"images",t)}return Dw(t,e)}function Rje(t,e,r,i){if(Cm(t)){const s=D_(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&H_(r.url,e,"url",i)}else H_(t,e,"url",i)}const Xve={json:{read:{source:["imageData","url"],reader:Oje},write:{writer(t,e,r,i){Rje(t,e,this.source,i)}}}},Zve={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=Yve(e.url,r)),i}}}};function $je(t){var s,n;if(!t)return null;const{origin:e,layer:r}=t;if(e!=="service"&&e!=="portal-item")return null;const i=r==null?void 0:r.type;return i==="feature"||i==="stream"?(s=r.parsedUrl)==null?void 0:s.path:i==="map-image"||i==="tile"?(n=t.url)==null?void 0:n.path:null}var W7;let Hu=W7=class extends wve{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=Js(r)),i!=null&&(s.height=Js(i)),s}clone(){const t=new W7({color:ge(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ge(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([Rt({esriPFS:"picture-fill"},{readOnly:!0})],Hu.prototype,"type",void 0),d([m(Xve)],Hu.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],Hu.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],Hu.prototype,"yscale",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Hu.prototype,"width",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Hu.prototype,"height",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Hu.prototype,"xoffset",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Hu.prototype,"yoffset",void 0),d([m(Zve)],Hu.prototype,"source",void 0),Hu=W7=d([V("esri.symbols.PictureFillSymbol")],Hu);const Jve=Hu;var Y7;let wd=Y7=class extends qve{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Js(e)),r!=null&&(i.height=Js(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new Y7({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ge(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],wd.prototype,"color",void 0),d([Rt({esriPMS:"picture-marker"},{readOnly:!0})],wd.prototype,"type",void 0),d([m(Xve)],wd.prototype,"url",void 0),d([m(Zve)],wd.prototype,"source",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],wd.prototype,"height",void 0),d([Tr("height",["height","size"])],wd.prototype,"readHeight",null),d([m({type:Number,cast:Js,json:{write:!0}})],wd.prototype,"width",void 0),d([m({json:{write:!1}})],wd.prototype,"size",void 0),wd=Y7=d([V("esri.symbols.PictureMarkerSymbol")],wd);const Sk=wd;var Lv;const Kve=Mt.ofType({base:null,key:"type",typeMap:{icon:m_,object:oZ,text:ax}});let Dv=Lv=class extends QE{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Kve,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Bve(this)}hasVisibleVerticalOffset(){return lZ(this)}clone(){return new Lv({verticalOffset:ge(this.verticalOffset),callout:ge(this.callout),styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Lv({symbolLayers:new Mt([m_.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Lv({symbolLayers:new Mt([m_.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var i,s;if(((s=(i=t.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Lv(r!=null&&r.callout?{symbolLayers:new Mt([m_.fromCIMSymbol(t)]),callout:new zve({size:.5,color:new Fe([0,0,0])}),verticalOffset:new uZ({screenLength:40})}:{symbolLayers:new Mt([m_.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Lv({symbolLayers:new Mt([ax.fromTextSymbol(t)])})}};d([m({type:uZ,json:{write:!0}})],Dv.prototype,"verticalOffset",void 0),d([m(Gve)],Dv.prototype,"callout",void 0),d([m({type:Kve,json:{origins:{"web-scene":{write:!0}}}})],Dv.prototype,"symbolLayers",void 0),d([Rt({PointSymbol3D:"point-3d"},{readOnly:!0})],Dv.prototype,"type",void 0),Dv=Lv=d([V("esri.symbols.PointSymbol3D")],Dv);const g_=Dv;var aA;const Qve=Mt.ofType({base:null,key:"type",typeMap:{extrude:eZ,fill:fR,icon:m_,line:gR,object:oZ,text:ax,water:Fve}});let lA=aA=class extends QE{constructor(t){super(t),this.symbolLayers=new Qve,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&$_(ae.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&$_(ae.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Ho(()=>this.symbolLayers,"after-add",({item:e})=>t(e),ti))}clone(){return new aA({styleOrigin:ge(this.styleOrigin),symbolLayers:ge(this.symbolLayers),thumbnail:ge(this.thumbnail)})}static fromJSON(t){var r;const e=new aA;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),s=e.symbolLayers.at(1);!s.enabled||(r=t.symbolLayers)!=null&&r[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:s.size,color:s.material!=null?s.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new aA({symbolLayers:new Mt([fR.fromSimpleFillSymbol(t)])})}};d([m({type:Qve,json:{write:!0}})],lA.prototype,"symbolLayers",void 0),d([Rt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],lA.prototype,"type",void 0),lA=aA=d([V("esri.symbols.PolygonSymbol3D")],lA);const yR=lA;var X7;const IU=new Yo({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Nv=X7=class extends wve{constructor(...t){super(...t),this.color=new Fe([0,0,0,.25]),this.outline=new b0,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new X7({color:ge(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],Nv.prototype,"color",void 0),d([m()],Nv.prototype,"outline",void 0),d([Rt({esriSFS:"simple-fill"},{readOnly:!0})],Nv.prototype,"type",void 0),d([m({type:IU.apiValues,json:{read:IU.read,write:IU.write}})],Nv.prototype,"style",void 0),Nv=X7=d([V("esri.symbols.SimpleFillSymbol")],Nv);const _R=Nv;var Z7;const LU=new Yo({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let _f=Z7=class extends qve{constructor(...t){super(...t),this.color=new Fe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new b0}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Js(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new Z7({angle:this.angle,color:ge(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};d([m()],_f.prototype,"color",void 0),d([lr("color")],_f.prototype,"writeColor",null),d([Rt({esriSMS:"simple-marker"},{readOnly:!0})],_f.prototype,"type",void 0),d([m()],_f.prototype,"size",void 0),d([m({type:LU.apiValues,json:{read:LU.read,write:LU.write}})],_f.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],_f.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":b0}},json:{default:null,write:!0}})],_f.prototype,"outline",void 0),_f=Z7=d([V("esri.symbols.SimpleMarkerSymbol")],_f);const eC=_f;var J7;let Ls=J7=class extends Pu{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new mR,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Js(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new J7({angle:this.angle,backgroundColor:ge(this.backgroundColor),borderLineColor:ge(this.borderLineColor),borderLineSize:this.borderLineSize,color:ge(this.color),font:this.font&&this.font.clone(),haloColor:ge(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,r;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(r=this.haloColor)==null?void 0:r.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:Fe,json:{write:!0}})],Ls.prototype,"backgroundColor",void 0),d([m({type:Fe,json:{write:!0}})],Ls.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:Js})],Ls.prototype,"borderLineSize",void 0),d([m({type:mR,json:{write:!0}})],Ls.prototype,"font",void 0),d([m({...Ive,json:{write:!0}})],Ls.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],Ls.prototype,"kerning",void 0),d([m({type:Fe,json:{write:!0}})],Ls.prototype,"haloColor",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Ls.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],Ls.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],Ls.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],Ls.prototype,"text",void 0),d([Rt({esriTS:"text"},{readOnly:!0})],Ls.prototype,"type",void 0),d([m({...Lve,json:{write:!0}})],Ls.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Ls.prototype,"xoffset",void 0),d([m({type:Number,cast:Js,json:{write:!0}})],Ls.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Ls.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],Ls.prototype,"width",void 0),d([m({type:Number})],Ls.prototype,"lineWidth",void 0),d([lr("lineWidth")],Ls.prototype,"writeLineWidth",null),d([zi("lineWidth")],Ls.prototype,"castLineWidth",null),d([m($ve)],Ls.prototype,"lineHeight",void 0),d([lr("lineHeight")],Ls.prototype,"writeLineHeight",null),Ls=J7=d([V("esri.symbols.TextSymbol")],Ls);const tC=Ls;var K7;let xd=K7=class extends Pu{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:kl.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new K7({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await me(()=>Promise.resolve().then(()=>Tpt),void 0);vt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{ae.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};d([m({json:{write:!1}})],xd.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],xd.prototype,"styleName",void 0),d([m({type:kl,json:{write:!1}})],xd.prototype,"portal",void 0),d([m({type:String,json:{read:BX,write:H_}})],xd.prototype,"styleUrl",void 0),d([m({type:rw,json:{read:!1}})],xd.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],xd.prototype,"name",void 0),d([Rt({styleSymbolReference:"web-style"},{readOnly:!0})],xd.prototype,"type",void 0),d([m()],xd.prototype,"_fetchCacheKey",null),xd=K7=d([V("esri.symbols.WebStyleSymbol")],xd);const rC=xd;function Ek(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Fw(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const hZ={base:Pu,key:"type",typeMap:{"simple-fill":_R,"picture-fill":Jve,"picture-marker":Sk,"simple-line":b0,"simple-marker":eC,text:tC,"label-3d":wk,"line-3d":xk,"mesh-3d":Tk,"point-3d":g_,"polygon-3d":yR,"web-style":rC,cim:vk},errorContext:"symbol"},T$t={base:Pu,key:"type",typeMap:{"picture-marker":Sk,"simple-marker":eC,text:tC,"web-style":rC,cim:vk},errorContext:"symbol"},Ije=rY({types:hZ}),S$t={base:Pu,key:"type",typeMap:{"simple-fill":_R,"picture-fill":Jve,"picture-marker":Sk,"simple-line":b0,"simple-marker":eC,text:tC,"line-3d":xk,"mesh-3d":Tk,"point-3d":g_,"polygon-3d":yR,"web-style":rC,cim:vk},errorContext:"symbol"},E$t={base:Pu,key:"type",typeMap:{text:tC,"label-3d":wk},errorContext:"symbol"},C$t={base:Pu,key:"type",typeMap:{"line-3d":xk,"mesh-3d":Tk,"point-3d":g_,"polygon-3d":yR,"web-style":rC,cim:vk},errorContext:"symbol"},A$t={base:Pu,key:"type",typeMap:{"label-3d":wk},errorContext:"symbol"},P$t=gm(hZ);var Q7;function Lje(t){if(!t)return null;const e={};for(const r in t){const i=Mw(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function Dje(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let ml=Q7=class extends Au(We){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:fu(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new Q7({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const r of[e,this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(t&&"defaultPopupTemplate"in r&&r.defaultPopupTemplate!=null)return r.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:Dje(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:LV(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};d([m({value:null,json:{read:Lje}})],ml.prototype,"aggregateGeometries",null),d([m({value:null})],ml.prototype,"attributes",null),d([m({value:null,types:O6,json:{read:Mw}})],ml.prototype,"geometry",null),d([m({type:Boolean})],ml.prototype,"isAggregate",void 0),d([m({clonable:"reference"})],ml.prototype,"layer",void 0),d([m({clonable:"reference"})],ml.prototype,"origin",void 0),d([m({type:G7e})],ml.prototype,"popupTemplate",void 0),d([m({clonable:"reference"})],ml.prototype,"sourceLayer",void 0),d([m({value:null,types:hZ})],ml.prototype,"symbol",null),d([m({type:Boolean,value:!0})],ml.prototype,"visible",null),ml=Q7=d([V("esri.Graphic")],ml),function(t){t.generateUID=fu}(ml||(ml={}));const W_=ml;let iw=class extends NP{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([cge({Type:W_,ensureType:ma(W_)})],iw.prototype,"itemType",void 0),iw=d([V("esri.support.GraphicsCollection")],iw);let $y=class extends Me{constructor(e){super(e),this.view=null,this.baseLayerViews=new Mt,this.referenceLayerViews=new Mt,this._loadingHandle=he(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},ui)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};d([m({constructOnly:!0})],$y.prototype,"view",void 0),d([m({readOnly:!0})],$y.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],$y.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],$y.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],$y.prototype,"updating",null),$y=d([V("esri.views.BasemapView")],$y);function Nje(t){return"tryRecycleWith"in t}let Fje=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Wo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,lo(this._controller.signal,()=>{const s=new J("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Nje(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(vt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>lo(this._controller.signal,()=>u(hr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let o,a;if(await r.load({signal:e}),r.prefetchResources&&await r.prefetchResources({signal:e}),Uje(r))o=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new J("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(r);vt(e),o="default"in u?new u.default({layer:r,view:i}):new u({layer:r,view:i})}const l=()=>{a=wi(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=lo(e,l),vt(e);try{await o.when()}catch(u){throw l(),u}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(r)))return l(),void this._deferred.reject(new J("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=o,r.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:r,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){r.emit("layerview-create-error",{view:i,error:o}),i.emit("layerview-create-error",{layer:r,error:o}),this.done=!0,this._deferred.reject(new J("layerview:create-error","layerview creation failed",{layer:r,error:o}))}}},qu=class extends Me{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new mp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const s of r)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Wo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(zE(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=h=>{if(h!=null){for(const p of h)if(p){i.add(p);const f=this._layerLayerViewInfoMap.get(p);f&&n?f.start():f||this._recyclingInfoMap.has(p)||s.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const h of this._rootCollectionNames)o(up(this,h));for(const[h,p]of this._layerLayerViewInfoMap)if(!i.has(h)){this._layerLayerViewInfoMap.delete(p.layer);const f=p.tryRecycle(s);f?(this.notifyChange("updating"),this._recyclingInfoMap.set(p.layer,p),f.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[h,p]of this._recyclingInfoMap)i.has(h)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy());for(const h of s)this._createLayerView(h);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(h=>!!h);i.forEach(h=>"layers"in h&&a.push(h.layers)),this.addHandles(a.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Ho(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),he(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),si)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),CU(this._recyclingInfoMap),CU(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(hr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||vh(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(CU(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new J("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(up(this,e),up(this,r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new Fje(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(ns(i)||i.name==="cancelled:layerview-create")||ae.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],qu.prototype,"_workPromise",void 0),d([m({readOnly:!0})],qu.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],qu.prototype,"_layersToLayerViews",null),d([m({readOnly:!0})],qu.prototype,"_rootCollectionNames",null),d([m()],qu.prototype,"layerViewImporter",void 0),d([m()],qu.prototype,"supportsGround",void 0),d([m({readOnly:!0})],qu.prototype,"updating",null),d([m({readOnly:!0})],qu.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],qu.prototype,"view",void 0),qu=d([V("esri.views.LayerViewManager")],qu);const kje=qu;function Uje(t){return"createLayerView"in t&&t.createLayerView!=null}let Hc=class extends Me{constructor(e){super(e),this.factor=1.5,this.offset=Lh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],Hc.prototype,"factor",void 0),d([m({nonNullable:!0})],Hc.prototype,"offset",void 0),d([m()],Hc.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],Hc.prototype,"size",void 0),d([m()],Hc.prototype,"maskUrl",void 0),d([m()],Hc.prototype,"maskEnabled",void 0),d([m()],Hc.prototype,"overlayUrl",void 0),d([m()],Hc.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],Hc.prototype,"version",null),d([m({type:Boolean})],Hc.prototype,"visible",void 0),Hc=d([V("esri.views.Magnifier")],Hc);const ebe=Hc;let KD=class{constructor(e){this._observable=new tR,this._map=new Map(e)}get size(){return Ot(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const r=this._map.delete(e);return r&&this._observable.notify(),r}entries(){return Ot(this._observable),this._map.entries()}forEach(e,r){Ot(this._observable),this._map.forEach((i,s)=>e.call(r,i,s,this),r)}get(e){return Ot(this._observable),this._map.get(e)}has(e){return Ot(this._observable),this._map.has(e)}keys(){return Ot(this._observable),this._map.keys()}set(e,r){return this._map.set(e,r),this._observable.notify(),this}values(){return Ot(this._observable),this._map.values()}[Symbol.iterator](){return Ot(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var ej;let cA=ej=class extends We{constructor(t){super(t),this.name=null,this.code=null}clone(){return new ej({name:this.name,code:this.code})}};d([m({type:String,json:{write:!0}})],cA.prototype,"name",void 0),d([m({type:[String,Number],json:{write:!0}})],cA.prototype,"code",void 0),cA=ej=d([V("esri.layers.support.CodedValue")],cA);const zje=new Yo({inherited:"inherited",codedValue:"coded-value",range:"range"});let uA=class extends We{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],uA.prototype,"name",void 0),d([Rt(zje)],uA.prototype,"type",void 0),uA=d([V("esri.layers.support.Domain")],uA);const Ck=uA;var tj;let hA=tj=class extends Ck{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new tj({codedValues:ge(this.codedValues),name:this.name})}};d([m({type:[cA],json:{write:!0}})],hA.prototype,"codedValues",void 0),d([Rt({codedValue:"coded-value"})],hA.prototype,"type",void 0),hA=tj=d([V("esri.layers.support.CodedValueDomain")],hA);const tbe=hA;var rj;let QD=rj=class extends Ck{constructor(t){super(t),this.type="inherited"}clone(){return new rj}};d([Rt({inherited:"inherited"})],QD.prototype,"type",void 0),QD=rj=d([V("esri.layers.support.InheritedDomain")],QD);const rbe=QD;var ij;let B2=ij=class extends Ck{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new ij({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],B2.prototype,"maxValue",void 0),d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[0]}},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],B2.prototype,"minValue",void 0),d([Rt({range:"range"})],B2.prototype,"type",void 0),B2=ij=d([V("esri.layers.support.RangeDomain")],B2);const ibe=B2,Bje={key:"type",base:Ck,typeMap:{range:ibe,"coded-value":tbe,inherited:rbe}};function Vje(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return ibe.fromJSON(t);case"codedValue":return tbe.fromJSON(t);case"inherited":return rbe.fromJSON(t)}return null}const Gje=new Yo({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var sj;const jje=new Yo({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ia=sj=class extends We{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?jje.fromJSON(r.fieldValueType):null}clone(){var t;return new sj({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([m({type:String,json:{write:!0}})],Ia.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],Ia.prototype,"defaultValue",void 0),d([m()],Ia.prototype,"description",void 0),d([Tr("description")],Ia.prototype,"readDescription",null),d([m({types:Bje,json:{read:{reader:Vje},write:!0}})],Ia.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],Ia.prototype,"editable",void 0),d([m({type:an,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Ia.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],Ia.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],Ia.prototype,"nullable",void 0),d([Rt(Gje)],Ia.prototype,"type",void 0),d([m()],Ia.prototype,"valueType",void 0),d([Tr("valueType",["description"])],Ia.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],Ia.prototype,"visible",void 0),Ia=sj=d([V("esri.layers.support.Field")],Ia);const sbe=Ia;var nj;let V2=nj=class extends We{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new nj({mapLayerId:t,gdbVersion:e})}};d([Rt({mapLayer:"map-layer"})],V2.prototype,"type",void 0),d([m({type:an,json:{write:!0}})],V2.prototype,"mapLayerId",void 0),d([m({type:String,json:{write:!0}})],V2.prototype,"gdbVersion",void 0),V2=nj=d([V("esri.layers.support.source.MapLayerSource")],V2);var oj;let dg=oj=class extends We{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:s};return new oj(n)}};d([Rt({queryTable:"query-table"})],dg.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],dg.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],dg.prototype,"query",void 0),d([m({type:String,json:{write:!0}})],dg.prototype,"oidFields",void 0),d([m({type:Xe,json:{write:!0}})],dg.prototype,"spatialReference",void 0),d([Rt(age)],dg.prototype,"geometryType",void 0),dg=oj=d([V("esri.layers.support.source.QueryTableDataSource")],dg);var aj;let G2=aj=class extends We{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new aj({workspaceId:t,dataSourceName:e})}};d([Rt({raster:"raster"})],G2.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],G2.prototype,"dataSourceName",void 0),d([m({type:String,json:{write:!0}})],G2.prototype,"workspaceId",void 0),G2=aj=d([V("esri.layers.support.source.RasterDataSource")],G2);var lj;let Fv=lj=class extends We{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new lj({workspaceId:t,gdbVersion:e,dataSourceName:r})}};d([Rt({table:"table"})],Fv.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Fv.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],Fv.prototype,"gdbVersion",void 0),d([m({type:String,json:{write:!0}})],Fv.prototype,"dataSourceName",void 0),Fv=lj=d([V("esri.layers.support.source.TableDataSource")],Fv);var cj,uj;const Hje=Ul()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let qc=cj=class extends We{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return oie()(t,e,r)}castLeftTableSource(t){return gm(hj(),t)}readRightTableSource(t,e,r){return oie()(t,e,r)}castRightTableSource(t){return gm(hj(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:s};return new cj(n)}};d([Rt({joinTable:"join-table"})],qc.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],qc.prototype,"leftTableKey",void 0),d([m({type:String,json:{write:!0}})],qc.prototype,"rightTableKey",void 0),d([m({json:{write:!0}})],qc.prototype,"leftTableSource",void 0),d([Tr("leftTableSource")],qc.prototype,"readLeftTableSource",null),d([zi("leftTableSource")],qc.prototype,"castLeftTableSource",null),d([m({json:{write:!0}})],qc.prototype,"rightTableSource",void 0),d([Tr("rightTableSource")],qc.prototype,"readRightTableSource",null),d([zi("rightTableSource")],qc.prototype,"castRightTableSource",null),d([Rt(Hje)],qc.prototype,"joinType",void 0),qc=cj=d([V("esri.layers.support.source.JoinTableDataSource")],qc);let DU=null;function oie(){return DU||(DU=rY({types:hj()})),DU}let NU=null;function hj(){return NU||(NU={key:"type",base:null,typeMap:{"data-layer":Sg,"map-layer":V2}}),NU}const qje={key:"type",base:null,typeMap:{"join-table":qc,"query-table":dg,raster:G2,table:Fv}};let Sg=uj=class extends We{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new uj({fields:t,dataSource:e})}};d([Rt({dataLayer:"data-layer"})],Sg.prototype,"type",void 0),d([m({type:[sbe],json:{write:!0}})],Sg.prototype,"fields",void 0),d([m({types:qje,json:{write:!0}})],Sg.prototype,"dataSource",void 0),Sg=uj=d([V("esri.layers.support.source.DataLayerSource")],Sg),Sg.from=ma(Sg);let kv=class extends Au(We){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([m({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],kv.prototype,"onFields",void 0),d([m({type:String,json:{write:!0}})],kv.prototype,"operator",void 0),d([m({type:String,json:{write:!0}})],kv.prototype,"searchTerm",void 0),d([m({type:String,json:{write:!0}})],kv.prototype,"searchType",void 0),kv=d([V("esri.rest.support.FullTextSearch")],kv);const Wje=kv;var dj;const aie=new Yo({upperLeft:"upper-left",lowerLeft:"lower-left"});let Uv=dj=class extends We{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new dj(ge({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([m({type:$r,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Uv.prototype,"extent",void 0),d([m({type:["view","edit"],json:{write:!0}})],Uv.prototype,"mode",void 0),d([m({type:String,json:{read:aie.read,write:aie.write}})],Uv.prototype,"originPosition",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Uv.prototype,"tolerance",void 0),Uv=dj=d([V("esri.rest.support.QuantizationParameters")],Uv);const Yje=Uv,Xje=new Yo({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var pj;const lie=new Yo({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Td=pj=class extends We{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ge(t))}clone(){return new pj({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ge(this.statisticParameters)})}};d([m({type:Number,json:{write:!0}})],Td.prototype,"maxPointCount",void 0),d([m({type:Number,json:{write:!0}})],Td.prototype,"maxRecordCount",void 0),d([m({type:Number,json:{write:!0}})],Td.prototype,"maxVertexCount",void 0),d([m({type:String,json:{write:!0}})],Td.prototype,"onStatisticField",void 0),d([m({type:String,json:{write:!0}})],Td.prototype,"outStatisticFieldName",void 0),d([m({type:String,json:{read:{source:"statisticType",reader:lie.read},write:{target:"statisticType",writer:lie.write}}})],Td.prototype,"statisticType",void 0),d([m({type:Object})],Td.prototype,"statisticParameters",void 0),d([lr("statisticParameters")],Td.prototype,"writeStatisticParameters",null),Td=pj=d([V("esri.rest.support.StatisticDefinition")],Td);const Zje=Td;var eN;const Jje=new Yo({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $t=eN=class extends We{static from(t){return _w(eN,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new eN(ge({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};$t.MAX_MAX_RECORD_COUNT_FACTOR=5,d([m({json:{write:!0}})],$t.prototype,"aggregateIds",void 0),d([m({type:Boolean,json:{write:!0}})],$t.prototype,"cacheHint",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"compactGeometryEnabled",void 0),d([m({json:{write:!0}})],$t.prototype,"datumTransformation",void 0),d([zi("datumTransformation")],$t.prototype,"castDatumTransformation",null),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"defaultSpatialReferenceEnabled",void 0),d([m({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],$t.prototype,"distance",void 0),d([m({type:Sg,json:{write:!0}})],$t.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],$t.prototype,"formatOf3DObjects",void 0),d([m({type:[Wje],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],$t.prototype,"fullText",void 0),d([m({type:String,json:{write:!0}})],$t.prototype,"gdbVersion",void 0),d([m({types:O6,json:{read:Mw,write:!0}})],$t.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],$t.prototype,"geometryPrecision",void 0),d([m({type:[String],json:{write:!0}})],$t.prototype,"groupByFieldsForStatistics",void 0),d([m({type:String,json:{write:!0}})],$t.prototype,"having",void 0),d([m({type:Date})],$t.prototype,"historicMoment",void 0),d([lr("historicMoment")],$t.prototype,"writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],$t.prototype,"maxAllowableOffset",void 0),d([m({type:Number,cast:t=>t<1?1:t>$t.MAX_MAX_RECORD_COUNT_FACTOR?$t.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],$t.prototype,"maxRecordCountFactor",void 0),d([m({type:["xyFootprint"],json:{write:!0}})],$t.prototype,"multipatchOption",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],$t.prototype,"num",void 0),d([m({json:{write:!0}})],$t.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],$t.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],$t.prototype,"outFields",void 0),d([m({type:Xe,json:{name:"outSR",write:!0}})],$t.prototype,"outSpatialReference",void 0),d([m({type:[Zje],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],$t.prototype,"outStatistics",void 0),d([m({json:{write:!0}})],$t.prototype,"parameterValues",void 0),d([lr("parameterValues")],$t.prototype,"writeParameterValues",null),d([m({type:Ke,json:{write:!0}})],$t.prototype,"pixelSize",void 0),d([m({type:Yje,json:{write:!0}})],$t.prototype,"quantizationParameters",void 0),d([m({type:[Object],json:{write:!0}})],$t.prototype,"rangeValues",void 0),d([m({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],$t.prototype,"relationParameter",void 0),d([m({type:String,json:{write:!0}})],$t.prototype,"resultType",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnCentroid",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnDistinctValues",void 0),d([m({type:Boolean,json:{default:!0,write:!0}})],$t.prototype,"returnExceededLimitFeatures",void 0),d([m({type:Boolean,json:{write:!0}})],$t.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnQueryGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$t.prototype,"returnZ",void 0),d([m({type:Xe,json:{write:!0}})],$t.prototype,"sourceSpatialReference",void 0),d([Rt(Xje,{ignoreUnknown:!1,name:"spatialRel"})],$t.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],$t.prototype,"start",void 0),d([lr("start"),lr("num")],$t.prototype,"writeStart",null),d([m({type:String,json:{write:!0}})],$t.prototype,"sqlFormat",void 0),d([m({type:String,json:{write:!0}})],$t.prototype,"text",void 0),d([m({type:pR,json:{write:!0}})],$t.prototype,"timeExtent",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"timeReferenceUnknownClient",void 0),d([Rt(Jje,{ignoreUnknown:!1}),m({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],$t.prototype,"units",void 0),d([m({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],$t.prototype,"where",void 0),d([lr("where")],$t.prototype,"writeWhere",null),$t=eN=d([V("esri.rest.support.Query")],$t);const cie=$t;let pg=class extends Gs.EventedAccessor{constructor(e){super(e),this._selectionMap=new KD,this._trashCan=[],this._layerEditHandles=new Mt,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([he(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Ho(()=>this.sources,"change",r=>{const i=this._selectionMap;for(const s of r.removed)i.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new Mt;this.view.when().then(()=>{this.view.map.allLayers.flatten(r=>"sublayers"in r&&r.sublayers?r.sublayers:null).forEach(r=>{(q$(r)&&!SUe(r)||Tx(r))&&e.add(r)}),this._set("sources",e)})}destroy(){this._layerEditHandles.drain(wi)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[r,i]=e;return{layer:r,selection:[...i.selection]}})}get count(){let e=0;for(const r of this._selectionMap.values())e+=r.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._get("sources")}set sources(e){this._set("sources",e)}async getSelectedFeatures(e,r={},i="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=Tx(l)?l.parent:l;if(u==null||!uie(u))return null;if(i==="layer")return hie(u,c,r);const h=await s.whenLayerView(u);return hie(h,c,r)});return(await Promise.all(o)).filter(a=>a!==null)}updateSelection(e){const r=new Map;for(const[n,o]of this._selectionMap)r.set(n,[...o.selection]);let i=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(q$(o)||Tx(o))&&a!==null){const l=f6(r,o,()=>[]);l.includes(a)||(l.push(a),i=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(q$(o)||Tx(o))&&a!==null){const l=r.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),i=!0)}}if(i){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of r){const u=n.get(l);u!==void 0&&o.push(u),n.set(l,{selection:c}),a.push({layer:l,selection:c,...uV(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,r){this._setSelection(e,r)}getSelection(e){const r=this._selectionMap.get(e);return r==null?void 0:r.selection}appendToSelection(e,r){const i=this._selectionMap.get(e),s=i!==void 0?[...i.selection]:[];for(const n of r)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,r){const i=this._selectionMap.get(e);if(!i)return;const s=[];for(const n of i.selection)r.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,r){const i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,r);const s=new Set(i.selection),n=new Set(r),o=qIe(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const r=[];for(const[i,s]of this._selectionMap.entries())r.push({layer:i,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(r)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:r,_selectionMap:i,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const l=i.get(a),c=Tx(a)?a.parent:a;c!=null&&uie(c)&&r.whenLayerView(c).then(u=>{var h;(h=l==null?void 0:l.highlightHandle)==null||h.remove(),l!==void 0&&s&&n===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=u.highlight(l.selection,"selection"))})}}_refreshListeners(){this._layerEditHandles.drain(wi);for(const e of this.sources){const r=Tx(e)?e.parent:e;if(r!=null&&q$(r)){const i=r.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,r){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(r)){const i=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(kE);this.removeFromSelection(r,i)}}_setSelection(e,r){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const i=this._selectionMap.get(e);if(i===void 0||!Qje(i,{selection:r})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...r]});const s={layer:e,selection:[...r],...uV(i!==void 0?i.selection:[],r)};this._onSelectionChange([s])}}};d([m({readOnly:!0,nonNullable:!0})],pg.prototype,"selections",null),d([m({readOnly:!0,nonNullable:!0})],pg.prototype,"count",null),d([m({constructOnly:!0,nonNullable:!0})],pg.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],pg.prototype,"hasSelection",null),d([m()],pg.prototype,"showHighlight",void 0),d([m()],pg.prototype,"sources",null),pg=d([V("esri.views.SelectionManager")],pg);const q$=t=>t.createQuery!==void 0&&t.on!==void 0,Kje=t=>t.layer!==void 0,uie=t=>(t==null?void 0:t.when)!==void 0,Qje=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const r=[...t.selection],i=[...e.selection];if(r.length!==i.length)return!1;r.sort(),i.sort();for(let s=0;s<r.length;s++)if(r[s]!==i[s])return!1}return!0},hie=async(t,e,r={})=>{let i;if(Kje(t)){const s=t;i=s===void 0?null:await s.queryFeatures(new cie({...r,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;i=s===void 0?null:await s.queryFeatures(new cie({...r,objectIds:e})).then(n=>({data:n,layer:s}))}return i},eHe=pg;let dA=class extends Au(Me){constructor(e){super(e),this.accentColor=new Fe([255,127,0]),this.textColor=new Fe([255,255,255])}};d([m({type:Fe,nonNullable:!0})],dA.prototype,"accentColor",void 0),d([m({type:Fe,nonNullable:!0})],dA.prototype,"textColor",void 0),dA=d([V("esri.views.Theme")],dA);const fj=dA;var die;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(die||(die={}));const nbe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],obe={};function abe(t){return!!obe[t]}function tHe(t){for(const e of t)if(!abe(e))return!1;return!0}nbe.forEach(t=>{obe[t]=!0});let rHe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!tHe(n))return n.some(abe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??E_.DEFAULT;const l=this._createUniqueGroupName(),c=new iHe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const h=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Yr(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},iHe=class extends Mo{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:Lh(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Lh(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:h}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:ga(r.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:h,timestamp:p}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:u,button:n,buttons:o,native:a,timestamp:p,eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,h={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:f}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:u,origin:h,native:n,timestamp:f,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var aO,pie,fie;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(aO||(aO={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(pie||(pie={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(fie||(fie={}));function sHe(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return ae.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function mj(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(aO.USER)&&t.getEditableFlag(aO.MANAGER)}function vf(t){return Lh(t.x,t.y)}function B$t(t){return us(t.x,t.y)}function lbe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Lh(e.clientX-r.left,e.clientY-r.top):Lh(0,0)}function mie(t,e){return e instanceof Event?lbe(t,e):vf(e)}function gie(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let nHe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":yie(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!_ie(e))break;const s=vf(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!_ie(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s==null?void 0:s.manipulator,o=s==null?void 0:s.tool;if(n==null||o==null)break;const a=vf(e);a.x=we(a.x,0,r.view.width),a.y=we(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=vf(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(oHe(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:h})=>{h.selected&&(h.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i}),FU(o,i);break}case"click":{const s=vf(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n==null?void 0:n.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=vf(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),FU(o,i);break}case"immediate-double-click":{const s=vf(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),FU(o,i);break}}this._onFocusChange(r.forEachTool)}_releaseManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:vf(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(i.setActiveTool)}_handlePointerEnd(e,r){var s;const i=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:vf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(r.setActiveTool))}_cursorFromMap(e){let r=null;return vh(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=$$e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!mj(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Lh(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!yie(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(vf(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){var a;let n=this._intersect(e,i,s);const o=(a=this._hoveredManipulators.get(r))==null?void 0:a.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function yie(t){return t==="mouse"}function _ie(t){return t.pointerType!=="mouse"||t.button===0}function oHe(t){return!!t.native.shiftKey}function FU(t,e){t!=null&&t.consumesClicks&&e()}const vie="attached",kU="tools",bie=1e3;let bf=class extends Me{constructor(e){super(e),this._updatingHandles=new mp,this._clock=XO,this._manipulatorState=new nHe,this.tools=new Mt,this.cursor=null,this._interacting=!1,this._interactingTimeout=bie,this._interactingTimeoutHandle=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.addHandles([this.view.on(nbe,e=>{this._handleInputEvent(e)},E_.TOOL),...sHe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ae.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=mj(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=wi(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([he(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r)))],vie):this.addHandles(he(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(vie),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(kU),this._forEachTool(e=>{if(e instanceof Me){const r=he(()=>[e.cursor,e.visible,e.editable],()=>{mj(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(r,kU)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],kU)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,aO.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){const e=this;return{setClock:r=>this._clock=r,set interactingTimeoutEnabled(r){e._interactingTimeout=r?bie:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};d([m({constructOnly:!0,nonNullable:!0})],bf.prototype,"view",void 0),d([m({value:null})],bf.prototype,"activeTool",null),d([m({readOnly:!0,type:Mt})],bf.prototype,"tools",void 0),d([m({readOnly:!0})],bf.prototype,"cursor",void 0),d([m({readOnly:!0})],bf.prototype,"updating",null),d([m()],bf.prototype,"_interacting",void 0),d([m({readOnly:!0})],bf.prototype,"interacting",null),bf=d([V("esri.views.ToolViewManager")],bf);let j2=class extends Me{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":aHe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return lHe[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],j2.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],j2.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],j2.prototype,"axisThreshold",null),j2=d([V("esri.views.input.gamepad.GamepadInputDevice")],j2);const aHe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),lHe={standard:.15,spacemouse:.025,unknown:0},dZ=j2;let pA=class extends Me{constructor(...e){super(...e),this.devices=new Mt,this.enabledFocusMode="document"}};d([m({type:Mt.ofType(dZ),readOnly:!0})],pA.prototype,"devices",void 0),d([m({type:["document","view","none"]})],pA.prototype,"enabledFocusMode",void 0),pA=d([V("esri.views.input.gamepad.GamepadSettings")],pA);const cHe=pA;let tN=class extends Me{constructor(){super(...arguments),this.gamepad=new cHe}};d([m({readOnly:!0})],tN.prototype,"gamepad",void 0),tN=d([V("esri.views.input.Input")],tN);const uHe=tN;let Iy=class extends Me{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],Iy.prototype,"enabled",void 0),d([m({type:dZ})],Iy.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],Iy.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],Iy.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],Iy.prototype,"velocityFactor",void 0),Iy=d([V("esri.views.navigation.gamepad.GamepadSettings")],Iy);const cbe=Iy;let zv=class extends Me{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new cbe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([m({type:Boolean})],zv.prototype,"browserTouchPanEnabled",void 0),d([m({type:cbe,nonNullable:!0})],zv.prototype,"gamepad",void 0),d([m({type:Boolean})],zv.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],zv.prototype,"mouseWheelZoomEnabled",void 0),zv=d([V("esri.views.navigation.Navigation")],zv);const ube=zv,hbe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},dbe=Object.values(hbe),pbe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${dbe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),hHe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${dbe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),dHe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function X$t(t){return!!pbe.test(t)}function Ak(t){if(t==null)return null;const e=$s(t),r=(e==null?void 0:e.path.match(pbe))||(e==null?void 0:e.path.match(hHe));if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:fbe(a!==-1?s.slice(a+1):s),serverType:hbe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function pHe(t){const e=$s(t).path.match(dHe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function fbe(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function Z$t(t,e){const r=[];if(t){const i=Ak(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=fbe(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function J$t(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function fHe(t,e){return t&&b6(cme(t,e))}function K$t(t){let{url:e}=t;if(!e)return{url:e};e=cme(e,t.logger);const r=$s(e),i=Ak(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=pHe(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:b6(e),layerId:s}}function Q$t(t,e,r,i,s){H_(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=Tw(i.url,r,t.layerId.toString()))}function eIt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}function tIt(t,e,r){const i=mbe(t),s=e,n=mHe(i,s,r);if(i){const o=oR.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new J("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new J("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!gHe(t)||n===oc.Unsupported)return new J("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case oc.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new J("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new J("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case oc.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new J("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new J("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case oc.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new J("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new J("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function mHe(t,e,r){if(!wie(t)||!wie(e))return oc.Unsupported;if(t==null||e==null)return oc.Ok;if(!r&&t.heightUnit!==e.heightUnit)return oc.Units;if(t.heightModel!==e.heightModel)return oc.HeightModel;switch(t.heightModel){case"gravity-related-height":return oc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?oc.Ok:oc.CRS;default:return oc.Unsupported}}var oc;function wie(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function gHe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!_be(t)}function mbe(t){var i;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?Ak(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&gbe(t)&&t.heightModelInfo?t.heightModelInfo:_be(t)?oR.deriveUnitFromSR(_He,t.spatialReference):null}function gbe(t){return"heightModelInfo"in t}function ybe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function _be(t){return ybe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):vbe(t)}function yHe(t){return t.layers!=null||vbe(t)||ybe(t)||gbe(t)}function vbe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(oc||(oc={}));const _He=new oR({heightModel:"gravity-related-height"});let gj,UU=null;async function vHe(t){UU||(UU=me(()=>Promise.resolve().then(()=>S0t),void 0).then(e=>gj=e)),await UU,vt(t)}async function bbe(t,e,r,i){if(!t)return null;const s=t.spatialReference;return WE()||Dh(s,e)?p1(t,e):gj?gj.projectGeometry(t,e,r,i):(await Promise.race([vHe(i),YS(i)]),bbe(t,e,r,i))}let Xi=class extends Me{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Ja(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,s,n,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(yHe(o)){const a=mbe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Ja(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:Am(async n=>{try{const o=await bbe(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Zs(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Ne.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ne.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new bHe;for(const s of e)if(this._collectCollection(s,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{ns(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};d([m()],Xi.prototype,"required",void 0),d([m({constructOnly:!0})],Xi.prototype,"map",void 0),d([m({constructOnly:!0})],Xi.prototype,"getSpatialReferenceSupport",void 0),d([m()],Xi.prototype,"defaultSpatialReference",void 0),d([m()],Xi.prototype,"userSpatialReference",void 0),d([m()],Xi.prototype,"sourcePreloadCount",void 0),d([m()],Xi.prototype,"priorityCollection",void 0),d([m()],Xi.prototype,"requiresExtentInSpatialReference",void 0),d([m()],Xi.prototype,"suspended",void 0),d([m({readOnly:!0})],Xi.prototype,"ready",null),d([m({readOnly:!0})],Xi.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],Xi.prototype,"spatialReference",null),d([m({readOnly:!0})],Xi.prototype,"extent",null),d([m({readOnly:!0})],Xi.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Xi.prototype,"vcsWkid",null),d([m({readOnly:!0})],Xi.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],Xi.prototype,"viewingMode",null),d([m({readOnly:!0})],Xi.prototype,"tileInfo",null),d([m({readOnly:!0})],Xi.prototype,"mapCollections",null),d([m({readOnly:!0})],Xi.prototype,"_allLayers",null),d([m({readOnly:!0})],Xi.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],Xi.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],Xi.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],Xi.prototype,"_extentCandidatesTask",null),d([m()],Xi.prototype,"_extentTask",null),d([m()],Xi.prototype,"_projectExtentTask",void 0),Xi=d([V("esri.views.support.DefaultsFromMap")],Xi);let bHe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var fA;let St=fA=class extends Gs.EventedMixin(UX(Me)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new c1,this.updatingHandles=new mp,this.allLayerViews=new sO({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:xHe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new iw,this.analyses=new eE,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Mt,this.magnifier=new ebe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new uHe,this.navigation=new ube,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new rHe(this),this.persistableViewModels=new Mt,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(he(()=>this.preconditionsReady,e=>{var i,s;const r=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,fA.views.add(this)):(this._lockedSpatialReference=null,fA.views.remove(this)),this.notifyChange("spatialReference"),!e&&r)(i=this.toolViewManager)==null||i.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!r){try{this._startup()}catch(n){return void queueMicrotask(()=>{console.error("View._startup failed",n),this.fatalError=new J("startup-error",null,n)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},ti))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,GS(()=>this.ready)))),this.basemapView=new $y({view:this}),this.layerViewManager=new kje({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new bf({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new eHe({view:this}),this.addHandles([he(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},si),he(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},ti),he(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},si)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([he(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const s=Yr(()=>t=Ja(t));t=Am(async n=>{try{await LM(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}ae.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(fA.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ae(this.graphics),this.analyses=Ae(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ae(this.analysisViewManager),this.toolViewManager=Ae(this.toolViewManager),this.layerViewManager=Ae(this.layerViewManager),this.selectionManager=Ae(this.selectionManager),this.basemapView=Ae(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Ae(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ae.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Xi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||j_.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(ae.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),j_.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)){const i=t.clone();return i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,i}return t}set spatialReference(t){const e=!co(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??ym}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),r=new Set(Intl.supportedValuesOf("timeZone").map(i=>i.toLowerCase()));this._userTimeZone=t,t===ym||t===qY||e.has(t.toLowerCase())||r.has(t.toLowerCase())||ae.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new fj}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new J("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&ae.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Ih(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};St.views=new Mt,d([m()],St.prototype,"_userSpatialReference",void 0),d([m()],St.prototype,"activeTool",null),d([m({readOnly:!0})],St.prototype,"allLayerViews",void 0),d([m()],St.prototype,"groundView",void 0),d([m()],St.prototype,"animation",null),d([m()],St.prototype,"basemapView",void 0),d([m()],St.prototype,"center",null),d([m({readOnly:!0})],St.prototype,"_defaultsFromMapSettings",null),d([m()],St.prototype,"defaultsFromMap",null),d([m()],St.prototype,"fatalError",void 0),d([m({type:$r})],St.prototype,"extent",null),d([m(Z4(iw,"graphics"))],St.prototype,"graphics",void 0),d([m(Z4(eE,"analyses"))],St.prototype,"analyses",void 0),d([m({readOnly:!0,type:oR})],St.prototype,"heightModelInfo",null),d([m({readOnly:!0})],St.prototype,"interacting",null),d([m({readOnly:!0})],St.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],St.prototype,"preconditionsReady",null),d([m({readOnly:!0})],St.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:Mt,readOnly:!0})],St.prototype,"layerViews",void 0),d([m()],St.prototype,"resolution",null),d([m({type:ebe})],St.prototype,"magnifier",void 0),d([m({value:null,type:W1e})],St.prototype,"map",null),d([m()],St.prototype,"padding",void 0),d([m({readOnly:!0})],St.prototype,"ready",void 0),d([m({type:Xe})],St.prototype,"spatialReference",null),d([m()],St.prototype,"spatialReferenceWarningDelay",void 0),d([m()],St.prototype,"stationary",null),d([m({readOnly:!0})],St.prototype,"supportsGround",void 0),d([m({type:pR})],St.prototype,"timeExtent",void 0),d([m({type:String,nonNullable:!0})],St.prototype,"timeZone",null),d([m()],St.prototype,"tools",null),d([m()],St.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],St.prototype,"type",void 0),d([m({type:Number})],St.prototype,"scale",void 0),d([m({readOnly:!0})],St.prototype,"updating",void 0),d([m({readOnly:!0})],St.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],St.prototype,"initialExtent",null),d([m()],St.prototype,"cursor",null),d([m({readOnly:!0})],St.prototype,"input",void 0),d([m({type:ube,nonNullable:!0})],St.prototype,"navigation",void 0),d([m()],St.prototype,"layerViewManager",void 0),d([m()],St.prototype,"analysisViewManager",void 0),d([m()],St.prototype,"selectionManager",void 0),d([m()],St.prototype,"width",void 0),d([m()],St.prototype,"height",void 0),d([m({readOnly:!0})],St.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],St.prototype,"size",null),d([m({readOnly:!0})],St.prototype,"suspended",void 0),d([m({readOnly:!0})],St.prototype,"viewEvents",void 0),d([m({readOnly:!0})],St.prototype,"persistableViewModels",void 0),d([m()],St.prototype,"_isValid",void 0),d([m()],St.prototype,"_readyCycleForced",void 0),d([m()],St.prototype,"_lockedSpatialReference",void 0),d([m()],St.prototype,"_userTimeZone",void 0),d([m()],St.prototype,"_lockedTimeZone",void 0),d([m({type:fj})],St.prototype,"theme",void 0),d([m({readOnly:!0,type:fj})],St.prototype,"effectiveTheme",null),St=fA=d([V("esri.views.View")],St);const wHe=St;function xHe(t){return t.layerViews}let Ly=class extends p5{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Wo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new J("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=Rc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};d([m({readOnly:!0})],Ly.prototype,"done",null),d([m({readOnly:!0,type:String})],Ly.prototype,"state",void 0),d([m()],Ly.prototype,"target",void 0),Ly=d([V("esri.views.ViewAnimation")],Ly),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Ly||(Ly={}));const lE=Ly,qC=()=>me(()=>import("./TileLayerView3D-DbdFhMXO.js"),__vite__mapDeps([116,117,118,119,120,121,122,123,124,125])),xie=()=>me(()=>import("./ElevationLayerView3D-xGRYqi-l.js"),__vite__mapDeps([126,117,118,119])),Tie={"base-dynamic":()=>me(()=>import("./BaseDynamicLayerView3D-DLkES8RG.js"),__vite__mapDeps([127,128,117,129,130,119,120])),"base-elevation":xie,"base-tile":qC,"bing-maps":qC,"building-scene":()=>me(()=>import("./BuildingSceneLayerView3D-CIZ6olt_.js"),__vite__mapDeps([131,132,133,74,52,41,57,73,23,21,4,79,80,81,33,76,82,83,84,85,86,87,88,72,77,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,78,104,105,134,135,136,61,53,124,19,20,137,138,139,140,60,106,141,142,143,144,145,146,147,148,149,115,150,24,16,17,122,18,11,22,3,5,6,7,14,15,129,117,32,30,31,151,119,120,152,153,154,155,59,156,157,158])),csv:()=>me(()=>import("./CSVLayerView3D-CZB9T9qk.js"),__vite__mapDeps([159,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,32,30,31,33,151,84,119,120])),dimension:()=>me(()=>import("./DimensionLayerView3D-C4cfpr0O.js"),__vite__mapDeps([160,117,119])),elevation:xie,feature:()=>me(()=>import("./FeatureLayerView3D-Ba5gV_cV.js"),__vite__mapDeps([145,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,32,30,31,33,151,84,119,120])),geojson:()=>me(()=>import("./GeoJSONLayerView3D-mQvWjwRR.js"),__vite__mapDeps([161,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,32,30,31,33,151,84,119,120])),graphics:()=>me(()=>import("./GraphicsLayerView3D-CT9SSmEX.js"),__vite__mapDeps([162,117,149,163,41,150,74,52,57,73,23,21,4,24,16,17,124,129,119])),group:()=>me(()=>import("./GroupLayerView-D2ckovJh.js"),__vite__mapDeps([164,119])),imagery:()=>me(()=>import("./ImageryLayerView3D-DbpG1TSz.js"),__vite__mapDeps([165,128,117,129,130,119,120,124])),"integrated-mesh":()=>me(()=>import("./IntegratedMeshLayerView3D-1mP66TmA.js"),__vite__mapDeps([166,137,138,139,140,60,61,53,106,88,141,142,143,144,76,145,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,14,15,129,117,32,30,31,33,151,84,119,120,152,153,94,154,155,59,156])),"integrated-mesh-3dtiles":()=>me(()=>import("./IntegratedMesh3DTilesLayerView3D-CtsidEsv.js"),__vite__mapDeps([167,138,139,67,117,119])),"line-of-sight":()=>me(()=>import("./LineOfSightLayerView3D-BUf-7PIs.js"),__vite__mapDeps([168,117,119])),"map-image":()=>me(()=>import("./MapImageLayerView3D-w9wQU-0g.js"),__vite__mapDeps([169,128,117,129,130,119,120,170,122,123,121,124,125])),media:()=>me(()=>import("./MediaLayerView3D-VaATM5l7.js"),__vite__mapDeps([171,172,173,117,130,119])),"ogc-feature":()=>me(()=>import("./OGCFeatureLayerView3D-4mWlfGJl.js"),__vite__mapDeps([174,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,32,30,31,33,151,84,119,120])),"open-street-map":qC,"oriented-imagery":()=>me(()=>import("./FeatureLayerView3D-Ba5gV_cV.js"),__vite__mapDeps([145,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,32,30,31,33,151,84,119,120])),"point-cloud":()=>me(()=>import("./PointCloudLayerView3D-CDSK1T1g.js"),__vite__mapDeps([175,117,61,53,50,51,52,176,124,119])),voxel:()=>me(()=>import("./VoxelLayerView3D-D5Up1YJu.js"),__vite__mapDeps([177,117,176,124,119])),route:()=>me(()=>import("./RouteLayerView3D-BiOu8IIm.js"),__vite__mapDeps([178,179,117,163,41,150,74,52,57,73,23,21,4,24,16,17,124,129,151,119])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?me(()=>import("./SceneLayerView3D-Bi7wSRwJ.js"),__vite__mapDeps([180,106,19,20,21,85,122,137,138,139,140,60,61,53,88,141,142,143,144,76,145,146,147,148,149,115,41,74,52,57,150,73,23,4,24,16,17,124,18,11,22,3,5,6,7,14,15,129,117,32,30,31,33,151,84,119,120,152,153,94,154,155,59,156,181,158,157,176])):me(()=>import("./SceneLayerGraphicsView3D-D6vDASfR.js"),__vite__mapDeps([182,140,139,60,61,53,106,88,141,142,143,144,76,145,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,14,15,129,117,32,30,31,33,151,84,119,120,181,158,176])),stream:()=>me(()=>import("./StreamLayerView3D-DkfIckxz.js"),__vite__mapDeps([183,47,48,32,30,31,33,151,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,119])),tile:qC,"imagery-tile":()=>me(()=>import("./ImageryTileLayerView3D-CpkoKv9J.js"),__vite__mapDeps([184,58,117,118,124,119,120,125])),"vector-tile":()=>me(()=>import("./VectorTileLayerView3D-Djno2sW-.js"),__vite__mapDeps([185,44,31,43,186,117,118,119])),wcs:()=>me(()=>import("./ImageryTileLayerView3D-CpkoKv9J.js"),__vite__mapDeps([184,58,117,118,124,119,120,125])),"web-tile":qC,wfs:()=>me(()=>import("./WFSLayerView3D-DoDiebzU.js"),__vite__mapDeps([187,146,147,148,149,115,41,74,52,57,150,73,23,21,4,24,16,17,124,85,122,18,19,20,11,22,3,5,6,7,76,14,15,129,117,32,30,31,33,151,84,119,120])),wms:()=>me(()=>import("./WMSLayerView3D-Dp-LtpLH.js"),__vite__mapDeps([188,128,117,129,130,119,120,189])),wmts:()=>me(()=>import("./WMTSLayerView3D-Eiv5hUmn.js"),__vite__mapDeps([190,117,118,119,120])),catalog:null,"catalog-dynamic-group":null,"catalog-footprint":null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function THe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new J(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const Sie={hasLayerViewModule:t=>Tie[t.type]!=null,importLayerView:t=>{const e=Tie[t.type];if(e==null)throw THe(t);return e(t)}},Eie="analyses-owner-handles";var ST,fb;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(ST||(ST={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(fb||(fb={}));let Bv=class extends Me{constructor(e){super(e),this._allAnalysisViews=new Mt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Cie(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(hr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(hr()),this._attachedToViewResolver=Cie()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===fb.REMOVED)throw new J("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Eie)}_disconnectOwners(){this.removeHandles(Eie),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return Yr(()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:ST.PENDING,list:fb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=Am(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=fb.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=fb.REMOVED,this._scheduleUpdate()):ae.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=zE(()=>this._update()))}_update(){this._scheduledUpdateHandle=wi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===fb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case ST.PENDING:e.createAnalysisViewTask=Ja(e.createAnalysisViewTask);break;case ST.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Ae(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(Zs(r))throw this._creatingViewCount-=1,hr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Zs(r))throw this._creatingViewCount-=1,o.destroy(),hr("AnalysisView creation aborted");return e.view=o,e.state.view=ST.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return me(()=>import("./AreaMeasurementAnalysisView3D-DWtF8FN8.js"),__vite__mapDeps([191,192,193,70,194,195,10,196,197]));case"dimension":return me(()=>import("./DimensionAnalysisView3D-BRq8XYQY.js").then(r=>r.D),__vite__mapDeps([198,194,199,193,70,195,10,196,200,201,202,130,186,203,197,85,122,148]));case"direct-line-measurement":return me(()=>import("./DirectLineMeasurementAnalysisView3D-D1-IWCkT.js"),__vite__mapDeps([204,192,193,70,194,195,10,196,200]));case"line-of-sight":return me(()=>import("./LineOfSightAnalysisView3D-YR14FJnt.js"),__vite__mapDeps([205,194,206,153,94,154,155,201,203]));case"slice":return me(()=>import("./SliceAnalysisView3D-Du4FtzdP.js"),__vite__mapDeps([207,194,153,94,154,155,133,74,52,41,57,73,23,21,4,79,80,81,33,76,82,83,84,85,86,87,88,72,77,89,90,91,92,93,95,96,97,98,99,100,101,102,103,78,104,105,134,135,136,61,53,124,201,202,130]))}}};function Cie(){const t=Wo();return t.promise.catch(()=>{}),t}d([m()],Bv.prototype,"updating",null),d([m({constructOnly:!0})],Bv.prototype,"view",void 0),d([m()],Bv.prototype,"_allAnalysisViews",void 0),d([m()],Bv.prototype,"_creatingViewCount",void 0),Bv=d([V("esri.views.3d.analysis.AnalysisViewManager3D")],Bv);const SHe=Bv;let fg=class extends Me{constructor(e){super(e),this.collision=new mA,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ne.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ne.Local?this._set("altitude",e):ae.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?we(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return we(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ne.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=zU)=>(i.min=No.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?ED([[4e3,No.max],[1e4,Lt(88)],[6e6,Lt(88)]]):()=>No.max;return(r,i=zU)=>(i.min=No.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?ED([[4e3,No.max],[5e4,Lt(88)],[6e6,Lt(88)],[2e7,No.min]]):ED([[3e5,No.max],[3e6,Lt(88)],[6e6,Lt(88)],[2e7,No.min]]);return(r,i=zU)=>(i.min=No.min,i.max=e(r),i)}};function EHe(t){return{min:-2e5,max:4*t.radius}}d([m()],fg.prototype,"altitude",null),d([m({readOnly:!0})],fg.prototype,"collision",void 0),d([m()],fg.prototype,"distance",void 0),d([m({readOnly:!0})],fg.prototype,"minimumPoiDistance",void 0),d([m()],fg.prototype,"tilt",void 0),d([m({constructOnly:!0})],fg.prototype,"mode",void 0),fg=d([V("esri.views.3d.state.Constraints")],fg);const Aie=EHe(Kr),No={min:Lt(.5),max:Lt(179.5)},zU={min:0,max:0};let mA=class extends Me{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],mA.prototype,"enabled",void 0),d([m({type:Number})],mA.prototype,"elevationMargin",void 0),mA=d([V("esri.views.3d.state.Constraints.CollisionConstraint")],mA);let ET=class extends bw{constructor(){super(...arguments),this.min=Aie.min,this.max=Aie.max}};d([m({type:Number})],ET.prototype,"min",void 0),d([m({type:Number})],ET.prototype,"max",void 0),ET=d([V("esri.views.3d.constraints.AltitudeConstraint")],ET);let Eg=class extends bw{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};d([m({type:Number,value:1e-8})],Eg.prototype,"near",null),d([zi("near")],Eg.prototype,"castNear",null),d([m({type:Number,value:1e-8})],Eg.prototype,"far",null),d([zi("far")],Eg.prototype,"castFar",null),d([m({type:["auto","manual"]})],Eg.prototype,"mode",void 0),Eg=d([V("esri.views.3d.constraints.ClipDistanceConstraint")],Eg);const yj={min:ga(No.min),max:ga(No.max)};let mb=class extends bw{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return we(e,yj.min,yj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],mb.prototype,"mode",void 0),d([m({type:Number,value:yj.max})],mb.prototype,"max",null),d([zi("max")],mb.prototype,"castMax",null),mb=d([V("esri.views.3d.constraints.TiltConstraint")],mb);let gb=class extends bw{constructor(){super(...arguments),this.tilt=new mb,this.altitude=new ET,this.clipDistance=new Eg}};d([m({type:mb})],gb.prototype,"tilt",void 0),d([m({type:ET})],gb.prototype,"altitude",void 0),d([m({type:Eg})],gb.prototype,"clipDistance",void 0),gb=d([V("esri.views.3d.constraints.Constraints")],gb);var _j;let Wu=_j=class extends We{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new _j(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([m({readOnly:!0,type:["sun"],json:{write:!0}})],Wu.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],Wu.prototype,"date",void 0),d([Tr("date",["datetime"])],Wu.prototype,"readDate",null),d([lr("date")],Wu.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Wu.prototype,"directShadowsEnabled",void 0),d([Tr("directShadowsEnabled",["directShadows"])],Wu.prototype,"readDirectShadowsEnabled",null),d([lr("directShadowsEnabled")],Wu.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],Wu.prototype,"displayUTCOffset",void 0),d([lr("displayUTCOffset")],Wu.prototype,"writeDisplayUTCOffset",null),Wu=_j=d([V("esri.webscene.SunLighting")],Wu);const lO=Wu;var H2;let wf=H2=class extends Gs.EventedMixin(lO){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return n_(ae.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){n_(ae.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return n_(ae.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){n_(ae.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new H2(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=H2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=H2.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(W$.target=this,W$.timezoneOffset=s,this.emit("timezone-will-change",W$),W$.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new H2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],wf.prototype,"cameraTrackingEnabled",void 0),d([m({type:Boolean})],wf.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],wf.prototype,"waterReflectionEnabled",null),d([m({type:Date})],wf.prototype,"defaultDate",null),d([m({type:Date})],wf.prototype,"date",null),wf=H2=d([V("esri.views.3d.environment.SunLighting")],wf),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(wf||(wf={}));const W$={target:null,timezoneOffset:0},Vv=wf;var vj;let gA=vj=class extends We{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new vj(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([m({readOnly:!0,type:["virtual"],json:{write:!0}})],gA.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],gA.prototype,"directShadowsEnabled",void 0),gA=vj=d([V("esri.webscene.VirtualLighting")],gA);const Pk=gA;var rN;let q2=rN=class extends Gs.EventedMixin(Pk){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return n_(ae.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){n_(ae.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return n_(ae.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){n_(ae.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new rN({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new rN(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],q2.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],q2.prototype,"waterReflectionEnabled",null),d([m({type:Boolean})],q2.prototype,"cameraTrackingEnabled",void 0),q2=rN=d([V("esri.views.3d.environment.VirtualLighting")],q2);const yA=q2,CHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Vv,virtual:yA}};var bj;let ZP=bj=class extends Me{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new bj({quality:this.quality})}};d([m({type:["low","high"],value:"low"})],ZP.prototype,"quality",null),ZP=bj=d([V("esri.views.3d.environment.SceneViewAtmosphere")],ZP);var wj;let _A=wj=class extends We{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new wj({cloudCover:this.cloudCover})}};d([Rt({sunny:"sunny"})],_A.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],_A.prototype,"cloudCover",void 0),_A=wj=d([V("esri.views.3d.environment.SunnyWeather")],_A);const xj=_A;var Tj;let vA=Tj=class extends We{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new Tj({cloudCover:this.cloudCover})}};d([Rt({cloudy:"cloudy"})],vA.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],vA.prototype,"cloudCover",void 0),vA=Tj=d([V("esri.views.3d.environment.CloudyWeather")],vA);const AHe=vA;var Sj;let bA=Sj=class extends We{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new Sj({fogStrength:this.fogStrength})}};d([Rt({foggy:"foggy"})],bA.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],bA.prototype,"fogStrength",void 0),bA=Sj=d([V("esri.views.3d.environment.FoggyWeather")],bA);const PHe=bA;var Ej;let W2=Ej=class extends We{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Ej({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Rt({rainy:"rainy"})],W2.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],W2.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],W2.prototype,"precipitation",void 0),W2=Ej=d([V("esri.views.3d.environment.RainyWeather")],W2);const MHe=W2;var Cj;let Gv=Cj=class extends We{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Cj({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Rt({snowy:"snowy"})],Gv.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Gv.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Gv.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Gv.prototype,"snowCover",void 0),Gv=Cj=d([V("esri.views.3d.environment.SnowyWeather")],Gv);const OHe=Gv,wbe={key:"type",base:xj,typeMap:{sunny:xj,cloudy:AHe,rainy:MHe,snowy:OHe,foggy:PHe}},RHe=Object.keys(wbe.typeMap);function $He(t,e){return!!RHe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Mg=1e4,IHe=1e5,LHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:lO,virtual:Pk}};let iN=class extends We{constructor(e){super(e)}clone(){}};d([m({readOnly:!0,json:{read:!1}})],iN.prototype,"type",void 0),iN=d([V("esri.webscene.background.Background")],iN);const xbe=iN;var Aj;const DHe={...v0,nonNullable:!0};let wA=Aj=class extends xbe{constructor(t){super(t),this.type="color",this.color=new Fe([0,0,0,1])}clone(){return new Aj(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Rt({color:"color"},{readOnly:!0})],wA.prototype,"type",void 0),d([m(DHe)],wA.prototype,"color",void 0),wA=Aj=d([V("esri.webscene.background.ColorBackground")],wA);const Tbe=wA,Pie={base:xbe,key:"type",typeMap:{color:Tbe}};function NHe(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const FHe={types:Pie,json:{read:NHe(Pie),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var Pj;const Mie=(t,e,r)=>({enabled:!r||!r.isPresentation});let Dy=Pj=class extends We{constructor(t){super(t),this.lighting=new lO,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){$He(t==null?void 0:t.type,ae.getLogger(this))&&this._set("weather",t)}clone(){return new Pj(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Pk.prototype.clone.call(this.lighting):lO.prototype.clone.call(this.lighting),background:ge(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([m({types:LHe,nonNullable:!0,json:{write:!0}})],Dy.prototype,"lighting",void 0),d([m(FHe)],Dy.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Mie}}})],Dy.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Mie}}})],Dy.prototype,"starsEnabled",void 0),d([m({types:wbe,nonNullable:!0,json:{write:!0},value:new xj})],Dy.prototype,"weather",null),Dy=Pj=d([V("esri.webscene.Environment")],Dy);const Sbe=Dy;var xA;let Y2=xA=class extends Sbe{constructor(t){super(t),this.atmosphere=new ZP,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new xA({...e,lighting:e.lighting?e.lighting.type==="virtual"?yA.fromWebsceneLighting(e.lighting):Vv.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(Hpe(e)),e}_convertLighting(t){var e,r;return t?t instanceof Vv||t instanceof yA?t:t instanceof lO?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Vv({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof Pk?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new yA({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):gm(CHe,t):new Vv}clone(){return new xA({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ge(this.background)})}cloneWithWebsceneEnvironment(t){return new xA({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ge(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Vv.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):yA.fromWebsceneLighting(t.lighting);default:return t.lighting,Vv.fromWebsceneLighting(t.lighting)}}};d([m({type:ZP,json:{read:!1},nonNullable:!0})],Y2.prototype,"atmosphere",void 0),d([m({nonNullable:!0})],Y2.prototype,"lighting",void 0),d([zi("lighting")],Y2.prototype,"castLighting",null),Y2=xA=d([V("esri.views.3d.environment.SceneViewEnvironment")],Y2);const X2=Y2;function kHe(t,e,r){if(e==null)return!1;const i=R0e(e);return i!=null&&(i(t,0,WC,0),r!==WC&&(r[0]=WC[0],r[1]=WC[1],r.length>2&&(r[2]=WC[2])),!0)}const WC=E();function UHe(t,e){Y$[0]=t.x,Y$[1]=t.y;const r=t.z;return Y$[2]=r!==void 0?r:0,kHe(Y$,t.spatialReference,e)}const Y$=E();var ra;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(ra||(ra={}));function Ebe(t){return"r"in t&&"g"in t&&"b"in t}function Cbe(t){return"h"in t&&"s"in t&&"v"in t}function Abe(t){return"l"in t&&"a"in t&&"b"in t}function Pbe(t){return"l"in t&&"c"in t&&"h"in t}function zHe(t){return"x"in t&&"y"in t&&"z"in t}const BHe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],VHe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function Mbe(t,e){const r=[];let i,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(i=0;i<n;i++){for(a=0,s=0;s<o;s++)a+=t[i][s]*e[s];r.push(a)}return r}function Obe(t){const e=[t.r/255,t.g/255,t.b/255].map(i=>i<=.04045?i/12.92:((i+.055)/1.055)**2.4),r=Mbe(BHe,e);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function pZ(t){const e=Mbe(VHe,[t.x/100,t.y/100,t.z/100]).map(r=>{const i=r<=.0031308?12.92*r:1.055*r**.4166666666666667-.055;return Math.min(1,Math.max(i,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function Rbe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(r=>r>.008856451679035631?r**.3333333333333333:7.787037037037035*r+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function $be(t){const e=t.l,r=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(i=>i>6/29?i**3:3*(6/29)**2*(i-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function GHe(t){const e=t.l,r=t.a,i=t.b,s=Math.sqrt(r*r+i*i);let n=Math.atan2(i,r);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function jHe(t){const e=t.l,r=t.c,i=t.h;return{l:e,a:r*Math.cos(i),b:r*Math.sin(i)}}function HHe(t){return Rbe(Obe(t))}function qHe(t){return pZ($be(t))}function WHe(t){return GHe(Rbe(Obe(t)))}function YHe(t){return pZ($be(jHe(t)))}function XHe(t){const e=t.r,r=t.g,i=t.b,s=Math.max(e,r,i),n=s-Math.min(e,r,i);let o=s,a=n===0?0:s===e?(r-i)/n%6:s===r?(i-e)/n+2:(e-r)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function ZHe(t){const e=(t.h+360)%360/60,r=t.s/100,i=t.v/100*255,s=i*r,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-s),o.g=Math.round(o.g+i-s),o.b=Math.round(o.b+i-s),o}function cO(t){return Ebe(t)?t:Pbe(t)?YHe(t):Abe(t)?qHe(t):zHe(t)?pZ(t):Cbe(t)?ZHe(t):t}function pIt(t){return Cbe(t)?t:XHe(cO(t))}function Oie(t){return Abe(t)?t:HHe(cO(t))}function Rie(t){return Pbe(t)?t:WHe(cO(t))}function JHe(t,e){const{r,g:i,b:s}=t;return .2126*r+.7152*i+.0722*s}var Mj;function fIt(t,e=Mj.High){return JHe(t)>e?new Fe([0,0,0,t.a]):new Fe([255,255,255,t.a])}function mIt(t,e){const r=t.clone();return r.a*=e,r}function uO(t){return Fe.toUnitRGBA(t)}function gIt(t,e){return t===e||t!=null&&e!=null&&$w(t,e)}function yIt(t){return zt(t[0],t[1],t[2],t.length>3?t[3]:1)}function _It(t,e){const r=Fe.toUnitRGBA(t);return r[3]*=e,r}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(Mj||(Mj={}));function Vn(t,e){return t[0]=e[0],t[1]=e[1],t}function cr(t,e,r){return t[0]=e,t[1]=r,t}function Ud(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Uf(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ibe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Lbe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function KHe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function QHe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function eqe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function tqe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function rqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function _c(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function iqe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Y_(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function S5(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function fZ(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Dbe(t){const e=t[0],r=t[1];return e*e+r*r}function mZ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function sqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function hO(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function vn(t,e){return t[0]*e[0]+t[1]*e[1]}function nqe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function dh(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function oqe(t,e){e=e||1;const r=2*ZO()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Nbe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function Ny(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function aqe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function lqe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function cqe(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function uqe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function hqe(t){return"vec2("+t[0]+", "+t[1]+")"}function Fbe(t,e){return t[0]===e[0]&&t[1]===e[1]}function kbe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=wa();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function dqe(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const pqe=fZ,fqe=Uf,mqe=Ibe,gqe=Lbe,Ube=Y_,yqe=S5,_qe=Dbe;Object.freeze(Object.defineProperty({__proto__:null,add:Ud,angle:uqe,ceil:KHe,copy:Vn,cross:nqe,dist:Ube,distance:Y_,div:gqe,divide:Lbe,dot:vn,equals:kbe,exactEquals:Fbe,floor:QHe,inverse:sqe,len:pqe,length:fZ,lerp:dh,max:tqe,min:eqe,mul:mqe,multiply:Ibe,negate:mZ,normalize:hO,projectAndScale:dqe,random:oqe,rotate:cqe,round:rqe,scale:_c,scaleAndAdd:iqe,set:cr,sqrDist:yqe,sqrLen:_qe,squaredDistance:S5,squaredLength:Dbe,str:hqe,sub:fqe,subtract:Uf,transformMat2:Nbe,transformMat2d:Ny,transformMat3:aqe,transformMat4:lqe},Symbol.toStringTag,{value:"Module"}));function gZ(t){return we((t-1e5)/9e5,0,1)}const Oj=1e4,vqe=.085,Xy=1e5;let bqe=class{};const Ci=bqe;function x(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(x||(x={}));var O;function wqe(t){return t===O.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(O||(O={}));var rs;function om(t,e){switch(e.textureCoordinateType){case rs.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case rs.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(x`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case rs.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case rs.None:return void t.vertex.code.add(x`void forwardTextureCoordinates() {}`);case rs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(rs||(rs={}));function Yh(t){t.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function bm(t){t.include(Yh),t.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function zbe(t){t.code.add(x`float linearizeDepth(float depth, vec2 nearFar) {
float depthNdc = depth * 2.0 - 1.0;
return (2.0 * nearFar[0] * nearFar[1]) / (depthNdc * (nearFar[1] - nearFar[0]) - (nearFar[1] + nearFar[0]));
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return linearizeDepth(depth, nearFar);
}`)}function Mk(t){t.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Rr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Rr||(Rr={}));let ps=class{constructor(e,r,i,s,n=null){if(this.name=e,this.type=r,this.arraySize=n,this.bind={[Rr.Pass]:null,[Rr.Draw]:null},s)switch(i){case Rr.Pass:this.bind[Rr.Pass]=s;break;case Rr.Draw:this.bind[Rr.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Dt=class extends ps{constructor(e,r){super(e,"vec3",Rr.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function w0(t){t.uniforms.add(new Dt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function Om(t){t.uniforms.add(new Dt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function E5(t){w0(t.fragment),Om(t.fragment),t.fragment.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let ni=class extends ps{constructor(e,r){super(e,"vec2",Rr.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},wr=class extends ps{constructor(e,r){super(e,"vec4",Rr.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Ie=class extends ps{constructor(e,r){super(e,"float",Rr.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},is=class extends ps{constructor(e,r){super(e,"mat4",Rr.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const Pa=Yt();let xqe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function ht(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new xqe(`${e} at ${r}`)}}function Mx(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function $ie(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function X$(t,e,r,i,s,n=je()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function Iie(t,e,r,i,s){Pa[0]=t[0],Pa[1]=t[1],Pa[2]=t[2],Pa[3]=1,wc(Pa,Pa,e),s.length>2&&(s[2]=-Pa[2]),wc(Pa,Pa,r),ht(Pa[3]!==0),s[0]=Pa[0]/Pa[3],s[1]=Pa[1]/Pa[3],s[2]=Pa[2]/Pa[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function Tqe(t,e){return Math.log(t)/Math.log(e)}function Sqe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function Bbe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Vbe=()=>ae.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let Gbe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){Vbe().error("Shader module included multiple times with different configuration.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Or=class extends Gbe{constructor(){super(...arguments),this.vertex=new Lie,this.fragment=new Lie,this.attributes=new Aqe,this.varyings=new Pqe,this.extensions=new Rj,this.constants=new jbe,this.outputs=new Ij}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?Oqe:Mqe,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const r=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Rr.Pass];o&&r.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Rr.Pass];o&&r.set(n.name,o)});const i=Array.from(r.values()),s=i.length;return(n,o)=>{for(let a=0;a<s;++a)i[a](e,n,o)}}generateBindDraw(e){const r=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Rr.Draw];o&&r.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Rr.Draw];o&&r.set(n.name,o)});const i=Array.from(r.values()),s=i.length;return(n,o,a)=>{for(let l=0;l<s;++l)i[l](e,n,o,a)}}},Eqe=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new J(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Vbe().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},Cqe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},Lie=class extends Gbe{constructor(){super(...arguments),this.uniforms=new Eqe,this.code=new Cqe,this.constants=new jbe}get builder(){return this}},Aqe=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},Pqe=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&ht(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},Rj=class $j{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?$j.ALLOWLIST_VERTEX:$j.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};Rj.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Rj.ALLOWLIST_VERTEX=[];let Ij=class Lj{constructor(){this._entries=new Map}add(e,r,i=0){const s=this._entries.get(i);s?ht(s.name===e&&s.type===r,`Fragment shader output location ${i} occupied`):this._entries.set(i,{name:e,type:r})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:Lj.DEFAULT_NAME,type:Lj.DEFAULT_TYPE});const r=new Array;return this._entries.forEach((i,s)=>r.push(`layout(location = ${s}) out ${i.type} ${i.name};`)),r}};Ij.DEFAULT_TYPE="vec4",Ij.DEFAULT_NAME="fragColor";let jbe=class pn{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=pn._numberToFloatStr(i);break;case"int":s=pn._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${pn._numberToFloatStr(i[0])},                            ${pn._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${pn._numberToFloatStr(i[0])},                            ${pn._numberToFloatStr(i[1])},                            ${pn._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${pn._numberToFloatStr(i[0])},                            ${pn._numberToFloatStr(i[1])},                            ${pn._numberToFloatStr(i[2])},                            ${pn._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${pn._numberToIntStr(i[0])},                             ${pn._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${pn._numberToIntStr(i[0])},                             ${pn._numberToIntStr(i[1])},                             ${pn._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${pn._numberToIntStr(i[0])},                             ${pn._numberToIntStr(i[1])},                             ${pn._numberToIntStr(i[2])},                             ${pn._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>pn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Mqe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Oqe=`precision highp float;
precision highp sampler2D;`;let at=class extends ps{constructor(e,r){super(e,"sampler2D",Rr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const aS=Pe(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),BU=3,VU=Pe(BU*parseFloat(65e-8.toFixed(6)),BU*parseFloat(1881e-9.toFixed(6)),BU*parseFloat(85e-9.toFixed(6))),Rqe=3996e-9,$qe=Pe(parseFloat(Number(aS[0]+VU[0]).toFixed(6)),parseFloat(Number(aS[1]+VU[1]).toFixed(6)),parseFloat(Number(aS[2]+VU[2]).toFixed(6)));function Hbe(t){const e=new Or;e.attributes.add(O.POSITION,"vec2"),e.include(om,{textureCoordinateType:rs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new is("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new is("inverseViewMatrix",(s,n)=>YE(Iqe,n.camera.viewMatrix))),r.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Dt("backgroundColor",s=>s.backgroundColor),new ni("radii",s=>s.radii),new Dt("cameraPosition",(s,n)=>n.camera.eye),new wr("heightParameters",s=>s.heightParameters),new Ie("innerFadeDistance",s=>s.innerFadeDistance),new Ie("altitudeFade",s=>s.altitudeFade),new at("depthTexture",s=>s.depthTexture),new Ie("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",aS),i.constants.add("betaCombined","vec3",$qe),i.constants.add("betaMie","float",Rqe),i.constants.add("scaleHeight","float",vqe*Xy),w0(i),e.include(Mk),t.haze&&(i.include(bm),i.uniforms.add(new ni("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(x`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":x`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":x`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?x`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?x`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?x`cameraSpaceRay *= -textureBilinear(vuv0);`:x`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:x`${t.reduced?"":x`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:x`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":x`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const Iqe=xe(),Lqe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:aS,build:Hbe},Symbol.toStringTag,{value:"Module"}));let Lr=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Si,sr,Ee,wm,mt,np,cE,Te,Qr,ss,Gt,Xt,_s,wt,tt,An,ko,Pr,ou,na;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Si||(Si={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(sr||(sr={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ee||(Ee={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(wm||(wm={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(mt||(mt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(np||(np={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(cE||(cE={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Te||(Te={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Qr||(Qr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(ss||(ss={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Gt||(Gt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Xt||(Xt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(_s||(_s={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(wt||(wt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(tt||(tt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(An||(An={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ko||(ko={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Pr||(Pr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(ou||(ou={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(na||(na={}));const GU=33984;var ks,Ua,Dj;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(ks||(ks={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Ua||(Ua={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(Dj||(Dj={}));const uE=33306;var Cs,Die,Nie,Fie,C5,Nj,kie;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Cs||(Cs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Die||(Die={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Nie||(Nie={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Fie||(Fie={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(C5||(C5={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Nj||(Nj={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(kie||(kie={}));let Gr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=ft(this._program),this._pipeline=this._configuration=null}reload(e){ft(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return sr.TRIANGLES}getPipeline(e,r,i){return this._pipeline}initializeConfiguration(e,r){}};const Mr=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.UV0,2],[O.COLOR,3],[O.COLORFEATUREATTRIBUTE,3],[O.SIZE,4],[O.TANGENT,4],[O.CENTEROFFSETANDDISTANCE,5],[O.SYMBOLCOLOR,5],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.INSTANCEOBJECTANDLAYERIDCOLOR,7],[O.INSTANCEMODEL,8],[O.INSTANCEMODELNORMAL,12],[O.INSTANCEMODELORIGINHI,11],[O.INSTANCEMODELORIGINLO,15]]),Dqe=()=>ae.getLogger("esri.views.webgl.checkWebGLError");function Nqe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const A5=!!se("enable-feature:webgl-debug");function zd(){return A5}function Fj(){return A5}function zf(t){if(zd()){const e=t.getError();if(e){const r=Nqe(t,e),i=new Error().stack;Dqe().error(new J("webgl-error","WebGL error occurred",{message:r,stack:i}))}}}let Dr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new kt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBindPass(this),this.bindDraw=r.generateBindDraw(this),this._fragmentUniforms=zd()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if((r==null?void 0:r.glName)==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((r,i)=>{this._context.bindTexture(r.texture,r.unit),this.setUniform1i(i,r.unit)}),(e=this._fragmentUniforms)==null||e.forEach(r=>{r.type!=="sampler2D"&&r.type!=="samplerCube"||this._textures.has(r.name)||console.error(`Texture sampler ${r.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Ei,kw,Os,X_,Il,c0,gi,Cl,jg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Ei||(Ei={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(kw||(kw={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Os||(Os={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(X_||(X_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Il||(Il={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(c0||(c0={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(gi||(gi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Cl||(Cl={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(jg||(jg={}));function Pc(t,e,r=wm.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Po(t,e,r,i,s=wm.ADD,n=wm.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const yZ={face:np.BACK,mode:cE.CCW},qbe={face:np.FRONT,mode:cE.CCW},Ok=t=>t===Ei.Back?yZ:t===Ei.Front?qbe:null,Mc={zNear:0,zFar:1},qt={r:!0,g:!0,b:!0,a:!0};function Fqe(t){return qqe.intern(t)}function kqe(t){return Wqe.intern(t)}function Uqe(t){return Yqe.intern(t)}function zqe(t){return Xqe.intern(t)}function Bqe(t){return Zqe.intern(t)}function Vqe(t){return Jqe.intern(t)}function Gqe(t){return Kqe.intern(t)}function jqe(t){return Qqe.intern(t)}function Hqe(t){return eWe.intern(t)}function Nt(t){return tWe.intern(t)}let Rm=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function $m(t){return"["+t.join(",")+"]"}const qqe=new Rm(Wbe,t=>({__tag:"Blending",...t}));function Wbe(t){return t?$m([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Wqe=new Rm(Ybe,t=>({__tag:"Culling",...t}));function Ybe(t){return t?$m([t.face,t.mode]):null}const Yqe=new Rm(Xbe,t=>({__tag:"PolygonOffset",...t}));function Xbe(t){return t?$m([t.factor,t.units]):null}const Xqe=new Rm(Zbe,t=>({__tag:"DepthTest",...t}));function Zbe(t){return t?$m([t.func]):null}const Zqe=new Rm(Jbe,t=>({__tag:"StencilTest",...t}));function Jbe(t){return t?$m([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Jqe=new Rm(Kbe,t=>({__tag:"DepthWrite",...t}));function Kbe(t){return t?$m([t.zNear,t.zFar]):null}const Kqe=new Rm(Qbe,t=>({__tag:"ColorWrite",...t}));function Qbe(t){return t?$m([t.r,t.g,t.b,t.a]):null}const Qqe=new Rm(ewe,t=>({__tag:"StencilWrite",...t}));function ewe(t){return t?$m([t.mask]):null}const eWe=new Rm(twe,t=>({__tag:"DrawBuffers",...t}));function twe(t){return t?$m(t.buffers):null}const tWe=new Rm(rWe,t=>({blending:Fqe(t.blending),culling:kqe(t.culling),polygonOffset:Uqe(t.polygonOffset),depthTest:zqe(t.depthTest),stencilTest:Bqe(t.stencilTest),depthWrite:Vqe(t.depthWrite),colorWrite:Gqe(t.colorWrite),stencilWrite:jqe(t.stencilWrite),drawBuffers:Hqe(t.drawBuffers)}));function rWe(t){return t?$m([Wbe(t.blending),Ybe(t.culling),Xbe(t.polygonOffset),Zbe(t.depthTest),Jbe(t.stencilTest),Kbe(t.depthWrite),Qbe(t.colorWrite),ewe(t.stencilWrite),twe(t.drawBuffers)]):null}let iWe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},sWe=class extends Ci{constructor(){super(...arguments),this.heightParameters=Yt(),this.radii=je(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=je(),this.backgroundColor=E()}},TA=class rwe extends Gr{initializeProgram(e){return new Dr(e.rctx,rwe.shader.get().build(this.configuration),Mr)}initializePipeline(){return this.configuration.reduced?Nt({blending:Pc(Ee.ONE,Ee.ZERO),depthTest:{func:Qr.ALWAYS},colorWrite:qt}):this.configuration.haze?Nt({blending:Po(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),colorWrite:qt}):Nt({blending:Pc(Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};TA.shader=new Lr(Lqe,()=>me(()=>Promise.resolve().then(()=>Q3t),void 0));let zl=class extends Ci{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function G(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let P5=class extends zl{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};d([G()],P5.prototype,"haze",void 0),d([G()],P5.prototype,"reduced",void 0);var ji,Fo;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(ji||(ji={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Fo||(Fo={}));let hi=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new hi(O.POSITION,3,Te.FLOAT,0,12);new hi(O.POSITION,3,Te.FLOAT,0,20),new hi(O.UV0,2,Te.FLOAT,12,20);new hi(O.POSITION,3,Te.FLOAT,0,32),new hi(O.NORMAL,3,Te.FLOAT,12,32),new hi(O.UV0,2,Te.FLOAT,24,32);new hi(O.POSITION,3,Te.FLOAT,0,16),new hi(O.COLOR,4,Te.UNSIGNED_BYTE,12,16);const _Z=[new hi(O.POSITION,2,Te.FLOAT,0,8)],vR=[new hi(O.POSITION,2,Te.FLOAT,0,16),new hi(O.UV0,2,Te.FLOAT,8,16)];function nWe(t){switch(t){case Te.BYTE:case Te.UNSIGNED_BYTE:return 1;case Te.SHORT:case Te.UNSIGNED_SHORT:return 2;case Te.FLOAT:case Te.INT:case Te.UNSIGNED_INT:return 4}}function iwe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Hg(t,e){return t.vertexBuffers[e].usedMemory/oWe(t.layout[e])}function oWe(t){return t[0].stride}function vZ(t,e,r,i,s=0){var o;const n=t.gl;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);if(l===void 0){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)n.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&t.gl.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)n.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+u,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(zd()){const u=iwe(t),h=nWe(a.type),p=a.offset,f=Math.round(h/p)!==h/p?`. Offset not a multiple of stride. DataType requires ${h} bytes, but descriptor has an offset of ${p}`:"";u&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${f}:`,u,a)}}}function swe(t,e,r,i){var n,o,a;const s=t.gl;t.bindBuffer(r);for(const l of i){const c=e.get(l.name);if(l.count<=4)s.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((n=t.gl)==null||n.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(mt.ARRAY_BUFFER)}function bZ(t){switch(t){case wt.ALPHA:case wt.LUMINANCE:case wt.RED:case wt.RED_INTEGER:case tt.R8:case tt.R8I:case tt.R8UI:case tt.R8_SNORM:case ko.STENCIL_INDEX8:return 1;case wt.LUMINANCE_ALPHA:case wt.RG:case wt.RG_INTEGER:case tt.RGBA4:case tt.R16F:case tt.R16I:case tt.R16UI:case tt.RG8:case tt.RG8I:case tt.RG8UI:case tt.RG8_SNORM:case tt.RGB565:case tt.RGB5_A1:case ko.DEPTH_COMPONENT16:return 2;case wt.DEPTH_COMPONENT:case wt.RGB:case wt.RGB_INTEGER:case tt.RGB8:case tt.RGB8I:case tt.RGB8UI:case tt.RGB8_SNORM:case tt.SRGB8:case ko.DEPTH_COMPONENT24:return 3;case wt.DEPTH_STENCIL:case wt.DEPTH24_STENCIL8:case wt.RGBA:case wt.RGBA_INTEGER:case tt.RGBA8:case tt.R32F:case tt.R11F_G11F_B10F:case tt.RG16F:case tt.R32I:case tt.R32UI:case tt.RG16I:case tt.RG16UI:case tt.RGBA8I:case tt.RGBA8UI:case tt.RGBA8_SNORM:case tt.SRGB8_ALPHA8:case tt.RGB9_E5:case tt.RGB10_A2UI:case tt.RGB10_A2:case ko.DEPTH_STENCIL:case ko.DEPTH_COMPONENT32F:case ko.DEPTH24_STENCIL8:return 4;case ko.DEPTH32F_STENCIL8:return 5;case tt.RGB16F:case tt.RGB16I:case tt.RGB16UI:return 6;case tt.RG32F:case tt.RG32I:case tt.RG32UI:case tt.RGBA16F:case tt.RGBA16I:case tt.RGBA16UI:return 8;case tt.RGB32F:case tt.RGB32I:case tt.RGB32UI:return 12;case tt.RGBA32F:case tt.RGBA32I:case tt.RGBA32UI:return 16;case Cs.COMPRESSED_RGB_S3TC_DXT1_EXT:case Cs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Cs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Cs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Cs.COMPRESSED_R11_EAC:case Cs.COMPRESSED_SIGNED_R11_EAC:case Cs.COMPRESSED_RGB8_ETC2:case Cs.COMPRESSED_SRGB8_ETC2:case Cs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Cs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Cs.COMPRESSED_RG11_EAC:case Cs.COMPRESSED_SIGNED_RG11_EAC:case Cs.COMPRESSED_RGBA8_ETC2_EAC:case Cs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const Z$=()=>ae.getLogger("esri.views.webgl.VertexArrayObject");let Bh=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Fpe}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=ft(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Z$().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(ks.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r,this._context.instanceCounter.increment(ks.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||Z$().error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Z$().error("Vertex buffer is uninitialized!");const a=r[n];a||Z$().error("Vertex element descriptor is empty!"),vZ(this._context,this._locations,o,a)}i!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},Dp=class extends Bh{};const Y0=()=>ae.getLogger("esri.views.webgl.BufferObject");let qr=class jv{static createIndex(e,r,i){return new jv(e,mt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new jv(e,mt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){return new jv(e,mt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Pr.STREAM_READ,i){const s=new jv(e,mt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=Pr.STREAM_DRAW,i){return new jv(e,mt.PIXEL_UNPACK_BUFFER,r,i)}static createTransformFeedback(e,r=Pr.STATIC_DRAW,i){const s=new jv(e,mt.TRANSFORM_FEEDBACK_BUFFER,r);return s.setSize(i),s}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(ks.BufferObject,this),this._glName=this._context.gl.createBuffer(),zf(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===mt.ELEMENT_ARRAY_BUFFER?this._indexType===Te.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===mt.ELEMENT_ARRAY_BUFFER||this.bufferType===mt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(ks.BufferObject,this),this._context=null):this._glName&&Y0().warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Y0().error("Buffer size needs to be positive!"),this.bufferType===mt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Te.UNSIGNED_SHORT:e*=2;break;case Te.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===mt.ELEMENT_ARRAY_BUFFER&&(n6(e)&&(r/=2,this._indexType=Te.UNSIGNED_SHORT),o6(e)&&(r/=4,this._indexType=Te.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),zf(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.usedMemory)&&Y0().error("offset is out of range!"),i>=s&&Y0().error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.usedMemory&&Y0().error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i),zf(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(i<0||s<0)return void Y0().error("Problem getting subdata: offset and length were less than zero!");const n=aWe(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void Y0().error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.usedMemory&&Y0().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===mt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,mt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(mt.TRANSFORM_FEEDBACK_BUFFER,r,e,i,s),this._context.unbindBuffer(mt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,mt.COPY_READ_BUFFER),o.getBufferSubData(mt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(mt.COPY_READ_BUFFER))}async getSubDataAsync(e,r=0,i,s){await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)}};function aWe(t){return D$e(t)}var Z_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(Z_||(Z_={}));let oi=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=_s.TEXTURE_2D,this.pixelFormat=wt.RGBA,this.dataType=An.UNSIGNED_BYTE,this.samplingMode=Gt.LINEAR,this.wrapMode=Xt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function lWe(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:bZ(t.internalFormat)))}let cWe=class nwe extends oi{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case tt.R16F:case tt.R16I:case tt.R16UI:case tt.R32F:case tt.R32I:case tt.R32UI:case tt.R8_SNORM:case tt.R8:case tt.R8I:case tt.R8UI:this.pixelFormat=wt.RED}}static validate(e,r){return new nwe(e,r)}};const Uie=4;let Sr=class Yu{constructor(e,r=null,i=null){if(this.type=Z_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=cWe.validate(e,r);if(!s)throw new J("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===_s.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return lWe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(ks.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new J("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===_s.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=_s.TEXTURE_CUBE_MAP_POSITIVE_X;r<=_s.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const i=this._descriptor.context.gl;zf(i),this._glName||(this._glName=i.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(ks.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=YC(n);e===null&&(s.width=s.width||Uie,s.height=s.height||Uie,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Yu.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Yu.TEXTURE_UNIT_FOR_UPDATES),jU(s),this._configurePixelStorage(),zf(i);const l=this._deriveInternalFormat();if(Vie(e)){let u="width"in e?e.width:e.codedWidth,h="height"in e?e.height:e.codedHeight;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,h=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,h,p),this._texImage(n,0,l,u,h,p,e),zf(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=u),s.height||(s.height=h),o&&!s.depth&&(s.depth=p)}else{const{width:u,height:h,depth:p}=s;if(u==null||h==null)throw new J("Width and height must be specified!");if(o&&p==null)throw new J("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,h,p),sN(e)){const f=e.levels,g=Gie(n,u,h,p),_=Math.min(g-1,f.length-1);i.texParameteri(s.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,_);const v=l;if(!dWe(v))throw new J("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((b,w,T,S)=>{const C=f[Math.min(b,f.length-1)];this._compressedTexImage(n,b,v,w,T,S,C)},_)}else this._texImage(n,0,l,u,h,p,e),zf(i),s.hasMipmap&&this.generateMipmap()}zie(i,this._descriptor),Bie(i,this._descriptor),uWe(this._descriptor.context,this._descriptor),zf(i),this._descriptor.context.bindTexture(a,Yu.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:h,dataType:p,target:f,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new J("Cannot update immutable texture before allocation!");const _=u.bindTexture(this,Yu.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||i<0||s>l.width||n>l.height||r+s>l.width||i+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),Vie(o)?v.texSubImage2D(f,e,r,i,s,n,h,p,o):sN(o)?v.compressedTexSubImage2D(f,e,r,i,s,n,c,o.levels[e]):v.texSubImage2D(f,e,r,i,s,n,h,p,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(_,Yu.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:f,isImmutable:g,target:_}=c;if(g&&!this._wasImmutablyAllocated)throw new J("Cannot update immutable texture before allocation!");YC(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,Yu.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(Yu.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>c.width||o>c.height||a>c.depth||r+n>c.width||i+o>c.height||s+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=h;if(sN(l))l=l.levels[e],b.compressedTexSubImage3D(_,e,r,i,s,n,o,a,u,l);else{const w=l;b.texSubImage3D(_,e,r,i,s,n,o,a,p,f,w)}h.bindTexture(v,Yu.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new J("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,jU(e)}e.samplingMode===Gt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Gt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Gt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Gt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Yu.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Yu.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Yu.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,jU(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,r=e.context.gl;this._samplingModeDirty&&(zie(r,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(Bie(r,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===wt.DEPTH_STENCIL&&(this._descriptor.internalFormat=wt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case An.FLOAT:switch(this._descriptor.pixelFormat){case wt.RGBA:return this._descriptor.internalFormat=tt.RGBA32F;case wt.RGB:return this._descriptor.internalFormat=tt.RGB32F;default:throw new J("Unable to derive format")}case An.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case wt.RGBA:return this._descriptor.internalFormat=tt.RGBA8;case wt.RGB:return this._descriptor.internalFormat=tt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===wt.DEPTH_STENCIL?wt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const{gl:a}=this._descriptor.context;if(!hWe(r))throw new J("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Gie(e,s,n,o):1;if(YC(e)){if(o==null)throw new J("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=YC(e),{isImmutable:u,pixelFormat:h,dataType:p}=this._descriptor;if(u){if(a!=null){const f=a;if(c){if(o==null)throw new J("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,r,0,0,0,s,n,o,h,p,f)}else l.texSubImage2D(e,r,0,0,s,n,h,p,f)}}else{const f=a;if(c){if(o==null)throw new J("Missing depth dimension for 3D texture upload");l.texImage3D(e,r,i,s,n,o,0,h,p,f)}else l.texImage2D(e,r,i,s,n,0,h,p,f)}}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=YC(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new J("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(c){if(o==null)throw new J("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===_s.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new J("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function jU(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function zie(t,e){let r=e.samplingMode,i=e.samplingMode;r===Gt.LINEAR_MIPMAP_NEAREST||r===Gt.LINEAR_MIPMAP_LINEAR?(r=Gt.LINEAR,e.hasMipmap||(i=Gt.LINEAR)):r!==Gt.NEAREST_MIPMAP_NEAREST&&r!==Gt.NEAREST_MIPMAP_LINEAR||(r=Gt.NEAREST,e.hasMipmap||(i=Gt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function Bie(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function uWe(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function hWe(t){return t in tt}function dWe(t){return t in Cs}function sN(t){return t!=null&&"type"in t&&t.type==="compressed"}function pWe(t){return t!=null&&"byteLength"in t}function Vie(t){return t!=null&&!sN(t)&&!pWe(t)}function YC(t){return t===_s.TEXTURE_3D||t===_s.TEXTURE_2D_ARRAY}function Gie(t,e,r,i=1){let s=Math.max(e,r);return t===_s.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Sr.TEXTURE_UNIT_FOR_UPDATES=0;function Im(t,e=_Z,r=Mr,i=-1,s=1){let n=null;return e===vR?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Dp(t,r,{geometry:e},{geometry:qr.createVertex(t,Pr.STATIC_DRAW,n)})}const fWe=4;function owe(t){const e=new oi(fWe);return e.samplingMode=Gt.NEAREST,new Sr(t,e)}const M5=16;function sw(t){return Math.ceil(t/M5)*M5}function mWe(t){return Math.floor(t/M5)*M5}function gWe(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?awe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return wZ(t,o,a)}function yWe(t,e){const r=Math.max(t.width,t.height);if(r<=e)return t;const i=e/r;return wZ(t,Math.round(t.width*i),Math.round(t.height*i))}function wZ(t,e,r){if(t instanceof ImageData)return wZ(awe(t),e,r);const i=document.createElement("canvas");return i.width=e,i.height=r,i.getContext("2d").drawImage(t,0,0,i.width,i.height),i}function awe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");if(r==null)throw new J("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(t,0,0),e}function Ta(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let xZ=class extends Ci{};function lwe(t){const e=new Or;e.include(Ta),e.fragment.uniforms.add(new at("colorTexture",i=>i.color),new at("depthTexture",i=>i.depth));const r=t.haze;return e.fragment.code.add(x`
    void main() {
      ${r?x`vec4`:x`float`} depthSample = texture(depthTexture, uv) ${r?"":x`.r`};
      if (depthSample ${r?x`== vec4(0)`:x`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const _We=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:xZ,build:lwe},Symbol.toStringTag,{value:"Module"}));let cwe=class uwe extends Gr{initializeProgram(e){return new Dr(e.rctx,uwe.shader.get().build(this.configuration),Mr)}initializePipeline(){return this.configuration.haze?Nt({blending:Po(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),depthTest:{func:Qr.ALWAYS},colorWrite:qt}):Nt({blending:Pc(Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.ALWAYS},colorWrite:qt})}};cwe.shader=new Lr(_We,()=>me(()=>Promise.resolve().then(()=>eAt),void 0));let jie=class{constructor(e,r){this._view=e,this._context=r,this.type=ra.Realistic,this._handles=new c1,this._compositingPassParameters=new xZ,this._atmosphereConfiguration=new P5,this._passParameters=new sWe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Kr.radius,this._fadeHaze=0,this._updateRadius(Kr.radius);const i=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([he(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),he(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null}),he(()=>{var n;return(n=this._view)==null?void 0:n.environment.background},n=>{const o=n instanceof Tbe?uO(n.color):_u;te(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},si)]);const s=new P5;s.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(TA,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(TA,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(TA,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(TA,s),this._vao=Im(i,vR)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){var s;this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,(s=e.bindParameters.linearDepth)==null?void 0:s.getTexture(),i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=Se(e.bindParameters.camera.eye)-Kr.radius;let u;if(c<Xy){const _=Math.min(1,Math.max(0,c/Xy));u=n?Pt(.4,.5,_):Pt(.2,.3,_)}else{const _=Math.min(1,Math.max(0,(c-Xy)/(15*Xy)));u=n?Pt(.5,1,_):Pt(.3,.6,_)}const h=sw(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=sw(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,h,p);const f=o.renderToCachedFBO(null,"chapman",()=>this._renderCommon(a,e),[0,0,0,1],ji.RGBA,null,h,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=f.getTexture(),this._compositingPassParameters.depth=i,this._atmosphereConfiguration.haze=n;const g=this._context.techniqueRepository.acquire(cwe,this._atmosphereConfiguration);e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),o.renderDepthDetached(()=>e.rctx.screen.draw()),g.release(),f.release()}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(sr.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Kr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Kr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,cr(this._passParameters.radii,e,e+Xy),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-Oj)*Oj)}_update(e){if(!e)return;const r=pa(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=we((i-this._passParameters.radii[0])/Xy,0,1);es(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=gZ(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Pt(Pt(.6,1,zM(9500,10500,i-Kr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function hwe(t){t.fragment.code.add(x`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function TZ(t,e){switch(t.include(om,e),e.textureCoordinateType){case rs.Default:case rs.Compressed:return void t.fragment.code.add(x`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case rs.Atlas:return t.include(hwe),void t.fragment.code.add(x`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case rs.None:case rs.COUNT:return}}let bu=class extends ps{constructor(e,r){super(e,"vec3",Rr.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},Ch=class extends ps{constructor(e,r){super(e,"sampler2D",Rr.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},_1=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return X_.LOADED}},SZ=class extends _1{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=er(this._texture),this._textureNormal=er(this._textureNormal),this._textureEmissive=er(this._textureEmissive),this._textureOcclusion=er(this._textureOcclusion),this._textureMetallicRoughness=er(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?X_.LOADED:X_.LOADING}get textureBindParameters(){return new dwe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=er(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Rc(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return er(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},dwe=class extends Ci{constructor(e=null,r=null,i=null,s=null,n=null,o,a){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var nt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(nt||(nt={}));function EZ(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===nt.Normal&&i&&t.include(TZ,e),e.pbrMode!==nt.Schematic)if(e.pbrMode!==nt.Disabled){if(e.pbrMode===nt.Normal){r.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===Rr.Pass?new at("texMetallicRoughness",n=>n.textureMetallicRoughness):new Ch("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(x`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===Rr.Pass?new at("texEmission",n=>n.textureEmissive):new Ch("texEmission",n=>n.textureEmissive)),r.code.add(x`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===Rr.Pass?new at("texOcclusion",n=>n.textureOcclusion):new Ch("texOcclusion",n=>n.textureOcclusion)),r.code.add(x`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(x`float getBakedOcclusion() { return 1.0; }`),s===Rr.Pass?r.uniforms.add(new Dt("emissionFactor",n=>n.emissiveFactor),new Dt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new bu("emissionFactor",n=>n.emissiveFactor),new bu("mrrFactors",n=>n.mrrFactors)),r.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?x`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?x`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?x`applyEmission(${e.hasEmissiveTextureTransform?x`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?x`applyOcclusion(${e.hasOcclusionTextureTransform?x`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(x`float getBakedOcclusion() { return 1.0; }`);else r.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function CZ(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Dt("lightingAmbientSH0",(s,n)=>te(Hie,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new wr("lightingAmbientSH_R",(s,n)=>es(jm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new wr("lightingAmbientSH_G",(s,n)=>es(jm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new wr("lightingAmbientSH_B",(s,n)=>es(jm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Dt("lightingAmbientSH0",(s,n)=>te(Hie,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new wr("lightingAmbientSH_R1",(s,n)=>es(jm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new wr("lightingAmbientSH_G1",(s,n)=>es(jm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new wr("lightingAmbientSH_B1",(s,n)=>es(jm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new wr("lightingAmbientSH_R2",(s,n)=>es(jm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new wr("lightingAmbientSH_G2",(s,n)=>es(jm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new wr("lightingAmbientSH_B2",(s,n)=>es(jm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==nt.Normal&&e.pbrMode!==nt.Schematic||r.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Hie=E(),jm=Yt();function bR(t){t.vertex.code.add(x`const float PI = 3.141592653589793;`),t.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Yf,Uw;function vWe(t){return(t==null?void 0:t.cubeMap)!=null}function bWe(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(Yf||(Yf={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(Uw||(Uw={}));function x0(t=fwe){return[t[0],t[1],t[2],t[3]]}function nN(t,e,r=x0()){return ce(r,t),r[3]=e,r}function qie(t,e,r=Yt()){return Ze(r,t,e),fe(r,r),r[3]=-jfe(t,e),r}function eLt(t,e=x0()){const r=rye(SA,t);return pwe(e,ga(ck(e,r))),e}function Wie(t,e,r=x0()){return tO(SA,t,kj(t)),tO(Yie,e,kj(e)),uk(SA,Yie,SA),pwe(r,ga(ck(r,SA)))}function tLt(t,e,r,i=x0()){return nN(aY,t,J$),nN(lY,e,Xie),nN($S,r,Zie),Wie(J$,Xie,J$),Wie(J$,Zie,i),i}function rLt(t){return t}function wWe(t){return t[3]}function kj(t){return Lt(t[3])}function pwe(t,e){return t[3]=e,t}const fwe=[0,0,1,0],SA=$c(),Yie=$c();x0();const J$=x0(),Xie=x0(),Zie=x0();var Br;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Br||(Br={}));let xWe=class{constructor(){this.readChannels=Uw.RG,this.renderingStage=Yf.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=E(),this.parallax=new Jie,this.parallaxNew=new Jie,this.pointOnGround=E(),this.fadeMode=Mi.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const r=this.parallax,i=Se(e.eye);if(r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-Kr.radius*Kr.radius,0))/i,qie(Kie,r.anchorPointClouds,Ox),bc(r.transform,ts,Ox[3],Ox),this.fadeMode===Mi.CROSS_FADE){const s=this.parallaxNew;qie(Kie,s.anchorPointClouds,Ox),bc(s.transform,ts,Ox[3],Ox)}}updateFading(e,r,i,s){this.isFading&&this._advanceFading(i,s),this._evaluateFading(e,r,i)}_evaluateFading(e,r,i){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*Mg||s<-Mg||n>AWe)&&this.opacity>0)this._setFade(Mi.HIDE,i);else if(!this.isFading){if((s>Mg||s<-.35*Mg||n>CWe)&&this.opacity>0)this._setFade(Mi.FADE_OUT,i);else if(s<=Mg&&s>=-.35*Mg&&r===Br.IDLE&&bWe(this.data)){if(this.opacity===0)return void this._setFade(Mi.FADE_IN,i);(n>EWe||this.renderingStage===Yf.FADING)&&this._setFade(Mi.CROSS_FADE,i)}}}_advanceFading(e,r){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,r)}_advanceFadingFactorAndOpacity(e,r){if(this.fadeFactor<1)return this.fadeFactor=r?we((e-this.startTime)/(SWe*r),0,1):1,this.fadeMode===Mi.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===Mi.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===Mi.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===Mi.FADE_OUT&&(this.opacity=0),this.fadeMode===Mi.FADE_IN&&(this.opacity=1),this.fadeMode===Mi.CROSS_FADE&&(this.opacity=1),this.fadeMode=Mi.NONE}_switchReadChannels(){const e=this.fadeMode===Mi.CROSS_FADE&&this.fadeFactor===1,r=this.fadeMode===Mi.FADE_IN&&this.fadeFactor===0;this.renderingStage===Yf.FADING&&(e||r)&&(this.readChannels=1-this.readChannels,this.renderingStage=Yf.FINISHED)}_calculateDistanceToAnchorPoint(e){return fe(this.pointOnGround,e.eye),re(this.pointOnGround,this.pointOnGround,Kr.radius),Se(ye(TWe,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===Mi.CROSS_FADE&&(this.fadeFactor===0&&ce(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ce(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===Mi.FADE_IN&&this.fadeFactor===0&&ce(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,r){switch(e){case Mi.HIDE:this.opacity=0;break;case Mi.FADE_OUT:this.opacity=1;break;case Mi.FADE_IN:this.opacity=0;break;case Mi.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=r}get isFading(){return this.fadeMode===Mi.FADE_OUT||this.fadeMode===Mi.FADE_IN||this.fadeMode===Mi.CROSS_FADE}};var Mi;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(Mi||(Mi={}));let Jie=class{constructor(){this.anchorPointClouds=E(),this.radiusCurvatureCorrectionFactor=0,this.transform=xe()}};const Kie=Pe(0,0,1),Ox=x0(),TWe=E(),SWe=1.25,EWe=34e3,CWe=64e3,AWe=2e5;let am=class extends ps{constructor(e,r){super(e,"bool",Rr.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},PWe=class extends ps{constructor(e,r){super(e,"samplerCube",Rr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function mwe(t){const e=t.fragment;e.uniforms.add(new is("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new is("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Dt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Dt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ie("cloudsHeight",()=>IHe),new Ie("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ie("totalFadeInOut",(r,i)=>1-i.cloudsFade.opacity),new Ie("crossFadeAnchorFactor",(r,i)=>we(i.cloudsFade.fadeFactor,0,1)),new PWe("cubeMap",(r,i)=>{var s,n;return((n=(s=i.cloudsFade.data)==null?void 0:s.cubeMap)==null?void 0:n.colorTexture)??null}),new am("crossFade",(r,i)=>i.cloudsFade.fadeMode===Mi.CROSS_FADE),new am("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===Uw.RG),new am("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Yf.FADING)),e.constants.add("planetRadius","float",Kr.radius),e.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),w0(e),Om(e),e.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(x`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Lm(t){t.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function gwe(){const t=new Or,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(O.POSITION,"vec2"),r.add("worldRay","vec3"),i.uniforms.add(new is("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new is("inverseViewMatrix",(n,o)=>YE(MWe,o.camera.viewMatrix))),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(Lm),s.include(Yh),t.include(CZ,{pbrMode:nt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(bR),t.include(Mk),t.include(E5),t.include(mwe),s.uniforms.add(new Dt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const MWe=xe(),OWe=Object.freeze(Object.defineProperty({__proto__:null,build:gwe},Symbol.toStringTag,{value:"Module"}));let ywe=class _we extends Gr{constructor(e){super(e,new zl,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,_we.shader.get().build(),Mr)}initializePipeline(){return Nt({blending:Po(Ee.ONE,Ee.ZERO,Ee.SRC_ALPHA,Ee.ONE),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};ywe.shader=new Lr(OWe,()=>me(()=>Promise.resolve().then(()=>tAt),void 0));let Hv=class extends Me{constructor(e){super(e),this._technique=new ywe(e),this._vao=Im(e.rctx)}destroy(){this._technique=er(this._technique),this._vao=ft(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;const i=e.rctx.bindTechnique(this._technique,e.bindParameters,RWe);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(sr.TRIANGLE_STRIP,0,4)}};d([m({constructOnly:!0})],Hv.prototype,"rctx",void 0),d([m({constructOnly:!0})],Hv.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],Hv.prototype,"planetRadius",void 0),d([m({constructOnly:!0})],Hv.prototype,"requestRender",void 0),Hv=d([V("esri.views.3d.environment.CloudsComposition")],Hv);const RWe=new Ci;function gc(){return new Float32Array(3)}function Uj(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function mi(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function $We(t,e){return new Float32Array(t,e,3)}function AZ(){return gc()}function vwe(){return mi(1,1,1)}function bwe(){return mi(1,0,0)}function wwe(){return mi(0,1,0)}function xwe(){return mi(0,0,1)}const IWe=AZ(),LWe=vwe(),DWe=bwe(),NWe=wwe(),FWe=xwe();Object.freeze(Object.defineProperty({__proto__:null,ONES:LWe,UNIT_X:DWe,UNIT_Y:NWe,UNIT_Z:FWe,ZEROS:IWe,clone:Uj,create:gc,createView:$We,fromValues:mi,ones:vwe,unitX:bwe,unitY:wwe,unitZ:xwe,zeros:AZ},Symbol.toStringTag,{value:"Module"}));var Ml;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Ml||(Ml={}));let oN=class extends zl{constructor(){super(...arguments),this.steps=Ml.SIXTEEN,this.writeTextureChannels=Uw.RG}};d([G({count:Ml.COUNT})],oN.prototype,"steps",void 0),d([G({constValue:se("esri-mobile")?1024:2048})],oN.prototype,"cubeMapSize",void 0),d([G()],oN.prototype,"writeTextureChannels",void 0);let EA=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Qie=new EA([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Ml.SIXTEEN),ta={sunny:Qie,cloudy:new EA([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Ml.TWOHUNDRED,.6),rainy:new EA([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Ml.TWOHUNDRED,.4),snowy:new EA([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Ml.HUNDRED,.65),foggy:new EA([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Ml.SIXTEEN),default:Qie},ah=se("esri-mobile")?64:128,kWe=ah/128,Id=Math.ceil(Math.sqrt(ah)),C_=(ah+2)*Id,UWe=1e5,HU=128,zWe=C_/1560;let Mu=class extends ps{constructor(e,r){super(e,"mat3",Rr.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},PZ=class extends Ci{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ta.default.raymarchingSteps,this.weatherTile=je(),this.viewMatrix=xi()}};function Twe(t){const e=new Or;e.include(Ta,!1);const r=e.fragment;return r.uniforms.add(new Ie("cloudRadius",i=>i.cloudRadius),new Ie("power",i=>Pt(35,120,i.absorption)),new Ie("sigmaE",i=>1+i.absorption),new Ie("density",i=>Pt(0,.3,i.density)),new Ie("cloudSize",i=>Pt(0,.02,Math.max(.01,1-i.cloudSize))),new Ie("detailSize",i=>Pt(0,.2,Math.max(.01,1-i.detailSize))),new Ie("smoothness",i=>Pt(0,.5,1-i.smoothness)),new Ie("cloudHeight",i=>Pt(0,1500,i.cloudHeight)),new Ie("coverage",i=>i.coverage),new Mu("view",i=>i.viewMatrix),new at("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new ni("cloudVariables",i=>cr(BWe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(x`
    const int STEPS = ${t.steps===Ml.SIXTEEN?x`16`:t.steps===Ml.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(C_)};
      const float dataWidth = ${x.float(C_)};
      const float tileRows = ${x.float(Id)};
      const vec3 atlasDimensions = vec3(${x.float(ah)}, ${x.float(ah)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(kWe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${x.float(zWe)} * p) / ${x.float(C_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(x`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(x`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(x`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const BWe=je(),VWe=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:PZ,build:Twe},Symbol.toStringTag,{value:"Module"}));let Swe=class Ewe extends Gr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,Ewe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:Pc(Ee.CONSTANT_COLOR,Ee.ONE_MINUS_CONSTANT_COLOR,wm.ADD,this.configuration.writeTextureChannels===Uw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};Swe.shader=new Lr(VWe,()=>me(()=>Promise.resolve().then(()=>rAt),void 0));var lu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(lu||(lu={}));let zj=class extends zl{constructor(){super(...arguments),this.mode=lu.Full}};d([G({count:lu.COUNT})],zj.prototype,"mode",void 0);let MZ=class extends Ci{constructor(){super(...arguments),this.weatherTile=ar(0,0)}};function Cwe(t){const e=new Or;return e.include(Ta,!1),e.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===lu.Full&&e.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(Id)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new ni("weatherTile",r=>r.weatherTile)),e.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(HU)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(HU)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(UWe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(x`void main() {`),t.mode===lu.Full&&e.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(ah)} + 2.0 * padWidth;
        float tileCount = ${x.float(Id)} * ${x.float(Id)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(ah)};
          }

          if (startPadY) {
            pixel.y += ${x.float(ah)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(ah)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(ah)};
          }

          uv = vec2(pixel.xy / ${x.float(ah)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(ah)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(Id)} * ${x.float(Id)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(Id)} * ${x.float(Id)});
        p = p_;
        p.z /= (${x.float(Id)} * ${x.float(Id)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(x`
      vec2 mapUV = ${x.float(HU)} * (gl_FragCoord.xy / ${x.float(C_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===lu.Full?x`fragColor.ba = vec2(0.0, map);`:x`fragColor = vec4(map);`};
    }
  `),e}const GWe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:MZ,build:Cwe},Symbol.toStringTag,{value:"Module"}));let Bj=class Awe extends Gr{initializeProgram(e){return new Dr(e.rctx,Awe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:this.configuration.mode===lu.Full?Pc(Ee.ONE,Ee.ZERO):Po(Ee.ZERO,Ee.ONE,Ee.ONE,Ee.ZERO),depthTest:{func:Qr.ALWAYS},colorWrite:qt})}};Bj.shader=new Lr(GWe,()=>me(()=>Promise.resolve().then(()=>iAt),void 0));let Pwe=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function jWe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*bZ(t.internalFormat)}let Mwe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=Z_.RenderBuffer,this._context.instanceCounter.increment(ks.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;a?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n):i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get usedMemory(){return jWe(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(ks.Renderbuffer,this),this._context=null)}};const HWe=()=>ae.getLogger("esri.views.webgl.FramebufferObject");let Np=class CA{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(ks.FramebufferObject,this);const s=aN(r)?r:new Sr(this._context,r);if(this._colorAttachments.set(Ua.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(Ua.COLOR_ATTACHMENT0),i!=null)if(WWe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=aN(i)?i:new Sr(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=qWe(i)?i:new Mwe(this._context,i);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(ks.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Ua.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(Ua.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(Ua.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((r,[i,s])=>r+s.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&aN(r)?r:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,r=Ua.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(s=this.detachColorTexture(r))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=Ua.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r){if(this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(i)}return this._colorAttachments.delete(e),r}}setColorTextureTarget(e,r=Ua.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case Z_.Texture:return this._attachDepthStencilTexture(e);case Z_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==wt.DEPTH_STENCIL&&r.pixelFormat!==wt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==An.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,uE)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,uE)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(na.FRAMEBUFFER,s,i.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(na.FRAMEBUFFER,i,r.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==_s.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Sr.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Sr.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(_s.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(u,Sr.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){const{gl:l}=this._context,c=qr.createPixelPack(this._context,Pr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(mt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var s,n;if(this.width===e&&this.height===r)return;const i={width:e,height:r};kb(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(i.width,i.height)),(s=this._depthStencilTexture)==null||s.resize(i.width,i.height),this._initialized&&(kb(i,this._context.parameters.maxRenderbufferSize),(n=this._depthStencilBuffer)==null||n.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=na.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();if(r.bindFramebuffer(e,i),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,ese(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);r.framebufferRenderbuffer(e,s,r.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,ese(this._depthStencilTexture),e);zd()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=Ua.COLOR_ATTACHMENT0,i=_s.TEXTURE_2D,s=na.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(na.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthStencilBuffer=ft(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=ft(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==_s.TEXTURE_2D&&e.target!==_s.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),kb(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){kb(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case ko.DEPTH_COMPONENT16:case ko.DEPTH_COMPONENT24:case ko.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case ko.DEPTH24_STENCIL8:case ko.DEPTH32F_STENCIL8:case ko.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case ko.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(CA._MAX_COLOR_ATTACHMENTS===-1){const{gl:i}=this._context;CA._MAX_COLOR_ATTACHMENTS=i.getParameter(i.MAX_COLOR_ATTACHMENTS)}const r=e-Ua.COLOR_ATTACHMENT0;r+1>CA._MAX_COLOR_ATTACHMENTS&&ae.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${CA._MAX_COLOR_ATTACHMENTS} color attachments`)}};function aN(t){return t!=null&&"type"in t&&t.type===Z_.Texture}function qWe(t){return t!=null&&"type"in t&&t.type===Z_.RenderBuffer}function WWe(t){return aN(t)||t!=null&&"pixelFormat"in t}function kb(t,e){const r=Math.max(t.width,t.height);if(r>e){HWe().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function ese(t){return t.descriptor.target===_s.TEXTURE_CUBE_MAP?_s.TEXTURE_CUBE_MAP_POSITIVE_X:_s.TEXTURE_2D}Np._MAX_COLOR_ATTACHMENTS=-1;let AA=class extends Me{constructor(e){super(e),this._needsRender=!0,this._passParameters=new MZ,this._fbo=new Np(e.context.renderContext.rctx,new oi(C_)),this._vao=Im(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(lu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(lu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Vn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=er(this._fullTechniqueCached),this._weatherMapTechniqueCached=er(this._weatherMapTechniqueCached),this._fbo=ft(this._fbo),this._vao=ft(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new zj;e.mode=lu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(Bj,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new zj;e.mode=lu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(Bj,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const r=e===lu.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,C_,C_),i.bindFramebuffer(this._fbo);const n=i.bindTechnique(r,null,this._passParameters);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._fbo.colorTexture}};d([m({constructOnly:!0})],AA.prototype,"context",void 0),d([m({readOnly:!0})],AA.prototype,"_techniqueRepository",null),AA=d([V("esri.views.3d.environment.NoiseTextureAtlas")],AA);var sc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(sc||(sc={}));function Owe(t){t.include(bm),t.uniforms.add(new at("geometryDepthTexture",(e,r)=>{var i;return(i=r.multipassGeometry.linearDepth)==null?void 0:i.getTexture()}),new ni("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let YWe=class{};function Oc(t,e){if(!e.multipassEnabled)return;t.fragment.include(bm),t.fragment.uniforms.add(new at("terrainDepthTexture",(i,s)=>{var n;return(n=s.multipassTerrain.linearDepth)==null?void 0:n.getTexture()}),new ni("nearFar",(i,s)=>s.camera.nearFar));const r=e.occlusionPass;t.fragment.code.add(x`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${r?x`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:x`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let XWe=class{constructor(){this.cullAboveGround=!1}};function Rk(t){return t?{ray:Un(t.ray),c0:t.c0,c1:t.c1}:{ray:Un(),c0:0,c1:Number.MAX_VALUE}}function ZWe(t,e=Rk()){return s5(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function JWe(t,e,r=Rk()){const i=Se(t.vector);return Lye(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function vLt(t,e){return Rwe(t,t.c0,e)}function bLt(t,e){return Rwe(t,t.c1,e)}function Rwe(t,e,r){return pe(r,t.ray.origin,re(r,t.ray.direction,e))}new g0(()=>Rk());function dO(t){return t?[zr(t[0]),zr(t[1]),zr(t[2]),zr(t[3]),zr(t[4]),zr(t[5])]:[zr(),zr(),zr(),zr(),zr(),zr()]}function $we(){return[E(),E(),E(),E(),E(),E(),E(),E()]}function O5(t,e){for(let r=0;r<iC;r++)Z6(t[r],e[r]);return t}function Iwe(t,e,r,i=iYe){const s=ri(oX.get(),e,t);cn(s,s);for(let n=0;n<tYe;++n){const o=wc(nX.get(),rYe[n],s);te(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Lwe(r,i)}function Lwe(t,e){ha(e[st.FAR_BOTTOM_LEFT],e[st.NEAR_BOTTOM_LEFT],e[st.NEAR_TOP_LEFT],t[ci.LEFT]),ha(e[st.NEAR_BOTTOM_RIGHT],e[st.FAR_BOTTOM_RIGHT],e[st.FAR_TOP_RIGHT],t[ci.RIGHT]),ha(e[st.FAR_BOTTOM_LEFT],e[st.FAR_BOTTOM_RIGHT],e[st.NEAR_BOTTOM_RIGHT],t[ci.BOTTOM]),ha(e[st.NEAR_TOP_LEFT],e[st.NEAR_TOP_RIGHT],e[st.FAR_TOP_RIGHT],t[ci.TOP]),ha(e[st.NEAR_BOTTOM_LEFT],e[st.NEAR_BOTTOM_RIGHT],e[st.NEAR_TOP_RIGHT],t[ci.NEAR]),ha(e[st.FAR_BOTTOM_RIGHT],e[st.FAR_BOTTOM_LEFT],e[st.FAR_TOP_LEFT],t[ci.FAR])}function y_(t,e){for(let r=0;r<iC;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function KWe(t,e){return Nwe(t,ZWe(e,Fwe.get()))}function wLt(t,e){for(let r=0;r<iC;r++){const i=t[r];if(!x8e(i,e))return!1}return!0}function QWe(t,e,r){return Nwe(t,JWe(e,r,Fwe.get()))}function Dwe(t,e){for(let r=0;r<iC;r++)if(bi(t[r],e)>0)return!1;return!0}function Nwe(t,e){for(let r=0;r<iC;r++)if(!w8e(t[r],e))return!1;return!0}var ci,st;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(ci||(ci={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(st||(st={}));const eYe={bottom:[st.FAR_BOTTOM_RIGHT,st.NEAR_BOTTOM_RIGHT,st.NEAR_BOTTOM_LEFT,st.FAR_BOTTOM_LEFT],near:[st.NEAR_BOTTOM_LEFT,st.NEAR_BOTTOM_RIGHT,st.NEAR_TOP_RIGHT,st.NEAR_TOP_LEFT],far:[st.FAR_BOTTOM_RIGHT,st.FAR_BOTTOM_LEFT,st.FAR_TOP_LEFT,st.FAR_TOP_RIGHT],right:[st.NEAR_BOTTOM_RIGHT,st.FAR_BOTTOM_RIGHT,st.FAR_TOP_RIGHT,st.NEAR_TOP_RIGHT],left:[st.FAR_BOTTOM_LEFT,st.NEAR_BOTTOM_LEFT,st.NEAR_TOP_LEFT,st.FAR_TOP_LEFT],top:[st.FAR_TOP_LEFT,st.NEAR_TOP_LEFT,st.NEAR_TOP_RIGHT,st.FAR_TOP_RIGHT]},iC=6,tYe=8,rYe=[zt(-1,-1,-1,1),zt(1,-1,-1,1),zt(1,1,-1,1),zt(-1,1,-1,1),zt(-1,-1,1,1),zt(1,-1,1,1),zt(1,1,1,1),zt(-1,1,1,1)],Fwe=new g0(Rk),iYe=$we();function sYe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function nYe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function oYe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function aYe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var Vj;let Je=Vj=class extends Me{constructor(t){super(t),this._ray=Un(),this._viewport=zt(0,0,1,1),this._padding=zt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ar(1,1e3),this._viewDirty=!0,this._viewMatrix=xe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=xe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=xe(),this._frustumDirty=!0,this._frustum=dO(),this._fullViewport=Yt(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=E(),this._up=E(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ye(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Bs(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),te(E(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),te(E(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),te(E(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Rw(Yt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&$w(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=Rw(Yt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&$w(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Kt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Kt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Kt.RIGHT]+this._padding[Kt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Kt.RIGHT]+this._padding[Kt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Kt.TOP]+this._padding[Kt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Kt.TOP]+this._padding[Kt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Kt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Kt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){eS(this._padding,t)||(this._viewport[0]+=t[Kt.LEFT]-this._padding[Kt.LEFT],this._viewport[1]+=t[Kt.BOTTOM]-this._padding[Kt.BOTTOM],this._viewport[2]-=t[Kt.RIGHT]+t[Kt.LEFT]-(this._padding[Kt.RIGHT]+this._padding[Kt.LEFT]),this._viewport[3]-=t[Kt.TOP]+t[Kt.BOTTOM]-(this._padding[Kt.TOP]+this._padding[Kt.BOTTOM]),xh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(ri(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,s=r/this.rows,n=i/this.columns,o=-i/2+this.column*n,a=o+n,l=-r/2+this.row*s,c=l+s,u=sye(xe(),o*(1+2*this._padding[Kt.LEFT]/t),a*(1+2*this._padding[Kt.RIGHT]/t),l*(1+2*this._padding[Kt.BOTTOM]/e),c*(1+2*this._padding[Kt.TOP]/e),this.near,this.far),h=this._get("projectionMatrix");return h&&q6(h,u)?h:u}get inverseProjectionMatrix(){return cn(xe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||xe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return oYe(this._fov,this.width,this.height)}set fovX(t){this._fov=sYe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return aYe(this._fov,this.width,this.height)}set fovY(t){this._fov=nYe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return $i(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(cn(this._viewInverseTransposeMatrix,this.viewMatrix),Ac(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ce(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,xh(this._viewport,t.viewport),this.notifyChange("_viewport"),xh(this._padding,t.padding),this.notifyChange("_padding"),Vn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Bs(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(O5(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Bs(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),xh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Vj().copyFrom(this)}equals(t){return To(this.eye,t.eye)&&To(this.center,t.center)&&To(this.up,t.up)&&eS(this._viewport,t.viewport)&&eS(this._padding,t.padding)&&Fbe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||r5(t.screenPadding,this.screenPadding)>=e||r5(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Hi(Zo,t.eye,t.center),Hi(qU,this.eye,this.center);const r=de(Zo,qU),i=C4(Zo),s=C4(qU),n=5e-4;return r*r>=(1-1e-10)*i*s&&kM(t.eye,this.eye)<Math.max(i,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(BP(this.viewForward,ye(Zo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=us()){return t[0]=(this.padding[Kt.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Kt.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[Kt.LEFT]+this.width*e,t[1]=this.padding[Kt.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Cr&&ce(Cr,t),Cr[3]=1,wc(Cr,Cr,this.projectionMatrix);const r=Math.abs(Cr[3]);re(Cr,Cr,1/r);const i=this.fullViewport;e[0]=Pt(0,i[0]+i[2],.5+.5*Cr[0]),e[1]=Pt(0,i[1]+i[3],.5+.5*Cr[1]),e[2]=.5*(Cr[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Cr[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Cr[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Cr[2]=(2*t[2]-1)*t[3],Cr[3]=t[3],this.inverseProjectionMatrix!=null&&(wc(Cr,Cr,this.inverseProjectionMatrix),e[0]=Cr[0],e[1]=Cr[1],e[2]=Cr[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,WU),this.renderToScreen(WU,e),e}projectToRenderScreen(t,e){if(Cr[0]=t[0],Cr[1]=t[1],Cr[2]=t[2],Cr[3]=1,wc(Cr,Cr,this.viewProjectionMatrix),Cr[3]===0)return null;const r=Cr;re(r,r,1/Math.abs(Cr[3]));const i=this.fullViewport,s=Pt(0,i[0]+i[2],.5+.5*r[0]),n=Pt(0,i[1]+i[3],.5+.5*r[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(r[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,WU),e)}unprojectFromRenderScreen(t,e){if(ri(K$,this.projectionMatrix,this.viewMatrix),!cn(K$,K$))return null;const r=this.fullViewport;return Cr[0]=2*(t[0]-r[0])/r[2]-1,Cr[1]=2*(t[1]-r[1])/r[3]-1,Cr[2]=2*t[2]-1,Cr[3]=1,wc(Cr,Cr,K$),Cr[3]===0?null:(e[0]=Cr[0]/Cr[3],e[1]=Cr[1]/Cr[3],e[2]=Cr[2]/Cr[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0),u=r-l- -Math.min(this.fullWidth-s-r/2,0),h=i-c- -Math.min(n-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(t){t===Ne.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){ye(Zo,this.center,this.eye);const t=Se(this.center);t<1?(te(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(de(Zo,this.center))>.9999*Se(Zo)*t||(Ze(this._up,Zo,this.center),Ze(this._up,this._up,Zo),fe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){m0(Zo,this.eye,this.center),Math.abs(Zo[2])<=.9999&&(re(Zo,Zo,Zo[2]),te(this._up,-Zo[0],-Zo[1],1-Zo[2]),fe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?To(t,e)||(ce(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):ae.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Iwe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(H6(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],Je.prototype,"_viewport",void 0),d([m()],Je.prototype,"_padding",void 0),d([m()],Je.prototype,"_fov",void 0),d([m()],Je.prototype,"_nearFar",void 0),d([m()],Je.prototype,"_viewDirty",void 0),d([m()],Je.prototype,"_viewMatrix",void 0),d([m()],Je.prototype,"_pixelRatio",void 0),d([m()],Je.prototype,"pixelRatio",null),d([m()],Je.prototype,"row",void 0),d([m()],Je.prototype,"column",void 0),d([m()],Je.prototype,"_rows",void 0),d([m()],Je.prototype,"rows",null),d([m()],Je.prototype,"_columns",void 0),d([m()],Je.prototype,"columns",null),d([m()],Je.prototype,"eye",null),d([m()],Je.prototype,"center",null),d([m()],Je.prototype,"_center",void 0),d([m()],Je.prototype,"up",null),d([m()],Je.prototype,"_up",void 0),d([m({readOnly:!0})],Je.prototype,"viewForward",null),d([m({readOnly:!0})],Je.prototype,"viewUp",null),d([m({readOnly:!0})],Je.prototype,"viewRight",null),d([m({readOnly:!0})],Je.prototype,"nearFar",null),d([m()],Je.prototype,"near",null),d([m()],Je.prototype,"far",null),d([m()],Je.prototype,"viewport",null),d([m({readOnly:!0})],Je.prototype,"screenViewport",null),d([m({readOnly:!0})],Je.prototype,"screenPadding",null),d([m()],Je.prototype,"x",null),d([m()],Je.prototype,"y",null),d([m()],Je.prototype,"width",null),d([m()],Je.prototype,"height",null),d([m()],Je.prototype,"fullWidth",null),d([m()],Je.prototype,"fullHeight",null),d([m({readOnly:!0})],Je.prototype,"_aspect",null),d([m()],Je.prototype,"padding",null),d([m({readOnly:!0})],Je.prototype,"projectionMatrix",null),d([m({readOnly:!0})],Je.prototype,"inverseProjectionMatrix",null),d([m()],Je.prototype,"fov",null),d([m()],Je.prototype,"fovX",null),d([m()],Je.prototype,"fovY",null),Je=Vj=d([V("esri.views.3d.webgl-engine.lib.Camera")],Je);const Cr=Yt(),K$=xe(),Zo=E(),qU=E(),WU=Go();var Kt;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Kt||(Kt={}));var ue;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.ANTIALIASING=12]="ANTIALIASING",t[t.COMPOSITE=13]="COMPOSITE",t[t.BLIT=14]="BLIT",t[t.SSAO=15]="SSAO",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=17]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=18]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=19]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=20]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=21]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=22]="HUD_MATERIAL",t[t.LABEL_MATERIAL=23]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=24]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=25]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=26]="DRAPED_MATERIAL",t[t.DRAPED_WATER=27]="DRAPED_WATER",t[t.VOXEL=28]="VOXEL",t[t.MAX_SLOTS=29]="MAX_SLOTS"})(ue||(ue={}));var dt;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(dt||(dt={}));let OZ=class{constructor(e=E()){this.intensity=e}},kwe=class{constructor(e=E(),r=Pe(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},R5=class{constructor(e=E(),r=Pe(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},Uwe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function lYe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function YU(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function lS(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function zwe(t){return(t+1)*(t+1)}function cYe(t){return we(Math.floor(Math.sqrt(t)-1),0,2)}function Bwe(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=zwe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function uYe(t,e){const r=zwe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function hYe(t,e){const r=cYe(e.r.length);for(const i of t)Eo(Gj,i.direction),Bwe(Gj,r,Ig),lYe(Ig,lN),YU(Ig,i.intensity[0],Rx),lS(e.r,Rx),YU(Ig,i.intensity[1],Rx),lS(e.g,Rx),YU(Ig,i.intensity[2],Rx),lS(e.b,Rx);return e}function dYe(t,e){Bwe(Gj,0,Ig);for(const r of t)e.r[0]+=Ig[0]*lN[0]*r.intensity[0]*4*Math.PI,e.g[0]+=Ig[0]*lN[0]*r.intensity[1]*4*Math.PI,e.b[0]+=Ig[0]*lN[0]*r.intensity[2]*4*Math.PI;return e}function pYe(t,e,r,i){uYe(e,i),te(r.intensity,0,0,0);let s=!1;const n=fYe,o=mYe,a=gYe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof R5&&!s?(ce(r.direction,l.direction),ce(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof R5||l instanceof kwe?n.push(l):l instanceof OZ?o.push(l):l instanceof Uwe&&a.push(l);hYe(n,i),dYe(o,i);for(const l of a)lS(i.r,l.r),lS(i.g,l.g),lS(i.b,l.b)}const fYe=[],mYe=[],gYe=[],Ig=[0],Rx=[0],Gj=E(),lN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let tse=class{constructor(){this.color=E(),this.intensity=1}},yYe=class{constructor(){this.direction=E(),this.ambient=new tse,this.diffuse=new tse}};const Vwe=.4;let XU=class{constructor(){this._shOrder=2,this._legacy=new yYe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Uwe,this._mainLight=new R5(E(),Pe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){pYe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ce(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,re(this._legacy.diffuse.color,this._mainLight.intensity,r),ce(Q$,this._legacy.diffuse.color),re(Q$,Q$,Vwe*this.globalFactor),pe(this._legacy.ambient.color,this._legacy.ambient.color,Q$)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ce(this._mainLight.direction,e.mainLight.direction),ce(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(li(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Pt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Pt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),ce(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Pt(e.globalFactor,r.globalFactor,i),this.noonFactor=Pt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=Pt(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=Pt(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=Pt(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const Q$=E();let $k=class{constructor(e,r){this.shadowMap=e,this.slicePlane=r,this.slot=ue.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=dt.NONE,this.alignPixelEnabled=!1,this.decorations=Cl.ON,this.overlayStretch=1,this._camera=new Je,this._inverseViewport=je(),this.oldLighting=new XU,this.newLighting=new XU,this._fadedLighting=new XU,this._lighting=this.newLighting,this.ssr=new _Ye,this.multipassEnabled=!1,this.multipassTerrain=new XWe,this.multipassGeometry=new YWe,this.hudRenderStyle=sc.Occluded,this.cloudsFade=new xWe}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},_Ye=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=xe()}};const Ao=Symbol("Yield");let vYe=class{constructor(){this._tasks=new Array,this._runningTasks=nm(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return Ao;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new rse(s,n,e,r,i))).finally(()=>--this._runningTasks.value)}unshift(e,r,i){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new rse(s,n,e,r,i))).finally(()=>--this._runningTasks.value)}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=Zs(r.signal);if(s&&!r.abortCallback)r.reject(hr());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,hr()):r.callback(e);Rc(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return!0}cancelAll(){const e=hr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0}},rse=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},PA=class extends Me{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],PA.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],PA.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),PA=d([V("esri.views.support.DebugFlags")],PA);const bYe=new PA;function wYe(){return new $5.Scheduler}var yt;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(yt||(yt={}));const Lf=0,ise=new Map([[yt.RESOURCE_CONTROLLER_IMMEDIATE,Lf],[yt.RESOURCE_CONTROLLER,4],[yt.SLIDE,Lf],[yt.STREAM_DATA_LOADER,Lf],[yt.ELEVATION_QUERY,Lf],[yt.TERRAIN_SURFACE,1],[yt.SURFACE_GEOMETRY_UPDATES,1],[yt.LOD_RENDERER,2],[yt.GRAPHICS_CORE,2],[yt.I3S_CONTROLLER,2],[yt.POINT_CLOUD_LAYER,2],[yt.FEATURE_TILE_FETCHER,2],[yt.OVERLAY,4],[yt.STAGE,4],[yt.GRAPHICS_DECONFLICTOR,4],[yt.FILTER_VISIBILITY,4],[yt.SCALE_VISIBILITY,4],[yt.FRUSTUM_VISIBILITY,4],[yt.CLOUDS_GENERATOR,4],[yt.POINT_OF_INTEREST_FREQUENT,6],[yt.POINT_OF_INTEREST_INFREQUENT,30],[yt.LABELER,8],[yt.FEATURE_QUERY_ENGINE,8],[yt.FEATURE_TILE_TREE,16],[yt.FEATURE_TILE_TREE_ACTIVE,Lf],[yt.ELEVATION_ALIGNMENT,12],[yt.ELEVATION_ALIGNMENT_SCENE,14],[yt.TEXT_TEXTURE_ATLAS,12],[yt.TEXTURE_UNLOAD,12],[yt.LINE_OF_SIGHT_TOOL,16],[yt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Lf],[yt.SNAPPING,Lf],[yt.SHADOW_ACCUMULATOR,30]]);function sse(t){return ise.has(t)?ise.get(t):typeof t=="number"?t:1}const nse=6.5,ose=1,xYe=30,ase=1e3/30,lse=100,cse=.9;var $5,F1;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=nm(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Fg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Br.INTERACTING,this._tasks=new kt,this._runQueue=new kt,this._load=0,this._idleStateCallbacks=new kt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=he(()=>bYe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,ui);for(const o of Object.keys(yt))this.performanceInfo.tasks.set(yt[o],new Fg(yt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:nse,INTERACTING_BUDGET:ase,IDLE_BUDGET:lse,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),wi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=new r(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Fg(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Br.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Br.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Br.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=nse,a=n.frameDuration,l=ose;switch(this.state){case Br.IDLE:o=0,a=Math.max(lse,n.frameDuration),l=xYe;break;case Br.INTERACTING:a=Math.max(ase,n.frameDuration);case Br.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Br.IDLE&&a<ose&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Br.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Br.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return F1.SCHEDULED;let o=F1.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=F1.READY:o!==F1.READY&&(o=F1.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*cse+n*(1-cse)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Lf&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Lf&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Ao&&(a.blockFrame=this._frameNumber)}catch(c){ae.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,yt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(yt))this._frameTaskTimes.set(yt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new vYe,this._handles=new c1,this._basePriority=sse(o),this.schedulePriority=this._basePriority,this._task=nm(a??this._queue),this._handles.add(Ih(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(Wa),this._scheduler.removeTask(this),this.schedule=hE.schedule,this.reschedule=hE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=sse(n);this._basePriority!==Lf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Br.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})($5||($5={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(F1||(F1={}));const Wa=(()=>{const t=new $5.Budget;return t.enabled=!1,t})();let TYe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Zs(r)){const s=hr();return i?Promise.resolve(i(s)):Promise.reject(s)}return yV(e(Wa))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const hE=new TYe;let gl=class extends Me{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new oN,this._bindParameters=new $k(null,null),this._passParameters=new PZ,this._weatherTile=je(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Pt(ta.default.coverage[0],ta.default.coverage[1],.5),this.density=Pt(ta.default.density[0],ta.default.density[1],.5),this.absorption=Pt(ta.default.absorption[0],ta.default.absorption[1],.5),this.cloudSize=Pt(ta.default.cloudSize[0],ta.default.cloudSize[1],.5),this.detailSize=Pt(ta.default.detailSize[0],ta.default.detailSize[1],.5),this.smoothness=Pt(ta.default.smoothness[0],ta.default.smoothness[1],.5),this.cloudHeight=Pt(ta.default.cloudHeight[0],ta.default.cloudHeight[1],.5),this.raymarchingSteps=ta.default.raymarchingSteps,this._viewMatrix=xe(),this._dirty=!1,this.running=!1,this._vao=Im(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===Uw.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new Swe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;cr(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),kbe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Vr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(yt.CLOUDS_GENERATOR,this),he(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),ui)])}destroy(){this._techniques.forEach(e=>er(e)),this._frameBufferCube=ft(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Ae(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Ml.SIXTEEN:return 1;case Ml.HUNDRED:return 4;case Ml.COUNT:case Ml.TWOHUNDRED:return 8}}get usedMemory(){var e,r,i;return(((e=this._frameBufferCube)==null?void 0:e.usedMemory)??0)+(((i=(r=this._passParameters.noiseTexture)==null?void 0:r.textureAtlas)==null?void 0:i.usedMemory)??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new AA({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new oi(e);r.target=_s.TEXTURE_CUBE_MAP,r.wrapMode=Xt.CLAMP_TO_EDGE,this._frameBufferCube=new Np(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=ft(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=Pt(n[0],n[1],i);return r<.5?Pt(n[0],o,2*r):Pt(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Vn(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===Mi.CROSS_FADE||!this._ensureNoiseTexture())return Ao;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Yf.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=SYe[this._faceIndex],s=EYe[this._faceIndex];oye(this._viewMatrix,CYe,i,s),kh(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.bindTechnique(r,this._bindParameters,this._passParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=n.getViewport(),l=r.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;n.setViewport(0,u,l,c);const h=this._ensureFrameBufferCube(l);n.bindFramebuffer(h);const p=_s.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return h.setColorTextureTarget(p),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Yf.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Ao}};d([m({constructOnly:!0})],gl.prototype,"context",void 0),d([m({constructOnly:!0})],gl.prototype,"view",void 0),d([m({constructOnly:!0})],gl.prototype,"requestRender",void 0),d([m()],gl.prototype,"coverage",void 0),d([m()],gl.prototype,"density",void 0),d([m()],gl.prototype,"absorption",void 0),d([m()],gl.prototype,"cloudSize",void 0),d([m()],gl.prototype,"detailSize",void 0),d([m()],gl.prototype,"smoothness",void 0),d([m()],gl.prototype,"cloudHeight",void 0),d([m()],gl.prototype,"raymarchingSteps",void 0),d([m()],gl.prototype,"running",void 0),gl=d([V("esri.views.3d.environment.CloudsGenerator")],gl);const SYe=[mi(1,0,0),mi(-1,0,0),mi(0,1,0),mi(0,-1,0),mi(0,0,1)],EYe=[mi(0,1,0),mi(0,1,0),mi(0,0,-1),mi(0,0,1),mi(0,1,0)],CYe=AZ();let RZ=class extends Ci{constructor(){super(...arguments),this.fogColor=E(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function Gwe(){const t=new Or;t.attributes.add(O.POSITION,"vec2"),t.include(om,{textureCoordinateType:rs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new is("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new is("inverseViewMatrix",(i,s)=>YE(AYe,s.camera.viewMatrix))),e.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ie("atmosphereC",i=>i.atmosphereC),new Dt("cameraPosition",(i,s)=>s.camera.eye),new ni("nearFar",(i,s)=>s.camera.nearFar),new at("depthTexture",i=>i.depthTexture),new Ie("fogStrength",i=>i.fogStrength),new Ie("fogAmount",i=>i.fogAmount),new Dt("fogColor",i=>i.fogColor)),t.include(Mk),r.include(bm),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const AYe=xe(),PYe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:RZ,build:Gwe},Symbol.toStringTag,{value:"Module"}));let jwe=class Hwe extends Gr{constructor(e){super(e,new zl,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,Hwe.shader.get().build(),Mr)}initializePipeline(){return Nt({blending:Po(Ee.SRC_ALPHA,Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE),colorWrite:qt})}};jwe.shader=new Lr(PYe,()=>me(()=>Promise.resolve().then(()=>sAt),void 0));const MYe=.95,OYe=1;let qv=class extends Me{constructor(e){super(e),this._passParameters=new RZ;const r=e.context.renderContext.rctx;this._vao=Im(r,vR),this._technique=new jwe(e);const i=Vr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+Xy}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(sr.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;fe(use,i.eye);const s=Math.max(0,de(use,e.bindParameters.lighting.mainLight.direction)),n=r.color;re(hse,n,.1),li(this._passParameters.fogColor,hse,n,s);const o=Se(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-zM(MYe*Mg,OYe*Mg,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};d([m({constructOnly:!0})],qv.prototype,"context",void 0),d([m({constructOnly:!0})],qv.prototype,"view",void 0),d([m({constructOnly:!0})],qv.prototype,"rctx",void 0),d([m({constructOnly:!0})],qv.prototype,"viewingMode",void 0),qv=d([V("esri.views.3d.environment.Fog")],qv);let RYe=class{constructor(){this.color=E(),this.strength=0,this.amount=0}};const use=E(),hse=E();var k;function $Ye(t){return cS(t)||t===k.Depth||t===k.LinearDepth||t===k.Normal||t===k.ObjectAndLayerIdColor}function cS(t){return t===k.Shadow||t===k.ShadowHighlight||t===k.ShadowExcludeHighlight}function JP(t){return jj(t)||t===k.Normal}function nw(t){return t===k.Highlight||t===k.ObjectAndLayerIdColor}function qwe(t){return t===k.Color||nw(t)}function qg(t){return t===k.Color||t===k.Alpha}function ZU(t){return qg(t)||t===k.ObjectAndLayerIdColor}function IYe(t){return qg(t)||t===k.Highlight}function dse(t){return IYe(t)||t===k.LinearDepth}function cN(t){return qg(t)||nw(t)}function jj(t){return cN(t)||t===k.LinearDepth}(function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.Highlight=7]="Highlight",t[t.Alpha=8]="Alpha",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.CompositeColor=10]="CompositeColor",t[t.COUNT=11]="COUNT"})(k||(k={}));function $Z({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Wwe=class extends ps{constructor(e,r){super(e,"mat4",Rr.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function Cp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Cn):t.uniforms.add(new bu("cameraPosition",(r,i)=>te(Ywe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Sc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new is("proj",(i,s)=>s.camera.projectionMatrix),new Wwe("view",(i,s)=>Fl(pse,s.camera.viewMatrix,i.origin)),new bu("localOrigin",i=>i.origin));const r=i=>te(Ywe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new is("proj",(i,s)=>s.camera.projectionMatrix),new is("view",(i,s)=>Fl(pse,s.camera.viewMatrix,r(s))),new Dt("localOrigin",(i,s)=>r(s)))}const pse=xe(),Ywe=E();function dE(t){t.uniforms.add(new is("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function sC(t){t.uniforms.add(new Ie("pixelRatio",(e,r)=>r.camera.pixelRatio/r.overlayStretch))}function Hj(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function LYe(t,e){const r=t.length;for(let i=0;i<r;++i)CT[0]=t[i],e[i]=CT[0];return e}function DYe(t,e){const r=t.length;for(let i=0;i<r;++i)CT[0]=t[i],CT[1]=t[i]-CT[0],e[i]=CT[1];return e}const CT=new Float32Array(2);let qj=class extends zl{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};d([G()],qj.prototype,"instancedDoublePrecision",void 0),d([G()],qj.prototype,"hasModelTransformation",void 0);const fse=xi();function Xwe(t,e){const r=e.hasModelTransformation,i=e.instancedDoublePrecision;r&&(t.vertex.uniforms.add(new is("model",n=>n.modelTransformation??ts)),t.vertex.uniforms.add(new Mu("normalLocalOriginFromModel",n=>(a0(fse,n.modelTransformation??ts),fse)))),e.instanced&&i&&(t.attributes.add(O.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(O.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(O.INSTANCEMODEL,"mat3"),t.attributes.add(O.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;i&&(s.include($Z,e),s.uniforms.add(new bu("viewOriginHi",(n,o)=>LYe(te(eI,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),eI)),new bu("viewOriginLo",(n,o)=>DYe(te(eI,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),eI)))),s.code.add(x`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?x`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===k.Normal&&(dE(s),s.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const eI=E();let Za=class extends qj{};d([G({constValue:!0})],Za.prototype,"hasSliceHighlight",void 0),d([G({constValue:!1})],Za.prototype,"hasSliceInVertexProgram",void 0),d([G({constValue:Rr.Pass})],Za.prototype,"pbrTextureBindType",void 0);var xm;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(xm||(xm={}));let IZ=class extends Za{constructor(){super(...arguments),this.geometry=xm.Cone}};d([G({count:xm.COUNT})],IZ.prototype,"geometry",void 0);function wR(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(x`vec3 positionModel() { return position; }`)}let I5=class extends ps{constructor(e,r){super(e,"mat3",Rr.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function uS(t,e){t.include(wR);const r=t.vertex;r.include($Z,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Dt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Dt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Mu("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new is("transformProjFromView",i=>i.transformProjFromView),new I5("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new bu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new bu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Dt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Zwe=class extends Ci{constructor(){super(...arguments),this.transformWorldFromViewTH=E(),this.transformWorldFromViewTL=E(),this.transformViewFromCameraRelativeRS=xi(),this.transformProjFromView=xe()}},Jwe=class extends Ci{constructor(){super(...arguments),this.transformWorldFromModelRS=xi(),this.transformWorldFromModelTH=E(),this.transformWorldFromModelTL=E()}};function J_(t){t.varyings.add("linearDepth","float")}function zw(t){t.vertex.uniforms.add(new ni("nearFar",(e,r)=>r.camera.nearFar))}function Ik(t){t.vertex.code.add(x`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function nC(t,e){const{vertex:r}=t;switch(e.output){case k.Color:if(e.receiveShadows)return J_(t),void r.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case k.LinearDepth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:return t.include(uS,e),J_(t),zw(t),Ik(t),void r.code.add(x`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(x`void forwardLinearDepth() {}`)}function Ol(t){Ik(t),t.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Lk=class extends Ci{constructor(){super(...arguments),this.texV=je(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new LZ}},LZ=class{constructor(){this.center=E(),this.v1=E(),this.v2=E()}};function Kwe(t){const e=new Or,{vertex:r,fragment:i}=e;if(w0(r),t.geometry===xm.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Dt("cameraPosition",(s,n)=>n.camera.eye),new Ie("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(x`void main() {
fragColor = color;
}`);else{e.include(Ol,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===xm.Cylinder;r.uniforms.add(new is("proj",(a,l)=>l.camera.projectionMatrix),new is("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Dt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Dt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Dt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new ni("texV",a=>a.texV)),r.uniforms.add(new Ie("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new at("tex",a=>a.texture)),s||i.uniforms.add(new Ie("altitudeFade",a=>a.altitudeFade)),i.code.add(x`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?x`fragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const NYe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:LZ,SimpleAtmospherePassParameters:Lk,build:Kwe},Symbol.toStringTag,{value:"Module"}));let L5=class Qwe extends Gr{initializeProgram(e){return new Dr(e.rctx,Qwe.shader.get().build(this.configuration),Mr)}initializePipeline(){return this.configuration.geometry===xm.Cylinder?Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),culling:yZ,depthTest:{func:Qr.LEQUAL},colorWrite:qt}):Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};L5.shader=new Lr(NYe,()=>me(()=>Promise.resolve().then(()=>nAt),void 0));const FYe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Ic(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=kYe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new hi(i,n,o,a,r,l,e)})}function kYe(t){const e=UYe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const UYe={u8:Te.UNSIGNED_BYTE,u16:Te.UNSIGNED_SHORT,u32:Te.UNSIGNED_INT,i8:Te.BYTE,i16:Te.SHORT,i32:Te.INT,f32:Te.FLOAT};let DZ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};DZ.ElementCount=9;let NZ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};NZ.ElementCount=16;let T0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};T0.ElementCount=1;let S0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,cr(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};S0.ElementCount=2;let E0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,te(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};E0.ElementCount=3;let C0=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,es(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};C0.ElementCount=4;let Dk=class exe extends T0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new exe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Dk.ElementType="f32";let lx=class Wj extends S0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Wj,e,r)}static fromTypedArray(e,r){return new Wj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lx.ElementType="f32";let zn=class Yj extends E0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Yj,e,r)}static fromTypedArray(e,r){return new Yj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zn.ElementType="f32";let Ap=class Xj extends C0{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Xj,e,r)}static fromTypedArray(e,r){return new Xj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ap.ElementType="f32";let K_=class Zj extends DZ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Zj,e,r)}static fromTypedArray(e,r){return new Zj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};K_.ElementType="f32";let FZ=class Jj extends DZ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Jj,e,r)}static fromTypedArray(e,r){return new Jj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};FZ.ElementType="f64";let kZ=class Kj extends NZ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Kj,e,r)}static fromTypedArray(e,r){return new Kj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kZ.ElementType="f32";let pO=class Qj extends NZ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Qj,e,r)}static fromTypedArray(e,r){return new Qj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pO.ElementType="f64";let UZ=class eH extends T0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(eH,e,r)}static fromTypedArray(e,r){return new eH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};UZ.ElementType="f64";let zZ=class tH extends S0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(tH,e,r)}static fromTypedArray(e,r){return new tH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zZ.ElementType="f64";let Vh=class rH extends E0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(rH,e,r)}static fromTypedArray(e,r){return new rH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Vh.ElementType="f64";let Nk=class iH extends C0{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(iH,e,r)}static fromTypedArray(e,r){return new iH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Nk.ElementType="f64";let pE=class sH extends T0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(sH,e,r)}static fromTypedArray(e,r){return new sH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pE.ElementType="u8";let Fk=class nH extends S0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(nH,e,r)}static fromTypedArray(e,r){return new nH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Fk.ElementType="u8";let kk=class oH extends E0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(oH,e,r)}static fromTypedArray(e,r){return new oH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kk.ElementType="u8";let _a=class aH extends C0{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(aH,e,r)}static fromTypedArray(e,r){return new aH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_a.ElementType="u8";let Uk=class lH extends T0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(lH,e,r)}static fromTypedArray(e,r){return new lH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Uk.ElementType="u16";let BZ=class cH extends S0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(cH,e,r)}static fromTypedArray(e,r){return new cH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BZ.ElementType="u16";let zk=class uH extends E0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(uH,e,r)}static fromTypedArray(e,r){return new uH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zk.ElementType="u16";let xR=class hH extends C0{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(hH,e,r)}static fromTypedArray(e,r){return new hH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xR.ElementType="u16";let Bk=class dH extends T0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(dH,e,r)}static fromTypedArray(e,r){return new dH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Bk.ElementType="u32";let VZ=class pH extends S0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(pH,e,r)}static fromTypedArray(e,r){return new pH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};VZ.ElementType="u32";let txe=class fH extends E0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(fH,e,r)}static fromTypedArray(e,r){return new fH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};txe.ElementType="u32";let rxe=class mH extends C0{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(mH,e,r)}static fromTypedArray(e,r){return new mH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};rxe.ElementType="u32";let GZ=class gH extends T0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(gH,e,r)}static fromTypedArray(e,r){return new gH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GZ.ElementType="i8";let Vk=class yH extends S0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(yH,e,r)}static fromTypedArray(e,r){return new yH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Vk.ElementType="i8";let ixe=class _H extends E0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(_H,e,r)}static fromTypedArray(e,r){return new _H(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ixe.ElementType="i8";let sxe=class vH extends C0{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(vH,e,r)}static fromTypedArray(e,r){return new vH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};sxe.ElementType="i8";let nxe=class bH extends T0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(bH,e,r)}static fromTypedArray(e,r){return new bH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nxe.ElementType="i16";let TR=class wH extends S0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(wH,e,r)}static fromTypedArray(e,r){return new wH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};TR.ElementType="i16";let oxe=class xH extends E0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(xH,e,r)}static fromTypedArray(e,r){return new xH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};oxe.ElementType="i16";let axe=class TH extends C0{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(TH,e,r)}static fromTypedArray(e,r){return new TH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};axe.ElementType="i16";let lxe=class SH extends T0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(SH,e,r)}static fromTypedArray(e,r){return new SH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lxe.ElementType="i32";let cxe=class EH extends S0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(EH,e,r)}static fromTypedArray(e,r){return new EH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cxe.ElementType="i32";let uxe=class CH extends E0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(CH,e,r)}static fromTypedArray(e,r){return new CH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uxe.ElementType="i32";let hxe=class AH extends C0{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(AH,e,r)}static fromTypedArray(e,r){return new AH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hxe.ElementType="i32";function mse(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let gse=class dxe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new dxe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},pxe=class fxe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:VYe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,lx,r),this}vec2f64(e,r){return this._appendField(e,zZ,r),this}vec3f(e,r){return this._appendField(e,zn,r),this}vec3f64(e,r){return this._appendField(e,Vh,r),this}vec4f(e,r){return this._appendField(e,Ap,r),this}vec4f64(e,r){return this._appendField(e,Nk,r),this}mat3f(e,r){return this._appendField(e,K_,r),this}mat3f64(e,r){return this._appendField(e,FZ,r),this}mat4f(e,r){return this._appendField(e,kZ,r),this}mat4f64(e,r){return this._appendField(e,pO,r),this}vec4u8(e,r){return this._appendField(e,_a,r),this}f32(e,r){return this._appendField(e,Dk,r),this}f64(e,r){return this._appendField(e,UZ,r),this}u8(e,r){return this._appendField(e,pE,r),this}u16(e,r){return this._appendField(e,Uk,r),this}i8(e,r){return this._appendField(e,GZ,r),this}vec2i8(e,r){return this._appendField(e,Vk,r),this}vec2i16(e,r){return this._appendField(e,TR,r),this}vec2u8(e,r){return this._appendField(e,Fk,r),this}vec4u16(e,r){return this._appendField(e,xR,r),this}u32(e,r){return this._appendField(e,Bk,r),this}_appendField(e,r,i){if(this._fields.has(e))return void ht(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*mse(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new gse(this,e)}createView(e){return new gse(this,e)}clone(){const e=new fxe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,mse(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Yi(){return new pxe}let zYe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:mxe(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const BYe=[Dk,lx,zn,Ap,K_,kZ,UZ,zZ,Vh,Nk,FZ,pO,pE,Fk,kk,_a,Uk,BZ,zk,xR,Bk,VZ,txe,rxe,GZ,Vk,ixe,sxe,nxe,TR,oxe,axe,lxe,cxe,uxe,hxe];function mxe(t){return`${t.ElementType}_${t.ElementCount}`}function VYe(t){return gxe.get(t)}const gxe=new Map;BYe.forEach(t=>gxe.set(mxe(t),t));function ao(t,e=!1){return t<=Cc?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function yxe(t){return(Oh(t)?t.length:t.byteLength/8)<=Cc?Array.from(t):new Float64Array(t)}function Ah(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function GYe(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function tDt(t){return Array.isArray(t)?new Float64Array(t):t}function hs(t,e=!1){return t<=Cc?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function rDt(t){return Oh(t)?t.length<Cc?t:new Float32Array(t):t.length<Cc?Array.from(t):t}function yse(t){return(Oh(t)?t.length:t.byteLength/8)<=Cc?Array.from(t):new Float32Array(t)}function D5(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function lm(t){if(Oh(t)){if(t.length<Cc)return t}else if(t.length<Cc)return Array.from(t);let e=!0,r=!0;return t.some((i,s)=>(e=e&&i===0,r=r&&i===s,!e&&!r)),e?v1(t.length):r?cx(t.length):Oh(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?jYe(t):t}function jYe(t){let e=!0;for(const r of t){if(r>=65536)return Oh(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function N5(t){return t<=Cc?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function HYe(t){return t<=Cc?new Array(t):new Uint32Array(t)}let $x=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const _xe=[0],JU=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function cx(t){if(t===1)return _xe;if(t<Cc)return Array.from(new Uint16Array(JU.buffer,0,t));if(t<JU.length)return new Uint16Array(JU.buffer,0,t);if(t>$x.length){const e=Math.max(2*$x.length,t);$x=new Uint32Array(e);for(let r=0;r<$x.length;r++)$x[r]=r}return new Uint32Array($x.buffer,0,t)}let tI=new Uint8Array(65536);function v1(t){if(t===1)return _xe;if(t<Cc)return new Array(t).fill(0);if(t>tI.length){const e=Math.max(2*tI.length,t);tI=new Uint8Array(e)}return new Uint8Array(tI.buffer,0,t)}var PH;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],h=1/Math.sqrt(l*l+c*c+u*u);o[a]*=h,o[a+1]*=h,o[a+2]*=h}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]+l[c],u[h+1]=o[a+1]+l[c+1],u[h+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]-l[c],u[h+1]=o[a+1]-l[c+1],u[h+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(PH||(PH={}));var vs;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(vs||(vs={}));function qYe(t){if(t.length<Cc)return Array.from(t);if(Oh(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return n6(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let vxe=class bxe{constructor(e,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.position=i,this._children=void 0,ht(e.length>=1),ht(i.size===3||i.size===4);const{data:s,size:n,indices:o}=i;ht(o.length%this._numIndexPerPrimitive==0),ht(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];k1.clear(),k1.push(l);const c=Pe(s[l],s[l+1],s[l+2]),u=qi(c);for(let f=0;f<a;++f){const g=this._numIndexPerPrimitive*e[f];for(let _=0;_<this._numIndexPerPrimitive;++_){l=n*o[g+_],k1.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const h=li(E(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let f=0;f<k1.length;++f){l=k1.at(f);const g=s[l]-h[0],_=s[l+1]-h[1],v=s[l+2]-h[2],b=g*g+_*_+v*v;if(b<=p)continue;const w=Math.sqrt(b),T=.5*(w-this.radius);this.radius=this.radius+T,p=this.radius*this.radius;const S=T/w;h[0]+=g*S,h[1]+=_*S,h[2]+=v*S}this.center=h,k1.clear()}getChildren(){if(this._children||So(this.bbMin,this.bbMax)<=1)return this._children;const e=li(E(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<r;++u){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let f=o*a[p],g=n[f],_=n[f+1],v=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*a[p+b];const w=n[f],T=n[f+1],S=n[f+2];w<g&&(g=w),T<_&&(_=T),S<v&&(v=S)}g<e[0]&&(h|=1),_<e[1]&&(h|=2),v<e[2]&&(h|=4),i[u]=h,++s[h]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<r;++u){const h=i[u];c[h][s[h]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new bxe(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){k1.prune()}};const k1=new kt({deallocator:null});let SR=class{constructor(){this.id=fu()}};function WYe(t){return t?{p0:qi(t.p0),p1:qi(t.p1),p2:qi(t.p2)}:{p0:E(),p1:E(),p2:E()}}function YYe(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function XYe(t,e,r){return ye(KU,e,t),ye(_se,r,t),.5*Se(Ze(KU,KU,_se))}new g0(Lp);new g0(()=>WYe());const KU=E(),_se=E();function ZYe(t,e){if(!t)return!1;const{size:r,data:i,indices:s}=t;te(e,0,0,0),te(sh,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*r,c=s[a+1]*r,u=s[a+2]*r;te(io,i[l],i[l+1],i[l+2]),te(Lg,i[c],i[c+1],i[c+2]),te(rI,i[u],i[u+1],i[u+2]);const h=XYe(io,Lg,rI);h?(pe(io,io,Lg),pe(io,io,rI),re(io,io,1/3*h),pe(e,e,io),n+=h):(pe(sh,sh,io),pe(sh,sh,Lg),pe(sh,sh,rI),o+=3)}return(o!==0||n!==0)&&(n!==0?(re(e,e,1/n),!0):o!==0&&(re(e,sh,1/o),!0))}function JYe(t,e){if(!t)return!1;const{size:r,data:i,indices:s}=t;te(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*r;n!==l&&(e[0]+=i[l],e[1]+=i[l+1],e[2]+=i[l+2],o++),n=l}return o>1&&re(e,e,1/o),o>0}function KYe(t,e,r){if(!t)return!1;te(r,0,0,0),te(sh,0,0,0);let i=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const h=u<l?u+1:0,p=a[u<l?u:l]*n,f=a[h]*n;io[0]=o[p],io[1]=o[p+1],io[2]=o[p+2],Lg[0]=o[f],Lg[1]=o[f+1],Lg[2]=o[f+2],re(io,pe(io,io,Lg),.5);const g=Vg(io,Lg);g>0?(pe(r,r,re(io,io,g)),i+=g):i===0&&(pe(sh,sh,io),s++)}return i!==0?(re(r,r,1/i),!0):s!==0&&(re(r,sh,1/s),!0)}const io=E(),Lg=E(),rI=E(),sh=E();let F5=class{constructor(e){this.channel=e,this.id=fu()}};function MH(t,e){return t==null&&(t=[]),t.push(e),t}function OH(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function QYe(t,e,r,i,s){iI[0]=t.get(e,0),iI[1]=t.get(e,1),iI[2]=t.get(e,2),Hj(iI,U1,3),r.set(s,0,U1[0]),i.set(s,0,U1[1]),r.set(s,1,U1[2]),i.set(s,1,U1[3]),r.set(s,2,U1[4]),i.set(s,2,U1[5])}const iI=E(),U1=new Float32Array(6);let un=class wxe extends SR{constructor(e,r,i=null,s=vs.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=i,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of r)this._attributes.set(a,{...l,indices:lm(l.indices)}),a===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const r=new wxe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((i,s)=>{i.exclusive=!1,r._attributes.set(s,i)}),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get attributes(){return this._attributes}getMutableAttribute(e){let r=this._attributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:qYe(r.data)},this._attributes.set(e,r)),r}setAttributeData(e,r){const i=this._attributes.get(e);i&&this._attributes.set(e,{...i,exclusive:!0,data:r})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===vs.Mesh?this._computeAttachmentOriginTriangles(e):this.type===vs.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Ge(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.attributes.get(O.POSITION);return ZYe(r,e)}_computeAttachmentOriginLines(e){const r=this.attributes.get(O.POSITION);return KYe(r,eXe(this.material.parameters,r),e)}_computeAttachmentOriginPoints(e){const r=this.attributes.get(O.POSITION);return JYe(r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(O.POSITION);if(!e||e.indices.length===0)return null;const r=this.type===vs.Mesh?3:1;ht(e.indices.length%r==0,"Indexing error: "+e.indices.length+" not divisible by "+r);const i=cx(e.indices.length/r);return new vxe(i,r,e)}get transformation(){return this._transformation??ts}set transformation(e){this._transformation=e&&e!==ts?JS(e):null}addHighlight(){const e=new F5(c0.Highlight);return this.highlights=MH(this.highlights,e),e}removeHighlight(e){this.highlights=OH(this.highlights,e)}};function eXe(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const Ix=PH,QU=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],tXe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],rXe=[0,0,1,0,1,1,0,1],iXe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],xxe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)xxe[6*t+e]=t;const Wv=new Array(36);for(let t=0;t<6;t++)Wv[6*t]=0,Wv[6*t+1]=1,Wv[6*t+2]=2,Wv[6*t+3]=2,Wv[6*t+4]=3,Wv[6*t+5]=0;function sXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=QU[i][0]*e[0],r[3*i+1]=QU[i][1]*e[1],r[3*i+2]=QU[i][2]*e[2];return new un(t,[[O.POSITION,new qe(r,iXe,3,!0)],[O.NORMAL,new qe(tXe,xxe,3)],[O.UV0,new qe(rXe,Wv,2)]])}const e9=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],nXe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],oXe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],aXe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function lXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=e9[i][0]*e[0],r[3*i+1]=e9[i][1]*e[1],r[3*i+2]=e9[i][2]*e[2];return new un(t,[[O.POSITION,new qe(r,oXe,3,!0)],[O.NORMAL,new qe(nXe,aXe,3)]])}const uN=mi(-.5,0,-.5),hN=mi(.5,0,-.5),dN=mi(0,0,.5),pN=mi(0,.5,0),Lx=gc(),Dx=gc(),hS=gc(),dS=gc(),pS=gc();ye(Lx,uN,pN),ye(Dx,uN,hN),Ze(hS,Lx,Dx),fe(hS,hS),ye(Lx,hN,pN),ye(Dx,hN,dN),Ze(dS,Lx,Dx),fe(dS,dS),ye(Lx,dN,pN),ye(Dx,dN,uN),Ze(pS,Lx,Dx),fe(pS,pS);const t9=[uN,hN,dN,pN],cXe=[0,-1,0,hS[0],hS[1],hS[2],dS[0],dS[1],dS[2],pS[0],pS[1],pS[2]],uXe=[0,1,2,3,1,0,3,2,1,3,0,2],hXe=[0,0,0,1,1,1,2,2,2,3,3,3];function dXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=t9[i][0]*e[0],r[3*i+1]=t9[i][1]*e[1],r[3*i+2]=t9[i][2]*e[2];return new un(t,[[O.POSITION,new qe(r,uXe,3,!0)],[O.NORMAL,new qe(cXe,hXe,3)]])}function nDt(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),h=(c+1)*(u+1),p=hs(3*h),f=hs(3*h),g=hs(2*h),_=[];let v=0;for(let T=0;T<=u;T++){const S=[],C=T/u,P=a+C*l,R=Math.cos(P);for(let L=0;L<=c;L++){const F=L/c,U=n+F*o,j=Math.cos(U)*R,z=Math.sin(P),Z=-Math.sin(U)*R;p[3*v]=j*e,p[3*v+1]=z*e,p[3*v+2]=Z*e,f[3*v]=j,f[3*v+1]=z,f[3*v+2]=Z,g[2*v]=F,g[2*v+1]=C,S.push(v),++v}_.push(S)}const b=new Array;for(let T=0;T<u;T++)for(let S=0;S<c;S++){const C=_[T][S],P=_[T][S+1],R=_[T+1][S+1],L=_[T+1][S];T===0?(b.push(C),b.push(R),b.push(L)):T===u-1?(b.push(C),b.push(P),b.push(R)):(b.push(C),b.push(P),b.push(R),b.push(R),b.push(L),b.push(C))}const w=[[O.POSITION,new qe(p,b,3,!0)],[O.NORMAL,new qe(f,b,3,!0)]];return s.uv&&w.push([O.UV0,new qe(g,b,2,!0)]),s.offset&&(w[0][0]=O.OFFSET,w.push([O.POSITION,new qe(Float64Array.from(s.offset),v1(b.length),3,!0)])),new un(t,w)}function pXe(t,e,r,i){const s=Txe(e,r,i);return new un(t,s)}function Txe(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=i*(1+Math.sqrt(5))/2;s=[-i,c,0,i,c,0,-i,-c,0,i,-c,0,0,-i,c,0,i,c,0,-i,-c,0,i,-c,c,0,-i,c,0,i,-c,0,-i,-c,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)Ix.scale(s,c,t/Ix.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const h=c.toString()+"."+u.toString();if(o[h])return o[h];let p=s.length;return s.length+=3,Ix.add(s,3*c,s,3*u,s,p),Ix.scale(s,p,t/Ix.length(s,p)),p/=3,o[h]=p,p}for(let c=0;c<e;c++){const u=n.length,h=new Array(4*u);for(let p=0;p<u;p+=3){const f=n[p],g=n[p+1],_=n[p+2],v=a(f,g),b=a(g,_),w=a(_,f),T=4*p;h[T]=f,h[T+1]=v,h[T+2]=w,h[T+3]=g,h[T+4]=b,h[T+5]=v,h[T+6]=_,h[T+7]=w,h[T+8]=b,h[T+9]=v,h[T+10]=b,h[T+11]=w}n=h,o={}}const l=yse(s);for(let c=0;c<l.length;c+=3)Ix.normalize(l,c);return[[O.POSITION,new qe(yse(s),n,3,!0)],[O.NORMAL,new qe(l,n,3,!0)]]}function RH(t,e,r,i,s,n,o,a,l=null){const c=r?qi(r):E(),u=e?qi(e):Pe(0,0,1);o??(o=je());const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],f=v1(1),g=[[O.POSITION,new qe(c,f,3,!0)],[O.NORMAL,new qe(u,f,3,!0)],[O.UV0,new qe(o,f,o.length)],[O.COLOR,new qe(h,f,4,!0)],[O.SIZE,new qe(p,f,2)]];if(n!=null&&(n=[n[0],n[1],n[2],n[3]],g.push([O.CENTEROFFSETANDDISTANCE,new qe(n,f,4)])),a){const _=[a[0],a[1],a[2],a[3]];g.push([O.FEATUREATTRIBUTE,new qe(_,f,4)])}return new un(t,g,null,vs.Point,l)}const fXe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function oDt(t,e=fXe){const r=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)r[3*c+u]=e[c][u];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,new qe(r,i,3,!0)],[O.NORMAL,new qe(s,n,3,!0)],[O.UV0,new qe(o,i,2,!0)],[O.COLOR,new qe(a,n,4,!0)]];return new un(t,l)}function vse(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let u=mi(0,a,0),h=mi(0,a+c,0),p=mi(0,-1,0),f=mi(0,1,0);s&&(a=c,h=mi(0,0,0),u=mi(0,a,0),p=mi(0,1,0),f=mi(0,-1,0));const g=[h,u],_=[p,f],v=i+2,b=Math.sqrt(c*c+l*l);if(s)for(let R=i-1;R>=0;R--){const L=R*(2*Math.PI/i),F=mi(Math.cos(L)*l,a,Math.sin(L)*l);g.push(F);const U=mi(c*Math.cos(L)/b,-l/b,c*Math.sin(L)/b);_.push(U)}else for(let R=0;R<i;R++){const L=R*(2*Math.PI/i),F=mi(Math.cos(L)*l,a,Math.sin(L)*l);g.push(F);const U=mi(c*Math.cos(L)/b,l/b,c*Math.sin(L)/b);_.push(U)}const w=new Array,T=new Array;if(n){for(let R=3;R<g.length;R++)w.push(1),w.push(R-1),w.push(R),T.push(0),T.push(0),T.push(0);w.push(g.length-1),w.push(2),w.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let R=3;R<g.length;R++)w.push(R),w.push(R-1),w.push(0),T.push(R),T.push(R-1),T.push(1);w.push(0),w.push(2),w.push(g.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=hs(3*v);for(let R=0;R<v;R++)S[3*R]=g[R][0],S[3*R+1]=g[R][1],S[3*R+2]=g[R][2];const C=hs(3*v);for(let R=0;R<v;R++)C[3*R]=_[R][0],C[3*R+1]=_[R][1],C[3*R+2]=_[R][2];const P=[[O.POSITION,new qe(S,w,3,!0)],[O.NORMAL,new qe(C,T,3,!0)]];return new un(t,P)}function mXe(t,e,r,i,s,n,o){const a=s?Uj(s):mi(1,0,0),l=n?Uj(n):mi(0,0,0);o??(o=!0);const c=gc();fe(c,a);const u=gc();re(u,c,Math.abs(e));const h=gc();re(h,u,-.5),pe(h,h,l);const p=mi(0,1,0);Math.abs(1-de(c,p))<.2&&te(p,0,0,1);const f=gc();Ze(f,c,p),fe(f,f),Ze(p,f,c);const g=2*i+(o?2:0),_=i+(o?2:0),v=hs(3*g),b=hs(3*_),w=hs(2*g),T=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(g-2)]=h[0],v[3*(g-2)+1]=h[1],v[3*(g-2)+2]=h[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(_-2)]=-c[0],b[3*(_-2)+1]=-c[1],b[3*(_-2)+2]=-c[2],b[3*(_-1)]=c[0],b[3*(_-1)+1]=c[1],b[3*(_-1)+2]=c[2]);const C=(U,j,z)=>{T[U]=j,S[U]=z};let P=0;const R=gc(),L=gc();for(let U=0;U<i;U++){const j=U*(2*Math.PI/i);re(R,p,Math.sin(j)),re(L,f,Math.cos(j)),pe(R,R,L),b[3*U]=R[0],b[3*U+1]=R[1],b[3*U+2]=R[2],re(R,R,r),pe(R,R,h),v[3*U]=R[0],v[3*U+1]=R[1],v[3*U+2]=R[2],w[2*U]=U/i,w[2*U+1]=0,v[3*(U+i)]=v[3*U]+u[0],v[3*(U+i)+1]=v[3*U+1]+u[1],v[3*(U+i)+2]=v[3*U+2]+u[2],w[2*(U+i)]=U/i,w[2*U+1]=1;const z=(U+1)%i;C(P++,U,U),C(P++,U+i,U),C(P++,z,z),C(P++,z,z),C(P++,U+i,U),C(P++,z+i,z)}if(o){for(let U=0;U<i;U++){const j=(U+1)%i;C(P++,g-2,_-2),C(P++,U,_-2),C(P++,j,_-2)}for(let U=0;U<i;U++){const j=(U+1)%i;C(P++,U+i,_-1),C(P++,g-1,_-1),C(P++,j+i,_-1)}}const F=[[O.POSITION,new qe(v,T,3,!0)],[O.NORMAL,new qe(b,S,3,!0)],[O.UV0,new qe(w,T,2,!0)]];return new un(t,F)}function aDt(t,e,r,i,s,n,o=mi(0,0,0)){const a=e.length,l=hs(r.length*a*3+(6*i.length||0)),c=hs(r.length*a*3+(i?6:0)),u=new Array,h=new Array;let p=0,f=0;const g=E(),_=E(),v=E(),b=E(),w=E(),T=E(),S=E(),C=E(),P=E(),R=E(),L=E(),F=E(),U=zr();te(P,0,1,0),ye(_,r[1],r[0]),fe(_,_),te(v,0,0,1),k5(_,v,P,P,w,v,bse),ce(b,v),ce(F,w);for(let I=0;I<i.length;I++)re(T,w,i[I][0]),re(C,v,i[I][2]),pe(T,T,C),pe(T,T,r[0]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];c[f++]=-_[0],c[f++]=-_[1],c[f++]=-_[2];for(let I=0;I<s.length;I++)u.push(s[I][0]>0?s[I][0]:-s[I][0]-1+i.length),u.push(s[I][1]>0?s[I][1]:-s[I][1]-1+i.length),u.push(s[I][2]>0?s[I][2]:-s[I][2]-1+i.length),h.push(0),h.push(0),h.push(0);let j=i.length;const z=i.length-1;for(let I=0;I<r.length;I++){let N=!1;I>0&&(ce(g,_),I<r.length-1?(ye(_,r[I+1],r[I]),fe(_,_)):N=!0,pe(R,g,_),fe(R,R),pe(L,r[I-1],b),hR(r[I],R,U),ex(U,Eu(L,g),C)?(ye(C,C,r[I]),fe(v,C),Ze(w,R,v),fe(w,w)):k5(R,b,F,P,w,v,bse),ce(b,v),ce(F,w));for(let B=0;B<a;B++)if(re(T,w,e[B][0]),re(C,v,e[B][1]),pe(T,T,C),fe(S,T),c[f++]=S[0],c[f++]=S[1],c[f++]=S[2],pe(T,T,r[I]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2],!N){const H=(B+1)%a;u.push(j+B),u.push(j+a+B),u.push(j+H),u.push(j+H),u.push(j+a+B),u.push(j+a+H);for(let q=0;q<6;q++){const Q=u.length-6;h.push(u[Q+q]-z)}}j+=a}const Z=r[r.length-1];for(let I=0;I<i.length;I++)re(T,w,i[I][0]),re(C,v,i[I][1]),pe(T,T,C),pe(T,T,Z),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];const W=f/3;c[f++]=_[0],c[f++]=_[1],c[f++]=_[2];const Y=j-a;for(let I=0;I<s.length;I++)u.push(s[I][0]>=0?j+s[I][0]:-s[I][0]-1+Y),u.push(s[I][2]>=0?j+s[I][2]:-s[I][2]-1+Y),u.push(s[I][1]>=0?j+s[I][1]:-s[I][1]-1+Y),h.push(W),h.push(W),h.push(W);const le=[[O.POSITION,new qe(l,u,3,!0)],[O.NORMAL,new qe(c,h,3,!0)]];return new un(t,le)}function lDt(t,e,r,i){ht(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),ht(e[0].length===3,"createPolylineGeometry(): malformed vertex"),ht(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),ht(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=ao(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[O.POSITION,new qe(s,n,3,!0)]];if(r){const c=hs(3*r.length);let u=0;for(let h=0;h<e.length;h++)for(let p=0;p<3;p++)c[u++]=r[h][p];l.push([O.NORMAL,new qe(c,n,3,!0)])}return i&&l.push([O.COLOR,new qe(i,cx(i.length/4),4)]),new un(t,l,null,vs.Line)}function gXe(t,e=t){const r=t.attributes,i=r.get(O.POSITION).data,s=r.get(O.NORMAL).data;if(s){const n=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function r9(t,e,r,i,s){return!(Math.abs(de(e,t))>s)&&(Ze(r,t,e),fe(r,r),Ze(i,r,t),fe(i,i),!0)}function k5(t,e,r,i,s,n,o){return r9(t,e,s,n,o)||r9(t,r,s,n,o)||r9(t,i,s,n,o)}const bse=.99619469809;let yXe=class{constructor(e,r){this.type=ra.Local,this._configuration=new IZ,this._passParameters=new Lk,this._configuration.geometry=xm.Cylinder,this._technique=r.techniqueRepository.acquire(L5,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Hg(this._vao,"geometry");const s=new oi;s.wrapMode=Xt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Sr(i,s,FYe)}destroy(){this._passParameters.texture=ft(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,e.bindParameters,this._passParameters);_Xe(wse,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",wse),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(sr.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=Txe(1,2,!1),{data:i,indices:s}=r[0][1],n=xse.createBuffer(s.length),o=n.position;for(let a=0;a<s.length;++a){const l=3*s[a%3==0?a+2:a%3==2?a-2:a];o.set(a,0,i[l]),o.set(a,1,i[l+1]),o.set(a,2,i[l+2])}return new Dp(e,Mr,{geometry:Ic(xse)},{geometry:qr.createVertex(e,Pr.STATIC_DRAW,n.buffer)})}};function _Xe(t,e){Bs(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const wse=xe(),xse=Yi().vec3f(O.POSITION),vXe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),sI=128,Tse=-Oj,Sse=0,i9=50,bXe=()=>1-511/512,wXe=ED([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let xXe=class{constructor(e,r){this.view=e,this.type=ra.Mars,this._passParameters=new Lk,this._vaoCount=0,this._texV1=1;const i=Vr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Tse)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Sse)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Sse/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=he(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),si),this._vao=this._createRibbon(s),this._vaoCount=Hg(this._vao,"geometry"),this._fadeVao=Im(s),this._fadeVaoCount=Hg(this._fadeVao,"geometry");const n=new oi;n.wrapMode=Xt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Sr(s,n,vXe);const o=new IZ;o.geometry=xm.Cone,this._coneTechnique=this._techniqueRepository.acquire(L5,o),o.geometry=xm.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(L5,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=ft(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(sr.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),i.bindVAO(this._fadeVao),i.drawArrays(sr.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=E(),i=this._planetRadius,s=Se(e.eye),n=s-i;if(n<0){const f=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=f}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(i9,n),a=i+Tse;this._passParameters.innerScale=TXe(i+o,i,a)-1,this._passParameters.altitudeFade=gZ(n),re(r,e.eye,(i+i9)/s),Ese(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=bXe(),u=wXe(n);let h=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>i9){Ese(e.eye,e.center,e.up,i,this._passParameters.silhouette);const f=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=we((f-1.5)/(l-1.5),0,1);h=this._texV0+g*c*this._texVScale,p=this._texV0+Pt(this._texV1,l*u,g)*this._texVScale}cr(this._passParameters.texV,h,p)}_createRibbon(e){const r=hs(3+3*sI*3),i=new Uint32Array(3*sI*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<sI;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===sI-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const s=Cse.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Dp(e,Mr,{geometry:Ic(Cse)},{geometry:qr.createVertex(e,Pr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return pe(Nx,s.center,s.v2),re(nI,Nx,this._outerRimFactor),H6(s9,r,Nx,i),Iie(Nx,s9,e.projectionMatrix,e.viewport,Nx),Iie(nI,s9,e.projectionMatrix,e.viewport,nI),$i(Nx,nI)/e.height}};function Ese(t,e,r,i,s){const n=Se(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return re(s.center,t,a/n),Ze(l,t,e),pa(l)<1&&Ze(l,t,r),re(l,l,o/Se(l)),Ze(c,l,t),re(c,c,o/Se(c)),o}const s9=xe(),Nx=E(),nI=E();function TXe(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Cse=Yi().vec3f(O.POSITION);var u0;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(u0||(u0={}));let $H=class extends zl{constructor(){super(...arguments),this.type=u0.Rain}};d([G({count:u0.COUNT})],$H.prototype,"type",void 0);function Sxe(t){const e=new Or;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Dt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Dt("offset",(r,i)=>SXe(r,i))),e.vertex.uniforms.add(new Ie("width",r=>r.width)),e.vertex.uniforms.add(new is("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new is("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ie("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===u0.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity),new Dt("particleColor",(r,i)=>EXe(i,t))),e.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===u0.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function SXe(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=zfe(IH,te(IH,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Hi(n,r,re(n,n,t.width))}function EXe(t,e){const r=e.type===u0.Rain?AXe:CXe,i=re(IH,r,PXe),s=t.camera.eye;fe(Ase,s);const n=Math.max(0,de(Ase,t.lighting.mainLight.direction));return li(i,i,r,n)}const IH=E(),Ase=E(),CXe=Pe(1,1,1),AXe=Pe(.85,.85,.85),PXe=.7,MXe=Object.freeze(Object.defineProperty({__proto__:null,build:Sxe},Symbol.toStringTag,{value:"Module"}));let OXe=class extends Ci{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},LH=class Exe extends Gr{initializeProgram(e){return new Dr(e.rctx,Exe.shader.get().build(this.configuration),fN)}initializePipeline(){return Nt({blending:Po(Ee.ONE,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};LH.shader=new Lr(MXe,()=>me(()=>Promise.resolve().then(()=>oAt),void 0));const fN=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let Cxe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},RXe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},Yv=class extends Me{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new OXe,this._animation=new Cxe,this._updatingTracking=new mp,this._passParameters.time=0,this._passParameters.radius=Vr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=er(this._snowTechniqueCached),this._rainTechniqueCached=er(this._rainTechniqueCached),this._vao=ft(this._vao),this._instanceIdBuffer=ft(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new $H;e.type=u0.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(LH,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new $H;e.type=u0.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(LH,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Pt(0,o,2*r):Pt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*QW(this._animation.time)%1e5;const a=n.bindTechnique(s,e.bindParameters,this._passParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),vZ(n,fN,this._instanceIdBuffer,Pse,0),n.drawArraysInstanced(sr.TRIANGLES,0,3,this._numParticles*r),swe(n,fN,this._instanceIdBuffer,Pse)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return qr.createVertex(e,Pr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Dp(e,fN,{geometry:Ic($Xe)},{geometry:qr.createVertex(e,Pr.STATIC_DRAW,r)})}};d([m({constructOnly:!0})],Yv.prototype,"context",void 0),d([m({constructOnly:!0})],Yv.prototype,"view",void 0),d([m({readOnly:!0})],Yv.prototype,"updating",null),d([m()],Yv.prototype,"_updatingTracking",void 0),Yv=d([V("esri.views.3d.environment.Precipitation")],Yv);const $Xe=Yi().vec3f(O.POSITION),Pse=Ic(Yi().f32(O.INSTANCEFEATUREATTRIBUTE),1);function Axe(){const t=new Or;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new is("transform",(e,r)=>IXe(e,r)),new wr("viewport",(e,r)=>r.camera.fullViewport),new Ie("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(x`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function IXe(t,e){return Bs(X0,e.camera.projectionMatrix),X0[10]=24e-8-1,X0[11]=-1,X0[14]=(24e-8-2)*e.camera.near,ri(X0,X0,e.camera.viewMatrix),ri(X0,X0,t.modelMatrix)}const X0=xe(),LXe=Object.freeze(Object.defineProperty({__proto__:null,build:Axe},Symbol.toStringTag,{value:"Module"}));let DXe=class extends Ci{constructor(){super(...arguments),this.modelMatrix=xe()}},Pxe=class Mxe extends Gr{constructor(e){super(e,new zl,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,Mxe.shader.get().build(),Mr)}initializePipeline(){return Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};Pxe.shader=new Lr(LXe,()=>me(()=>Promise.resolve().then(()=>aAt),void 0));let Fy=class extends Me{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new DXe,this._updatingTracking=new mp}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ja(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=er(this._technique),this._vao=ft(this._vao),z1=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,e.bindParameters,this._passParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(sr.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||z1==null)return;this._technique=new Pxe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=z1.byteLength/Mse;const r=new Float32Array(z1,0,2*this._numPoints),i=new Uint8Array(z1,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),ui)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=Bs(this._passParameters.modelMatrix,kXe);ZS(s,s,-i*Math.PI),ri(s,FXe,s),ZS(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=Ose.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const u=r[2*c],h=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(h)),o.set(c,1,-Math.sin(u)*Math.sin(h)),o.set(c,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[c]),f=this._hexToRGB(NXe[p[1]]);a.set(c,0,255*f[0]),a.set(c,1,255*f[1]),a.set(c,2,255*f[2]),a.set(c,3,255),l.set(c,p[0])}return new Dp(e,Mr,{geometry:Ic(Ose)},{geometry:qr.createVertex(e,Pr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(z1!=null)return null;const e=Am(async r=>{const{data:i}=await gNe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),z1=i});return e.promise.catch(r=>{ns(r)||ae.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new J("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Mse;if(r%1!=0||r>5e4||r<5e3)throw new J("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([m({constructOnly:!0})],Fy.prototype,"view",void 0),d([m({constructOnly:!0})],Fy.prototype,"requestRender",void 0),d([m({readOnly:!0})],Fy.prototype,"updating",null),d([m()],Fy.prototype,"_loadDataTask",void 0),d([m()],Fy.prototype,"_updatingTracking",void 0),Fy=d([V("esri.views.3d.environment.Stars")],Fy);const NXe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],FXe=rX(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),kXe=rX(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Mse=9,Ose=Yi().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let z1=null;const Gk={required:[]},Oxe={required:[k.LinearDepth]},Rxe={required:[k.CompositeColor]},$xe={required:[k.Highlight]},UXe={required:[k.Depth,k.Normal]};let jk=class extends Me{consumes(){return Gk}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},ux=class extends jk{},Ixe=class extends jk{constructor(){super(...arguments),this.drapedPriority=0}},zXe=class extends jk{},BXe=class extends jk{};function DH(t){return"prepareTechnique"in t}function Rse(t){return"prepareTechniques"in t}var fS;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(fS||(fS={}));var MA;let $o=MA=class extends ux{constructor(t){super(t),this.produces=new Map([[ue.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[ue.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new n9,this._newWeatherParameters=new n9,this._fadedWeatherParameters=new n9,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:ra.None}consumes(){return this._atmosphereType===ra.Realistic?Oxe:Gk}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Se(this.view.state.camera.eye)-Vr(this.view.spatialReference).radius<=Mg}get usedMemory(){var t;return((t=this._clouds)==null?void 0:t.usedMemory)??0}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new Fy({view:t,requestRender:()=>this._setNeedsRender()}):(Ae(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Ae(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Ae(t),new Yv({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Ae(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Ae(t),new gl({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Ae(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Vr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Ae(t),new Hv({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Ae(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new qv({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([he(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),si),he(()=>this._stars,e),he(()=>this._precipitation,e),he(()=>this._clouds,()=>this._updateWeather(),ui),he(()=>this._fog,()=>this._updateFogHaze(),ui),he(()=>this.view.state.mode,()=>{this._setNeedsRender()},ti),he(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},si)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Ae(this._atmosphere),this._set("_stars",Ae(this._stars)),this._set("_precipitation",Ae(this._precipitation)),this._set("_clouds",Ae(this._clouds)),this._set("_cloudsComposition",Ae(this._cloudsComposition)),this._set("_fog",Ae(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=vWe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===Yf.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){var e,r,i,s,n,o,a;switch(t.bindParameters.slot){case ue.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,(i=(r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer)==null?void 0:i.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&((s=t.bindParameters.cloudsFade.data)==null?void 0:s.cubeMap)!=null&&this._context.requestRender());break;case ue.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,(a=(o=(n=this.view)==null?void 0:n._stage)==null?void 0:o.renderer)==null?void 0:a.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation)){const l=this.view.environment.weather;l.type!=="rainy"&&l.type!=="snowy"||this._precipitation.render(t,l.precipitation,l.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===fS.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==Mi.CROSS_FADE&&t.cloudsFade.fadeMode!==Mi.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==Mi.CROSS_FADE&&t.cloudsFade.fadeMode!==Mi.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(ta[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Pt(3e-5,.005,t.weatherAdjustment**3),ce(this._newWeatherParameters.fog.color,$se),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Pt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,VXe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Pt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,$se),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==ra.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Ae(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Ae(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case ra.Realistic:return jie;case ra.Local:return yXe;case ra.Mars:return xXe;default:case ra.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||h1(this.view.spatialReference)?ra.None:r===Ne.Local?ra.Local:this._context!=null&&jie.isSupported(this._context)&&BM(this.view.spatialReference)?ra.Realistic:u1(this.view.spatialReference)?ra.Mars:ra.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Ise=MA.prototype._getAtmosphereClass,MA.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{MA.prototype._getAtmosphereClass=Ise}}}};d([m({constructOnly:!0})],$o.prototype,"view",void 0),d([m({readOnly:!0})],$o.prototype,"atmosphere",null),d([m({readOnly:!0})],$o.prototype,"_atmosphereType",null),d([m({type:Boolean,readOnly:!0})],$o.prototype,"updating",null),d([m({readOnly:!0})],$o.prototype,"weatherVisible",null),d([m()],$o.prototype,"_context",void 0),d([m()],$o.prototype,"_atmosphere",void 0),d([m({readOnly:!0})],$o.prototype,"_stars",null),d([m({readOnly:!0})],$o.prototype,"_precipitation",null),d([m({readOnly:!0})],$o.prototype,"_clouds",null),d([m({readOnly:!0})],$o.prototype,"_cloudsComposition",null),d([m({readOnly:!0})],$o.prototype,"_fog",null),d([m({readOnly:!0})],$o.prototype,"weatherEnabled",null),d([m({readOnly:!0})],$o.prototype,"_precipitationEnabled",null),d([m({readOnly:!0})],$o.prototype,"_weatherUpdateParameters",null),$o=MA=d([V("esri.views.3d.environment.EnvironmentRenderer")],$o);let n9=class{constructor(){this.fog=new RYe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ce(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Pt(e.fog.amount,r.fog.amount,i),this.hazeAmount=Pt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=Pt(e.fog.strength,r.fog.strength,i),li(this.fog.color,e.fog.color,r.fog.color,i)}};const VXe=Pe(.5,.5,.5),$se=Pe(1.5,1.5,1.5);let Ise;var SDt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ER(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lse,Dse,Nse,Lxe={exports:{}};Lse=Lxe,Dse=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function p(I){return I.valueOf()/l-.5+c}function f(I){return new Date((I+.5-c)*l)}function g(I){return p(I)-u}var _=23.4397*a;function v(I,N){return n(e(I)*r(_)-i(N)*e(_),r(I))}function b(I,N){return s(e(N)*r(_)+r(N)*e(_)*e(I))}function w(I,N,B){return n(e(I),r(I)*e(N)-i(B)*r(N))}function T(I,N,B){return s(e(N)*e(B)+r(N)*r(B)*r(I))}function S(I,N){return a*(280.16+360.9856235*I)-N}function C(I){return a*(357.5291+.98560028*I)}function P(I){return a*(1.9148*e(I)+.02*e(2*I)+3e-4*e(3*I))}function R(I,N){return I+N+102.9372*a+t}function L(I,N){var B=C(I),H=R(B,P(B));return N||(N={dec:0,ra:0}),N.dec=b(H,0),N.ra=v(H,0),N}var F={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(I,N,B,H){var q=a*-B,Q=a*N,ie=g(I),_e=L(ie,h),Oe=S(ie,q)-_e.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=w(Oe,Q,_e.dec),H.altitude=T(Oe,Q,_e.dec),H}},U=[[-.83,"sunrise","sunset"]];F.addTime=function(I,N,B){U.push([I,N,B])};var j=9e-4;function z(I,N){return Math.round(I-j-N/(2*t))}function Z(I,N,B){return j+(I+N)/(2*t)+B}function W(I,N,B){return u+I+.0053*e(N)-.0069*e(2*B)}function Y(I,N,B){return o((e(I)-e(N)*e(B))/(r(N)*r(B)))}function le(I){var N=a*(134.963+13.064993*I),B=a*(93.272+13.22935*I),H=a*(218.316+13.176396*I)+6.289*a*e(N),q=5.128*a*e(B),Q=385001-20905*r(N);return{ra:v(H,q),dec:b(H,q),dist:Q}}return F.getTimes=function(I,N,B){var H=a*-B,q=a*N,Q=z(g(I),H),ie=Z(0,H,Q),_e=C(ie),Oe=P(_e),gt=R(_e,Oe),It=b(gt,0),xt=W(ie,_e,gt);function ct(Re){return W(Z(Y(Re,q,It),H,Q),_e,gt)}function Qe(Re){var Be=(e(Re)-e(q)*e(It))/(r(q)*r(It));return Be<-1?F.PolarException.MIDNIGHT_SUN:Be>1?F.PolarException.POLAR_NIGHT:F.PolarException.NORMAL}var Ve,yr,Er,Ii,Ue,dr={solarNoon:f(xt),nadir:f(xt-.5),polarException:F.PolarException.NORMAL};for(Ve=0,yr=U.length;Ve<yr;Ve+=1)Ue=xt-((Ii=ct((Er=U[Ve])[0]*a))-xt),dr[Er[1]]=f(Ue),dr[Er[2]]=f(Ii);return dr.polarException=Qe(U[0][0]*a),dr},F.getMoonPosition=function(I,N,B){var H=a*-B,q=a*N,Q=g(I),ie=le(Q),_e=S(Q,H)-ie.ra,Oe=T(_e,q,ie.dec);return Oe+=.017*a/i(Oe+10.26*a/(Oe+5.1*a)),{azimuth:w(_e,q,ie.dec),altitude:Oe,distance:ie.dist}},F.getMoonFraction=function(I){var N=g(I),B=L(N),H=le(N),q=149598e3,Q=o(e(B.dec)*e(H.dec)+r(B.dec)*r(H.dec)*r(B.ra-H.ra)),ie=n(q*e(Q),H.dist-q*r(Q));return(1+r(ie))/2},F},(Nse=Dse())!==void 0&&(Lse.exports=Nse);const Bw=ER(Lxe.exports),Ga={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let oI=class{constructor(e,r){this.direct=e,this.ambient=r}};function GXe(t,e,r,i,s,n){te(n.ambient.color,1,1,1),n.ambient.intensity=Ga.global.ambient,te(n.direct.color,1,1,1),n.direct.intensity=Ga.global.direct;const o=e[2],a=we((Math.abs(o)-Ga.local.altitude)/(Ga.global.altitude-Ga.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Bw.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=ZXe(t,l,i);else{const u=Fxe(i);c={direct:{intensity:Ga.local.directAtNoon*u.direct,color:Pe(1,1,1)},ambient:{intensity:Ga.local.ambientAtNoon*u.ambient,color:Pe(1,1,1)},timeOfDay:"early afternoon"}}li(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Pt(c.ambient.intensity,n.ambient.intensity,a),li(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Pt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?XXe(t,l):1,t!=null?jXe(t,e,r,n.direct.directionToLightSource):Dxe(s,r,n.direct.directionToLightSource)}function Dxe(t,e,r){e===Ne.Global?fe(c9,t.eye):te(c9,0,0,1),re(u9,t.viewForward,-1);const i=i5(u9,c9),s=Math.max(i-2*h9,0),n=.85*s/(s+1),o=Math.max(h9,i-h9-n);Su(Wse,-o,t.viewRight),Ge(r,u9,Wse),pe(r,r,re(JXe,t.viewRight,KXe)),fe(r,r)}function jXe(t,e,r,i){const s=YXe,n=Nh(WXe);if(r===Ne.Global)Bw.getPosition(t,0,0,s),te(i,0,0,-1),XS(n,n,-s.azimuth),j6(n,n,-s.altitude),Ge(i,i,n);else{const o=Ga.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=we(c,0,1),c<1?(Bw.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),te(i,0,-1,0),ZS(n,n,-s.azimuth),XS(n,n,-s.altitude),Ge(i,i,n)}}function HXe(t,e){if(e===Ne.Global)return!0;const r=Ga.planarDirection;return Math.abs(t)<r.localAltitude}const qXe=Pe(.5773502691896258,-.5773502691896258,.5773502691896258);let Nxe=class{constructor(){this.ambient={color:Pe(1,1,1),intensity:.55},this.direct={color:Pe(1,1,1),intensity:.55,directionToLightSource:qi(qXe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const WXe=xe(),YXe={azimuth:0,altitude:0};function XXe(t,e){const r=t.valueOf();let i,s;e.polarException===Bw.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===Bw.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-we(Math.abs(r-n)/432e5,0,1)}function Fxe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new oI(1,1);case"rainy":return new oI(.4,1.2);case"snowy":return new oI(.5,1.3);case"foggy":return new oI(.2,1.6)}}function Fse(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const o9=Pe(.01,.01,.01),NH=Pe(1,.6,.5),FH=Pe(1,.98,.98),kse=Pe(1,1,1),a9=Pe(.8,.8,1),kH=Pe(.8,.8,1),UH=Pe(.98,.98,1),Use=Pe(1,1,1),l9=ar(.01,Ga.local.ambientAtNight),zH=ar(Ga.local.directAtTwilight,Ga.local.ambientAtTwilight),BH=ar(.9*Ga.local.directAtNoon,Ga.local.ambientAtNoon),zse=ar(Ga.local.directAtNoon,Ga.local.ambientAtNoon),Bse=BH,Vse=FH,Gse=UH,jse=zH,Hse=NH,qse=kH;function ZXe(t,e,r){const i=t.valueOf();let s,n;e.polarException===Bw.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Bw.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,p=s-h/2,f=s+h/2,g=n-h/2,_=n+h/2,v=je(),b=E(),w=E();let T="";if(i<p||i>_)Vn(v,l9),ce(b,o9),ce(w,a9),T="night";else if(i<f){const P=(i-p)/(f-p);dh(v,l9,zH,P),li(b,o9,NH,P),li(w,a9,kH,P),T="sun rising"}else if(i<c){const P=(i-f)/(c-f);dh(v,zH,BH,P),li(b,NH,FH,P),li(w,kH,UH,P),T="early morning"}else if(i<a){const P=(i-c)/(a-c);dh(v,BH,zse,P),li(b,FH,kse,P),li(w,UH,Use,P),T="late morning"}else if(i<u){const P=(i-a)/(u-a);dh(v,zse,Bse,P),li(b,kse,Vse,P),li(w,Use,Gse,P),T="early afternoon"}else if(i<g){const P=(i-u)/(g-u);dh(v,Bse,jse,P),li(b,Vse,Hse,P),li(w,Gse,qse,P),T="late afternoon"}else if(i<_){const P=(i-g)/(_-g);dh(v,jse,l9,P),li(b,Hse,o9,P),li(w,qse,a9,P),T="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(Fse(b,S),Fse(w,S));const C=Fxe(r);return{direct:{intensity:v[0]*C.direct,color:b},ambient:{intensity:v[1]*C.ambient,color:w},timeOfDay:T}}const Wse=xe(),c9=E(),u9=E(),JXe=E(),h9=.25,KXe=.2;let Sd=class extends Gs.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new R5,this._ambientLight=new OZ,this._moonLight=new kwe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===Ne.Global&&BM(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new $o({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([he(()=>e.environment.lighting,s=>this._updateLightingHandler(s),ti),he(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),ti),he(()=>e.stationary,()=>this._interactingStationaryHandler()),he(()=>e.environment.lighting.directShadowsEnabled,r,ti),he(()=>e.qualitySettings.ambientOcclusion,r,ti),he(()=>e.qualitySettings.reflections,r,ti),he(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ti),he(()=>e.environment.weather.type,()=>this._updateLighting(null,fS.Faded),ti),he(()=>this.weatherEnabled,()=>this._updateLighting(null,fS.Faded),ti),he(()=>e.viewingMode,()=>this._resetReferencePosition(!0),si),he(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),si),he(()=>e.state.camera,i,si),he(()=>this.disableQueries,i)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Ae(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!V_(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=Lre(this._referencePosWGS84Comparable,Yse);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=BM(this._view.spatialReference);if(i&&!V_(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=E()),i?UHe(s,this._referencePosWGS84Comparable):te(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=fS.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s?QXe:eZe,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?GXe(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&Dxe(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;re(a.intensity,l.color,l.intensity*Math.PI),ce(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;re(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;li(u.intensity,rZe,iZe,n.globalFactor);const h=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));re(u.intensity,u.intensity,h),ce(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=tZe;i.setTime((r||this._view.environment.lighting.date).getTime());const s=Lre(e,Yse);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||HXe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=LM(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=LM(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};d([m({type:Boolean,readOnly:!0})],Sd.prototype,"updating",null),d([m()],Sd.prototype,"disableQueries",void 0),d([m()],Sd.prototype,"_disableWeather",void 0),d([m()],Sd.prototype,"weatherEnabled",null),d([m()],Sd.prototype,"weatherVisible",null),d([m()],Sd.prototype,"referencePositionWGS84Comparable",null),d([m()],Sd.prototype,"_renderer",void 0),d([m()],Sd.prototype,"_referencePosWGS84Comparable",void 0),Sd=d([V("esri.views.3d.environment.SceneViewEnvironmentManager")],Sd);const QXe=new Nxe,eZe=new Nxe,tZe=new Date,Yse={hours:0,minutes:0,seconds:0},rZe=Pe(.22,.22,.33),iZe=Pe(.22,.22,.22);var Ui;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ui||(Ui={}));var tr;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(tr||(tr={}));var Tm;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Tm||(Tm={}));let Xh=class{constructor(e=Ui.ALL,r=tr.NONE,i=0,s=null,n=null,o=Tm.TUMBLE){this.selection=e,this.interactionType=r,this.interactionFactor=i,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function fO(t,e){return(t&e)!=0}function U5(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const hx=new Xh(Ui.NONE);function kxe(t,e,r,i){return e=e||t.viewForward,ce(i,e),re(i,i,Math.sign(de(e,r))),i}function sZe(t,e,r,i){return cZe(t,e,r,aZe(i,e,r,!0))}function nZe(t,e,r,i){const s=de(r,ye(t,i,e));return pe(t,e,re(t,r,s))}const oZe={dir:E(),len:0,clip:je()};function aZe(t,e,r,i){const s=oZe;return t?(r&&i&&(s.len=$i(e,r)),ce(s.dir,t)):(s.len=$i(e,r),ye(s.dir,r,e),re(s.dir,s.dir,1/s.len)),s}function lZe(t,e,r){const i=de(t,r.dir),s=-bi(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function cZe(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!lZe(t[s],e,i))return!1;return!0}function uZe(t,e,r=hx){const i=jZ(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=kxe(e,r.interactionDirection,pZe(t,e,Math.sign(i),yZe),gZe),a=ce(_Ze,e.viewForward),l=s.intersectInfiniteManifold(Eu(e.eye,o),n,d9);return e.eye=l??s.setAltitude(d9,n,e.eye),e.center=nZe(d9,e.eye,a,e.center),!0}function jZ(t,e,r=hx){if(!hZe(t,r)||!t.state.constraints.altitude)return 0;const i=fZe(t.state.constraints.altitude,mZe);dZe(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=we(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function hZe(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==tr.TUMBLE||!fO(e.selection,Ui.TILT))}function dZe(t,e,r){const i=e.interactionType;if(i===tr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===tr.TUMBLE||i===tr.ZOOM,c=jZ(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,U5(c,u,l,a,.05*u,r)}function pZe(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),re(i,i,r),i}function fZe(t,e){return e.min=t.min,e.max=t.max,e}const mZe={min:0,max:0},gZe=E(),yZe=E(),_Ze=E(),d9=E();function HZ(t,e,r=hx){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;aI.min=0,aI.max=i,bZe(t,r,aI);const s=qZ(t,e),n=aI.max-s;return n>=-1e-6?0:n}function vZe(t,e,r=hx){const i=HZ(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=qZ(t,e)+i,o=ce(xZe,e.eye),a=kxe(e,r.interactionDirection,wZe(e,s.renderLocation,EZe),SZe);if(!f1(Yye(s.renderLocation,n),Eu(e.eye,a),lI))return!1;e.eye=lI;const l=ye(TZe,e.eye,o);e.center=pe(lI,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,lI);return u!=null&&(e.center=u),!0}function bZe(t,e,r){const i=e.interactionType;if(i===tr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===tr.ZOOM||i===tr.PAN,c=HZ(t,o),u=c===0?0:qZ(t,o);r.min=s,r.max=n,U5(c,u,l,a,.05*u,r)}function qZ(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?$i(e.eye,r.renderLocation):0}function wZe(t,e,r){return m0(r,t.eye,e)}const aI={min:0,max:0},xZe=E(),TZe=E(),SZe=E(),EZe=E(),lI=E();function oC(t,e,r=Th.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=hk(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Se(e.eye);if(ye(cI,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(CZe,o,e.eye),r===Th.EYE_AND_CENTER)e.center=pe(cI,e.eye,cI);else if(r===Th.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=re(cI,e.center,l)}return!0}var Th;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Th||(Th={}));const cI=E(),CZe=E();function Q_(t,e,r){t.worldUpAtPosition(e,Xse),ye(p9,r,e);const i=Se(p9);return i===0?0:Bn(de(p9,Xse)/i)}const Xse=E(),p9=E();function Uxe(t,e,r,i=!0){XC.eyeCenterDistance=0,XC.requiresTwoSteps=!1;const s=WZ(t,e,r,hx,XC);if(s===0)return!1;switch(Su(uI,-s,e.viewRight),r.tiltMode){case Tm.LOOK_AROUND:Ge(Z0,e.viewForward,uI),re(Z0,Z0,XC.eyeCenterDistance),e.center=pe(e_,e.eye,Z0);break;case Tm.TUMBLE:ye(Z0,e.center,e.eye),Ge(Z0,Z0,uI),e.eye=ye(e_,e.center,Z0);break;default:r.tiltMode}return e.up=Ge(e_,e.up,uI),!XC.requiresTwoSteps||!i||Uxe(t,e,r,!1)}function WZ(t,e,r,i=hx,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,NZe);return DZe(t,r,o),i.interactionType===tr.TUMBLE&&fO(i.selection,Ui.ALTITUDE)&&zxe(t,i.interactionStartCamera,o),r.tiltMode===Tm.LOOK_AROUND||i.tiltMode===Tm.LOOK_AROUND?PZe(t,e,o,s):AZe(t,e,o)}function AZe(t,e,r){const i=Q_(t.renderCoordsHelper,e.center,e.eye),s=i-we(i,r.min,r.max);return mO(s)?s:0}function PZe(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return OZe(t,e,r,i);case"local":return MZe(t,e,r,i)}}function MZe(t,e,r,i){const s=Q_(t.renderCoordsHelper,e.center,e.eye),n=we(s,r.min,r.max),o=s-n;if(!mO(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function OZe(t,e,r,i){const s=RZe(t,e,FZe),n=we(s.tiltAtCenter,r.min,r.max);if(!mO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=$Ze(s),a=IZe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=LZe(s,o)),i&&(i.eyeCenterDistance=VH(s,o)),a}function RZe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Vr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,e_);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=$i(e.eye,n),r.tiltAtCenter=Q_(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=Q_(t.renderCoordsHelper,e.center,e.eye):(ZE(ek(tk,s),e.ray,e_),r.eyeCenterDistance=$i(e.eye,e_),r.tiltAtCenter=Bn(-de(e.viewForward,fe(e_,e_)))),r.radius=s,r.eyeRadius=Se(e.eye),r.constraints=t.state.constraints,r}function mO(t){return Math.abs(t)>1e-9}function $Ze(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=VH(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&mO(n-s);){const l=(s+n)/2,c=VH(t,l);mO(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function VH(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-we(e,0,Math.PI),i=Rh(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function IZe(t,e){const r=Rh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Rh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function LZe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function DZe(t,e,r){if(e.interactionType===tr.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=WZ(t,i,hx,e),l=a===0?0:Q_(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===tr.TUMBLE?(fO(e.selection,Ui.ALTITUDE)&&zxe(t,i,r),U5(a,l,!0,s,Zse,r)):U5(a,l,!1,s,Zse,r)}function zxe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=pa(e.center),n=Math.sqrt(s),o=e.distance,a=Vr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),h=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Bn(h),r.max)),r.max=Math.min(r.max,Math.PI-Bn(u))}const Z0=E(),uI=xe(),e_=E(),Zse=Lt(5),NZe={min:0,max:0},FZe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},XC={eyeCenterDistance:0,requiresTwoSteps:!1},kZe=t=>t,Hk=t=>t*t,YZ=t=>1-Hk(1-t),UZe=t=>t<.5?Hk(2*t)/2:(YZ(2*(t-.5))+1)/2,XZ=t=>t*t*t,Bxe=t=>1-XZ(1-t),Vxe=t=>t<.5?XZ(2*t)/2:(Bxe(2*(t-.5))+1)/2,ZZ=t=>t*t*t*t,Gxe=t=>1-ZZ(1-t),zZe=t=>t<.5?ZZ(2*t)/2:(Gxe(2*(t-.5))+1)/2,JZ=t=>t*t*t*t*t,jxe=t=>1-JZ(1-t),BZe=t=>t<.5?JZ(2*t)/2:(jxe(2*(t-.5))+1)/2,KZ=t=>1-Math.cos(t*Math.PI/2),Hxe=t=>1-KZ(1-t),VZe=t=>t<.5?KZ(2*t)/2:(Hxe(2*(t-.5))+1)/2,QZ=t=>2**(10*(t-1)),CR=t=>1-QZ(1-t),GZe=t=>t<.5?QZ(2*t)/2:(CR(2*(t-.5))+1)/2,eJ=t=>-(Math.sqrt(1-t*t)-1),qxe=t=>1-eJ(1-t),jZe=t=>t<.5?eJ(2*t)/2:(qxe(2*(t-.5))+1)/2;function Zh(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Jh(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const HZe=Jh(Zh(1),1),qZe=Jh(Zh(1),0),Wxe=Jh(Zh(1),.5),WZe=Jh(Zh(2),1),YZe=Jh(Zh(2),0),XZe=Jh(Zh(2),.5),ZZe=Jh(Zh(3),1),JZe=Jh(Zh(3),0),KZe=Jh(Zh(3),.5),QZe=Jh(Zh(4),1),eJe=Jh(Zh(4),0),tJe=Jh(Zh(4),.5),rJe={linear:kZe,"in-quad":Hk,"out-quad":YZ,"in-out-quad":UZe,"in-coast-quad":HZe,"out-coast-quad":qZe,"in-out-coast-quad":Wxe,"in-cubic":XZ,"out-cubic":Bxe,"in-out-cubic":Vxe,"in-coast-cubic":WZe,"out-coast-cubic":YZe,"in-out-coast-cubic":XZe,"in-quart":ZZ,"out-quart":Gxe,"in-out-quart":zZe,"in-coast-quart":ZZe,"out-coast-quart":JZe,"in-out-coast-quart":KZe,"in-quint":JZ,"out-quint":jxe,"in-out-quint":BZe,"in-coast-quint":QZe,"out-coast-quint":eJe,"in-out-coast-quint":tJe,"in-sine":KZ,"out-sine":Hxe,"in-out-sine":VZe,"in-expo":QZ,"out-expo":CR,"in-out-expo":GZe,"in-circ":eJ,"out-circ":qxe,"in-out-circ":jZe};function Us(t,e,r=oJe,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<aJe;a++){let l=0;for(const c of nJe)if(fO(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=u)}if(l===0)break}const n=fO(r.selection,Ui.COLLISION),o=iJe(r.interactionType,t);return n&&oC(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function iJe(t,e){switch(t){case tr.PAN:return Th.EYE_AND_CENTER;case tr.ASCEND:return e.state.isGlobal?Th.EYE_AND_CENTER_SCALE:Th.EYE_AND_CENTER;default:return Th.EYE}}function Hd(t){const e=Math.min(1,t/150);return Vxe(e)}function sJe(t,e,r){return WZ(t,e,r)*e.distance}const nJe=[{type:Ui.TILT,error:sJe,apply:Uxe},{type:Ui.ALTITUDE,error:jZ,apply:uZe},{type:Ui.DISTANCE,error:HZ,apply:vZe}],oJe=new Xh,aJe=5;let Jse=class{constructor(e){this.viewingMode=e,this.center=E(),this.pitch=0,this.yaw=0,this.distance=0,this.direction=qi(Kse),this.fov=55,this.size=1}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ne.Global){const n=(Se(this.center)+Se(e.center))/2;r.pan=i5(this.center,e.center)*n}else r.pan=$i(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Ne.Global?f8e(e.center,r.center,i.pan,this.center):li(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Pt(e.distance,r.distance,i.zoom):e.distance,this.pitch=Pt(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Pt(s,n,i.rotate)}copyFrom(e){ce(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ce(this.direction,e.direction),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,Qse);ce(this.center,e.center),ye(Ro,e.center,e.eye),Bo(Ro,Ro,r),Bo(K0,e.up,r),this.distance=Se(Ro),this.distance!==0&&(Ro[0]/=this.distance,Ro[1]/=this.distance,Ro[2]/=this.distance),this.pitch=this._eyeUpToPitch(Ro),this.yaw=lJe(Ro,K0),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,Qse);Uh(r,r),this._axisAngleVec3(mN,this.pitch-Math.PI/2,Kse,Ro),this._axisAngleVec3(yb,this.yaw,Ro,Ro),this._axisAngleVec3(mN,this.pitch-Math.PI/2,yb,K0),this._axisAngleVec3(yb,this.yaw,K0,K0),re(Ro,Ro,this.distance),Bo(Ro,Ro,r),Bo(K0,K0,r),e.center=this.center,e.eye=ye(Ro,this.center,Ro),e.up=K0}_axisAngleVec3(e,r,i,s){const n=Math.cos(r),o=Math.sin(r);return re(Fc,i,n),Ze(ic,e,i),re(ic,ic,o),re(J0,e,(1-n)*de(e,i)),pe(s,pe(s,Fc,ic),J0)}_lookAtOrientation(e,r=xi()){return this._upAtLookAt(e,J0),Ze(Fc,this.direction,J0),fe(Fc,Fc),Fc[0]===0&&Fc[1]===0&&Fc[2]===0&&ce(Fc,mN),Ze(ic,J0,Fc),fe(ic,ic),r[0]=Fc[0],r[1]=ic[0],r[2]=J0[0],r[3]=Fc[1],r[4]=ic[1],r[5]=J0[1],r[6]=Fc[2],r[7]=ic[2],r[8]=J0[2],r}_upAtLookAt(e,r){return this.viewingMode===Ne.Local?ce(r,yb):fe(r,e)}_eyeUpToPitch(e){return Math.PI-i5(yb,e)}};function lJe(t,e){const r=cJe;return Math.abs(e[2])<.5?(ce(r,e),t[2]>0&&re(r,r,-1)):ce(r,t),Ze(ic,r,yb),fe(ic,ic),i5(mN,ic,yb)}const Fc=E(),ic=E(),J0=E(),Ro=E(),K0=E(),cJe=E(),yb=$S,Kse=lY,mN=aY,Qse=xi(),z5={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let uJe=class Yxe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:z5.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Yxe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:z5.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},hJe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(h-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},f9=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function dJe(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function pJe(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function fJe(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function mJe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function gJe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function yJe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function _Je(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function vJe(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function bJe(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function wJe(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function xJe(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function TJe(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function SJe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function EJe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function CJe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function AJe(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function PJe(t,e){let r=MJe(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?mJe:dJe,a=s?gJe:pJe,l=s?yJe:fJe,c=n?SJe:wJe,u=n?EJe:xJe,h=n?CJe:TJe,p=S=>o(t,S,i)+_Je(t,S,i)+c(t,S,i),f=S=>a(t,S,i)+vJe(t,S,i)+u(t,S,i),g=S=>l(t,S,i)+bJe(t,S,i)+h(t,S,i);let _=p(r);const v=AJe(t);let b;const w=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const C=(f(r)+1e-6)/g(r);if(isNaN(C)||r>=T&&C<0){if(!isFinite(T))return null;r=T,_=p(r);break}if(r-=C,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const P=p(r);if(Math.abs(P-_)/_<=.005)break;_=P}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function MJe(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let OJe=class extends hJe{constructor(e,r){super(),this._preallocSegments=[new f9,new f9,new f9],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r!=null&&r.apex&&(i=PJe(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=YZ(i.zoom):e===this._descensionSegment&&(i.zoom=Hk(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const RJe={zoom:0,pan:0,rotate:0};let $Je=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new uJe(e),this.path=new OJe}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(lfe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?Wxe:CR)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,RJe);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:z5.minDuration/i,n=r.maxDuration!=null?r.maxDuration:z5.maxDuration/i;return Math.min(Math.max(s,e),n)}},IJe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new $Je(()=>new Jse(e)),this._current=new Jse(e)}update(e,r,i){const{source:s,target:n}=this._animation.definition,o=ye(LJe,r.center,e.center),a=Se(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ce(s.direction,o),ce(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new Je,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+lfe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};const LJe=E();var Qi;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(Qi||(Qi={}));let Og=class extends Me{constructor(e){super(e),this.state=Qi.Ready}get active(){return this.state===Qi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Qi.Stopped,!0)}finishController(){this.state=Qi.Finished}get steppingFinished(){return!1}};d([m({constructOnly:!0})],Og.prototype,"view",void 0),d([m({readOnly:!0})],Og.prototype,"active",null),d([m()],Og.prototype,"state",void 0),d([m({readOnly:!0})],Og.prototype,"isInteractive",null),Og=d([V("esri.views.3d.state.controllers.CameraController")],Og);let gO=class extends Og{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(hr()),this._asyncResult=null),this.state===Qi.Finished||this.state===Qi.Stopped?(l6(e),this.state===Qi.Finished?e.resolve():e.reject(hr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Qi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Qi.Ready&&this.state!==Qi.Running||(this.viewAnimation.state===lE.State.FINISHED?this.finish():this.viewAnimation.state===lE.State.STOPPED&&(this.state=Qi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Qi.Finished?this.viewAnimation.finish():this.state===Qi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Qi.Finished?this._asyncResult.resolve():this._asyncResult.reject(hr()))}finish(){this.finishController()}};gO=d([V("esri.views.3d.state.controllers.AnimationController")],gO);let Ug=class extends gO{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new IJe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new lE}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);hI.copyFrom(this.view.state.camera);const s=zh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(hI.ray,s,ene)&&(hI.center=ene),this.animation.update(hI,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?rJe[e.easing]:e.easing}}};d([m({constructOnly:!0})],Ug.prototype,"mode",void 0),d([m({readOnly:!0})],Ug.prototype,"isInteractive",null),Ug=d([V("esri.views.3d.state.controllers.PointToPointAnimationController")],Ug);const hI=new Je,ene=E();function qk(t=NJe){return[t[0],t[1],t[2],t[3]]}function yO(t,e){return DJe(t[0],t[1],t[2],e,nX.get())}function DJe(t,e,r,i,s=qk()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function tJ(t,e,r){return Ze(r,t,e),fe(r,r),r[3]=X6(t,e),r}const NJe=[0,0,1,0];function kDt(t,e,r=Un()){return rJ(t,Jd(e),r),fe(r.direction,r.direction),r}function rJ(t,e,r){return FJe(t,t.screenToRender(e,ze.get()),r)}function FJe(t,e,r){const i=Vn(ze.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=Vn(ze.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,ze.get());return n==null?null:(ye(r.direction,n,r.origin),r)}function aC(t,e,r){return iJ(t,t.screenToRender(e,ze.get()),r)}function iJ(t,e,r){ce(r.origin,t.eye);const i=te(ze.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,ze.get());return s==null?null:(ye(r.direction,s,r.origin),r)}function sJ(t,e,r,i){const s=aC(e,r,kJe);return f1(t,s,i)}const kJe=Un();var fE;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(fE||(fE={}));const Xxe=30,B5=[1,3e8],Wk=80,Zxe=8,Jxe=200,Kxe=1508e5,Qxe=5,e2e=50,UJe=5,zJe=10,m9=90,dx={exclude:new Set([G_])};function ow(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function GH(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function e1(t,e,r){const i=Su(oX.get(),r[3],r);i==null||eX(i,ts)||(ye(fi,t.eye,e),Ge(fi,fi,i),t.eye=pe(fi,fi,e),ye(fi,t.center,e),Ge(fi,fi,i),t.center=pe(fi,fi,e),t.up=Ge(fi,t.up,i))}function BJe(t,e,r,i){return ex(t,rJ(e,r,aJ),i)}function jH(t,e,r,i){return ex(t,aC(e,r,aJ),i)}function nJ(t,e,r,i){const s=ze.get();let n=1-r;ye(s,e,t.eye);const o=Se(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(re(s,s,n),t.eye=pe(fi,t.eye,s),t.center=li(fi,t.center,e,n))}function t2e(t,e,r){e.getScreenCenter(tne),sJ(t,e,tne,fi)&&(e.center=fi);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=re(ze.get(),e.viewForward,s);e.eye=ye(fi,e.center,n)}const tne=us();function g9(t,e){te(e,0,0,0);for(const r of t)pe(e,e,r);re(e,e,1/t.length)}function gN(t,e,r,i){return Math.sin(t/Se(e))*(r+i.radius)}function rne(t,e,r,i){return gN(Math.PI/2,e,r,i)+(t-Math.PI/2)}var oo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(oo||(oo={}));const ine={Elevation:3e4,Angle:Lt(16)},dI={Pole:.95,Angle:Lt(18),Tilt:45},r2e=Lt(80);function i2e(t,e,r,i,s,n){const o=E(),a=Vs();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Se(o):(c=!1,e.aboveGround&&s!==fE.Ellipsoid?a[3]=Math.max(Se(e.center),.9*i.radius):a[3]=Se(e.eye)-e.relativeElevation,s===fE.Silhouette?_O(a,e,r,o):l=sJ(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function Yk(t,e,r){return Se(t.eye)-r.radius>ine.Elevation?oo.Horizontal:(aC(t,e,hne),-Math.sign(t.relativeElevation)*(.5*Math.PI+X6(t.eye,hne.direction))<ine.Angle?oo.Vertical:oo.Horizontal)}function s2e(t,e,r){ye(y9,r,e),t.eye=ye(fi,t.eye,y9),t.center=ye(fi,t.center,y9)}const y9=E();function _O(t,e,r,i){const s=aC(e,r,aJ);return s!=null&&(ZE(t,s,pI),f1(t,s,i)?!(So(pI,s.origin)<So(i,s.origin))||(ce(i,pI),!1):(ye(Fx,e.eye,e.center),fe(Fx,Fx),Rye(Fx,-de(fe(Fx,Fx),pI),sne),ex(sne,s,i),!1))}const pI=E(),Fx=E(),sne=zr();function n2e(t,e,r,i,s,n){let o=0;if(Ze(j5,t,e),ye(yI,t,e),Se(t)<=s||!i.aboveGround){Ze(r,yI,i.eye);const a=de(t,e)/(Se(t)*Se(e));if(a<.9999)o=Bn(a);else{const c=Se(Ze(E(),t,e))/(Se(t)*Se(e));o=Rh(c)}const l=Math.cos(we(L_.normalize(Lt(n)),0,r2e));o=-o-Math.max(0,Se(e)-s)/(l*s)}else ye(nne,i.eye,i.center),Ze(r,yI,nne),o=-Se(yI)/s;return fe(r,r),re(r,r,Se(j5)),o}const nne=E();function one(t,e,r,i){let s,n;const o=Math.cos(we(L_.normalize(Lt(i)),0,r2e));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Bn(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Bn(t/r),(n-s)*r}function VJe(t,e,r,i,s,n,o,a,l,c){const u=one(t[2],e[2],n[3],a),h=l?one(t[0],e[0],n[3],180):e[0]-t[0],p=Math.sin(o)*h-Math.cos(o)*u,f=Math.cos(o)*h+Math.sin(o)*u;fe(fi,s);const g=l?p/Math.sqrt(Math.abs(n[3]**2-de(r,fi)**2)):p/n[3],_=f/Math.sqrt(Math.abs(n[3]**2-de(r,i)**2));cr(c,g,_)}function o2e(t,e,r,i,s,n,o,a,l,c){Ze(j5,t,e),SG(n.up,n.eye,fI,mI,gI),SG([0,0,1],n.eye,Wg,A_,u2e),ce(r,A_),ce(i,Wg),fe(r,r),re(r,r,Se(j5)),ere(t,fe(mI,mI),fe(gI,gI),fe(fI,fI),ane),ere(e,mI,gI,fI,lne),VJe(ane,lne,t,Wg,A_,o,a,l,c,s)}function GJe(t,e,r,i,s,n,o){Su(V5,s,i),Su(G5,o,n),ri(AT,V5,G5),ye(e,t,r),Ge(e,e,AT),pe(e,e,r)}function a2e(t,e,r,i,s,n){Su(V5,i,r),Su(G5,n,s),ri(AT,V5,G5),ye(fi,t.eye,e),Ge(fi,fi,AT),t.eye=pe(fi,fi,e),ye(fi,t.center,e),Ge(fi,fi,AT),t.center=pe(fi,fi,e),ye(fi,t.up,e),Ge(fi,fi,AT),t.up=pe(fi,fi,e)}function oJ(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-dI.Angle||Math.abs(i)<dI.Angle)&&(Math.abs(t[2])<r*dI.Pole||Math.abs(e)>r)&&n.aboveGround&&s<dI.Tilt}function l2e(t,e,r,i,s,n){if(n)tJ(r,i,cne),e1(e,t,cne);else{const o=n2e(r,i,une,e,t[3],s);e1(e,t,yO(une,o))}}function c2e(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,u;ce(B1,i),_I.copyFrom(e);for(let h=0;h<a&&So(r,B1)>l&&(c=So(r,B1),o2e(r,B1,A_,Wg,ZC,_I,t,s,n,o),a2e(_I,t,Wg,ZC[1],A_,ZC[0]),GJe(B1,B1,t,Wg,ZC[1],A_,ZC[0]),u=So(r,B1),u<c||h===0);h++)e.copyFrom(_I)}function jJe(t,e,r,i,s,n,o){oJ(r,de(e.up,r),t[3],-L_.normalize(Lt(s)),n,e)?c2e(t,e,r,i,-L_.normalize(Lt(s)),n,o):l2e(t,e,r,i,n,o)}function HJe(t,e,r,i,s,n){const{eye:o}=t;SG([0,0,1],o,Wg,A_,u2e);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-de(t.center,Wg)**2/Se(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,h=-Math.cos(n)*l+Math.sin(n)*a;switch(bc(i.pan.matrix,i.pan.matrix,u,Wg),i.pan.enabled=!0,s.mode){case"pan":bc(i.pan.matrix,i.pan.matrix,h,A_),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function qJe(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=Ze(ze.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(bc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(bc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function WJe(t,e,r,i,s,n,o,a,l){oJ(t.center,de(t.up,t.center),Se(t.center),-L_.normalize(Lt(n)),o,e)?HJe(e,r,i,a,l,-L_.normalize(Lt(s))):qJe(e,r,i,a,l)}const Wg=E(),A_=E(),u2e=E(),fI=E(),mI=E(),gI=E(),ane=E(),lne=E(),ZC=je(),cne=qk(),V5=xe(),G5=xe(),AT=xe(),B1=E(),fi=E(),yI=E(),_I=new Je,j5=E(),une=E(),aJ={origin:E(),direction:E()},hne={origin:E(),direction:E()},dne=.6,_9=4,YJe=60;let H5=class extends Ug{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new Je,this._tmpViewDir=E(),this._tmpRayDir={origin:E(),direction:E()},this._targetOnSphere=E(),this._tmpCenter=E(),this._beginCamera=new Je,this._constraintOptions=new Xh(Ui.ALL_EXCEPT_COLLISION,tr.ZOOM,null,this._beginCamera),this._sphere=Vs()}initialize(){this._intersector=zh(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?dx:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:CR}}_updateCamera(e,r,i,s,n){const o=Vr(this.view.spatialReference),a=Yk(e,s,o),l=Math.abs(this.view.camera.position.z);fe(bI,e.eye),re(bI,bI,-1),aC(e,s,this._tmpRayDir),fe(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=we(Math.min(Zxe,1/Math.abs(de(bI,this._tmpRayDir.direction)))*l,Jxe,Kxe);if(a===oo.Horizontal){let u=dne**r;this._sphere[3]=Se(i),ye(this._tmpViewDir,e.center,e.eye);const h=Math.min(Se(this._tmpViewDir),c);let p=h*u;if(u<=1&&p<_9&&(p=_9,u=p/h),Math.abs(h-p)<1e-6)return;const f=Se(e.center);if(this._sphere[3]!==f){const g=this._sphere[3]+u*(f-this._sphere[3]);e.center=re(vI,e.center,g/f)}re(this._tmpViewDir,this._tmpViewDir,-u),e.eye=pe(vI,e.center,this._tmpViewDir),Us(this.view,e,this._constraintOptions),So(i,e.center)>1e-12&&sJ(this._sphere,e,s,this._targetOnSphere)&&jJe(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=dne**Math.abs(r);const h=r>0?1:-1;ye(this._tmpViewDir,i,e.eye);const p=Se(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,YJe);let g=f??c;g=n&&r>0?Math.min(g,p):g,re(this._tmpRayDir.direction,this._tmpRayDir.direction,g),pe(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=g*u;const v=Math.max(_9,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,u=_/g),Math.abs(g-_)<1e-6)return;re(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-u)),e.eye=pe(vI,e.eye,this._tmpRayDir.direction),e.center=pe(vI,e.center,this._tmpRayDir.direction)}oC(this.view,e)}};H5=d([V("esri.views.3d.state.controllers.global.ZoomStepController")],H5);const vI=E(),bI=E();let yN,_N=null;const mS=new Map;async function zDt(t){_N==null&&(yN==null&&(yN=me(()=>import("./VoxelWasmPerSceneView-CrtGNv2G.js"),[])),_N=await yN);const e=t.view;let r=mS.get(e);return r||(r=new _N.default({view:e}),mS.set(e,r)),r.addVoxelLayer(t)}function vO(t){return mS.get(t)}function BDt(t){const e=t.view,r=mS.get(e);r&&r.removeVoxelLayer(t)<1&&(mS.delete(e),mS.size===0&&(yN=null,_N=null))}const XJe=.6,ZJe=4,JJe=60;let q5=class extends Ug{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new Je,this._tmpRayDir=E(),this._tmpCenter=E(),this._beginCamera=new Je,this._constraintOptions=new Xh(Ui.ALL,tr.ZOOM,null,this._beginCamera)}zoomStep(e,r){if(!this.active)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(i.camera);const s=zh(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?dx:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center);const o=XJe**e;let a=this.view._stage.renderView.getMinimalDepthForArea(vO(this.view),r[0],r[1],this.view.state.camera,JJe);ye(wI,this._tmpCamera.eye,this._zoomLocation),fe(wI,wI);const l=we(Math.min(Zxe,1/Math.abs(de(KJe,wI)))*Math.abs(this.view.camera.position.z),Jxe,Kxe);if(a=a??l,a){const c=E();ye(c,this._zoomLocation,this._tmpCamera.eye),(a<Se(c)||!n)&&(fe(c,c),pe(this._zoomLocation,this._tmpCamera.eye,re(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:CR}}_updateCamera(e,r,i){ye(this._tmpRayDir,i,e.eye);const s=Se(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(ZJe,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(re(this._tmpRayDir,this._tmpRayDir,r),e.eye=ye(pne,i,this._tmpRayDir),e.center=li(pne,e.center,i,1-r),Us(this.view,e,this._constraintOptions)))}};q5=d([V("esri.views.3d.state.controllers.local.ZoomStepController")],q5);const pne=E(),KJe=Pe(0,0,1),wI=E();function QJe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function lJ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let eKe=class extends Mo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(QJe(r,"primary")){const i=this._view.state.isGlobal?new H5({view:this._view,mode:"animation"}):new q5({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),us(r.x,r.y)),e.stopPropagation()}}};function tKe(t,e,r){return t===Ne.Global?new iKe(r):new rKe(e,r)}let rKe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Vr(r),this._unitInMeters=xa(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){var T;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new $r({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},h=Math.max(u.x,u.y,u.z);ye(V1,r,e),kx[0]=V1[0]>0?i.xmax:i.xmin,kx[1]=V1[1]>0?i.ymax:i.ymin,kx[2]=V1[2]>0?h/2:-h/2,ye(kx,kx,e),fe(V1,V1);const p=1.1*de(kx,V1)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=g*oKe*this._unitInMeters,v=g*aKe*this._unitInMeters,b=we((o-v)/(_-v),0,1)**3,w=Math.min(Pt(f,p,b),f)*Math.max(Math.log(Math.abs(l)),1);return h2e(Math.min(w,Math.max(34064e4,h))/this._unitInMeters,sKe,this._unitInMeters,n)}},iKe=class{constructor(e){this._referenceEllipsoid=Vr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Se(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),h=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return h2e(1.2*Pt(h,p,gZ(u)),we(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function h2e(t,e,r,i){const s=nKe/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const sKe=2e4,nKe=2,oKe=.001,aKe=1e-4,kx=E(),V1=E();let vN=class extends Me{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&V_e(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>oC(this.view,e,Th.EYE_AND_CENTER))}};d([m({constructOnly:!0})],vN.prototype,"view",void 0),vN=d([V("esri.views.3d.state.ElevationCollisionConstraint")],vN);let OA=class extends Me{constructor(e){super(e),this.nearFarHeuristic=tKe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([he(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(s=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),he(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),he(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ti),he(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(s=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),ti),he(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),ti),he(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),ti),he(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ti),he(()=>{var e,r,i,s,n,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),ti)]),this.view.state.isLocal&&this.addHandles(he(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),ui)),this._updateNearFar(),this.view.state.viewingMode!==Ne.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new vN({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,hk(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Ui.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ne.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Lt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(ga(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Ui.ALL){this.view.state.updateCamera(r=>Us(this.view,r,new Xh(e,tr.NONE,null)))}};d([m({constructOnly:!0})],OA.prototype,"view",void 0),d([m({readOnly:!0})],OA.prototype,"surfaceCollisionConstraint",void 0),OA=d([V("esri.views.3d.state.ConstraintsManager")],OA);let t_=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=dO(),this._points=$we(),this.lines=new Array(12),this._origin=E(),this._direction=E(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:E(),endpoint:null}}update(e){Iwe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ce(this._origin,e.eye),ce(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)ce(this._points[r],e[r]);Lwe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return y_(this.frustum,e)}intersectsRay(e){return KWe(this.frustum,e)}intersectsLineSegment(e,r){return QWe(this.frustum,e,r)}intersectsPoint(e){return Dwe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;v9(this.lines[r],e[r],e[i]),v9(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),v9(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function v9(t,e,r){t.origin=e,t.endpoint=r,m0(t.direction,e,r)}t_.planePointIndices=eYe,t_.nearFarLineIndices=[[st.NEAR_BOTTOM_LEFT,st.FAR_BOTTOM_LEFT],[st.NEAR_BOTTOM_RIGHT,st.FAR_BOTTOM_RIGHT],[st.NEAR_TOP_RIGHT,st.FAR_TOP_RIGHT],[st.NEAR_TOP_LEFT,st.FAR_TOP_LEFT]];let KP=class extends Og{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Qi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||V_e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),oC(this.view,e,Th.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Qi.Stopped)})}};d([m({constructOnly:!0})],KP.prototype,"desiredCamera",null),KP=d([V("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],KP);const lKe=.66;function d2e(t){return 360-hY.normalize(t)}function Xk(t){return hY.normalize(360-t)}function cKe(t,e,r){const i=e.camera;if(i!=null)return hKe(i,_0(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=p2e(t,e.rotation,r);if(s.type==="point")return pKe(t,e,s,n,o);const a=s.extent;return a==null?null:$D(t,a,n.heading,n.tilt,o)}async function uKe(t,e,r,i){const s=e.camera;if(s!=null)return dKe(s,_0(t),i);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=p2e(t,e.rotation,r);if(n.type==="point")return fKe(t,e,n,o,a,i);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return m1e(t,l,o.heading,o.tilt,a,i)}function hKe(t,e){const r=t.position;let i;try{i=z_(r,e)}catch{return null}if(!i)return null;const s=t.clone();return s.position=i.clone(),s}async function dKe(t,e,r){const i=t.position,s=await B_(i,e,{signal:r});vt(r);const n=t.clone();return n.position=s.clone(),n}function p2e(t,e,r){const i=sE(t,t.state.camera);let s=jo.ADJUST;return e!=null&&(i.heading=d2e(e),s=jo.LOCKED),r!=null&&(i.tilt=r),{camera:i,mode:s}}function pKe(t,e,r,i,s){const n=t.spatialReference;let o;try{o=z_(r.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?dk(t,e.scale,o.latitude):t.state.camera.distance;return YBe(t,o,a,i,s)}async function fKe(t,e,r,i,s,n){const o=t.spatialReference,a=await B_(r.clone(),o,{signal:n});vt(n);const l=e.scale!=null?dk(t,e.scale,a.latitude):t.state.camera.distance;return s1e(t,a,l,i,s,n)}function mKe(t,e,r=null){return r==null&&(r=new wp),hJ(t,null,e.clone(),r)}async function gKe(t,e,r){const i=CKe(t,e);if(!i)throw new J("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new xu({fov:t.camera.fov}),n=new wp({camera:s});if(i.target instanceof wp)return G1(await vKe(t,i.target,i,r,n));if(i.target instanceof xu)return G1(await m2e(t,i.target,r,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof $r){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return G1(o||c?await Y5(t,i,i.target.center,s,r,n):await TKe(t,i,i.target,s,r,n))}const a={boundingBox:Ri(),hasZ:!1,screenSpaceObjects:[]},l=o?yKe(t,i):void 0;if(await f2e(t,i.target,l,a,r),isFinite(a.boundingBox[0])){let c;if(ip(a.boundingBox,Ms),eu.x=Ms[0],eu.y=Ms[1],eu.z=Ms[2],eu.spatialReference=t.spatialReference,isFinite(eu.z)&&a.hasZ?c=sZ(a.boundingBox):(eu.z=void 0,c=w4e(iZ(a.boundingBox,PKe))),o||c)return G1(await Y5(t,i,eu,s,r,n));const u=AKe(t,a.screenSpaceObjects);return G1(await EKe(t,i,eu,a.boundingBox,u,s,r,n))}return i.position?G1(await wKe(t,i,s,n,r)):G1(await xKe(t,i,s,r,n))}function cJ(t,e){return e.scale==null&&e.zoom!=null?b1e(t,e.zoom):e.scale}function yKe(t,e){const r=cJ(t,e);return r?wUe(r):void 0}function uJ(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=d2e(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function hJ(t,e,r,i){const s=t.spatialReference||Xe.WGS84;if((e=e??Tg(t,r))==null)return i;const n=new Ke({spatialReference:s});return _m(e.center,t.renderSpatialReference,n)&&(i.targetGeometry=n,i.scale=w1e(t,e),i.rotation=Xk(r.heading),i.camera=r),i}async function W5(t,e,r,i){var h;const s=()=>new J("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=e.spatialReference,o=t.spatialReference,a=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let p;switch(e.type){case"point":p=e;break;case"multipoint":case"polyline":p=(h=e.extent)==null?void 0:h.center;break;case"extent":p=e.center;break;case"polygon":p=e.centroid}p!=null&&a!=null&&t.elevationProvider!=null?(p=await B_(p,a,{signal:i}),Ms[2]=Wf(t.elevationProvider,p)??0):Ms[2]=0}const l=MKe[e.type],c=new Array;if(l(e,e.hasZ?p=>{c.push([p[0],p[1],p[2]])}:p=>{c.push([p[0],p[1]])},Ms),c.length===0)throw s();const u=await B_(new VE({spatialReference:n,hasZ:e.hasZ,hasM:!1,points:c}),o,{signal:i});if(e.hasZ&&(r.hasZ=!0),e.hasZ)for(const[p,f,g]of u.points)Ms[0]=p,Ms[1]=f,Ms[2]=g,Ep(r.boundingBox,Ms);else for(const[p,f]of u.points)Ms[0]=p,Ms[1]=f,Ep(r.boundingBox,Ms)}async function _Ke(t,e,r,i,s){const n=await xp(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await W5(t,e.geometry,i,s);const o=n.value,a=await xp(o.whenGraphicBounds(e,{minDemResolution:r}));if(a.ok===!1||!a.value)return void await W5(t,e.geometry,i,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;aE(i.boundingBox,c),l&&l.forEach(u=>{i.screenSpaceObjects.push(u)}),isFinite(c[2])&&(i.hasZ=!0)}async function f2e(t,e,r,i,s){var n;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return eu.x=o,eu.y=a,eu.z=void 0,eu.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:Xe.WGS84,void await W5(t,eu,i,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>f2e(t,o,r,i,s))):e instanceof d1?await W5(t,e,i,s):e instanceof W_&&await _Ke(t,e,r,i,s)}async function vKe(t,e,r,i,s){if(e.camera!=null)return m2e(t,e.camera,i,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=Xk(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=cJ(t,r);return n!=null&&(s.scale=n),s.camera=await uKe(t,s,r.tilt,i),s}async function m2e(t,e,r,i){const s=t.spatialReference,n=await B_(e.position,s,{signal:r});return(e=e.clone()).fov=t.camera.fov,e.position=n,hJ(t,null,e,i)}async function bKe(t,e,r,i,s,n,o){const a=t.renderSpatialReference;return await Q4(e,b9,a,0,{signal:o}),await Q4(r,TI,a,0,{signal:o}),n.targetGeometry=new Ke(e),s.position=new Ke(r),ye(X5,b9,TI),pk(t,TI,X5,i.up,s),n.scale=Lw(t,$i(TI,b9),n.targetGeometry.latitude),n.rotation=Xk(s.heading),n.camera=s,n}async function Y5(t,e,r,i,s,n){if(r==null)throw new J("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=sx(t);if(e.position)return bKe(t,n.targetGeometry,e.position,o,i,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=re(Ms,o.viewForward,-l);o.eye=pe(Ms,o.center,c),n.scale=Lw(t,l,r.latitude)}sE(t,o,i);const a=uJ(i,e)?jo.LOCKED:jo.ADJUST;if(!e.zoomFactor){const l=cJ(t,e);if(l==null){const{renderSpatialReference:c}=t;await Q4(r,Ms,c,0,{signal:s}),Dwe(o.frustum,Ms)?n.scale=Lw(t,$i(o.eye,Ms),r.latitude):n.scale=w1e(t,o)}else n.scale=l;n.camera=await i1e(t,n.targetGeometry,n.scale,i,a,s)}return n}async function wKe(t,e,r,i,s){const n=sx(t);ce(X5,n.viewForward),pk(t,n.eye,X5,n.up,w9);const o=t.spatialReference,{position:a}=e;if(a){const l=await B_(a,o,{signal:s});r.position=l}else r.position=new Ke;return r.heading=e.heading!=null?e.heading:w9.heading,r.tilt=e.tilt!=null?e.tilt:w9.tilt,hJ(t,null,r,i)}async function xKe(t,e,r,i,s){const n=sx(t),{spatialReference:o,renderSpatialReference:a}=t,l=new Ke({spatialReference:o});return _m(n.center,a,l)?Y5(t,e,l,r,i,s):Y5(t,e,null,r,i,s)}async function TKe(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=sx(t);sE(t,o,i);const a=uJ(i,e)?jo.LOCKED:jo.ADJUST;return n.camera=await m1e(t,r,i.heading,i.tilt,a,s),n}function SKe(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=Wf(t.elevationProvider,r)),te(Ms,r.x,r.y,n),$l(t.spatialReference,Ms,fne,t.renderSpatialReference),kh(xI,fne),Uh(xI,xI),Ri(JC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let v=i[_[2]];isFinite(v)||(v=n),te(Ms,i[_[0]],i[_[1]],v),ya(Ms,t.spatialReference,Ms,t.renderSpatialReference),Ep(JC,Bo(Ms,Ms,xI))}const a=nx(JC),l=y1(JC),c=ox(JC),u=1/Math.tan(e.fovX/2),h=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,f=.5*l*h+.5*Math.max(a,c);return Math.max(p,f)/s}async function EKe(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=sx(t),c=SKe(t,l,r,i,s);sE(t,l,n);const u=uJ(n,e)?jo.LOCKED:jo.ADJUST;return a.scale=Lw(t,c,a.targetGeometry.latitude),a.camera=await i1e(t,a.targetGeometry,a.scale,n,u,o),a}function CKe(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function G1(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=Xk(t.camera.heading)),t}function AKe(t,e){const r=lKe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const Ms=E(),fne=xe(),xI=xi(),JC=Mn(),PKe=jt(),X5=E(),TI=E(),b9=E(),w9={heading:0,tilt:0},eu=new Ke,MKe={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(te(r,t.xmin,t.ymin,t.zmin)),e(te(r,t.xmax,t.ymin,t.zmin)),e(te(r,t.xmin,t.ymax,t.zmin)),e(te(r,t.xmax,t.ymax,t.zmin)),e(te(r,t.xmin,t.ymin,t.zmax)),e(te(r,t.xmax,t.ymin,t.zmax)),e(te(r,t.xmin,t.ymax,t.zmax)),e(te(r,t.xmax,t.ymax,t.zmax))):(e(te(r,t.xmin,t.ymin,r[2])),e(te(r,t.xmax,t.ymin,r[2])),e(te(r,t.xmin,t.ymax,r[2])),e(te(r,t.xmax,t.ymax,r[2])))}};let OKe=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&lo(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(hr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await GS(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await gKe(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){var n;const r=!!(this.target instanceof wp&&this.target.camera||this.target instanceof xu),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new J("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=Tg(this.view,i);return s==null?(this.reject(new J("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new J("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new KP({view:this.view,desiredCamera:e.camera}),oC(this.view,e.camera,Th.EYE_AND_CENTER)):Us(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Ug&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state===Qi.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Qi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Qi.Ready:case Qi.Rejected:case Qi.Running:case Qi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Ug&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Ug({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new J("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},t1=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var xn;function x9(t=!se("disable-feature:high-quality-idle"),e=null){const r=new t1;return t?(r.set(Br.IDLE,xn.Antialiasing,e!=="low"),r.set(Br.IDLE,xn.HighResolutionAtmosphere,e!=="low"),r.set(Br.IDLE,xn.HighQualityTransparency,!0),r.set(Br.IDLE,xn.SSAO,!0),r.set(Br.IDLE,xn.WaterReflection,!0),r.set(Br.IDLE,xn.PhysicalPixelRendering,!0)):(r.set(Br.ANIMATING,xn.HighResolutionShadows,!0),r.set(Br.INTERACTING,xn.HighResolutionShadows,!0)),r.set(Br.IDLE,xn.HighResolutionShadows,!0),r.set(Br.IDLE,xn.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(xn||(xn={}));let Hs=class extends Me{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=mne,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(r){this.viewStateManager._idleTimeout=r?mne:0}},this._propertiesPool=new l0({frustum:t_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new RKe}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ho(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),he(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),ti)]),Ih(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([yw({prepare:()=>this._prepareFrame()}),he(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(EI)}),Ho(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ae(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const r=sE(this.view,this.view.state.camera,T9);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableCache(!0),this.setStateCamera(Tg(this.view,e),{applyConstraints:!1})||ae.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=sE(this.view,this.view.state.contentCamera,T9);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=Tg(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(S9),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=la(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([he(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(S9),this.test.contentCameraResetState.clear())}),he(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),he(()=>this.view.state.camera,o=>{const a=So(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],S9),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ae.getLogger(this).error("#center=","Invalid center",e):ae.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):ae.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=g1e(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ae.getLogger(this).error("#extent=","Invalid extent",e):ae.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):ae.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var r;const e=this.view.map;return e&&"initialViewProperties"in e?(r=e.initialViewProperties)==null?void 0:r.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Lw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ae.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[Kt.TOP]/i),o=Math.round(r[Kt.RIGHT]/i),a=Math.round(r[Kt.BOTTOM]/i),l=Math.round(r[Kt.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,SI),this.view.state.updateCamera(r=>r.padding=SI))}_paddingToArray(e,r,i){e?es(i,e.top||0,e.right||0,e.bottom||0,e.left||0):es(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return Lh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?mKe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ae.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,s=i!=null&&i.spatialReference;ae.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else ae.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?rVe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ae.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var s;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=(s=this.view._stage.renderView.renderingContext)==null?void 0:s.parameters.maxTextureSize;return i&&kb(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(xn.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(xn.PhysicalPixelRendering,Br.IDLE)||e.isFeatureEnabled(xn.PhysicalPixelRendering,Br.INTERACTING)||e.isFeatureEnabled(xn.PhysicalPixelRendering,Br.ANIMATING))}preinit(e){var r,i,s;return!(this._isOverridden("center")&&!O2(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!O2(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!O2(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||O2((r=this.viewpoint.targetGeometry)==null?void 0:r.spatialReference,e)&&O2((s=(i=this.viewpoint.camera)==null?void 0:i.position)==null?void 0:s.spatialReference,e))}init(){this._constraintsManager=new OA({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this._initialViewpoint||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Ne.Local&&this.addHandles(Ih(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(EI),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),EI)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(EI),this._constraintsManager=Ae(this._constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new OKe(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(sx(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of IKe){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof xu)return void this.setStateCamera(Tg(this.view,e),{applyConstraints:!1});if(e instanceof wp){if(e.targetGeometry instanceof $r){const n=$D(this.view,e.targetGeometry,0,.5,jo.LOCKED);return void(n!=null&&this.setStateCamera(Tg(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=$D(this.view,e,0,.5,jo.LOCKED);r!=null&&this.setStateCamera(Tg(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&$Ke.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof wp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof xu?this.isCompatible(e.position):e.spatialReference&&!V0e(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=LKe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=Q0){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=DX(this.view,s,n,e,r,jo.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=$D(this.view,e,r,i,jo.ADJUST,T9);return s?Tg(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude,n=dk(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(b1e(this.view,e))}_viewpointToCamera(e){return Tg(this.view,cKe(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Us(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new KP({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(Q0.copyFrom(s),Q0.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,SI),Q0.padding=SI),Q0.fullWidth=i.width,Q0.fullHeight=i.height,Q0.pixelRatio=i.pixelRatio,this.view.state.camera=Q0),this._updateViewState()}}_updateElevation(e){var n,o;const r=(n=this.view.basemapTerrain)==null?void 0:n.spatialReference,i=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,s=r?hk(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Br.ANIMATING:this.view.interacting?this.view.state.mode=Br.INTERACTING:(this.view.state.mode===Br.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Br.INTERACTING:this.view.state.mode=Br.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([m({type:xu,dependsOn:["view.state.camera","ready"]})],Hs.prototype,"camera",null),d([m({type:xu,dependsOn:["view.state.contentCamera","ready"]})],Hs.prototype,"contentCamera",null),d([m({type:Ke})],Hs.prototype,"center",null),d([m({type:$r})],Hs.prototype,"extent",null),d([m({readOnly:!0})],Hs.prototype,"frustum",null),d([m()],Hs.prototype,"_constraintsManager",void 0),d([m({readOnly:!0})],Hs.prototype,"constraintsManager",null),d([m()],Hs.prototype,"_initialViewpoint",null),d([m({readOnly:!0})],Hs.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],Hs.prototype,"ready",void 0),d([m({type:Number})],Hs.prototype,"scale",null),d([m()],Hs.prototype,"padding",null),d([m({readOnly:!0})],Hs.prototype,"screenCenter",null),d([m({constructOnly:!0})],Hs.prototype,"view",void 0),d([m({type:wp})],Hs.prototype,"viewpoint",null),d([m({type:Number})],Hs.prototype,"zoom",null),d([m({readOnly:!0})],Hs.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],Hs.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],Hs.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],Hs.prototype,"_windowDevicePixelRatio",void 0),d([m()],Hs.prototype,"_devicePixelRatioOverride",void 0),Hs=d([V("esri.views.3d.state.ViewStateManager")],Hs);let RKe=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const $Ke=new Set(["camera","viewpoint","extent","scale","center","zoom"]),IKe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],LKe={heading:0,tilt:0},T9=new xu,Q0=new Je,SI=Yt(),EI="pending-initial-view",S9="content-camera-reset",mne=300,gne=100;let Xf=class extends Og{constructor(){super(...arguments),this.startCamera=new Je,this.currentCamera=new Je,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<gne}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Qi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),gne),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([m({readOnly:!0})],Xf.prototype,"isInteractive",null),d([m()],Xf.prototype,"_lastInteraction",void 0),Xf=d([V("esri.views.3d.state.controllers.InteractiveController")],Xf);var ac;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(ac||(ac={}));let QP=class extends Xf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=ac.CENTER,this._rotScale=0,this._lastPoint=je(),this._tmpWorldUp=E(),this._tmpViewDir=E(),this._tmpRotCurPoint=je(),this._tmpTransf=xe(),this._tmpAxis=E(),this._tmpPivotPoint=E(),this._pivotPos=E(),this._constraintOptions=new Xh(Ui.ALL,tr.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===ac.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case ac.EYE:ce(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=tr.LOOK_AROUND,this._constraintOptions.tiltMode=Tm.LOOK_AROUND,this._constraintOptions.selection=Ui.NONE;break;case ac.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?dx:{});r||ce(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=tr.TUMBLE,this._constraintOptions.tiltMode=Tm.TUMBLE,this._constraintOptions.selection=Ui.ALL&~Ui.DISTANCE;break}}ow(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=E();ye(s,this._pivotPos,i.eye);const n=Se(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,yne);let a=Math.max(Math.min(UJe,1/Math.abs(de(yne,i.viewForward)))*o,zJe);r&&(a=Math.min(n,a));const l=Vr(this.view.spatialReference),c=us(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=Yk(this.startCamera,c,l);let h=this.view._stage.renderView.getMinimalDepthForArea(vO(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*m9,m9),p=this.view._stage.renderView.getMinimalDepthForArea(vO(this.view),e[0],e[1],i,m9);h==null&&p==null||(h=h??p??0,p=p==null||u===oo.Horizontal?h:p,a=h>p?p:h,a=r?Math.min(a,n):a),fe(s,s),ce(this._pivotPos,pe(this._tmpPivotPoint,i.eye,re(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case ac.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case ac.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Us(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),ow(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ye(this._tmpViewDir,i,s);const a=Se(this._tmpViewDir),l=Bn(de(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===ac.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=we(n+l,No.min,No.max)-l,Ze(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===ac.CENTER&&(o=-o),Su(this._tmpTransf,o,this._tmpWorldUp),bc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Ge(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ge(E9,e.up,this._tmpTransf),pe(E9,s,this._tmpViewDir),Vn(this._lastPoint,this._tmpRotCurPoint),E9}};d([m()],QP.prototype,"pivot",void 0),QP=d([V("esri.views.3d.state.controllers.RotateController")],QP);const E9=E(),yne=E();let C9=class extends Mo{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!lJ(e.data,this.pointerAction))return;const i=us(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new QP({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},HH=class extends Xf{constructor(){super(...arguments),this._pickPoint=E(),this._tmpP0=je(),this._panAxisAngle=qk(),this._tmpRayDir=E(),this._tmpRayDirPick=E(),this._targetOnSphere=E(),this._navMode=oo.Horizontal,this._tmpRay={origin:E(),direction:E()},this.dragBeginPoint=us(),this._normalizedAnchorPoint=je(),this._constraintOptions=new Xh(Ui.ALL_EXCEPT_COLLISION,tr.ZOOM,0,this.startCamera),this._sphere=Vs(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Vn(this.dragBeginPoint,e),ow(this.startCamera,e,this._normalizedAnchorPoint);const r=Vr(this.view.spatialReference),i=i2e(this._intersectionHelper,this.startCamera,e,r,fE.Ellipsoid,this.view.map.ground.opacity===0?dx:{});if(this._navMode=Yk(this.startCamera,e,r),this._navMode===oo.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;aC(this.startCamera,e,this._tmpRay),fe(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ye(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Se(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,_ne);let o=we(Math.min(Xxe,1/Math.abs(de(_ne,this._tmpRay.direction)))*n,B5[0],B5[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Wk);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,re(this._tmpRay.direction,this._tmpRay.direction,o),pe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===oo.Horizontal){ye(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Se(this._tmpRayDir);ow(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Se(this.currentCamera.center));this.currentCamera.center=re(CI,this.currentCamera.center,o)}re(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=pe(CI,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Hd(Y_(this.dragBeginPoint,e)),Us(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(_O(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),tJ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),e1(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Se(this._tmpRay.direction);ow(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;re(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=pe(CI,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=pe(CI,this.currentCamera.center,this._tmpRayDir)}oC(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};HH=d([V("esri.views.3d.state.controllers.global.ZoomController")],HH);const CI=E(),_ne=E();let qH=class extends Xf{constructor(){super(...arguments),this._tmpP=E(),this._tmpDir=E(),this._tmpN=E(),this._tmpP0=je(),this._tmpPoi=E(),this._tmpRayDir=E(),this.dragBeginPoint=us(),this._normalizedAnchorPoint=je(),this._constraintOptions=new Xh(Ui.ALL,tr.ZOOM,0,this.startCamera,E()),this._plane=zr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Vn(this.dragBeginPoint,e),ow(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?dx:{});ye(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Se(this._tmpDir);fe(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=we(Math.min(Xxe,1/Math.abs(de(DKe,this._tmpDir)))*s,B5[0],B5[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(vO(this.view),e[0],e[1],this.view.state.camera,Wk);n=o??n,n=r?Math.min(n,i):n,re(this._tmpDir,this._tmpDir,n),pe(this._tmpP,this.startCamera.eye,this._tmpDir),ye(this._tmpN,this.startCamera.eye,this.startCamera.center),fe(this._tmpN,this._tmpN),this._tmpN[1]<0&&Eo(this._tmpN,this._tmpN),hR(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;BJe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ce(this._tmpPoi,this.currentCamera.center),ow(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Vn(this._normalizedAnchorPoint,this._tmpP0),ye(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Se(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(ce(this._constraintOptions.interactionDirection,this._tmpRayDir),re(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(re(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=pe(j1,this.currentCamera.eye,this._tmpRayDir),li(j1,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?j1[2]=Math.max(this.startCamera.center[2],j1[2]):j1[2]=Math.min(this.startCamera.center[2],j1[2]),this.currentCamera.center=j1,this._constraintOptions.interactionFactor=Hd(Y_(this.dragBeginPoint,e)),Us(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};qH=d([V("esri.views.3d.state.controllers.local.ZoomController")],qH);const j1=E(),DKe=Pe(0,0,1);let NKe=class extends Mo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!lJ(e.data,this.pointerAction))return;const i=us(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new HH({view:this._view}):this._cameraController=new qH({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function nd(t){let e=t*t;return t<0&&(e*=-1),e}function vne(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=nd(s.axes[0]),i.translation[1]=nd(s.axes[1]),i.translation[2]=nd(s.buttons[7])-nd(s.buttons[6]),i.heading=nd(s.axes[2]),i.tilt=nd(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*nd(s.axes[0]),i.translation[1]=1.2*nd(s.axes[1]),i.translation[2]=2*-nd(s.axes[2]),i.heading=1.2*nd(s.axes[5]),i.tilt=1.2*nd(s.axes[3])),i.tilt*=o,re(i.translation,i.translation,a),i}function bne(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function A9(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Ub=class extends Xf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Je,this._headingStart=0,this._constraintOptions=new Xh(Ui.ALL,tr.NONE,0,new Je,null,Tm.LOOK_AROUND)}handleEventGamepad(e){const r=vne(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||A9(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,bne(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=bne(this._keysButtonState,this._transformation);A9(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,H1),this._applyDisabledMovementTypes(H1),this._applyPan(H1.pan),this._applyRotate(H1.rotate),this._applyZoom(H1.zoom),this._applyAscend(H1.ascend),this._constraintOptions.interactionType=tr.NONE,this._constraintOptions.selection=Ui.COLLISION,Us(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;ye(rl,r.center,r.eye),Ge(rl,rl,e.matrix),r.center=pe(rl,rl,r.eye),r.up=Ge(rl,r.up,e.matrix),this._constraintOptions.interactionType=tr.LOOK_AROUND,this._constraintOptions.selection=Ui.ALL_EXCEPT_COLLISION,Us(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=Ge(rl,r.eye,e.matrix),r.center=Ge(rl,r.center,e.matrix),this.view.state.isGlobal&&(r.up=Ge(rl,r.up,e.matrix)),this._constraintOptions.interactionType=tr.PAN,this._constraintOptions.selection=Ui.ALL,Us(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=pe(rl,this.currentCamera.eye,re(ze.get(),r,e)),ce(KC,r),Eo(KC,KC),this._constraintOptions.interactionDirection=KC,this._constraintOptions.interactionType=tr.ZOOM,this._constraintOptions.selection=Ui.ALL_EXCEPT_COLLISION,Us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,ze.get());if(this._constraintOptions.interactionDirection=ce(KC,r),this.view.state.isGlobal){const i=Se(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=re(rl,this.currentCamera.eye,s),this.currentCamera.center=re(rl,this.currentCamera.center,s)}else{const i=re(ze.get(),r,e);this.currentCamera.eye=pe(rl,this.currentCamera.eye,i),this.currentCamera.center=pe(rl,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=tr.ASCEND,this._constraintOptions.selection=Ui.COLLISION,Us(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ui.ALL_EXCEPT_COLLISION,Us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){GKe(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,rl)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=te(ze.get(),n[0],n[1],0);fe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=re(ze.get(),s,c);Fl(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=re(ze.get(),l,_);Fl(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(bc(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,ze.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,f=Q_(this.view.renderCoordsHelper,r.center,r.eye),g=we(f+p,No.min,No.max)-f;g&&(bc(i.rotate.matrix,i.rotate.matrix,g,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Ze(ze.get(),n,s);fe(l,l),Eo(l,l),WJe(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(H1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(bc(i.rotate.matrix,i.rotate.matrix,h,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);f!==0&&(bc(i.rotate.matrix,i.rotate.matrix,f,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Vr(this.view.spatialReference),n=gN(No.min,r.origin,i,s);let o=0,a=0;const l=ze.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=Q_(this.view.renderCoordsHelper,l,r.origin);o=gN(c,r.origin,i,s),a=gN(No.max,r.origin,i,s)}else{ZE(ek(tk,i+s.radius),r,l);const c=Math.PI+X6(r.direction,l);o=rne(c,r.origin,i,s),a=rne(No.max,r.origin,i,s)}return we(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=WBe(this.view,r,0,g2e,VKe),o=i.intersectManifoldClosestSilhouette(Eu(r,n),e,ze.get()),a=$i(r,o),l=i.intersectManifoldClosestSilhouette(Eu(r,m0(ze.get(),r,s.center)),e,ze.get()),c=$i(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,ze.get());if(n){const a=ye(ze.get(),e,o),l=Se(a);re(a,a,1/l);const c=fe(ze.get(),e),u=Bn(de(c,a));return l*Math.sin(Math.min(kKe,u))}{const a=ce(ze.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),$i(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:UKe}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Vr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=ze.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,u=wne*s.width,h=wne*s.width,p=l*Math.tan(.5*s.fovX)/c,f=p/i,g=p/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?f:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:we(g*h,zKe,BKe)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Nh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Nh(e.rotate.matrix))}static activatesFor(e,r){const i=vne(r,e.navigation.gamepad,FKe);return!(r.action==="end"||A9(i))}};d([m({constructOnly:!0})],Ub.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],Ub.prototype,"disableMovements",void 0),Ub=d([V("esri.views.3d.state.controllers.GamepadKeyboardController")],Ub);const FKe={translation:[0,0,0],heading:0,tilt:0,zoom:0},g2e=80,kKe=Lt(g2e),wne=.75,UKe=5,zKe=Lt(30),BKe=Lt(80),H1={zoom:0,ascend:0,pan:{enabled:!1,matrix:xe()},rotate:{enabled:!1,matrix:xe()}},rl=E(),KC=E(),VKe=IX();function GKe(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Nh(t.pan.matrix),t.rotate.enabled=!1,Nh(t.rotate.matrix)}let jKe=class extends Mo{constructor(e){super(!0),this._view=e,this._watchHandles=new c1,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([he(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},ui),he(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||Ub.activatesFor(this._view,e.data)){if(!i){const s=new Ub({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function HKe(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var Jl;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Jl||(Jl={}));let qKe=class extends Mo{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ne.Local},this._keyToNumber={[r.left]:Jl.LEFT,[r.right]:Jl.RIGHT,[r.forward]:Jl.FORWARD,[r.backward]:Jl.BACKWARD,[r.up]:Jl.UP,[r.down]:Jl.DOWN,[r.headingLeft]:Jl.HEADINGLEFT,[r.headingRight]:Jl.HEADINGRIGHT,[r.tiltUp]:Jl.TILTUP,[r.tiltDown]:Jl.TILTDOWN,[r.zoomIn]:Jl.ZOOMIN,[r.zoomOut]:Jl.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=HKe(i=>i?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Ub({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},WKe=class extends Mo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new H5({view:this._view,mode:"interaction"}):new q5({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,us(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},Z5=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Vw=class extends gO{constructor(){super(...arguments),this._beginCamera=new Je,this._elapsedTimeSec=0,this.constraintOptions=new Xh(Ui.ALL,tr.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new lE}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Us(this.view,r,this.constraintOptions)}};Vw=d([V("esri.views.3d.state.controllers.momentum.MomentumController")],Vw);let eM=class extends Vw{constructor(e){super(e),this.interactionType=tr.PAN,this._tmpPan=E()}momentumStep(e,r){const i=this.momentum.value(e);re(this._tmpPan,this.momentum.direction,i),r.eye=ye(xne,r.eye,this._tmpPan),r.center=ye(xne,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],eM.prototype,"momentum",void 0),eM=d([V("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],eM);const xne=E(),YKe=E(),AI=E();let bN=class extends Vw{constructor(e){super(e),this.interactionType=tr.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);ce(AI,r.eye),fe(AI,AI),Ze(this.momentum.axis2,AI,this.momentum.axis1),a2e(r,YKe,this.momentum.axis1,i,this.momentum.axis2,s)}};d([m({constructOnly:!0})],bN.prototype,"momentum",void 0),bN=d([V("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],bN);let _b=class extends Vw{set center(e){this._set("center",qi(e))}set axis(e){this._set("axis",qi(e))}constructor(e){super(e),this.interactionType=tr.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);e1(r,this.center,yO(this.axis,i))}};d([m({constructOnly:!0})],_b.prototype,"momentum",void 0),d([m({constructOnly:!0})],_b.prototype,"center",null),d([m({constructOnly:!0})],_b.prototype,"axis",null),_b=d([V("esri.views.3d.state.controllers.momentum.MomentumController")],_b);let PT=class extends Vw{set zoomCenter(e){this._set("zoomCenter",qi(e))}constructor(e){super(e),this.interactionType=tr.ZOOM,this.constraintOptions.interactionDirection=E()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;ce(i,r.eye);const s=this.momentum.valueDelta(0,e);nJ(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),m0(i,r.eye,i)}};d([m({constructOnly:!0})],PT.prototype,"momentum",void 0),d([m({constructOnly:!0})],PT.prototype,"zoomCenter",null),PT=d([V("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],PT);let Xv=class extends Vw{set screenCenter(e){this._set("screenCenter",us(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",qi(e))}constructor(e){super(e),this.interactionType=tr.ZOOM,this.radius=0,this._tmpSceneCenter=E(),this._tmpZoomAxisAngle=qk(),this._sphere=Vs()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);t2e(this._sphere,r,i),this.constraintOptions.interactionType=tr.ZOOM,Us(this.view,r,this.constraintOptions),_O(this._sphere,r,this.screenCenter,this._tmpSceneCenter),tJ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),e1(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=tr.PAN}};d([m({constructOnly:!0})],Xv.prototype,"momentum",void 0),d([m({constructOnly:!0})],Xv.prototype,"screenCenter",null),d([m({constructOnly:!0})],Xv.prototype,"sceneCenter",null),d([m({constructOnly:!0})],Xv.prototype,"radius",void 0),Xv=d([V("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Xv);let qd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Zk=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},XKe=class extends Zk{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},y2e=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new qd(.6),this._screen=[new qd(.4),new qd(.4)],this._scene=[new qd(.6),new qd(.6),new qd(.6)],this._tmpDirection=E()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){te(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Se(this._tmpDirection);s>0&&re(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new XKe(e,r,i,n==null?0:s/n,this._tmpDirection)}},Tne=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Sne=1e-5;let ZKe=class extends Zk{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},JKe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=E(),this._tmpAxis2=E(),this._tmpAngles=je(),this._time=new qd(.3),this._screen=[new qd(.4),new qd(.4)],this._angle1=new Tne(.6),this._angle2=new Tne(.6),this._axis1=E(),this._axis2=E(),this._lastScene=E()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=n2e(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),pa(this._tmpAxis2)<Sne?a=0:fe(this._axis1,this._tmpAxis2),this._angle1.update(a),ce(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;o2e(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),pa(this._tmpAxis2)<Sne?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),fe(this._axis1,this._tmpAxis1),fe(this._axis2,this._tmpAxis2)),ce(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new ZKe(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},_2e=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new qd(.8),this.time=new qd(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=we(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new Zk(e,r,i)}},v2e=class extends _2e{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},KKe=class extends Zk{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},b2e=class extends _2e{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new KKe(e,r,i)}},WH=class extends Xf{constructor(){super(...arguments),this._smoothRotation=new Z5(.05),this._rotationAxis=E(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=zr(),this._beginRadius=0,this._smoothScaling=new Z5(.05),this._zoomCenterScreen=us(),this._zoomMomentumEstimator=new b2e,this._rotationMomentumEstimator=new v2e,this._panSphericalMomentumEstimator=new JKe,this._panPlanarMomentumEstimator=new y2e,this._adjustedSphere=Vs(),this._tmp3d=E(),this._tmpScreenPointArray=us(),this._beginScreenPoint=us(),this._beginScenePoint=E(),this._screenPickPoint=us(),this._scenePickPoint=E(),this._mode=oo.Horizontal,this._sphere=Vs(),this._pointerCount=0,this._tmpInteractionDirection=E(),this._beginCamera=new Je,this._constraintOptions=new Xh(Ui.ALL,tr.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-L_.normalize(Lt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Jd(e.center,this._screenPickPoint),Vn(this._beginScreenPoint,this._screenPickPoint);const r=Vr(this.view.spatialReference),i=i2e(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,fE.Silhouette,this.view.map.ground.opacity===0?dx:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,ce(this._beginScenePoint,this._scenePickPoint),this._mode=Yk(this.startCamera,this._screenPickPoint,r),this._mode===oo.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===oo.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===oo.Horizontal?new Xv({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new PT({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new _b({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===oo.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new bN({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new eM({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=Eo(this._tmp3d,this.startCamera.viewForward);hR(this._scenePickPoint,i,this._panningPlane);const s=us(this._screenPickPoint[0],0),n=E(),o=Se(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],_O(this._adjustedSphere,this.startCamera,s,n);const a=Go();this.startCamera.projectToRenderScreen(n,a);const l=E(),c=E(),u=E();ye(l,this._scenePickPoint,this.currentCamera.eye);const h=Se(l);fe(l,l);const p=Qxe*Math.max(Math.abs(this.view.camera.position.z),e2e),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,Wk);let g=f??p;g=r?Math.min(g,h):g,ce(u,pe(c,this.currentCamera.eye,re(c,l,g))),this._panningPlane[3]=-de(this._panningPlane,u),this.startCamera.center=pe(c,this.startCamera.eye,re(c,this.startCamera.viewForward,g));const _=Jd(e.center,this._tmpScreenPointArray);jH(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),t2e(this._sphere,this.currentCamera,this._smoothScaling.value),Jd(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=tr.ZOOM,this._constraintOptions.interactionFactor=Hd(e.radius-this._beginRadius),Us(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Jd(e.center,this._tmpScreenPointArray);_O(this._sphere,this.currentCamera,r,this._tmp3d),oJ(this._beginScenePoint,de(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(c2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(l2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=tr.PAN,this._constraintOptions.interactionFactor=Hd(Y_(this._screenPickPoint,r)),Us(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){fe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Eo(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+GH(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),e1(this.currentCamera,this._sphere,yO(this._rotationAxis,n)),this._constraintOptions.interactionType=tr.TUMBLE,this._constraintOptions.interactionFactor=Hd(e.radius*i),Us(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Jd(e.center,this._tmpScreenPointArray);jH(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(s2e(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=tr.PAN,this._constraintOptions.interactionFactor=Hd(Y_(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Us(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),nJ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=tr.ZOOM,this._constraintOptions.interactionFactor=Hd(e.radius-this._beginRadius),Us(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ce(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Eo(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=GH(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),e1(this.currentCamera,this._sphere,yO(this._rotationAxis,o)),this._constraintOptions.interactionType=tr.TUMBLE,this._constraintOptions.interactionFactor=Hd(e.radius*o),Us(this.view,this.currentCamera,this._constraintOptions)}};WH=d([V("esri.views.3d.state.controllers.global.PinchAndPanController")],WH);const Ene=Pe(0,0,1),QKe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let YH=class extends Xf{constructor(){super(...arguments),this._rotationValueSmooth=new Z5(.05),this._scalingValueSmooth=new Z5(.05),this._planeHorizontal=zr(),this._planeVertical=zr(),this._rotationMomentumEstimator=new v2e,this._panMomentumEstimator=new y2e(300,12,.9),this._zoomMomentumEstimator=new b2e,this._beginRadius=0,this._beginCenter=E(),this._beginAngle=0,this._tmpPoints=[],this._panMode=oo.Horizontal,this._beginCenterScreen=us(),this._tmpCentroid3d=E(),this._tmpCentroid2d=us(),this._tmp2d=us(),this._pointerCount=0,this._beginCamera=new Je,this._constraintOptions=new Xh(Ui.ALL,tr.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Jd(e.center,this._beginCenterScreen),Rye(Ene,0,this._planeHorizontal);const i=E(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?dx:{}),n=E();Eo(n,this.startCamera.viewForward);const o=E();ce(o,Ene);const a=de(n,o),l=Rh(a<0?-a:a);this._panMode=l>=QKe.ANGLE_THRESHOLD?oo.Horizontal:oo.Vertical;const c=Math.min(Qxe,1/Math.abs(de(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),e2e);vG(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||bG(this._planeHorizontal,this._planeHorizontal);const u=E(),h=E(),p=E();ye(u,i,this.currentCamera.eye);const f=Se(u);if(fe(u,u),this._panMode===oo.Vertical){re(o,o,a),ye(this._planeVertical,n,o),fe(this._planeVertical,this._planeVertical),vG(this._planeVertical,this._planeVertical,i);const g=this.view._stage.renderView.getMinimalDepthForArea(vO(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,Wk);let _=g??c;_=s?Math.min(_,f):_,ce(p,pe(h,this.currentCamera.eye,re(h,u,_))),this._planeVertical[3]=-de(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),g9(this._tmpPoints,this._beginCenter)}else{const g=s?f:c;ce(p,pe(h,this.currentCamera.eye,re(h,u,g))),this._planeHorizontal[3]=-de(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),g9(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===oo.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),nJ(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=tr.ZOOM,this._constraintOptions.interactionFactor=Hd(Math.abs(e.radius-this._beginRadius)),Us(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),g9(this._tmpPoints,this._tmpCentroid3d),Jd(e.center,this._tmpCentroid2d),s2e(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=tr.PAN,this._constraintOptions.interactionFactor=Hd(Y_(this._beginCenterScreen,this._tmpCentroid2d)),Us(this.view,this.currentCamera,this._constraintOptions),r){const n=s,o=this._rotationValueSmooth.value,a=o+GH(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;e1(this.currentCamera,n,yO(u,c)),this._constraintOptions.interactionType=tr.TUMBLE,this._constraintOptions.interactionFactor=Hd(Math.abs(e.radius*c)),Us(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new PT({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new _b({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new eM({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=E()),jH(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};YH=d([V("esri.views.3d.state.controllers.local.PinchAndPanController")],YH);let Cne=class extends Mo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!lJ(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new WH({view:this._view}):new YH({view:this._view})}},eQe=class extends Mo{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},w2e=class extends Mo{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},tQe=class extends w2e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},rQe=class extends w2e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},iQe=class extends Mo{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var s,n,o;const r=this._invert?-1:1,i=us(0,e.data.delta*r);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new QP({view:this._view,pivot:ac.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function Ane(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>oQe(r,t.axisThreshold))}:{buttons:[],axes:[]}}function sQe(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function nQe(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function oQe(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let aQe=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Ane(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new dZ(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=yw({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Ane(n),l=i||nQe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||sQe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const Pne=se("edge"),lQe=se("chrome"),cQe=se("ff"),uQe=se("safari"),Mne="esri-view-surface",Ux={touchNone:`${Mne}--touch-none`,touchPan:`${Mne}--touch-pan`};let x2e=class T2e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new aQe(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Ae(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(P9[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&P9[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(P9[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Ux.touchNone:Ux.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Ux.touchPan:Ux.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Ux.touchNone),this._element.classList.remove(Ux.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=lbe(this._element,e);return T2e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const{key:i}=r;i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:Pne&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Pne?i*=.7:lQe||uQe?i*=.6:cQe&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};x2e.test={disableSubpixelCoordinates:!1};const P9={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let hQe=class extends Mo{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const cu={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function XH(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function dQe(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function pQe(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Lh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[C,P]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(C*C+P*P)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let r=0,i=0;for(let T=0;T<t.length;T++)r+=t[T].x,i+=t[T].y;r/=t.length,i/=t.length;const s=t.map(T=>T.x-r),n=t.map(T=>T.y-i);let o=0,a=0,l=0,c=0,u=0,h=0,p=0;for(let T=0;T<s.length;T++){const S=s[T],C=n[T],P=S*S,R=C*C;o+=P,a+=R,l+=S*C,c+=P*S,u+=R*C,h+=S*R,p+=C*P}const f=.5*(c+h),g=.5*(u+p),_=o*a-l*l,v=(f*a-g*l)/_,b=(o*g-l*f)/_,w=Lh(v+r,b+i);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function tM(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let fQe=class extends Mo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:mQe(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=PI(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=wN(s,S2e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=PI(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=PI(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=wN(i,r)-e,i.lastAngle=wN(i,r)-e})}_emitEvent(e,r,i){const s=PI(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function S2e(t){const e=[];return t.forEach(r=>{e.push(Lh(r.event.x,r.event.y))}),pQe(e)}function PI(t){const e=S2e(t);let r=0;return t.forEach(i=>{let s=wN(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function mQe(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function wN(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var One;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(One||(One={}));let gQe=class extends Mo{constructor(e=cu.maximumDoubleClickDelay,r=cu.maximumDoubleClickDistance,i=cu.maximumDoubleTouchDelay,s=cu.maximumDoubleTouchDistance,n=XO){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=tM(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,x:r.x,y:r.y,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=tM(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),XH(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))):XH(s,e.data)>o?this._removeState(r):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=tM(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},yQe=class extends Mo{constructor(e=cu.maximumClickDelay,r=cu.movementUntilMouseDrag,i=cu.movementUntilPenDrag,s=cu.movementUntilTouchDrag,n=cu.holdDelay,o=XO){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=wi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):dQe(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},_Qe=class extends Mo{constructor(e=cu.maximumDoubleClickDelay,r=cu.maximumDoubleClickDistance,i=cu.maximumDoubleTouchDelay,s=cu.maximumDoubleTouchDistance,n=XO){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=wi(e.doubleClickTimer))}get hasPendingInputs(){return vh(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=wi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;XH(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=tM(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=tM(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}},vQe=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},bQe=class extends Mo{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new vQe({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const h=i-s,p=n-o,f=a-l,g=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(f-h)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},Ed=class extends Me{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ae(this._inputManager)}connect(){const e=this.view;this._source=new x2e(this.view.surface,e.input);const r=[new gQe,new yQe,new _Qe,new fQe(this.view.navigation),new bQe],i=new Vu({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new hQe],E_.INTERNAL),this._modeDragPan=new Cne(e,"primary"),this._modeDragRotate=new C9(e,"secondary",ac.CENTER),this._modeDragZoom=new NKe(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new eQe(e),new eKe(e),new jKe(e),new qKe(e,s.pan),new WKe(e),new rQe(e,s.resetTilt),new tQe(e,s.resetHeading),new C9(e,"primary",ac.EYE,[s.lookAround]),new C9(e,"secondary",ac.CENTER,[s.lookAround]),new Cne(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new iQe(e)],E_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this.addHandles(he(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},ui))}isModifierKeyDown(e){var r;return((r=this._inputManager)==null?void 0:r.isModifierKeyDown(e))??!1}_updateMode(){var s;const e=this.mode,r=this.primaryDragAction,i=(s=ZH.get(e))==null?void 0:s.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([m()],Ed.prototype,"view",void 0),d([m({value:"pan"})],Ed.prototype,"primaryDragAction",null),d([m({value:"default"})],Ed.prototype,"mode",null),d([m({readOnly:!0})],Ed.prototype,"updating",null),d([m()],Ed.prototype,"latestPointerType",null),d([m()],Ed.prototype,"latestPointerLocation",null),d([m()],Ed.prototype,"multiTouchActive",null),d([m()],Ed.prototype,"_inputManager",void 0),Ed=d([V("esri.views.3d.input.SceneInputManager")],Ed);const ZH=new Map,M9=new Map,O9=new Map;M9.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),M9.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),O9.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),O9.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),ZH.set("default",M9),ZH.set("pro",O9);const wQe=Ed;let Ds=class extends Me{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],Ds.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],Ds.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],Ds.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],Ds.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],Ds.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],Ds.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],Ds.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],Ds.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],Ds.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],Ds.prototype,"SHOW_POI",void 0),d([m()],Ds.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],Ds.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],Ds.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],Ds.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],Ds.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],Ds.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],Ds.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],Ds.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],Ds.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],Ds.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],Ds.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],Ds.prototype,"LINE_WIREFRAMES",void 0),Ds=d([V("esri.views.3d.support.DebugFlags")],Ds);const yi=new Ds;let tu,gS,JH=!1,KH=!1,QH=!1,eq=!1,rM=null;function xQe(t,e){if(!KH||!gS)return;E2e();const r=gS;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),C2e(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function TQe(t){QH=yi.DECONFLICTOR_SHOW_VISIBLE,eq=yi.DECONFLICTOR_SHOW_INVISIBLE,JH=QH||eq,KH=yi.DECONFLICTOR_SHOW_GRID,rM=null,JH||KH?rM=()=>SQe(t):tu&&(tu.parentElement.removeChild(tu),tu=null)}function E2e(){rM&&(rM(),rM=null)}function SQe(t){tu==null&&(tu=document.createElement("canvas"),tu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(tu));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;tu.setAttribute("width",`${o}px`),tu.setAttribute("height",`${a}px`),tu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),gS=tu.getContext("2d"),gS.clearRect(0,0,s,n),gS.font="12px Arial"}function C2e(t,e,r,i,s){E2e();const n=tu.height,o=gS;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function EQe(t,e){JH&&(e&&QH||!e&&eq)&&C2e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Vo,no;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Vo||(Vo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(no||(no={}));function A2e(t,e){return new O2e(t,$2e,e)}function CQe(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=$2e;return new O2e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:R9.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:R9.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:R9.minPixelSize},e)}function AQe(t){return Math.abs(t*t*t)}function P2e(t,e,r){const i=r.parameters;return $9.scale=Math.min(i.divisor/(e-i.offset),1),$9.factor=AQe(t),$9}function dJ(t,e){return Pt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function PQe(t,e,r){const i=P2e(t,e,r);return i.minScaleFactor=0,dJ(1,i)}function Rne(t,e,r,i){i.scale=PQe(t,e,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function M2e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,e.minScaleFactor),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function MQe(t,e,r,i){return dJ(t,P2e(e,r,i))}let O2e=class R2e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,r,i,s=OQe(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._fontHeight=n,this._viewingMode===Ne.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new R2e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,r),c=this._coverageCompensation(e,r,l),{tiltAngle:u,scaleFallOffFactor:h}=l,p=Math.sin(u)*a,f=.5*Math.PI-u-o*(.5-s*c),g=p/Math.cos(f),_=f+o*n*c,v=(g-h*(p/Math.cos(_)))/(1-h);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=v,i.divisor=g-v,i}_calculateCurvatureDependentParametersLocal(e,r,i=$ne){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=$ne){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=we((o-a)/(l-a),0,1),[u,h]=[s.min,s.max];return i.tiltAngle=Pt(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=Pt(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const $2e={curvatureDependent:{min:{curvature:Lt(10),tiltAngle:Lt(12),scaleFallOffFactor:.5},max:{curvature:Lt(70),tiltAngle:Lt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},R9={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function OQe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const $9={scale:0,factor:0,minScaleFactor:0},$ne={tiltAngle:0,scaleFallOffFactor:0};function RQe(t){return t instanceof Float32Array&&t.length>=16}function $Qe(t){return Array.isArray(t)&&t.length>=16}function IQe(t){return RQe(t)||$Qe(t)}const mE={unknown:1,inches:ro(1,"meters","inches"),feet:ro(1,"meters","feet"),"us-feet":ro(1,"meters","us-feet"),yards:ro(1,"meters","yards"),miles:ro(1,"meters","miles"),"nautical-miles":ro(1,"meters","nautical-miles"),millimeters:ro(1,"meters","millimeters"),centimeters:ro(1,"meters","centimeters"),decimeters:ro(1,"meters","decimeters"),meters:ro(1,"meters","meters"),kilometers:ro(1,"meters","kilometers"),"decimal-degrees":1/DNe(1,"meters",Kr.radius)};var da,Ine;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(da||(da={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Ine||(Ine={}));let pJ=class{constructor(e){this.field=e}},LQe=class extends pJ{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[da.Undefined,da.Undefined,da.Undefined]}},DQe=class extends pJ{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},NQe=class extends pJ{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},FQe=class{};function QC(t){return t!=null}function zx(t){return typeof t=="number"}function Jk(t){return typeof t=="string"}function kQe(t){return t==null||Jk(t)}function UQe(t,e,r,i=xe()){const s=t||0,n=e||0,o=r||0;return s!==0&&ZS(i,i,-s/180*Math.PI),n!==0&&XS(i,i,n/180*Math.PI),o!==0&&j6(i,i,o/180*Math.PI),i}function ey(t,e,r,i,s){var a;const n=t.minSize,o=t.maxSize;if(t.expression)return!1;if(t.useSymbolValue){const l=i.symbolSize[r];return e.minSize[r]=l,e.maxSize[r]=l,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=da.DefinedSize,!0}if(QC(t.field))return QC(t.stops)?t.stops.length===2&&zx(t.stops[0].size)&&zx(t.stops[1].size)?(Lne(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=da.DefinedSize,!0):!1:zx(n)&&zx(o)&&QC(t.minDataValue)&&QC(t.maxDataValue)?(Lne(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=da.DefinedSize,!0):t.valueUnit==="unknown"?!1:mE[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/mE[t.valueUnit],e.type[r]=da.DefinedSize,!0):!1;if(!QC(t.field)){if((a=t.stops)!=null&&a[0]&&zx(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=da.DefinedSize,!0;if(zx(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=da.DefinedSize,!0}return!1}function Lne(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function zQe(t,e,r,i){if(t.normalizationField||t.valueRepresentation||!kQe(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new LQe(t.field);let s;switch(t.axis){case"width":return s=ey(t,e.size,0,r),s?e:null;case"height":return s=ey(t,e.size,2,r),s?e:null;case"depth":return s=ey(t,e.size,1,r),s?e:null;case"width-and-depth":return s=ey(t,e.size,0,r),s&&ey(t,e.size,1,r),s?e:null;case null:case void 0:case"all":return s=ey(t,e.size,0,r),s=s&&ey(t,e.size,1,r),s=s&&ey(t,e.size,2,r),s?e:null;default:return`${t.axis}`,null}}function BQe(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===da.DefinedSize&&(n*=e.modelSize[s],t.type[s]=da.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==da.Undefined)i=0;else if(t.type[1]!==da.Undefined)i=1;else{if(t.type[2]===da.Undefined)return!1;i=2}for(let s=0;s<3;++s)t.type[s]===da.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function Dne(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function VQe(t,e,r){if(t.normalizationField)return null;if(Jk(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new DQe(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,Dne(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,Dne(e.color.colors,s,i)}}return e}function GQe(t,e,r){if(t.normalizationField)return null;if(Jk(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new NQe(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function I9(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function jQe(t,e,r){if(!Jk(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return I9(t,e.rotation,0),e;case"roll":return I9(t,e.rotation,1),e;case null:case void 0:case"heading":return I9(t,e.rotation,2),e;default:return`${t.axis}`,null}}let AR=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function I2e(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?zQe(n,s,e,r):s;case"color":return e.supports.color?VQe(n,s):s;case"opacity":return e.supports.opacity?GQe(n,s):null;case"rotation":return e.supports.rotation?jQe(n,s,r):s;default:return null}},new FQe);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i!=null&&i.size&&!BQe(i.size,e)?null:i:null}let HQe=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function gE(t,e){if(!t||yi.TESTS_DISABLE_FAST_UPDATES)return null;const r=I2e(t.visualVariables,e);return r?new HQe(r,D2e(r,e),!!r.size):null}function yE(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=I2e(e.visualVariables,r);return!!s&&!!(MI(i.size,s.size,"size")&&MI(i.color,s.color,"color")&&MI(i.rotation,s.rotation,"rotation")&&MI(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=D2e(s,r),t.requiresShaderTransformation=!!s.size,!0)}function MI(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let L2e=class extends Ci{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function D2e(t,e){const r=new L2e(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,Nh(iM),UQe(e.rotation[2],e.rotation[0],e.rotation[1],iM),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||xi(),kh(r.vvSymbolRotationMatrix,iM)),r}function qQe(t,e,r){if(!t.vvSize)return r;Bs(ty,r);const i=t.vvSymbolRotationMatrix;Pm(iM,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),ri(ty,ty,iM);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];Nne[s]=we(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return lR(ty,ty,Nne),Fl(ty,ty,t.vvSymbolAnchor),ty}function fJ(t,e,r){if(!e.vvSize)return te(t,1,1,1),t;for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=we(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}return t}function gp(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const ty=xe(),Nne=E(),iM=xe();function mJ(t){t.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(x`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function WQe(t){t.uniforms.add(new Dt("screenSizePerspective",e=>N2e(e.screenSizePerspective)))}function Kk(t){t.uniforms.add(new Dt("screenSizePerspectiveAlignment",e=>N2e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function N2e(t){return te(YQe,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const YQe=E();function F2e(t,e){const r=t.vertex;e.hasVerticalOffset?(k2e(r),e.hasScreenSizePerspective&&(t.include(mJ),Kk(r),Cp(t.vertex,e)),r.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const XQe=Yt();function k2e(t){t.uniforms.add(new wr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return es(XQe,n*a,o,i,s)}))}const U2e=.5;function z2e(t,e){t.include(mJ),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.CENTEROFFSETANDDISTANCE,"vec4");const r=t.vertex;Sc(r,e),Cp(r,e),r.uniforms.add(new wr("viewport",(i,s)=>s.camera.fullViewport),new Ie("polygonOffset",i=>i.shaderPolygonOffset),new Ie("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&k2e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(x`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?x.float(0):x`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||dE(r),e.draped||(r.uniforms.add(new Ie("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(x`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${x.float(U2e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&sC(r),e.hasScreenSizePerspective&&Kk(r),r.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const OI=Mn();function B2e(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){ht(t.type===vs.Mesh);const o=e.tolerance;V2e(t.boundingInfo,r,i,o,s,n)}else{const o=t.attributes.get(O.POSITION),a=o.indices;PR(r,i,0,a.length/3,a,o,void 0,s,n)}}const ZQe=E();function V2e(t,e,r,i,s,n){if(t==null)return;const o=j2e(e,r,ZQe);if(Pve(OI,t.bbMin),Mve(OI,t.bbMax),s!=null&&s.applyToAabb(OI),yJ(OI,e,o,i)){const{primitiveIndices:a,position:l}=t,c=a?a.length:l.indices.length/3;if(c>eet){const u=t.getChildren();if(u!==void 0){for(const h of u)V2e(h,e,r,i,s,n);return}}PR(e,r,0,c,l.indices,l,a,s,n)}}const G2e=E();function PR(t,e,r,i,s,n,o,a,l){if(o)return JQe(t,e,r,i,s,n,o,a,l);const{data:c,stride:u}=n,h=t[0],p=t[1],f=t[2],g=e[0]-h,_=e[1]-p,v=e[2]-f;for(let b=r,w=3*r;b<i;++b){let T=u*s[w++],S=c[T++],C=c[T++],P=c[T];T=u*s[w++];let R=c[T++],L=c[T++],F=c[T];T=u*s[w++];let U=c[T++],j=c[T++],z=c[T];a!=null&&([S,C,P]=a.applyToVertex(S,C,P,b),[R,L,F]=a.applyToVertex(R,L,F,b),[U,j,z]=a.applyToVertex(U,j,z,b));const Z=R-S,W=L-C,Y=F-P,le=U-S,I=j-C,N=z-P,B=_*N-I*v,H=v*le-N*g,q=g*I-le*_,Q=Z*B+W*H+Y*q;if(Math.abs(Q)<=Number.EPSILON)continue;const ie=h-S,_e=p-C,Oe=f-P,gt=ie*B+_e*H+Oe*q;if(Q>0){if(gt<0||gt>Q)continue}else if(gt>0||gt<Q)continue;const It=_e*Y-W*Oe,xt=Oe*Z-Y*ie,ct=ie*W-Z*_e,Qe=g*It+_*xt+v*ct;if(Q>0){if(Qe<0||gt+Qe>Q)continue}else if(Qe>0||gt+Qe<Q)continue;const Ve=(le*It+I*xt+N*ct)/Q;Ve>=0&&l(Ve,gJ(Z,W,Y,le,I,N,G2e),b,!1)}}function JQe(t,e,r,i,s,n,o,a,l){const{data:c,stride:u}=n,h=t[0],p=t[1],f=t[2],g=e[0]-h,_=e[1]-p,v=e[2]-f;for(let b=r;b<i;++b){const w=o[b];let T=3*w,S=u*s[T++],C=c[S++],P=c[S++],R=c[S];S=u*s[T++];let L=c[S++],F=c[S++],U=c[S];S=u*s[T];let j=c[S++],z=c[S++],Z=c[S];a!=null&&([C,P,R]=a.applyToVertex(C,P,R,b),[L,F,U]=a.applyToVertex(L,F,U,b),[j,z,Z]=a.applyToVertex(j,z,Z,b));const W=L-C,Y=F-P,le=U-R,I=j-C,N=z-P,B=Z-R,H=_*B-N*v,q=v*I-B*g,Q=g*N-I*_,ie=W*H+Y*q+le*Q;if(Math.abs(ie)<=Number.EPSILON)continue;const _e=h-C,Oe=p-P,gt=f-R,It=_e*H+Oe*q+gt*Q;if(ie>0){if(It<0||It>ie)continue}else if(It>0||It<ie)continue;const xt=Oe*le-Y*gt,ct=gt*W-le*_e,Qe=_e*Y-W*Oe,Ve=g*xt+_*ct+v*Qe;if(ie>0){if(Ve<0||It+Ve>ie)continue}else if(Ve>0||It+Ve<ie)continue;const yr=(I*xt+N*ct+B*Qe)/ie;yr>=0&&l(yr,gJ(W,Y,le,I,N,B,G2e),w,!1)}}const Fne=E(),kne=E();function gJ(t,e,r,i,s,n,o){return te(Fne,t,e,r),te(kne,i,s,n),Ze(o,Fne,kne),fe(o,o),o}function j2e(t,e,r){return te(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function yJ(t,e,r,i){return _J(t,e,r,i,1/0)}function _J(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const h=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(h,p)),!(l<0)&&(a=Math.max(a,Math.min(h,p)),!(a>l)&&a<s)}function H2e(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=MQe(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return we(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function q2e(t,e){const r=e?q2e(e):{};for(const i in t){let s=t[i];s!=null&&s.forEach&&(s=QQe(s)),s==null&&i in r||(r[i]=s)}return r}function KQe(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):Ppe(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function QQe(t){const e=[];return t.forEach(r=>e.push(r)),e}const W2e={multiply:1,ignore:2,replace:3,tint:4},eet=1e3;let b1=class extends SR{constructor(e,r){super(),this.type=vs.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Mr,this._pp0=Pe(0,0,1),this._pp1=Pe(0,0,0),this._parameters=q2e(e,r),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){KQe(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Cl.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},Y2e=class extends RXe{constructor(e,r,i){super(r,i),this.camera=e}};var Ur;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ur||(Ur={}));let vJ=class extends Ci{constructor(){super(...arguments),this.renderOccluded=Ur.Occlude,this.isDecoration=!1}},X2e=class{constructor(){this.factor=new Une,this.factorAlignment=new Une}},Une=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function n4t(t,e,r,i=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(r*=a,i===1)for(let c=0;c<l;++c)o[r]=s[n[c]],r+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let h=0;h<i;h++)o[r]=u,r+=a}}function zne(t,e,r){const{data:i,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;r*=o;for(let l=0;l<a;++l){const c=2*s[l];n[r]=i[c],n[r+1]=i[c+1],r+=o}}function Z2e(t,e,r,i){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(r*=a,i==null||i===1)for(let c=0;c<l;++c){const u=3*n[c];o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],r+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let h=0;h<i;++h)o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],r+=a}}function _E(t,e,r,i=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(r*=a,i===1)for(let c=0;c<l;++c){const u=4*n[c];o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],o[r+3]=s[u+3],r+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let h=0;h<i;++h)o[r]=s[u],o[r+1]=s[u+1],o[r+2]=s[u+2],o[r+3]=s[u+3],r+=a}}function Bne(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function bJ(t,e,r,i,s=1){if(!e)return void Z2e(t,r,i,s);const{data:n,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length,u=e[0],h=e[1],p=e[2],f=e[4],g=e[5],_=e[6],v=e[8],b=e[9],w=e[10],T=e[12],S=e[13],C=e[14];i*=l;let P=0,R=0,L=0;const F=W6(e)?U=>{P=n[U]+T,R=n[U+1]+S,L=n[U+2]+C}:U=>{const j=n[U],z=n[U+1],Z=n[U+2];P=u*j+f*z+v*Z+T,R=h*j+g*z+b*Z+S,L=p*j+_*z+w*Z+C};if(s===1)for(let U=0;U<c;++U)F(3*o[U]),a[i]=P,a[i+1]=R,a[i+2]=L,i+=l;else for(let U=0;U<c;++U){F(3*o[U]);for(let j=0;j<s;++j)a[i]=P,a[i+1]=R,a[i+2]=L,i+=l}}function wJ(t,e,r,i,s=1){if(!e)return void Z2e(t,r,i,s);const{data:n,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],_=a[5],v=a[6],b=a[8],w=a[9],T=a[10],S=!tX(a),C=1e-6,P=1-C;i*=c;let R=0,L=0,F=0;const U=W6(a)?j=>{R=n[j],L=n[j+1],F=n[j+2]}:j=>{const z=n[j],Z=n[j+1],W=n[j+2];R=h*z+g*Z+b*W,L=p*z+_*Z+w*W,F=f*z+v*Z+T*W};if(s===1)if(S)for(let j=0;j<u;++j){U(3*o[j]);const z=R*R+L*L+F*F;if(z<P&&z>C){const Z=1/Math.sqrt(z);l[i]=R*Z,l[i+1]=L*Z,l[i+2]=F*Z}else l[i]=R,l[i+1]=L,l[i+2]=F;i+=c}else for(let j=0;j<u;++j)U(3*o[j]),l[i]=R,l[i+1]=L,l[i+2]=F,i+=c;else for(let j=0;j<u;++j){if(U(3*o[j]),S){const z=R*R+L*L+F*F;if(z<P&&z>C){const Z=1/Math.sqrt(z);R*=Z,L*=Z,F*=Z}}for(let z=0;z<s;++z)l[i]=R,l[i+1]=L,l[i+2]=F,i+=c}}function tet(t,e,r,i,s=1){if(!e)return void _E(t,r,i,s);const{data:n,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],_=a[5],v=a[6],b=a[8],w=a[9],T=a[10],S=!tX(a),C=1e-6,P=1-C;if(i*=c,s===1)for(let R=0;R<u;++R){const L=4*o[R],F=n[L],U=n[L+1],j=n[L+2],z=n[L+3];let Z=h*F+g*U+b*j,W=p*F+_*U+w*j,Y=f*F+v*U+T*j;if(S){const le=Z*Z+W*W+Y*Y;if(le<P&&le>C){const I=1/Math.sqrt(le);Z*=I,W*=I,Y*=I}}l[i]=Z,l[i+1]=W,l[i+2]=Y,l[i+3]=z,i+=c}else for(let R=0;R<u;++R){const L=4*o[R],F=n[L],U=n[L+1],j=n[L+2],z=n[L+3];let Z=h*F+g*U+b*j,W=p*F+_*U+w*j,Y=f*F+v*U+T*j;if(S){const le=Z*Z+W*W+Y*Y;if(le<P&&le>C){const I=1/Math.sqrt(le);Z*=I,W*=I,Y*=I}}for(let le=0;le<s;++le)l[i]=Z,l[i+1]=W,l[i+2]=Y,l[i+3]=z,i+=c}}function J2e(t,e,r,i,s=1){const{data:n,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length;if(i*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const h=3*o[u];for(let p=0;p<s;++p)a[i]=n[h],a[i+1]=n[h+1],a[i+2]=n[h+2],a[i+3]=255,i+=l}else for(let u=0;u<c;++u){const h=4*o[u];for(let p=0;p<s;++p)a[i]=n[h],a[i+1]=n[h+1],a[i+2]=n[h+2],a[i+3]=n[h+3],i+=l}else{if(e===4){for(let u=0;u<c;++u){const h=4*o[u];a[i]=n[h],a[i+1]=n[h+1],a[i+2]=n[h+2],a[i+3]=n[h+3],i+=l}return}for(let u=0;u<c;++u){const h=3*o[u];a[i]=n[h],a[i+1]=n[h+1],a[i+2]=n[h+2],a[i+3]=255,i+=l}}else{a[i]=n[0],a[i+1]=n[1],a[i+2]=n[2],a[i+3]=n[3];const u=new Uint32Array(r.typedBuffer.buffer,r.start),h=l/4,p=u[i/=4];i+=h;const f=c*s;for(let g=1;g<f;++g)u[i]=p,i+=h}}function ret(t,e,r){const{data:i,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=i[0];r*=o;for(let c=0;c<a;++c)n[r]=l,r+=o}function K2e(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function Q2e(t,e,r,i,s,n){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)iet(a,l,r,i,s,n);else if(a===O.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get(O.POSITION))==null?void 0:o.indices;if(u){const h=u.length,p=s.getField(a,_a);K2e(t.objectAndLayerIdColor,p,h,n)}}}}function iet(t,e,r,i,s,n){switch(t){case O.POSITION:{ht(e.size===3);const o=s.getField(t,zn);ht(!!o,`No buffer view for ${t}`),o&&bJ(e,r,o,n);break}case O.NORMAL:{ht(e.size===3);const o=s.getField(t,zn);ht(!!o,`No buffer view for ${t}`),o&&wJ(e,i,o,n);break}case O.NORMALCOMPRESSED:{ht(e.size===2);const o=s.getField(t,TR);ht(!!o,`No buffer view for ${t}`),o&&zne(e,o,n);break}case O.UV0:{ht(e.size===2);const o=s.getField(t,lx);ht(!!o,`No buffer view for ${t}`),o&&zne(e,o,n);break}case O.COLOR:case O.SYMBOLCOLOR:{const o=s.getField(t,_a);ht(!!o,`No buffer view for ${t}`),ht(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||J2e(e,e.size,o,n);break}case O.COLORFEATUREATTRIBUTE:{const o=s.getField(t,Dk);ht(!!o,`No buffer view for ${t}`),ht(e.size===1),o&&e.size===1&&ret(e,o,n);break}case O.TANGENT:{ht(e.size===4);const o=s.getField(t,Ap);ht(!!o,`No buffer view for ${t}`),o&&tet(e,i,o,n);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{ht(e.size===4);const o=s.getField(t,Ap);ht(!!o,`No buffer view for ${t}`),o&&_E(e,o,n)}}}let o4t=class extends Ci{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function set(t,e){eTe(t,e,new Dt("slicePlaneOrigin",(r,i)=>sTe(e,r,i)),new Dt("slicePlaneBasis1",(r,i)=>{var s;return J5(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Dt("slicePlaneBasis2",(r,i)=>{var s;return J5(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function Rs(t,e){eTe(t,e,new bu("slicePlaneOrigin",(r,i)=>sTe(e,r,i)),new bu("slicePlaneBasis1",(r,i)=>{var s;return J5(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new bu("slicePlaneBasis2",(r,i)=>{var s;return J5(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function eTe(t,e,...r){if(!e.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function tTe(t,e,r){return t.instancedDoublePrecision?te(net,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function rTe(t,e){return t!=null?ye(K5,e.origin,t):e.origin}function iTe(t,e,r){return t.hasSliceTranslatedView?e!=null?Fl(oet,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function sTe(t,e,r){if(r.slicePlane==null)return Cn;const i=tTe(t,e,r),s=rTe(i,r.slicePlane),n=iTe(t,i,r);return n!=null?Ge(K5,s,n):s}function J5(t,e,r,i){if(i==null||r.slicePlane==null)return Cn;const s=tTe(t,e,r),n=rTe(s,r.slicePlane),o=iTe(t,s,r);return o!=null?(pe(e3,i,n),Ge(K5,n,o),Ge(e3,e3,o),ye(e3,e3,K5)):i}const net=E(),K5=E(),e3=E(),oet=xe();function lC(t,e){const r=e.output===k.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(O.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(x`
     void forwardObjectAndLayerIdColor() {
      ${r?i?x`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:x`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:x``} }`),t.fragment.code.add(x`
      void outputObjectAndLayerIdColor() {
        ${r?x`fragColor = objectAndLayerIdColorVarying;`:x``} }`)}function Qk(t){t.uniforms.add(new am("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function aet(t,e){const{vertex:r,fragment:i}=t;r.include(Qk),e.multipassEnabled&&(r.include(Owe),t.varyings.add("depth","float")),r.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Oc,e),i.code.add(x`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?x`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function nTe(t){t.vertex.uniforms.add(new Ie("renderTransparentlyOccludedHUD",(e,r)=>r.hudRenderStyle===sc.Occluded?1:r.hudRenderStyle===sc.NotOccluded?0:.75),new wr("viewport",(e,r)=>r.camera.fullViewport),new at("hudVisibilityTexture",(e,r)=>{var i;return(i=r.hudVisibility)==null?void 0:i.getTexture()})),t.vertex.include(Qk),t.vertex.code.add(x`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const oTe=zt(1,1,0,1),xJ=zt(1,0,1,1);function w1(t){t.fragment.uniforms.add(new at("depthTexture",(e,r)=>r.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",oTe).add("unoccludedHighlightFlag","vec4",xJ),t.fragment.code.add(x`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let aTe=class extends ps{constructor(e,r,i){super(e,"vec4",Rr.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},Al=class extends ps{constructor(e,r,i){super(e,"float",Rr.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}},MR=class extends L2e{constructor(){super(...arguments),this.renderOccluded=Ur.Occlude,this.isDecoration=!1}};const yS=8;function Yg(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(O.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Dt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new Dt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new Dt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new Dt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new Mu("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new Dt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",yS),r.uniforms.add(new Al("vvColorValues",s=>s.vvColor.values,yS),new aTe("vvColorColors",s=>s.vvColor.colors,yS)),r.code.add(x`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?x`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const Q5=.1,xo=.001;function lTe(t){const e=new Or,r=t.signedDistanceFieldEnabled;if(e.include(z2e,t),e.include(Rs,t),t.occlusionPass)return e.include(aet,t),e;const{vertex:i,fragment:s}=e;e.include(mJ),s.include(Yh),s.include(Lm),e.include(Yg,t),e.include(lC,t),e.include(nTe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),i.uniforms.add(new wr("viewport",(c,u)=>u.camera.fullViewport),new ni("screenOffset",(c,u)=>cr(cTe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new ni("anchorPosition",c=>bO(c)),new wr("materialColor",c=>c.color)),sC(i),r&&(i.uniforms.add(new wr("outlineColor",c=>c.outlineColor)),s.uniforms.add(new wr("outlineColor",c=>Vne(c)?c.outlineColor:_u),new Ie("outlineSize",c=>Vne(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&i.include(Qk),t.hasScreenSizePerspective&&(WQe(i),Kk(i)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.FEATUREATTRIBUTE,"vec4"),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?x`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;i.code.add(x`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===k.ObjectAndLayerIdColor?x`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${x.float(xo)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(xo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new at("tex",c=>c.texture));const a=t.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(Q5)})`:x.float(Q5),l=x`
    ${t.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?x`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:x`
      vec2 samplePos = vtc;
      `}

    ${r?x`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(xo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?x`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case k.Color:s.code.add(x`
        void main() {
          ${l}
          ${t.transparencyPassType===dt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case k.Alpha:s.code.add(x`
        void main() {
          ${l}
          fragColor = vec4(fragColor.a);
        }`);break;case k.ObjectAndLayerIdColor:s.code.add(x`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case k.Highlight:s.constants.add("occludedHighlightFlag","vec4",oTe),s.constants.add("unoccludedHighlightFlag","vec4",xJ),s.code.add(x`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function Vne(t){return t.outlineColor[3]>0&&t.outlineSize>0}function bO(t,e=cTe){return t.textureIsSignedDistanceField?cet(t.anchorPosition,t.distanceFieldBoundingBox,e):Vn(e,t.anchorPosition),e}function cet(t,e,r){e!=null?cr(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):cr(r,0,0)}const cTe=je(),uet=Object.freeze(Object.defineProperty({__proto__:null,build:lTe,calculateAnchorPosForRendering:bO},Symbol.toStringTag,{value:"Module"})),wu=Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),het=Pc(Ee.ONE,Ee.ONE),uTe=Pc(Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA);function A0(t){return t===dt.FrontFace?null:t===dt.Alpha?uTe:het}function e8(t){return t===dt.FrontFace?Mc:null}const t8=5e5,r8={factor:-1,units:-2};function i8(t){return t?r8:null}function x1(t,e=Qr.LESS){return t===dt.NONE||t===dt.FrontFace?e:Qr.LEQUAL}let hTe=class dTe extends Gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Dr(e.rctx,dTe.shader.get().build(this.configuration),Mr)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===dt.NONE,s=e===dt.FrontFace,n=this.configuration.hasPolygonOffset?det:null,o=r.draped?null:(i||s)&&r.output!==k.Highlight&&(r.depthEnabled||r.occlusionPass)?Mc:null;return Nt({blending:r.output===k.Color||r.output===k.Alpha||r.output===k.Highlight?i?pet:A0(e):null,depthTest:r.draped?null:{func:Qr.LEQUAL},depthWrite:o,colorWrite:qt,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?sr.POINTS:sr.TRIANGLES}};hTe.shader=new Lr(uet,()=>me(()=>Promise.resolve().then(()=>lAt),void 0));const det={factor:0,units:-4},pet=Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA);let qs=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=dt.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([G({count:k.COUNT})],qs.prototype,"output",void 0),d([G({count:dt.COUNT})],qs.prototype,"transparencyPassType",void 0),d([G()],qs.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([G()],qs.prototype,"spherical",void 0),d([G()],qs.prototype,"occlusionTestEnabled",void 0),d([G()],qs.prototype,"signedDistanceFieldEnabled",void 0),d([G()],qs.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),d([G()],qs.prototype,"vvSize",void 0),d([G()],qs.prototype,"vvColor",void 0),d([G()],qs.prototype,"hasVerticalOffset",void 0),d([G()],qs.prototype,"hasScreenSizePerspective",void 0),d([G()],qs.prototype,"debugDrawLabelBorder",void 0),d([G()],qs.prototype,"hasSlicePlane",void 0),d([G()],qs.prototype,"hasPolygonOffset",void 0),d([G()],qs.prototype,"depthEnabled",void 0),d([G()],qs.prototype,"pixelSnappingEnabled",void 0),d([G()],qs.prototype,"draped",void 0),d([G()],qs.prototype,"multipassEnabled",void 0),d([G()],qs.prototype,"cullAboveGround",void 0),d([G()],qs.prototype,"occlusionPass",void 0),d([G()],qs.prototype,"objectAndLayerIdColorInstanced",void 0),d([G({constValue:!0})],qs.prototype,"hasSliceInVertexProgram",void 0),d([G({constValue:!1})],qs.prototype,"hasVvInstancing",void 0);let vE=class extends b1{constructor(e){super(e,new Eet),this._configuration=new qs,this.produces=new Map([[ue.HUD_MATERIAL,r=>cN(r)&&!this.parameters.drawInSecondSlot],[ue.LABEL_MATERIAL,r=>cN(r)&&this.parameters.drawInSecondSlot],[ue.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[ue.DRAPED_MATERIAL,r=>cN(r)]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ue.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===k.Color&&(this._configuration.debugDrawLabelBorder=!!yi.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!(i.options.selectionMode&&i.options.hud&&e.visible&&i.point))return;const a=this.parameters,l=i.point,c=i.camera;let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=c.pixelRatio,h*=c.pixelRatio,kh(D9,r),e.attributes.has(O.FEATUREATTRIBUTE)&&get(D9);const p=e.attributes.get(O.POSITION),f=e.attributes.get(O.SIZE),g=e.attributes.get(O.NORMAL),_=e.attributes.get(O.CENTEROFFSETANDDISTANCE);ht(p.size>=3);const v=bO(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<p.data.length/p.size;w++){const T=w*p.size;te(Jo,p.data[T],p.data[T+1],p.data[T+2]),Ge(Jo,Jo,r);const S=w*f.size;ry[0]=f.data[S]*u,ry[1]=f.data[S+1]*h,Ge(Jo,Jo,c.viewMatrix);const C=w*_.size;if(te(kc,_.data[C],_.data[C+1],_.data[C+2]),!b&&(Jo[0]+=kc[0],Jo[1]+=kc[1],kc[2]!==0)){const R=kc[2];fe(kc,Jo),ye(Jo,Jo,re(kc,kc,R))}const P=w*g.size;if(te(t3,g.data[P],g.data[P+1],g.data[P+2]),this._normalAndViewAngle(t3,D9,c,N9),this._applyVerticalOffsetTransformationView(Jo,N9,c,L9),c.applyProjection(Jo,Ma),Ma[0]>-1){b&&(kc[0]||kc[1])&&(Ma[0]+=kc[0]*c.pixelRatio,kc[1]!==0&&(Ma[1]+=dJ(kc[1],L9.factorAlignment)*c.pixelRatio),c.unapplyProjection(Ma,Jo)),Ma[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Ma[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Ma[0]=Math.floor(Ma[0]),Ma[1]=Math.floor(Ma[1]),M2e(ry,L9.factor,ry);const R=wet*c.pixelRatio;let L=0;if(a.textureIsSignedDistanceField&&(L=a.outlineSize*c.pixelRatio/2),Gne(l,Ma[0],Ma[1],ry,R,L,a,v)){const F=i.ray;if(Ge(jne,Jo,cn(_et,c.viewMatrix)),Ma[0]=l[0],Ma[1]=l[1],c.unprojectFromRenderScreen(Ma,Jo)){const U=E();ce(U,F.direction);const j=1/Se(U);re(U,U,j),o($i(F.origin,Jo)*j,U,-1,!0,1,jne)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.attributes.get(O.POSITION),l=e.attributes.get(O.SIZE),c=this.parameters,u=bO(c);let{scaleX:h,scaleY:p}=this._getScreenScale(e);h*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const f=xet*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const _=g*a.size,v=a.data[_],b=a.data[_+1],w=g*l.size;ry[0]=l.data[w]*h,ry[1]=l.data[w+1]*p;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),Gne(s,v,b,ry,f,T,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Aet(this)}_normalAndViewAngle(e,r,i,s){return IQe(r)&&(r=kh(yet,r)),Bo(s.normal,e,r),Ge(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=de(pTe,Tet),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?Rne(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?Rne(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,N9);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&ce(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ce(n,e);const c=we(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return re(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Se(e),o=i.aboveGround?1:-1,a=i.computeRenderPixelSizeAtDist(n)*U2e,l=re(Jo,r.normal,o*a);return pe(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){var c;const n=this.parameters;if(!((c=n.verticalOffset)!=null&&c.screenLength)){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const u=Se(e);this._updateScaleInfo(s,u,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Se(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=H2e(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),re(r.normal,r.normal,l),pe(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&ce(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(fe(t3,i),pe(i,i,re(t3,t3,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ce(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ce(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}createGLMaterial(e){return new fet(e)}calculateRelativeScreenBounds(e,r,i=jt()){return met(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e){const r=e.attributes.get(O.FEATUREATTRIBUTE);if(r==null)return{scaleX:1,scaleY:1};const i=sX(r.data,bet),[s,n]=fJ(vet,this.parameters,i);return{scaleX:s,scaleY:n}}},fet=class extends SZ{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(hTe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function met(t,e,r,i){i[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*r,i[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*r}function get(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),h=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=s*h,t[4]=n*h,t[5]=o*h,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function Gne(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,u=r-s-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),h-=i[1]*(1-p[3]),l-=n,c+=n,u-=n,h+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<h}const L9=new X2e,Jo=E(),t3=E(),Ma=Yt(),pTe=E(),jne=E(),D9=xi(),yet=xi(),_et=xe(),kc=E(),vet=E(),bet=Yt(),N9={normal:pTe,cosAngle:0},wet=1,xet=2,ry=[0,0],Tet=Pe(0,0,1);let Eet=class extends dwe{constructor(){super(...arguments),this.renderOccluded=Ur.Occlude,this.isDecoration=!1,this.color=zt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ar(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=zt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}};const fTe=Yi().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.CENTEROFFSETANDDISTANCE).vec4f(O.FEATUREATTRIBUTE),Cet=fTe.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let Aet=class{constructor(e){this._material=e,this.vertexBufferLayout=se("enable-feature:objectAndLayerId-rendering")?Cet:fTe}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,r,i,s,n){var b;bJ(i.attributes.get(O.POSITION),e,s.position,n,6),wJ(i.attributes.get(O.NORMAL),r,s.normal,n,6);const o=i.attributes.get(O.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=i.attributes.get(O.POSITION).indices.length,p=n;const f=s.uv0;for(let w=0;w<h;++w)f.set(p,0,a),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,l),p++;J2e(i.attributes.get(O.COLOR),4,s.color,n,6);const{data:g,indices:_}=i.attributes.get(O.SIZE);h=_.length;const v=s.size;p=n;for(let w=0;w<h;++w){const T=g[2*_[w]],S=g[2*_[w]+1];for(let C=0;C<6;++C)v.set(p,0,T),v.set(p,1,S),p++}if(i.attributes.get(O.CENTEROFFSETANDDISTANCE)?_E(i.attributes.get(O.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):Bne(s.centerOffsetAndDistance,n,6*h),i.attributes.get(O.FEATUREATTRIBUTE)?_E(i.attributes.get(O.FEATUREATTRIBUTE),s.featureAttribute,n,6):Bne(s.featureAttribute,n,6*h),i.objectAndLayerIdColor!=null){const w=(b=i.attributes.get(O.POSITION))==null?void 0:b.indices;if(w){const T=w.length,S=s.getField(O.OBJECTANDLAYERIDCOLOR,_a);K2e(i.objectAndLayerIdColor,S,T,n,6)}}}};const jp=E(),Bx=Yt(),r3=Yt(),F9=E(),Pet=xe(),Met=Vs(),k9=Un(),Oet=E(),Ret=jt();class $et{constructor(){this.aabr=jt(),this.distance=0,this.culled=!1,this.visible=!1}}class Iet{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var tc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(tc||(tc={}));class Let{constructor(){this.camera=new Je,this.slicePlane=y0(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),tx(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let MT=class extends Me{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new Let,this._state=tc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new ket,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==tc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/tc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case tc.Idle:this._startUpdate(),t.madeProgress();case tc.Process:if(this._state=tc.Process,!this._processActiveGraphics(t))return;case tc.Sort:if(this._state=tc.Sort,!this._sortVisibleGraphics(t))return;case tc.Deconflict:if(this._state=tc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:xQe(this,this._visible),this._state=tc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof vE}_startUpdate(){TQe(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new $et,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),Det(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=YE(Pet,this._viewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?Met:null;let s=0;for(i!=null&&(Ge(i,Cn,this._viewState.camera.viewMatrix),i[3]=Vr(this.view.spatialReference).radius,s=Jye(i,Cn));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===no.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),EQe(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Hne(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Hne(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Net(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(no.GRAPHIC,Vo.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Tu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=Bet,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,jp)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Ge(jp,a,i.viewMatrix);const l=n.attributes,c=l.get(O.NORMAL).data,u=l.get(O.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(jp,c,s.transformation,u,i,r.scaleInfo,jp),es(Bx,jp[0],jp[1],jp[2],1),wc(r3,Bx,i.projectionMatrix),re(r.positionNDC,r3,1/r3[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,F9),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(F9[2]),r.distance=F9[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),es(r3,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),wc(Bx,r3,e),Rw(Bx,Bx,1/Bx[3]),te(r.positionView,jp[0],jp[1],jp[2])}_isCulledByHorizon(t,e,r){return ce(k9.direction,t.positionView),te(k9.origin,0,0,0),!!f1(e,k9,Oet)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&yX(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._viewState.camera,o=e.getScreenSize(Uet);M2e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=j4(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Ret),Pt(0,n.fullWidth,.5+.5*i[0]),Pt(0,n.fullHeight,.5+.5*i[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(fa(a),Pl(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}T_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];let i=!0;for(let s=Math.floor(r.aabr[0]/this._accBinsSizeX);s<=Math.floor(r.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(r.aabr[1]/this._accBinsSizeY);n<=Math.floor(r.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;i=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,P6(c.aabr,r.aabr)))return!0}}return i}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new kt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Vo.DECONFLICTION,e),this.visibilityGroup===no.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function Det(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Vo.DECONFLICTION,!0)}function*Hne(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*Net(t,e,r){e.clear(),t.forEach((s,n)=>{var l;const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,Vo.DECONFLICTION);const a=(l=s.info)==null?void 0:l[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}d([m({constructOnly:!0})],MT.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],MT.prototype,"updating",null),MT=d([V("esri.views.3d.layers.graphics.Deconflictor")],MT);class Fet{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class ket{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new kt({allocator:s=>s||new Fet})}}const Uet=je();class zet{constructor(){this.positionView=E(),this.positionNDC=E(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new X2e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const Bet=new zet,Vet=2e3;let xN=class extends MT{constructor(e){super(e),this.visibilityGroup=no.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Ao;const r=performance.now();if(e.state!==Br.IDLE&&r-this._lastDeconfliction<Vet)return Ao;super.runTask(e),this.state===tc.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([m({constructOnly:!0})],xN.prototype,"parent",void 0),xN=d([V("esri.views.3d.layers.graphics.LabelDeconflictor")],xN);let tq=class extends MT{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=no.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([he(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),he(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),he(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},ui)]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_DECONFLICTOR,this),this._labels=new xN({view:this.view,parent:this})}destroy(){this._labels=Ae(this._labels),this._frameTask=wi(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&U9(e));r.setVisibilityFlag(no.GRAPHIC,Vo.DECONFLICTION,i)}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Gye(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){vh(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new Iet(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),U9(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=U9(e);i||Get(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!(r!=null&&r.length))return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function U9(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function Get(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(no.GRAPHIC,Vo.DECONFLICTION,!0))}tq=d([V("esri.views.3d.layers.graphics.GraphicsDeconflictor")],tq);function mTe(t){return"declaredClass"in t}function qne(t){return"declaredClass"in t}function jet(t){return"declaredClass"in t}function Het(t,e){return t?jet(t)?t:new W_({layer:e,sourceLayer:e,visible:t.visible,symbol:ge(t.symbol),attributes:ge(t.attributes),geometry:gTe(t.geometry)}):null}function gTe(t){return t==null?null:mTe(t)?t:Mw(qet(t))}function qet(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:r,wkt2:i,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Wne(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Wne(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:_}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:_,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:_Te(o)?yTe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function Wne(t){return Wet(t)?t.map(e=>yTe(e)):t}function yTe(t){return t.map(e=>Array.from(e))}function Wet(t){for(const e of t)if(e.length!==0)return _Te(e);return!1}function _Te(t){return t.length>0&&(HO(t[0])||qO(t[0]))}function Yet(t,e){if(!t)return null;let r;if(qne(t)){if(e==null)return t.clone();if(qne(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=m1(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function _4t(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:s}=t,n={wkid:e,wkt:r,wkt2:i,latestWkid:s};return Xe.fromJSON(n)}const TJ="__begin__",SJ="__end__",Xet=new RegExp(TJ,"ig"),Zet=new RegExp(SJ,"ig"),Yne=new RegExp("^"+TJ,"i"),Xne=new RegExp(SJ+"$","i"),eF='"',Jet=eF+" + ",Ket=" + "+eF;function Qet(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function v4t(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function EJ(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Qet(t.labelExpression),e.type="conventional"),e}function b4t(t){const e=EJ(t);if(!e)return null;switch(e.type){case"conventional":return ett(e.expression);case"arcade":return e.expression}return null}function w4t(t){const e=EJ(t);if(!e)return null;switch(e.type){case"conventional":return rtt(e.expression);case"arcade":return vTe(e.expression)}return null}function ett(t){let e;return t?(e=XW(t,r=>TJ+'$feature["'+r+'"]'+SJ),e=Yne.test(e)?e.replace(Yne,""):eF+e,e=Xne.test(e)?e.replace(Xne,""):e+eF,e=e.replaceAll(Xet,Jet).replaceAll(Zet,Ket)):e='""',e}const ttt=/^\s*\{([^}]+)\}\s*$/i;function rtt(t){const e=t==null?void 0:t.match(ttt);return(e==null?void 0:e[1].trim())||null}const itt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,stt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,ntt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function vTe(t){if(!t)return null;let e=itt.exec(t)||stt.exec(t);return e?e[1]||e[3]:(e=ntt.exec(t),e?e[2]:null)}const z9=()=>ae.getLogger("esri.layers.support.labelFormatUtils"),B9={type:"simple",evaluate:()=>null},ott={getAttribute:(t,e)=>t.field(e)};async function att(t,e,r){if(!t||!t.symbol||!e)return B9;const i=t.where,s=EJ(t);let n;if(s.type==="arcade"){const o=await qGe(s.expression,r,e);if(o==null)return B9;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){z9().error(new J("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>vTe(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":ltt(u,c)})};if(i){let o;try{o=await X1e(i,e)}catch(l){return z9().error(new J("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:l})),B9}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:ott;try{if(o.testFeature(l,u))return a(l,c)}catch(h){z9().error(new J("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:l,error:h}))}return null}}return n}function ltt(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const{max:s,min:n}=Q1e(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return r.name}}let i=t;return v7e(e)?i=U6(i,_6e("short-date")):cve(e)&&(i=w6e(+i)),i||""}function bTe(t,e,r,i,s,n,o,a,l,c,u){const h=gtt[u.mode];let p,f,g=0;if(Wi(t,e,r,i,l.spatialReference,s,a))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,u),p=n,f=o):(p=i,f=s),Wi(p,l.spatialReference,f,n,c.spatialReference,o,a)?g:void 0}function r1(t,e,r,i,s){const n=(h5(t)?t.z:K_e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=Wf(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Wf(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Wf(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=Wf(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function ctt(t,e,r,i){return r1(t,e,r,i,OT),OT.z}function OR(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?bs.UPDATE:t.onTheGroundChanged}function Gh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function i1(t){return t!=="absolute-height"}function utt(t,e,r,i,s){r1(e,r,s,i,OT),wTe(t,OT.verticalDistanceToGround);const n=OT.sampledElevation,o=Bs(ytt,t.transformation);return RI[0]=e.x,RI[1]=e.y,RI[2]=OT.z,$l(e.spatialReference,RI,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function wTe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(O.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[r],O.CENTEROFFSETANDDISTANCE))}}function htt(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],h=t[e+2],p=n.getElevation(c,u,h,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/s}function dtt(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=n.spatialReference;e*=3,i*=3;for(let p=0;p<s;++p){const f=t[e],g=t[e+1],_=t[e+2],v=n.getElevation(f,g,_,h,"ground")??0;l+=v,r[i]=f,r[i+1]=g,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/s}function ptt(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=n.spatialReference;e*=3,i*=3;for(let p=0;p<s;++p){const f=t[e],g=t[e+1],_=t[e+2],v=n.getElevation(f,g,_,h,"scene")??0;l+=v,r[i]=f,r[i+1]=g,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/s}function ftt(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function mtt(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<s;++u){const h=t[e],p=t[e+1],f=t[e+2];r[i]=h,r[i+1]=p,r[i+2]=c==null?f+l:l,e+=3,i+=3}return 0}let RR=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var bs;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(bs||(bs={}));const gtt={"absolute-height":{applyElevationAlignmentBuffer:mtt,requiresAlignment:ftt},"on-the-ground":{applyElevationAlignmentBuffer:htt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:dtt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:ptt,requiresAlignment:()=>!0}},ytt=xe(),OT=new RR,RI=E();function CJ(t){return t.mapPositions!=null}function xTe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!CJ(l))continue;const{update:c,averageGeometrySampledElevation:u}=STe(l,e,r,i,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}function aw(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,El),wTe(o,El.verticalDistanceToGround),l=El.sampledElevation):(i(a,El),e.mode!=="absolute-height"&&(l=El.sampledElevation));const c=Bs(_tt,n??o.transformation),u=te(TTe,c[12],c[13],c[14]);yi.TESTS_DISABLE_OPTIMIZATIONS?(Sl[0]=a.x,Sl[1]=a.y,Sl[2]=El.z,$l(a.spatialReference,Sl,c,s.spatialReference)&&(n?Bs(n,c):o.transformation=c)):s.setAltitudeOfTransformation(El.z,c);const h=AJ/s.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(n?Bs(n,c):o.transformation=c),l}const _tt=xe();function vtt(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,El);const a=e.mode!=="absolute-height"?El.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=wtt;l.getGlobalTransform(c,u);const h=te(TTe,u[12],u[13],u[14]);yi.TESTS_DISABLE_OPTIMIZATIONS?(Sl[0]=o.x,Sl[1]=o.y,Sl[2]=El.z,$l(o.spatialReference,Sl,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(El.z,u);const p=AJ/s.unitInMeters;return(yi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=p||Math.abs(u[13]-h[1])>=p||Math.abs(u[14]-h[2])>=p)&&l.setGlobalTransform(c,u),a}function btt(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!CJ(h))continue;const p=h.attributes.get(O.POSITION);if(p!==l){const{update:f,averageGeometrySampledElevation:g}=STe(h,e,r,i,s);c=g,l=p,u=f}u&&n.geometryVertexAttributeUpdated(h,O.POSITION),a+=c}return a/o.length}const AJ=.01,Sl=E(),Nu=E(),Vx=E(),wtt=xe(),TTe=E(),El=new RR;function STe(t,e,r,i,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;Nu[0]=o[12],Nu[1]=o[13],Nu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,u=l.size,h=c.length/u,p=new LX(t.mapPositions,r);let f=0,g=0;for(let _=0;_<h;_++){if(Vx[0]=c[f],Vx[1]=c[f+1],Vx[2]=c[f+2],i(p,El),a&&(g+=El.sampledElevation),yi.TESTS_DISABLE_OPTIMIZATIONS)c[f]=p.array[p.offset],c[f+1]=p.array[p.offset+1],c[f+2]=El.z,Wi(c,r,f,c,s.spatialReference,f,1),c[f]-=Nu[0],c[f+1]-=Nu[1],c[f+2]-=Nu[2],n=!0;else{Sl[0]=c[f]+Nu[0],Sl[1]=c[f+1]+Nu[1],Sl[2]=c[f+2]+Nu[2],s.setAltitude(Sl,El.z),c[f]=Sl[0]-Nu[0],c[f+1]=Sl[1]-Nu[1],c[f+2]=Sl[2]-Nu[2];const v=AJ/s.unitInMeters;(Math.abs(Vx[0]-c[f])>=v||Math.abs(Vx[1]-c[f+1])>=v||Math.abs(Vx[2]-c[f+2])>=v)&&(n=!0)}f+=u,p.offset+=3}return g/=h,{update:n,averageGeometrySampledElevation:g}}function xtt(t){return!!t&&mE[t]!=null}function ETe(t){return 1/(mE[t]||1)}function Ttt(){const t=Object.keys(mE);return t.sort(),t}const Stt=Ttt(),Ett=()=>ae.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Ctt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function T4t(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const r=PTe(e);if(r!=null)return{cachedResult:r}}return null}async function S4t(t,e,r,i){const s=t==null?void 0:t.expression;if(typeof s!="string")return null;const n=PTe(s);if(n!=null)return{cachedResult:n};const o=await YX();vt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function CTe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function s8(t,e){if(t!=null&&!ATe(t)){if(!e||!t.arcade)return void Ett().errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=gTe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Att(t){if(t!=null){if(ATe(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function E4t(t,e=!1){let r=t==null?void 0:t.featureExpressionInfo;const i=r==null?void 0:r.expression;return e||i==="0"||(r=null),r??null}const Ptt={cachedResult:0};function ATe(t){return t.cachedResult!=null}function PTe(t){return t==="0"?0:null}let tF=class MTe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=ETe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Att(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=xtt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e==null?void 0:e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=Ctt(e),s8(this._featureExpressionInfoContext,CTe(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new MTe;return e!=null&&r.setFromElevationInfo(e),r}},Mtt=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};function PJ(t,e){if(t.type==="point")return iy(t,e,!1);if(mTe(t))switch(t.type){case"extent":return iy(t.center,e,!1);case"polygon":return iy(t.centroid,e,!1);case"polyline":return iy(Zne(t),e,!0);case"mesh":return iy(t.origin,e,!1)}else switch(t.type){case"extent":return iy(Ott(t),e,!0);case"polygon":return iy(Rtt(t),e,!0);case"polyline":return iy(Zne(t),e,!0)}}function Zne(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Bme(e,zme(e)/2);return m1(r[0],r[1],r[2],t.spatialReference)}function Ott(t){return m1(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Rtt(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Gme(t.rings,!!t.hasZ);return m1(r[0],r[1],r[2],t.spatialReference)}function iy(t,e,r){const i=r?t:Yet(t);return e&&t?H0e(t,i,e)?i:null:i}function A4t(t,e,r,i=0){if(t){e||(e=jt());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),es(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function sM(t,e,r=null){const i=uR(yh);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function P4t(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=(t==null?void 0:t[o])!=null?t[o]:(r==null?void 0:r[o])!=null?r[o]:s[o];return n[3]=e??i??s[3],n}function Jne(t=kg,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,h=a===0&&!n&&!u,p=r[a];l==="symbol-value"||h?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return la(s)}function $tt(t){return t.isPrimitive!=null}function n8(t){return rq($tt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function rq(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function Itt(t,e,r,i=xe()){return t&&ZS(i,i,-t/180*Math.PI),e&&XS(i,i,e/180*Math.PI),r&&j6(i,i,r/180*Math.PI),i}function MJ(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=xa(e),s=nx(t)*i,n=ox(t)*i,o=y1(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}var Wt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Wt||(Wt={}));let Ltt=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Dm=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){var r,i;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(r=e.renderer.edgeView)==null||r.removeObject(this.stageObject),this.stageObject.dispose(),(i=this._sharedResource)==null||i.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=Kne(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&s8(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>r1(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=E()){return ce(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Mn()){const r=this.stageObject.boundingVolumeObjectSpace;return Pve(e,r.min),Mve(e,r.max),e}computeAttachmentOrigin(e){const r=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++;else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(Hm)&&(Ge(Hm,Hm,r),pe(e.render.origin,e.render.origin,Hm),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Dtt,l=sZ(o)?1:a.length;for(let u=0;u<l;u++){const h=a[u];sy[0]=o[h[0]],sy[1]=o[h[1]],sy[2]=o[h[2]],Ge(sy,sy,this.stageObject.transformation),q1[3*u]=sy[0],q1[3*u+1]=sy[1],q1[3*u+2]=sy[2]}if(!e(q1,0,l))return null;Ri(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],q1[u+h]),o[h+3]=Math.max(o[h+3],q1[u+h]);c&&i.push({location:q1.slice(u,u+3),screenSpaceBoundingRect:c})}if(r!=null&&r.service&&this.elevationContext.mode!=="absolute-height"){ip(o,Hm);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(r.useViewElevation)h=r.service.getElevation(Hm[0],Hm[1],u)??0;else try{const p=MJ(o,r.service.spatialReference,r);h=await r.service.queryElevation(Hm[0],Hm[1],s,p,u)??0}catch{}Ave(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){e===c0.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===c0.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=Kne(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function Kne(t){return t.isVisible()?t.parameters.transparent?Wt.TRANSPARENT:Wt.OPAQUE:Wt.INVISIBLE}const q1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],sy=E(),Hm=E(),Dtt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let OTe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};const RTe=3,iq=3,$Te=10;let ITe=class{constructor(e,r=null){this.geometry=e,this.textures=r}},LTe=class{constructor(e,r,i){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=i;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get(O.POSITION).indices.length,0)}get geometries(){return s6(this.components.map(e=>e.geometry))}},DTe=class{constructor(e){this.levels=e,this.levels.sort((r,i)=>r.minScreenSpaceRadius===i.minScreenSpaceRadius?r.numVertices-i.numVertices:r.minScreenSpaceRadius-i.minScreenSpaceRadius)}};function $I(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),s6(e)}function Qne(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})),s6(e)}function eoe(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry))),s6(e)}function Ntt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function NTe(t,e){const r=(i,s,n=!1)=>new DTe(i.map(o=>{const a=s(o.tesselation);return n&&gXe(a),new LTe([new ITe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>pXe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>sXe(e,1));case"cone":return r(V9,i=>vse(e,1,.5,i,!1),!0);case"inverted-cone":return r(V9,i=>vse(e,1,.5,i,!0),!0);case"cylinder":return r(V9,i=>mXe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>dXe(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>lXe(e,1),!0);default:return}}const V9=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let lh=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new FTe}},OJ=class extends lh{constructor(e){super(e),this.estimated=!0}},Ftt=class extends lh{constructor(e,r){super(r),this.numComplexities=e}},ktt=class extends OJ{constructor(e,r){super(r),this.numComplexities=e}},FTe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function Utt(t){return t.type==="fill"}function ztt(t){return t.type==="extrude"}function Btt(t){return t&&t.enabled&&(ztt(t)||Utt(t))&&t.edges!=null}function Vtt(t){return t&&t.enabled&&t.edges||null}function kTe(t,e){return Gtt(Vtt(t),e)}function Gtt(t,e){if(t==null)return null;const r=t.color!=null?sX(Fe.toUnitRGBA(t.color)):zt(0,0,0,0),i=on(t.size),s=on(t.extensionLength);switch(t.type){case"solid":return jtt({color:r,size:i,extensionLength:s,...e});case"sketch":return Htt({color:r,size:i,extensionLength:s,...e});default:return}}function jtt(t){return{...qtt,...t,type:"solid"}}function Htt(t){return{...Wtt,...t,type:"sketch"}}const qtt={color:zt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Wt.OPAQUE,hasSlicePlane:!1},Wtt={color:zt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Wt.OPAQUE,hasSlicePlane:!1};function cC(t,e){switch(e.normalType){case Ir.Compressed:t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(x`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case Ir.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(x`vec3 normalModel() {
return normal;
}`);break;case Ir.ScreenDerivative:t.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ir.COUNT:case Ir.Ground:}}var Ir;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ir||(Ir={}));function UTe(t,e){const r=t.fragment;switch(r.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case ds.None:r.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case ds.View:r.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case ds.WindingOrder:r.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case ds.COUNT:}}var ds;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(ds||(ds={}));let uC=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(O.POSITION).indices.length}write(e,r,i,s,n){Q2e(i,this.vertexBufferLayout,e,r,s,n)}};function o8(t,e){switch(e.normalType){case Ir.Attribute:case Ir.Compressed:t.include(cC,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new I5("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Mu("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ir.Ground:t.include(uS,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(x`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ir.ScreenDerivative:t.vertex.code.add(x`void forwardNormal() {}`);break;default:e.normalType;case Ir.COUNT:}}let zTe=class extends Zwe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=xi()}},BTe=class extends Jwe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=xi(),this.toMapSpace=Yt()}};const RJ={func:Qr.LESS},rF={func:Qr.ALWAYS},Sm={mask:255},VTe={mask:0},Ytt=t=>({function:{func:Qr.NOTEQUAL,ref:t,mask:t},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP}}),Xtt=t=>({function:{func:Qr.ALWAYS,ref:t,mask:t},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.REPLACE}}),T1={function:{func:Qr.ALWAYS,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.ZERO}},s1={function:{func:Qr.ALWAYS,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.REPLACE}},GTe={function:{func:Qr.EQUAL,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP}},jTe={function:{func:Qr.NOTEQUAL,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP}};function HTe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||To(n,Cn))&&o==null&&(i==null||i===1)&&(r==null||r===1)}function G4t({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||To(n,Cn))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const a8=[1,1,.5],$J=[0,.6,.2],Ztt=[0,1,.2];function qTe(t){t.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var Sn;function Jtt(t){switch(t){case"multiply":default:return Sn.Multiply;case"ignore":return Sn.Ignore;case"replace":return Sn.Replace;case"tint":return Sn.Tint}}function WTe(t,e,r){if(t==null||e===Sn.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=we(Math.round(t[3]*iF),0,iF),s=i===0||e===Sn.Tint?0:e===Sn.Replace?Ktt:Qtt;r[0]=we(Math.round(t[0]*Gx),0,Gx),r[1]=we(Math.round(t[1]*Gx),0,Gx),r[2]=we(Math.round(t[2]*Gx),0,Gx),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Sn||(Sn={}));const Gx=255,iF=85,Ktt=iF,Qtt=2*iF;function YTe(t){t.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(Sn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(Sn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(Sn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(Sn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let $R=class extends ps{constructor(e,r){super(e,"int",Rr.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};function XTe(t,e){e.hasSymbolColors?(t.include(YTe),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new $R("colorMixMode",r=>W2e[r.colorMixMode])),t.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function px(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function ZTe(t){t.code.add(x`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function h0(t,e){switch(e.output){case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:t.fragment.include(ZTe),t.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case k.LinearDepth:t.fragment.include(Yh),t.fragment.code.add(x`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function ert(t){t.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(xo)}) { discard; } }
  `)}let lw=class extends ps{constructor(e,r){super(e,"float",Rr.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function cw(t,e){JTe(t,e,new Ie("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function trt(t,e){JTe(t,e,new lw("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function JTe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==gi.Mask&&e.alphaDiscardMode!==gi.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case gi.Blend:return t.include(ert);case gi.Opaque:i.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case gi.Mask:i.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case gi.MaskBlend:t.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function KTe(t,e){const{vertex:r,fragment:i}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==gi.Opaque;switch(e.output){case k.LinearDepth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:case k.ObjectAndLayerIdColor:Sc(r,e),t.include(Ol,e),t.include(om,e),t.include(Yg,e),t.include(h0,e),t.include(Rs,e),t.include(lC,e),zw(t),t.varyings.add("depth","float"),s&&i.uniforms.add(new at("tex",n=>n.texture)),r.code.add(x`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(cw,e),i.code.add(x`
          void main(void) {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:x`outputDepth(depth);`}
          }
        `);break;case k.Normal:{Sc(r,e),t.include(Ol,e),t.include(cC,e),t.include(o8,e),t.include(om,e),t.include(Yg,e),s&&i.uniforms.add(new at("tex",o=>o.texture)),e.normalType===Ir.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===Ir.Attribute||e.normalType===Ir.Compressed;r.code.add(x`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?x`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:x`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Rs,e),t.include(cw,e),i.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ir.ScreenDerivative?x`vec3 normal = screenDerivativeNormal(vPositionView);`:x`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case k.Highlight:Sc(r,e),t.include(Ol,e),t.include(om,e),t.include(Yg,e),s&&i.uniforms.add(new at("tex",n=>n.texture)),r.code.add(x`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Rs,e),t.include(cw,e),t.include(w1,e),i.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${s?x`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function QTe(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===ds.WindingOrder?r.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==rs.None&&(t.include(TZ,e),r.uniforms.add(e.pbrTextureBindType===Rr.Pass?new at("normalTexture",i=>i.textureNormal):new Ch("normalTexture",i=>i.textureNormal)),e.hasNormalTextureTransform&&(r.uniforms.add(new ni("scale",i=>i.scale??Y6)),r.uniforms.add(new Mu("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??Qw))),r.code.add(x`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&r.code.add(x`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),r.code.add(x`return tangentSpace * rawNormal;
}`))}const eSe=3e5,TN=5e5;let tSe=class extends ps{constructor(e,r){super(e,"vec2",Rr.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const G9=4;function rSe(){const t=new Or,e=t.fragment;t.include(Ta);const r=(G9+1)/2,i=1/(2*r*r);return e.include(zbe),e.uniforms.add(new at("depthMap",s=>s.depthTexture),new Ch("tex",s=>s.colorTexture),new tSe("blurSize",s=>s.blurSize),new Ie("projScale",(s,n)=>{const o=$i(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new ni("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(x`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${x.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(x`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${x.int(G9)}; r <= ${x.int(G9)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const rrt=Object.freeze(Object.defineProperty({__proto__:null,build:rSe},Symbol.toStringTag,{value:"Module"}));let iSe=class sSe extends Gr{initializeProgram(e){return new Dr(e.rctx,sSe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};iSe.shader=new Lr(rrt,()=>me(()=>Promise.resolve().then(()=>cAt),void 0));const irt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let srt=class extends Ci{constructor(){super(...arguments),this.projScale=1}},nrt=class extends srt{constructor(){super(...arguments),this.intensity=1}},ort=class extends Ci{},art=class extends ort{constructor(){super(...arguments),this.blurSize=je()}};function l8(t){t.fragment.uniforms.add(new wr("projInfo",(e,r)=>lrt(r.camera))),t.fragment.uniforms.add(new ni("zScale",(e,r)=>crt(r.camera))),t.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function lrt(t){const e=t.projectionMatrix;return e[11]===0?es(toe,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):es(toe,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const toe=Yt();function crt(t){return t.projectionMatrix[11]===0?cr(roe,0,1):cr(roe,1,0)}const roe=je(),ioe=16;function nSe(){const t=new Or,e=t.fragment;return t.include(Ta),t.include(l8),e.include(zbe),e.uniforms.add(new Ie("radius",(r,i)=>c8(i.camera))),e.code.add(x`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new ni("nearFar",(r,i)=>i.camera.nearFar),new at("normalMap",r=>r.normalTexture),new at("depthMap",r=>r.depthTexture),new Ie("projScale",r=>r.projScale),new at("rnm",r=>r.noiseTexture),new ni("rnmScale",(r,i)=>cr(soe,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ie("intensity",r=>r.intensity),new ni("screenSize",(r,i)=>cr(soe,i.camera.fullWidth,i.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(x`
    void main(void) {
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${x.int(ioe)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${x.int(ioe)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function c8(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const soe=je(),urt=Object.freeze(Object.defineProperty({__proto__:null,build:nSe,getRadius:c8},Symbol.toStringTag,{value:"Module"}));let oSe=class aSe extends Gr{initializeProgram(e){return new Dr(e.rctx,aSe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};oSe.shader=new Lr(urt,()=>me(()=>Promise.resolve().then(()=>uAt),void 0));const RA=2;let $A=class extends ux{constructor(e){super(e),this._context=null,this._passParameters=new nrt,this._drawParameters=new art,this.produces=new Map([[ue.SSAO,()=>this._produces()]])}_getCameraElevation(){var e;return((e=this._context)==null?void 0:e.renderContext.bindParameters.camera.relativeElevation)??1/0}_produces(){return this._enableTime!=null&&this._context!=null&&this._getCameraElevation()<TN}consumes(){return this._produces()?UXe:Gk}initializeRenderContext(e){this._context=e,this.addHandles([he(()=>{var r;return this.view.qualitySettings.ambientOcclusion||((r=this._context)==null?void 0:r.isFeatureEnabled(xn.SSAO))},r=>r?this._enable():this._disable(),si)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=ft(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){var i;if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(irt),s=>s.charCodeAt(0)),r=new oi;r.wrapMode=Xt.CLAMP_TO_EDGE,r.pixelFormat=wt.RGB,r.wrapMode=Xt.REPEAT,r.hasMipmap=!0,r.width=32,r.height=32,this._passParameters.noiseTexture=new Sr(this._context.renderContext.rctx,r,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(oSe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(iSe)),this._enableTime=0,(i=this._context)==null||i.requestRender()}renderNode(e,r,i){const s=e.bindParameters,n=i==null?void 0:i.get("normals"),o=n==null?void 0:n.getTexture(),a=n==null?void 0:n.getTexture(uE);if(this._enableTime==null||this._context==null||!o||!a)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const l=e.rctx,c=s.camera,u=this.view.qualitySettings.fadeDuration,h=c.relativeElevation,p=we((TN-h)/(TN-eSe),0,1),f=u>0?Math.min(u,e.time-this._enableTime)/u:1,g=f*p;this._passParameters.normalTexture=o,this._passParameters.depthTexture=a,this._passParameters.projScale=1/c.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*hrt/c8(c)**6*g;const _=c.fullViewport[2],v=c.fullViewport[3],b=Math.round(_/RA),w=Math.round(v/RA),T=this._context.fbos,S=T.acquire(_,v,"ssao input",ji.RG);l.unbindTexture(S.fbo.colorTexture),l.bindFramebuffer(S.fbo),l.setViewport(0,0,_,v),l.bindTechnique(this._ssaoTechnique,s,this._passParameters,this._drawParameters),l.screen.draw();const C=T.acquire(b,w,"ssao blur",ji.RED);l.unbindTexture(C.fbo.colorTexture),l.bindFramebuffer(C.fbo),this._drawParameters.colorTexture=S.getTexture(),cr(this._drawParameters.blurSize,0,RA/v),l.bindTechnique(this._blurTechnique,s,this._passParameters,this._drawParameters),l.setViewport(0,0,b,w),l.screen.draw(),S.release();const P=T.acquire(b,w,"ssao",ji.RED);return l.unbindTexture(P.fbo.colorTexture),l.bindFramebuffer(P.fbo),l.setViewport(0,0,_,v),l.setClearColor(1,1,1,0),l.clear(Si.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=C.getTexture(),cr(this._drawParameters.blurSize,RA/_,0),l.bindTechnique(this._blurTechnique,s,this._passParameters,this._drawParameters),l.setViewport(0,0,b,w),l.screen.draw(),l.setViewport4fv(c.fullViewport),C.release(),f<1&&this._context.requestRender(),P}};d([m({constructOnly:!0})],$A.prototype,"view",void 0),d([m()],$A.prototype,"_context",void 0),$A=d([V("esri.views.3d.webgl-engine.effects.ssao.SSAO")],$A);const hrt=.5;function IR(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new at("ssaoTex",(i,s)=>{var n;return(n=s.ssao)==null?void 0:n.getTexture()})),r.constants.add("blurSizePixelsInverse","float",1/RA),r.code.add(x`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(x`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function drt(t){const e=t.fragment.code;e.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function IJ(t,e){const r=t.fragment.code;t.include(bR),e.pbrMode!==nt.Normal&&e.pbrMode!==nt.Schematic&&e.pbrMode!==nt.Simplified&&e.pbrMode!==nt.TerrainWithWater||(r.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==nt.Normal&&e.pbrMode!==nt.Schematic||(t.include(drt),r.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function prt(t,e){const r=t.fragment.code;t.include(bR),r.add(x`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function LR(t){t.constants.add("ambientBoostFactor","float",Vwe)}function hC(t){t.uniforms.add(new Ie("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function Gw(t,e){const r=t.fragment;switch(t.include(IR,e),e.pbrMode!==nt.Disabled&&t.include(IJ,e),t.include(CZ,e),t.include(bR),r.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===nt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),LR(r),hC(r),w0(r),r.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Om(r),r.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case nt.Disabled:case nt.WaterOnIntegratedMesh:case nt.Water:t.include(E5),r.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case nt.Normal:case nt.Schematic:r.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new am("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ie("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==nt.Schematic||e.hasColorTexture?x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case nt.Simplified:case nt.TerrainWithWater:t.include(E5),r.code.add(x`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case nt.COUNT:}}let frt=class extends ps{constructor(e,r,i){super(e,"mat4",Rr.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},mrt=class extends ps{constructor(e,r,i){super(e,"mat4",Rr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},grt=class extends Ci{constructor(){super(...arguments),this.modelTransformation=ts}},LJ=class extends grt{constructor(){super(...arguments),this.origin=E()}};function DR(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new mrt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),lSe(t))}function bE(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new frt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),lSe(t))}function lSe(t){const e=t.fragment;e.include(ZTe),e.uniforms.add(new at("shadowMap",(r,i)=>i.shadowMap.depthTexture),new $R("numCascades",(r,i)=>i.shadowMap.numCascades),new wr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(x`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function yrt(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new Mu("colorTextureTransformMatrix",r=>r.colorTextureTransformMatrix??Qw)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(x`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardColorUV(){}`)}function _rt(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==rs.None?(t.vertex.uniforms.add(new Mu("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??Qw)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(x`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardNormalUV(){}`)}function vrt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==rs.None?(t.vertex.uniforms.add(new Mu("emissiveTextureTransformMatrix",r=>r.emissiveTextureTransformMatrix??Qw)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(x`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardEmissiveUV(){}`)}function brt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==rs.None?(t.vertex.uniforms.add(new Mu("occlusionTextureTransformMatrix",r=>r.occlusionTextureTransformMatrix??Qw)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(x`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardOcclusionUV(){}`)}function wrt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==rs.None?(t.vertex.uniforms.add(new Mu("metallicRoughnessTextureTransformMatrix",r=>r.metallicRoughnessTextureTransformMatrix??Qw)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(x`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(x`void forwardMetallicRoughnessUV(){}`)}function wO(t){t.include(Lm),t.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(Sn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(Sn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Sn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(Sn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Sn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function cSe(t){const e=new Or,{vertex:r,fragment:i,varyings:s}=e;if(Sc(r,t),e.include(wR),s.add("vpos","vec3"),e.include(Yg,t),e.include(Xwe,t),e.include(F2e,t),e.include(yrt,t),t.output===k.Color||t.output===k.Alpha){e.include(_rt,t),e.include(vrt,t),e.include(brt,t),e.include(wrt,t),Cp(r,t),e.include(cC,t),e.include(Ol,t);const n=t.normalType===Ir.Attribute||t.normalType===Ir.Compressed;n&&t.offsetBackfaces&&e.include(qTe),e.include(QTe,t),e.include(o8,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(om,t),e.include(nC,t),e.include(XTe,t),e.include(px,t),r.uniforms.add(new wr("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),r.code.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(xo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `)}switch(t.output){case k.Alpha:e.include(Rs,t),e.include(cw,t),e.include(Oc,t),i.uniforms.add(new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new at("tex",n=>n.texture)),i.include(wO),i.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case k.Color:e.include(Rs,t),e.include(Gw,t),e.include(IR,t),e.include(cw,t),e.include(t.instancedDoublePrecision?DR:bE,t),e.include(Oc,t),Cp(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Dt("ambient",n=>n.ambient),new Dt("diffuse",n=>n.diffuse),new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new at("tex",n=>n.texture)),e.include(EZ,t),e.include(IJ,t),i.include(wO),e.include(UTe,t),LR(i),hC(i),Om(i),i.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ir.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===nt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?x`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?x`normalUV`:"vuv0"});`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?x`normalize(posWorld);`:x`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===nt.Normal||t.pbrMode===nt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===dt.Color?x`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(KTe,t),e}const xrt=Object.freeze(Object.defineProperty({__proto__:null,build:cSe},Symbol.toStringTag,{value:"Module"}));let Trt=class extends zTe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=la(a8),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Ei.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Pe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ir.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Pe(.2,.2,.2),this.diffuse=Pe(.8,.8,.8),this.externalColor=zt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=E(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=kw.Less,this.textureAlphaMode=gi.Blend,this.textureAlphaCutoff=Q5,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ur.Occlude,this.isDecoration=!1}},Srt=class extends BTe{constructor(){super(...arguments),this.origin=E(),this.slicePlaneLocalOrigin=this.origin}},DJ=class uSe extends Gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?rs.Default:rs.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,uSe.shader)}_initializeProgram(e,r){return new Dr(e.rctx,r.get().build(this.configuration),Mr)}_convertDepthTestFunction(e){return e===kw.Lequal?Qr.LEQUAL:Qr.LESS}_makePipeline(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Nt({blending:i.output!==k.Color&&i.output!==k.Alpha||!i.transparent?null:s?wu:A0(e),culling:Ert(i)?Ok(i.cullFace):null,depthTest:{func:x1(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Mc:null,colorWrite:qt,stencilWrite:i.hasOccludees?Sm:null,stencilTest:i.hasOccludees?r?s1:T1:null,polygonOffset:s||n?null:i8(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Ert(t){return t.cullFace!==Ei.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}DJ.shader=new Lr(xrt,()=>me(()=>Promise.resolve().then(()=>hAt),void 0));let Vt=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.alphaDiscardMode=gi.Opaque,this.doubleSidedMode=ds.None,this.pbrMode=nt.Disabled,this.cullFace=Ei.None,this.transparencyPassType=dt.NONE,this.normalType=Ir.Attribute,this.textureCoordinateType=rs.None,this.customDepthTest=kw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([G({count:k.COUNT})],Vt.prototype,"output",void 0),d([G({count:gi.COUNT})],Vt.prototype,"alphaDiscardMode",void 0),d([G({count:ds.COUNT})],Vt.prototype,"doubleSidedMode",void 0),d([G({count:nt.COUNT})],Vt.prototype,"pbrMode",void 0),d([G({count:Ei.COUNT})],Vt.prototype,"cullFace",void 0),d([G({count:dt.COUNT})],Vt.prototype,"transparencyPassType",void 0),d([G({count:Ir.COUNT})],Vt.prototype,"normalType",void 0),d([G({count:rs.COUNT})],Vt.prototype,"textureCoordinateType",void 0),d([G({count:kw.COUNT})],Vt.prototype,"customDepthTest",void 0),d([G()],Vt.prototype,"spherical",void 0),d([G()],Vt.prototype,"hasVertexColors",void 0),d([G()],Vt.prototype,"hasSymbolColors",void 0),d([G()],Vt.prototype,"hasVerticalOffset",void 0),d([G()],Vt.prototype,"hasSlicePlane",void 0),d([G()],Vt.prototype,"hasSliceHighlight",void 0),d([G()],Vt.prototype,"hasColorTexture",void 0),d([G()],Vt.prototype,"hasMetallicRoughnessTexture",void 0),d([G()],Vt.prototype,"hasEmissionTexture",void 0),d([G()],Vt.prototype,"hasOcclusionTexture",void 0),d([G()],Vt.prototype,"hasNormalTexture",void 0),d([G()],Vt.prototype,"hasScreenSizePerspective",void 0),d([G()],Vt.prototype,"hasVertexTangents",void 0),d([G()],Vt.prototype,"hasOccludees",void 0),d([G()],Vt.prototype,"multipassEnabled",void 0),d([G()],Vt.prototype,"hasModelTransformation",void 0),d([G()],Vt.prototype,"offsetBackfaces",void 0),d([G()],Vt.prototype,"vvSize",void 0),d([G()],Vt.prototype,"vvColor",void 0),d([G()],Vt.prototype,"receiveShadows",void 0),d([G()],Vt.prototype,"receiveAmbientOcclusion",void 0),d([G()],Vt.prototype,"textureAlphaPremultiplied",void 0),d([G()],Vt.prototype,"instanced",void 0),d([G()],Vt.prototype,"instancedColor",void 0),d([G()],Vt.prototype,"objectAndLayerIdColorInstanced",void 0),d([G()],Vt.prototype,"instancedDoublePrecision",void 0),d([G()],Vt.prototype,"doublePrecisionRequiresObfuscation",void 0),d([G()],Vt.prototype,"writeDepth",void 0),d([G()],Vt.prototype,"transparent",void 0),d([G()],Vt.prototype,"enableOffset",void 0),d([G()],Vt.prototype,"cullAboveGround",void 0),d([G()],Vt.prototype,"snowCover",void 0),d([G()],Vt.prototype,"hasColorTextureTransform",void 0),d([G()],Vt.prototype,"hasEmissionTextureTransform",void 0),d([G()],Vt.prototype,"hasNormalTextureTransform",void 0),d([G()],Vt.prototype,"hasOcclusionTextureTransform",void 0),d([G()],Vt.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([G({constValue:!1})],Vt.prototype,"occlusionPass",void 0),d([G({constValue:!0})],Vt.prototype,"hasVvInstancing",void 0),d([G({constValue:!1})],Vt.prototype,"useCustomDTRExponentForWater",void 0),d([G({constValue:!1})],Vt.prototype,"supportsTextureAtlas",void 0),d([G({constValue:!0})],Vt.prototype,"useFillLights",void 0);function hSe(t){const e=new Or,{vertex:r,fragment:i,varyings:s}=e;return Sc(r,t),e.include(wR),s.add("vpos","vec3"),e.include(Yg,t),e.include(Xwe,t),e.include(F2e,t),t.output!==k.Color&&t.output!==k.Alpha||(Cp(e.vertex,t),e.include(cC,t),e.include(Ol,t),t.offsetBackfaces&&e.include(qTe),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(om,t),e.include(nC,t),e.include(XTe,t),e.include(px,t),r.uniforms.add(new wr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(xo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===k.Alpha&&(e.include(Rs,t),e.include(cw,t),e.include(Oc,t),i.uniforms.add(new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new at("tex",n=>n.texture)),i.include(wO),i.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?x`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===k.Color&&(e.include(Rs,t),e.include(Gw,t),e.include(IR,t),e.include(cw,t),e.include(t.instancedDoublePrecision?DR:bE,t),e.include(Oc,t),Cp(e.fragment,t),w0(i),LR(i),hC(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Dt("ambient",n=>n.ambient),new Dt("diffuse",n=>n.diffuse),new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new at("tex",n=>n.texture)),e.include(EZ,t),e.include(IJ,t),i.include(wO),Om(i),i.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?x`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===nt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===nt.Normal||t.pbrMode===nt.Schematic?t.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${t.pbrMode===nt.Normal||t.pbrMode===nt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===dt.Color?x`fragColor = premultiplyAlpha(fragColor);`:x``}
      }
    `)),e.include(KTe,t),e}const Crt=Object.freeze(Object.defineProperty({__proto__:null,build:hSe},Symbol.toStringTag,{value:"Module"}));let dSe=class pSe extends DJ{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ir.Attribute,r.doubleSidedMode=ds.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,pSe.shader)}};dSe.shader=new Lr(Crt,()=>me(()=>Promise.resolve().then(()=>dAt),void 0));let Pp=class extends b1{constructor(e){super(e,Mrt),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>(JP(r)||cS(r))&&!this.parameters.transparent],[ue.TRANSPARENT_MATERIAL,r=>(JP(r)||cS(r))&&this.parameters.transparent&&this.parameters.writeDepth],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(JP(r)||cS(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new Vt,this._vertexBufferLayout=Ort(this.parameters)}isVisibleForOutput(e){return e!==k.Shadow&&e!==k.ShadowExcludeHighlight&&e!==k.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Ei.None:this.parameters.cullFace,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==k.Color&&e!==k.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ds.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ds.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ds.WindingOrder:ds.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&r.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?nt.Schematic:nt.Normal:nt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<t8,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;te(H9,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Ne.Global:l=fe(noe,H9);break;case Ne.Local:l=ce(noe,Irt)}let c=0;const u=ye(Lrt,H9,a.eye),h=Se(u),p=re(u,u,1/h);let f=null;this.parameters.screenSizePerspective&&(f=de(l,p)),c+=H2e(a,h,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective),re(l,l,c),Bo(j9,l,i.transform.inverseRotation),s=ye(Rrt,s,j9),n=ye($rt,n,j9)}B2e(e,i,s,n,$G(i.verticalOffset),o)}createGLMaterial(e){return new Art(e)}createBufferWriter(){return new uC(this._vertexBufferLayout)}},Art=class extends SZ{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==k.Color&&this._output!==k.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return te(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?dSe:DJ,e)}},Prt=class extends Trt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Mrt=new Prt;function Ort(t){const e=Yi().vec3f(O.POSITION);return t.normalType===Ir.Compressed?e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(O.NORMAL),t.hasVertexTangents&&e.vec4f(O.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const Rrt=E(),$rt=E(),Irt=Pe(0,0,1),noe=E(),j9=E(),H9=E(),Lrt=E(),fSe=new OJ({});function l5t(t){return t.type==="web-style"?fSe:NJ(t.symbolLayers.toArray().map(e=>mSe(t,e)))}function NJ(t){let e=0,r=0,i=0,s=!1,n=0;const o=new FTe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new ktt(n,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o}):new Ftt(n,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o})}function c5t(t){const e=NJ(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const q9={};function mSe(t,e){var s,n;const r=gSe(t,e),i=Btt(e)?2:0;switch(e.type){case"extrude":return new lh({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:i,memory:r});case"fill":if(t.type==="mesh-3d")return new lh({drawCallsPerFeature:i,memory:r});if(e.outline!=null&&e.outline.size>0)return new lh({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new lh({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new lh({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return(s=e.resource)!=null&&s.href?new OJ({verticesPerFeature:100,memory:r}):{...Drt(((n=e.resource)==null?void 0:n.primitive)??Nve),memory:r};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=$Te;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":a=RTe;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let h=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":h+=2*(o-1);break;case"round":h+=2*(o*(iq-1)*2+o);break;default:return}return new lh({verticesPerFeature:h,verticesPerCoordinate:u,memory:r})}case"text":case"icon":return new lh({verticesPerFeature:6,memory:r});default:return}}function gSe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?il.EXTRUDE_EDGES:il.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?il.FILL_OUTLINE:il.FILL;case"water":return il.FILL;case"line":return e.join==="round"?il.LINE_ROUND:il.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return il.PATH_ROUND_CIRCLE;case"quad":return il.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return il.PATH_MITER_CIRCLE;case"quad":return il.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?il.OBJECT_POINT:il.OBJECT_POLYGON;case"icon":case"text":return r?il.ICON_POINT:il.ICON_POLYGON;default:return}}function Drt(t){const e=q9[t];if(e)return e;const r=ySe(NTe(t,new Pp({})).levels);return q9[t]=new lh({verticesPerFeature:r}),q9[t]}function ySe(t){return t.reduce((e,r,i)=>e+r.numVertices*(1/10**i),0)/t.reduce((e,r,i)=>e+1/10**i,0)}const il={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var zs;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(zs||(zs={}));let FJ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=nu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===nu.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===nu.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=nu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=nu.FAILED,!ns(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Ja(this._abortController):this._loadStatus===nu.LOADING&&(this._loadStatus=nu.FAILED),this._loader=null}};var nu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(nu||(nu={}));const jx=()=>ae.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Nm=class extends FJ{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=jx(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new tF,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=ooe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=ooe(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&jx().warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(jx().warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(jx().warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return jx().warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Nrt}_defaultElevationInfoZ(){return Frt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r=new tF){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?Ptt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=aoe){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=aoe){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return sM(null,i);const s=e!=null?Fe.toUnitRGB(e):kg;return sM(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=sM(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return mSe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==bs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=bs.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=bs.RECREATE}),s}applyRendererDiff(e,r){return zs.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?gp(r.size.field,e):0,s=r.color?gp(r.color.field,e):0,n=r.opacity?gp(r.opacity.field,e):0;return zt(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&jx().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,s,n,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function ooe(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Nrt={mode:"on-the-ground",offset:0,unit:"meters"},Frt={mode:"absolute-height",offset:0,unit:"meters"},aoe={hasIntrinsicColor:!1};let P0=class extends SR{get geometries(){return this._geometries}get transformation(){return this._transformation??ts}set transformation(e){this._transformation=Bs(this._transformation??xe(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Bs(this._shaderTransformation??xe(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=vs.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new _Se),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){ht(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("geometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,r,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:r,sync:i}),wqe(r)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new F5(c0.MaskOccludee);for(const r of this._geometries)r.occludees=MH(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=OH(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new F5(c0.Highlight);for(const r of this._geometries)r.highlights=MH(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=OH(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return ri(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=xe()){return ri(r,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new loe,this._validateBoundingVolume(this._bvWorldSpace,nM.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new loe,this._validateBoundingVolume(this._bvObjectSpace,nM.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===nM.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&krt(n,e,i?s.transformation:this.getCombinedShaderTransformation(s))}li(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.transformation:this.getCombinedShaderTransformation(s),a=KS(o);Ge(coe,n.center,o);const l=$i(coe,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},_Se=class{constructor(){this.min=Pe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Pe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},loe=class extends _Se{constructor(){super(...arguments),this.bounds=Vs()}};function krt(t,e,r){const i=t.bbMin,s=t.bbMax;if(W6(r)){const n=te(Urt,r[12],r[13],r[14]);pe(Uc,i,n),pe(od,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Uc[o]),e.max[o]=Math.max(e.max[o],od[o])}else if(Ge(Uc,i,r),To(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Uc[n]),e.max[n]=Math.max(e.max[n],Uc[n]);else{Ge(od,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Uc[n],od[n]),e.max[n]=Math.max(e.max[n],Uc[n],od[n]);for(let n=0;n<3;++n){ce(Uc,i),ce(od,s),Uc[n]=s[n],od[n]=i[n],Ge(Uc,Uc,r),Ge(od,od,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Uc[o],od[o]),e.max[o]=Math.max(e.max[o],Uc[o],od[o])}}}const Urt=E(),Uc=E(),od=E(),coe=E();var nM;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(nM||(nM={}));function kJ(t,e,r,i,s){const n=t.clippingExtent;if(Qa(e,__,t.elevationProvider.spatialReference),n!=null&&!rZ(n,__))return null;Qa(e,__,t.renderCoordsHelper.spatialReference),r.localOrigin=t.localOriginFactory.getOrigin(__);const o=new P0({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:utt(o,e,t.elevationProvider,t.renderCoordsHelper,i)}}function xO(t,e,r){const i=t.elevationContext,s=r.spatialReference;Qa(e,__,s),i.centerPointInElevationSR=m1(__[0],__[1],e.hasZ?__[2]:0,s??null)}function TO(t){switch(t.type){case"point":return t;case"polygon":case"extent":return PJ(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Bme(e,zme(e)/2);return m1(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const __=E();function vSe(){return new Float32Array(2)}function zrt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function ph(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function Brt(t,e){return new Float32Array(t,e,2)}function bSe(){return vSe()}function wSe(){return ph(1,1)}function xSe(){return ph(1,0)}function TSe(){return ph(0,1)}const SSe=bSe(),ESe=wSe(),Vrt=xSe(),Grt=TSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:ESe,UNIT_X:Vrt,UNIT_Y:Grt,ZEROS:SSe,clone:zrt,create:vSe,createView:Brt,fromValues:ph,ones:wSe,unitX:xSe,unitY:TSe,zeros:bSe},Symbol.toStringTag,{value:"Module"}));function CSe(t){const e=new Or,{vertex:r,fragment:i}=e;return r.include(Qk),e.include(z2e,t),e.include(Rs,t),e.attributes.add(O.UV0,"vec2"),r.uniforms.add(new wr("viewport",(s,n)=>n.camera.fullViewport),new Ie("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new ni("pixelToNDC",(s,n)=>cr(hoe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ie("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new ni("screenOffset",(s,n)=>cr(hoe,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(nTe),t.hasScreenSizePerspective&&Kk(r),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?x`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?x`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new wr("uColor",s=>uoe(s.color)),new wr("borderColor",s=>uoe(s.borderColor))),t.multipassEnabled&&(i.include(Owe,t),i.uniforms.add(new ni("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(x`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function uoe(t){return t??_u}const hoe=je(),jrt=Object.freeze(Object.defineProperty({__proto__:null,build:CSe},Symbol.toStringTag,{value:"Module"}));let ASe=class PSe extends Gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Dr(e.rctx,PSe.shader.get().build(this.configuration),Mr)}setPipelineState(e){const r=e?Qr.ALWAYS:Qr.LESS;return this.configuration.depthHudEnabled?Nt({depthTest:{func:r},depthWrite:Mc}):Nt({blending:Po(Ee.ONE,Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:qt})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};ASe.shader=new Lr(jrt,()=>me(()=>Promise.resolve().then(()=>pAt),void 0));let Xu=class extends Za{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};d([G()],Xu.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([G()],Xu.prototype,"spherical",void 0),d([G()],Xu.prototype,"occlusionTestEnabled",void 0),d([G()],Xu.prototype,"hasVerticalOffset",void 0),d([G()],Xu.prototype,"hasScreenSizePerspective",void 0),d([G()],Xu.prototype,"depthHudEnabled",void 0),d([G()],Xu.prototype,"depthHudAlignStartEnabled",void 0),d([G()],Xu.prototype,"hasSlicePlane",void 0),d([G()],Xu.prototype,"multipassEnabled",void 0),d([G({constValue:!0})],Xu.prototype,"hasSliceInVertexProgram",void 0),d([G({constValue:!1})],Xu.prototype,"draped",void 0);let II=class sq extends b1{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new MSe),this.produces=new Map([[ue.LINE_CALLOUTS,r=>r===k.Color],[ue.LINE_CALLOUTS_HUD_DEPTH,r=>r===k.Color]]),this._configuration=new Xu,this._uniqueMaterialIdentifier=sq.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==ue.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new Hrt(e)}createBufferWriter(){return new Wrt}validateParameters(e){const r=sq.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},Hrt=class extends _1{beginSlot(e){return this.ensureTechnique(ASe,e)}},MSe=class extends vJ{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const qrt=Yi().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.CENTEROFFSETANDDISTANCE),doe=[ph(0,0),ph(1,0),ph(0,1),ph(1,0),ph(1,1),ph(0,1)];let Wrt=class{constructor(){this.vertexBufferLayout=qrt}elementCount(e){return 6*e.attributes.get(O.POSITION).indices.length}write(e,r,i,s,n){bJ(i.attributes.get(O.POSITION),e,s.position,n,6),wJ(i.attributes.get(O.NORMAL),r,s.normal,n,6),_E(i.attributes.get(O.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6);for(let o=0;o<doe.length;++o)s.uv0.setVec(n+o,doe[o])}},OSe=class RSe extends Nm{constructor(e,r){super(e,null,r,Xrt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new II(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.horizontalScreenOffset=e.horizontalScreenOffset??0,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){var o;const e=new MSe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?Fe.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=on(i.size||0),r.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=r.verticalOffset;e.verticalOffset={screenLength:on(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=i.border)==null?void 0:o.color)!=null?Fe.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Yrt}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new tF,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Vve(l)))return null;const a=PJ(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=OR(RSe.elevationModeChangeTypes,i,s);return n!==bs.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Gh(r.elevationContext.mode)}computeComplexity(){return new lh({verticesPerFeature:6})}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new qe(r?[r[0],r[1],r[2]]:[0,0,0],W9,3,!0),n=new qe(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],W9,4,!0);return[[O.POSITION,s],[O.NORMAL,new qe([0,0,1],W9,3,!0)],[O.CENTEROFFSETANDDISTANCE,n]]}_getOrCreateMaterial(e){var s;const r=this._perInstanceMaterialParameters(e),i=II.uniqueMaterialIdentifier(r);if(i===((s=this._materials[0])==null?void 0:s.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(i);return n==null&&(n=new II(r),e.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new II(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new un(a.material,this._createVertexData(i),null,vs.Point,o),c=kJ(this._context,e,l,r,s);if(c==null)return null;const u=new Dm(this,c.object,[l],a.isUnique?[a.material]:null,null,aw,r);return u.metadata=new OTe(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=Gh(r.mode),xO(u,e,this._context.elevationProvider),u}};OSe.elevationModeChangeTypes={definedChanged:bs.UPDATE,staysOnTheGround:bs.UPDATE,onTheGroundChanged:bs.RECREATE};const W9=[0],Yrt={mode:"relative-to-ground",offset:0},Xrt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let Zrt=class{constructor(e,r,i=E(),s=Yt(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Jrt=class extends Mtt{};const poe=()=>ae.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Krt(t,e){if(!cZ(t))return poe().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=Qrt[t.callout.type];return r?new r(t,e):(poe().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Qrt={line:OSe},UJ=(t,e,r)=>[e,r],wE=(t,e,r)=>[e,r,t[2]],zJ=(t,e,r)=>[e,r,t[2],t[3]];function w5t(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function eit({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function tit({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function $Se({scale:t,translate:e},r){return r*t[0]+e[0]}function ISe({scale:t,translate:e},r){return e[1]-r*t[1]}function LSe(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=$Se(t,r[0][0]),a=ISe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function DSe(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=LSe(t,e,r[s]);return i}function rit(t,e,r,i){return LSe(t,r?i?zJ:wE:i?wE:UJ,e)}function iit(t,e,r,i){return DSe(t,r?i?zJ:wE:i?wE:UJ,e)}function sit(t,e,r,i){return DSe(t,r?i?zJ:wE:i?wE:UJ,e)}function x5t(t,e,r,i,s){return e.x=eit(t,r.x),e.y=tit(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function NSe(t,e,r,i,s){return r!=null&&(e.points=rit(t,r.points,i,s)),e}function FSe(t,e,r,i,s){return r==null||(e.x=$Se(t,r.x),e.y=ISe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function kSe(t,e,r,i,s){return r!=null&&(e.rings=sit(t,r.rings,i,s)),e}function USe(t,e,r,i,s){return r!=null&&(e.paths=iit(t,r.paths,i,s)),e}let T5t=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function E5t(t){return t.geometry!=null}let C5t=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function P5t(t,e){var u;const r=age.fromJSON(t.geometryType),i=Xe.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(h=>{const p=nit(h,r,i,t.objectIdFieldName),f=p.geometry;if(uit(p.attributes,a,o,g=>{l??(l=[]);const _=cit(p,n);_!=null&&l.push({objectId:_,attribute:g})}),f!=null&&s)switch(f.type){case"point":p.geometry=FSe(s,f,f,f.hasZ,f.hasM);break;case"multipoint":p.geometry=NSe(s,f,f,!!f.hasZ,!!f.hasM);break;case"polygon":p.geometry=kSe(s,f,f,!!f.hasZ,!!f.hasM);break;case"polyline":p.geometry=USe(s,f,f,!!f.hasZ,!!f.hasM);break;case"extent":case"mesh":p.geometry=f}return p});return{geometryType:r,features:c,spatialReference:i,fields:((u=t.fields)==null?void 0:u.map(h=>sbe.fromJSON(h)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function nit(t,e,r,i){return{uid:fu(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:oit(t.geometry,e,r),visible:!0}}function oit(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function ait(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=t0(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function M5t(t){let e=32;return e+=$pe(t.attributes),e+=3,e+=8+ait(t.geometry),e}function O5t(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function R5t(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function $5t(t,e){switch(Ri(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)RU(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)RU(e,t.rings[r],!!t.hasZ);break;case"multipoint":RU(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function lit(t,e){switch(Tu(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)K8(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)K8(e,t.rings[r]);break;case"multipoint":K8(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function cit(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function uit(t,e,r,i){if(e!=null&&e.size&&r!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>r&&(i(s),t[s]="")}}let xE=class nq{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new nq(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var i,s;const e=(i=this.geometry)==null?void 0:i.clone(),r=new nq(e,{...this.attributes},(s=this.centroid)==null?void 0:s.clone(),this.objectId);return r.displayId=this.displayId,r.geohashX=this.geohashX,r.geohashY=this.geohashY,r}};function I5t(t){var e,r;return!!((r=(e=t.geometry)==null?void 0:e.coords)!=null&&r.length)}let hit=class zSe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new zSe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const Y9=2;let jh=class IA{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new IA([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[Y9*(n+r)],this.coords[Y9*(n+r)+1]);r+=s}}deltaDecode(){const e=this.clone(),{coords:r,lengths:i}=e;let s=0;for(const n of i){for(let o=1;o<n;o++)r[2*(s+o)]+=r[2*(s+o)-2],r[2*(s+o)+1]+=r[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new IA([],[this.coords[0],this.coords[1]]);const r=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*Y9,i=this.coords.slice(0,r);return e?(e.set(i),new IA(this.lengths,e,this.hasIndeterminateRingOrder)):new IA(Array.from(this.lengths),Array.from(i),this.hasIndeterminateRingOrder)}};function va(t,e){return t?e?4:3:e?3:2}const NR=()=>ae.getLogger("esri.layers.graphics.featureConversionUtils"),BSe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},dit=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},foe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},pit=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},fit=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function BJ(t,e,r,i){if(t){if(r)return e&&i?fit:foe;if(e&&i)return pit}else if(e&&i)return foe;return dit}function X9({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function Z9({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function J9({scale:t,translate:e},r,i){return r*t[i]+e[i]}function L5t(t,e,r){return t?e?r?jJ(t):VJ(t):r?GJ(t):u8(t):null}function u8(t){const e=t.coords;return{x:e[0],y:e[1]}}function VSe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function VJ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function mit(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function GJ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function git(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function jJ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function yit(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function _it(t,e,r,i){let s=u8;r&&i?s=jJ:r?s=VJ:i&&(s=GJ);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function HJ(t,e){return t&&e?yit:t?mit:e?git:VSe}function vit(t,e,r,i,s){const n=HJ(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new jh,o):null;t.push(new xE(l,a,null,s?a[s]:void 0))}return t}function bit(t,e,r=HJ(e.z!=null,e.m!=null)){return r(t,e)}function wit(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?GSe(s,r,i):null});return t}function GSe(t,e,r){if(t==null)return null;const i=va(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function xit(t,e,r,i,s){const n=va(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?jSe(new jh,o,n):null;t.push(new xE(l,a,null,s?a[s]:void 0))}return t}function jSe(t,e,r=va(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function Tit(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?HSe(s,r,i):null});return t}function HSe(t,e,r){if(!t)return null;const i=va(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(s[a++]);c.push(h)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function Sit(t,e,r,i,s){const n=va(r,i);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?qSe(new jh,o,n):null,u=l!=null?bit(new jh,l):null;t.push(new xE(c,a,u,s?a[s]:void 0))}return t}function qSe(t,e,r=va(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function Eit(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?WSe(s,r,i):null;if(o!=null){const l=u8(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function WSe(t,e,r){if(!t)return null;const i=va(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(s[a++]);c.push(h)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Cit(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?YSe(new jh,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new xE(l,a,VSe(new jh,o),c)):t.push(new xE(l,a,null,c))}return t}function YSe(t,e,r=e.hasZ,i=e.hasM){return Ait(t,e.rings,r,i)}function Ait(t,e,r,i){const s=va(r,i),{lengths:n,coords:o}=t;let a=0;Xg(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const _S=[],oM=[];function D5t(t,e,r,i,s){_S[0]=t;const[n]=XSe(oM,_S,e,r,i,s);return Mp(_S),Mp(oM),n}function XSe(t,e,r,i,s,n){if(Mp(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new xE(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return vit(t,e,i,s,n);case"esriGeometryMultipoint":return xit(t,e,i,s,n);case"esriGeometryPolyline":return Sit(t,e,i,s,n);case"esriGeometryPolygon":return Cit(t,e,i,s,n);default:NR().error("convertToFeatureSet:unknown-geometry",new J(`Unable to parse unknown geometry type '${r}'`)),Mp(t)}return t}function N5t(t,e,r,i){oM[0]=t,ZSe(_S,oM,e,r,i);const s=_S[0];return Mp(_S),Mp(oM),s}function Pit(t,e,r){if(t==null)return null;const i=new jh;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),VS(t)?HJ(e??t.z!=null,r??t.m!=null)(i,t):yc(t)?YSe(i,t,e,r):Zd(t)?qSe(i,t,va(e,r)):Jb(t)?jSe(i,t,va(e,r)):void NR().error("convertFromGeometry:unknown-geometry",new J(`Unable to parse unknown geometry type '${t}'`))}function Mit(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=u8;return r&&i?n=jJ:r?n=VJ:i&&(n=GJ),n(s)}case"esriGeometryMultipoint":return GSe(s,r,i);case"esriGeometryPolyline":return HSe(s,r,i);case"esriGeometryPolygon":return WSe(s,r,i);default:return NR().error("convertToGeometry:unknown-geometry",new J(`Unable to parse unknown geometry type '${e}'`)),null}}function Oit(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function ZSe(t,e,r,i,s){if(Mp(t),r==null)return Oit(t,e);switch(r){case"esriGeometryPoint":return _it(t,e,i,s);case"esriGeometryMultipoint":return wit(t,e,i,s);case"esriGeometryPolyline":return Tit(t,e,i,s);case"esriGeometryPolygon":return Eit(t,e,i,s);default:NR().error("convertToFeatureSet:unknown-geometry",new J(`Unable to parse unknown geometry type '${r}'`))}return t}function F5t(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:p}=t,f={features:ZSe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:Mit(h,p,!1,!1)};return i&&(f.transform=i),c&&(f.exceededTransferLimit=c),n&&(f.hasM=n),o&&(f.hasZ=o),f}function k5t(t,e){const r=new hit,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=t;return h&&(r.fields=h),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&XSe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),u&&(r.transform=u),r):(NR().error(new J("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function U5t(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&goe(n.geometry,n.geometry,i,s,e),n.centroid!=null&&goe(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function z5t(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new jh,moe(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new jh,moe(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function moe(t,e,r,i,s,n,o=r,a=i){if(Xg(t),!(e!=null&&e.coords.length))return null;const l=BSe[s],{coords:c,lengths:u}=e,h=va(r,i),p=va(r&&o,i&&a),f=BJ(r,i,o,a);if(!u.length)return f(t.coords,c,0,0,X9(n,c[0]),Z9(n,c[1])),Xg(t,h,0),t;let g,_,v,b,w=0,T=0,S=T;for(const C of u){if(C<l)continue;let P=0;T=S,v=g=X9(n,c[w]),b=_=Z9(n,c[w+1]),f(t.coords,c,T,w,v,b),P++,w+=h,T+=p;for(let R=1;R<C;R++,w+=h)v=X9(n,c[w]),b=Z9(n,c[w+1]),v===g&&b===_||(f(t.coords,c,T,w,v-g,b-_),T+=p,P++,g=v,_=b);P>=l&&(t.lengths.push(P),S=T)}return Mp(t.coords,S),t.coords.length?t:null}function B5t(t,e,r,i,s,n,o=r,a=i){if(Xg(t),!(e!=null&&e.coords.length))return null;const l=BSe[s],{coords:c,lengths:u}=e,h=va(r,i),p=va(r&&o,i&&a),f=BJ(r,i,o,a);if(!u.length)return f(t.coords,c,0,0,c[0],c[1]),Xg(t,h,0),t;let g=0;const _=n*n;for(const v of u){if(v<l){g+=v*h;continue}const b=t.coords.length/p,w=g,T=g+(v-1)*h;f(t.coords,c,t.coords.length,w,c[w],c[w+1]),oq(t.coords,c,h,_,f,w,T),f(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/p-b;S>=l?t.lengths.push(S):Mp(t.coords,b*p),g+=v*h}return t.coords.length?t:null}function Rit(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,h=a,p=l-u,f=c-h;if(p!==0||f!==0){const g=((s-u)*p+(n-h)*f)/(p*p+f*f);g>1?(u=l,h=c):g>0&&(u+=p*g,h+=f*g)}return p=s-u,f=n-h,p*p+f*f}function oq(t,e,r,i,s,n,o){let a,l=i,c=0;for(let u=n+r;u<o;u+=r)a=Rit(e,u,n,o),a>l&&(c=u,l=a);l>i&&(c-n>r&&oq(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&oq(t,e,r,i,s,c,o))}function V5t(t,e,r,i){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const s=va(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let h=0;h<u.length;h+=s){const p=u[h],f=u[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return P7(t)?aje(t,n,o,a,l):QO(n,o,a,l,t),t}function goe(t,e,r,i,s){const{coords:n,lengths:o}=e,a=va(r,i);if(!n.length)return t!==e&&Xg(t),t;l6(s);const{originPosition:l,scale:c,translate:u}=s,h=Iit;h.originPosition=l;const p=h.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const f=h.translate;if(f[0]=u[0]??0,f[1]=u[1]??0,f[2]=u[2]??0,f[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=J9(h,n[_],_);return t!==e&&Xg(t,a,0),t}let g=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[g+T]=J9(h,n[g+T],T);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let T=1;T<v;T++,g+=a){b+=n[g]*p[0],w+=n[g+1]*p[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=J9(h,n[g+S],S)}}return t!==e&&Xg(t,n.length,o.length),t}function G5t(t,e,r,i,s,n){if(Xg(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=va(r,i),a=BJ(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function $it(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function j5t(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=$it(r,s,a,e),s+=a}return Math.abs(n)}function Xg(t,e=0,r=0){Mp(t.lengths,r),Mp(t.coords,e)}function Mp(t,e=0){t.length!==e&&(t.length=e)}const Iit={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},yoe=new qo(Array,t=>bk(t,Ove),null,10,5),Lit=jt();let Dit=class{get labelLayers(){return this._labelLayers||G$e}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Vo.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?CTe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(no.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=no.GRAPHIC,r){const i=r?this._visibleFlags|r|no.LABEL*r:this._visibleFlags;return e===no.GRAPHIC?(i&Vo.ALL_GRAPHIC)===Vo.ALL_GRAPHIC:(i&Vo.ALL_LABEL)===Vo.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===no.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(no.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=jt(),lit(r,this._extent);const i=r.spatialReference;if(!co(i,e)&&!G6(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=bp.fromExtent(s.type==="mesh"?s.extent:s)),Pit(s,r,i)}get usedMemory(){let e=$pe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>e+=r.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:E(),num:0},draped:{origin:je(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&re(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&_c(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Ri(n.boundingBox):n.boundingBox=Ri(),n.requiresDrapedElevation=!1,await $6(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=yoe.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&aE(n.boundingBox,l),yoe.release(l)}),nje(n.boundingBox)||JV(iZ(n.boundingBox,Lit))?n:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},q5t=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},Nit=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var _oe,voe,boe,JSe={exports:{}};_oe=JSe,voe=function(){function t(I,N,B){B=B||2;var H,q,Q,ie,_e,Oe,gt,It=N&&N.length,xt=It?N[0]*B:I.length,ct=e(I,0,xt,B,!0),Qe=[];if(!ct||ct.next===ct.prev)return Qe;if(It&&(ct=l(I,N,ct,B)),I.length>80*B){H=Q=I[0],q=ie=I[1];for(var Ve=B;Ve<xt;Ve+=B)(_e=I[Ve])<H&&(H=_e),(Oe=I[Ve+1])<q&&(q=Oe),_e>Q&&(Q=_e),Oe>ie&&(ie=Oe);gt=(gt=Math.max(Q-H,ie-q))!==0?1/gt:0}return i(ct,Qe,B,H,q,gt),Qe}function e(I,N,B,H,q){var Q,ie;if(q===le(I,N,B,H)>0)for(Q=N;Q<B;Q+=H)ie=Z(Q,I[Q],I[Q+1],ie);else for(Q=B-H;Q>=N;Q-=H)ie=Z(Q,I[Q],I[Q+1],ie);if(ie&&C(ie,ie.next)){var _e=ie.next;W(ie),ie=_e}return ie}function r(I,N){if(!I)return I;N||(N=I);var B,H=I;do if(B=!1,H.steiner||!C(H,H.next)&&S(H.prev,H,H.next)!==0)H=H.next;else{var q=H.prev;if(W(H),(H=N=q)===H.next)break;B=!0}while(B||H!==N);return N}function i(I,N,B,H,q,Q,ie){if(I){!ie&&Q&&g(I,H,q,Q);for(var _e,Oe,gt=I;I.prev!==I.next;)if(_e=I.prev,Oe=I.next,Q?n(I,H,q,Q):s(I))N.push(_e.i/B),N.push(I.i/B),N.push(Oe.i/B),W(I),I=Oe.next,gt=Oe.next;else if((I=Oe)===gt){ie?ie===1?i(I=o(r(I),N,B),N,B,H,q,Q,2):ie===2&&a(I,N,B,H,q,Q):i(r(I),N,B,H,q,Q,1);break}}}function s(I){var N=I.prev,B=I,H=I.next;if(S(N,B,H)>=0)return!1;for(var q=I.next.next;q!==I.prev;){if(w(N.x,N.y,B.x,B.y,H.x,H.y,q.x,q.y)&&S(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function n(I,N,B,H){var q=I.prev,Q=I,ie=I.next;if(S(q,Q,ie)>=0)return!1;for(var _e=q.x<Q.x?q.x<ie.x?q.x:ie.x:Q.x<ie.x?Q.x:ie.x,Oe=q.y<Q.y?q.y<ie.y?q.y:ie.y:Q.y<ie.y?Q.y:ie.y,gt=q.x>Q.x?q.x>ie.x?q.x:ie.x:Q.x>ie.x?Q.x:ie.x,It=q.y>Q.y?q.y>ie.y?q.y:ie.y:Q.y>ie.y?Q.y:ie.y,xt=v(_e,Oe,N,B,H),ct=v(gt,It,N,B,H),Qe=I.prevZ,Ve=I.nextZ;Qe&&Qe.z>=xt&&Ve&&Ve.z<=ct;){if(Qe!==I.prev&&Qe!==I.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Qe.x,Qe.y)&&S(Qe.prev,Qe,Qe.next)>=0||(Qe=Qe.prevZ,Ve!==I.prev&&Ve!==I.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Ve.x,Ve.y)&&S(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Qe&&Qe.z>=xt;){if(Qe!==I.prev&&Qe!==I.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Qe.x,Qe.y)&&S(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.prevZ}for(;Ve&&Ve.z<=ct;){if(Ve!==I.prev&&Ve!==I.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Ve.x,Ve.y)&&S(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function o(I,N,B){var H=I;do{var q=H.prev,Q=H.next.next;!C(q,Q)&&P(q,H,H.next,Q)&&U(q,Q)&&U(Q,q)&&(N.push(q.i/B),N.push(H.i/B),N.push(Q.i/B),W(H),W(H.next),H=I=Q),H=H.next}while(H!==I);return r(H)}function a(I,N,B,H,q,Q){var ie=I;do{for(var _e=ie.next.next;_e!==ie.prev;){if(ie.i!==_e.i&&T(ie,_e)){var Oe=z(ie,_e);return ie=r(ie,ie.next),Oe=r(Oe,Oe.next),i(ie,N,B,H,q,Q),void i(Oe,N,B,H,q,Q)}_e=_e.next}ie=ie.next}while(ie!==I)}function l(I,N,B,H){var q,Q,ie,_e=[];for(q=0,Q=N.length;q<Q;q++)(ie=e(I,N[q]*H,q<Q-1?N[q+1]*H:I.length,H,!1))===ie.next&&(ie.steiner=!0),_e.push(b(ie));for(_e.sort(c),q=0;q<_e.length;q++)B=r(B=h(_e[q],B),B.next);return B}function c(I,N){return I.x-N.x}function u(I){if(I.next.prev===I)return I;let N=I;for(;;){const B=N.next;if(B.prev===N||B===N||B===I)break;N=B}return N}function h(I,N){var B=p(I,N);if(!B)return N;var H=z(B,I),q=r(B,B.next);let Q=u(H);return r(Q,Q.next),q=u(q),u(N===B?q:N)}function p(I,N){var B,H=N,q=I.x,Q=I.y,ie=-1/0;do{if(Q<=H.y&&Q>=H.next.y&&H.next.y!==H.y){var _e=H.x+(Q-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(_e<=q&&_e>ie){if(ie=_e,_e===q){if(Q===H.y)return H;if(Q===H.next.y)return H.next}B=H.x<H.next.x?H:H.next}}H=H.next}while(H!==N);if(!B)return null;if(q===ie)return B;var Oe,gt=B,It=B.x,xt=B.y,ct=1/0;H=B;do q>=H.x&&H.x>=It&&q!==H.x&&w(Q<xt?q:ie,Q,It,xt,Q<xt?ie:q,Q,H.x,H.y)&&(Oe=Math.abs(Q-H.y)/(q-H.x),U(H,I)&&(Oe<ct||Oe===ct&&(H.x>B.x||H.x===B.x&&f(B,H)))&&(B=H,ct=Oe)),H=H.next;while(H!==gt);return B}function f(I,N){return S(I.prev,I,N.prev)<0&&S(N.next,I,I.next)<0}function g(I,N,B,H){var q=I;do q.z===null&&(q.z=v(q.x,q.y,N,B,H)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==I);q.prevZ.nextZ=null,q.prevZ=null,_(q)}function _(I){var N,B,H,q,Q,ie,_e,Oe,gt=1;do{for(B=I,I=null,Q=null,ie=0;B;){for(ie++,H=B,_e=0,N=0;N<gt&&(_e++,H=H.nextZ);N++);for(Oe=gt;_e>0||Oe>0&&H;)_e!==0&&(Oe===0||!H||B.z<=H.z)?(q=B,B=B.nextZ,_e--):(q=H,H=H.nextZ,Oe--),Q?Q.nextZ=q:I=q,q.prevZ=Q,Q=q;B=H}Q.nextZ=null,gt*=2}while(ie>1);return I}function v(I,N,B,H,q){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-B)*q)|I<<8))|I<<4))|I<<2))|I<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-H)*q)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function b(I){var N=I,B=I;do(N.x<B.x||N.x===B.x&&N.y<B.y)&&(B=N),N=N.next;while(N!==I);return B}function w(I,N,B,H,q,Q,ie,_e){return(q-ie)*(N-_e)-(I-ie)*(Q-_e)>=0&&(I-ie)*(H-_e)-(B-ie)*(N-_e)>=0&&(B-ie)*(Q-_e)-(q-ie)*(H-_e)>=0}function T(I,N){return I.next.i!==N.i&&I.prev.i!==N.i&&!F(I,N)&&(U(I,N)&&U(N,I)&&j(I,N)&&(S(I.prev,I,N.prev)||S(I,N.prev,N))||C(I,N)&&S(I.prev,I,I.next)>0&&S(N.prev,N,N.next)>0)}function S(I,N,B){return(N.y-I.y)*(B.x-N.x)-(N.x-I.x)*(B.y-N.y)}function C(I,N){return I.x===N.x&&I.y===N.y}function P(I,N,B,H){var q=L(S(I,N,B)),Q=L(S(I,N,H)),ie=L(S(B,H,I)),_e=L(S(B,H,N));return q!==Q&&ie!==_e||!(q!==0||!R(I,B,N))||!(Q!==0||!R(I,H,N))||!(ie!==0||!R(B,I,H))||!(_e!==0||!R(B,N,H))}function R(I,N,B){return N.x<=Math.max(I.x,B.x)&&N.x>=Math.min(I.x,B.x)&&N.y<=Math.max(I.y,B.y)&&N.y>=Math.min(I.y,B.y)}function L(I){return I>0?1:I<0?-1:0}function F(I,N){var B=I;do{if(B.i!==I.i&&B.next.i!==I.i&&B.i!==N.i&&B.next.i!==N.i&&P(B,B.next,I,N))return!0;B=B.next}while(B!==I);return!1}function U(I,N){return S(I.prev,I,I.next)<0?S(I,N,I.next)>=0&&S(I,I.prev,N)>=0:S(I,N,I.prev)<0||S(I,I.next,N)<0}function j(I,N){var B=I,H=!1,q=(I.x+N.x)/2,Q=(I.y+N.y)/2;do B.y>Q!=B.next.y>Q&&B.next.y!==B.y&&q<(B.next.x-B.x)*(Q-B.y)/(B.next.y-B.y)+B.x&&(H=!H),B=B.next;while(B!==I);return H}function z(I,N){var B=new Y(I.i,I.x,I.y),H=new Y(N.i,N.x,N.y),q=I.next,Q=N.prev;return I.next=N,N.prev=I,B.next=q,q.prev=B,H.next=B,B.prev=H,Q.next=H,H.prev=Q,H}function Z(I,N,B,H){var q=new Y(I,N,B);return H?(q.next=H.next,q.prev=H,H.next.prev=q,H.next=q):(q.prev=q,q.next=q),q}function W(I){I.next.prev=I.prev,I.prev.next=I.next,I.prevZ&&(I.prevZ.nextZ=I.nextZ),I.nextZ&&(I.nextZ.prevZ=I.prevZ)}function Y(I,N,B){this.i=I,this.x=N,this.y=B,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function le(I,N,B,H){for(var q=0,Q=N,ie=B-H;Q<B;Q+=H)q+=(I[ie]-I[Q])*(I[Q+1]+I[ie+1]),ie=Q;return q}return t.deviation=function(I,N,B,H){var q=N&&N.length,Q=q?N[0]*B:I.length,ie=Math.abs(le(I,0,Q,B));if(q)for(var _e=0,Oe=N.length;_e<Oe;_e++){var gt=N[_e]*B,It=_e<Oe-1?N[_e+1]*B:I.length;ie-=Math.abs(le(I,gt,It,B))}var xt=0;for(_e=0;_e<H.length;_e+=3){var ct=H[_e]*B,Qe=H[_e+1]*B,Ve=H[_e+2]*B;xt+=Math.abs((I[ct]-I[Ve])*(I[Qe+1]-I[ct+1])-(I[ct]-I[Qe])*(I[Ve+1]-I[ct+1]))}return ie===0&&xt===0?0:Math.abs((xt-ie)/ie)},t.flatten=function(I){for(var N=I[0][0].length,B={vertices:[],holes:[],dimensions:N},H=0,q=0;q<I.length;q++){for(var Q=0;Q<I[q].length;Q++)for(var ie=0;ie<N;ie++)B.vertices.push(I[q][Q][ie]);q>0&&(H+=I[q-1].length,B.holes.push(H))}return B},t},(boe=voe())!==void 0&&(_oe.exports=boe);const TE=ER(JSe.exports),qJ=()=>ae.getLogger("esri.views.3d.support.buffer.math");function Fit(t,e,r){Op(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Op(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],h=r[6],p=r[8],f=r[9],g=r[10],_=r[12],v=r[13],b=r[14];let w=0,T=0;for(let S=0;S<n;S++){const C=e[w],P=e[w+1],R=e[w+2];t[T]=o*C+c*P+p*R+_,t[T+1]=a*C+u*P+f*R+v,t[T+2]=l*C+h*P+g*R+b,w+=s,T+=i}return t}function KSe(t,e,r){Rp(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Rp(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void qJ().error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],p=r[6],f=r[7],g=r[8];let _=0,v=0;for(let b=0;b<n;b++){const w=e[_],T=e[_+1],S=e[_+2];t[v]=o*w+c*T+p*S,t[v+1]=a*w+u*T+f*S,t[v+2]=l*w+h*T+g*S,_+=s,v+=i}}function kit(t,e,r){sF(t.typedBuffer,e,r,t.typedBufferStride)}function sF(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function WJ(t,e,r,i=3,s=i){const n=t.length/i;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+r[0],t[a+1]=e[o+1]+r[1],t[a+2]=e[o+2]+r[2],o+=s,a+=i;return t}function Uit(t,e){h8(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function h8(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],h=l*l+c*c+u*u;if(h>0){const p=1/Math.sqrt(h);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}n+=i,o+=r}}function zit(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:h8,normalizeView:Uit,scale:sF,scaleView:kit,shiftRight:zit,transformMat3:Rp,transformMat3View:KSe,transformMat4:Op,transformMat4View:Fit,translate:WJ},Symbol.toStringTag,{value:"Module"}));function Bit(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function woe(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}var Zg,aa;function Vit(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function SO(t){return t!=null&&!isNaN(t)&&isFinite(t)}function Git(t){return t.valueExpression?Zg.Expression:t.field&&typeof t.field=="string"?Zg.Field:Zg.Unknown}function X5t(t,e){const r=e||Git(t),i=t.valueUnit||"unknown";return r===Zg.Unknown?aa.Constant:t.stops?aa.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?aa.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?aa.Proportional:aa.Additive:aa.Identity:aa.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(Zg||(Zg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(aa||(aa={}));const n1=()=>ae.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),xoe=new W_,SN=Math.PI,jit=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function QSe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void n1().warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void n1().error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(n,v,r.timeZone);if(!h){const w=_.createSyntaxTree(i.valueExpression);h=_.createFunction(w),i.cache.compiledFunc=h}a=_.executeFunction(h,b)}else o&&(a=o[l]);const p=i.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(f)&&f!==0)){isNaN(f)||s||(a/=f);const g=XJ(a,c);if(g){const _=g[0],v=g[1],b=_===v?i.stops[_].color:Fe.blendColors(i.stops[_].color,i.stops[v].color,g[2],r!=null?r.color:void 0);return new Fe(b)}}}function eEe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void n1().warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void n1().error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(n,v,r.timeZone);if(!h){const w=_.createSyntaxTree(i.valueExpression);h=_.createFunction(w),i.cache.compiledFunc=h}a=_.executeFunction(h,b)}else o&&(a=o[l]);const p=i.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(f)&&f!==0)){isNaN(f)||s||(a/=f);const g=XJ(a,c);if(g){const _=g[0],v=g[1];if(_===v)return i.stops[_].opacity;{const b=i.stops[_].opacity;return b+(i.stops[v].opacity-b)*g[2]}}}}function tEe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(f=>f.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void n1().warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=i.field,{hasExpression:u}=i.cache;let h=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if((r==null?void 0:r.arcade)==null)return void n1().error("Use of arcade expressions requires an arcade context");const f={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,_=g.getViewInfo(f),v=g.createExecContext(a,_,r.timeZone);if(!h){const b=g.createSyntaxTree(i.valueExpression);h=g.createFunction(b),i.cache.compiledFunc=h}p=g.executeFunction(h,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function Hit(t,e,r){const i=typeof e=="number",s=i?null:e,n=s==null?void 0:s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,h=r!=null?r.view:void 0;o=u==null||h==="3d"?qit(t):u}else if(!i)switch(t.inputValueType){case Zg.Expression:{if((r==null?void 0:r.arcade)==null)return void n1().error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,p=h.getViewInfo(u),f=h.createExecContext(s,p,r.timeZone);if(!l){const g=h.createSyntaxTree(t.valueExpression);l=h.createFunction(g),t.cache.compiledFunc=l}o=h.executeFunction(l,f);break}case Zg.Field:n&&(o=n[t.field]);break;case Zg.Unknown:o=null}if(!SO(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return SO(c)&&c!==0?o/c:null}function qit(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function d8(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void n1().warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=iEe(Hit(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Ec(t,e,r){return t==null?null:Vit(t)?d8(t,e,r):SO(t)?t:null}function rEe(t,e,r){return SO(r)&&t>r?r:SO(e)&&t<e?e:t}function Wit(t,e,r,i){return t+((Ec(e.minSize,r,i)||e.minDataValue)??0)}function Yit(t,e,r){const i=t.stops;let s=(i==null?void 0:i.length)&&i[0].size;return s==null&&(s=t.minSize),Ec(s,e,r)}function Xit(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Ec(e.minSize,r,i),o=Ec(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?SN*(n/2)**2:n*n,u=c+s*((l?SN*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/SN):Math.sqrt(u)}return n+s*(o-n)}function Zit(t,e,r,i){const s=i!=null?i.shape:void 0,n=t/e.minDataValue,o=Ec(e.minSize,r,i),a=Ec(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,rEe(l,o,a)}function Jit(t,e,r,i,s){var l,c,u;const[n,o,a]=XJ(t,s);if(n===o)return Ec((l=e.stops)==null?void 0:l[n].size,r,i);{const h=Ec((c=e.stops)==null?void 0:c[n].size,r,i);return h+(Ec((u=e.stops)==null?void 0:u[o].size,r,i)-h)*a}}function Kit(t,e,r,i){const s=((i==null?void 0:i.resolution)??1)*mE[e.valueUnit],n=Ec(e.minSize,r,i),o=Ec(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/SN)/s:a==="radius"||a==="distance"?2*t/s:t/s,rEe(l,n,o)}function iEe(t,e,r,i,s){switch(e.transformationType){case aa.Additive:return Wit(t,e,r,i);case aa.Constant:return Yit(e,r,i);case aa.ClampedLinear:return Xit(t,e,r,i);case aa.Proportional:return Zit(t,e,r,i);case aa.Stops:return Jit(t,e,r,i,s);case aa.RealWorldSize:return Kit(t,e,r,i);case aa.Identity:return t;case aa.Unknown:return null}}function Qit(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=Ec(t.minSize,xoe,s),o=Ec(t.maxSize,xoe,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function YJ(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=QSe(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=eEe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=tEe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=d8(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function XJ(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function est(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":d8(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const Z5t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:est,getColor:QSe,getOpacity:eEe,getRotationAngle:tEe,getSize:d8,getSizeForValue:iEe,getSizeFromNumberOrVariable:Ec,getSizeRangeAtScale:Qit,getVisualVariableValues:YJ,viewScaleRE:jit},Symbol.toStringTag,{value:"Module"}));function p8(t,e){if(!t||t.symbol)return null;const r=e==null?void 0:e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function tst(t,e){if(t.symbol!=null)return t.symbol;const r=p8(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function J5t(t,e){const r=p8(t,e),i=tst(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=YJ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function rst(t,e){if(t.symbol!=null)return t.symbol;const r=p8(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function K5t(t,e){const r=p8(t,e),i=await rst(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=YJ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Fe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function ist(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function sst(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function nst(t,e,r,i){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=i?xa(i)/HM(i):1;return pX(t,(o,a)=>te(o,s(a,0)*n,s(a,1)*n,s(a,2)),r)}function sEe(t,e,r){const i=nst(Toe,t,e,r)?Toe:[0,0,1];return Math.abs(i[2])>Math.cos(Lt(80))?ls.Z:Math.abs(i[1])>Math.abs(i[0])?ls.Y:ls.X}const Toe=zr();function ost(t,e,r){const i=sEe(t,(e.length>0?e[0]:t.length/3)-1,r);if(i!==ls.Z){t=t.slice();for(let s=0;s<t.length;s+=3)t[s+i]=t[s+2]}return TE(t,e,3)}function Soe(t){const e=[[O.POSITION,new qe(t.attributeData.position,t.indices,3,!0)]],r=v1(t.indices.length);return t.attributeData.colorFeature!=null?e.push([O.COLORFEATUREATTRIBUTE,new qe([t.attributeData.colorFeature],r,1,!0)]):t.attributeData.color&&e.push([O.COLOR,new qe(t.attributeData.color,r,4,!0)]),t.attributeData.uvMapSpace&&e.push([O.UVMAPSPACE,new qe(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([O.BOUNDINGRECT,new qe(t.attributeData.boundingRect,t.indices,9,!0)]),new un(t.material,e,t.mapPositions,vs.Mesh,t.attributeData.objectAndLayerIdColor)}function Eoe(t,e=null){const r=[[O.POSITION,new qe(t.attributeData.position,t.indices,3,!0)],[O.UV0,new qe(t.attributeData.uv0,t.indices,2,!0)]];return new un(t.material,r,t.mapPositions,vs.Mesh,e)}function EO(t){switch(t.type){case"extent":if(t instanceof $r)return bp.fromExtent(t);break;case"polygon":return t}return null}let f8=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function aq(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let P=0;P<c.length-1;P++){const R=c[P+1]-c[P];R>u&&(u=R)}else u=s;const h=Math.floor(1.1*u)+1;(Hp==null||Hp.length<2*h)&&(Hp=new Uint32Array(Hfe(2*h)));for(let P=0;P<2*h;P++)Hp[P]=0;let p=0;const f=!!c&&!!a,g=f?l:s;let _=N5(s);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,T=1,S=c?c[1]:g;for(let P=0;P<g;P++){if(P===w){const z=1-p/P;if(z+b*Math.sqrt(z*(1-z)/P)<o)return null;w*=2}if(P===S){for(let z=0;z<2*h;z++)Hp[z]=0;if(a)for(let z=c[T-1];z<c[T];z++)v[z]=_[a[z]];S=c[++T]}const R=f?a[P]:P,L=R*e,F=cst(n,L,e);let U=F%h,j=p;for(;Hp[2*U+1]!==0;){if(Hp[2*U]===F){const z=Hp[2*U+1]-1;if(ast(n,L,z*e,e)){j=_[z];break}}U++,U>=h&&(U-=h)}j===p&&(Hp[2*U]=F,Hp[2*U+1]=R+1,p++),_[R]=j}if(o!==0&&1-p/s<o)return null;if(f){for(let P=c[T-1];P<v.length;P++)v[P]=_[a[P]];_=lm(v)}const C=i?new Array(p):new Uint32Array(p*e);p=0;for(let P=0;P<g;P++)_[P]===p&&(lst(n,(f?a[P]:P)*e,C,p*e,e),p++);if(a&&!f){const P=new Uint32Array(l);for(let R=0;R<P.length;R++)P[R]=_[a[R]];_=lm(P)}return{buffer:Array.isArray(C)?C:C.buffer,indices:_,uniqueCount:p}}function ast(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function lst(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function cst(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Hp=null;function eFt(t){const e=FR(t.rings,t.hasZ,Em.CCW_IS_HOLE,t.spatialReference),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Ah(e.position,3*c,3*l),h=a.holeIndices.map(f=>f-c),p=lm(TE(u,h,3));r.push({position:u,faces:p}),i+=u.length,s+=p.length}const n=ust(r,i,s),o=Array.isArray(n.position)?aq(n.position,3,{originalIndices:n.faces}):aq(n.position.buffer,6,{originalIndices:n.faces});return n.position=yxe(new Float64Array(o.buffer)),n.faces=o.indices,n}function ust(t,e,r){if(t.length===1)return t[0];const i=ao(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:lm(s)}}function FR(t,e,r,i){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0,c=0,u=0,h=0;for(let g=0;g<s;++g)h+=t[g].length;const p=ao(3*h);let f=0;for(let g=s-1;g>=0;g--){const _=t[g],v=r===Em.CCW_IS_HOLE&&hst(_,e,i);if(v&&s!==1)n[l++]=_;else{let b=_.length;for(let T=0;T<l;++T)b+=n[T].length;const w={index:f,pathLengths:new Array(l+1),count:b,holeIndices:new Array(l)};w.pathLengths[0]=_.length,_.length>0&&(a[u++]={index:f,count:_.length}),f=v?LI(_,_.length-1,-1,p,f,_.length,e):LI(_,0,1,p,f,_.length,e);for(let T=0;T<l;++T){const S=n[T];w.holeIndices[T]=f,w.pathLengths[T+1]=S.length,S.length>0&&(a[u++]={index:f,count:S.length}),f=LI(S,0,1,p,f,S.length,e)}l=0,w.count>0&&(o[c++]=w)}}for(let g=0;g<l;++g){const _=n[g];_.length>0&&(a[u++]={index:f,count:_.length}),f=LI(_,0,1,p,f,_.length,e)}return o.length=c,a.length=u,{position:p,polygons:o,outlines:a}}function LI(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function hst(t,e,r){if(e){const i=t.length-1,s=sEe(t,i,r);if(s===ls.X)return!gD(t,ls.Y,ls.Z);if(s===ls.Y)return!gD(t,ls.X,ls.Z)}return!gD(t,ls.X,ls.Y)}var Em;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Em||(Em={}));var aM,nF,lq;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(aM||(aM={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(nF||(nF={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(lq||(lq={}));var rn,fh,lM,nn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(rn||(rn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(fh||(fh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(lM||(lM={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(nn||(nn={}));let dst=class{constructor(e,r){this.vec3=e,this.id=r}};function oF(t,e,r,i){return new dst(Pe(t,e,r),i)}let Coe=class{constructor(){this._extent=jt(),this.resolution=0,this.renderLocalOrigin=oF(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new pst}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];j4(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];j4(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,s0(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},pst=class{constructor(){this.extents=[jt(),jt(),jt()],this.numViews=0}};var Fi;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(Fi||(Fi={}));let fst=class{constructor(e,r,i){this._fbos=e,this._format=r,this._name=i}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=er(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,r,i){var s,n,o;this._handle&&this._handle.fbo.width===r&&this._handle.fbo.height===i||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(r,i,this._name,this._format)),e.unbindTexture((n=this._handle)==null?void 0:n.fbo.colorTexture),e.bindFramebuffer((o=this._handle)==null?void 0:o.fbo)}generateMipMap(){var e,r,i,s,n;(i=(r=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:r.descriptor)!=null&&i.hasMipmap&&((n=(s=this._handle)==null?void 0:s.getTexture())==null||n.generateMipmap())}},Hx=class{constructor(e,r,i,s,n=ji.RGBA_MIPMAP){this.output=i,this.content=s,this.fbo=new fst(e,n,r)}get valid(){return this.fbo.valid}},mst=class{constructor(e){this.targets=[new Hx(e,"overlay color",k.Color,Fi.Color),new Hx(e,"overlay IM color",k.Color,Fi.ColorNoRasterImage),new Hx(e,"overlay highlight",k.Highlight,Fi.Highlight,ji.RGBA4),new Hx(e,"overlay water",k.Normal,Fi.WaterNormal),new Hx(e,"overlay occluded",k.Color,Fi.Occluded)],se("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new Hx(e,"overlay oid",k.ObjectAndLayerIdColor,Fi.ObjectAndLayerIdColor))}getTexture(e){var r;return(r=this.targets[e])==null?void 0:r.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,r,i)=>r.valid?e|=1<<i:e,0)}},ZJ=class extends zTe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=E(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var vc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(vc||(vc={}));let gst=class extends ZJ{constructor(){super(...arguments),this.identifier=vc.Material,this.output=k.Color,this.transparent=!1}},yst=class extends ZJ{constructor(){super(...arguments),this.identifier=vc.ShadowMap}},_st=class extends ZJ{constructor(){super(...arguments),this.identifier=vc.Highlight}};function vst(t){t.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function bst(t){t.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function wst(t,e){const r=t.fragment;r.include(bm),r.uniforms.add(new ni("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new at("depthMap",(i,s)=>{var n;return(n=s.linearDepth)==null?void 0:n.getTexture()})),r.uniforms.add(new is("proj",(i,s)=>s.camera.projectionMatrix)),r.uniforms.add(new Ie("invResolutionHeight",(i,s)=>1/s.camera.height)),r.uniforms.add(new is("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function nEe(t,e){t.include(prt,e),t.include(Mk),t.include(bst),e.hasCloudsReflections&&t.include(mwe,e),e.hasScreenSpaceReflections&&t.include(wst,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",eSe).add("ssrHeightFadeEnd","float",TN).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ie("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new is("view",(i,s)=>s.camera.viewMatrix),new at("lastFrameColorTexture",(i,s)=>{var n;return(n=s.ssr.lastFrameColor)==null?void 0:n.getTexture()}),new Ie("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(x`return waterRenderedColor;
}`)}let aF=class extends ps{constructor(e,r){super(e,"vec4",Rr.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var Zf;function xst(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new aF("overlayTexOffset",(s,n)=>Tst(s,n)),new aF("overlayTexScale",(s,n)=>Sst(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new at("ovColorTex",(s,n)=>cq(s,n))),oEe(t,e)}function i3(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new Aoe("overlayTexOffset"),new Aoe("overlayTexScale")),i.uniforms.add(new Ie("overlayOpacity",s=>s.overlayOpacity),new at("ovColorTex",(s,n)=>{var o;return(o=n.overlay)==null?void 0:o.getTexture(s.overlayContent)})),oEe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Zf||(Zf={}));let Aoe=class extends ps{constructor(e){super(e,"vec4")}};function oEe(t,e){e.pbrMode!==nt.Water&&e.pbrMode!==nt.WaterOnIntegratedMesh&&e.pbrMode!==nt.TerrainWithWater||t.include(nEe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(x`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==nt.Water&&e.pbrMode!==nt.WaterOnIntegratedMesh&&e.pbrMode!==nt.TerrainWithWater||(w0(i),Om(i),i.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function cq(t,e){var r,i,s;return t.identifier===vc.Material&&t.output===k.Color?(r=e.overlay)==null?void 0:r.getTexture(Fi.ColorNoRasterImage):t.identifier===vc.Material&&t.output===k.ObjectAndLayerIdColor?(i=e.overlay)==null?void 0:i.getTexture(Fi.ObjectAndLayerIdColor):t.identifier===vc.Highlight?(s=e.overlay)==null?void 0:s.getTexture(Fi.Highlight):null}function Tst(t,e){var s,n,o,a;const r=(n=(s=e.overlay)==null?void 0:s.overlays[rn.INNER])==null?void 0:n.extent;G4(r)&&(Bf[0]=t.toMapSpace[0]/fa(r)-r[0]/fa(r),Bf[1]=t.toMapSpace[1]/Pl(r)-r[1]/Pl(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[rn.OUTER])==null?void 0:a.extent;return G4(i)&&(Bf[2]=t.toMapSpace[0]/fa(i)-i[0]/fa(i),Bf[3]=t.toMapSpace[1]/Pl(i)-i[1]/Pl(i)),Bf}function Sst(t,e){var s,n,o,a;const r=(n=(s=e.overlay)==null?void 0:s.overlays[rn.INNER])==null?void 0:n.extent;G4(r)&&(Bf[0]=t.toMapSpace[2]/fa(r),Bf[1]=t.toMapSpace[3]/Pl(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[rn.OUTER])==null?void 0:a.extent;return G4(i)&&(Bf[2]=t.toMapSpace[2]/fa(i),Bf[3]=t.toMapSpace[3]/Pl(i)),Bf}const Bf=Yt();let JJ=class extends Ci{constructor(){super(...arguments),this.color=Pe(1,1,1)}};function aEe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("tex",e=>e.texture),new Dt("uColor",e=>e.color)),t.fragment.code.add(x`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const Est=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:JJ,build:aEe},Symbol.toStringTag,{value:"Module"}));let lEe=class{constructor(e){this._context=e,this._perConstructorInstances=new t1,this._frameCounter=0,this._keepAliveFrameCount=Poe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Ast){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new Cst(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Poe&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},Cst=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Poe=-1,Ast=new zl;let cEe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new t1}dispose(){this._textureRepository.destroy()}acquire(e,r,i){this._ownMaterial(e);const s=e.produces.get(r);if(!s||!s(i))return null;let n=this._id2glMaterialRef.get(i,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:i});n=new Pst(o),this._id2glMaterialRef.set(i,e.id,n)}return n.ref(),n.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(ft(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&ae.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Pst=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,ht(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Mst=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let uq=class EN{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new eo,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),eo.clearPool(),hq[0]=null,W1.prune(),Zv.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=eo.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}eo.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=eo.acquire();for(const s of e){const n=r??Iw(this.objectToBoundingSphere(s),Lst);LA(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}eo.release(i),this._shrink()}update(e,r){if(!LA(r[3])&&this._isDegenerate(e))return;const i=Ist(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=Eu(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=Eu(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=K9(e,r),u=h=>{if(--n,!s(h))return;const p=this.objectToBoundingSphere(h);if(!y_(i,p))return;const f=Zy(e,r,p),g=f-p[3],_=f+p[3];g<o&&(o=g,a=_,l=h)};return this._forEachNodeDepthOrdered(this._root,h=>{if(n<=0||!y_(i,h.bounds)||(re(Fu,c,h.halfSize),pe(Fu,Fu,h.bounds),Zy(e,r,Fu)>a))return!1;const p=h.node;return p.terminals.forAll(f=>u(f)),p.residents!==null&&p.residents.forAll(f=>u(f)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{i===EN.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(s);const h=Zy(r,i,e),p=K9(r,i),f=K9(r,-i),g=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),b=v,w=Zy(r,i,b)-h,T=w-v[3],S=w+v[3];T>c||S<l||!y_(o,v)||n(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!y_(o,_.bounds)||(re(Fu,p,_.halfSize),pe(Fu,Fu,_.bounds),Zy(r,i,Fu)-h>c)||(re(Fu,f,_.halfSize),pe(Fu,Fu,_.bounds),Zy(r,i,Fu)-h<l))return!1;const v=_.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=Gg(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),u=Gg(c),h=i+u;return!(So(c,s)-h*h<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=Gg(l.bounds),u=i+c;if(So(l.bounds,s)-u*u>0)return!1;const h=l.node;return h.terminals.forAll(a),o&&h.residents!==null&&h.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return DI(r.bounds,2*-r.halfSize,ru),DI(r.bounds,2*r.halfSize,iu),$ie(e.origin,e.direction,ru,iu)}_intersectsNodeWithOffset(e,r,i){return DI(r.bounds,2*-r.halfSize,ru),DI(r.bounds,2*r.halfSize,iu),i.applyToMinMax(ru,iu),$ie(e.origin,e.direction,ru,iu)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||xG(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||xG(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=eo.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(eo.acquire().init(i).advance(n));eo.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=EN.DepthOrder.FRONT_TO_BACK){let n=eo.acquire().init(e);const o=[n];for($st(i,s,Roe);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Roe[a];n.node.children[l]&&o.push(eo.acquire().init(n).advance(l))}eo.release(n)}}_remove(e,r,i){W1.clear();const s=i.advanceTo(r,(n,o)=>{W1.push(n.node),W1.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=W1.length-2;n>=0;n-=2){const o=W1.data[n],a=W1.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new kt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=eo.acquire().init(e);this._add(r.at(i),s),eo.release(s)}}_grow(e,r){if(r!==0&&(Moe(e,r,i=>this.objectToBoundingSphere(i),qm),LA(qm[3])&&!this._fitsInsideTree(qm)))if(this._nodeIsEmpty(this._root.node))Iw(qm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(qm);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(qm,i):this._growRootAsSubNode(i),eo.release(i)}}_rebuildTree(e,r){ce(ez,r.bounds),ez[3]=r.halfSize,Moe([e,ez],2,s=>s,tz);const i=eo.acquire().init(this._root);this._root.initFrom(null,tz,tz[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),eo.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),u=i[l]+r-(n[l]+o),h=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),NI[l].min=h,NI[l].max=p}for(let l=0;l<3;l++){let c=NI[l].min,u=NI[l].max;const h=(s-(c+u))/2;c+=Math.ceil(h),u+=Math.floor(h);const p=n[l]-o-c*o*2;Q9[l]=p+(u+c)*o}const a=s*o;return Q9[3]=a*hEe,eo.acquire().initFrom(null,Q9,a,0)}_growRootAsSubNode(e){const r=this._root.node;ce(qm,this._root.bounds),qm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(qm,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!LA(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new EN(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},eo=class Z2{constructor(){this.bounds=Vs(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??Z2.createEmptyNode(),r&&Iw(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*hEe}advance(e){let r=this.node.children[e];r||(r=Z2.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=uEe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new kt({shrink:!0}),residents:new kt({shrink:!0})}}static acquire(){return Z2._pool.acquire()}static release(e){Z2._pool.release(e)}static clearPool(){Z2._pool.prune()}};function Ost(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Rst(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function DI(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Moe(t,e,r,i){if(e===1){const s=r(t[0]);Iw(s,i)}else{ru[0]=1/0,ru[1]=1/0,ru[2]=1/0,iu[0]=-1/0,iu[1]=-1/0,iu[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);LA(n[3])&&(Ost(ru,n),Rst(iu,n))}li(i,ru,iu,.5),i[3]=Math.max(iu[0]-ru[0],iu[1]-ru[1],iu[2]-ru[2])/2}}function $st(t,e,r){if(!Zv.length)for(let i=0;i<8;++i)Zv.push({index:0,distance:0});for(let i=0;i<8;++i){const s=uEe[i];Zv.data[i].index=i,Zv.data[i].distance=Zy(t,e,s)}Zv.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=Zv.data[i].index}function K9(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=Zy(t,e,Ooe[s]);n<i&&(i=n,r=Ooe[s])}return r}function Zy(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function LA(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}eo._pool=new qo(eo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(uq||(uq={}));const uEe=[Pe(-1,-1,-1),Pe(1,-1,-1),Pe(-1,1,-1),Pe(1,1,-1),Pe(-1,-1,1),Pe(1,-1,1),Pe(-1,1,1),Pe(1,1,1)],Ooe=[Pe(-1,-1,-1),Pe(-1,-1,1),Pe(-1,1,-1),Pe(-1,1,1),Pe(1,-1,-1),Pe(1,-1,1),Pe(1,1,-1),Pe(1,1,1)],hEe=Math.sqrt(3),hq=[null];function Ist(t){return hq[0]=t,hq}const Q9=Vs(),Fu=E(),ru=E(),iu=E(),W1=new kt,Lst=Vs(),qm=Vs(),ez=Vs(),tz=Vs(),NI=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Zv=new kt,Roe=[0,0,0,0,0,0,0,0],op=uq;var P_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(P_||(P_={}));let dEe=class extends SR{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=vs.Layer,this.events=new Gs,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new kt,this._objectsAdded=new kt,this._handles=new c1,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??P_.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const s of Mst)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==P_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new op(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Ae(this._octree),this._objectsAdded.clear()}};function lF(t){return t!=null&&t.type===vs.Layer}var Ll,jw;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Ll||(Ll={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(jw||(jw={}));let Zn=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=dt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Ll.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=jw.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Ll.Draped}};d([G({count:k.COUNT})],Zn.prototype,"output",void 0),d([G({count:dt.COUNT})],Zn.prototype,"transparencyPassType",void 0),d([G()],Zn.prototype,"occluder",void 0),d([G()],Zn.prototype,"hasSlicePlane",void 0),d([G()],Zn.prototype,"writeDepth",void 0),d([G({count:Ll.COUNT})],Zn.prototype,"space",void 0),d([G()],Zn.prototype,"hideOnShortSegments",void 0),d([G()],Zn.prototype,"hasCap",void 0),d([G({count:jw.COUNT})],Zn.prototype,"anchor",void 0),d([G()],Zn.prototype,"hasTip",void 0),d([G()],Zn.prototype,"vvSize",void 0),d([G()],Zn.prototype,"vvColor",void 0),d([G()],Zn.prototype,"vvOpacity",void 0),d([G()],Zn.prototype,"hasOccludees",void 0),d([G()],Zn.prototype,"multipassEnabled",void 0),d([G()],Zn.prototype,"cullAboveGround",void 0),d([G({constValue:!1})],Zn.prototype,"occlusionPass",void 0),d([G({constValue:!0})],Zn.prototype,"hasVvInstancing",void 0),d([G({constValue:!0})],Zn.prototype,"hasSliceTranslatedView",void 0);const $oe=8;function pEe(t,e){const r=t.vertex;r.uniforms.add(new Ie("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Dt("vvSizeMinSize",i=>i.vvSize.minSize),new Dt("vvSizeMaxSize",i=>i.vvSize.maxSize),new Dt("vvSizeOffset",i=>i.vvSize.offset),new Dt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),r.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Al("vvOpacityValues",i=>i.vvOpacity.values,$oe),new Al("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,$oe)),r.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(Yg,e),t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),r.code.add(x`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),r.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function CO(t,e,r=0){const i=we(t,0,Fst);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*kst(i*Dst[s]))}function KJ(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*Nst[i];return r}const Dst=[1,256,65536,16777216],Nst=[1/256,1/65536,1/16777216,1/4294967296],Fst=KJ(new Uint8ClampedArray([255,255,255,255]));function kst(t){return t-Math.floor(t)}let fEe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${fu()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.usedMemory;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new Ust(s);return this._repository.set(r,n),s}},Ust=class{constructor(e){this.texture=e,this.refCount=1}};function zst(t,e){return new fEe(r=>{const{encodedData:i,textureSize:s}=Bst(r),n=new oi;return n.internalFormat=wt.RGBA,n.width=s,n.height=1,n.wrapMode=Xt.REPEAT,new Sr(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function Bst(t){const e=QJ(t),r=1/t.pixelRatio,i=mEe(t),s=gEe(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const p of e){for(let f=0;f<p;f++){const g=a*(Math.min(f,p-1-f)+.5)*r/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*i);let h=0;for(const p of c)CO(p,u,h),h+=4;return{encodedData:u,textureSize:i}}function QJ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function mEe(t){if(t==null)return 1;const e=QJ(t);return Math.floor(e.reduce((r,i)=>r+i))}function gEe(t){return QJ(t).reduce((e,r)=>Math.max(e,r))}function Vst(t){return t==null?_u:t.length===4?t:es(Gst,t[0],t[1],t[2],1)}const Gst=Yt();function jst(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Hst(t,e):qst(t)}function Hst(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(Yh),e.draped||(Cp(i,e),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),i.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Yst};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(x`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),sC(i),i.code.add(x`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new at("stipplePatternTexture",n=>n.stippleTexture),new Ie("stipplePatternSDFNormalizer",n=>Wst(n.stipplePattern)),new Ie("stipplePatternPixelSizeInv",n=>1/yEe(n))),s.code.add(x`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new wr("stippleOffColor",n=>Vst(n.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function qst(t){t.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Wst(t){return t?(Math.floor(.5*(gEe(t)-1))+.5)/t.pixelRatio:1}function yEe(t){const e=t.stipplePattern;return e?mEe(t.stipplePattern)/e.pixelRatio:1}const Yst=x.float(.4);async function d0(t,e){const{data:r}=await Wr(t,{responseType:"image",...e});return r}function Xst(){if(rz==null){const t=e=>ai(`esri/libs/basisu/${e}`);rz=me(()=>import("./basis_transcoder-R85WoTHh.js"),[]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return rz}let rz;var vb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(vb||(vb={}));let yp=null,FI=null;async function _Ee(){return FI==null&&(FI=Xst(),yp=await FI),FI}function Zst(t,e){if(yp==null)return t.byteLength;const r=new yp.BasisFile(new Uint8Array(t)),i=bEe(r)?vEe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function Jst(t,e){if(yp==null)return t.byteLength;const r=new yp.KTX2File(new Uint8Array(t)),i=wEe(r)?vEe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function vEe(t,e,r,i,s){const n=bZ(e?Cs.COMPRESSED_RGBA8_ETC2_EAC:Cs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function bEe(t){return t.getNumImages()>=1&&!t.isUASTC()}function wEe(t){return t.getFaces()>=1&&t.isETC1S()}async function Kst(t,e,r){yp==null&&(yp=await _Ee());const i=new yp.BasisFile(new Uint8Array(r));if(!bEe(i))return null;i.startTranscoding();const s=xEe(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function Qst(t,e,r){yp==null&&(yp=await _Ee());const i=new yp.KTX2File(new Uint8Array(r));if(!wEe(i))return null;i.startTranscoding();const s=xEe(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function xEe(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?i?[vb.ETC2_RGBA,Cs.COMPRESSED_RGBA8_ETC2_EAC]:[vb.ETC1_RGB,Cs.COMPRESSED_RGB8_ETC2]:c?i?[vb.BC3_RGBA,Cs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[vb.BC1_RGB,Cs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[vb.RGBA32,wt.RGBA],p=e.hasMipmap?r:Math.min(1,r),f=[];for(let g=0;g<p;g++)f.push(new Uint8Array(o(g,u))),a(g,u,f[g]);return e.internalFormat=h,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?Gt.LINEAR_MIPMAP_LINEAR:Gt.LINEAR,e.width=s,e.height=n,new Sr(t,e,{type:"compressed",levels:f})}const kI=()=>ae.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),ent=542327876,tnt=131072,rnt=4;function eK(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function int(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const snt=eK("DXT1"),nnt=eK("DXT3"),ont=eK("DXT5"),ant=31,lnt=0,cnt=1,unt=2,hnt=3,dnt=4,pnt=7,fnt=20,mnt=21;function gnt(t,e,r){const i=ynt(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?Gt.LINEAR_MIPMAP_LINEAR:Gt.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Sr(t,e,s)}function ynt(t,e){const r=new Int32Array(t,0,ant);if(r[lnt]!==ent)return kI().error("Invalid magic number in DDS header"),null;if(!(r[fnt]&rnt))return kI().error("Unsupported format, must contain a FourCC code"),null;const i=r[mnt];let s,n;switch(i){case snt:s=8,n=Cs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case nnt:s=16,n=Cs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ont:s=16,n=Cs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return kI().error("Unsupported FourCC code:",int(i)),null}let o=1,a=r[dnt],l=r[hnt];!(3&a)&&!(3&l)||(kI().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,p;r[unt]&tnt&&e!==!1&&(o=Math.max(1,r[pnt]));let f=r[cnt]+4;const g=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*s,h=new Uint8Array(t,f,p),g.push(h),f+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:u}}let o1=class extends SR{get parameters(){return this._parameters}constructor(e,r){super(),this._data=e,this.type=vs.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Gs,this._parameters={...vnt,...r},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=r=>this._frameUpdate(e,r),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(DS(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){Cm(e.src)||DS(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const r=new oi;return r.wrapMode=this._parameters.wrap??Xt.REPEAT,r.flipped=!this._parameters.noUnpackFlip,r.samplingMode=this._parameters.mipmap?Gt.LINEAR_MIPMAP_LINEAR:Gt.LINEAR,r.hasMipmap=!!this._parameters.mipmap,r.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,r.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||_nt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Sr(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(gT(r)||o_(r))&&this._parameters.encoding===jg.DDS_ENCODING?this._loadFromDDSData(e,r):(gT(r)||o_(r))&&this._parameters.encoding===jg.KTX2_ENCODING?this._loadFromKTX2(e,r):(gT(r)||o_(r))&&this._parameters.encoding===jg.BASIS_ENCODING?this._loadFromBasis(e,r):o_(r)?this._loadFromPixelData(e,r):gT(r)?this._loadFromPixelData(e,new Uint8Array(r)):null)}_frameUpdate(e,r){return this._glTexture==null||e.readyState<cM.HAVE_CURRENT_DATA||r===e.currentTime?r:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,r){return this._glTexture=gnt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>Qst(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>Kst(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){ht(this._parameters.width>0&&this._parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this._parameters.components===1?wt.LUMINANCE:this._parameters.components===3?wt.RGB:wt.RGBA,i.width=this._parameters.width??0,i.height=this._parameters.height??0,this._glTexture=new Sr(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await d0(r,{signal:i});return vt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await fme(r,r.src,!1,i);return vt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=cM.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),wi(c)},a=()=>{r.readyState>=cM.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=u=>{o(),n(u||new J("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=lo(i,()=>l(hr()))}))}_loadFromImage(e,r){let i=r;if(!(i instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;i=this._parameters.downsampleUncompressed?gWe(i,o):yWe(i,o)}const s=TEe(i);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?wt.RGB:wt.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new Sr(e,n,i),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=ft(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function _nt(t,e){if(t==null)return 0;if(gT(t)||o_(t))return e.encoding===jg.KTX2_ENCODING?Jst(t,!!e.mipmap):e.encoding===jg.BASIS_ENCODING?Zst(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?TEe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function TEe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var cM;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(cM||(cM={}));const vnt={wrap:{s:Xt.REPEAT,t:Xt.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},cF=128,tK=.5;function bnt(t){return t==="cross"||t==="x"}function wnt(t,e=cF,r=e*tK,i=0){const s=SEe(t,e,r,i);return new o1(s,{mipmap:!1,wrap:{s:Xt.CLAMP_TO_EDGE,t:Xt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function SEe(t,e=cF,r=e*tK,i=0){switch(t){case"circle":default:return xnt(e,r);case"square":return Tnt(e,r);case"cross":return Ent(e,r,i);case"x":return Cnt(e,r,i);case"kite":return Snt(e,r);case"triangle":return Ant(e,r);case"arrow":return Pnt(e,r)}}function xnt(t,e){const r=t/2-.5;return kR(t,AEe(r,r,e/2))}function Tnt(t,e){return EEe(t,e,!1)}function Snt(t,e){return EEe(t,e,!0)}function Ent(t,e,r=0){return CEe(t,e,!1,r)}function Cnt(t,e,r=0){return CEe(t,e,!0,r)}function Ant(t,e){return kR(t,PEe(t/2,e,e/2))}function Pnt(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=AEe(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=PEe(s,r,i);return kR(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function EEe(t,e,r){return r&&(e/=Math.SQRT2),kR(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function CEe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return kR(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function AEe(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function PEe(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function kR(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,CO(o,r,4*n)}return r}const uw=64,rK=uw/2,MEe=rK/5,Mnt=uw/MEe,Ont=.25;function Rnt(t,e){const r=SEe(t,uw,rK,MEe),i=new oi;return i.internalFormat=wt.RGBA,i.width=uw,i.height=uw,i.wrapMode=Xt.CLAMP_TO_EDGE,new Sr(e,i,r)}function OEe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",Mnt),sC(r),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(x`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Ll.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ie("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(x`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Ph;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Ph||(Ph={}));let ms=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.capType=Ph.BUTT,this.transparencyPassType=dt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([G({count:k.COUNT})],ms.prototype,"output",void 0),d([G({count:Ph.COUNT})],ms.prototype,"capType",void 0),d([G({count:dt.COUNT})],ms.prototype,"transparencyPassType",void 0),d([G()],ms.prototype,"occluder",void 0),d([G()],ms.prototype,"hasSlicePlane",void 0),d([G()],ms.prototype,"hasPolygonOffset",void 0),d([G()],ms.prototype,"writeDepth",void 0),d([G()],ms.prototype,"draped",void 0),d([G()],ms.prototype,"stippleEnabled",void 0),d([G()],ms.prototype,"stippleOffColorEnabled",void 0),d([G()],ms.prototype,"stipplePreferContinuous",void 0),d([G()],ms.prototype,"roundJoins",void 0),d([G()],ms.prototype,"applyMarkerOffset",void 0),d([G()],ms.prototype,"vvSize",void 0),d([G()],ms.prototype,"vvColor",void 0),d([G()],ms.prototype,"vvOpacity",void 0),d([G()],ms.prototype,"falloffEnabled",void 0),d([G()],ms.prototype,"innerColorEnabled",void 0),d([G()],ms.prototype,"hasOccludees",void 0),d([G()],ms.prototype,"multipassEnabled",void 0),d([G()],ms.prototype,"cullAboveGround",void 0),d([G()],ms.prototype,"wireframe",void 0),d([G()],ms.prototype,"objectAndLayerIdColorInstanced",void 0),d([G({constValue:!1})],ms.prototype,"occlusionPass",void 0),d([G({constValue:!0})],ms.prototype,"hasVvInstancing",void 0),d([G({constValue:!0})],ms.prototype,"hasSliceTranslatedView",void 0);const AO=1;function REe(t){const e=new Or,{attributes:r,varyings:i,constants:s,vertex:n,fragment:o}=e;e.include(bR),e.include(pEe,t),e.include(jst,t);const a=t.applyMarkerOffset&&!t.draped;a&&(n.uniforms.add(new Ie("markerScale",g=>g.markerScale)),e.include(OEe,{space:Ll.World,draped:!1})),t.output===k.LinearDepth&&e.include(h0,t),e.include(lC,t),Sc(n,t),n.uniforms.add(new is("inverseProjectionMatrix",(g,_)=>_.camera.inverseProjectionMatrix),new ni("nearFar",(g,_)=>_.camera.nearFar),new Ie("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new wr("viewport",(g,_)=>_.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(O.POSITION,"vec3"),r.add(O.PREVPOSITION,"vec3"),r.add(O.NEXTPOSITION,"vec3"),r.add(O.SUBDIVISIONFACTOR,"float"),r.add(O.UV0,"vec2"),i.add("vColor","vec4"),i.add("vpos","vec3"),i.add("vLineDistance","float"),i.add("vLineWidth","float"),J_(e);const l=t.multipassEnabled&&(t.output===k.Color||t.output===k.Alpha);l&&i.add("depth","float");const c=t.stippleEnabled;c&&i.add("vLineSizeInv","float"),s.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===Ph.ROUND,h=t.stippleEnabled&&u,p=t.falloffEnabled||h;p&&i.add("vLineDistanceNorm","float"),u&&(i.add("vSegmentSDF","float"),i.add("vReverseSegmentSDF","float")),n.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),Ik(e),n.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),sC(n),n.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?x`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&n.code.add(x`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.code.add(x`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&n.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?n.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((AO+2)/(AO+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Ph.BUTT;return n.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${p?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&n.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?n.uniforms.add(new Ie("worldToScreenRatio",(g,_)=>1/_.screenToPCSRatio)):n.code.add(x`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?n.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new Ie("stipplePatternPixelSize",g=>yEe(g))),n.code.add(x`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(Oc,t),e.include(Rs,t),o.include(Lm),o.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(x`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${x.float(xo)}) {
          discard;
        }
      `),h?o.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(xo)}, stippleCoverage);
      `):o.code.add(x`float stippleAlpha = getStippleAlpha();`),t.output!==k.ObjectAndLayerIdColor&&o.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new wr("intrinsicColor",g=>g.color)),o.code.add(x`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new wr("innerColor",g=>g.innerColor??g.color),new Ie("innerWidth",(g,_)=>g.innerWidth*_.camera.pixelRatio)),o.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new Ie("falloff",g=>g.falloff)),o.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(x`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),o.code.add(x`
    ${t.output===k.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${x.float(xo)}) {
      discard;
    }

    ${t.output===k.Alpha?x`fragColor = vec4(finalColor.a);`:""}
    ${t.output===k.Color?x`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===k.Color&&t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===k.Highlight?x`fragColor = vec4(1.0);`:""}
    ${t.output===k.LinearDepth?x`outputDepth(linearDepth);`:""}
    ${t.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const $nt=Object.freeze(Object.defineProperty({__proto__:null,build:REe,ribbonlineNumRoundJoinSubdivisions:AO},Symbol.toStringTag,{value:"Module"})),$Ee=new Map([[O.POSITION,0],[O.PREVPOSITION,1],[O.NEXTPOSITION,2],[O.SUBDIVISIONFACTOR,3],[O.UV0,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let IEe=class LEe extends Gr{initializeProgram(e){return new Dr(e.rctx,LEe.shader.get().build(this.configuration),$Ee)}_makePipelineState(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace,o=$Ye(i.output);return Nt({blending:i.output===k.Color||i.output===k.Alpha?s?wu:A0(e):null,depthTest:{func:x1(e)},depthWrite:s?i.writeDepth||o?Mc:null:e8(e),colorWrite:qt,stencilWrite:i.hasOccludees?Sm:null,stencilTest:i.hasOccludees?r?s1:T1:null,polygonOffset:s||n?i.hasPolygonOffset?Ioe:null:r8})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?Ioe:null;this._occluderPipelineTransparent=Nt({blending:wu,polygonOffset:r,depthTest:rF,depthWrite:null,colorWrite:qt,stencilWrite:null,stencilTest:jTe}),this._occluderPipelineOpaque=Nt({blending:wu,polygonOffset:r,depthTest:rF,depthWrite:null,colorWrite:qt,stencilWrite:VTe,stencilTest:GTe}),this._occluderPipelineMaskWrite=Nt({blending:null,polygonOffset:r,depthTest:RJ,depthWrite:null,colorWrite:null,stencilWrite:Sm,stencilTest:s1})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?sr.LINES:sr.TRIANGLE_STRIP}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};IEe.shader=new Lr($nt,()=>me(()=>Promise.resolve().then(()=>fAt),void 0));const Ioe={factor:0,units:-4};var Kl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Kl||(Kl={}));let RT=class extends b1{constructor(e){super(e,new Lnt),this._configuration=new ms,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===k.Highlight||r===k.ObjectAndLayerIdColor||(r===k.Color||r===k.Alpha)&&this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil],[ue.OPAQUE_NO_SSAO_DEPTH,r=>r===k.LinearDepth],[ue.OCCLUDER_MATERIAL,r=>jj(r)&&this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil],[ue.TRANSPARENT_OCCLUDER_MATERIAL,r=>jj(r)&&this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil],[ue.TRANSPARENT_MATERIAL,r=>(r===k.Color||r===k.Alpha)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Ur.OccludeAndTransparentStencil],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(r===k.Color||r===k.Alpha)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Ur.OccludeAndTransparentStencil],[ue.DRAPED_MATERIAL,r=>qwe(r)]]),this._vertexAttributeLocations=$Ee}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===ue.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==k.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Nnt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],h=s[1],p=(c/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],w=u-v,T=h-b,S=a[_+3]-v,C=a[_+4]-b,P=we((S*w+C*T)/(S*S+C*C),0,1),R=S*P-w,L=C*P-T,F=R*R+L*L;F<f&&(f=F,g=_/3)}f<p*p&&n(o.dist,o.normal,g,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Bbe(r))return void ae.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const u=i.camera,h=Fnt;Vn(h,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;te(s3[0],h[0]-p,h[1]+p,0),te(s3[1],h[0]+p,h[1]+p,0),te(s3[2],h[0]+p,h[1]-p,0),te(s3[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(s3[w],Wm[w]))return;ha(u.eye,Wm[0],Wm[1],sz),ha(u.eye,Wm[1],Wm[2],nz),ha(u.eye,Wm[2],Wm[3],oz),ha(u.eye,Wm[3],Wm[0],az);let f=Number.MAX_VALUE,g=0;const _=DEe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<_;w+=3){sl[0]=l[w]+r[12],sl[1]=l[w+1]+r[13],sl[2]=l[w+2]+r[14];const T=(w+3)%l.length;if(nl[0]=l[T]+r[12],nl[1]=l[T+1]+r[13],nl[2]=l[T+2]+r[14],bi(sz,sl)<0&&bi(sz,nl)<0||bi(nz,sl)<0&&bi(nz,nl)<0||bi(oz,sl)<0&&bi(oz,nl)<0||bi(az,sl)<0&&bi(az,nl)<0)continue;if(u.projectToRenderScreen(sl,X1),u.projectToRenderScreen(nl,Z1),X1[2]<0&&Z1[2]>0){ye(qp,sl,nl);const C=u.frustum,P=-bi(C[ci.NEAR],sl)/de(qp,C[ci.NEAR]);re(qp,qp,P),pe(sl,sl,qp),u.projectToRenderScreen(sl,X1)}else if(X1[2]>0&&Z1[2]<0){ye(qp,nl,sl);const C=u.frustum,P=-bi(C[ci.NEAR],nl)/de(qp,C[ci.NEAR]);re(qp,qp,P),pe(nl,nl,qp),u.projectToRenderScreen(nl,Z1)}else if(X1[2]<0&&Z1[2]<0)continue;X1[2]=0,Z1[2]=0;const S=aX(ew(X1,Z1,Noe),h);S<f&&(f=S,ce(Loe,sl),ce(Doe,nl),g=w/3)}const v=i.rayBegin,b=i.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(wye(ew(Loe,Doe,Noe),ew(v,b,knt),Y1)){ye(Y1,Y1,v);const T=Se(Y1);re(Y1,Y1,1/T),w=T/$i(v,b)}o(w,Y1,g,!1)}}get _layout(){const e=Yi().vec3f(O.POSITION).vec3f(O.PREVPOSITION).vec3f(O.NEXTPOSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0);return this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Dnt(this._layout,this.parameters)}createGLMaterial(e){return new Int(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Int=class extends _1{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(IEe,e)}},Lnt=class extends MR{constructor(){super(...arguments),this.width=0,this.color=yh,this.join="miter",this.cap=Ph.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Dnt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r,this.numJoinSubdivisions=0;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=AO+i}}_isClosed(e){return DEe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.attributes.get(O.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){var le,I,N;const o=Unt,a=znt,l=Bnt,c=i.attributes.get(O.POSITION),u=c.indices,h=c.data.length/3,p=(le=i.attributes.get(O.DISTANCETOSTART))==null?void 0:le.data;u&&u.length!==2*(h-1)&&console.warn("RibbonLineMaterial does not support indices");const f=((I=i.attributes.get(O.SIZEFEATUREATTRIBUTE))==null?void 0:I.data[0])??((N=i.attributes.get(O.SIZE))==null?void 0:N.data[0])??1;let g=[1,1,1,1],_=0;const v=this.vertexBufferLayout.fields.has(O.COLORFEATUREATTRIBUTE);v?_=i.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(O.COLOR)&&(g=i.attributes.get(O.COLOR).data);const b=se("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(O.OPACITYFEATUREATTRIBUTE),T=w?i.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(s.buffer),C=se("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,P=this.vertexBufferLayout.stride/4;let R=n*P;const L=R;let F=0;const U=p?(B,H,q)=>F=p[q]:(B,H,q)=>F+=$i(B,H),j=se("enable-feature:objectAndLayerId-rendering"),z=(B,H,q,Q,ie,_e,Oe)=>{if(S[R++]=H[0],S[R++]=H[1],S[R++]=H[2],S[R++]=B[0],S[R++]=B[1],S[R++]=B[2],S[R++]=q[0],S[R++]=q[1],S[R++]=q[2],S[R++]=Q,S[R++]=Oe,S[R++]=ie,S[R++]=f,v)S[R++]=_;else{const gt=Math.min(4*_e,g.length-4);S[R++]=g[gt],S[R++]=g[gt+1],S[R++]=g[gt+2],S[R++]=g[gt+3]}w&&(S[R++]=T),j&&(b!=null&&(C[4*R]=b[0],C[4*R+1]=b[1],C[4*R+2]=b[2],C[4*R+3]=b[3]),R++)};R+=P,te(a,c.data[0],c.data[1],c.data[2]),e&&Ge(a,a,e);const Z=this._isClosed(i);if(Z){const B=c.data.length-3;te(o,c.data[B],c.data[B+1],c.data[B+2]),e&&Ge(o,o,e)}else te(l,c.data[3],c.data[4],c.data[5]),e&&Ge(l,l,e),z(a,a,l,1,Kl.LEFT_CAP_START,0,0),z(a,a,l,1,Kl.RIGHT_CAP_START,0,0),ce(o,a),ce(a,l);const W=Z?0:1,Y=Z?h:h-1;for(let B=W;B<Y;B++){const H=(B+1)%h*3;te(l,c.data[H],c.data[H+1],c.data[H+2]),e&&Ge(l,l,e),U(o,a,B),z(o,a,l,0,Kl.LEFT_JOIN_END,B,F),z(o,a,l,0,Kl.RIGHT_JOIN_END,B,F);const q=this.numJoinSubdivisions;for(let Q=0;Q<q;++Q){const ie=(Q+1)/(q+1);z(o,a,l,ie,Kl.LEFT_JOIN_END,B,F),z(o,a,l,ie,Kl.RIGHT_JOIN_END,B,F)}z(o,a,l,1,Kl.LEFT_JOIN_START,B,F),z(o,a,l,1,Kl.RIGHT_JOIN_START,B,F),ce(o,a),ce(a,l)}Z?(te(l,c.data[3],c.data[4],c.data[5]),e&&Ge(l,l,e),F=U(o,a,Y),z(o,a,l,0,Kl.LEFT_JOIN_END,W,F),z(o,a,l,0,Kl.RIGHT_JOIN_END,W,F)):(F=U(o,a,Y),z(o,a,a,0,Kl.LEFT_CAP_END,Y,F),z(o,a,a,0,Kl.RIGHT_CAP_END,Y,F)),iz(S,L+P,S,L,P),R=iz(S,R-P,S,R,P),this._parameters.wireframe&&this._addWireframeVertices(s,L,R,P)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=iz(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function iz(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function DEe(t,e){return t.isClosed?e.get(O.POSITION).indices.length>2:!1}function Nnt(t){return t.anchor===jw.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const sl=E(),nl=E(),qp=E(),Y1=E(),Fnt=E(),X1=Go(),Z1=Go(),Loe=E(),Doe=E(),Noe=Lp(),knt=Lp(),Unt=E(),znt=E(),Bnt=E(),s3=[Go(),Go(),Go(),Go()],Wm=[E(),E(),E(),E()],sz=zr(),nz=zr(),oz=zr(),az=zr();let iK=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+fu(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=oF(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ye(po,e,r.vec3),po[0]=Math.abs(po[0]),po[1]=Math.abs(po[1]),po[2]=Math.abs(po[2]),po[0]<c&&po[1]<c&&po[2]<c){if(l){const u=Math.max(...po);if(ye(po,e,l.vec3),po[0]=Math.abs(po[0]),po[1]=Math.abs(po[1]),po[2]=Math.abs(po[2]),Math.max(...po)<u)return l}return r}return l||(l=oF(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=zt(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new RT({width:2,color:r}),s.add(this._material);const f=new dEe(s,{pickable:!1}),g=new P0({castShadow:!1});s.add(g),f.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,h=.5*this._gridSize;for(let f=0;f<l;f++)c[3*f]=e[0]+(1&a[f]?h:-h),c[3*f+1]=e[1]+(2&a[f]?h:-h),c[3*f+2]=e[2]+(4&a[f]?h:-h),f>0&&u.push(f-1,f);Wi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new un(this._material,[[O.POSITION,new qe(c,u,3,!0)]],null,vs.Line);s.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const po=E();let NEe=class{constructor(e,r,i=null){this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new Je,this.output=k.Color,this.renderOccludedMask=uF,this.bindParameters=new $k(r,i!=null?i.plane:null),this.bindParameters.alignPixelEnabled=!0}},Vnt=class extends NEe{constructor(e,r,i,s){super(e,i,s),this.offscreenRenderingHelper=r,this.sliceHelper=s,this.time=0}};const uF=Ur.Occlude|Ur.OccludeAndTransparent|Ur.OccludeAndTransparentStencil;let DA=class extends Je{constructor(){super(...arguments),this._projectionMatrix=xe()}get projectionMatrix(){return this._projectionMatrix}};d([m()],DA.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],DA.prototype,"projectionMatrix",null),DA=d([V("esri.views.3d.webgl-engine.lib.CascadeCamera")],DA);var Hw;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(Hw||(Hw={}));let UI=class{constructor(){this.camera=new DA,this.lightMat=xe()}},Gnt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},sK=class{constructor(e,r){this._fbos=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Gnt,this._projectionView=xe(),this._projectionViewInverse=xe(),this._modelViewLight=xe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Yt(),this._cascades=[new UI,new UI,new UI,new UI],this._lastOrigin=null,this._maxTextureWidth=Math.min(se("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return es(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=er(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=we(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)cz[e]=this._cascades[e];return cz.length=this._numCascades,cz}start(e,r,i,s,n){ht(this.enabled);const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(){var e;ht(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!To(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||E(),ce(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Fl(Voe,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Goe[16*r+i]=Voe[i]}}return Goe}moveSnapshot(e){var r,i;ht(this.enabled),(r=this._handle)==null||r.detachDepth(),(i=this._snapshots[e])==null||i.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,u,h;const r=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!r)return;(u=this._snapshots[e])==null||u.release();const{width:i,height:s}=r,n=e===Hw.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(i,s,n,ji.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((h=this._snapshots[e])==null?void 0:h.getTexture(),Sr.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(_s.TEXTURE_2D,0,0,0,0,0,i,s),o.bindTexture(a,Sr.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var r;return this.enabled?(r=this._snapshots[e])==null?void 0:r.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=sw(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return mWe(a/this._numCascades)}_ensureFbo(){var e,r,i,s;((e=this._handle)==null?void 0:e.fbo.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((i=this._handle)==null||i.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",ji.RGBA4)),(s=this._handle)==null||s.acquireDepth(Fo.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=er(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var r;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((r=this._handle)==null?void 0:r.fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);ht(l<c);for(let f=0;f<8;++f){es(Foe,f%4==0||f%4==3?-1:1,f%4==0||f%4==1?-1:1,f<4?l:c,1);const g=nh[f];wc(g,Foe,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Eo(lz,nh[0]),n.camera.viewMatrix=Fl(jnt,this._modelViewLight,lz);for(let f=0;f<8;++f)Ge(nh[f],nh[f],n.camera.viewMatrix);let u=nh[0][2],h=nh[0][2];for(let f=1;f<8;++f)u=Math.min(u,nh[f][2]),h=Math.max(h,nh[f][2]);u-=200,h+=200,n.camera.near=-h,n.camera.far=-u,Ynt(i,s,u,h,n.camera),ri(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureHeight;n.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,r){ri(this._projectionView,e.projectionMatrix,e.viewMatrix),cn(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Ne.Global?e.eye:te(lz,0,0,1);H6(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Tqe(r/e,4)),s);const n=(r-e)/this._numCascades,o=(r/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Pt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const jnt=xe(),Foe=Yt(),nh=[];for(let t=0;t<8;++t)nh.push(Yt());const koe=je(),Uoe=je(),Hnt=je(),zoe=je(),Boe=je(),lz=E(),cz=[],Voe=xe(),Goe=ts.concat(ts,ts,ts,ts),zc=je(),qx=je(),J1=[je(),je(),je(),je()],On=je(),uz=je(),ny=je(),n3=je(),Wx=je(),Yx=je(),zI=je();function qnt(t,e,r,i,s,n,o,a){cr(zc,0,0);for(let C=0;C<4;++C)Ud(zc,zc,t[C]);_c(zc,zc,.25),cr(qx,0,0);for(let C=4;C<8;++C)Ud(qx,qx,t[C]);_c(qx,qx,.25),dh(J1[0],t[4],t[5],.5),dh(J1[1],t[5],t[6],.5),dh(J1[2],t[6],t[7],.5),dh(J1[3],t[7],t[4],.5);let l=0,c=S5(J1[0],zc);for(let C=1;C<4;++C){const P=S5(J1[C],zc);P<c&&(c=P,l=C)}Uf(On,J1[l],t[l+4]);const u=On[0];let h,p;On[0]=-On[1],On[1]=u,Uf(uz,qx,zc),vn(uz,On)<0&&mZ(On,On),dh(On,On,uz,r),hO(On,On),h=p=vn(Uf(ny,t[0],zc),On);for(let C=1;C<8;++C){const P=vn(Uf(ny,t[C],zc),On);P<h?h=P:P>p&&(p=P)}Vn(i,zc),_c(ny,On,h-e),Ud(i,i,ny);let f=-1,g=1,_=0,v=0;for(let C=0;C<8;++C){Uf(n3,t[C],i),hO(n3,n3);const P=On[0]*n3[1]-On[1]*n3[0];P>0?P>f&&(f=P,_=C):P<g&&(g=P,v=C)}Mx(f>0,"leftArea"),Mx(g<0,"rightArea"),_c(Wx,On,h),Ud(Wx,Wx,zc),_c(Yx,On,p),Ud(Yx,Yx,zc),zI[0]=-On[1],zI[1]=On[0];const b=X$(i,t[v],Yx,Ud(ny,Yx,zI),1,s),w=X$(i,t[_],Yx,ny,1,n),T=X$(i,t[_],Wx,Ud(ny,Wx,zI),1,o),S=X$(i,t[v],Wx,ny,1,a);Mx(b,"rayRay"),Mx(w,"rayRay"),Mx(T,"rayRay"),Mx(S,"rayRay")}function Ar(t,e){return 3*e+t}const joe=je();function jl(t,e){return cr(joe,t[e],t[e+3]),joe}const ol=je(),it=xi();function Wnt(t,e,r,i,s){Uf(ol,r,i),_c(ol,ol,.5),it[0]=ol[0],it[1]=ol[1],it[2]=0,it[3]=ol[1],it[4]=-ol[0],it[5]=0,it[6]=ol[0]*ol[0]+ol[1]*ol[1],it[7]=ol[0]*ol[1]-ol[1]*ol[0],it[8]=1,it[Ar(0,2)]=-vn(jl(it,0),t),it[Ar(1,2)]=-vn(jl(it,1),t);let n=vn(jl(it,0),r)+it[Ar(0,2)],o=vn(jl(it,1),r)+it[Ar(1,2)],a=vn(jl(it,0),i)+it[Ar(0,2)],l=vn(jl(it,1),i)+it[Ar(1,2)];n=-(n+a)/(o+l),it[Ar(0,0)]+=it[Ar(1,0)]*n,it[Ar(0,1)]+=it[Ar(1,1)]*n,it[Ar(0,2)]+=it[Ar(1,2)]*n,n=1/(vn(jl(it,0),r)+it[Ar(0,2)]),o=1/(vn(jl(it,1),r)+it[Ar(1,2)]),it[Ar(0,0)]*=n,it[Ar(0,1)]*=n,it[Ar(0,2)]*=n,it[Ar(1,0)]*=o,it[Ar(1,1)]*=o,it[Ar(1,2)]*=o,it[Ar(2,0)]=it[Ar(1,0)],it[Ar(2,1)]=it[Ar(1,1)],it[Ar(2,2)]=it[Ar(1,2)],it[Ar(1,2)]+=1,n=vn(jl(it,1),e)+it[Ar(1,2)],o=vn(jl(it,2),e)+it[Ar(2,2)],a=vn(jl(it,1),r)+it[Ar(1,2)],l=vn(jl(it,2),r)+it[Ar(2,2)],n=-.5*(n/o+a/l),it[Ar(1,0)]+=it[Ar(2,0)]*n,it[Ar(1,1)]+=it[Ar(2,1)]*n,it[Ar(1,2)]+=it[Ar(2,2)]*n,n=vn(jl(it,1),e)+it[Ar(1,2)],o=vn(jl(it,2),e)+it[Ar(2,2)],a=-o/n,it[Ar(1,0)]*=a,it[Ar(1,1)]*=a,it[Ar(1,2)]*=a,s[0]=it[0],s[1]=it[1],s[2]=0,s[3]=it[2],s[4]=it[3],s[5]=it[4],s[6]=0,s[7]=it[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=it[6],s[13]=it[7],s[14]=0,s[15]=it[8]}function Ynt(t,e,r,i,s){const n=1/nh[0][3],o=1/nh[4][3];ht(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Bn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,qnt(nh,a,l,koe,Uoe,Hnt,zoe,Boe),Wnt(koe,Uoe,zoe,Boe,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function Xnt(t){return Wh(t)&&t.intersector===ki.TERRAIN&&!!t.target}let Znt=class extends dR{constructor(e,r,i){super(e,r),this.triangleNr=i}};function FEe(t){return Wh(t)&&t.intersector===ki.OVERLAY&&!!t.target}let dq=class{constructor(){this.adds=new kt,this.removes=new kt,this.updates=new kt({allocator:e=>e||new Jnt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Jnt=class{},Knt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Ji,Tn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Ji||(Ji={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Tn||(Tn={}));var Wd;function kEe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new Knt,e.set(i,s)),s};return t.removes.forAll(i=>{hz(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{hz(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{hz(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function hz(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Wd||(Wd={}));let UEe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}dispose(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){const s=this._material.produces.get(r);if(!s||!s(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const n=this._map.get(i);if(n!=null){if(n.ensureResources(e)===X_.LOADED)return n;this._repository.requestRender()}return null}},pq=class extends BTe{constructor(e=E()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},nK=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function Hoe(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;){r=!1;for(let i=0;i<t.length;++i){const s=t.data[i],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),r=!0}}}let qoe=class extends nK{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},Qnt=class{constructor(){this.first=0,this.count=0}},eot=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new kt({allocator:e=>e||new nK,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=BI(),this.drawCommandsHighlight=BI(),this.drawCommandsOccludees=BI(),this.drawCommandsShadowHighlightRest=BI()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(Woe(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),Woe(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function tot(t){return t.vao!=null}function BI(){return new kt({allocator:t=>t||new Qnt,deallocator:t=>t})}function Woe(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(rot(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function rot(t,e){return t.first+t.count>=e.from}let iot=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const fq=-3,zEe=fq-1;var Bd;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Bd||(Bd={}));let sot=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=not+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}peek(e){return this._storage.peek(this,e)}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},BEe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new kt,this._users=new kt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,r){const i=this._db.get(e.id+r);return(i==null?void 0:i.size)??0}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,o.size,Bd.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,s,Bd.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${r}`),void this._notifyRemove(r,i,0,Bd.ALL);const a=1+Math.max(n,zEe)-fq;this._db.set(r,new oot(i,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,s,Bd.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}peek(e,r){const i=this._db.get(e.id+r);return i?++this._hit:++this._miss,i==null?void 0:i.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:h}=c;if(a.startsWith(u)){const p=r[h]||0;r[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+fq-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,i.size,Bd.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,e.size,Bd.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](r,s,i);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const r=e??this;if(r.maxSize<0||r.size<=r.maxSize)return;const i=e==null?void 0:e.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!i||n.startsWith(i))){if(this._purgeItem(n,o,e),r.size<=.9*r.maxSize)return;s||(s=this._db.has(n))}}for(const[n,o]of this._db)if((!i||n.startsWith(i))&&(this._purgeItem(n,o,e),r.size<=.9*r.maxSize))return}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,r.size,Bd.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},not=0,oot=class{constructor(e,r,i){this.entry=e,this.size=r,this.lifetime=i,this.lives=i}},UR=class{constructor(e,r){this._cache=e(r,(i,s,n)=>this._remove(i,s,n))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const r=this._cache.peek(e);if(!r)return;const i=r.pop();if(r.length>0){if(i){const s=this._cache.getSize(e)-Math.round(i.usedMemory);this._cache.updateSize(e,r,s)}}else this._cache.pop(e);return i}put(e,r,i=zEe){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[r],r.usedMemory,i);s.push(r);const n=this._cache.getSize(e)+Math.round(r.usedMemory);this._cache.updateSize(e,s,n)}_remove(e,r,i){switch(r){case Bd.ALL:return e.forEach(s=>s.dispose()),0;case Bd.SOME:{const s=e.shift();return s&&(i-=Math.round(s.usedMemory),s.dispose()),i}}}},aot=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=new UR(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const r=e.toString();let i=this._cache.pop(r);return i||(i=new Dp(this._rctx,this._locations,{geometry:this._layout},{geometry:qr.createVertex(this._rctx,Pr.STATIC_DRAW)}),i.vertexBuffers.geometry.setSize(e),i)}deleteVao(e){if(e==null)return;const r=e.byteSize.toString();this._cache.put(r,e)}},uM=class extends Ixe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=ft(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=ft(this._vaoCache)}initialize(){this.material.produces.forEach((e,r)=>{this._produces.set(r,i=>!(this._dataByOrigin.size===0||!(i!==k.Highlight&&i!==k.ShadowHighlight||this._hasHighlights))&&e(i))})}get produces(){return this._produces}initializeRenderContext(e,r){const{rctx:i}=e.renderContext;this._glMaterials=new UEe(this.material,r??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new aot(i,this.material.vertexAttributeLocations,Ic(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter;if(r===null)return;const i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Tn.GEOMETRY|Tn.TRANSFORMATION)){const c=jI(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}s.updateType&(Tn.HIGHLIGHT|Tn.OCCLUDEE|Tn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new t1;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new Yoe(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new Yoe(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let h=s.get(l);if(a.forEach((p,f)=>{if(o.delete(l,f),f==null)return void ht(!1,"No VAO for removed geometries");if(f.instances.size===p.changes.length)return this._vaoCache.deleteVao(f.vao),$M(h.buffers,f),void(h.buffers.length===0&&u.length===0&&s.delete(l));const g=f.numElements,_=f.vao.byteSize/4,v=u.reduce((S,C)=>S+i.elementCount(C.geometry),0),b=p.changes.reduce((S,C)=>S+i.elementCount(C.geometry),0),w=Math.min((g+v-b)*n,GI),T=w>_;w>hF&&w<_/2?(p.changes.forEach(({id:S})=>f.deleteInstance(S)),f.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(f.vao),$M(h.buffers,f)):T?this._applyAndRebuild(f,u,p):this._applyRemoves(f,p)}),u.length>0)for(h==null&&(h=new iot(c.origin),s.set(l,h)),h.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)h.buffers.push(this._applyAndRebuild(new eot,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,vh(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const g of i.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(GI/o);let l=e.numElements;for(;r.length>0;){const g=r.pop(),_=s.elementCount(g.geometry);if(l+_>a&&l>0){r.push(g);break}l+=_;const v=new qoe(g,0,0);ht(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=jI(c),h=s.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,_)=>{this._writeGeometry(g.geometry,h,p);const v=p;p+=s.elementCount(g.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Joe(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const f=e.holes.pushNew();return f.from=p,f.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0||this._bufferWriter===null)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Wp.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const h=Wp.pushNew();h.from=c.from,h.to=c.to}Hoe(Wp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Wp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=jI(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Wp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),e.holes.pushArray(Wp.data,Wp.length),Wp.forAll((a,l)=>Wp.data[l]=null),Wp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0||this._bufferWriter===null)return;if(!tot(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((b,w)=>b+i.elementCount(w.geometry),0),a=Math.min((n+o)*s,GI),l=4*a;if(e.vao.byteSize<Joe(GI-hF)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);Hoe(e.holes);const c=new Array;for(const b of r){const w=i.elementCount(b.geometry),T=lot(e.holes,w);c.push(T)}const u=e.vao.vertexBuffers.geometry;let h=0,p=0,f=0;const g=jI(a),_=i.vertexBufferLayout.createView(g.buffer);r.forEach((b,w)=>{const T=c[w];if(T==null)return;if(f!==T){const P=f-p;P>0&&u.setSubData(g,p*s,0,P*s),p=T,h=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,_,h),h+=S,f=T+S;const C=new qoe(b,T,T+S);ht(e.instances.get(b.id)==null),e.addInstance(b.id,C),e.drawCommandsDirty=!0});const v=f-p;v>0&&u.setSubData(g,p*s,0,v*s),B$e(r,(b,w)=>c[w]==null)}_writeGeometry(e,r,i){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;Sqe(Xoe,-s[0],-s[1],-s[2]);const n=ri(cot,Xoe,e.transformation);cn(VI,n),Ac(VI,VI),this._bufferWriter.write(n,VI,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:r,bindParameters:i}=e,s=this.material.produces.get(i.slot);if(!s||!s(r))return null;const n=r===k.Highlight||r===k.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=r===k.ShadowExcludeHighlight,a=!(n||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(n&&!c.hasHighlights)continue;const u=(n?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,h=a&&c.drawCommandsOccludees||null;if(u!=null&&u.length||h!=null&&h.length){const p=this._glMaterials.load(e.rctx,i.slot,r),f=p!=null?p.beginSlot(i):null;if(f!=null)return f}}return null}renderNode(e,r){const{output:i,bindParameters:s}=e,n=i===k.Highlight||i===k.ShadowHighlight,o=i===k.ShadowExcludeHighlight,a=!(n||o),l=e.rctx,c=e.bindParameters.slot===ue.OCCLUDER_MATERIAL,u=e.bindParameters.slot===ue.TRANSPARENT_OCCLUDER_MATERIAL;l.runAppleAmdDriverHelper(),l.bindTechnique(r,s,this.material.parameters);for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(n&&!p.hasHighlights)continue;const f=(n?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,g=a&&p.drawCommandsOccludees||null;(f!=null&&f.length||g!=null&&g.length)&&(r.program.bindDraw(new pq(h.origin),s,this.material.parameters),r.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),f!=null&&f.length&&(l.setPipelineState(r.getPipeline(!1,c,u)),f.forAll(_=>l.drawArrays(r.primitiveType,_.first,_.count))),g!=null&&g.length&&(l.setPipelineState(r.getPipeline(!0,c,u)),g.forAll(_=>l.drawArrays(r.primitiveType,_.first,_.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};d([m({constructOnly:!0})],uM.prototype,"material",void 0),uM=d([V("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],uM);let Yoe=class{constructor(e){this.origin=e,this.changes=new Array}};function lot(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const Xoe=xe(),cot=xe(),VI=xe(),Wp=new kt({allocator:t=>t||new nK,deallocator:null}),hF=65536,dz=4*hF,Zoe=1024,VEe=16777216,GI=VEe/4;let pz=new Float32Array(hF);function jI(t){return pz.length<t&&(pz=new Float32Array(t)),pz}function Joe(t){const e=4*t;return e<=Zoe?Zoe:e<dz?Hfe(e):Math.max(Math.min(Math.ceil(1.5*e/dz)*dz,VEe),e)}let Zc=class extends Me{constructor(e){super(e),this._pending=new uot,this._changes=new dq,this._materialRenderers=new kt,this._sortedMaterialRenderers=new kt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return this._materialRenderers.some(e=>e.numGeometries!==0&&!e.queryRenderOccludedState(Ur.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){if(e==null)return 0;const r=this._materialRenderers.find(i=>i.materialReference===e);return(r==null?void 0:r.usedMemory)??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=kEe(this._changes);let r=!1;return e.forEach((i,s)=>{let n=this._materialRenderers.find(o=>o.materialReference===s);if(!n&&i.adds.length>0){const o=new uM({material:s});o.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),n=o,this._materialRenderers.push(n),r=!0}n&&(n.modify(i),n.numGeometries===0&&(this._materialRenderers.removeUnordered(n),n.destroy(),r=!0))}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),this._hasHighlights=this._materialRenderers.some(i=>{const s=i.produces.get(ue.DRAPED_MATERIAL);return!!s&&s(k.Highlight)}),this._hasWater=this._materialRenderers.some(i=>{const s=i.produces.get(ue.DRAPED_WATER);return!!s&&s(k.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===Ji.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Ji.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Tn.TRANSFORMATION:case Tn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Tn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=!!i.updateAnimation&&i.updateAnimation(e)||r),r}shouldRender(e){return this._sortedMaterialRenderers.some(r=>r.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(r=>{const i=r.prepareTechnique(e);i!=null&&r.renderNode(e,i)})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,r)=>{e.drapedPriority=r,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,r)=>{var i,s,n,o;return((i=r.materialReference)==null?void 0:i.renderPriority)===((s=e.materialReference)==null?void 0:s.renderPriority)?e.drapedPriority-r.drapedPriority:(((n=r.materialReference)==null?void 0:n.renderPriority)||0)-(((o=e.materialReference)==null?void 0:o.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],fz[0]=i[0]-s,fz[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,fz,(l,c,u)=>{hot(r,u,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([m()],Zc.prototype,"drapeSource",void 0),d([m()],Zc.prototype,"updating",null),d([m()],Zc.prototype,"rctx",null),d([m({constructOnly:!0})],Zc.prototype,"rendererContext",void 0),d([m()],Zc.prototype,"_materialRepository",null),d([m()],Zc.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],Zc.prototype,"isEmpty",null),d([m()],Zc.prototype,"_materialRenderers",void 0),d([m()],Zc.prototype,"_geometries",void 0),Zc=d([V("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Zc);let uot=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function hot(t,e,r,i,s,n,o){const a=new Znt(n,o,e),l=c=>{c.set(ki.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Co.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Co.ALL){const c=$X(s.ray);l(c),s.results.all.push(c)}}const fz=je();let oK=class GEe extends Gr{initializeProgram(e){return new Dr(e.rctx,GEe.shader.get().build(),Mr)}initializePipeline(){return this.configuration.hasAlpha?Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt}):Nt({colorWrite:qt})}};oK.shader=new Lr(Est,()=>me(()=>Promise.resolve().then(()=>mAt),void 0));let aK=class extends zl{constructor(){super(...arguments),this.hasAlpha=!1}};d([G()],aK.prototype,"hasAlpha",void 0);let lK=class extends Ci{constructor(){super(...arguments),this.overlayIndex=rn.INNER,this.opacity=1}};function jEe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("tex",e=>e.texture)),t.fragment.uniforms.add(new $R("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ie("opacity",e=>e.opacity)),t.fragment.code.add(x`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const dot=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:lK,build:jEe},Symbol.toStringTag,{value:"Module"}));let HEe=class qEe extends Gr{initializeProgram(e){return new Dr(e.rctx,qEe.shader.get().build(),Mr)}initializePipeline(){return Nt({blending:Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};HEe.shader=new Lr(dot,()=>me(()=>Promise.resolve().then(()=>gAt),void 0));let Zu=class extends ux{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new lK,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new kt,this._passParameters=new JJ,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Je,this.worldToPCSRatio=1,this.events=new Gs,this.longitudeCyclical=null,this.produces=new Map([[ue.DRAPED_MATERIAL,r=>r!==k.Highlight||this.hasHighlights],[ue.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,r=this.view._stage.renderView,{waterTextures:i,stippleTextures:s,markerTextures:n}=r;this._shaderTechniques=new lEe({rctx:this._rctx,viewingMode:Ne.Local,stippleTextureRepository:s,markerTextureRepository:n,waterTextureRepository:i}),this._renderContext=new NEe(this._rctx,new sK(e,this.view.state.viewingMode),null),this.addHandles([he(()=>i.updating,()=>this.events.emit("content-changed"),si),he(()=>this.spatialReference,o=>this._localOriginFactory=new iK(o),si),Ho(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new cEe(r.textureRepository,this._shaderTechniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ue.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=dt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new OZ(Pe(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(yt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=er(this._debugTextureTechnique),this._passParameters.texture=ft(this._passParameters.texture),this._shaderTechniques=Ae(this._shaderTechniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||vh(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((r,i)=>r+i.getMemoryForMaterial(e),0)}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Zc)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(he(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),r.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&hD(e,r=>r.drapeTargetType===lq.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=hD(e,r=>r.drapeSourceType===aM.Features),this._hasDrapedRasterSource=hD(e,r=>r.drapeSourceType===aM.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,r,i=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new mst(this.view._stage.renderer.fboCache),this._overlays=[new Coe,new Coe]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=ft(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var r,i;if(e!=null)return e===Fi.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(r=this._renderTargets)==null?void 0:r.getTexture(Fi.Color):(i=this._renderTargets)==null?void 0:i.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=vh(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Wa,e=>e.updatePolicy===P_.SYNC)}get isEmpty(){return!yi.OVERLAY_DRAW_DEBUG_TEXTURE&&!vh(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=dF;const r=this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,r}renders(e){return yi.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==Fi.Occluded||this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext))}get mode(){var e,r;return this.isEmpty?Zf.Disabled:(e=this._renderTargets)!=null&&e.getTexture(Fi.WaterNormal)?Zf.EnabledWithWater:(r=this._renderTargets)!=null&&r.getTexture(Fi.Color)?Zf.Enabled:Zf.Disabled}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const r of this._overlays)this.longitudeCyclical?r.setupGeometryViewsCyclical(this.longitudeCyclical):r.setupGeometryViewsDirect();for(const r of this._renderTargets.targets){if(r.content===Fi.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=this._drawTarget(rn.INNER,r,e),s=this._drawTarget(rn.OUTER,r,e);(i||s)&&r.fbo.generateMipMap()}}}_drawTarget(e,r,i){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=i;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=r.output;if(this.isEmpty||l===k.Highlight&&!this.hasHighlights||l===k.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===k.Normal?ue.DRAPED_WATER:ue.DRAPED_MATERIAL,r.content===Fi.Occluded&&(this._renderContext.renderOccludedMask=dF),!this.renders(r.content))return this._renderContext.renderOccludedMask=uF,!1;const u=s.resolution;this._rctx.setViewport(e===rn.INNER?0:u,0,u,u);const h=2*s.resolution,p=s.resolution,f=r.fbo;if(f.bind(c,h,p),e===rn.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Si.COLOR_BUFFER_BIT)),yi.OVERLAY_DRAW_DEBUG_TEXTURE&&r.content!==Fi.Occluded)for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],s),this._ensureDebugPatternResources(s.resolution,fot[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:_})=>{if(r.content===Fi.ColorNoRasterImage&&g.drapeSourceType===aM.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===k.Color?this.bindTemporaryFramebuffer(h,p):null;for(let w=0;w<n.numViews;w++)this._setViewParameters(n.extents[w],s),_.render(this._renderContext);if(b){f.bind(c,h,p),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniqueRepository.acquire(HEe);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=uF,!0}bindTemporaryFramebuffer(e,r){const i=this.view._stage.renderer.fboCache,s=i.acquire(e,r,"overlay tmp");return i.rctx.unbindTexture(s.fbo.colorTexture),i.rctx.bindFramebuffer(s.fbo),i.rctx.clearSafe(Si.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._shaderTechniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=((o=a.intersect)==null?void 0:o.call(a,e,r,i,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,r=e.length;this._renderers.forEach((i,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?nF.MapLayer:nF.ViewLayer),l=r*a+(o?n:0);this._sortedRenderers.push(new pot(s,i,l))}),this._sortedRenderers.sort((i,s)=>i.index-s.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],nye(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),cR(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=vh(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,r){if(te(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new oi(e);n.samplingMode=Gt.NEAREST,this._passParameters.texture=new Sr(this._rctx,n,i);const o=new aK;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniques.acquire(oK,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),sortedDrapeSources:Array.from(this._sortedRenderers).map(({drapeSource:e})=>e),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};d([m()],Zu.prototype,"hasHighlights",void 0),d([m()],Zu.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m()],Zu.prototype,"_shaderTechniques",void 0),d([m({constructOnly:!0})],Zu.prototype,"view",void 0),d([m()],Zu.prototype,"worldToPCSRatio",void 0),d([m()],Zu.prototype,"spatialReference",void 0),d([m({type:Boolean,readOnly:!0})],Zu.prototype,"updating",null),d([m()],Zu.prototype,"isEmpty",null),d([m({readOnly:!0})],Zu.prototype,"rendersOccludedDraped",null),Zu=d([V("esri.views.3d.terrain.OverlayRenderer")],Zu);let pot=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const fot=[[1,.5,.5],[.5,.5,1]],cK=-2,dF=Ur.OccludeAndTransparent;function uK(t,e,r,i){const s=FR(t.rings,!!t.hasZ&&i.mode!=="on-the-ground",Em.CCW_IS_HOLE,t.spatialReference),n=ao(s.position.length),o=bTe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new yot(s.position,n,XEe(s.polygons,s.position,n),YEe(s.outlines,s.position,n),a,o)}function WEe(t,e){const r=FR(t.rings,!1,Em.CCW_IS_HOLE),i=Wi(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=cK;return{position:r.position,polygons:XEe(r.polygons,r.position),outlines:YEe(r.outlines,r.position),projectionSuccess:i}}function YEe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new ZEe(i,s,Ah(e,n,o),Ah(r,n,o)):new hK(i,s,Ah(e,n,o))})}function XEe(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),h=r!=null?new mot(s,n,Ah(e,3*s,3*n),Ah(r,l,c),u,a):new got(s,n,Ah(e,3*s,3*n),u,a);i.push(h)}return i}let hK=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},ZEe=class extends hK{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},mot=class extends ZEe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},got=class extends hK{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},yot=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function $p(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,h=e*n;t[h]=Koe(c),t[h+1]=Koe(u)}function _ot(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)$p(r,s,t[i++],t[i++],t[i++]);return r}function u6t(t,e){const r=t.length/3,i=new Int16Array(2*r);let s=0;const n=E();for(let o=0;o<r;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],Bo(n,n,e),$p(i,o,n[0],n[1],n[2]);return i}function vot(t,e,r,i=2){const s=r*i,n=Qoe(e[s]),o=Qoe(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),fe(t,t)}function Koe(t){return we(Math.round(32767*t),-32767,32767)}function Qoe(t){return we(t/32767,-1,1)}const bot=["polygon","extent"];let wot=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=n8(this._getSymbolSize());if(c)throw new J("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=la(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?Ei.None:Ei.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ir.Compressed};this._materials[Jc.Main]=new Pp(o),this._materials[Jc.Bottom]=new Pp({...o,cullFace:Ei.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,bot,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){var a,l,c,u;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;(c=this._materials[Jc.Main])==null||c.setParameters({opacity:s,transparent:n}),(u=this._materials[Jc.Bottom])==null||u.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(h=>{const p=r(h);p!=null&&p.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,i1)}slicePlaneEnabledChanged(e,r){var i,s;return(i=this._materials[Jc.Main])==null||i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(s=this._materials[Jc.Bottom])==null||s.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(n=>{const o=r(n);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var r,i;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(r=this._materials[Jc.Main])==null||r.setParameters(e),(i=this._materials[Jc.Bottom])==null||i.setParameters(e),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?ist(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?zs.RecreateSymbol:zs.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/HM(r),{objectId:o,target:a}=e,l=ge(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,h=ge(c),p=ge(u);return h.z=(h.z??0)+n,p.z=(p.z??0)+n,[woe(o,l,1/0,h,p)]}case"vertex":return[Bit(o,l,1/0),woe(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=EO(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(L=>L.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=uK(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=PJ(o);if(l==null)return null;const c=new Array,u=new Array,h=Mn(),p=xe(),f=E(),g=this._context.renderCoordsHelper.viewingMode===Ne.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,f),$l(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=xe();cn(_,p);const v=xi();a0(v,_);const{polygons:b,mapPositions:w,position:T}=a;for(const L of b){const F=L.count;if(this._context.clippingExtent&&(Ri(h),pu(h,L.mapPositions),!sp(h,this._context.clippingExtent)))continue;const U=TE(L.mapPositions,L.holeIndices,3);if(U.length===0)continue;const j=U.length,z=6*F,Z=N5(z+j),W=N5(j),Y=ao(3*z),le=ao(3*z),I=ao(3*z),N=ao(z);xot(T,w,U,L,Y,I,le,N,Z,W,this._getExtrusionSize(r),f,g),Op(Y,Y,_);const B=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),H=new Aot(Y,I,_ot(le),N);c.push(eae(this._materials[Jc.Main],Z,Z.length-W.length,H,i,B),eae(this._materials[Jc.Bottom],W,0,H,i,B)),u.push(H.heights)}if(c.length===0)return null;const S=new P0({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=p;const C=kTe(this.symbolLayer,{opacity:this._getLayerOpacity()}),P=C!=null?{baseMaterial:this._materials[Jc.Main],edgeMaterials:[C],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new Dm(this,S,c,null,null,(L,F,U,j,z)=>Eot(L,F,U,j,z,u),s,P);return R.alignedSampledElevation=a.sampledElevation,R.needsElevationUpdates=i1(s.mode),R}};function eae(t,e,r,i,s,n){const o=v1(e.length),a=[[O.POSITION,new qe(i.positions,e,3,!0)],[O.NORMALCOMPRESSED,new qe(i.normals,e,2,!0)],[O.COLOR,new qe(s,o,4,!0)]];return new un(t,a,i.elevation,vs.Mesh,n,r)}function xot(t,e,r,i,s,n,o,a,l,c,u,h,p){const f=r.length/3;let g=0,_=2*i.count;Tot(t,e,i.index,i.count,r,0,f,s,n,o,a,l,c,_,u,h,p);let v=2*i.count;_=0,tae(s,n,a,o,g,i.pathLengths[0],i.count,v,l,_,u),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)tae(s,n,a,o,g,i.pathLengths[b],i.count,v,l,_,u),v+=4*i.pathLengths[b],_+=2*i.pathLengths[b],g+=i.pathLengths[b]}function Tot(t,e,r,i,s,n,o,a,l,c,u,h,p,f,g,_,v){ce(al,_);const b=g>0?1:-1;let w=3*r,T=0,S=3*T,C=i,P=3*C;for(let F=0;F<i;++F)v&&(al[0]=t[w],al[1]=t[w+1],al[2]=t[w+2],fe(al,al)),a[S]=t[w],a[S+1]=t[w+1],a[S+2]=t[w+2],l[S]=e[w],l[S+1]=e[w+1],l[S+2]=e[w+2],c[S]=-b*al[0],c[S+1]=-b*al[1],c[S+2]=-b*al[2],u[T]=0,a[P]=t[w]+g*al[0],a[P+1]=t[w+1]+g*al[1],a[P+2]=t[w+2]+g*al[2],l[P]=e[w],l[P+1]=e[w+1],l[P+2]=e[w+2],c[P]=b*al[0],c[P+1]=b*al[1],c[P+2]=b*al[2],u[C]=g,S+=3,P+=3,w+=3,T+=1,C+=1;w=3*n,S=0,P=3*f;const R=g<0?aae:oae,L=g<0?oae:aae;for(let F=0;F<o;++F)p[S]=s[w+R[0]],p[S+1]=s[w+R[1]],p[S+2]=s[w+R[2]],h[P]=s[w+L[0]]+i,h[P+1]=s[w+L[1]]+i,h[P+2]=s[w+L[2]]+i,S+=3,P+=3,w+=3}function HI(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const o3=E();function tae(t,e,r,i,s,n,o,a,l,c,u){let h=s,p=s+1,f=s+o,g=s+o+1,_=a,v=a+1,b=a+2*n,w=a+2*n+1;u<0&&(h=s+o+1,g=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(u>0?(p=s,g=s+o):(p=s,h=s+o)),Sot(t,h,p,f,o3),HI(t,e,i,r,o3,_,h),HI(t,e,i,r,o3,v,p),HI(t,e,i,r,o3,b,f),HI(t,e,i,r,o3,w,g),l[c++]=_,l[c++]=b,l[c++]=w,l[c++]=_,l[c++]=w,l[c++]=v,h++,p++,f++,g++,_+=2,v+=2,b+=2,w+=2}const mz=E(),rae=E(),iae=E(),sae=E(),nae=E();function Sot(t,e,r,i,s){e*=3,r*=3,i*=3,te(mz,t[e++],t[e++],t[e++]),te(rae,t[r++],t[r++],t[r++]),te(iae,t[i++],t[i++],t[i++]),ye(sae,rae,mz),ye(nae,iae,mz),Ze(s,nae,sae),fe(s,s)}const Xx=E();function Eot(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const h=o.transformation,p=YE(xe(),h);for(let f=0;f<l;f+=2){const g=a[f];if(!CJ(g))continue;const _=g.getMutableAttribute(O.POSITION).data,v=n[f/2],b=new LX(g.mapPositions),w=_.length/3;let T=0,S=!1,C=0;for(let P=0;P<w;P++){Xx[0]=_[T],Xx[1]=_[T+1],Xx[2]=_[T+2],i(b,qI),c&&(C+=qI.sampledElevation),yi.TESTS_DISABLE_OPTIMIZATIONS?(te(Hl,b.array[b.offset],b.array[b.offset+1],qI.z+v[T/3]),r!=null&&s.toRenderCoords(Hl,r,Hl),Ge(Hl,Hl,p)):(te(Hl,_[T],_[T+1],_[T+2]),Ge(Hl,Hl,h),s.setAltitude(Hl,qI.z+v[T/3]),Ge(Hl,Hl,p)),_[T]=Hl[0],_[T+1]=Hl[1],_[T+2]=Hl[2];const R=Cot/s.unitInMeters;(Math.abs(Xx[0]-_[T])>=R||Math.abs(Xx[1]-_[T+1])>=R||Math.abs(Xx[2]-_[T+2])>=R)&&(S=!0),b.offset+=3,T+=3}S&&(g.invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[f],O.POSITION),a[f+1].invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[f+1],O.POSITION)),u+=C/w}return u/l}const Hl=E(),al=E(),qI=new RR,oae=[0,2,1],aae=[0,1,2],Cot=.01;var Jc;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(Jc||(Jc={}));let Aot=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};const WI=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["Â«","Â»"],["Â»","Â«"],["â€¹","â€º"],["â€º","â€¹"],["â½","â¾"],["â¾","â½"],["â‚","â‚Ž"],["â‚Ž","â‚"],["â‰¤","â‰¥"],["â‰¥","â‰¤"],["âŒ©","âŒª"],["âŒª","âŒ©"],["ï¹™","ï¹š"],["ï¹š","ï¹™"],["ï¹›","ï¹œ"],["ï¹œ","ï¹›"],["ï¹","ï¹ž"],["ï¹ž","ï¹"],["ï¹¤","ï¹¥"],["ï¹¥","ï¹¤"]],SE=["Ø¢","Ø£","Ø¥","Ø§"],Pot=["ï»µ","ï»·","ï»¹","ï»»"],Mot=["ï»¶","ï»¸","ï»º","ï»¼"],pF=["Ø§","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ","Ø¥","Ø£","Ø¢","Ø©","Ù‰","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ","Ø¥","Ø£","Ø¢","Ø©","Ù‰","ÛŒ","Ø¦","Ø¤"],Oot=["ïº","ïº","ïº•","ïº™","ïº","ïº¡","ïº¥","ïº©","ïº«","ïº­","ïº¯","ïº±","ïºµ","ïº¹","ïº½","ï»","ï»…","ï»‰","ï»","ï»‘","ï»•","ï»™","ï»","ï»¡","ï»¥","ï»©","ï»­","ï»±","ïº‡","ïºƒ","ïº","ïº“","ï»¯","ï¯¼","ïº‰","ïº…","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïº‰","ïº…"],Rot=["ïºŽ","ïº","ïº–","ïºš","ïºž","ïº¢","ïº¦","ïºª","ïº¬","ïº®","ïº°","ïº²","ïº¶","ïºº","ïº¾","ï»‚","ï»†","ï»Š","ï»Ž","ï»’","ï»–","ï»š","ï»ž","ï»¢","ï»¦","ï»ª","ï»®","ï»²","ïºˆ","ïº„","ïº‚","ïº”","ï»°","ï¯½","ïºŠ","ïº†","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïºŠ","ïº†"],$ot=["ïºŽ","ïº’","ïº˜","ïºœ","ïº ","ïº¤","ïº¨","ïºª","ïº¬","ïº®","ïº°","ïº´","ïº¸","ïº¼","ï»€","ï»„","ï»ˆ","ï»Œ","ï»","ï»”","ï»˜","ï»œ","ï» ","ï»¤","ï»¨","ï»¬","ï»®","ï»´","ïºˆ","ïº„","ïº‚","ïº”","ï»°","ï¯¿","ïºŒ","ïº†","ï¹±","ï¹²","ï¹´","ï¹·","ï¹¹","ï¹»","ï¹½","ï¹¿","ïº€","ïºŒ","ïº†"],Iot=["ïº","ïº‘","ïº—","ïº›","ïºŸ","ïº£","ïº§","ïº©","ïº«","ïº­","ïº¯","ïº³","ïº·","ïº»","ïº¿","ï»ƒ","ï»‡","ï»‹","ï»","ï»“","ï»—","ï»›","ï»Ÿ","ï»£","ï»§","ï»«","ï»­","ï»³","ïº‡","ïºƒ","ïº","ïº“","ï»¯","ï¯¾","ïº‹","ïº…","ï¹°","ï¹²","ï¹´","ï¹¶","ï¹¸","ï¹º","ï¹¼","ï¹¾","ïº€","ïº‹","ïº…"],lae=["Ø¡","Ø¢","Ø£","Ø¤","Ø¥","Ø§","Ø©","Ø¯","Ø°","Ø±","Ø²","Ùˆ","Ù‰"],Lot=["Ù‹","Ù‹","ÙŒ","ØŸ","Ù","ØŸ","ÙŽ","ÙŽ","Ù","Ù","Ù","Ù","Ù‘","Ù‘","Ù’","Ù’","Ø¡","Ø¢","Ø¢","Ø£","Ø£","Ø¤","Ø¤","Ø¥","Ø¥","Ø¦","Ø¦","Ø¦","Ø¦","Ø§","Ø§","Ø¨","Ø¨","Ø¨","Ø¨","Ø©","Ø©","Øª","Øª","Øª","Øª","Ø«","Ø«","Ø«","Ø«","Ø¬","Ø¬","Ø¬","Ø¬","Ø­","Ø­","Ø­","Ø­","Ø®","Ø®","Ø®","Ø®","Ø¯","Ø¯","Ø°","Ø°","Ø±","Ø±","Ø²","Ø²","Ø³","Ø³","Ø³","Ø³","Ø´","Ø´","Ø´","Ø´","Øµ","Øµ","Øµ","Øµ","Ø¶","Ø¶","Ø¶","Ø¶","Ø·","Ø·","Ø·","Ø·","Ø¸","Ø¸","Ø¸","Ø¸","Ø¹","Ø¹","Ø¹","Ø¹","Øº","Øº","Øº","Øº","Ù","Ù","Ù","Ù","Ù‚","Ù‚","Ù‚","Ù‚","Ùƒ","Ùƒ","Ùƒ","Ùƒ","Ù„","Ù„","Ù„","Ù„","Ù…","Ù…","Ù…","Ù…","Ù†","Ù†","Ù†","Ù†","Ù‡","Ù‡","Ù‡","Ù‡","Ùˆ","Ùˆ","Ù‰","Ù‰","ÙŠ","ÙŠ","ÙŠ","ÙŠ","ï»µ","ï»¶","ï»·","ï»¸","ï»¹","ï»º","ï»»","ï»¼","ØŸ","ØŸ","ØŸ"],cae=["Ø¡","Ù"],Dot=["Øº","ÙŠ"],Not=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],Fot=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,be=1,At=2,yn=3,A=4,Df=5,CN=6,M=7,La=8,ll=9,ad=10,Ut=11,ee=12,kot=13,Uot=14,zot=15,Bot=16,Vot=17,ut=18,Got=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],$f=100,jot=[$f+0,$,$,$,$,$f+1,$f+2,$f+3,be,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$f+4,A,A,A,$,A,$,A,$,A,A,A,$,$,A,A,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,$,$,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$f+5,M,M,$f+6,$f+7],Hot=[[ut,ut,ut,ut,ut,ut,ut,ut,ut,CN,Df,CN,La,Df,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,Df,Df,Df,CN,La,A,A,Ut,Ut,Ut,A,A,A,A,A,ad,ll,ad,ll,ll,At,At,At,At,At,At,At,At,At,At,ll,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,ut,ut,ut,ut,ut,ut,Df,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ut,ll,A,Ut,Ut,Ut,Ut,A,A,A,A,$,A,A,ut,A,A,Ut,Ut,At,At,A,$,A,A,A,At,$,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,A,A,A,A,A,A,A,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,be,ee,be,ee,ee,be,ee,ee,be,ee,A,A,A,A,A,A,A,A,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,A,A,A,A,A,be,be,be,be,be,A,A,A,A,A,A,A,A,A,A,A],[yn,yn,yn,yn,A,A,A,A,M,Ut,Ut,M,ll,M,A,A,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,M,A,A,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,yn,yn,yn,yn,yn,yn,yn,yn,yn,yn,Ut,yn,yn,M,M,M,ee,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,yn,A,ee,ee,ee,ee,ee,ee,M,M,ee,ee,A,ee,ee,ee,ee,M,M,At,At,At,At,At,At,At,At,At,At,M,M,M,M,M,M],[M,M,M,M,M,M,M,M,M,M,M,M,M,M,A,M,M,ee,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,A,A,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,M,A,A,A,A,A,A,A,A,A,A,A,A,A,A,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,ee,ee,ee,ee,ee,ee,ee,ee,ee,be,be,A,A,A,A,be,A,A,A,A,A],[La,La,La,La,La,La,La,La,La,La,La,ut,ut,ut,$,be,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,La,Df,kot,Uot,zot,Bot,Vot,ll,Ut,Ut,Ut,Ut,Ut,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,ll,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,La,ut,ut,ut,ut,ut,A,A,A,A,A,ut,ut,ut,ut,ut,ut,At,$,A,A,At,At,At,At,At,At,ad,ad,A,A,A,$,At,At,At,At,At,At,At,At,At,At,ad,ad,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,A,A,A,A,A,be,ee,be,be,be,be,be,be,be,be,be,be,ad,be,be,be,be,be,be,be,be,be,be,be,be,be,A,be,be,be,be,be,A,be,A,be,be,A,be,be,A,be,be,be,be,be,be,be,be,be,be,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M],[ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,ee,ee,ee,ee,ee,ee,ee,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,ll,A,ll,A,A,ll,A,A,A,A,A,A,A,A,A,Ut,A,A,ad,ad,A,A,A,A,A,Ut,Ut,A,A,A,A,A,M,M,M,M,M,A,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,A,A,ut],[A,A,A,Ut,Ut,Ut,A,A,A,A,A,ad,ll,ad,ll,ll,At,At,At,At,At,At,At,At,At,At,ll,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,A,A,A,Ut,Ut,A,A,A,Ut,Ut,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];let qot=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,r,i){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(cat(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(r,i))return e;r=this.inputFormat,i=this.outputFormat;let s=e;const n=hat,o=dae(r.charAt(1)),a=dae(i.charAt(1)),l=(r.charAt(0)==="I"?"L":r.charAt(0))+o,c=(i.charAt(0)==="I"?"L":i.charAt(0))+a,u=r.charAt(2)+i.charAt(2);n.defInFormat=l,n.defOutFormat=c,n.defSwap=u;const h=NA(e,l,c,u,n);let p=!1;return i.charAt(1)==="R"?p=!0:i.charAt(1)!=="C"&&i.charAt(1)!=="D"||(p=this.checkContextual(h)==="rtl"),this.sourceToTarget=uu,this.targetToSource=uat(this.sourceToTarget),mF=this.targetToSource,s=r.charAt(3)===i.charAt(3)?h:i.charAt(3)==="S"?Yot(p,h):Jot(h,p,!0),this.sourceToTarget=uu,this.targetToSource=mF,this.levels=m8,s}_inputFormatSetter(e){if(!pae.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!pae.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,r){return e?this._inputFormatSetter(e):e=this.inputFormat,r?this._outputFormatSetter(r):r=this.outputFormat,e!==r}checkContextual(e){let r=fF(e);if(r!=="ltr"&&r!=="rtl"){try{r=document.dir.toLowerCase()}catch{}r!=="ltr"&&r!=="rtl"&&(r="ltr")}return r}hasBidiChar(e){return fat.test(e)}};function NA(t,e,r,i,s){const n=Wot(t,{inFormat:e,outFormat:r,swap:i},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,r=n.outFormat,i=n.swap;const o=e.substring(0,1),a=e.substring(1,4),l=r.substring(0,1),c=r.substring(1,4);if(s.inFormat=e,s.outFormat=r,s.swap=i,o==="L"&&r==="VLTR"){if(a==="LTR")return s.dir=Zx,oy(t,s);if(a==="RTL")return s.dir=FA,oy(t,s)}if(o==="V"&&l==="V")return s.dir=a==="RTL"?FA:Zx,gz(t,s);if(o==="L"&&r==="VRTL")return a==="LTR"?(s.dir=Zx,t=oy(t,s)):(s.dir=FA,t=oy(t,s)),gz(t);if(e==="VLTR"&&r==="LLTR")return s.dir=Zx,oy(t,s);if(o==="V"&&l==="L"&&a!==c)return t=gz(t),a==="RTL"?NA(t,"LLTR","VLTR",i,s):NA(t,"LRTL","VRTL",i,s);if(e==="VRTL"&&r==="LRTL")return NA(t,"LRTL","VRTL",i,s);if(o==="L"&&l==="L"){const u=s.swap;return s.swap=u.substr(0,1)+"N",a==="RTL"?(s.dir=FA,t=oy(t,s),s.swap="N"+u.substr(1,2),s.dir=Zx,t=oy(t,s)):(s.dir=Zx,t=oy(t,s),s.swap="N"+u.substr(1,2),t=NA(t,"VLTR","LRTL",s.swap,s)),t}return t}function Wot(t,e,r){if(e.inFormat===void 0&&(e.inFormat=r.defInFormat),e.outFormat===void 0&&(e.outFormat=r.defOutFormat),e.swap===void 0&&(e.swap=r.defSwap),e.inFormat===e.outFormat)return e;const i=e.inFormat.substring(0,1),s=e.outFormat.substring(0,1);let n,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(n=fF(t),o=n==="ltr"||n==="rtl"?n.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=i+o),a.charAt(0)==="C"&&(n=fF(t),n==="rtl"?a="RTL":n==="ltr"?(n=Zot(t),a=n.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=s+a),e}function Yot(t,e,r){if(e.length===0)return"";t===void 0&&(t=!0);const i=(e=String(e)).split("");let s=0,n=1,o=i.length;t||(s=i.length-1,n=-1,o=1);const a=Xot(i,s,n,o);let l="";for(let c=0;c<i.length;c++)tat(a,a.length,c)>-1?(QEe(mF,c,!t,-1),uu.splice(c,1)):l+=i[c];return l}function Xot(t,e,r,i,s){let n=0;const o=[];let a=0;for(let l=e;l*r<i;l+=r)if(KEe(t[l])||PO(t[l])){if(t[l]==="Ù„"&&rat(t,l+r,r,i)){t[l]=lat(t[l+r],n===0?Pot:Mot),l+=r,aat(t,l,r,i),o[a]=l,a++,n=0;continue}const c=t[l];n===1?t[l]=uae(t,l+r,r,i)?oat(t[l]):yz(t[l],Rot):uae(t,l+r,r,i)===!0?t[l]=yz(t[l],Iot):t[l]=yz(t[l],Oot),PO(c)||(n=1),nat(c)===!0&&(n=0)}else n=0;return o}function fF(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function Zot(t){const e=t.split("");return e.reverse(),fF(e.join(""))}function Jot(t,e,r){if(t.length===0)return"";e===void 0&&(e=!0);let i="";const s=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(s[n]>="ï¹°"&&s[n]<"\uFEFF"){const a=t.charCodeAt(n);s[n]>="ï»µ"&&s[n]<="ï»¼"?(e?(n>0&&r&&s[n-1]===" "?i=i.substring(0,i.length-1)+"Ù„":(i+="Ù„",o=!0),i+=SE[(a-65269)/2]):(i+=SE[(a-65269)/2],i+="Ù„",n+1<t.length&&r&&s[n+1]===" "?n++:o=!0),o&&(QEe(mF,n,!0,1),uu.splice(n,0,uu[n]))):i+=Lot[a-65136]}else i+=s[n]}return i}function oy(t,e){const r=t.split(""),i=[];return JEe(r,i,e),Qot(r,i,e),hae(2,r,i,e),hae(1,r,i,e),m8=i,r.join("")}function JEe(t,e,r){const i=t.length,s=r.dir?Fot:Not;let n=0,o=-1;const a=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let c=0;c<i;c++)a[c]=eat(t[c]);for(let c=0;c<i;c++){const u=n,h=iat(t,a,l,c,r);l[c]=h,n=s[u][h];const p=240&n;n&=15;const f=s[n][dat];if(e[c]=f,p>0)if(p===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(s[n][pat])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=f;o=-1}a[c]===Df&&(e[c]=0),r.hiLevel|=f}r.hasUbatS&&Kot(a,e,i,r)}function Kot(t,e,r,i){for(let s=0;s<r;s++)if(t[s]===CN){e[s]=i.dir;for(let n=s-1;n>=0&&t[n]===La;n--)e[n]=i.dir}}function Qot(t,e,r){if(r.hiLevel!==0&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let i=0;i<t.length;i++)e[i]===1&&(t[i]=sat(t[i]))}function eat(t){const e=t.charCodeAt(0),r=jot[e>>8];return r<$f?r:Hot[r-$f][255&e]}function gz(t,e){const r=t.split("");if(e){const i=[];JEe(r,i,e),m8=i}return r.reverse(),uu.reverse(),r.join("")}function tat(t,e,r){for(let i=0;i<e;i++)if(t[i]===r)return i;return-1}function KEe(t){for(let e=0;e<cae.length;e++)if(t>=cae[e]&&t<=Dot[e])return!0;return!1}function uae(t,e,r,i){for(;e*r<i&&PO(t[e]);)e+=r;return!!(e*r<i&&KEe(t[e]))}function rat(t,e,r,i){for(;e*r<i&&PO(t[e]);)e+=r;let s=" ";if(!(e*r<i))return!1;s=t[e];for(let n=0;n<SE.length;n++)if(SE[n]===s)return!0;return!1}function hae(t,e,r,i){if(i.hiLevel<t)return;if(t===1&&i.dir===FA&&!i.hasUbatB)return e.reverse(),void uu.reverse();const s=e.length;let n,o,a,l,c,u=0;for(;u<s;){if(r[u]>=t){for(n=u+1;n<s&&r[n]>=t;)n++;for(o=u,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=uu[o],uu[o]=uu[a],uu[a]=c;u=n}u++}}function iat(t,e,r,i,s){const n=e[i];return{UBAT_L:()=>(s.lastArabic=!1,$),UBAT_R:()=>(s.lastArabic=!1,be),UBAT_ON:()=>A,UBAT_AN:()=>yn,UBAT_EN:()=>s.lastArabic?yn:At,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,be),UBAT_WS:()=>A,UBAT_CS:()=>{let o,a;return i<1||i+1>=e.length||(o=r[i-1])!==At&&o!==yn||(a=e[i+1])!==At&&a!==yn?A:(s.lastArabic&&(a=yn),a===o?a:A)},UBAT_ES:()=>(i>0?r[i-1]:Df)===At&&i+1<e.length&&e[i+1]===At?At:A,UBAT_ET:()=>{if(i>0&&r[i-1]===At)return At;if(s.lastArabic)return A;let o=i+1;const a=e.length;for(;o<a&&e[o]===Ut;)o++;return o<a&&e[o]===At?At:A},UBAT_NSM:()=>{if(s.inFormat==="VLTR"){const o=e.length;let a=i+1;for(;a<o&&e[a]===ee;)a++;if(a<o){const l=t[i].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===be||u===M))return be}}return i<1||e[i-1]===Df?A:r[i-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,A),UBAT_LRE:()=>(s.lastArabic=!1,A),UBAT_RLE:()=>(s.lastArabic=!1,A),UBAT_LRO:()=>(s.lastArabic=!1,A),UBAT_RLO:()=>(s.lastArabic=!1,A),UBAT_PDF:()=>(s.lastArabic=!1,A),UBAT_BN:()=>A}[Got[n]]()}function sat(t){let e,r=0,i=WI.length-1;for(;r<=i;)if(e=Math.floor((r+i)/2),t<WI[e][0])i=e-1;else{if(!(t>WI[e][0]))return WI[e][1];r=e+1}return t}function nat(t){for(let e=0;e<lae.length;e++)if(lae[e]===t)return!0;return!1}function oat(t){for(let e=0;e<pF.length;e++)if(t===pF[e])return $ot[e];return t}function yz(t,e){for(let r=0;r<pF.length;r++)if(t===pF[r])return e[r];return t}function PO(t){return t>="Ù‹"&&t<="Ù•"}function dae(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function aat(t,e,r,i){for(;e*r<i&&PO(t[e]);)e+=r;return e*r<i&&(t[e]=" ",!0)}function lat(t,e){for(let r=0;r<SE.length;r++)if(t===SE[r])return e[r];return t}function cat(t,e,r){uu=[],m8=[];for(let i=0;i<r;i++)t[i]=i,e[i]=i,uu[i]=i}function uat(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[t[r]]=r;return e}function QEe(t,e,r,i){for(let s=0;s<t.length;s++)(t[s]>e||!r&&t[s]===e)&&(t[s]+=i)}let uu=[],mF=[],m8=[];const hat={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},dat=5,pat=6,Zx=0,FA=1,pae=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,fat=/[\u0591-\u06ff\ufb1d-\ufefc]/,_z=new qot;function mat(t){if(t==null)return["",!1];if(!_z.hasBidiChar(t))return[t,!1];let e;return e=_z.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[_z.bidiTransform(t,e,"VLYSN"),!0]}let dC=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,r){this.tx=e,this.ty=r}setTranslateZ(e){this.tz=e}setRotateCS(e,r){this.rz=void 0,this.rzCos=e,this.rzSin=r}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const eCe="arial-unicode-ms",fae="woff2",mae=new Map,tCe=new Set;let gat=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function yat(t){const e=bat(t),r=mae.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${ii.fontsUrl}/woff2/${e}.${fae}') format('${fae}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return mae.set(e,new gat(i,n)),tCe.add(i),n}function _at(t){return tCe.has(t)}function vat(t){if(!t)return eCe;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function bat(t){const e=wat(t)+xat(t);return vat(t.family)+(e.length>0?e:"-regular")}function wat(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function xat(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Pn=class{static fromOptimized(e,r,i=!1,s=!1,n=1){return new mq().initialize(e,r,i,s,n)}static fromJSON(e,r=!1,i=!1){const[s,n]=gae(e);return new gq().initialize(s,n,r,i,1)}static fromOptimizedCIM(e,r,i=!1,s=!1,n=1){return new yae().initialize(e,r,i,s,n)}static fromJSONCIM(e,r=!1,i=!1,s=1){const[n,o]=gae(e);return new _ae().initialize(n,o,r,i,s)}static fromFeatureSetReader(e){const r=e.readGeometryForDisplay(),i=e.geometryType;return r&&i?this.fromOptimized(r,i):null}static fromFeatureSetReaderCIM(e){const r=e.readGeometryForDisplay(),i=e.geometryType;return r&&i?this.fromOptimizedCIM(r,i):null}static createEmptyOptimized(e,r=!1,i=!1,s=1){return new mq().initialize(new jh,e,r,i,s)}static createEmptyJSON(e,r=!1,i=!1){return new gq().initialize([],e,r,i,1)}static createEmptyOptimizedCIM(e,r=!1,i=!1,s=1){return new yae().initialize(new jh,e,r,i,s)}static createEmptyJSONCIM(e,r=!1,i=!1,s=1){return new _ae().initialize([],e,r,i,s)}asJSON(){const e=S6(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,r,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,r=this.y;const s=e,n=r;for(;this.nextPoint();)i+=(e-this.x)*(r+this.y),e=this.x,r=this.y;return i+=(e-s)*(r+n),-.5*i}invertY(){this.yFactor*=-1}},mq=class rCe extends Pn{constructor(){super(...arguments),this._end=-1}initialize(e,r,i,s,n){return this.hasZ=i,this.hasM=s,this.geometryType=r,this._stride=2+Number(i)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const r=this._pathOffset+e*this._stride;return r>=0&&r<this._end&&(this._pointOffset=r,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,r=this._stride,i=this._geometry.coords;let s=0;for(let n=this._pathOffset+r;n<e;n+=r){const o=i[n-r],a=i[n-r+1],l=i[n]-o,c=i[n+1]-a;s+=Math.sqrt(l*l+c*c)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let r=0;r<this._stride;++r)this._geometry.coords.push(e[r]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,r){this._geometry.coords.push(e,r),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const r of e)for(let i=0;i<this._stride;++i)this._geometry.coords.push(r[i]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const r=e.asOptimized();this._geometry.coords.push(...r.coords),this._geometry.lengths.push(...r.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let r=1;r<e.coords.length;r+=this._stride)e.coords[r]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,r=this._pathOffset,i=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[r+s]!==e[i+s])return!1;return!0}clone(){return new rCe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,r)=>e+r)}get pathSize(){const{lengths:e}=this._geometry;return this._pathIndex<0||this._pathIndex>e.length-1?0:this._geometry.isPoint?1:e[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function Tat(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function gae(t){return yc(t)?[t.rings,"esriGeometryPolygon"]:Zd(t)?[t.paths,"esriGeometryPolyline"]:Jb(t)?[[t.points],"esriGeometryMultipoint"]:Xd(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:VS(t)?[[[Tat(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let gq=class iCe extends Pn{initialize(e,r,i,s,n){return this._paths=e,this.geometryType=r,this.hasZ=i,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,r=this._currentPath;let i=0;for(let s=1;s<e;s++){const n=r[s-1],o=r[s],a=n[0],l=n[1],c=o[0]-a,u=o[1]-l;i+=Math.sqrt(c*c+u*u)}return i}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,r){this._paths[this.totalSize-1].push([e,r])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const r=S6(e);for(const i of r)this.pushPath(i)}asOptimized(){const e=new jh;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const r of this._paths){for(const i of r)e.coords.push(i[0]),e.coords.push(i[1]*this.yFactor),this.hasZ&&e.coords.push(i[2]),this.hasM&&e.coords.push(i[this._mIndex]);e.lengths.push(r.length)}return e}isClosed(){const e=this._currentPath[0],r=this._currentPath[this._currentPath.length-1];for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}clone(){return new iCe().initialize(ge(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,r)=>e+r)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const YI=4,XI=1;let yae=class sCe extends mq{initialize(e,r,i,s,n){return super.initialize(e,r,i,s,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new sCe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},_ae=class nCe extends gq{initialize(e,r,i,s,n){return super.initialize(e,r,i,s,n)}clone(){return new nCe().initialize(ge(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][YI]=XI}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][YI]===XI}setControlPointAt(e){this._paths[this.pathIndex][e][YI]=XI}getControlPointAt(e){return this._paths[this.pathIndex][e][YI]===XI}};const Sat=512;var uc,Lo;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(uc||(uc={}));let oa=class AN{constructor(e,r){this.x=e,this.y=r}clone(){return new AN(this.x,this.y)}equals(e,r){return e===this.x&&r===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,r){return this.x=e,this.y=r,this}normalize(){const e=this.x,r=this.y,i=Math.sqrt(e*e+r*r);return this.x/=i,this.y/=i,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,r){return this.x+=e,this.y+=r,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this}assignSub(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this}rotate(e,r){const i=this.x,s=this.y;return this.x=i*e-s*r,this.y=i*r+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,r=this.y;return Math.sqrt(e*e+r*r)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,r){const i=r.x-e.x,s=r.y-e.y;return Math.sqrt(i*i+s*s)}static add(e,r){return new AN(e.x+r.x,e.y+r.y)}static sub(e,r){return new AN(e.x-r.x,e.y-r.y)}},ZI=class{constructor(e,r,i){this.ratio=e,this.x=r,this.y=i}},Eat=class{constructor(e,r,i,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=Sat*s,this._dz=e,this._yPos=r,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let r=this._pixelRatio*this._pixelMargin;r/=this._finalRatio;const i=e>>this._dz;r>i&&(r=i),this._margin=r,this._xmin=i*this._xPos-r,this._ymin=i*this._yPos-r,this._xmax=this._xmin+i+2*r,this._ymax=this._ymin+i+2*r}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,r){this._pushLine(),this._prevIsIn=this._isIn(e,r),this._moveTo(e,r,this._prevIsIn),this._prevPt=new oa(e,r),this._firstPt=new oa(e,r),this._dist=0}lineTo(e,r){const i=this._isIn(e,r),s=new oa(e,r),n=oa.distance(this._prevPt,s);let o,a,l,c,u,h,p,f;if(i)this._prevIsIn?this._lineTo(e,r,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,_=s;if(g.x<=this._xmin&&_.x<=this._xmin||g.x>=this._xmax&&_.x>=this._xmax||g.y<=this._ymin&&_.y<=this._ymin||g.y>=this._ymax&&_.y>=this._ymax)this._lineTo(_.x,_.y,!1);else{const v=[];if((g.x<this._xmin&&_.x>this._xmin||g.x>this._xmin&&_.x<this._xmin)&&(c=(this._xmin-g.x)/(_.x-g.x),f=g.y+c*(_.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new ZI(c,this._xmin,f))),(g.x<this._xmax&&_.x>this._xmax||g.x>this._xmax&&_.x<this._xmax)&&(c=(this._xmax-g.x)/(_.x-g.x),f=g.y+c*(_.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new ZI(c,this._xmax,f))),(g.y<this._ymin&&_.y>this._ymin||g.y>this._ymin&&_.y<this._ymin)&&(c=(this._ymin-g.y)/(_.y-g.y),p=g.x+c*(_.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new ZI(c,p,this._ymin))),(g.y<this._ymax&&_.y>this._ymax||g.y>this._ymax&&_.y<this._ymax)&&(c=(this._ymax-g.y)/(_.y-g.y),p=g.x+c*(_.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new ZI(c,p,this._ymax))),v.length===0)u?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+n*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+n*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(_.x,_.y,!1)}}this._dist+=n,this._prevIsIn=i,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,r=this._prevPt;e.x===r.x&&e.y===r.y||this.lineTo(e.x,e.y);const i=this._line;let s=i.length;for(;s>=4&&(i[0].x===i[1].x&&i[0].x===i[s-2].x||i[0].y===i[1].y&&i[0].y===i[s-2].y);)i.pop(),i[0].x=i[s-2].x,i[0].y=i[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===uc.Polygon&&e&&Cat.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==uc.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,r=e.length;if(r===0)return null;const i=[];for(let s=0;s<r;s++)i.push({line:e[s],start:this._starts[s]||0});return i}_isIn(e,r){return e>=this._xmin&&e<=this._xmax&&r>=this._ymin&&r<=this._ymax}_intersect(e,r){let i,s,n;if(r.x>=this._xmin&&r.x<=this._xmax)s=r.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(r.y-e.y),i=e.x+n*(r.x-e.x);else if(r.y>=this._ymin&&r.y<=this._ymax)i=r.x<=this._xmin?this._xmin:this._xmax,n=(i-e.x)/(r.x-e.x),s=e.y+n*(r.y-e.y);else{s=r.y<=this._ymin?this._ymin:this._ymax,i=r.x<=this._xmin?this._xmin:this._xmax;const o=(i-e.x)/(r.x-e.x),a=(s-e.y)/(r.y-e.y);o<a?(n=o,s=e.y+o*(r.y-e.y)):(n=a,i=e.x+a*(r.x-e.x))}return this._r=n,new oa(i,s)}_pushLine(){this._line&&(this._type===uc.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===uc.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===uc.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,r,i){this._type!==uc.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new oa(e,r))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new oa(e,r)),this._isH=!1,this._isV=!1)}_lineTo(e,r,i){let s,n;if(this._type!==uc.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,r)))return;this._line.push(new oa(e,r))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===r;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=r,n=this._line[this._line.length-2],n.x===e&&n.y===r?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===r)):(this._isH=n.x===e,this._isV=n.y===r)):(this._line.push(new oa(e,r)),this._isH=o,this._isV=a)}else this._line.push(new oa(e,r))}},v6t=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,r){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new oa(e*i,r*i))}lineTo(e,r){const i=this._ratio;this._line.push(new oa(e*i,r*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(Lo||(Lo={}));let Cat=class ky{static simplify(e,r,i){if(!i)return;const s=-r,n=e+r,o=-r,a=e+r,l=[],c=[],u=i.length;for(let p=0;p<u;++p){const f=i[p];if(!f||f.length<2)continue;let g,_=f[0];const v=f.length;for(let b=1;b<v;++b)g=f[b],_.x===g.x&&(_.x<=s&&(_.y>g.y?(l.push(p),l.push(b),l.push(Lo.sideLeft),l.push(-1)):(c.push(p),c.push(b),c.push(Lo.sideLeft),c.push(-1))),_.x>=n&&(_.y<g.y?(l.push(p),l.push(b),l.push(Lo.sideRight),l.push(-1)):(c.push(p),c.push(b),c.push(Lo.sideRight),c.push(-1)))),_.y===g.y&&(_.y<=o&&(_.x<g.x?(l.push(p),l.push(b),l.push(Lo.sideTop),l.push(-1)):(c.push(p),c.push(b),c.push(Lo.sideTop),c.push(-1))),_.y>=a&&(_.x>g.x?(l.push(p),l.push(b),l.push(Lo.sideBottom),l.push(-1)):(c.push(p),c.push(b),c.push(Lo.sideBottom),c.push(-1)))),_=g}if(l.length===0||c.length===0)return;ky.fillParent(i,c,l),ky.fillParent(i,l,c);const h=[];ky.calcDeltas(h,c,l),ky.calcDeltas(h,l,c),ky.addDeltas(h,i)}static fillParent(e,r,i){const s=i.length,n=r.length;for(let o=0;o<n;o+=4){const a=r[o],l=r[o+1],c=r[o+2],u=e[a][l-1],h=e[a][l];let p=8092,f=-1;for(let g=0;g<s;g+=4){if(i[g+2]!==c)continue;const _=i[g],v=i[g+1],b=e[_][v-1],w=e[_][v];switch(c){case Lo.sideLeft:case Lo.sideRight:if(JI(u.y,b.y,w.y)&&JI(h.y,b.y,w.y)){const T=Math.abs(w.y-b.y);T<p&&(p=T,f=g)}break;case Lo.sideTop:case Lo.sideBottom:if(JI(u.x,b.x,w.x)&&JI(h.x,b.x,w.x)){const T=Math.abs(w.x-b.x);T<p&&(p=T,f=g)}}}r[o+3]=f}}static calcDeltas(e,r,i){const s=r.length;for(let n=0;n<s;n+=4){const o=[],a=ky.calcDelta(n,r,i,o);e.push(r[n]),e.push(r[n+1]),e.push(r[n+2]),e.push(a)}}static calcDelta(e,r,i,s){const n=r[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),ky.calcDelta(n,i,r,s)+1)}static addDeltas(e,r){const i=e.length;let s=0;for(let n=0;n<i;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<i;n+=4){const o=r[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case Lo.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case Lo.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case Lo.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case Lo.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const JI=(t,e,r)=>t>=e&&t<=r||t>=r&&t<=e,Aat=512;let Ym,Pat=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function dK(t,e){Ym||(Ym=new Eat(0,0,0,1));const r=t.geometryType==="esriGeometryPolygon",i=r?uc.Polygon:uc.LineString,s=r?3:2;let n,o;for(Ym.reset(i),Ym.setPixelMargin(e+1),Ym.setExtent(Aat);t.nextPath();)if(!(t.pathSize<s)){for(t.nextPoint(),n=t.x,o=-t.y,Ym.moveTo(n,o);t.nextPoint();)n=t.x,o=-t.y,Ym.lineTo(n,o);r&&Ym.close()}const a=Ym.result(!1);if(a){const l=Pn.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let Mat=class{applyColorSubstituition(e,r){if(!r)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=i,n.height=s,o.drawImage(e,0,0,i,s));const a=o.getImageData(0,0,i,s).data;if(r){for(const c of r)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,h,p,f]=c.oldColor,[g,_,v,b]=c.newColor;if(u===g&&h===_&&p===v&&f===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&h===a[w+1]&&p===a[w+2]&&f===a[w+3]&&(a[w]=g,a[w+1]=_,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,i,s);return o.putImageData(l,0,0),n}tintImageData(e,r){if(!r||r.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=i,n.height=s,o.drawImage(e,0,0,i,s));const a=o.getImageData(0,0,i,s),l=new Uint8Array(a.data),c=[r[0]/255,r[1]/255,r[2]/255,r[3]/255];for(let h=0;h<l.length;h+=4)l[h]*=c[0],l[h+1]*=c[1],l[h+2]*=c[2],l[h+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),i,s);return o.putImageData(u,0,0),n}},oCe=class kA{static local(){return kA.instance===null&&(kA.instance=new kA),kA.instance}execute(e,r,i,s,n){return new Oat(e,r,i)}};oCe.instance=null;let Oat=class{constructor(e,r,i){this._inputGeometries=e,this._angleTolerance=r.angleTolerance!==void 0?r.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const r=e.x,i=e.y;let s=r,n=i,o=e.pathSize,a=0,l=0,c=0,u=0,h=0,p=0;this._isClosed&&++o;for(let f=1;e.nextPoint()||f<o;++f){let g,_;this._isClosed&&f===o-1?(g=r,_=i):(g=e.x,_=e.y);const v=g-s,b=_-n,w=Math.sqrt(v*v+b*b);f>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(f-1),f===1&&(u=v,h=b,p=w),w>0&&(s=g,n=_,a=v,l=b,c=w)}this._isClosed&&c>0&&p>0&&(a*u+l*h)/p/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function vz(t,e){t[4]=e}let zR=class{constructor(e,r=!0,i=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!r&&e.geometryType==="esriGeometryPolygon"||!i&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.internalPlacement=new dC}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.pathIndex<this.geometryCursor.totalSize-1;){this.iteratePath||this.geometryCursor.nextPath();const e=this.processPath(this.geometryCursor);if(e)return e}return this.geometryCursor=null,null}},g8=class{constructor(e,r,i,s=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=r,this.acceptPolyline=i,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}};var yq,_q,vae,bae,Jf,wae,vq,bq,wq,xae,Tae,Sae,Eae,Cae,Aae,xq,Tq,Pae,Mae,vS,kr,bb,Oae,Rae,zg,$ae,Iae,$T,Sq,Lae,Dae,Nae,Fae,kae,Uae,Sh,ia,zae,Bae,Kf,Vae,Gae,jae,Hae,Ld,hM,wb,IT,qae,Wae,Yae,Xae,Zae,Jae,Kae,gF,LT,Qae,Eq,ele,tle;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(yq||(yq={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(_q||(_q={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(vae||(vae={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(bae||(bae={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Jf||(Jf={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(wae||(wae={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(vq||(vq={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(bq||(bq={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(wq||(wq={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(xae||(xae={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Tae||(Tae={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Sae||(Sae={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(Eae||(Eae={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Cae||(Cae={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Aae||(Aae={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(xq||(xq={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Tq||(Tq={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Pae||(Pae={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Mae||(Mae={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(vS||(vS={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(kr||(kr={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(bb||(bb={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Oae||(Oae={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Rae||(Rae={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(zg||(zg={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}($ae||($ae={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Iae||(Iae={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}($T||($T={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Sq||(Sq={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Lae||(Lae={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Dae||(Dae={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Nae||(Nae={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(Fae||(Fae={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(kae||(kae={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Uae||(Uae={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Sh||(Sh={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(ia||(ia={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(zae||(zae={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(Bae||(Bae={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Kf||(Kf={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(Vae||(Vae={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Gae||(Gae={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(jae||(jae={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Hae||(Hae={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Ld||(Ld={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(hM||(hM={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(wb||(wb={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(IT||(IT={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(qae||(qae={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Wae||(Wae={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Yae||(Yae={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Xae||(Xae={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Zae||(Zae={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Jae||(Jae={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Kae||(Kae={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(gF||(gF={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(LT||(LT={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Qae||(Qae={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Eq||(Eq={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(ele||(ele={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(tle||(tle={}));const MO=.03;let M0=class{constructor(e=0,r=!1){}isEmpty(e){if(!e.nextPoint())return!0;let r,i,s,n;for(r=e.x,i=e.y;e.nextPoint();r=i,i=n)if(s=e.x,n=e.y,s!==r||n!==i)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]);r!==0&&(e[0]/=r,e[1]/=r)}getLength(e,r,i,s){const n=i-e,o=s-r;return Math.sqrt(n*n+o*o)}getSegLength(e){const[[r,i],[s,n]]=e;return this.getLength(r,i,s,n)}getCoord2D(e,r,i,s,n){return[e+(i-e)*n,r+(s-r)*n]}getSegCoord2D(e,r){const[[i,s],[n,o]]=e;return this.getCoord2D(i,s,n,o,r)}getAngle(e,r,i,s,n){const o=i-e,a=s-r;return Math.atan2(a,o)}getAngleCS(e,r,i,s,n){const o=i-e,a=s-r,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,r){const[[i,s],[n,o]]=e;return this.getAngleCS(i,s,n,o,r)}cut(e,r,i,s,n,o){return[n<=0?[e,r]:this.getCoord2D(e,r,i,s,n),o>=1?[i,s]:this.getCoord2D(e,r,i,s,o)]}getSubCurve(e,r,i){const s=Pn.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,e,r,i)?s:null}appendSubCurve(e,r,i,s){e.startPath(),r.seekPathStart();let n=0,o=!0;if(!r.nextPoint())return!1;let a=r.x,l=r.y;for(;r.nextPoint();){const c=this.getLength(a,l,r.x,r.y);if(c!==0){if(o){if(n+c>i){const u=(i-n)/c;let h=1,p=!1;n+c>=s&&(h=(s-n)/c,p=!0);const f=this.cut(a,l,r.x,r.y,u,h);if(f&&e.pushPoints(f),p)break;o=!1}}else{if(n+c>s){const u=this.cut(a,l,r.x,r.y,0,(s-n)/c);u&&e.pushPoint(u[1]);break}e.pushXY(r.x,r.y)}n+=c,a=r.x,l=r.y}else a=r.x,l=r.y}return!0}getCIMPointAlong(e,r){if(!e.nextPoint())return null;let i,s,n,o,a=0;for(i=e.x,s=e.y;e.nextPoint();i=n,s=o){n=e.x,o=e.y;const l=this.getLength(i,s,n,o);if(l!==0){if(a+l>r){const c=(r-a)/l;return this.getCoord2D(i,s,n,o,c)}a+=l}}return null}offset(e,r,i,s,n){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const p=e[o];p[0]===a[0]&&p[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let p=0;p<l;p++){const f=p===l-1?c?e[0]:null:e[p+1];if(a)if(f){const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g);const _=[h[0]-a[0],h[1]-a[1]];this.normalize(_);const v=_[0]*g[1]-_[1]*g[0],b=_[0]*g[0]+_[1]*g[1];if(v===0&&b===1){h=f;continue}if(v>=0==r<=0){if(b<1){const w=[g[0]-_[0],g[1]-_[1]];this.normalize(w);const T=Math.sqrt((1+b)/2);if(T>1/s){const S=-Math.abs(r)/T;u.push([h[0]-w[0]*S,h[1]-w[1]*S])}}}else switch(i){case zg.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<s){const T=[g[0]-_[0],g[1]-_[1]];this.normalize(T);const S=Math.abs(r)/w;u.push([h[0]-T[0]*S,h[1]-T[1]*S]);break}}case zg.Bevelled:u.push([h[0]+_[1]*r,h[1]-_[0]*r]),u.push([h[0]+g[1]*r,h[1]-g[0]*r]);break;case zg.Rounded:if(b<1){u.push([h[0]+_[1]*r,h[1]-_[0]*r]);const w=Math.floor(2.5*(1-b));if(w>0){const T=1/w;let S=T;for(let C=1;C<w;C++,S+=T){const P=[_[1]*(1-S)+g[1]*S,-_[0]*(1-S)-g[0]*S];this.normalize(P),u.push([h[0]+P[0]*r,h[1]+P[1]*r])}}u.push([h[0]+g[1]*r,h[1]-g[0]*r])}break;case zg.Square:default:if(v<0)u.push([h[0]+(_[1]+_[0])*r,h[1]+(_[1]-_[0])*r]),u.push([h[0]+(g[1]-g[0])*r,h[1]-(g[0]+g[1])*r]);else{const w=Math.sqrt((1+Math.abs(b))/2),T=[g[0]-_[0],g[1]-_[1]];this.normalize(T);const S=r/w;u.push([h[0]-T[0]*S,h[1]-T[1]*S])}}}else{const g=[h[0]-a[0],h[1]-a[1]];this.normalize(g),u.push([h[0]+g[1]*r,h[1]-g[0]*r])}else{const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g),u.push([h[0]+g[1]*r,h[1]-g[0]*r])}a=h,h=f}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const bz=1.7320508075688772,Rat=5,$at=vS.OpenEnded;let aCe=class UA{static local(){return UA.instance===null&&(UA.instance=new UA),UA.instance}execute(e,r,i,s,n){return new Iat(e,r,i)}};aCe.instance=null;let Iat=class extends g8{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new M0,this._width=(r.width!==void 0?r.width:Rat)*i,this._arrowType=r.geometricEffectArrowType!==void 0?r.geometricEffectArrowType:r.arrowType!==void 0?r.arrowType:$at,this._offsetFlattenError=MO*i}processPath(e){const r=Pn.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case vS.OpenEnded:default:this._constructSimpleArrow(r,e,!0);break;case vS.Block:this._constructSimpleArrow(r,e,!1);break;case vS.Crossed:this._constructCrossedArrow(r,e)}return r}_constructSimpleArrow(e,r,i){const s=r.pathLength();let n=this._width;s<2*n&&(n=s/2);const o=this._curveHelper.getSubCurve(r,0,s-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=x_(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const p=this._constructArrowBasePoint(u,a/2);if(!p)return;r.seekInPath(r.pathSize-1);const f=[r.x,r.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),i||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,r){const i=r.pathLength();let s=this._width;i<s*(1+bz+1)&&(s=i/(1+bz+1)),r.seekPathStart();const n=this._curveHelper.getSubCurve(r,0,i-s*(1+bz));if(!n)return;n.nextPath();const o=s/2;if(this._curveHelper.isEmpty(n))return;const a=x_(n),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(r,0,i-s);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const h=x_(u),p=this._constructOffset(h,o);if(!p)return;const f=this._constructOffset(h,-o);if(!f)return;const g=p[p.length-1],_=this._constructArrowBasePoint(p,o/2);if(!_)return;const v=f[f.length-1],b=this._constructArrowBasePoint(f,-o/2);if(!b)return;r.seekInPath(r.pathSize-1);const w=[r.x,r.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,r){return this._curveHelper.offset(e,r,zg.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,r){if(!e||e.length<2)return null;const i=e[e.length-2],s=e[e.length-1],n=[s[0]-i[0],s[1]-i[1]];return this._curveHelper.normalize(n),[s[0]+n[1]*r,s[1]-n[0]*r]}},lCe=class zA{static local(){return zA.instance===null&&(zA.instance=new zA),zA.instance}execute(e,r,i,s,n,o){return new Lat(e,r,i,s,n,o)}};lCe.instance=null;let Lat=class{constructor(e,r,i,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new M0,this._size=(r.size!==void 0?r.size:1)*i,this._maxInflateSize=o*i,this._offsetFlattenError=MO*i}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const n=Pn.createEmptyOptimizedCIM(e.geometryType),o=S6(e)[0],a=this._curveHelper.offset(o,this._size,zg.Rounded,4,this._offsetFlattenError);if(a)return n.pushPath(a),n}else if(this._size<0){const n=e.asJSON();if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return Pn.fromJSONCIM({xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size})}}const r=this._geometryEngine;if(r==null)return null;const i=this._tileKey?dK(e,this._maxInflateSize):e;if(!i)continue;const s=r.buffer(Xe.WebMercator,i.asJSON(),this._size,1);return s?Pn.fromJSONCIM(s):null}return null}},cCe=class BA{static local(){return BA.instance===null&&(BA.instance=new BA),BA.instance}execute(e,r,i,s,n){return new Dat(e,r,i)}};cCe.instance=null;let Dat=class{constructor(e,r,i){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=i,this._rule=r.rule??kr.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let e;for(;e=this._inputGeometries.next();){const r=this._processGeom(S6(e));if(r&&r.length)return Pn.fromJSONCIM({paths:r})}return null}_clone(e){return[e[0],e[1]]}_mid(e,r){return[(e[0]+r[0])/2,(e[1]+r[1])/2]}_mix(e,r,i,s){return[e[0]*r+i[0]*s,e[1]*r+i[1]*s]}_add(e,r){return[e[0]+r[0],e[1]+r[1]]}_add2(e,r,i){return[e[0]+r,e[1]+i]}_sub(e,r){return[e[0]-r[0],e[1]-r[1]]}_dist(e,r){return Math.sqrt((e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,r=1){const i=r/this._norm(e);e[0]*=i,e[1]*=i}_leftPerpendicular(e){const r=-e[1],i=e[0];e[0]=r,e[1]=i}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const r=e[1],i=-e[0];e[0]=r,e[1]=i}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,r){return e[0]*r[0]+e[1]*r[1]}_crossProduct(e,r){return e[0]*r[1]-e[1]*r[0]}_rotateDirect(e,r,i){const s=e[0]*r-e[1]*i,n=e[0]*i+e[1]*r;e[0]=s,e[1]=n}_makeCtrlPt(e){const r=[e[0],e[1]];return vz(r,1),r}_addAngledTicks(e,r,i,s){const n=this._sub(i,r);this._normalize(n);const o=this._crossProduct(n,this._sub(s,r));let a;a=o>0?this._rightPerp(n):this._leftPerp(n);const l=Math.abs(o)/2,c=[];c.push([r[0]+(a[0]-n[0])*l,r[1]+(a[1]-n[1])*l]),c.push(r),c.push(i),c.push([i[0]+(a[0]+n[0])*l,i[1]+(a[1]+n[1])*l]),e.push(c)}_addBezier2(e,r,i,s,n){if(n--==0)return void e.push(s);const o=this._mid(r,i),a=this._mid(i,s),l=this._mid(o,a);this._addBezier2(e,r,o,l,n),this._addBezier2(e,l,a,s,n)}_addBezier3(e,r,i,s,n,o){if(o--==0)return void e.push(n);const a=this._mid(r,i),l=this._mid(i,s),c=this._mid(s,n),u=this._mid(a,l),h=this._mid(l,c),p=this._mid(u,h);this._addBezier3(e,r,a,u,p,o),this._addBezier3(e,p,h,c,n,o)}_add90DegArc(e,r,i,s,n){const o=n??this._crossProduct(this._sub(i,r),this._sub(s,r))>0,a=this._mid(r,i),l=this._sub(a,r);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,r,this._mix(r,.33333,a,.66667),this._mix(i,.33333,a,.66667),i,4)}_addArrow(e,r,i){const s=r[0],n=r[1],o=r[r.length-1],a=this._sub(s,n);this._normalize(a);const l=this._crossProduct(a,this._sub(o,n)),c=.5*l,u=this._leftPerp(a),h=[o[0]-u[0]*l,o[1]-u[1]*l],p=r.length-1,f=[];f.push(i?[-u[0],-u[1]]:u);let g=[-a[0],-a[1]];for(let _=1;_<p-1;_++){const v=this._sub(r[_+1],r[_]);this._normalize(v);const b=this._dotProduct(v,g),w=this._crossProduct(v,g),T=Math.sqrt((1+b)/2),S=this._sub(v,g);this._normalize(S),S[0]/=T,S[1]/=T,f.push(w<0?[-S[0],-S[1]]:S),g=v}f.push(this._rightPerp(g));for(let _=f.length-1;_>0;_--)e.push([r[_][0]+f[_][0]*c,r[_][1]+f[_][1]*c]);e.push([h[0]+f[0][0]*c,h[1]+f[0][1]*c]),e.push([h[0]+f[0][0]*l,h[1]+f[0][1]*l]),e.push(s),e.push([h[0]-f[0][0]*l,h[1]-f[0][1]*l]),e.push([h[0]-f[0][0]*c,h[1]-f[0][1]*c]);for(let _=1;_<f.length;_++)e.push([r[_][0]-f[_][0]*c,r[_][1]-f[_][1]*c])}_cp2(e,r,i){return e.length>=2?e[1]:this._add2(e[0],r*this._defaultSize,i*this._defaultSize)}_cp3(e,r,i,s){if(e.length>=3)return e[2];const n=this._mix(e[0],1-i,r,i),o=this._sub(r,e[0]);return this._normalize(o),this._rightPerpendicular(o),[n[0]+o[0]*s*this._defaultSize,n[1]+o[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const r=e[0],i=this._cp2(e,-4,0),s=this._sub(r,i);this._normalize(s);const n=this._rightPerp(s);return[r,i,[r[0]+(n[0]-s[0])*this._defaultSize,r[1]+(n[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const r=e[0],i=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const n=this._sub(r,i);this._normalize(n);const o=this._rightPerp(n);s=[r[0]+(o[0]-n[0])*this._defaultSize,r[1]+(o[1]-n[1])*this._defaultSize]}return[i,s]}_processGeom(e){if(!e)return null;const r=[];for(const i of e){if(!i||i.length===0)continue;const s=i.length;let n=i[0];switch(this._rule){case kr.PerpendicularFromFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=[];l.push(a),l.push(this._mid(n,o)),r.push(l);break}case kr.ReversedFirstSegment:{const o=this._cp2(i,0,-1);r.push([o,n]);break}case kr.PerpendicularToSecondSegment:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(n),r.push(l);break}case kr.SecondSegmentWithTicks:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(n,o))>0?this._rightPerp(c):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),r.push(u);break}case kr.DoublePerpendicular:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push(n),h.push([a[0]+c[0]*u,a[1]+c[1]*u]),r.push(h);const p=[];p.push([a[0]-c[0]*u,a[1]-c[1]*u]),p.push(o),r.push(p);break}case kr.OppositeToFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u,a[1]+c[1]*u]),h.push([a[0]-c[0]*u,a[1]-c[1]*u]),r.push(h);break}case kr.TriplePerpendicular:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),h.push([l[0]+.8*(n[0]-l[0]),l[1]+.8*(n[1]-l[1])]),r.push(h),r.push([a,l]);const p=[];p.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),p.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),r.push(p);break}case kr.HalfCircleFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=this._mid(n,o);let c=this._sub(o,n);const u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),p=Math.sqrt((1+u)/2),f=Math.sqrt((1-u)/2),g=[];let _;this._crossProduct(c,this._sub(a,n))>0?(g.push(n),c=this._sub(n,l),_=o):(g.push(o),c=this._sub(o,l),_=n),this._rotateDirect(c,p,f),c[0]/=p,c[1]/=p;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,h);g.push(_),r.push(g);break}case kr.HalfCircleSecondSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,1,-1);let l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const h=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);c>0&&(p=-p);const f=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,h,p),f.push(this._add(u,l));r.push(f);break}case kr.HalfCircleExtended:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,1,-1);let l;if(s>=4)l=i[3];else{const g=this._sub(n,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,n);this._normalize(u,c);const h=this._sub(a,l);this._normalize(h,c);const p=[l,a];r.push(p);const f=[this._clone(a)];this._addBezier3(f,a,this._add(a,h),this._add(o,u),o,4),f.push(n),r.push(f);break}case kr.OpenCircle:{const o=this._cp2(i,-2,0),a=this._sub(o,n),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let h=1;h<=33;h++)this._rotateDirect(a,l,c),u.push(this._add(n,a));r.push(u);break}case kr.CoverageEdgesWithTicks:{const o=this._cp2(i,0,-1);let a,l;if(s>=3)a=i[2];else{const p=this._sub(o,n),f=this._leftPerp(p);a=[n[0]+f[0]-.25*p[0],n[1]+f[1]-.25*p[1]]}if(s>=4)l=i[3];else{const p=this._mid(n,o),f=this._sub(n,o);this._normalize(f),this._leftPerpendicular(f);const g=this._crossProduct(f,this._sub(a,p));this._rightPerpendicular(f),l=[a[0]+f[0]*g*2,a[1]+f[1]*g*2]}const c=this._sub(o,n);let u,h;u=this._crossProduct(c,this._sub(a,n))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push(a),h.push(n),h.push([n[0]+(u[0]-c[0])/3,n[1]+(u[1]-c[1])/3]),r.push(h),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(u):this._leftPerp(c),h=[],h.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),h.push(o),h.push(l),r.push(h);break}case kr.GapExtentWithDoubleTicks:{const o=this._cp2(i,0,2),a=this._cp3(i,o,0,1);let l;if(s>=4)l=i[3];else{const c=this._sub(o,n);l=this._add(a,c)}this._addAngledTicks(r,n,o,this._mid(a,l)),this._addAngledTicks(r,a,l,this._mid(n,o));break}case kr.GapExtentMidline:{const o=this._cp2(i,2,0),a=this._cp3(i,o,0,1);let l;if(s>=4)l=i[3];else{const u=this._sub(o,n);l=this._add(a,u)}const c=[];c.push(this._mid(n,a)),c.push(this._mid(o,l)),r.push(c);break}case kr.Chevron:{const o=this._cp2(i,-1,-1);let a;if(s>=3)a=i[2];else{const l=this._sub(o,n);this._leftPerpendicular(l),a=this._add(n,l)}r.push([o,this._makeCtrlPt(n),a]);break}case kr.PerpendicularWithArc:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,.5,-1);let l=this._sub(o,n);const c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,n));let h=this._dotProduct(l,this._sub(a,n));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[n[0]+l[0]*h,n[1]+l[1]*h];this._leftPerpendicular(l);let f=[];f.push([p[0]-l[0]*u,p[1]-l[1]*u]),f.push([p[0]+l[0]*u,p[1]+l[1]*u]),r.push(f);const g=[o[0]+l[0]*u,o[1]+l[1]*u];l=this._sub(o,g);const _=Math.cos(Math.PI/18);let v=Math.sin(Math.PI/18);u<0&&(v=-v),f=[n,o];for(let b=1;b<=9;b++)this._rotateDirect(l,_,v),f.push(this._add(g,l));r.push(f);break}case kr.ClosedHalfCircle:{const o=this._cp2(i,2,0),a=this._mid(n,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),h=[n,o];for(let p=1;p<=18;p++)this._rotateDirect(l,c,u),h.push(this._add(a,l));r.push(h);break}case kr.TripleParallelExtended:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,1,-2),l=this._mid(n,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,h=this._dist(o,a),p=[o,n];p.push([n[0]+c[0]*h*.5,n[1]+c[1]*h*.5]),r.push(p);const f=[];f.push([l[0]-c[0]*u,l[1]-c[1]*u]),f.push([l[0]+c[0]*h*.375,l[1]+c[1]*h*.375]),vz(f[f.length-1],1),f.push([l[0]+c[0]*h*.75,l[1]+c[1]*h*.75]),r.push(f);const g=[o,a];r.push(g);break}case kr.ParallelWithTicks:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l),this._addAngledTicks(r,n,o,a),this._addAngledTicks(r,this._mix(n,1,l,c),this._mix(o,1,l,c),this._mid(n,o));break}case kr.Parallel:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,n));let h=[n,o];r.push(h),h=[],h.push([n[0]+c[0]*u,n[1]+c[1]*u]),h.push([o[0]+c[0]*u,o[1]+c[1]*u]),r.push(h);break}case kr.PerpendicularToFirstSegment:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._mid(n,o),c=this._sub(o,n);this._normalize(c);const u=this._crossProduct(c,this._sub(a,n));this._leftPerpendicular(c);const h=[];h.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),h.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),r.push(h);break}case kr.ParallelOffset:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),r.push(u);const h=[];h.push([n[0]+l[0]*c,n[1]+l[1]*c]),h.push([o[0]+l[0]*c,o[1]+l[1]*c]),r.push(h);break}case kr.OffsetOpposite:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),r.push(u);break}case kr.OffsetSame:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]+l[0]*c,n[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),r.push(u);break}case kr.CircleWithArc:{let o=this._cp2(i,3,0);const a=this._cp3(i,o,.5,-1);let l,c;if(s>=4)l=i[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,n),this._sub(a,n))>0;const g=24*this._geomUnitsPerPoint,_=this._sub(l,n);this._normalize(_,g);const v=Math.sqrt(2)/2;this._rotateDirect(_,v,c?v:-v),o=this._add(n,_)}const u=this._sub(o,n),h=Math.cos(Math.PI/18),p=Math.sin(Math.PI/18),f=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,h,p),f.push(this._add(n,u));this._add90DegArc(f,o,l,a,c),vz(f[f.length-8],1),r.push(f);break}case kr.DoubleJog:{let o,a,l=this._cp2(i,-3,1);if(o=s>=3?i[2]:this._add(n,this._sub(n,l)),s>=4)a=i[3];else{const b=n;n=l,a=o;const w=this._dist(n,b),T=this._dist(a,b);let S=30*this._geomUnitsPerPoint;.5*w<S&&(S=.5*w),.5*T<S&&(S=.5*T),l=this._mix(n,S/w,b,(w-S)/w),o=this._mix(a,S/T,b,(T-S)/T)}const c=this._mid(n,l),u=this._mid(a,o),h=this._dist(n,l),p=this._dist(o,a);let f=Math.min(h,p)/8;f=Math.min(f,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let _=this._sub(n,l);this._normalize(_,f),this._crossProduct(_,this._sub(a,l))>0?this._rotateDirect(_,g,-g):this._rotateDirect(_,g,g);let v=[];v.push(l),v.push(this._add(c,_)),v.push(this._sub(c,_)),v.push(n),r.push(v),_=this._sub(a,o),this._normalize(_,f),this._crossProduct(_,this._sub(n,o))<0?this._rotateDirect(_,g,g):this._rotateDirect(_,g,-g),v=[],v.push(o),v.push(this._add(u,_)),v.push(this._sub(u,_)),v.push(a),r.push(v);break}case kr.PerpendicularOffset:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);r.push([u,n]);break}case kr.LineExcludingLastSegment:{const o=this._arrowPath(i),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);r.push(a);break}case kr.MultivertexArrow:{const o=this._arrowPath(i),a=[];this._addArrow(a,o,!1),r.push(a);break}case kr.CrossedArrow:{const o=this._arrowPath(i),a=[];this._addArrow(a,o,!0),r.push(a);break}case kr.ChevronArrow:{const[o,a]=this._arrowLastSeg(i),l=10*this._geomUnitsPerPoint,c=this._sub(n,o);this._normalize(c);const u=this._crossProduct(c,this._sub(a,o)),h=this._leftPerp(c),p=[a[0]-h[0]*u*2,a[1]-h[1]*u*2],f=[];f.push([a[0]+c[0]*l,a[1]+c[1]*l]),f.push(n),f.push([p[0]+c[0]*l,p[1]+c[1]*l]),r.push(f);break}case kr.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(i),l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o));this._leftPerpendicular(l);const u=[a[0]-l[0]*c,a[1]-l[1]*c],h=[];h.push([u[0]+l[0]*c*.5,u[1]+l[1]*c*.5]),h.push(this._mid(u,n)),h.push([u[0]-l[0]*c*.5,u[1]-l[1]*c*.5]),r.push(h);break}case kr.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(i),l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o));this._leftPerpendicular(l);const u=[a[0]-l[0]*c,a[1]-l[1]*c];r.push([o,u]);break}case kr.Arch:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,1),l=this._sub(n,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),h=[n];this._addBezier2(h,n,c,a,4),this._addBezier2(h,a,u,o,4),r.push(h);break}case kr.CurvedParallelTicks:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),h=this._sub(this._mix(o,.75,a,.25),c),p=this._sub(this._mix(o,.25,a,.75),c),f=[o];this._addBezier2(f,o,h,u,3),this._addBezier2(f,u,p,a,3),r.push(f);for(let g=0;g<8;g++){const _=f[2*g+1],v=[this._clone(_)];v.push(this._add(_,[l[0]/4,l[1]/4])),r.push(v)}break}case kr.Arc90Degrees:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,1),l=[o];this._add90DegArc(l,o,n,a),r.push(l);break}case kr.FullGeometry:default:r.push(i)}}return r}},uCe=class VA{static local(){return VA.instance===null&&(VA.instance=new VA),VA.instance}execute(e,r,i,s,n){return new Nat(e,r,i)}};uCe.instance=null;let Nat=class extends g8{constructor(e,r,i){super(e,!0,!0),this._curveHelper=new M0,this._beginCut=(r.beginCut!==void 0?r.beginCut:1)*i,this._endCut=(r.endCut!==void 0?r.endCut:1)*i,this._middleCut=(r.middleCut!==void 0?r.middleCut:0)*i,this._invert=r.invert!==void 0&&r.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:r,_endCut:i,_middleCut:s}=this,n=e.pathLength(),o=Pn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(r!==0||i!==0||s!==0)if(r+i+s>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,r),this._curveHelper.appendSubCurve(o,e,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,e,n-i,i)}else if(r===0&&i===0&&s===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else r+i+s<n&&(s===0?this._curveHelper.appendSubCurve(o,e,r,n-i):(this._curveHelper.appendSubCurve(o,e,r,.5*(n-s)),this._curveHelper.appendSubCurve(o,e,.5*(n+s),n-i)));return o.totalSize===0?null:o}};const rle=1e-7;let y8=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,r,i=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let s=0;s<e.length;s++){let n=Math.abs(e[s]);i&&n<rle&&(n=rle),this._values.push(n),this._length+=n}return r&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const r=this._values?this._values.length:0;for(let i=0;i<r;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},Cg=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var r_;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(r_||(r_={}));let KI=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},_8=class extends M0{constructor(e=0,r=!1){super(e,r),this._tolerance=MO,this._currentPosition=new KI}updateTolerance(e){this._tolerance=MO*e}init(e,r,i=!0){return i?(this._patternLength=r.length(),this._partExtPtGap=r.extPtGap,this._partCtrlPtGap=r.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,r=r_.FAIL){const i=new KI;return!!this._nextPosition(e,i,null,r)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[r,i]=this._getAngleCS(this._currentPosition);e.ca=r,e.sa=i}nextPointAndAngle(e,r,i=r_.FAIL){const s=new KI;if(!this._nextPosition(e,s,null,i))return!1;s.copyTo(this._currentPosition),r.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return r.ca=n,r.sa=o,!0}nextCurve(e){if(e===0)return null;const r=Pn.createEmptyOptimizedCIM("esriGeometryPolyline");r.startPath(),r.nextPath();const i=new KI;return this._nextPosition(e,i,r,r_.END)?(i.copyTo(this._currentPosition),r):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,r,i,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(r);r.abscissa+e*this._partLengthRatio>r.segmentLength+this._tolerance;){if(i){if(i.pathSize===0)if(n===0){const a=r.segment[0];i.pushXY(a[0],a[1])}else i.pushPoint(this.getSegCoord2D(r.segment,n));const o=r.segment[1];i.pushXY(o[0],o[1])}if(n=0,e-=(r.segmentLength-r.abscissa)/this._partLengthRatio,this._partSegCount)r.segment=this._nextSegment(),r.segmentLength=this.getSegLength(r.segment),r.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==r_.FAIL&&(r.segmentLength=this.getSegLength(r.segment),r.isPartEnd=!0,s===r_.END?(r.abscissa=r.segmentLength,r.isPathEnd=!0):r.abscissa=r.segmentLength+e,!0);this._currentPosition.copyTo(r)}}if(r.abscissa+=e*this._partLengthRatio,i){i.pathSize===0&&(n===0?i.pushPoint(r.segment[0]):i.pushPoint(this.getSegCoord2D(r.segment,n)));const o=r.abscissa/r.segmentLength;o===1?i.pushPoint(r.segment[1]):i.pushPoint(this.getSegCoord2D(r.segment,o))}return this._partSegCount||Math.abs(r.abscissa-r.segmentLength)<this._tolerance&&(r.isPathEnd=this._partIsLast,r.isPartEnd=!0),!0}_getPoint(e){const r=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,r)}_getAngleCS(e){const r=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,r)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const r=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(r);let i=r+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const s=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(s+n))/this._patternLength);o<=0&&(o=s+n>0?0:1),this._partLengthRatio=this._partLength/(s+n+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const DT={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetX:0,offsetY:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function Fat(t){return typeof t=="function"}function kat(t,e,r,i){return Fat(t)?t(e,r,i):t}const Uat=` /-,
`;function ile(t){let e=t.length;for(;e--;)if(!Uat.includes(t.charAt(e)))return!1;return!0}function zat(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,ile(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,ile(n)])}return r}function Bat(t,e,r,i){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let u=l;r!=null&&(u=elt(l,r));const h=t.attributes[u];h&&(n&&(s+=n,n=null),s+=h)}}return Vat(s,i)}function Vat(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function Gat(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function jat(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function Hat(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function qat(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function hCe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const br=(t,e=0)=>t==null||isNaN(t)?e:t,Wat=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function Yat(){return me(()=>import("./geometryEngineJSON-B-7dXK-n.js").then(t=>t.g),__vite__mapDeps([9,10,11]))}function Xat(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function Zat(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function dCe(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function pCe(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function dM(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=dM(e);if(r!=null)return r}break;case"CIMTextSymbol":return dM(t.symbol);case"CIMSolidFill":return t.color}return null}function Cq(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=Cq(r);if(i!=null)return i}break}case"CIMTextSymbol":return Cq(t.symbol);case"CIMSolidStroke":return t.color}}function Aq(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Aq(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return Aq(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function Jat(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function Kat(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Qat(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const Jx=t=>t.includes("data:image/svg+xml");function D6t(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function sle(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function N6t(t,e,r,i,s,n){const{infos:o}=n;let a=1,l=0,c=0,u=0;for(const{offsetX:f,offsetY:g,rotation:_,size:v,frameHeight:b,rotateClockWise:w}of o)c=ale(f,g,l,a,c),u=ole(f,g,l,a,u),b&&(a*=v/b),l=lle(_,w,l);const h=ale(i,s,l,a,c),p=ole(i,s,l,a,u);return{size:t*a,rotation:lle(e,r,l),offsetX:h,offsetY:p}}function fCe(t){return t!=null&&t.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function nle(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const r of e)if(r.type==="CIMVectorMarker")return nle(r)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const r of e)if(r.symbol)return nle(r.symbol)}}return"Normal"}function elt(t,e){if(e!==null){const r=e.get(t);return r?r.name:t}return t}function ole(t,e,r,i,s){const n=r*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*i+s}return e*i+s}function ale(t,e,r,i,s){const n=r*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*i+s:t*i+s}function lle(t,e,r){return e?r-t:r+t}let mCe=class GA{static local(){return GA.instance===null&&(GA.instance=new GA),GA.instance}execute(e,r,i,s,n){return new tlt(e,r,i)}};mCe.instance=null;let tlt=class extends g8{constructor(e,r,i){super(e,!0,!0),this._firstCurve=null,this._walker=new _8,this._walker.updateTolerance(i),this._endings=r.lineDashEnding,this._customDashPos=-(r.offsetAlongLine??0)*i,this._offsetAtEnd=(r.customEndingOffset??0)*i,this._pattern=new y8,this._pattern.init(fCe(r).dashTemplate,!0),this._pattern.scale(i)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const s=x_(e);return Pn.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case ia.HalfPattern:case ia.HalfGap:default:this._pattern.extPtGap=0;break;case ia.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case ia.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case ia.NoConstraint:this.isClosed||(s=!1);break;case ia.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const o=x_(e);return Pn.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,s)){const o=x_(e);return Pn.fromJSONCIM({paths:[o]})}}let r;if(this.iteratePath)r=this._pattern.nextValue();else{let s;switch(this._endings){case ia.HalfPattern:default:s=.5*this._pattern.firstValue();break;case ia.HalfGap:s=.5*-this._pattern.lastValue();break;case ia.FullGap:s=-this._pattern.lastValue();break;case ia.FullPattern:s=0;break;case ia.NoConstraint:case ia.Custom:s=-this._customDashPos}let n=s/this._pattern.length();n-=Math.floor(n),s=n*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();let o=!1;for(;s>=r;)s-=r,r=this._pattern.nextValue(),o=!o;r-=s,o?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}let i=this._walker.nextCurve(r);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i==null||i.reset(),i}},gCe=class jA{static local(){return jA.instance===null&&(jA.instance=new jA),jA.instance}execute(e,r,i,s,n,o){return new rlt(e,r,i,s,n,o)}};gCe.instance=null;let rlt=class{constructor(e,r,i,s,n,o){switch(this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._maxInflateSize=o*i,this._width=(r.width!==void 0?r.width:2)*i,r.method){case bb.Mitered:case bb.Bevelled:case bb.Rounded:case bb.TrueBuffer:case bb.Square:}this._option=r.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const r=e.asJSON();return Math.min(r.xmax-r.xmin,r.ymax-r.ymin)-2*this._width<0?e:Pn.fromJSONCIM({paths:[[[r.xmin+this._width,r.ymin+this._width],[r.xmax-this._width,r.ymin+this._width],[r.xmax-this._width,r.ymax-this._width],[r.xmin+this._width,r.ymax-this._width],[r.xmin+this._width,r.ymin+this._width]],[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const r=this._geometryEngine;if(r==null)return null;const i=this._tileKey?dK(e,this._maxInflateSize):e.clone();if(!i)continue;const s=r.buffer(Xe.WebMercator,i.asJSON(),-this._width,1);if(s){for(const n of s.rings)if(n){i.startPath();for(const o of n.reverse())i.pushXY(o[0],i.yFactor*o[1])}}return i}}return null}},yCe=class HA{static local(){return HA.instance===null&&(HA.instance=new HA),HA.instance}execute(e,r,i,s,n){return new ilt(e,r,i)}};yCe.instance=null;let ilt=class extends g8{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new M0,this._length=(r.length!==void 0?r.length:20)*i,this._angle=r.angle!==void 0?r.angle:225,this._position=r.position!==void 0?r.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const r=Pn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const i=e.x,s=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-i,o-s];this._curveHelper.normalize(a);const l=i+(n-i)*this._position/100,c=s+(o-s)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const p=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return r.pushPath([[i,s],p,f,[n,o]]),r}},_Ce=class qA{static local(){return qA.instance===null&&(qA.instance=new qA),qA.instance}execute(e,r,i,s,n){return new slt(e,r,i)}};_Ce.instance=null;let slt=class{constructor(e,r,i){this._inputGeometries=e,this._offsetX=r.offsetX!==void 0?r.offsetX*i:0,this._offsetY=r.offsetY!==void 0?r.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,r,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+r,e.y=e.y+i;return e.reset(),e}};const nlt=10;let vCe=class WA{static local(){return WA.instance===null&&(WA.instance=new WA),WA.instance}execute(e,r,i,s,n,o){return new olt(e,r,i,s,n,o)}};vCe.instance=null;let olt=class{constructor(e,r,i,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new M0,this._offset=(r.offset??1)*i,this._method=r.method,this._maxInflateSize=Math.max(Math.abs(o*i),nlt),this._option=r.option,this._offsetFlattenError=MO*i}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===zg.Rounded&&this._offset>0){const o=x_(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=Pn.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const n=e.asJSON();if(Xd(n)&&Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._offset>0)return Pn.fromJSONCIM({xmin:n.xmin-this._offset,xmax:n.xmax+this._offset,ymin:n.ymin-this._offset,ymax:n.ymax+this._offset})}const r=this._geometryEngine;if(r==null)continue;const i=this._tileKey?dK(e,this._maxInflateSize):e.clone();if(!i)continue;const s=r.offset(Xe.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return s?Pn.fromJSONCIM(s):null}return null}},bCe=class YA{static local(){return YA.instance===null&&(YA.instance=new YA),YA.instance}execute(e,r,i,s,n){return new alt(e,r,i)}};bCe.instance=null;let alt=class{constructor(e,r,i){this._inputGeometries=e,this._reverse=r.reverse===void 0||r.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return llt(e.clone());e=this._inputGeometries.next()}return null}};function llt(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const r=t.x,i=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=r,t.y=i,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}let wCe=class XA{static local(){return XA.instance===null&&(XA.instance=new XA),XA.instance}execute(e,r,i,s,n){return new clt(e,r,i)}};wCe.instance=null;let clt=class{constructor(e,r,i){this._inputGeometries=e,this._rotateAngle=r.angle!==void 0?r.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const r=M6(e),i=(r[2]+r[0])/2,s=(r[3]+r[1])/2;return e.reset(),this._rotate(e.clone(),i,s)}e=this._inputGeometries.next()}return null}_rotate(e,r,i){const s=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-r,a=e.y-i;e.x=r+o*s-a*n,e.y=i+o*n+a*s}return e.reset(),e}},xCe=class ZA{static local(){return ZA.instance===null&&(ZA.instance=new ZA),ZA.instance}execute(e,r,i,s,n){return new ult(e,r,i)}};xCe.instance=null;let ult=class{constructor(e,r,i){this._inputGeometries=e,this._xFactor=r.XScaleFactor!==void 0?r.XScaleFactor:1.15,this._yFactor=r.YScaleFactor!==void 0?r.YScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const r=M6(e),i=(r[2]+r[0])/2,s=(r[3]+r[1])/2;return e.reset(),this._scaleCursor(e.clone(),i,s)}}return null}_scaleCursor(e,r,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=r+(e.x-r)*this._xFactor,e.y=i+(e.y-i)*this._yFactor;return e.reset(),e}},TCe=class JA{static local(){return JA.instance===null&&(JA.instance=new JA),JA.instance}execute(e,r,i,s,n){return new hlt(e,r,i)}};TCe.instance=null;let hlt=class{constructor(e,r,i){this._inputGeometries=e,this._height=(r.amplitude!==void 0?r.amplitude:2)*i,this._period=(r.period!==void 0?r.period:3)*i,this._style=r.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new y8,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new _8,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const r=this._processGeom(e);if(r)return r;e=this._inputGeometries.next()}return null}_processGeom(e){const r=Pn.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){r.startPath();const i=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case $T.Sinus:default:this._constructCurve(r,i,!1);break;case $T.Square:this._constructSquare(r,i);break;case $T.Triangle:this._constructTriangle(r,i);break;case $T.Random:this._constructCurve(r,i,!0)}else for(;e.nextPoint();)r.pushXY(e.x,e.y)}return r}_constructCurve(e,r,i){let s=Math.round(r/this._period);s===0&&(s=1);const n=s*16+1,o=r/s,a=this._period/16,l=1/n,c=2*Math.PI*r/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),f=.75-Math.random()/2,g=.75-Math.random()/2,_=new Cg;this._walker.curPointAndAngle(_),e.pushPoint(_.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,_)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,i){const T=this._height/2*(1+.3*Math.sin(f*c*b+u));w=T*Math.sin(c*b+h),w+=T*Math.sin(g*c*b+p),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(_.pt[0]-w*_.sa,_.pt[1]+w*_.ca)}}}_constructSquare(e,r){Math.round(r/this._period);let i=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new Cg;this._walker.curPointAndAngle(n);const o=new Cg;if(this._walker.nextPointAndAngle(this._period,o)){const a=new Cg;this._walker.nextPointAndAngle(this._period,a)&&(i?(e.pushPoint(n.pt),i=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,r){Math.round(r/this._period);let i=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new Cg;this._walker.curPointAndAngle(n);const o=new Cg;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new Cg;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(i?(e.pushPoint(n.pt),i=!1):e.pushPoint(n.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}},SCe=class KA{static local(){return KA.instance===null&&(KA.instance=new KA),KA.instance}execute(e,r,i,s,n){return new dlt(e,r,i)}};SCe.instance=null;let dlt=class extends zR{constructor(e,r,i){super(e),this._geometryWalker=new _8,this._geometryWalker.updateTolerance(i),this._angleToLine=r.angleToLine??!0,this._offset=(r.offset?r.offset:0)*i,this._originalEndings=r.endings,this._offsetAtEnd=(r.customEndingOffset?r.customEndingOffset:0)*i,this._position=-(r.offsetAlongLine?r.offsetAlongLine:0)*i,this._pattern=new y8,this._pattern.init(r.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let r;if(this.iteratePath)r=this._pattern.nextValue();else{this._originalEndings===Ld.WithFullGap&&this.isClosed?this._endings=Ld.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case Ld.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case Ld.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case Ld.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case Ld.WithMarkers:s=0;break;case Ld.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let o=0;for(;s>o;)s-=o,o=this._pattern.nextValue();o-=s,r=o,this.iteratePath=!0}const i=new Cg;return this._geometryWalker.nextPointAndAngle(r,i)?this._endings===Ld.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===Ld.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let r=e/this._pattern.length();return r-=Math.floor(r),r*this._pattern.length()}},ECe=class QA{static local(){return QA.instance===null&&(QA.instance=new QA),QA.instance}execute(e,r,i,s,n){return new plt(e,r,i)}};ECe.instance=null;let plt=class extends zR{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new M0,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._type=r.extremityPlacement,this._position=r.offsetAlongLine!==void 0?r.offsetAlongLine*i:0,this._beginProcessed=!1}processPath(e){let r;switch(this._type){case Jf.Both:default:this._beginProcessed?(r=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(r=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case Jf.JustBegin:r=this._atExtremities(e,this._position,!0);break;case Jf.JustEnd:r=this._atExtremities(e,this._position,!1);case Jf.None:}return r}_atExtremities(e,r,i){if(i||e.seekPathEnd(),i?e.nextPoint():e.prevPoint()){let s=0,[n,o]=[0,0],[a,l]=[e.x,e.y];for(;i?e.nextPoint():e.prevPoint();){n=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(n,o,a,l);if(s+c>r){const u=(r-s)/c,[h,p]=this._curveHelper.getAngleCS(n,o,a,l,u),f=this._curveHelper.getCoord2D(n,o,a,l,u);return this.internalPlacement.setTranslate(f[0]-this._offset*p,f[1]+this._offset*h),this._angleToLine&&this.internalPlacement.setRotateCS(-h,-p),this.internalPlacement}s+=c}}return null}},CCe=class eP{static local(){return eP.instance===null&&(eP.instance=new eP),eP.instance}execute(e,r,i,s,n){return new flt(e,r,i)}};CCe.instance=null;let flt=class extends zR{constructor(e,r,i){super(e),this._walker=new _8,this._walker.updateTolerance(i),this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._beginGap=r.beginPosition!==void 0?r.beginPosition*i:0,this._endGap=r.endPosition!==void 0?r.endPosition*i:0,this._flipFirst=r.flipFirst===void 0||r.flipFirst,this._pattern=new y8,this._pattern.init(r.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let r;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;r=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;r=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const i=new Cg;if(!this._walker.nextPointAndAngle(r,i,r_.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const s=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=i.ca,o=i.sa):(n=1,o=0),s&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const ay=512,mlt=10,Yp=24,yF=1e-6;let ACe=class tP{static local(){return tP.instance===null&&(tP.instance=new tP),tP.instance}execute(e,r,i,s,n){return new glt(e,r,i,s,n)}};ACe.instance=null;let glt=class Jv{constructor(e,r,i,s,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(r.stepX??16)*i,this._stepY=Math.abs(r.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=r.gridType??hM.Fixed,this._gridType===hM.Random){const o=r.seed??13,a=1;this._randomLCG=new Wb(o*a),this._randomness=(r.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=r.gridAngle??0,this._shiftOddRows=r.shiftOddRows??!1,this._offsetX=(r.offsetX??0)*i,this._offsetY=(r.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,s!=null){const[o,a,l,c]=s.split("/"),u=parseFloat(o),h=parseFloat(a),p=parseFloat(l),f=parseFloat(c);this._graphicOriginX=-(f*2**u+p)*ay,this._graphicOriginY=h*ay,this._testInsidePolygon=!0}this._internalPlacement=new dC,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!Jv._randValues){Jv._randValues=[];for(let e=0;e<Yp;e++)for(let r=0;r<Yp;r++)Jv._randValues.push(this._randomLCG.getFloat()),Jv._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let r,i,s,n,o,a,l,c,u,h,p,f,g,_;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=p=Number.MAX_VALUE,u=h=_=f=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,r=a-this._graphicOriginX-this._offsetX,i=o-this._graphicOriginY-this._offsetY,v?(s=this._cosAngle*r-this._sinAngle*i,n=this._sinAngle*r+this._cosAngle*i):(s=r,n=i),l=Math.min(l,s),u=Math.max(u,s),c=Math.min(c,n),h=Math.max(h,n),p=Math.min(p,o),f=Math.max(f,o),g=Math.min(g,a),_=Math.max(_,a);p=p!==Number.MAX_VALUE?p:-ay-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,_=_!==-Number.MAX_VALUE?_:ay+this._stepX;const b=f-p,w=_-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?p:g,this._testInsidePolygon){let T=0-this._graphicOriginX-this._offsetX-this._stepX,S=ay-this._graphicOriginX-this._offsetX+this._stepX,C=-ay-this._graphicOriginY-this._offsetY-this._stepY,P=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const R=[[T,C],[T,P],[S,C],[S,P]];T=C=Number.MAX_VALUE,S=P=-Number.MAX_VALUE;for(const L of R){const F=this._cosAngle*L[0]-this._sinAngle*L[1],U=this._sinAngle*L[0]+this._cosAngle*L[1];T=Math.min(T,F),S=Math.max(S,F),C=Math.min(C,U),P=Math.max(P,U)}}l=l!==Number.MAX_VALUE?Math.max(l,T):T,c=c!==Number.MAX_VALUE?Math.max(c,C):C,u=u!==-Number.MAX_VALUE?Math.min(u,S):S,h=h!==-Number.MAX_VALUE?Math.min(h,P):P}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,_,p,f)}_buildAccelerationMap(e,r,i,s,n){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?n-s:i-r;let c=Math.ceil(l/mlt);if(c<=1)return;const u=Math.floor(l/c);let h,p,f,g,_,v,b,w,T,S,C;for(c++,this._delta=u,a?(T=-ay-2*this._stepY,S=2*this._stepY,C=s):(T=-2*this._stepX,S=ay+2*this._stepX,C=r);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(h=e.x,p=e.y;e.nextPoint();h=f,p=g){if(f=e.x,g=e.y,a){if(p===g||p<T&&g<T||p>S&&g>S)continue;_=Math.min(p,g),v=Math.max(p,g)}else{if(h===f||h<T&&f<T||h>S&&f>S)continue;_=Math.min(h,f),v=Math.max(h,f)}for(;_<v;)b=Math.floor((_-C)/u),cle(b,h,p,f,g,o),_+=u;w=Math.floor((v-C)/u),w>b&&cle(w,h,p,f,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const r=this._currentY*this._stepY+this._offsetY;let i,s;if(this._currentX++,this._gridType===hM.Random){const n=(this._currentX%Yp+Yp)%Yp,o=(this._currentY%Yp+Yp)%Yp;i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Jv._randValues[o*Yp+n])*2/3,s=this._graphicOriginY+r+this._stepY*this._randomness*(.5-Jv._randValues[o*Yp+n+1])*2/3}else i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*r,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*r;if(!this._testInsidePolygon||this._isInsidePolygon(i,s,this._geometryCursor))return this._internalPlacement.setTranslate(i,s),this._internalPlacement}}_isInsidePolygon(e,r,i){if(this._accelerationMap==null)return ylt(e,r,i);e+=yF,r+=yF;const s=this._verticalSubdivision,n=s?r:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const p of a){if(l=p[0],c=p[1],s){if(l[1]>r==c[1]>r)continue;u=(c[0]-l[0])*(r-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(r-l[1])}u>0?h++:h--}return h!==0}};function ylt(t,e,r){let i,s,n,o,a=0;for(t+=yF,e+=yF,r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();i=n,s=o)n=r.x,o=r.y,s>e!=o>e&&((n-i)*(e-s)-(o-s)*(t-i)>0?a++:a--);return a!==0}function cle(t,e,r,i,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,r],[i,s]])}const _lt=.001;let PCe=class rP{static local(){return rP.instance===null&&(rP.instance=new rP),rP.instance}execute(e,r,i,s,n){return new vlt(e,r,i)}};PCe.instance=null;let vlt=class extends zR{constructor(e,r,i){super(e),this._curveHelper=new M0,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._relativeTo=r.relativeTo,this._position=r.startPointOffset!==void 0?r.startPointOffset*i:0,this._epsilon=_lt*i}processPath(e){const r=this._position;if(this._relativeTo===wb.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[s,n]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(s,n,o,a);if(l<this._epsilon){s=o,n=a;continue}const c=.5+this._position/l,[u,h]=this._curveHelper.getAngleCS(s,n,o,a,c),p=this._curveHelper.getCoord2D(s,n,o,a,c);return this.internalPlacement.setTranslate(p[0]-this._offset*h,p[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,h),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===wb.LineEnd;return this.onLine(e,r,i)}onLine(e,r,i){let s,n=!1;switch(this._relativeTo){case wb.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+r;break;case wb.LineBeginning:s=r;break;case wb.LineEnd:s=r,n=!0}i?e.seekPathEnd():e.seekPathStart();let o=0;if(i?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;i?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const h=this._curveHelper.getLength(a,l,c,u);if(o+h>s){const p=(s-o)/h,[f,g]=this._curveHelper.getAngleCS(a,l,c,u,p),_=this._curveHelper.getCoord2D(a,l,c,u,p),v=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(_[0]-v*g,_[1]+v*f),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-f,-g):this.internalPlacement.setRotateCS(f,g)),this.internalPlacement}a=c,l=u,o+=h}}return null}};const blt=1e-15;let MCe=class iP{static local(){return iP.instance===null&&(iP.instance=new iP),iP.instance}execute(e,r,i,s,n){return new wlt(e,r,i)}};MCe.instance=null;let wlt=class extends zR{constructor(e,r,i){super(e),this._curveHelper=new M0,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._endPoints=r.placeOnEndPoints===void 0||r.placeOnEndPoints,this._controlPoints=r.placeOnControlPoints===void 0||r.placeOnControlPoints,this._regularVertices=r.placeOnRegularVertices===void 0||r.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const r=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(r[2]);let i=r[0],s=r[1];if(this._offset!==0){const n=Math.cos(r[2]),o=Math.sin(r[2]);i-=this._offset*o,s+=this._offset*n}return this.internalPlacement.setTranslate(i,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const r=e.isClosed();let i=0,s=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const p=e.x,f=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(n=this._curveHelper.getAngle(a,l,p,f,0)),u?(u=!1,r?(i=n,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,QI(o,n)]):this._regularVertices&&this._tags.push([a,l,QI(o,n)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,p,f,1)),h=e.nextPoint(),h||(r?g||s?this._controlPoints&&this._tags.push([p,f,QI(o,i)]):this._regularVertices&&this._tags.push([p,f,QI(o,i)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([p,f,o])),a=p,l=f,c=g}}this._tagIterator=0}};function QI(t,e){const r=Math.PI;for(;Math.abs(e-t)>r+2*blt;)e-t>r?e-=2*r:e+=2*r;return(t+e)/2}const xlt=100*222045e-21;function Tlt(t){if(t.totalSize===0)return null;const e=M6(t);if(!e)return null;const r=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*xlt;let i=0,s=0;t.reset();for(let F=0;t.nextPath();F++){const U=t.getCurrentRingArea();U>s&&(s=U,i=F)}if(t.seekPath(i),t.pathSize===0)return null;t.seekPathStart();const n=Qme(t);if(Math.abs(s)<=2*r*r)return[(n[0]+n[2])/2,(n[1]+n[3])/2];t.seekPathStart();const o=h4e(t,jt());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,h=a3(o,t,!0);h.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],h=a3(o,t,!1)),l[0]=h.distance,c[0]=0;const p=[NaN,NaN];let f=!1,g=.25,_=-1,v=NaN;do if(v=NaN,a[1]=wz(t,xz(n[0],n[2],g),r,e),isNaN(a[1][0])||isNaN(a[1][1])||(h=a3(a[1],t,!1),v=h.distance),!isNaN(v)&&v>r&&PN(a[1],t))f=!0,l[1]=v,c[1]=Kv(a[1],o);else if(!isNaN(v)&&v>_&&(_=v,p[0]=a[1][0],p[1]=a[1][1]),g-=.01,g<.1){if(!(_>=0))break;f=!0,l[1]=_,a[1][0]=p[0],a[1][1]=p[1],c[1]=Kv(a[1],o)}while(!f);f=!1,g=.5,_=-1;let b=.01,w=1;do if(v=NaN,a[2]=wz(t,xz(n[0],n[2],g),r,e),isNaN(a[2][0])||isNaN(a[2][1])||(h=a3(a[2],t,!1),v=h.distance),!isNaN(v)&&v>r&&PN(a[2],t))f=!0,l[2]=v,c[2]=Kv(a[2],o);else if(!isNaN(v)&&v>_)_=v,p[0]=a[2][0],p[1]=a[2][1];else if(v>_&&(_=v,p[0]=a[2][0],p[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(_>=0))break;f=!0,l[2]=_,a[2][0]=p[0],a[2][1]=p[1],c[2]=Kv(a[2],o)}while(!f);f=!1,g=.75,_=-1;do if(v=NaN,a[3]=wz(t,xz(n[0],n[2],g),r,e),isNaN(a[3][0])||isNaN(a[3][1])||(h=a3(a[3],t,!1),v=h.distance),!isNaN(v)&&v>r&&PN(a[3],t))f=!0,l[3]=v,c[3]=Kv(a[3],o);else if(v>_&&(_=v,p[0]=a[3][0],p[1]=a[3][1]),g+=.01,g>.9){if(!(_>=0))break;f=!0,l[3]=_,a[3][0]=p[0],a[3][1]=p[1],c[3]=Kv(a[3],o)}while(!f);const T=[0,1,2,3],S=u?0:1;let C;for(let F=S;F<4;F++)for(let U=S;U<3;U++){const j=c[U],z=c[U+1];Clt(j,z)>0&&(C=T[U],T[U]=T[U+1],T[U+1]=C,c[U]=z,c[U+1]=j)}let P=S,R=0,L=0;for(let F=S;F<4;F++){switch(F){case 0:L=2*l[T[F]];break;case 1:L=1.66666666*l[T[F]];break;case 2:L=1.33333333*l[T[F]];break;case 3:L=l[T[F]]}L>R&&(R=L,P=T[F])}return a[P]}function PN(t,e){let r,i,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(r=e.x,i=e.y;e.nextPoint();r=s,i=n)s=e.x,n=e.y,i>t[1]!=n>t[1]&&((s-r)*(t[1]-i)-(n-i)*(t[0]-r)>0?o++:o--);return o!==0}function a3(t,e,r){if(r&&PN(t,e))return{coord:t,distance:0};let i=1/0,s=0,n=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],l4e(l,t,o,a);const c=Kv(t,l);c<i&&(i=c,s=l[0],n=l[1])}return{coord:[s,n],distance:Math.sqrt(i)}}function wz(t,e,r,i){const s=[e,0];let n=1/0,o=1/0,a=!1,l=!1;const c=[[e,i[1]-1],[e,i[3]+1]],u=[0,0],h=[0,0],p=[0,0],f=[[0,0],[0,0]],g=jt();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(f[0][0]=t.x,f[0][1]=t.y;t.nextPoint();f[0][0]=f[1][0],f[0][1]=f[1][1]){if(f[1][0]=t.x,f[1][1]=t.y,Slt(g,f)===null||(h[0]=c[0][0],h[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],Elt(g,h,p)===0)||!V4(c[0],c[1],f[0],f[1],u))continue;const _=u[1];n>o?_<n&&(n=_,a=!0):_<o&&(o=_,l=!0)}return a&&l?s[1]=(n+o)/2:s[0]=s[1]=NaN,s}function Slt(t,e){if(e.length<2)return null;t||(t=jt());const[r,i]=e[0],[s,n]=e[1];return t[0]=Math.min(r,s),t[1]=Math.min(i,n),t[2]=Math.max(r,s),t[3]=Math.max(i,n),t}const eL=1,tL=4,ule=3,hle=12;function Elt(t,e,r){let i=Xp(e,t),s=Xp(r,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(i&s)return 0;if(!(i|s))return 4;const c=(i?1:0)|(s?2:0);do{const u=r[0]-e[0],h=r[1]-e[1];if(u>h)i&ule?(i&eL?(e[1]+=h*(n-e[0])/u,e[0]=n):(e[1]+=h*(a-e[0])/u,e[0]=a),i=Xp(e,t)):s&ule?(s&eL?(r[1]+=h*(n-r[0])/u,r[0]=n):(r[1]+=h*(a-r[0])/u,r[0]=a),s=Xp(r,t)):i?(i&tL?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),i=Xp(e,t)):(s&tL?(r[0]+=u*(o-r[1])/h,r[1]=o):(r[0]+=u*(l-r[1])/h,r[1]=l),s=Xp(r,t));else if(i&hle?(i&tL?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),i=Xp(e,t)):s&hle?(s&tL?(r[0]+=u*(o-r[1])/h,r[1]=o):(r[0]+=u*(l-r[1])/h,r[1]=l),s=Xp(r,t)):i?(i&eL?(e[1]+=h*(n-e[0])/u,e[0]=n):(e[1]+=h*(a-e[0])/u,e[0]=a),i=Xp(e,t)):(s&eL?(r[1]+=h*(n-r[0])/u,r[0]=n):(r[1]+=h*(a-r[0])/u,r[0]=a),s=Xp(r,t)),i&s)return 0}while(i|s);return c}function Xp(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function xz(t,e,r){return t+(e-t)*r}function Kv(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function Clt(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const r=isNaN(t),i=isNaN(e);return r<i?-1:r>i?1:0}let OCe=class sP{static local(){return sP.instance===null&&(sP.instance=new sP),sP.instance}execute(e,r,i,s,n){return new Alt(e,r,i)}};OCe.instance=null;let Alt=class{constructor(e,r,i){this._geometryCursor=e,this._offsetX=r.offsetX!==void 0?r.offsetX*i:0,this._offsetY=r.offsetY!==void 0?r.offsetY*i:0,this._method=r.method!==void 0?r.method:IT.OnPolygon,this._internalPlacement=new dC}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let r=!1;switch(this._method){case IT.CenterOfMass:{const i=g4e(e);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),r=!0)}break;case IT.BoundingBoxCenter:{const i=M6(e);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),r=!0)}break;case IT.OnPolygon:default:{const i=Tlt(e);i!==null&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),r=!0)}}return r?this._internalPlacement:null}};function Plt(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return oCe.local();case"CIMGeometricEffectArrow":return aCe.local();case"CIMGeometricEffectBuffer":return lCe.local();case"CIMGeometricEffectControlMeasureLine":return cCe.local();case"CIMGeometricEffectCut":return uCe.local();case"CIMGeometricEffectDashes":return mCe.local();case"CIMGeometricEffectDonut":return gCe.local();case"CIMGeometricEffectJog":return yCe.local();case"CIMGeometricEffectMove":return _Ce.local();case"CIMGeometricEffectOffset":return vCe.local();case"CIMGeometricEffectReverse":return bCe.local();case"CIMGeometricEffectRotate":return wCe.local();case"CIMGeometricEffectScale":return xCe.local();case"CIMGeometricEffectWave":return TCe.local()}return null}function Mlt(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return SCe.local();case"CIMMarkerPlacementAtExtremities":return ECe.local();case"CIMMarkerPlacementAtRatioPositions":return CCe.local();case"CIMMarkerPlacementInsidePolygon":return ACe.local();case"CIMMarkerPlacementOnLine":return PCe.local();case"CIMMarkerPlacementOnVertices":return MCe.local();case"CIMMarkerPlacementPolygonCenter":return OCe.local()}return null}function Tz(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const i=r.getContext("2d");return e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0),r}let Olt=class RCe{constructor(e=0,r=0,i=0,s=0){this.x=e,this.y=r,this.width=i,this.height=s}static fromExtent(e){return new RCe(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function Rlt(t){return`rgb(${t.slice(0,3).toString()})`}function Sz(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let $Ce=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,r){var j,z;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,s=i.getContext("2d",{willReadFrequently:!0});this._setFontProperties(s,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:o}=r.font;this._lineThroughWidthOffset=n&&n==="line-through"?.1*this._lineHeight:0;const a=r.backgroundColor!=null||r.borderLine!=null,l=a?bje:0,c=this._computeTextWidth(s,r)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(i.width=c+2*this._lineThroughWidthOffset,i.height=u,i.width===0||i.height===0)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight*r.pixelRatio),this._renderedHaloSize=on(r.halo.size)*r.pixelRatio,this._renderedWidth=c*r.pixelRatio,this._renderedHeight=u*r.pixelRatio,this._lineThroughWidthOffset*=r.pixelRatio;const h=r.color??[0,0,0,0],p=r.halo&&r.halo.color?r.halo.color:[0,0,0,0];this._fillStyle=Sz(h),this._haloStyle=Rlt(p);const f=this._renderedLineHeight,g=this._renderedHaloSize;s.save(),s.clearRect(0,0,i.width,i.height),this._setFontProperties(s,r);const _=l*r.pixelRatio,v=$lt(s.textAlign,this._renderedWidth-2*_)+g+_,b=g+_,w=g>0;let T=this._lineThroughWidthOffset,S=0;if(a){s.save();const Z=r.backgroundColor??[0,0,0,0],W=((j=r.borderLine)==null?void 0:j.color)??[0,0,0,0],Y=2*on(((z=r.borderLine)==null?void 0:z.size)??0);s.fillStyle=Sz(Z),s.strokeStyle=Sz(W),s.lineWidth=Y,s.fillRect(0,0,i.width,i.height),s.strokeRect(0,0,i.width,i.height),s.restore()}w&&this._renderHalo(s,v,b,T,S,r),S+=b,T+=v;for(const Z of this._textLines)w?(s.globalCompositeOperation="destination-out",s.fillStyle="rgb(0, 0, 0)",s.fillText(Z,T,S),s.globalCompositeOperation="source-over",s.fillStyle=this._fillStyle,s.fillText(Z,T,S)):(s.fillStyle=this._fillStyle,s.fillText(Z,T,S)),n&&n!=="none"&&this._renderDecoration(s,T,S,n,o),S+=f;s.restore();const C=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,R=s.getImageData(0,0,C,P),L=new Uint8Array(R.data);if(r.premultiplyColors){let Z;for(let W=0;W<L.length;W+=4)Z=L[W+3]/255,L[W]=L[W]*Z,L[W+1]=L[W+1]*Z,L[W+2]=L[W+2]*Z}let F,U;switch(r.horizontalAlignment){case"left":F=-.5;break;case"right":F=.5;break;default:F=0}switch(r.verticalAlignment){case"bottom":U=-.5;break;case"top":U=.5;break;case"baseline":U=-1/6;break;default:U=0}return{size:[C,P],image:new Uint32Array(L.buffer),sdf:!1,simplePattern:!1,anchorX:F,anchorY:U,canvas:i}}_renderHalo(e,r,i,s,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),this._setFontProperties(u,o);const{decoration:h,weight:p}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,r,i,h,p),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,s,n,a,l),e.globalAlpha=1}_renderHaloNative(e,r,i,s,n){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,h=.1;for(let p=0;p<u;p++){const f=(1-(u-1)*h+p*h)*c;e.lineWidth=f,e.strokeText(l,r,i),s&&s!=="none"&&this._renderDecoration(e,r,i,s,n,f)}i+=o}}_setFontProperties(e,r){const i=Math.max(r.size,.5),s=r.font,n=`${s.style} ${s.weight} ${on(i*r.pixelRatio).toFixed(1)}px ${s.family}, sans-serif`;let o;switch(e.font=n,e.textBaseline="top",r.horizontalAlignment){case"left":default:o="left";break;case"right":o="right";break;case"center":o="center"}e.textAlign=o}computeTextSize(e,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,s=i.getContext("2d");this._setFontProperties(s,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,r),o=this._lineHeight*this._textLines.length;return i.width=n,i.height=o,[n*r.pixelRatio,o*r.pixelRatio]}_computeTextWidth(e,r){let i=0;for(const n of this._textLines)i=Math.max(i,e.measureText(n).width);const s=r.font;return(s.style==="italic"||s.style==="oblique"||typeof s.weight=="string"&&(s.weight==="bold"||s.weight==="bolder")||typeof s.weight=="number"&&s.weight>600)&&(i+=.3*e.measureText("w").width),i+=2*on(this._parameters.halo.size),Math.round(i)}_computeLineHeight(){let e=1.275*this._parameters.size;const r=this._parameters.font.decoration;return r&&r==="underline"&&(e*=1.3),Math.round(e+2*on(this._parameters.halo.size))}_renderDecoration(e,r,i,s,n,o){const a=.9*this._lineHeight,l=n==="bold"?.06:n==="bolder"?.09:.04;switch(e.textAlign){case"center":r-=this._renderedWidth/2;break;case"right":r-=this._renderedWidth}const c=e.textBaseline;if(s==="underline")switch(c){case"top":i+=a;break;case"middle":i+=a/2}else if(s==="line-through")switch(c){case"top":i+=a/1.5;break;case"middle":i+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(r-this._lineThroughWidthOffset,i),e.lineTo(r+this._renderedWidth+2*this._lineThroughWidthOffset,i),e.stroke(),e.restore()}};function $lt(t,e){return t==="center"?.5*e:t==="right"?e:0}const Q6t=512,ekt=128,tkt=511,rkt=29,ikt=24;var dle;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(dle||(dle={}));const Ilt=1.05,skt=5,nkt=6,okt=1.15,Llt=2,akt=128-2*Llt,lkt=10,Dlt=1024,ckt=256;function Nlt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Flt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function klt(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function ICe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function Ult(t){return t[0]*t[3]-t[1]*t[2]}function LCe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],h=r[2],p=r[3],f=r[4],g=r[5];return t[0]=i*c+n*u,t[1]=s*c+o*u,t[2]=i*h+n*p,t[3]=s*h+o*p,t[4]=i*f+n*g+a,t[5]=s*f+o*g+l,t}function pK(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+n*c,t[1]=s*u+o*c,t[2]=i*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function DCe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function fK(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*u+a,t[5]=s*c+o*u+l,t}function zlt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function Blt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function mK(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Vlt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Glt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function jlt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function NCe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Hlt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function qlt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function Wlt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Ylt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],f=e[5],g=wa();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-u)<=g*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-h)<=g*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-p)<=g*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=g*Math.max(1,Math.abs(a),Math.abs(f))}const Xlt=LCe,Zlt=NCe;Object.freeze(Object.defineProperty({__proto__:null,add:jlt,copy:Nlt,determinant:Ult,equals:Ylt,exactEquals:Wlt,frob:Glt,fromRotation:zlt,fromScaling:Blt,fromTranslation:mK,identity:Flt,invert:ICe,mul:Xlt,multiply:LCe,multiplyScalar:Hlt,multiplyScalarAndAdd:qlt,rotate:pK,scale:DCe,set:klt,str:Vlt,sub:Zlt,subtract:NCe,translate:fK},Symbol.toStringTag,{value:"Module"}));function FCe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Jlt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Klt(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function Qlt(t,e){return new Float32Array(t,e,6)}function kCe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function ect(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)kCe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Jlt,create:FCe,createView:Qlt,fromValues:Klt,transform:kCe,transformMany:ect},Symbol.toStringTag,{value:"Module"}));const tct=()=>ae.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Vf,Qd;function ukt(t){if(!t)return Vf.Center;switch(t){case"Left":case"left":return Vf.Left;case"Right":case"right":return Vf.Right;case"Justify":return tct().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Vf.Center;case"Center":case"center":return Vf.Center}}function hkt(t){if(!t)return Qd.Center;switch(t){case"Top":case"top":return Qd.Top;case"Center":case"middle":return Qd.Center;case"Baseline":case"baseline":return Qd.Baseline;case"Bottom":case"bottom":return Qd.Bottom}}function dkt(t){switch(t){case Vf.Right:case"right":return-1;case Vf.Center:case"center":return 0;case Vf.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function pkt(t){switch(t){case Qd.Top:case"top":return 1;case Qd.Center:case"middle":return 0;case Qd.Bottom:case Qd.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Vf||(Vf={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(Qd||(Qd={}));const K1=Math.PI/180,UCe=.5,rct=()=>ae.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let Qv=class xf{constructor(e){this._t=e}static createIdentity(){return new xf([1,0,0,0,1,0])}clone(){const e=this._t;return new xf(e.slice())}transform(e){const r=this._t;return[r[0]*e[0]+r[1]*e[1]+r[2],r[3]*e[0]+r[4]*e[1]+r[5]]}static createScale(e,r){return new xf([e,0,0,0,r,0])}scale(e,r){const i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=r,i[4]*=r,i[5]*=r,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,r){return new xf([0,0,e,0,0,r])}translate(e,r){const i=this._t;return i[2]+=e,i[5]+=r,this}static createRotate(e){const r=Math.cos(e),i=Math.sin(e);return new xf([r,-i,0,i,r,0])}rotate(e){return xf.multiply(this,xf.createRotate(e),this)}angle(){const e=this._t[0],r=this._t[3],i=Math.sqrt(e*e+r*r);return[e/i,r/i]}static multiply(e,r,i){const s=e._t,n=r._t,o=s[0]*n[0]+s[3]*n[1],a=s[1]*n[0]+s[4]*n[1],l=s[2]*n[0]+s[5]*n[1]+n[2],c=s[0]*n[3]+s[3]*n[4],u=s[1]*n[3]+s[4]*n[4],h=s[2]*n[3]+s[5]*n[4]+n[5],p=i._t;return p[0]=o,p[1]=a,p[2]=l,p[3]=c,p[4]=u,p[5]=h,i}invert(){const e=this._t;let r=e[0]*e[4]-e[1]*e[3];if(r===0)return new xf([0,0,0,0,0,0]);r=1/r;const i=(e[1]*e[5]-e[2]*e[4])*r,s=(e[2]*e[3]-e[0]*e[5])*r,n=e[4]*r,o=-e[1]*r,a=-e[3]*r,l=e[0]*r;return new xf([n,o,i,a,l,s])}},zCe=class{constructor(e,r){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new qo(dC,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(r||Qv.createIdentity()),this._sizeTransfos.push(r?r.scaleRatio():1)}setTransform(e,r){this._transfos=[e||Qv.createIdentity()],this._sizeTransfos=[r||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,r){const i=r?e.scaleRatio():1;Qv.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,r,i){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,r);break;case"CIMTextSymbol":this.drawTextSymbol(e,r,i)}}drawMultiLayerSymbol(e,r){if(!e||!r)return;const i=e.symbolLayers;if(!i)return;const s=e.effects;if(s&&s.length>0){const n=this.executeEffects(s,r);if(n){let o=n.next();for(;o;)this.drawSymbolLayers(i,o.asJSON()),o=n.next()}}else this.drawSymbolLayers(i,r)}executeEffects(e,r){const i=this._resourceManager.geometryEngine;let s=new Pat(Pn.fromJSONCIM(r));for(const n of e){const o=Plt(n);o&&(s=o.execute(s,n,this.geomUnitsPerPoint(),null,i))}return s}drawSymbolLayers(e,r){let i=e.length;for(;i--;){const s=e[i];if(!s||s.enable===!1)continue;const n=s.effects;if(n&&n.length>0){const o=this.executeEffects(n,r);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(s,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,r);if(this._earlyReturn)return}}drawSymbolLayer(e,r){switch(e.type){case"CIMSolidFill":this.drawSolidFill(r,e.color);break;case"CIMHatchFill":this.drawHatchFill(r,e);break;case"CIMPictureFill":this.drawPictureFill(r,e);break;case"CIMGradientFill":this.drawGradientFill(r,e);break;case"CIMSolidStroke":this.drawSolidStroke(r,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(r,e);break;case"CIMGradientStroke":this.drawGradientStroke(r,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,r)}}drawHatchFill(e,r){const i=this._buildHatchPolyline(r,e,this.geomUnitsPerPoint());i&&(this.pushClipPath(e),this.drawMultiLayerSymbol(r.lineSymbol,i),this.popClipPath())}drawPictureFill(e,r){}drawGradientFill(e,r){}drawPictureStroke(e,r){}drawGradientStroke(e,r){}drawMarkerLayer(e,r){const i=e.markerPlacement;if(i){const s=Mlt(i);if(s){const n=i.type==="CIMMarkerPlacementInsidePolygon"||i.type==="CIMMarkerPlacementPolygonCenter"&&i.clipAtBoundary;n&&this.pushClipPath(r);const o=s.execute(Pn.fromJSONCIM(r),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}n&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(VS(r))s.tx=r.x,s.ty=r.y,this.drawMarker(e,s);else if(yc(r)){const n=Vme(r);n&&([s.tx,s.ty]=n,this.drawMarker(e,s))}else for(const n of r.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,r){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,r);break;case"CIMVectorMarker":this.drawVectorMarker(e,r)}}drawPictureMarker(e,r){if(!e)return;const i=this._resourceManager.getResource(e.url),s=br(e.size,DT.CIMPictureMarker.size);if(i==null||s<=0)return;const n=i.width,o=i.height;if(!n||!o)return;const a=n/o,l=br(e.scaleX,1),c=Qv.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=s*a*l,b*=s),c.translate(-v,-b)}let h=br(e.rotation);e.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&c.rotate(h*K1);let p=br(e.offsetX),f=br(e.offsetY);if(p||f){if(this._mapRotation){const v=K1*this._mapRotation,b=Math.cos(v),w=Math.sin(v),T=p*w+f*b;p=p*b-f*w,f=T}c.translate(p,f)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const _=r.getAngle();_&&c.rotate(_),c.translate(r.tx,r.ty),this.push(c,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,r){if(!e)return;const i=e.markerGraphics;if(!i)return;const s=br(e.size,DT.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=s&&o?s/o:1,l=Qv.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let _=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?n&&(_*=n.xmax-n.xmin,v*=n.ymax-n.ymin):(_/=a,v/=a),l.translate(-_,-v)}a!==1&&l.scale(a,a);let u=br(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*K1);let h=br(e.offsetX),p=br(e.offsetY);if(h||p){if(this._mapRotation){const _=K1*this._mapRotation,v=Math.cos(_),b=Math.sin(_),w=h*b+p*v;h=h*v-p*b,p=w}l.translate(h,p)}const f=this.geomUnitsPerPoint();f!==1&&l.scale(f,f);const g=r.getAngle();g&&l.rotate(g),l.translate(r.tx,r.ty),this.push(l,e.scaleSymbolsProportionally);for(const _ of i){_!=null&&_.symbol&&_.geometry||rct().error("Invalid marker graphic",_);let v=_.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(_.symbol,_.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,r,i){if(!e||!VS(r)||br(e.height,DT.CIMTextSymbol.height)<=0)return;const s=Qv.createIdentity();let n=br(e.angle);n=-n,n&&s.rotate(n*K1);const o=br(e.offsetX),a=br(e.offsetY);(o||a)&&s.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&s.scale(l,l),s.translate(r.x,r.y),this.push(s,!1),this.drawText(e,i),this.pop()}_buildHatchPolyline(e,r,i){let s=br(e.separation,DT.CIMHatchFill.separation)*i,n=br(e.rotation);if(s===0)return null;s<0&&(s=-s);let o=0;const a=.5*s;for(;o>a;)o-=s;for(;o<-a;)o+=s;const l=jt();T4e(l,r),l[0]-=a,l[1]-=a,l[2]+=a,l[3]+=a;const c=[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]];for(;n>180;)n-=180;for(;n<0;)n+=180;const u=Math.cos(n*K1),h=Math.sin(n*K1),p=-s*h,f=s*u;let g,_,v,b;o=br(e.offsetX)*i*h-br(e.offsetY)*i*u,g=v=Number.MAX_VALUE,_=b=-Number.MAX_VALUE;for(const L of c){const F=L[0],U=L[1],j=u*F+h*U,z=-h*F+u*U;g=Math.min(g,j),v=Math.min(v,z),_=Math.max(_,j),b=Math.max(b,z)}v=Math.floor(v/s)*s;let w=u*g-h*v-p*o/s,T=h*g+u*v-f*o/s,S=u*_-h*v-p*o/s,C=h*_+u*v-f*o/s;const P=1+Math.round((b-v)/s),R=[];for(let L=0;L<P;L++)w+=p,T+=f,S+=p,C+=f,R.push([[w,T],[S,C]]);return{paths:R}}},ict=class extends zCe{constructor(e,r){super(e,r),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new Olt(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return QO(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(yc(e))this._processPath(e.rings,0);else if(Zd(e))this._processPath(e.paths,0);else if(Xd(e)){const r=xb(e);r&&this._processPath(r.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,r,i){if(!e||this._clipCount>0||i==null||i<=0)return;const s=Math.max(.5*this.transformSize(br(i,DT.CIMSolidStroke.width)),.5*UCe);if(yc(e))this._processPath(e.rings,s);else if(Zd(e))this._processPath(e.paths,s);else if(Xd(e)){const n=xb(e);n&&this._processPath(n.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,r){yc(r)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(r.rings,0):super.drawMarkerLayer(e,r)}drawHatchFill(e,r){this.drawSolidFill(e)}drawPictureFill(e,r){this.drawSolidFill(e)}drawGradientFill(e,r){this.drawSolidFill(e)}drawPictureStroke(e,r){this.drawSolidStroke(e,null,r.width)}drawGradientStroke(e,r){this.drawSolidStroke(e,null,r.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,r){const{url:i}=e,s=br(e.scaleX,1);let n=s*r,o=r;const a=this._resourceManager.getResource(i);if(a!=null){const l=a.height/a.width;n=s*(r?l>1?r:r/l:a.width),o=r?l>1?r*l:r:a.height}this._merge(this.transformPt([-n/2,-o/2]),0),this._merge(this.transformPt([-n/2,o/2]),0),this._merge(this.transformPt([n/2,-o/2]),0),this._merge(this.transformPt([n/2,o/2]),0)}drawText(e,r){if(!r||r.length===0)return;this._textRasterizer||(this._textRasterizer=new $Ce);const i=BCe(e);let[s,n]=this._textRasterizer.computeTextSize(r,i);s=Ka(s),n=Ka(n);let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-s/2+o,-n/2+a]),0),this._merge(this.transformPt([-s/2+o,n/2+a]),0),this._merge(this.transformPt([s/2+o,-n/2+a]),0),this._merge(this.transformPt([s/2+o,n/2+a]),0)}_processPath(e,r){if(e)for(const i of e){const s=i?i.length:0;if(s>1){this._merge(this.transformPt(i[0]),r);for(let n=1;n<s;n++)this._merge(this.transformPt(i[n]),r)}}}_merge(e,r){e[0]-r<this._xmin&&(this._xmin=e[0]-r),e[0]+r>this._xmax&&(this._xmax=e[0]+r),e[1]-r<this._ymin&&(this._ymin=e[1]-r),e[1]+r>this._ymax&&(this._ymax=e[1]+r)}},sct=class extends zCe{constructor(e,r,i,s){super(r,i),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new Mat,this._ctx=e}drawSolidFill(e,r){if(!e)return;if(yc(e))this._buildPath(e.rings,!0);else if(Zd(e))this._buildPath(e.paths,!0);else if(Xd(e))this._buildPath(xb(e).rings,!0);else{if(!Jb(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle=typeof r=="string"?r:"rgba("+Math.round(r[0])+","+Math.round(r[1])+","+Math.round(r[2])+","+(r[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(e,r,i,s,n,o){if(!e||!r||i===0)return;if(yc(e))this._buildPath(e.rings,!0);else if(Zd(e))this._buildPath(e.paths,!1);else{if(!Xd(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(xb(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof r=="string"?r:"rgba("+Math.round(r[0])+","+Math.round(r[1])+","+Math.round(r[2])+","+(r[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(i),UCe),this._setCapStyle(s),this._setJoinStyle(n),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),yc(e))this._buildPath(e.rings,!0);else if(Zd(e))this._buildPath(e.paths,!0);else{if(!Xd(e))return;this._buildPath(xb(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,r){const{colorSubstitutions:i,url:s,tintColor:n}=e,o=br(e.scaleX,1),a=this._resourceManager.getResource(s);if(a==null)return;let l=r*(a.width/a.height),c=r;r||(l=a.width,c=a.height);const u=Jx(s)||"src"in a&&Jx(a.src);let h="getFrame"in a?Tz(a):a;i&&(h=this._colorSubstitutionHelper.applyColorSubstituition(h,i)),this._applyAdditionalRenderProps&&!u&&n&&(h=this._colorSubstitutionHelper.tintImageData(h,n));const p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),_=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*_*f,m12:o*_*g,m21:-_*g,m22:_*f,m41:p[0],m42:p[1]}),v.drawImage(h,-l/2,-c/2,l,c),v.restore()}drawText(e,r){if(!r||r.length===0)return;this._textRasterizer||(this._textRasterizer=new $Ce);const i=BCe(e);i.size*=this.transformSize(Ka(1));const s=this._textRasterizer.rasterizeText(r,i);if(!s)return;const{size:n,anchorX:o,anchorY:a,canvas:l}=s,c=n[0]*(o+.5),u=n[1]*(a-.5),h=this._ctx,p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),_=1;h.save(),h.setTransform({m11:_*f,m12:_*g,m21:-_*g,m22:_*f,m41:p[0]-_*c,m42:p[1]+_*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,r){if(!e)return;let{colorSubstitutions:i,height:s,offsetX:n,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=r;const h=this._resourceManager.getResource(u);if(h==null)return;if(yc(e))this._buildPath(e.rings,!0);else if(Zd(e))this._buildPath(e.paths,!0);else if(Xd(e))this._buildPath(xb(e).rings,!0);else{if(!Jb(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const p=this._ctx,f=Jx(u)||"src"in h&&Jx(h.src);let g,_="getFrame"in h?Tz(h):h;if(i&&(_=this._colorSubstitutionHelper.applyColorSubstituition(_,i)),this._applyAdditionalRenderProps){f||c&&(_=this._colorSubstitutionHelper.tintImageData(_,c)),g=p.createPattern(_,"repeat");const v=this.transformSize(1);a||(a=0),n?n*=v:n=0,o?o*=v:o=0,s&&(s*=v);const b=s?s/h.height:1,w=l&&s?l*s/h.width:1;if(a!==0||b!==1||w!==1||n!==0||o!==0){const T=new DOMMatrix;T.rotateSelf(0,0,-a).translateSelf(n,o).scaleSelf(w,b,1),g.setTransform(T)}}else g=p.createPattern(_,"repeat");p.save(),p.fillStyle=g,p.fill("evenodd"),p.restore()}drawPictureStroke(e,r){if(!e)return;let{colorSubstitutions:i,capStyle:s,joinStyle:n,miterLimit:o,tintColor:a,url:l,width:c}=r;const u=this._resourceManager.getResource(l);if(u==null)return;let h;if(yc(e))h=e.rings;else if(Zd(e))h=e.paths;else{if(!Xd(e))return Jb(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;h=xb(e).rings}c||(c=u.width);const p=Jx(l)||"src"in u&&Jx(u.src);let f="getFrame"in u?Tz(u):u;i&&(f=this._colorSubstitutionHelper.applyColorSubstituition(f,i)),this._applyAdditionalRenderProps&&(p||a&&(f=this._colorSubstitutionHelper.tintImageData(f,a)));const g=Math.max(this.transformSize(on(c)),.5),_=g/f.width,v=this._ctx,b=v.createPattern(f,"repeat-y");let w,T;v.save(),this._setCapStyle(s),this._setJoinStyle(n),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let S of h)if(S=ge(S),act(S),S&&!(S.length<=1)){w=this.transformPt(S[0]);for(let C=1;C<S.length;C++){T=this.transformPt(S[C]);const P=nct(w,T),R=new DOMMatrix;R.translateSelf(0,w[1]-g/2).scaleSelf(_,_,1).rotateSelf(0,0,90-P),b.setTransform(R),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(T[0],T[1]),v.stroke(),w=T}}v.restore()}_buildPath(e,r){const i=this._ctx;if(i.beginPath(),e)for(const s of e){const n=s?s.length:0;if(n>1){let o=this.transformPt(s[0]);i.moveTo(o[0],o[1]);for(let a=1;a<n;a++)o=this.transformPt(s[a]),i.lineTo(o[0],o[1]);r&&i.closePath()}}}_setCapStyle(e){switch(e){case Sh.Butt:this._ctx.lineCap="butt";break;case Sh.Round:this._ctx.lineCap="round";break;case Sh.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case Kf.Bevel:this._ctx.lineJoin="bevel";break;case Kf.Round:this._ctx.lineJoin="round";break;case Kf.Miter:this._ctx.lineJoin="miter"}}};function nct(t,e){const r=e[0]-t[0],i=e[1]-t[1];return 180/Math.PI*Math.atan2(i,r)}const xb=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function BCe(t,e=1){var b;const r=pCe(t),i=dCe(t.fontStyleName),s=t.fontFamilyName??eCe,{weight:n,style:o}=i,a=e*(t.height||5),l=Jat(t.horizontalAlignment),c=Kat(t.verticalAlignment),u=dM(t),h=dM(t.haloSymbol),p=h!=null?e*(t.haloSize??0):0,f=((b=t.callout)==null?void 0:b.type)==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=dM(f),_=Aq(f),v=Cq(f);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:s,style:Xat(o),weight:Zat(n),decoration:r},halo:{size:p||0,color:h,style:o},backgroundColor:g,borderLine:_!=null&&v!=null?{size:_,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const oct=1e-4;function act(t){let e,r,i,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],r=t[a][1]-o[1],s=e!==0?r/e:Math.PI/2,i!==void 0&&s-i<=oct?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),i=s}const VCe=[252,146,31,255],ykt=[153,153,153,255],lct={type:"esriSMS",style:"esriSMSCircle",size:6,color:VCe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},cct={type:"esriSLS",style:"esriSLSSolid",width:.75,color:VCe},uct={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},hct={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},dct={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},pct={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},fct={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},_kt=eC.fromJSON(lct),mct=b0.fromJSON(cct),vkt=_R.fromJSON(uct),bkt=tC.fromJSON(hct);eC.fromJSON(dct);b0.fromJSON(pct);_R.fromJSON(fct);const wkt=Number.POSITIVE_INFINITY,gK=Math.PI,xkt=2*gK,gct=128/gK,yct=256/360,Tkt=gK/180,_ct=1/Math.LN2;function GCe(t,e){return(t%=e)>=0?t:t+e}function Skt(t){return GCe(t*gct,256)}function Ekt(t){return GCe(t*yct,256)}function Ckt(t){return Math.log(t)*_ct}function vl(t,e,r){return t*(1-r)+e*r}const vct=8,bct=14,wct=16;function Akt(t){return vct+Math.max((t-bct)*wct,0)}function xct(t,e,r){let i,s,n,o=0;for(const a of r){i=a.length;for(let l=1;l<i;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function jCe(t,e,r,i){let s,n,o,a;const l=i*i;for(const c of r){const u=c.length;if(!(u<2)){s=c[0].x,n=c[0].y;for(let h=1;h<u;++h){if(o=c[h].x,a=c[h].y,c4e(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function Tct(t,e,r,i,s,n,o){const a=Math.max(i,Math.min(e,n))-e,l=Math.max(s,Math.min(r,o))-r;return a*a+l*l<=t*t}function Sct(t,e){if(e===0||Number.isNaN(e))return t;const r=[],i=new oa(0,0),s=new oa(0,0),n=new oa(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],h=a[c],p=a[c+1];c===0?i.setCoords(0,0):i.assignSub(h,u).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(p,h).normalize().rightPerpendicular(),n.assignAdd(i,s).normalize();const f=n.x*s.x+n.y*s.y;f!==0&&n.scale(1/f),l.push(oa.add(h,n.scale(e)))}r.push(l)}return r}function yK(t,e,r,i){const s=new oa(t[0],t[1]);if(s.scale(i),e==="viewport"){const n=-r*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}const HCe=Math.PI,Ect=HCe/2,Zp=96/72,ple=4,_F=()=>ae.getLogger("esri.symbols.cim.CIMSymbolHelper");function MN(t,e,r){switch(e.type){case"CIMSymbolReference":return MN(t,e.symbol,r);case"CIMPointSymbol":r==null&&(r={x:0,y:0}),t.drawSymbol(e,r);break;case"CIMLineSymbol":r==null&&(r={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,r);break;case"CIMPolygonSymbol":r==null&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,r);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new dC;t.drawMarker(e,i);break}}return t.envelope()}function Cct(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(br(t.offsetX)),Math.abs(br(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function Pkt(t){if(!t)return 0;let e=0;for(const r of t)e+=Cct(r);return e}let Ez=class ON{static getEnvelope(e,r,i){if(!e)return null;const s=new ict(i);if(Array.isArray(e)){let n;for(const o of e)n?n.union(MN(s,o,r)):n=MN(s,o,r);return n}return MN(s,e,r)}static getTextureAnchor(e,r){const i=this.getEnvelope(e,null,r);if(!i)return[0,0,0];const s=(i.x+.5*i.width)*Zp,n=(i.y+.5*i.height)*Zp,o=i.width*Zp+2,a=i.height*Zp+2;return[-s/o,-n/a,a]}static rasterize(e,r,i,s,n=!0){const o=i||this.getEnvelope(r,null,s);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Zp,l=(o.y+.5*o.height)*Zp;e.width=o.width*Zp,e.height=o.height*Zp,i||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=Qv.createScale(Zp,-Zp);u.translate(.5*e.width-a,.5*e.height+l);const h=new sct(c,s,u);switch(r.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};h.drawSymbol(r,g);break}case"CIMVectorMarker":{const g=new dC;h.drawMarker(r,g);break}}const p=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(p.data);if(n){let g;for(let _=0;_<f.length;_+=4)g=f[_+3]/255,f[_]=f[_]*g,f[_+1]=f[_+1]*g,f[_+2]=f[_+2]*g}return[f,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:r}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:ON.createCIMTextSymbolfromTextSymbol(e),textString:r}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:r,outline:i,width:s,xoffset:n,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(i){const _=fle(i);_&&c.push(_)}let h=e.url;e.type==="esriPFS"&&e.imageData&&(h=e.imageData);const p="angle"in e?e.angle??0:0,f=(s??0)*(o||1),g=(r??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:LT.Picture,tintColor:null,url:h,height:g,width:f,offsetX:br(n),offsetY:br(a),rotation:br(-p),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:r,style:i,outline:s}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(s){const a=fle(s);a&&n.push(a)}if(i&&i!=="solid"&&i!=="none"&&i!=="esriSFSSolid"&&i!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:Wc(r),capStyle:Sh.Butt,joinStyle:Kf.Miter,width:.75}]};let l=0;const c=Ka($ct(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}n.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),i==="cross"||i==="esriSFSCross"?n.push({type:"CIMHatchFill",lineSymbol:ge(a),offsetX:0,offsetY:0,rotation:90,separation:c}):i!=="diagonal-cross"&&i!=="esriSFSDiagonalCross"||n.push({type:"CIMHatchFill",lineSymbol:ge(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!i||i!=="solid"&&i!=="esriSFSSolid"||n.push({type:"CIMSolidFill",enable:!0,color:Wc(r)});return o}static fromSimpleLineSymbol(e){const{cap:r,color:i,join:s,marker:n,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:Pq(a,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(n){let h;switch(n.placement){case"begin-end":h=Jf.Both;break;case"begin":h=Jf.JustBegin;break;case"end":h=Jf.JustEnd;break;default:h=Jf.None}const p=ON.fromSimpleMarker(n,l,i).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:h,offsetAlongLine:0},u.push(p)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?Wc(i):[0,0,0,0],capStyle:WCe(r),joinStyle:YCe(s),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:r,height:i,width:s,xoffset:n,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:LT.Picture,tintColor:null,url:a,size:i,width:s,offsetX:br(n),offsetY:br(o),rotation:br(-r)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:r,color:i,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,text:c,verticalAlignment:u,xoffset:h,yoffset:p,backgroundColor:f,borderLineColor:g,borderLineSize:_}=e;let v,b,w,T,S,C;s&&(v=s.family,b=s.style,w=s.weight,T=s.size,S=s.decoration);let P=!1;return c&&(P=mat(c)[1]),(f||_)&&(C={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:Wc(f)},{type:"CIMSolidStroke",color:Wc(g),width:_}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:r,blockProgression:xq.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:vq.Normal,fontEncoding:bq.Unicode,fontFamilyName:v||"Arial",fontStyleName:Mct(b,w),fontType:wq.Unspecified,haloSize:o,height:T,hinting:Sq.Default,horizontalAlignment:Act(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:br(h),offsetY:br(p),strikethrough:S==="line-through",underline:S==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Wc(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Wc(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:P?gF.RTL:gF.LTR,verticalAlignment:Pct(u??"baseline"),verticalGlyphOrientation:Eq.Right,wordSpacing:100,billboardMode3D:Tq.FaceNearPlane,callout:C}}static createPictureMarkerRasterizationParam(e){var l,c;const{angle:r,height:i,width:s,xoffset:n,yoffset:o}=e,a=e.url??((l=e.source)==null?void 0:l.url)??((c=e.source)==null?void 0:c.imageData);return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:LT.Picture,tintColor:null,url:a,size:i,width:s,offsetX:br(n),offsetY:br(o),rotation:br(-r)}}:null}static createPictureFillRasterizationParam(e){const{width:r,height:i,xoffset:s,yoffset:n,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:LT.Picture,tintColor:null,url:o,width:r,height:i,offsetX:br(s),offsetY:br(n),rotation:0}}:null}static fromSimpleMarker(e,r,i){const{style:s}=e,n=e.color??i;if(s==="path"||s==="esriSMSPath"){const h=[];if("outline"in e&&e.outline){const g=e.outline;h.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:Wc(g.color),path:e.path})}h.push({type:"CIMSolidFill",enable:!0,color:Wc(n),path:e.path});const[p,f]=l3("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-br(e.angle),size:br(e.size||6),offsetX:br(e.xoffset),offsetY:br(e.yoffset),scaleSymbolsProportionally:!1,frame:p,markerGraphics:[{type:"CIMMarkerGraphic",geometry:f,symbol:{type:"CIMPolygonSymbol",symbolLayers:h}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const h=e.outline,p=h.style!=="solid"&&h.style!=="esriSLSSolid";[a,l]=p?l3(s,e.size):l3(s);const f=h.width??mct.width;if(p){const v=f/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=f)}const g=e.style!=="cross"&&e.style!=="x"||(e==null?void 0:e.outline.style)==="dot"||(e==null?void 0:e.outline.style)==="short-dot"?ia.HalfGap:ia.FullPattern,_=p?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:Pq(h.style,null).map(v=>h.width&&h.width>0?v*h.width:v),lineDashEnding:g,controlPointEnding:ia.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:p?Sh.Round:Sh.Butt,enable:!0,width:f,color:Wc(h.color),effects:_})}else!r||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=l3(s):([a,l]=l3(s),o.push({type:"CIMSolidStroke",enable:!0,width:r,color:Wc(n)}));o.push({type:"CIMSolidFill",enable:!0,color:Wc(n)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:br(-e.angle),size:br(c||6*r),offsetX:br(e.xoffset),offsetY:br(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,r){var l;const i=r*(e.separation??DT.CIMHatchFill.separation),s=i/2,n=ge(e.lineSymbol);(l=n.symbolLayers)==null||l.forEach(c=>{var u;switch(c.type){case"CIMSolidStroke":c.width!=null&&(c.width*=r),(u=c.effects)==null||u.forEach(h=>{if(h.type==="CIMGeometricEffectDashes"){const p=h.dashTemplate;h.dashTemplate=p.map(f=>f*r)}});break;case"CIMVectorMarker":{c.size!=null&&(c.size*=r);const h=c.markerPlacement;h!=null&&"placementTemplate"in h&&(h.placementTemplate=h.placementTemplate.map(p=>p*r));break}}});let o=this._getLineSymbolPeriod(n)||ple;for(;o<ple;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-s,ymax:s},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:i}}static fetchResources(e,r,i,s=null){return e&&r&&qCe(e,n=>{Ict(n,r,i),"url"in n&&n.url&&i.push(r.fetchResource(n.url,{signal:s}))}),i}static fetchFonts(e,r,i){if(e&&r){if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if(s.type==="CIMVectorMarker"&&s.markerGraphics)for(const n of s.markerGraphics)n!=null&&n.symbol&&ON.fetchFonts(n.symbol,r,i)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:s,fontStyleName:n}=e;if(!s||s.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=dCe(n),l=pCe(e),c=new mR({family:s,style:o,weight:a,decoration:l});i.push(r.loadFont(c).catch(()=>{_F().error(`Unsupported font ${s} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const r=this._getEffectsRepeat(e.effects);if(r)return r;if(e.symbolLayers){for(const i of e.symbolLayers)if(i){const s=this._getEffectsRepeat(i.effects);if(s)return s;switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const n=this._getPlacementRepeat(i.markerPlacement);if(n)return n}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const r of e)if(r)switch(r.type){case"CIMGeometricEffectDashes":{const i=r.dashTemplate;if(i&&i.length){let s=0;for(const n of i)s+=n;return 1&i.length&&(s*=2),s}break}case"CIMGeometricEffectWave":return r.period;default:_F().error(`unsupported geometric effect type ${r.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const r=e.placementTemplate;if(r&&r.length){let i=0;for(const s of r)i+=+s;return 1&r.length&&(i*=2),i}break}}return 0}static fromCIMInsidePolygon(e){const r=e.markerPlacement,i={...e};i.markerPlacement=null,i.anchorPoint=null;const s=Math.abs(r.stepX),n=Math.abs(r.stepY),o=(r.randomness??100)/100;let a,l,c,u;if(r.gridType==="Random"){const h=Ka(Dlt),p=Math.max(Math.floor(h/s),1),f=Math.max(Math.floor(h/n),1);a=p*s/2,l=f*n/2,c=2*l;const g=new Wb(r.seed),_=o*s/1.5,v=o*n/1.5;u=[];for(let b=0;b<p;b++)for(let w=0;w<f;w++){const T=b*s-a+_*(.5-g.getFloat()),S=w*n-l+v*(.5-g.getFloat());u.push({x:T,y:S}),b===0&&u.push({x:T+2*a,y:S}),w===0&&u.push({x:T,y:S+2*l})}}else r.shiftOddRows===!0?(a=s/2,l=n,c=2*n,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=s/2,l=n/2,c=n,u=[{x:-s,y:0},{x:0,y:-n},{x:-s,y:-n},{x:0,y:0},{x:s,y:0},{x:0,y:n},{x:s,y:n},{x:-s,y:n},{x:s,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(h=>({type:"CIMMarkerGraphic",geometry:h,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}})),size:c}}};function qCe(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return;for(const i of r)if(e(i),i.type==="CIMVectorMarker"){const s=i.markerGraphics;if(!s)continue;for(const n of s)if(n){const o=n.symbol;o&&qCe(o,e)}}break}}}const WCe=t=>{if(!t)return Sh.Butt;switch(t){case"butt":return Sh.Butt;case"square":return Sh.Square;case"round":return Sh.Round}},YCe=t=>{if(!t)return Kf.Miter;switch(t){case"miter":return Kf.Miter;case"round":return Kf.Round;case"bevel":return Kf.Bevel}},Act=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},Pct=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},Wc=t=>{if(!t)return[0,0,0,0];const{r:e,g:r,b:i,a:s}=t;return[e,r,i,255*s]},Mct=(t,e)=>{const r=Oct(e),i=Rct(t);return r&&i?`${r}-${i}`:`${r}${i}`},Oct=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},Rct=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},Pq=(t,e)=>{const r=se("safari")?.001:0,i=e==="butt";switch(t){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return i?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return _F().error("Unexpected: style does not require rasterization"),[0,0];default:return _F().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},l3=(t,e=100)=>{const r=e/2;let i,s;const n=t;if(n==="circle"||n==="esriSMSCircle"){let a=Math.acos(1-.25/r),l=Math.ceil(HCe/a/4);l===0&&(l=1),a=Ect/l,l*=4;const c=[];c.push([r,0]);for(let u=1;u<l;u++)c.push([r*Math.cos(u*a),-r*Math.sin(u*a)]);c.push([r,0]),i={rings:[c]},s={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if(n==="cross"||n==="esriSMSCross")i={paths:[[[0,r],[0,-r]],[[r,0],[-r,0]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(n==="diamond"||n==="esriSMSDiamond")i={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(n==="square"||n==="esriSMSSquare")i={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(n==="x"||n==="esriSMSX")i={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(n==="triangle"||n==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;i={rings:[[[a,c],[0,l],[o,c],[a,c]]]},s={xmin:a,ymin:c,xmax:o,ymax:l}}else n==="arrow"&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-r,ymin:-r,xmax:r,ymax:r});return[s,i]},$ct=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function Ict(t,e,r){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void r.push(e.geometryEnginePromise);Wat(t.effects)&&(e.geometryEnginePromise=Yat(),r.push(e.geometryEnginePromise),e.geometryEnginePromise.then(i=>e.geometryEngine=i))}}function fle(t){if(!t)return null;let e=null;const{cap:r,color:i,join:s,miterLimit:n,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:Pq(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?Wc(i):[0,0,0,0],capStyle:WCe(r),joinStyle:YCe(s),miterLimit:n,width:a,effects:e}}function XCe(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?Lct(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return ae.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Cz=new Map;function Lct(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;Cz.has(e)||Cz.set(e,Dct(e));const o=Cz.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function Dct(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>FSe(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>kSe(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>USe(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>NSe(i,e,r,s,n);default:return ae.getLogger("esri.views.2d.support.arcadeOnDemand").error(new J("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const Nct=t=>{if(!t)return[0,0,0,0];const{r:e,g:r,b:i,a:s}=t;return[e,r,i,255*s]};let nP=class Ws{static findApplicableOverrides(e,r,i){if(e&&r){if(e.primitiveName){let s=!1;for(const n of i)if(n.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const n of r)n.primitiveName===e.primitiveName&&i.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)Ws.findApplicableOverrides(s,r,i);if(e.symbolLayers)for(const s of e.symbolLayers)Ws.findApplicableOverrides(s,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)Ws.findApplicableOverrides(s,r,i);if(e.markerPlacement&&Ws.findApplicableOverrides(e.markerPlacement,r,i),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const s of e.markerGraphics)Ws.findApplicableOverrides(s,r,i),Ws.findApplicableOverrides(s.symbol,r,i)}else e.type==="CIMCharacterMarker"?Ws.findApplicableOverrides(e.symbol,r,i):e.type==="CIMHatchFill"?Ws.findApplicableOverrides(e.lineSymbol,r,i):e.type==="CIMPictureMarker"&&Ws.findApplicableOverrides(e.animatedSymbolProperties,r,i)}}}static findEffectOverrides(e,r){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&fCe(e),!r||!e.primitiveName)return{type:"cim-effect-info",effect:e,overrides:[]};const i=e.primitiveName,s=[];for(const n of r)n.primitiveName===i&&s.push({...n,propertyName:sle(n.propertyName)});return{type:"cim-effect-info",effect:e,overrides:s}}static async resolveSymbolOverrides(e,r,i,s,n,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!s)return l;l=ge(l),c=ge(c);let h=!0;if(r||(r={attributes:{}},h=!1),u){if(h||(c=c.filter(p=>{var f;return!((f=p.valueExpressionInfo)!=null&&f.expression.includes("$feature"))})),a||(c=c.filter(p=>{var f;return!((f=p.valueExpressionInfo)!=null&&f.expression.includes("$view"))})),c.length>0){const p={spatialReference:i,fields:Qat(r.attributes),geometryType:n};await Ws.createRenderExpressions(c,p),Ws.evaluateOverrides(c,r,n??"esriGeometryPoint",o,a)}Ws.applyOverrides(l,c)}return s&&Ws.applyDictionaryTextOverrides(l,r,s,null),l}static async createRenderExpressions(e,r){const i=[];for(const s of e){const n=s.valueExpressionInfo;if(!n||Ws._expressionToRenderExpression.has(n.expression))continue;const o=eve(n.expression,r.spatialReference,r.fields);i.push(o),o.then(a=>Ws._expressionToRenderExpression.set(n.expression,a))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,r,i,s,n){const o={$view:{scale:n==null?void 0:n.scale}};for(const a of e){a.value&&typeof a.value=="object"&&Ebe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=Nct(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=Ws._expressionToRenderExpression.get(l.expression);c&&(a.value=XCe(c,r,o,i,s))}}static applyDictionaryTextOverrides(e,r,i,s,n="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&Ws.applyDictionaryTextOverrides(a,r,i,s,e.type==="CIMTextSymbol"?e.textCase:n)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&Ws.applyDictionaryTextOverrides(a,r,i,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=zat(o,i);e.textString=Bat(r,a,s,n)}}}}static applyOverrides(e,r,i,s){if(e.primitiveName){for(const n of r)if(n.primitiveName===e.primitiveName){const o=sle(n.propertyName);if(s&&s.push({cim:e,nocapPropertyName:o,value:e[o]}),i){let a=!1;for(const l of i)l.primitiveName===e.primitiveName&&(a=!0);a||i.push(n)}n.value!=null&&(e[o]=n.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)Ws.applyOverrides(n,r,i,s);if(e.symbolLayers)for(const n of e.symbolLayers)Ws.applyOverrides(n,r,i,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)Ws.applyOverrides(n,r,i,s);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const n of e.markerGraphics)Ws.applyOverrides(n,r,i,s),Ws.applyOverrides(n.symbol,r,i,s)}}static restoreOverrides(e){for(const r of e)r.cim[r.nocapPropertyName]=r.value}static buildOverrideKey(e){let r="";for(const i of e)i.value!==void 0&&(r+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return r}static toValue(e,r){if(e==="DashTemplate")return r.split(" ").map(i=>Number(i));if(e==="Color"){const i=new Fe(r).toRgba();return i[3]*=255,i}return r}};nP._expressionToRenderExpression=new Map;function _K(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(t.effects)for(const s of t.effects)Uct(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Fct(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":_K(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function Fct(t,e,r){if(t&&(t.markerPlacement&&kct(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||_K(i.symbol,e,!0,r)}function kct(t,e){switch(hCe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function Uct(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function zct(t){const e=[];return Mq(jat(t),e),e.length?new Fe(Gat(e[0])):null}function Mq(t,e){var s;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const n of r.symbolLayers)if(!(n.colorLocked||i&&(qat(n)||Hat(n)&&n.markerPlacement&&hCe(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&mle(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{Mq(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":mle(e,n.color);break;case"CIMHatchFill":Mq(n.lineSymbol,e)}}}function mle(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}var gle,yle,ZCe={exports:{}};yle=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:km},u=km,h="none",p=")",f=",",g="(",_="%",v="px",b="cm",w="mm",T="in",S="pt",C="pc",P="deg",R="rad",L="grad",F="turn",U="#",j=".",z="e",Z=/^[ \t\n\r]/,W=/^[a-z\-]/,Y=/^[0-9a-fA-F]/,le=/^[+\-]/,I=/^[0-9]/,N=el("none"),B=Hn("none",!1),H=Hn(")",!1),q=Hn(",",!1),Q=el("whitespace"),ie=E1([" ","	",`
`,"\r"],!1,!1),_e=el("function"),Oe=Hn("(",!1),gt=el("identifier"),It=E1([["a","z"],"-"],!1,!1),xt=el("percentage"),ct=Hn("%",!1),Qe=el("length"),Ve=Hn("px",!1),yr=Hn("cm",!1),Er=Hn("mm",!1),Ii=Hn("in",!1),Ue=Hn("pt",!1),dr=Hn("pc",!1),Re=el("angle"),Be=Hn("deg",!1),bt=Hn("rad",!1),Ft=Hn("grad",!1),He=Hn("turn",!1),Et=el("number"),Le=el("color"),et=Hn("#",!1),Ct=E1([["0","9"],["a","f"],["A","F"]],!1,!1),di=E1(["+","-"],!1,!1),jr=E1([["0","9"]],!1,!1),Ai=Hn(".",!1),Nr=Hn("e",!1),Xr=function(){return[]},pr=function(X,ve){return{type:"function",name:X,parameters:ve||[]}},Fr=function(X,ve){return ve.length>0?_C(X,ve,3):[X]},_r=function(X){return{type:"quantity",value:X.value,unit:X.unit}},ei=function(X){return{type:"color",colorType:X.type,value:X.value}},Tt=function(X){return X},nr=function(){return Bl()},vr=function(X){return{value:X,unit:"%"}},pi=function(X){return{value:X,unit:"px"}},js=function(X){return{value:X,unit:"cm"}},ur=function(X){return{value:X,unit:"mm"}},Li=function(X){return{value:X,unit:"in"}},ws=function(X){return{value:X,unit:"pt"}},uo=function(X){return{value:X,unit:"pc"}},Sa=function(X){return{value:X,unit:"deg"}},Ea=function(X){return{value:X,unit:"rad"}},ho=function(X){return{value:X,unit:"grad"}},Ks=function(X){return{value:X,unit:"turn"}},xs=function(X){return{value:X,unit:null}},fr=function(){return{type:"hex",value:Bl()}},Bi=function(X){return{type:"function",value:X}},dn=function(){return{type:"named",value:Bl()}},Gn=function(){return parseFloat(Bl())},oe=0,Hr=0,Kh=[{line:1,column:1}],jn=0,Qh=[],lt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function Bl(){return s.substring(Hr,oe)}function Hn(X,ve){return{type:"literal",text:X,ignoreCase:ve}}function E1(X,ve,Ce){return{type:"class",parts:X,inverted:ve,ignoreCase:Ce}}function C1(){return{type:"end"}}function el(X){return{type:"other",description:X}}function Fm(X){var ve,Ce=Kh[X];if(Ce)return Ce;for(ve=X-1;!Kh[ve];)ve--;for(Ce={line:(Ce=Kh[ve]).line,column:Ce.column};ve<X;)s.charCodeAt(ve)===10?(Ce.line++,Ce.column=1):Ce.column++,ve++;return Kh[X]=Ce,Ce}function A1(X,ve,Ce){var mr=Fm(X),Qs=Fm(ve),os={source:l,start:{offset:X,line:mr.line,column:mr.column},end:{offset:ve,line:Qs.line,column:Qs.column}};return os}function Jt(X){oe<jn||(oe>jn&&(jn=oe,Qh=[]),Qh.push(X))}function O0(X,ve,Ce){return new e(e.buildMessage(X,ve),X,ve,Ce)}function km(){var X;return(X=R0())===a&&(X=Ca()),X}function R0(){var X,ve;return lt++,X=oe,fs(),s.substr(oe,4)===h?(ve=h,oe+=4):(ve=a,lt===0&&Jt(B)),ve!==a?(fs(),Hr=X,X=Xr()):(oe=X,X=a),lt--,X===a&&lt===0&&Jt(N),X}function Ca(){var X,ve;if(X=[],(ve=Vl())!==a)for(;ve!==a;)X.push(ve),ve=Vl();else X=a;return X}function Vl(){var X,ve,Ce,mr;return X=oe,fs(),(ve=$0())!==a?(fs(),(Ce=Fp())===a&&(Ce=null),fs(),s.charCodeAt(oe)===41?(mr=p,oe++):(mr=a,lt===0&&Jt(H)),mr!==a?(fs(),Hr=X,X=pr(ve,Ce)):(oe=X,X=a)):(oe=X,X=a),X}function Fp(){var X,ve,Ce,mr,Qs,os,Aa,R1;if(X=oe,(ve=qn())!==a){for(Ce=[],mr=oe,Qs=fs(),s.charCodeAt(oe)===44?(os=f,oe++):(os=a,lt===0&&Jt(q)),os===a&&(os=null),Aa=fs(),(R1=qn())!==a?mr=Qs=[Qs,os,Aa,R1]:(oe=mr,mr=a);mr!==a;)Ce.push(mr),mr=oe,Qs=fs(),s.charCodeAt(oe)===44?(os=f,oe++):(os=a,lt===0&&Jt(q)),os===a&&(os=null),Aa=fs(),(R1=qn())!==a?mr=Qs=[Qs,os,Aa,R1]:(oe=mr,mr=a);Hr=X,X=Fr(ve,Ce)}else oe=X,X=a;return X}function qn(){var X,ve;return X=oe,(ve=M1())===a&&(ve=mx())===a&&(ve=O1())===a&&(ve=I0()),ve!==a&&(Hr=X,ve=_r(ve)),(X=ve)===a&&(X=oe,(ve=KR())!==a&&(Hr=X,ve=ei(ve)),X=ve),X}function fs(){var X,ve;for(lt++,X=[],Z.test(s.charAt(oe))?(ve=s.charAt(oe),oe++):(ve=a,lt===0&&Jt(ie));ve!==a;)X.push(ve),Z.test(s.charAt(oe))?(ve=s.charAt(oe),oe++):(ve=a,lt===0&&Jt(ie));return lt--,ve=a,lt===0&&Jt(Q),X}function $0(){var X,ve,Ce;return lt++,X=oe,(ve=P1())!==a?(s.charCodeAt(oe)===40?(Ce=g,oe++):(Ce=a,lt===0&&Jt(Oe)),Ce!==a?(Hr=X,X=Tt(ve)):(oe=X,X=a)):(oe=X,X=a),lt--,X===a&&(ve=a,lt===0&&Jt(_e)),X}function P1(){var X,ve,Ce;if(lt++,X=oe,ve=[],W.test(s.charAt(oe))?(Ce=s.charAt(oe),oe++):(Ce=a,lt===0&&Jt(It)),Ce!==a)for(;Ce!==a;)ve.push(Ce),W.test(s.charAt(oe))?(Ce=s.charAt(oe),oe++):(Ce=a,lt===0&&Jt(It));else ve=a;return ve!==a&&(Hr=X,ve=nr()),lt--,(X=ve)===a&&(ve=a,lt===0&&Jt(gt)),X}function M1(){var X,ve,Ce;return lt++,X=oe,fs(),(ve=tl())!==a?(s.charCodeAt(oe)===37?(Ce=_,oe++):(Ce=a,lt===0&&Jt(ct)),Ce!==a?(Hr=X,X=vr(ve)):(oe=X,X=a)):(oe=X,X=a),lt--,X===a&&lt===0&&Jt(xt),X}function mx(){var X,ve,Ce;return lt++,X=oe,fs(),(ve=tl())!==a?(s.substr(oe,2)===v?(Ce=v,oe+=2):(Ce=a,lt===0&&Jt(Ve)),Ce!==a?(Hr=X,X=pi(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,fs(),(ve=tl())!==a?(s.substr(oe,2)===b?(Ce=b,oe+=2):(Ce=a,lt===0&&Jt(yr)),Ce!==a?(Hr=X,X=js(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,fs(),(ve=tl())!==a?(s.substr(oe,2)===w?(Ce=w,oe+=2):(Ce=a,lt===0&&Jt(Er)),Ce!==a?(Hr=X,X=ur(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,fs(),(ve=tl())!==a?(s.substr(oe,2)===T?(Ce=T,oe+=2):(Ce=a,lt===0&&Jt(Ii)),Ce!==a?(Hr=X,X=Li(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,fs(),(ve=tl())!==a?(s.substr(oe,2)===S?(Ce=S,oe+=2):(Ce=a,lt===0&&Jt(Ue)),Ce!==a?(Hr=X,X=ws(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,fs(),(ve=tl())!==a?(s.substr(oe,2)===C?(Ce=C,oe+=2):(Ce=a,lt===0&&Jt(dr)),Ce!==a?(Hr=X,X=uo(ve)):(oe=X,X=a)):(oe=X,X=a)))))),lt--,X===a&&lt===0&&Jt(Qe),X}function O1(){var X,ve,Ce;return lt++,X=oe,(ve=tl())!==a?(s.substr(oe,3)===P?(Ce=P,oe+=3):(Ce=a,lt===0&&Jt(Be)),Ce!==a?(Hr=X,X=Sa(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,(ve=tl())!==a?(s.substr(oe,3)===R?(Ce=R,oe+=3):(Ce=a,lt===0&&Jt(bt)),Ce!==a?(Hr=X,X=Ea(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,(ve=tl())!==a?(s.substr(oe,4)===L?(Ce=L,oe+=4):(Ce=a,lt===0&&Jt(Ft)),Ce!==a?(Hr=X,X=ho(ve)):(oe=X,X=a)):(oe=X,X=a),X===a&&(X=oe,(ve=tl())!==a?(s.substr(oe,4)===F?(Ce=F,oe+=4):(Ce=a,lt===0&&Jt(He)),Ce!==a?(Hr=X,X=Ks(ve)):(oe=X,X=a)):(oe=X,X=a)))),lt--,X===a&&(ve=a,lt===0&&Jt(Re)),X}function I0(){var X,ve;return lt++,X=oe,fs(),(ve=tl())!==a?(Hr=X,X=xs(ve)):(oe=X,X=a),lt--,X===a&&lt===0&&Jt(Et),X}function KR(){var X,ve,Ce,mr;if(lt++,X=oe,s.charCodeAt(oe)===35?(ve=U,oe++):(ve=a,lt===0&&Jt(et)),ve!==a){if(Ce=[],Y.test(s.charAt(oe))?(mr=s.charAt(oe),oe++):(mr=a,lt===0&&Jt(Ct)),mr!==a)for(;mr!==a;)Ce.push(mr),Y.test(s.charAt(oe))?(mr=s.charAt(oe),oe++):(mr=a,lt===0&&Jt(Ct));else Ce=a;Ce!==a?(Hr=X,X=fr()):(oe=X,X=a)}else oe=X,X=a;return X===a&&(X=oe,(ve=Vl())!==a&&(Hr=X,ve=Bi(ve)),(X=ve)===a&&(X=oe,(ve=P1())!==a&&(Hr=X,ve=dn()),X=ve)),lt--,X===a&&(ve=a,lt===0&&Jt(Le)),X}function tl(){var X,ve,Ce,mr,Qs,os,Aa;for(X=oe,le.test(s.charAt(oe))?(s.charAt(oe),oe++):lt===0&&Jt(di),ve=oe,Ce=[],I.test(s.charAt(oe))?(mr=s.charAt(oe),oe++):(mr=a,lt===0&&Jt(jr));mr!==a;)Ce.push(mr),I.test(s.charAt(oe))?(mr=s.charAt(oe),oe++):(mr=a,lt===0&&Jt(jr));if(s.charCodeAt(oe)===46?(mr=j,oe++):(mr=a,lt===0&&Jt(Ai)),mr!==a){if(Qs=[],I.test(s.charAt(oe))?(os=s.charAt(oe),oe++):(os=a,lt===0&&Jt(jr)),os!==a)for(;os!==a;)Qs.push(os),I.test(s.charAt(oe))?(os=s.charAt(oe),oe++):(os=a,lt===0&&Jt(jr));else Qs=a;Qs!==a?ve=Ce=[Ce,mr,Qs]:(oe=ve,ve=a)}else oe=ve,ve=a;if(ve===a)if(ve=[],I.test(s.charAt(oe))?(Ce=s.charAt(oe),oe++):(Ce=a,lt===0&&Jt(jr)),Ce!==a)for(;Ce!==a;)ve.push(Ce),I.test(s.charAt(oe))?(Ce=s.charAt(oe),oe++):(Ce=a,lt===0&&Jt(jr));else ve=a;if(ve!==a){if(Ce=oe,s.charCodeAt(oe)===101?(mr=z,oe++):(mr=a,lt===0&&Jt(Nr)),mr!==a){if(le.test(s.charAt(oe))?(Qs=s.charAt(oe),oe++):(Qs=a,lt===0&&Jt(di)),Qs===a&&(Qs=null),os=[],I.test(s.charAt(oe))?(Aa=s.charAt(oe),oe++):(Aa=a,lt===0&&Jt(jr)),Aa!==a)for(;Aa!==a;)os.push(Aa),I.test(s.charAt(oe))?(Aa=s.charAt(oe),oe++):(Aa=a,lt===0&&Jt(jr));else os=a;os!==a?Ce=mr=[mr,Qs,os]:(oe=Ce,Ce=a)}else oe=Ce,Ce=a;Ce===a&&(Ce=null),Hr=X,X=Gn()}else oe=X,X=a;return X}function yC(X,ve){return X.map(function(Ce){return Ce[ve]})}function _C(X,ve,Ce){return[X].concat(yC(ve,Ce))}if((o=u())!==a&&oe===s.length)return o;throw o!==a&&oe<s.length&&Jt(C1()),O0(Qh,jn<s.length?s.charAt(jn):null,jn<s.length?A1(jn,jn+1):A1(jn,jn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var h=this.location.end,p=r("",c.line.toString().length," "),f=a[l.line-1],g=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+f+`
`+p+" | "+r("",l.column-1," ")+r("",g,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(f){return'"'+l(f.text)+'"'},class:function(f){var g=f.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(f.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function l(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(f){return o[f.type](f)}function h(f){var g,_,v=f.map(u);if(v.sort(),v.length>0){for(g=1,_=1;g<v.length;g++)v[g-1]!==v[g]&&(v[_]=v[g],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+l(f)+'"':"end of input"}return"Expected "+h(s)+" but "+p(n)+" found."},{SyntaxError:e,parse:i}},(gle=ZCe).exports&&(gle.exports=yle());var Bct=ZCe.exports;function JCe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=_le(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new J("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:_le(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!EGe(e[r].effects,e[r+1].effects))throw new J("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});CGe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function _le(t){let e;if(!t)return[];try{e=Bct.parse(t)}catch(r){throw new J("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>Vct(r))}function Vct(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Gct(t);case"opacity":return jct(t);case"hue-rotate":return Hct(t);case"blur":return qct(t);case"drop-shadow":return Wct(t);case"bloom":return Yct(t)}}catch(e){throw e.details.filter=t,e}throw new J("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Gct(t){let e=1;return pC(t.parameters,1),t.parameters.length===1&&(e=Vd(t.parameters[0])),new qG(t.name,e)}function jct(t){let e=1;return pC(t.parameters,1),t.parameters.length===1&&(e=Vd(t.parameters[0])),new j1e(e)}function Hct(t){let e=0;return pC(t.parameters,1),t.parameters.length===1&&(e=eut(t.parameters[0])),new V1e(e)}function qct(t){let e=0;return pC(t.parameters,1),t.parameters.length===1&&(e=wK(t.parameters[0]),BR(e,t.parameters[0])),new F1e(e)}function Wct(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new J("effect:type-error","Accepts only one color",{});r=tut(i)}else{const s=wK(i);if(Object.isFrozen(e))throw new J("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&BR(s,i)}if(e.length<2||e.length>3)throw new J("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new z1e(e[0],e[1],e[2]||0,r||KCe("black"))}function Yct(t){let e=1,r=0,i=0;return pC(t.parameters,3),t.parameters[0]&&(e=Vd(t.parameters[0])),t.parameters[1]&&(r=wK(t.parameters[1]),BR(r,t.parameters[1])),t.parameters[2]&&(i=Vd(t.parameters[2])),new D1e(e,r,i)}function pC(t,e){if(t.length>e)throw new J("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function v8(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in bK)return"<length>";if(t.unit in vK)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function BR(t,e){if(t<0)throw new J("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Xct(t){if(t.type!=="quantity"||t.unit!==null)throw new J("effect:type-error",`Expected <double>, Actual: ${v8(t)}`,{term:t})}function Zct(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new J("effect:type-error",`Expected <double> or <percentage>, Actual: ${v8(t)}`,{term:t})}const vK={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Jct(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&vK[t.unit]!=null))throw new J("effect:type-error",`Expected <angle>, Actual: ${v8(t)}`,{term:t})}const bK={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Kct(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&bK[t.unit]!=null))throw new J("effect:type-error",`Expected <length>, Actual: ${v8(t)}`,{term:t})}function Vd(t){Zct(t);const e=t.value;return BR(e,t),t.unit==="%"?.01*e:e}function Qct(t){return Xct(t),BR(t.value,t),t.value}function eut(t){return Jct(t),t.value*vK[t.unit]||0}function wK(t){return Kct(t),t.value*bK[t.unit]||0}function tut(t){switch(t.colorType){case"hex":return cGe(t.value);case"named":return KCe(t.value);case"function":return sut(t.value)}}function KCe(t){if(!$1e(t))throw new J("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return lGe(t)}const rut=/^rgba?/i,iut=/^hsla?/i;function sut(t){if(pC(t.parameters,4),rut.test(t.name))return[Vd(t.parameters[0]),Vd(t.parameters[1]),Vd(t.parameters[2]),t.parameters[3]?Vd(t.parameters[3]):1];if(iut.test(t.name))return I1e(Qct(t.parameters[0]),Vd(t.parameters[1]),Vd(t.parameters[2]),t.parameters[3]?Vd(t.parameters[3]):1);throw new J("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function nut(t,e,r){var i;try{return lut(t)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function out(t,e,r,i){try{const s=aut(t);Jw(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function aut(t){const e=JCe(t);return e?AGe(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function lut(t){if(!t||t.length===0)return null;if(cut(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:vle(r.value)});return e}return vle(t)}function cut(t){const e=t[0];return!!e&&"scale"in e}function vle(t){if(!(t!=null&&t.length))return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Xm(r,"amount")];break;case"blur":i=[Xm(r,"radius","pt")];break;case"hue-rotate":i=[Xm(r,"angle","deg")];break;case"drop-shadow":i=[Xm(r,"xoffset","pt"),Xm(r,"yoffset","pt"),Xm(r,"blurRadius","pt"),uut(r,"color")];break;case"bloom":i=[Xm(r,"strength"),Xm(r,"radius","pt"),Xm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;JCe(s),e.push(s)}return e.join(" ")}function Xm(t,e,r){if(t[e]==null)throw new J("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function uut(t,e){if(t[e]==null)throw new J("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}let QCe=class{constructor(e,r){this._storage=new BEe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new QCe(1e3);new Fe([128,128,128]);const hut=new Fe("white");function dut(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function Okt(t,e){if(!t)return null;let r=null;return Fw(t)?r=put(t):Ek(t)&&(r=t.type==="cim"?zct(t):t.color?new Fe(t.color):null),r?OO(r,e):null}function put(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var s;i.type==="object"&&((s=i.resource)!=null&&s.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new Fe(r):null}function OO(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new Fe(r)}function fut(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>OO(e=e??n??(r!=null?hut:null),r);i.forEach(n=>{var o,a;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const l=n.material!=null?n.material.color:null,c=s(l);n.material==null?n.material=new vu({color:c}):n.material.color=c,r!=null&&"outline"in n&&((a=n.outline)==null?void 0:a.color)!=null&&(n.outline.color=OO(n.outline.color,r))}})}function mut(t,e,r){var i;(e=e??t.color)&&(t.color=OO(e,r)),r!=null&&"outline"in t&&((i=t.outline)!=null&&i.color)&&(t.outline.color=OO(t.outline.color,r))}function Rkt(t,e,r){t&&(e||r!=null)&&(e&&(e=new Fe(e)),Fw(t)?fut(t,e,r):Ek(t)&&mut(t,e,r))}async function gut(t,e){const r=t.symbolLayers;r&&await $6(r,async i=>yut(i,e))}async function yut(t,e){switch(t.type){case"extrude":vut(t,e);break;case"icon":case"line":case"text":_ut(t,e);break;case"path":wut(t,e);break;case"object":await but(t,e)}}function _ut(t,e){const r=e3e(e);r!=null&&(t.size=r)}function e3e(t){for(const e of t)if(typeof e=="number")return e;return null}function vut(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function but(t,e){const{resourceSize:r,symbolSize:i}=await xut(t),s=t3e(e,r,i);t.width=pM(e[0],i[0],r[0],s),t.depth=pM(e[1],i[1],r[1],s),t.height=pM(e[2],i[2],r[2],s)}function wut(t,e){const r=t3e(e,kg,[t.width,void 0,t.height]);t.width=pM(e[0],t.width,1,r),t.height=pM(e[2],t.height,1,r)}function t3e(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function xut(t){const{computeObjectLayerResourceSize:e}=await me(()=>import("./symbolLayerUtils-w-XGi_Cg.js"),[]),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function pM(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function Tut(t,e){const r=e3e(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function $kt(t,e){if(t&&e)return Fw(t)?gut(t,e):void(Ek(t)&&Tut(t,e))}function Ikt(t,e,r){if(t&&e!=null)if(Fw(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=(s.tilt??0)+e;break;case"roll":s.roll=(s.roll??0)+e;break;default:s.heading=(s.heading??0)+e}})}else Ek(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function Lkt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function Dkt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Nkt=1.2,Sut=_u,Eut=4;let b8=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Ji.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Tn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Ji.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=E()){return te(e,0,0,0)}getBoundingBoxObjectSpace(e=Mn()){return Ri(e)}addObjectState(e,r){e===c0.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Tn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Tn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(Kx)&&(e.draped.origin[0]+=Kx[0],e.draped.origin[1]+=Kx[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){Ri(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,ble,i),sje(n,ble)}if(r){let o;ip(n,Kx);const a=MJ(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(Kx[0],Kx[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)bk(Jp,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Jp[0]=n[0]-o,Jp[1]=n[1]-o,Jp[2]=n[2]-o,Jp[3]=n[0]+o,Jp[4]=n[1]+o,Jp[5]=n[2]+o}return r(Jp,0,2),this.calculateRelativeScreenBounds&&s.push({location:ip(Jp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),iZ(Jp,i)}};const ble=jt(),Jp=Mn(),Kx=E();function vF(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}function r3e(t){const{size:e}=t.definition,r=t.fontString(e);let i=wle.get(r);if(!i){const s=vF(Aut,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(Put);i=new Cut(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),wle.set(r,i)}return i}const wle=new Map;let Cut=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,r){this.maxAscent=e,this.maxDescent=r}};const Aut={canvas:null},Put=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),bF=1;let i3e=class{constructor(e,r,i,s){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" ","Â ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let r=0;r<this._lines.length-1;r++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=vF(xle,rL,rL).getContext("2d"),r=this._parameters.definition.pixelRatio,i=this._fontSize*r;this._parameters.setFontProperties(e,i);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const T=e.measureText(b),S=T.width/r,C=S+s;this._textWidths.push(S),this._lineWidths.push(C),o=Math.max(o,C),c=Math.max(c,T.actualBoundingBoxAscent/r),u=Math.max(u,T.actualBoundingBoxDescent/r),w===0&&(a=T.actualBoundingBoxAscent/r),w===this._lines.length-1&&(l=T.actualBoundingBoxDescent/r)});const h=r3e(this._parameters),p=Math.max(c,h.maxAscent),f=Math.max(u,h.maxDescent),g=a,_=this._parameters.definition.font.decoration==="underline"?f:l,v=o;this._metricsCached=new Out(g,_,p,f,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*Mut}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,bF)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case M_.Left:return this._horizontalPadding;case M_.Center:return(this.displayWidth-this._lineWidths[e])/2;case M_.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,r,i){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;r+=o,i+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+h,i),this._renderLineDecoration(e,r+h,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+h,i,this._textWidths[c]),i+=this._lineSpacing}if(yi.TEXT_SHOW_BASELINE){e.strokeStyle=Tle,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(yi.TEXT_SHOW_BORDER&&(e.strokeStyle=Tle,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=we(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=vF(xle,Math.max(o,rL),Math.max(a,rL)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let h=n;for(let p=0;p<this._lines.length;++p){const f=this._getLineXOffset(p);this._renderLineDecoration(c,s+f,h,this._textWidths[p],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of s3e)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(h*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,h=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,h),e.lineTo(l,h),e.lineTo(l,u),e.stroke()}};const s3e=[];for(let e=0;e<360;e+=360/16)s3e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var M_;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(M_||(M_={}));const xle={canvas:null},Mut=.2,rL=512,Tle="rgb(255, 0, 255, 0.5)";let Out=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,r,i,s,n){this.firstLineAscent=e,this.lastLineDescent=r,this.maxLineAscent=i,this.maxLineDescent=s,this.displayWidth=n}};const Rut=Object.freeze({left:0,center:.5,right:1}),RN=Object.freeze({"bottom-left":ar(0,0),bottom:ar(.5,0),"bottom-right":ar(1,0),left:ar(0,.5),center:ar(.5,.5),right:ar(1,.5),"top-left":ar(0,1),top:ar(.5,1),"top-right":ar(1,1)});function n3e(t){switch(t){case"left":return M_.Left;case"right":return M_.Right;default:return M_.Center}}function Sle(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function $ut(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Iut(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Lut(t){return t==="middle"?"center":t}function Dut(t,e){switch(t){case"top":return cr(e,0,bF);case"bottom":return cr(e,0,-bF);default:return Vn(e,n0)}}let EE=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=xe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=fu(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Bs(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=xe()),ri(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Vs()),Ge(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*KS(this.shaderTransformation)),this._boundingSphere):Wye}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Ele=Pe(0,0,1),Nut=16,Fut=1.5,zb=tK,kut=[zb/2,zb/2,1-zb/2,1-zb/2],Uut=[cF*zb,cF*zb];let Oq=class o3e extends Nm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=dut(this.symbolLayer),n=this._getCIMResource(s);n!=null?await this._prepareResourcesCIM(r,JSON.parse(n),e):await this._prepareResourcesHref(r,s,e)}}_getCIMResource(e){const r=D_(e);return(r==null?void 0:r.mediaType)==="application/json"?r.data:void 0}_validateOrThrow(){if(this._drivenProperties.size)return;const e=n8(this._getIconSize());if(e)throw new J("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?on(e.size):Nut);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){let r=this._cimData;if(r&&r.symbol||this.logger.error("Can't create texture, CIM data is undefined"),r.primitiveOverrides){r=ge(r);const c=r.primitiveOverrides;nP.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),nP.applyOverrides(r.symbol,c)}const i=ZW(JSON.stringify(r));let s=this._cimSymbolTextures.get(i);if(s)return s;const n=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&nP.applyDictionaryTextOverrides(r.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?kat(this._cimScaleFactorOrFunction,e):1;a!==1&&r.symbol&&_K(r.symbol,a);const l=Ez.getEnvelope(r,null,n.resourceManager);if(l&&l.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,h=n.rasterize({type:"cim",data:r},l.width,l.height,c,u,1,"esriGeometryPoint"),p=new Fb({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",p),s=new o1(h,{width:(h==null?void 0:h.width)??1,height:(h==null?void 0:h.height)??1})}else s=new o1(new ImageData(1,1),{width:1,height:1});return this._cimSymbolTextures.set(i,s),this._context.stage.add(s),s}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(zut(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:on(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(Az(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>wnt(r));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=bnt(r),e.distanceFieldBoundingBox=kut;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/zb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await xp(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Uo(o.error),new J("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._textureHandle=o.value;const a=o.value.texture;this._size=this._computeSizeFromTexture(a,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){if(this._cimData=r,!this._context.sharedResources.cimSymbolRasterizer){const u=(await me(async()=>{const{CIMSymbolRasterizer:h}=await import("./CIMSymbolRasterizer-D42EMN39.js");return{CIMSymbolRasterizer:h}},[])).CIMSymbolRasterizer;vt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=r,a=o==null?void 0:o.symbol;Ez.fetchResources(a,s.resourceManager,n,i),Ez.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o!=null&&o.primitiveOverrides&&n.push(nP.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),vt(i)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const h=u.scaleExpression,p=await eve(h,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(f,g,_)=>{const v=XCe(p,f,{$view:_},"esriGeometryPoint",g);return v!==null?v:1}}}vt(i),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||xje}_getOutlineSize(){var i;let e=0;const r=this.symbolLayer;return((i=r.outline)==null?void 0:i.size)!=null?Math.max(on(r.outline.size),0):(e=Az(this._getPrimitive())?Fut:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(s=r==null?void 0:r.outline)==null?void 0:s.color;if(i!=null){const n=Fe.toUnitRGB(i),o=i.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var i,s;if(Az(this._getPrimitive()))return Sut;const e=this._getPrimitive()==null,r=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?ar((r.x||0)+.5,.5-(r.y||0)):e in RN?RN[e]:RN.center}_createMaterialAndAddToStage(e,r){if(this._cimData){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new vE(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=gE(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new vE(e),r.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=Ja(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=er(this._textureHandle)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=on(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var h;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage);const g=window.devicePixelRatio||1;s=[p.parameters.width/g,p.parameters.height/g]}else s=this._size,i=this._materials[0];const n=TO(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((h=this._fastUpdates)!=null&&h.visualVariables.size)){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=ar(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=OR(o3e.elevationModeChangeTypes,i,s);if(n!==bs.UPDATE)return n;const o=Gh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){var i;for(const s in e.diff){if(s!=="visualVariables"||!yE(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return zs.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return zs.FastUpdate}prepareSymbolLayerPatch(e){var i;if((i=this._patchTask)==null||i.abort(),e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchResource(e,r)}_preparePatchResource(e,r){var l;if(!r.resource||r.resource.type!=="partial")return;const i=r.resource.diff;if(((l=i==null?void 0:i.href)==null?void 0:l.type)!=="complete")return;const s=i.href.newValue,{textures:n}=this._context.sharedResources;if(s==null||n==null||this._getCIMResource(s)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=Ja(this._patchTask),this._patchTask=Am(c=>this._context.schedule(async(u,h)=>{const p=await xp(n.fromUrl(s,a,{signal:h}));vt(h);const f=!p.ok;if(f&&Uo(p.error),this._textureHandle=er(this._textureHandle),this._patchTask=null,f){this._forEachMaterial(v=>{v.visible=!1,v.setParameters({textureId:null})});const _=`Failed to load (Request for icon resource failed: ${s})`;return void this.logger.error(new J("graphics3diconsymbollayer:request-failed",_))}this._textureHandle=p.value;const g=p.value.texture;this._size=this._computeSizeFromTexture(g,o),this._forEachMaterial(_=>{_.setParameters({textureId:g.id}),_.visible=!0})},c))}),delete i.href}_defaultElevationInfoNoZ(){return But}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),h=RH(i,Ele,null,s,n,Vut,null,l,u),p=kJ(this._context,r,h,o,a);if(p==null)return null;const f=new Dm(this,p.object,[h],null,null,aw,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=Gh(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,l),f.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,g),xO(f,r,this._context.elevationProvider),f}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=E();Qa(r,a,this._context.overlaySR),a[2]=cK;const l=this._context.clippingExtent;if(l!=null&&!rZ(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),h=RH(i,Ele,a,s,n,null,null,c,u),p=new EE(h,{layerUid:o,graphicUid:e.uid}),f=new b8(this,[p],null,this._context.drapeSourceRenderer);return f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,g),f}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=je())=>{const[c,u]=fJ(Gut,this._fastUpdates.materialParameters,r);return l[0]=c*o+i,l[1]=u*a+i,l}}const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=je())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Pe(e,e,e),i=Ka(1),s=e*i,n=Pe(s,s,s);return new AR({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}_computeSizeFromTexture({parameters:e},r){const i=(e.width??1)/(e.height??1);return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}test(){return{...super.test(),material:this._materials[0]}}};function zut(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Az(t){return t!=null&&(t==="cross"||t==="x")}Oq.PRIMITIVE_SIZE=Uut,Oq.elevationModeChangeTypes={definedChanged:bs.UPDATE,staysOnTheGround:bs.NONE,onTheGroundChanged:bs.RECREATE};const But={mode:"relative-to-ground",offset:0},Vut=zt(0,0,0,1),Gut=E();function Rq(t){switch(t){case"butt":return Ph.BUTT;case"square":return Ph.SQUARE;case"round":return Ph.ROUND;default:return null}}function Cle(t){return t==="diamond"?"kite":t}function $q(t,e,r=null){const i=[],s=e.mapPositions;jut(e,i);const n=i[0][1].data,o=i[0][1].indices.length,a=v1(o);return Hut(e,i,a),Yut(e,i,a),qut(e,i,a),Wut(e,i,a),Xut(e,i,a),Zut(e,i,a),Jut(e,i,n),new un(t,i,s,vs.Line,r)}function jut(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:i}=t,s=Kut(r)&&i,n=r.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?r.slice(0,-3):r;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([O.POSITION,new qe(a,o,3,s)])}function Hut(t,e,r){if(t.attributeData.colorFeature!=null)return;const i=t.attributeData.color;e.push([O.COLOR,new qe(i??yh,r,4)])}function qut(t,e,r){t.attributeData.normal&&e.push([O.NORMAL,new qe(t.attributeData.normal,r,3)])}function Wut(t,e,r){t.attributeData.colorFeature!=null&&e.push([O.COLORFEATUREATTRIBUTE,new qe([t.attributeData.colorFeature],r,1,!0)])}function Yut(t,e,r){t.attributeData.sizeFeature==null&&e.push([O.SIZE,new qe([t.attributeData.size??1],r,1,!0)])}function Xut(t,e,r){t.attributeData.sizeFeature!=null&&e.push([O.SIZEFEATUREATTRIBUTE,new qe([t.attributeData.sizeFeature],r,1,!0)])}function Zut(t,e,r){t.attributeData.opacityFeature!=null&&e.push([O.OPACITYFEATUREATTRIBUTE,new qe([t.attributeData.opacityFeature],r,1,!0)])}function Jut(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ne.Global||!t.overlayInfo.spatialReference.isGeographic)return;const i=ao(r.length),s=Vr(t.overlayInfo.spatialReference);for(let h=0;h<i.length;h+=3)XY(r,h,i,h,s);const n=r.length/3,o=hs(n+1);let a=Qut,l=eht,c=0,u=0;cr(a,i[u++],i[u++]),u++,o[0]=0;for(let h=1;h<n+1;++h)h===n&&(u=0),cr(l,i[u++],i[u++]),u++,c+=Ube(a,l),o[h]=c,[a,l]=[l,a];e.push([O.DISTANCETOSTART,new qe(o,e[0][1].indices,1,!0)])}function Kut(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Qut=je(),eht=je();function Vkt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=ao(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function tht(t,e,r,i){const s=t.type==="polygon"?Em.CCW_IS_HOLE:Em.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=FR(n,!!t.hasZ,s,t.spatialReference),l=ao(o.length),c=bTe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?a3e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function rht(t,e){const r=t.type==="polygon"?Em.CCW_IS_HOLE:Em.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=FR(i,!1,r),o=Wi(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=cK;return{lines:o?a3e(n,s):[],projectionSuccess:o}}function a3e(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:Ah(e,3*s,3*n),mapPositions:r!=null?Ah(r,o,a):void 0})}return i}function l3e(t){const e=new Or,r=t.multipassEnabled&&(t.output===k.Color||t.output===k.Alpha),i=t.space===Ll.World;e.include(pEe,t),e.include(OEe,t),t.output===k.LinearDepth&&e.include(h0,t);const{vertex:s,fragment:n}=e;return n.include(Yh),Sc(s,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.PREVPOSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),J_(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new ni("nearFar",(o,a)=>a.camera.nearFar),new wr("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(O.NORMAL,"vec3"),dE(s),s.constants.add("tiltThreshold","float",.7),s.code.add(x`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(x`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(x`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===jw.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Ll.Screen&&(s.uniforms.add(new is("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Ie("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),sC(s),Ik(e),s.code.add(x`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(x`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(x`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(x`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Ll.Screen&&s.code.add(x`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(x`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Oc,t),e.include(Rs,t),n.uniforms.add(new wr("intrinsicColor",o=>o.color),new at("tex",o=>o.markerTexture)),n.include(Lm),e.constants.add("texelSize","float",1/uw),n.code.add(x`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",rK/uw),e.constants.add("relativeTipLineWidth","float",Ont),n.code.add(x`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",xo),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===k.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===k.Alpha?x`fragColor = vec4(finalColor.a);`:""}
    ${t.output===k.Color?x`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===k.Color&&t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===k.Highlight?x`fragColor = vec4(1.0);`:""}
    ${t.output===k.LinearDepth?x`outputDepth(linearDepth);`:""}
  }
  `),e}const iht=Object.freeze(Object.defineProperty({__proto__:null,build:l3e},Symbol.toStringTag,{value:"Module"})),c3e=new Map([[O.POSITION,0],[O.PREVPOSITION,1],[O.UV0,2],[O.NORMAL,3],[O.COLOR,4],[O.COLORFEATUREATTRIBUTE,4],[O.SIZE,5],[O.SIZEFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,6]]);let u3e=class h3e extends Gr{initializeProgram(e){return new Dr(e.rctx,h3e.shader.get().build(this.configuration),c3e)}_makePipelineState(e,r){const i=this.configuration,s=e===dt.NONE;return Nt({blending:i.output===k.Color||i.output===k.Alpha?s?wu:A0(e):null,depthTest:i.space===Ll.Draped?null:{func:x1(e)},depthWrite:i.space===Ll.Draped?null:s?i.writeDepth?Mc:null:e8(e),colorWrite:qt,stencilWrite:i.hasOccludees?Sm:null,stencilTest:i.hasOccludees?r?s1:T1:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Nt({blending:wu,depthTest:rF,depthWrite:null,colorWrite:qt,stencilWrite:null,stencilTest:jTe}),this._occluderPipelineOpaque=Nt({blending:wu,depthTest:rF,depthWrite:null,colorWrite:qt,stencilWrite:VTe,stencilTest:GTe}),this._occluderPipelineMaskWrite=Nt({blending:null,depthTest:RJ,depthWrite:null,colorWrite:null,stencilWrite:Sm,stencilTest:s1})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};u3e.shader=new Lr(iht,()=>me(()=>Promise.resolve().then(()=>yAt),void 0));let sht=class extends b1{constructor(e){super(e,new oht),this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===k.Highlight||qg(r)&&this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil],[ue.OPAQUE_NO_SSAO_DEPTH,r=>r===k.LinearDepth],[ue.OCCLUDER_MATERIAL,r=>dse(r)&&this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil],[ue.TRANSPARENT_OCCLUDER_MATERIAL,r=>dse(r)&&this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil],[ue.TRANSPARENT_MATERIAL,r=>qg(r)&&this.parameters.writeDepth],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>qg(r)&&!this.parameters.writeDepth],[ue.DRAPED_MATERIAL,r=>r===k.Color||r===k.Highlight]]),this._vertexAttributeLocations=c3e,this._configuration=new Zn,this._layout=this.createLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===ue.DRAPED_MATERIAL?Ll.Draped:this.parameters.worldSpace?Ll.World:Ll.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Ph.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ur.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Yi().vec3f(O.POSITION).vec3f(O.PREVPOSITION).vec2f(O.UV0);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new aht(this._layout,this.parameters)}createGLMaterial(e){return new nht(e)}},nht=class extends SZ{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(u3e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},oht=class extends MR{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Ph.BUTT,this.anchor=jw.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},aht=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.attributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.attributes.get(O.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,h=0;this._parameters.vvSize?h=i.attributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(O.SIZE)&&(u=i.attributes.get(O.SIZE).data[0]);let p=[1,1,1,1],f=0;this._parameters.vvColor?f=i.attributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(O.COLOR)&&(p=i.attributes.get(O.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=i.attributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(C,P,R,L)=>{if(_[v++]=C[0],_[v++]=C[1],_[v++]=C[2],_[v++]=P[0],_[v++]=P[1],_[v++]=P[2],_[v++]=R[0],_[v++]=R[1],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=h:_[v++]=u,this._parameters.vvColor)_[v++]=f;else{const F=Math.min(4*L,p.length-4);_[v++]=p[F],_[v++]=p[F+1],_[v++]=p[F+2],_[v++]=p[F+3]}this._parameters.vvOpacity&&(_[v++]=g)};let w;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(w||(w={}));const T=(C,P)=>{const R=te(lht,o[3*C],o[3*C+1],o[3*C+2]),L=cht;let F=C+P;do te(L,o[3*F],o[3*F+1],o[3*F+2]),F+=P;while(ww(R,L)&&F>=0&&F<a);e&&(Ge(R,R,e),Ge(L,L,e)),b(R,L,[-1,-1],C),b(R,L,[1,-1],C),b(R,L,[1,1],C),b(R,L,[-1,-1],C),b(R,L,[1,1],C),b(R,L,[-1,1],C)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,w.DESCENDING)}};const lht=E(),cht=E(),Ko={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},uht={dash:Ko.dash,"dash-dot":[...Ko.dash,...Ko.dot],dot:Ko.dot,"long-dash":Ko["long-dash"],"long-dash-dot":[...Ko["long-dash"],...Ko.dot],"long-dash-dot-dot":[...Ko["long-dash"],...Ko.dot,...Ko.dot],none:null,"short-dash":Ko["short-dash"],"short-dash-dot":[...Ko["short-dash"],...Ko["short-dot"]],"short-dash-dot-dot":[...Ko["short-dash"],...Ko["short-dot"],...Ko["short-dot"]],"short-dot":Ko["short-dot"],solid:null},hht=8;function dht(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function Wkt(t){return{pattern:[t,t],pixelRatio:2}}function d3e(t){return t!=null&&t.type==="style"?pht(t.style):null}function pht(t){return t!=null?dht(uht[t],hht):null}const fht=["polyline","polygon","extent"],Ale=new AR({size:!0,color:!0,rotation:!1,opacity:!0});let p3e=class f3e extends Nm{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=gE(this._context.renderer,Ale),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Ka(1))<0)throw new J("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var n,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Rq(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:d3e(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[Ss.Line]==null&&(this._materials[Ss.Line]=new RT(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[Ss.Line])),this._materials[Ss.Line]}get _ringMaterial(){return this._materials[Ss.Ring]==null&&(this._materials[Ss.Ring]=new RT(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[Ss.Ring])),this._materials[Ss.Ring]}get _wireframeLineMaterial(){return this._materials[Ss.LineWireframe]==null&&(this._materials[Ss.LineWireframe]=new RT({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[Ss.LineWireframe])),this._materials[Ss.LineWireframe]}get _wireframeRingMaterial(){return this._materials[Ss.RingWireframe]==null&&(this._materials[Ss.RingWireframe]=new RT({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[Ss.RingWireframe])),this._materials[Ss.RingWireframe]}get _markerMaterial(){return this._materials[Ss.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[Ss.Marker]=new sht({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Cle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[Ss.Marker])),this._materials[Ss.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?on(sst(e.size)):1}_getDrivenColor(e){const r=zt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,fht,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return zs.RecreateSymbol;{const s=this._fastUpdates;if(!yE(s,r,Ale))return zs.RecreateSymbol;this._forEachMaterial(n=>n==null?void 0:n.setParameters(s.materialParameters))}}return zs.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=Rq(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r===Ss.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,r=!1){var a,l;if(e==null)return;const i=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=zt(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=OR(f3e.elevationModeChangeTypes,i,s);if(n!==bs.UPDATE)return n;const o=Gh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r==null?void 0:r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof $r)return bp.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=Mn(),c=tht(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let f=0;f<c.lines.length;f++){const g=c.lines[f],_=g.position,v=g.mapPositions;if(this._context.clippingExtent!=null&&(Ri(l),pu(l,v),!sp(l,this._context.clippingExtent)))continue;const b=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,fM.ELEVATED,i);a.push(b),yi.LINE_WIREFRAMES&&a.push(b.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const h=new P0({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new Dm(this,h,a,null,null,btt,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=Gh(r.mode),p}_createGeometry(e,r,i,s,n,o,a){var _,v,b;const l=o===fM.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,h=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:h?gp(h.field,r.graphic):null,colorFeature:u?gp(u.field,r.graphic):null,opacityFeature:p?gp(p.field,r.graphic):null};return $q(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},f)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=yi.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Mn(),h=Ri(),p=rht(s,this._context.overlaySR),f=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,f,"LineSymbol3DLayer");for(const g of p.lines){if(Ri(u),pu(u,g.position),!sp(u,this._context.clippingExtent))continue;aE(h,u);const _=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,fM.DRAPED,i.uid),w=new EE(b,{layerUid:r,graphicUid:i.uid});c.push(w)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||pu(u,g.position,0,1),v!=="end"&&v!=="begin-end"||pu(u,g.position,g.position.length-3,1)}_(o),yi.LINE_WIREFRAMES&&_(a)}return new b8(this,c,h,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??Ka(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?on(1):1:on(e)}_prepareMaterialPatch(e,r,i){var a,l;const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[Ss.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(uR(o),this._materials[Ss.Marker],e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._materials[Ss.Line],e),delete r.material}_prepareMarkerPatch(e,r){var u;const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=(u=i.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Cle(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var fM,Ss;p3e.elevationModeChangeTypes={definedChanged:bs.RECREATE,staysOnTheGround:bs.NONE,onTheGroundChanged:bs.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(fM||(fM={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(Ss||(Ss={}));let c3=null,wF=!0;function Pz(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(wF)try{return new ImageData(t,e)}catch{wF=!1}return m3e(t,e,r)}function mht(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(wF)try{return new ImageData(t,e,r)}catch{wF=!1}const s=m3e(e,r,i);return s.data.set(t,0),s}function ght(){return c3||(c3=document.createElement("canvas"),c3.width=1,c3.height=1),c3}function m3e(t,e,r){return r||(r=ght()),r.getContext("2d").createImageData(t,e)}async function yht(t,e){const r=window.URL.createObjectURL(t);try{const{data:i}=await Wr(r,{...e,responseType:"image"});return i}catch(i){throw ns(i)?i:new J("invalid-image",`Could not fetch requested image at ${r}`)}finally{window.URL.revokeObjectURL(r)}}async function Ykt(t,e){const{arrayBuffer:r,mediaType:i}=await _ht(t,e),s=i==="image/png";if(i==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await me(()=>import("./gif-C5uLViLK.js"),[]);if(n(r))return o(r,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await me(()=>import("./apng-ClkRbYH_.js"),[]);if(n(r))return o(r,e)}return yht(new Blob([r],{type:i}),e)}async function _ht(t,e){var s;const r=D_(t);if(r!=null&&r.isBase64)return{arrayBuffer:eme(r.data),mediaType:r.mediaType};const i=await Wr(t,{responseType:"array-buffer",...e});return{arrayBuffer:i.data,mediaType:((s=i.getHeader)==null?void 0:s.call(i,"Content-Type"))??""}}var J2;const Mz=new WeakMap;let vht=0,Tf=J2=class extends We{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:nE(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:nE(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Mz.has(this.data)||Mz.set(this.data,++vht),e(Mz.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new J2(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return mht(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new J2({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new J2({data:t}):_w(J2,t)}};d([m({type:String,json:{write:H_}})],Tf.prototype,"url",null),d([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],Tf.prototype,"data",null),d([lr("data")],Tf.prototype,"writeData",null),d([Tr("data")],Tf.prototype,"readData",null),d([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Tf.prototype,"transparent",null),d([m({json:{write:!0}})],Tf.prototype,"wrap",void 0),d([m({readOnly:!0})],Tf.prototype,"contentHash",null),Tf=J2=d([V("esri.geometry.support.MeshTexture")],Tf);const mM=Tf;let K2=class extends Au(We){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],K2.prototype,"offset",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],K2.prototype,"rotation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],K2.prototype,"scale",void 0),K2=d([V("esri.geometry.support.MeshTextureTransform")],K2);const bS=K2;var Iq;let Cd=Iq=class extends We{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Iq(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([m({type:Fe,json:{write:!0}})],Cd.prototype,"color",void 0),d([m({type:mM,json:{write:!0}})],Cd.prototype,"colorTexture",void 0),d([m({type:bS,json:{write:!0}})],Cd.prototype,"colorTextureTransform",void 0),d([m({type:mM,json:{write:!0}})],Cd.prototype,"normalTexture",void 0),d([m({type:bS,json:{write:!0}})],Cd.prototype,"normalTextureTransform",void 0),d([m({nonNullable:!0,json:{write:!0}})],Cd.prototype,"alphaMode",void 0),d([m({nonNullable:!0,json:{write:!0}})],Cd.prototype,"alphaCutoff",void 0),d([m({nonNullable:!0,json:{write:!0}})],Cd.prototype,"doubleSided",void 0),Cd=Iq=d([V("esri.geometry.support.MeshMaterial")],Cd);const xK=Cd;var Lq;let Ju=Lq=class extends xK{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Lq(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};d([m({type:Fe,json:{write:!0}})],Ju.prototype,"emissiveColor",void 0),d([m({type:mM,json:{write:!0}})],Ju.prototype,"emissiveTexture",void 0),d([m({type:bS,json:{write:!0}})],Ju.prototype,"emissiveTextureTransform",void 0),d([m({type:mM,json:{write:!0}})],Ju.prototype,"occlusionTexture",void 0),d([m({type:bS,json:{write:!0}})],Ju.prototype,"occlusionTextureTransform",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Ju.prototype,"metallic",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Ju.prototype,"roughness",void 0),d([m({type:mM,json:{write:!0}})],Ju.prototype,"metallicRoughnessTexture",void 0),d([m({type:bS,json:{write:!0}})],Ju.prototype,"metallicRoughnessTextureTransform",void 0),Ju=Lq=d([V("esri.geometry.support.MeshMaterialMetallicRoughness")],Ju);const g3e=Ju;var $N;let ku=$N=class extends We{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return Q2(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},ae.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&ae.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Q2(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},ae.getLogger(this))}castUv(t){return Q2(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},ae.getLogger(this))}castNormal(t){return Q2(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},ae.getLogger(this))}castTangent(t){return Q2(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},ae.getLogger(this))}clone(){const t={position:ge(this.position),uv:ge(this.uv),normal:ge(this.normal),tangent:ge(this.tangent),color:ge(this.color)};return new $N(t)}clonePositional(){const t={position:ge(this.position),normal:ge(this.normal),tangent:ge(this.tangent),uv:this.uv,color:this.color};return new $N(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function Oz(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function Q2(t,e,r,i,s){if(!t)return t;if(t instanceof e)return Oz(t,i,e,s);for(const n of r)if(t instanceof n)return Oz(new e(t),i,e,s);if(Array.isArray(t))return Oz(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function u3(t,e,r){e[r]=bht(t)}function bht(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}d([m({json:{write:u3}})],ku.prototype,"color",void 0),d([zi("color")],ku.prototype,"castColor",null),d([m({nonNullable:!0,json:{write:u3}})],ku.prototype,"position",void 0),d([zi("position")],ku.prototype,"castPosition",null),d([m({json:{write:u3}})],ku.prototype,"uv",void 0),d([zi("uv")],ku.prototype,"castUv",null),d([m({json:{write:u3}})],ku.prototype,"normal",void 0),d([zi("normal")],ku.prototype,"castNormal",null),d([m({json:{write:u3}})],ku.prototype,"tangent",void 0),d([zi("tangent")],ku.prototype,"castTangent",null),ku=$N=d([V("esri.geometry.support.MeshVertexAttributes")],ku);var oP;let Sf=oP=class extends We{static from(t){return _w(oP,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return Q2(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},ae.getLogger(this))}castMaterial(t){return _w(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?g3e:xK,t)}clone(){return new oP({faces:ge(this.faces),shading:this.shading,material:ge(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const r={faces:ge(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new oP(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([m({json:{write:!0}})],Sf.prototype,"faces",void 0),d([zi("faces")],Sf.prototype,"castFaces",null),d([m({type:xK,json:{write:!0}})],Sf.prototype,"material",void 0),d([zi("material")],Sf.prototype,"castMaterial",null),d([m()],Sf.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Sf.prototype,"shading",void 0),d([m({type:Boolean})],Sf.prototype,"trustSourceNormals",void 0),Sf=oP=d([V("esri.geometry.support.MeshComponent")],Sf);const wht=Sf;let aP=class extends Au(We){constructor(e){super(e),this.type="georeferenced",this.origin=null}};d([Rt({georeferenced:"georeferenced"},{readOnly:!0})],aP.prototype,"type",void 0),d([m({type:[Number],nonNullable:!1,json:{write:!0}})],aP.prototype,"origin",void 0),aP=d([V("esri.geometry.support.MeshGeoreferencedVertexSpace")],aP);const NT=aP;let lP=class extends Au(We){constructor(e){super(e),this.type="local",this.origin=E()}};d([Rt({local:"local"},{readOnly:!0})],lP.prototype,"type",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],lP.prototype,"origin",void 0),lP=d([V("esri.geometry.support.MeshLocalVertexSpace")],lP);const IN=lP;function Ple(){return ae.getLogger("esri.geometry.Mesh")}function Kkt(t){const{vertexSpace:e}=t;if(e.origin!=null)return t.clone();const{anchor:r}=t,i=r.clone(),s=new NT({origin:[i.x,i.y,i.z]}),n=t.cloneWithVertexSpace(s),{position:o}=n.vertexAttributes;return n.vertexAttributes.position=WJ(new Float64Array(o.length),o,[-i.x,-i.y,-(i.z??0)]),n.vertexAttributesChanged(),n}function fx(t){return t.origin!=null}function Qkt(t){return fx(t.vertexSpace)}function y3e(t,e){if(!fx(t))return null;const[r,i,s]=t.origin;return new Ke({x:r,y:i,z:s,spatialReference:e})}function xht(t,e){const{x:r,y:i,z:s,spatialReference:n}=t,o=[r,i,s??0];if((e==null?void 0:e.geographic)!==void 0){if($_(Ple(),"option: geographic",{replacement:"use vertexSpace option instead",version:"4.29",warnOnce:!0}),!(e!=null&&e.vertexSpace))return e!=null&&e.geographic?new IN({origin:o}):new NT({origin:o});Ple().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")}if(!(e!=null&&e.vertexSpace))return n.isGeographic||n.isWebMercator?new IN({origin:o}):new NT({origin:o});switch(e.vertexSpace){case"local":return new IN({origin:o});case"georeferenced":return new NT({origin:o});case"georeferenced-absolute":return new NT}}function e8t(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function t8t(t,e){return t==="local"?new IN({origin:e}):new NT({origin:e})}var Dq;let Ef=Dq=class extends We{constructor(t){super(t),this.translation=E(),this.rotationAxis=la(fwe),this.rotationAngle=0,this.scale=Pe(1,1,1)}get rotation(){return nN(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=qi(t),this.rotationAngle=wWe(t)}get localMatrix(){const t=xe();return tO(Mle,this.rotation,kj(this.rotation)),iye(t,Mle,this.translation,this.scale),t}get localMatrixInverse(){return cn(xe(),this.localMatrix)}applyLocal(t,e){return Ge(e,t,this.localMatrix)}applyLocalInverse(t,e){return Ge(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&eX(this.localMatrix,t.localMatrix)}clone(){const t={translation:qi(this.translation),rotationAxis:qi(this.rotationAxis),rotationAngle:this.rotationAngle,scale:qi(this.scale)};return new Dq(t)}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],Ef.prototype,"translation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],Ef.prototype,"rotationAxis",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],Ef.prototype,"rotationAngle",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],Ef.prototype,"scale",void 0),d([m()],Ef.prototype,"rotation",null),d([m()],Ef.prototype,"localMatrix",null),d([m()],Ef.prototype,"localMatrixInverse",null),Ef=Dq=d([V("esri.geometry.support.MeshTransform")],Ef);const Mle=$c(),Ole=Ef;function _3e(t,e){return t.isGeographic||t.isWebMercator&&(e??!0)}function v3e(t,e){switch(t.type){case"georeferenced":return e.isGeographic;case"local":return e.isGeographic||e.isWebMercator}}function r8t(t,e,r,i){if(i!==void 0){$_(ae.getLogger(t),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const s=e.type==="local";if(!fx(e)||i===s)return r.isGeographic||r.isWebMercator&&i;ae.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${i}) for a Mesh vertex space of type "${e.type}" is not supported. This parameter will be ignored.`)}return v3e(e,r)}const w8=()=>ae.getLogger("esri.geometry.support.meshUtils.normalProjection");function b3e(t,e,r,i,s){return T8(i)?(x8(Jg.TO_PCPF,zn.fromTypedArray(t),Vh.fromTypedArray(e),Vh.fromTypedArray(r),i,zn.fromTypedArray(s)),s):(w8().error("Cannot convert spatial reference to PCPF"),s)}function Tht(t,e,r,i,s){return T8(i)?(x8(Jg.FROM_PCPF,zn.fromTypedArray(t),Vh.fromTypedArray(e),Vh.fromTypedArray(r),i,zn.fromTypedArray(s)),s):(w8().error("Cannot convert to spatial reference from PCPF"),s)}function Sht(t,e,r){return Wi(t,e,0,r,Fh(e),0,t.length/3),r}function Eht(t,e,r){return Wi(t,Fh(r),0,e,r,0,t.length/3),e}function w3e(t,e,r){return a0(to,r),Rp(e,t,to),MX(to)||h8(e,e),e}function x3e(t,e,r){if(a0(to,r),Rp(e,t,to,4),MX(to)||h8(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function T3e(t,e,r,i,s){if(!T8(i))return w8().error("Cannot convert spatial reference to PCPF"),s;x8(Jg.TO_PCPF,zn.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Vh.fromTypedArray(e),Vh.fromTypedArray(r),i,zn.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function Cht(t,e,r,i,s){if(!T8(i))return w8().error("Cannot convert to spatial reference from PCPF"),s;x8(Jg.FROM_PCPF,zn.fromTypedArray(t,16),Vh.fromTypedArray(e),Vh.fromTypedArray(r),i,zn.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function x8(t,e,r,i,s,n){if(!e)return;const o=r.count,a=Fh(s);if(S3e(s))for(let l=0;l<o;l++)i.getVec(l,iL),e.getVec(l,Kp),$l(a,iL,sL,a),kh(to,sL),t===Jg.FROM_PCPF&&Uh(to,to),Bo(Kp,Kp,to),n.setVec(l,Kp);else for(let l=0;l<o;l++){i.getVec(l,iL),e.getVec(l,Kp),$l(a,iL,sL,a),kh(to,sL);const c=z4(r.get(l,1));let u=Math.cos(c);t===Jg.TO_PCPF&&(u=1/u),to[0]*=u,to[1]*=u,to[2]*=u,to[3]*=u,to[4]*=u,to[5]*=u,t===Jg.FROM_PCPF&&Uh(to,to),Bo(Kp,Kp,to),fe(Kp,Kp),n.setVec(l,Kp)}return n}function T8(t){return S3e(t)||Aht(t)}function S3e(t){return t.isWGS84||Sme(t)||u1(t)||h1(t)}function Aht(t){return t.isWebMercator}var Jg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Jg||(Jg={}));const iL=E(),Kp=E(),sL=xe(),to=xi();function TK(t,e,r){return _3e(e.spatialReference,r==null?void 0:r.geographic)?SK(t,e,!1,r):Oht(t,e,r)}function E3e(t,e=ts){const{position:r,normal:i,tangent:s}=t;return{position:Op(new Float64Array(r.length),r,e),normal:i!=null?w3e(i,new Float32Array(i.length),e):null,tangent:s!=null?x3e(s,new Float32Array(s.length),e):null}}function C3e(t,e,r,i){const{position:s,normal:n,tangent:o}=t;if(!fx(e))return{position:s,normal:n,tangent:o};const a=y3e(e,i);return TK(E3e(t,r==null?void 0:r.localMatrix),a,{geographic:e.type==="local"})}function Pht(t,e,r){const i=xht(e,r),s=e.spatialReference,n=fx(i);if(!n)return{vertexAttributes:TK(t,e,r),vertexSpace:i,transform:null};const{position:o,normal:a,tangent:l}=t,c=v3e(i,s);switch(i.type){case"georeferenced":return c?{vertexAttributes:SK(t,e,n,r),vertexSpace:i,transform:null}:{vertexAttributes:{position:o,normal:a,tangent:l},vertexSpace:i,transform:new Ole};case"local":return{vertexAttributes:{position:o,normal:a,tangent:l},vertexSpace:i,transform:new Ole}}}function Nq(t,e,r){return _3e(e.spatialReference,r==null?void 0:r.geographic)?M3e(t,e,r):P3e(t,e,r)}function Mht(t,e,r,i,s){if(!fx(e))return Nq(t,i,s);const{spatialReference:n}=i,o=C3e(t,e,r,n);return i.equals(y3e(e,n))?P3e(o,i,s):Nq(o,i,s)}function A3e({positions:t,transform:e,vertexSpace:r,inSpatialReference:i,outSpatialReference:s,outPositions:n,localMode:o}){const a=r.origin??Cn,l=r.origin!=null?(e==null?void 0:e.localMatrix)??ts:ts;if(r.type==="georeferenced"){const p=n??ao(t.length);if(q6(l,ts)?GYe(p,t):Op(p,t,l),!To(a,Cn)){const[f,g,_]=a;for(let v=0;v<p.length;v+=3)p[v]+=f,p[v+1]+=g,p[v+2]+=_}return Wi(p,i,0,p,s,0,p.length/3),p}let c=i;const u=Fh(i);c=s.isWebMercator&&o||!Dh(i,u)?c:u,$l(i,a,Bb,c),ri(Bb,Bb,l);const h=n??ao(t.length);return Op(h,t,Bb),Wi(h,c,0,h,s,0,h.length/3),h}function Oht(t,e,r){const i=new Float64Array(t.position.length),s=t.position,n=e.x,o=e.y,a=e.z??0,l=S8(r?r.unit:null,e.spatialReference);for(let c=0;c<s.length;c+=3)i[c]=s[c]*l+n,i[c+1]=s[c+1]*l+o,i[c+2]=s[c+2]*l+a;return{position:i,normal:t.normal,tangent:t.tangent}}function SK(t,e,r,i){const s=e.spatialReference,n=O3e(e,i,Bb),o=new Float64Array(t.position.length),a=Rht(t.position,n,s,o),l=a0(R3e,n),c=$ht(a,o,t.normal,l,s),u=Iht(a,o,t.tangent,l,s);if(r){const{x:h,y:p,z:f}=e;WJ(a,a,[-h,-p,-(f??0)])}return{position:a,normal:c,tangent:u}}function Rht(t,e,r,i){Op(i,t,e);const s=new Float64Array(t.length);return Eht(i,s,r)}function $ht(t,e,r,i,s){if(r==null)return null;const n=new Float32Array(r.length);return Rp(n,r,i),Tht(n,t,e,s,n),n}function Iht(t,e,r,i,s){if(r==null)return null;const n=new Float32Array(r.length);Rp(n,r,i,4);for(let o=3;o<n.length;o+=4)n[o]=r[o];return Cht(n,t,e,s,n),n}function P3e(t,e,r){const i=new Float64Array(t.position.length),s=t.position,n=e.x,o=e.y,a=e.z??0,l=S8(r?r.unit:null,e.spatialReference);for(let c=0;c<s.length;c+=3)i[c]=(s[c]-n)/l,i[c+1]=(s[c+1]-o)/l,i[c+2]=(s[c+2]-a)/l;return{position:i,normal:t.normal,tangent:t.tangent}}function M3e(t,e,r){const i=e.spatialReference;O3e(e,r,Bb);const s=cn(Fht,Bb),n=new Float64Array(t.position.length),o=Lht(t.position,i,s,n),a=a0(R3e,s);return{position:o,normal:Dht(t.normal,t.position,n,i,a),tangent:Nht(t.tangent,t.position,n,i,a)}}function O3e(t,e,r){$l(t.spatialReference,[t.x,t.y,t.z??0],r,Fh(t.spatialReference));const i=S8(e?e.unit:null,t.spatialReference);return lR(r,r,[i,i,i]),r}function Lht(t,e,r,i){const s=Sht(t,e,i),n=new Float64Array(s.length);return Op(n,s,r),n}function Dht(t,e,r,i,s){if(t==null)return null;const n=b3e(t,e,r,i,new Float32Array(t.length));return Rp(n,n,s),n}function Nht(t,e,r,i,s){if(t==null)return null;const n=T3e(t,e,r,i,new Float32Array(t.length));return Rp(n,n,s,4),n}function S8(t,e){if(t==null)return 1;const r=YV(e);return 1/ro(r,"meters",t)}const Bb=xe(),Fht=xe(),R3e=xi(),i8t=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:E3e,georeference:TK,georeferenceApplyTransform:C3e,georeferenceByTransform:Pht,georeferenceGlobal:SK,getUnitScale:S8,project:A3e,ungeoreference:Nq,ungeoreferenceByTransform:Mht,ungeoreferenceGlobal:M3e},Symbol.toStringTag,{value:"Module"}));var Tb;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Tb||(Tb={}));let $3e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=jg.KTX2_ENCODING}};function gM(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function kht(t){const e=new Blob([t]),r=await e.text();return JSON.parse(r)}async function Uht(t,e){if(e===jg.KTX2_ENCODING)return new $3e(t);const r=new Blob([t],{type:e}),i=URL.createObjectURL(r),s=new Image;if(se("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(i),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=i});try{s.src=i,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(i),s}function Gf(t){if(t==null)return null;const e=t.offset!=null?t.offset:SSe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:ESe,s=zP(1,0,0,0,1,0,e[0],e[1],1),n=zP(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=zP(i[0],0,0,0,i[1],0,0,0,1),a=xi();return tE(a,n,o),tE(a,s,a),a}let zht=class extends Dm{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=e5(Rz,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=e5(Rz,e),a=i.getOrigin(o);if(a===n)return;const l=(r==null?void 0:r.localMatrix)??ts;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=(r==null?void 0:r.localMatrix)??ts;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(f=>{f.transformation=n}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(i));const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=ri(Rle,o,a),h=ri($le,l,c),p=ri(Ile,h,cn(Ile,a));s.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:h}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&s8(this.elevationContext.featureExpressionInfoContext,i);const n=(g,_)=>r1(g,e,this.elevationContext,r,_),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=ri(Rle,a,l),u=o.effectiveTransformation,h=Bs(Bht,u);this.alignedSampledElevation=aw(this,this.elevationContext,e.spatialReference,n,r,h),o.shaderTransformation=h;const p=o.geometries[0].transformation,f=ri($le,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=cR(Vht,re(Rz,s.vec3,-1)),o=ri(Lle,n,e),a=ri(Dle,n,r),l=cn(Lle,o),c=ri(Dle,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const Rz=E(),Rle=xe(),$le=xe(),Bht=xe(),Ile=xe(),Lle=xe(),Dle=xe(),Vht=xe();let Ght=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new Pp(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(s.add(c),r.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},jht=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const Hht=Yi().vec3f(O.POSITION),qht=Yi().vec3f(O.POSITION).vec2f(O.UV0),Wht=Yi().vec3f(O.POSITION).vec4u8(O.COLOR);Yi().vec3f(O.POSITION).vec4u8(O.OBJECTANDLAYERIDCOLOR);const Yht=Yi().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);Yi().vec3f(O.POSITION).vec4u8(O.COLOR).vec4u8(O.OBJECTANDLAYERIDCOLOR);function I3e(t){const e=new Or,{vertex:r,fragment:i}=e;return e.include(Ol,t),e.include(px,t),Sc(r,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===k.Highlight&&e.include(w1,t),e.include(Rs,t),i.uniforms.add(new Ie("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new wr("constantColor",s=>s.color)),i.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===k.ObjectAndLayerIdColor?x`color.a = 1.0;`:""}

    if (color.a < ${x.float(xo)}) {
      discard;
    }

    ${t.output===k.Color?x`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===k.Highlight?x`outputHighlight();`:""}
  }
  `),e}const Xht=Object.freeze(Object.defineProperty({__proto__:null,build:I3e},Symbol.toStringTag,{value:"Module"}));let L3e=class D3e extends Gr{initializeProgram(e){return new Dr(e.rctx,D3e.shader.get().build(this.configuration),Mr)}initializePipeline(){const e=this.configuration,r=Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Nt({blending:n,depthTest:RJ,depthWrite:o,colorWrite:qt,stencilWrite:e.hasOccludees?Sm:null,stencilTest:e.hasOccludees?s?s1:T1:null});return e.output===k.Color?(this._occludeePipelineState=i(!0,e.transparent?r:null,Mc),i(!1,e.transparent?r:null,Mc)):i(!1)}get primitiveType(){return sr.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};L3e.shader=new Lr(Xht,()=>me(()=>Promise.resolve().then(()=>_At),void 0));let eT=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};d([G({count:k.COUNT})],eT.prototype,"output",void 0),d([G()],eT.prototype,"hasSlicePlane",void 0),d([G()],eT.prototype,"hasVertexColors",void 0),d([G()],eT.prototype,"transparent",void 0),d([G()],eT.prototype,"hasOccludees",void 0);let Nle=class extends b1{constructor(e){super(e,new Jht),this._configuration=new eT,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===k.Color||r===k.Highlight||r===k.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Bbe(r))return void ae.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(O.POSITION).data,l=i.camera,c=Qht;Vn(c,i.point);const u=2;te(h3[0],c[0]-u,c[1]+u,0),te(h3[1],c[0]+u,c[1]+u,0),te(h3[2],c[0]+u,c[1]-u,0),te(h3[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(h3[_],Zm[_]))return;ha(l.eye,Zm[0],Zm[1],$z),ha(l.eye,Zm[1],Zm[2],Iz),ha(l.eye,Zm[2],Zm[3],Lz),ha(l.eye,Zm[3],Zm[0],Dz);let h=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(cl[0]=a[_]+r[12],cl[1]=a[_+1]+r[13],cl[2]=a[_+2]+r[14],ul[0]=a[_+3]+r[12],ul[1]=a[_+4]+r[13],ul[2]=a[_+5]+r[14],bi($z,cl)<0&&bi($z,ul)<0||bi(Iz,cl)<0&&bi(Iz,ul)<0||bi(Lz,cl)<0&&bi(Lz,ul)<0||bi(Dz,cl)<0&&bi(Dz,ul)<0)continue;if(l.projectToRenderScreen(cl,ev),l.projectToRenderScreen(ul,tv),ev[2]<0&&tv[2]>0){ye(Qp,cl,ul);const b=l.frustum,w=-bi(b[ci.NEAR],cl)/de(Qp,b[ci.NEAR]);re(Qp,Qp,w),pe(cl,cl,Qp),l.projectToRenderScreen(cl,ev)}else if(ev[2]>0&&tv[2]<0){ye(Qp,ul,cl);const b=l.frustum,w=-bi(b[ci.NEAR],ul)/de(Qp,b[ci.NEAR]);re(Qp,Qp,w),pe(ul,ul,Qp),l.projectToRenderScreen(ul,tv)}else if(ev[2]<0&&tv[2]<0)continue;ev[2]=0,tv[2]=0;const v=aX(ew(ev,tv,Ule),c);v<h&&(h=v,ce(Fle,cl),ce(kle,ul),p=_/3)}const f=i.rayBegin,g=i.rayEnd;if(h<u*u){let _=Number.MAX_VALUE;if(wye(ew(Fle,kle,Ule),ew(f,g,Kht),Q1)){ye(Q1,Q1,f);const v=Se(Q1);re(Q1,Q1,1/v),_=v/$i(f,g)}o(_,Q1,p,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.attributes.get(O.POSITION).data,l=e.attributes.get(O.SIZE),c=l?l.data[0]:0,u=s[0],h=s[1],p=((c+1)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],w=u-v,T=h-b,S=a[_+3]-v,C=a[_+4]-b,P=we((S*w+C*T)/(S*S+C*C),0,1),R=S*P-w,L=C*P-T,F=R*R+L*L;F<f&&(f=F,g=_/3)}f<p*p&&n(o.dist,o.normal,g,!1)}createGLMaterial(e){return new Zht(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Wht:Hht;return new uC(e)}},Zht=class extends _1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===k.Color&&this._updateOccludeeState(e),this.ensureTechnique(L3e,e)}},Jht=class extends vJ{constructor(){super(...arguments),this.color=yh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const cl=E(),ul=E(),Qp=E(),Q1=E(),ev=Go(),tv=Go(),Fle=E(),kle=E(),Ule=Lp(),Kht=Lp(),Qht=E(),h3=[Go(),Go(),Go(),Go()],Zm=[E(),E(),E(),E()],$z=zr(),Iz=zr(),Lz=zr(),Dz=zr(),edt=["mesh"];let tdt=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new jht,this._fastUpdateProcessor=new Ght,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){yi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Nle({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Nle({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,edt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{var n;return(n=r(s))==null?void 0:n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,i1)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{var s;return(s=r(i))==null?void 0:s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=e.fastTransformUpdatesEnabled;switch(s){case Tb.EnableFastUpdates:if(n)return!0;break;case Tb.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!1}const o=this._context.renderCoordsHelper.spatialReference,a=rdt,{origin:l,transform:c}=i;if(!$l(r,te(Wn,l.x,l.y,l.z??0),a,o))return!1;switch(s){case Tb.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case Tb.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case Tb.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(g,_)=>r1(g,h,u,p,_);return e.alignedSampledElevation=aw(e,u,h.spatialReference,f,p,a),e.updateTransform(a,c,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof Fe?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??sdt;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:h,alphaMode:p}=r.material,f=this._colorOrTextureUid(n),g=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${f},ctmuid:${g},cttuid:${_},ntmuid:${v},nttuid:${b},ds:${u},ac:${h},am:${p}`,r.material instanceof g3e){const{metallic:w,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:C,emissiveColor:P,emissiveTexture:R,emissiveTextureTransform:L,occlusionTexture:F,occlusionTextureTransform:U}=r.material,j=this._colorOrTextureUid(S),z=this._textureTransformUid(C),Z=this._colorOrTextureUid(P),W=this._colorOrTextureUid(R),Y=this._textureTransformUid(L),le=this._colorOrTextureUid(F),I=this._textureTransformUid(U);s.metallic=w,s.roughness=T,s.metallicRoughnessTexture=S,s.emissiveColor=P,s.emissiveTexture=R,s.occlusionTexture=F,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform(L),s.occlusionTextureTransform=this._convertTextureTransform(U),s.metallicRoughnessTextureTransform=this._convertTextureTransform(C),s.uid=`${s.uid},mrm:${w},mrr:${T},mrt:${j},mrtt:${z},emuid:${Z},etmuid:${W},ett:${Y},otmuid:${le},ott:${I}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:Lt(s)}}_setInternalColorValueParameters(e,r){r.diffuse=Fe.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,gi.Opaque);return r==null?void 0:r.id}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};gM(i)?(o=i.data,l.preMultiplyAlpha=!1,l.encoding=i.encoding):(o=i,l.preMultiplyAlpha=r!==gi.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new o1(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Xt.CLAMP_TO_EDGE;case"mirror":return Xt.MIRRORED_REPEAT;default:return Xt.REPEAT}}_setInternalMaterialParameters(e,r){var s,n;if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const o=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);o?(r.textureId=o.id,r.textureAlphaPremultiplied=!!o.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(r.emissiveFactor=Fe.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Gf(e.colorTextureTransform),r.normalTextureTransformMatrix=Gf(e.normalTextureTransform);const i=((s=e.normalTextureTransform)==null?void 0:s.scale)!=null?(n=e.normalTextureTransform)==null?void 0:n.scale:Y6;r.scale=[i[0],i[1]],r.occlusionTextureTransformMatrix=Gf(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Gf(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Gf(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var s,n;const r=this._drivenProperties.color;let i=((s=this.symbolLayer.material)==null?void 0:s.colorMixMode)??null;if(r)e.externalColor=yh;else{const o=((n=this.symbolLayer.material)==null?void 0:n.color)??null;o?e.externalColor=Fe.toUnitRGBA(o):(i=null,e.externalColor=yh)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var g,_,v;const i=(g=r.material)==null?void 0:g.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(v=r.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||(s==null?void 0:s.transparent)||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},h=HTe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Fe.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Cn,diffuse:kg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Ei.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=h?[...$J]:[l.metallic,l.roughness,a8[2]],r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?Ei.None:Ei.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const f=new Pp(p);return u.material=f,this._materialInfoCache.set(l.uid,u),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?gi.MaskBlend:gi.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?gi.Opaque:r.alphaMode==="mask"?gi.Mask:gi.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let f=0;f<i;f++){const g=r[f],_=g.attributes.get(O.POSITION),v=g.attributes.get(O.NORMAL),b=_.data,w=_.indices,T=v.data,S=v.indices;for(let C=0;C<w.length;C++){const P=3*w[C],R=3*S[C];for(let L=0;L<3;L++)o.push(b[P+L]);for(let L=0;L<3;L++)o.push(b[P+L]+T[R+L]*n);if(a.push(a.length),a.push(a.length),C%3==0){this._calculateFaceNormal(b,w,C,t2),this._getFaceVertices(b,w,C,Wn,Qx,e2),pe(Wn,Wn,Qx),pe(Wn,Wn,e2),re(Wn,Wn,1/3);for(let L=0;L<3;L++)l.push(Wn[L]);for(let L=0;L<3;L++)l.push(Wn[L]+t2[L]*n);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,h=new un(this._debugVertexNormalMaterial,[[O.POSITION,new qe(o,a,3,!0)]],null,vs.Line);r.push(h),h.transformation=u;const p=new un(this._debugFaceNormalMaterial,[[O.POSITION,new qe(l,c,3,!0)]],null,vs.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;yi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new P0({geometries:a,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});c.transformation=l;const u=kTe(this.symbolLayer,{opacity:this._getLayerOpacity()}),h=u?new Ltt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new zht(this,c,a,null,null,aw,i,h);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=i1(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:f,renderCoordsHelper:g}=this._context,_=(v,b)=>r1(v,f,i,g,b);return p.alignedSampledElevation=aw(p,i,f.spatialReference,_,g),p}_getCenterPointInElevationSR(e){const r=m1(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return _m([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,t2);for(let a=0;a<3;a++){const l=3*s[o+a];Wn[0]=r[l],Wn[1]=r[l+1],Wn[2]=r[l+2],de(t2,Wn)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new Nz(r,s,n)}_createComponentNormalsFlat(e,r){const i=hs(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,t2);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new Nz(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,t2);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:E(),count:0},i[c]=u),pe(u.normal,u.normal,a),u.count++}}const s=hs(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(fe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new Nz(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,Wn,Qx,e2),ye(Qx,Qx,Wn),ye(e2,e2,Wn),Ze(Wn,Qx,e2),fe(s,Wn),s}_getOrCreateComponents(e){return e.components??idt}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===Ql.RENDER?r.transformBeforeProject:null;if(s&&(i=Op(new Float64Array(i.length),i,s)),r.reprojection===Ql.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s?i:new Float64Array(i.length);return Wi(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===Ql.RENDER?i.transformBeforeProject:null;if(n&&(s=w3e(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Ql.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n?s:new Float32Array(s.length);return b3e(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===Ql.RENDER?i.transformBeforeProject:null;if(n&&(s=x3e(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Ql.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n?s:new Float32Array(s.length);return T3e(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=Jtt((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return WTe(s,n,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),h=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:h,tangentBuffer:p,uvBuffer:n,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Ql.NONE&&a.objectTransformation?a.objectTransformation:this._transformOriginLocal(e,l,h,p),geometryTransformation:a.reprojection===Ql.NONE&&a.geometryTransformation?a.geometryTransformation:xe()}}_computeReprojectionInfo(e){var s;const{vertexSpace:r}=e,i=r.type==="georeferenced"?co(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?Ql.NONE:Ql.RENDER:Ql.NONE;if(fx(r)){const n=r.origin,o=xe(),a=((s=e.transform)==null?void 0:s.localMatrix)??ts;if(i===Ql.NONE)return $l(e.spatialReference,n,o,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:o,geometryTransformation:JS(a),needsBufferCopy:!1};const l=cR(xe(),n);return ri(l,l,a),{reprojection:i,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;nL[0]=o.x,nL[1]=o.y,nL[2]=o.z??0;const a=xe();return $l(e.spatialReference,nL,a,n),cn(zle,a),Op(r,r,zle),(i||s)&&(kh(d3,a),Uh(d3,d3),i&&Rp(i,i,d3),s&&Rp(s,s,d3,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??cx(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const r=(o=e.vertexAttributes)==null?void 0:o.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference,s=A3e({positions:r,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:i??e.spatialReference,localMode:this._context.stage.viewingMode===Ne.Local}),n=s.length/3;return Ri(Fz),pu(Fz,s,0,n),!sp(Fz,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!Dh(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:h,geometryTransformation:p}=s,f=this._getOrCreateComponents(e),g=new Array;let _=!1;const v=e5(Wn,h),b=this._context.localOriginFactory.getOrigin(v);for(const w of f){if(!this._validateFaces(e,w))return null;const T=this._getOrCreateFaces(e,w);if(T.length===0)continue;const S=this._createComponentNormals(n,c,w,T);S.didFlipNormals&&(_=!0);const C=[[O.POSITION,new qe(n,T,3,!0)],[O.NORMAL,new qe(S.normals,S.indices,3,!0)]];a&&C.push([O.COLOR,new qe(a,T,4,!0)]),l&&C.push([O.SYMBOLCOLOR,new qe(l,v1(T.length),4,!0)]),o&&C.push([O.UV0,new qe(o,T,2,!0)]),u&&C.push([O.TANGENT,new qe(u,T,4,!0)]);const P=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),R=this._getOrCreateMaterial(e,w),L=new un(R,C,null,vs.Mesh,P);L.transformation=p,L.localOrigin=b,g.push(L)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:h}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:r}}}}}=this,{vertexSpace:i}=e;return r!==Ne.Local||i.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},Nz=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const nL=E(),Wn=E(),Qx=E(),e2=E(),t2=E(),zle=xe(),d3=xi(),rdt=xe(),Fz=Mn(),idt=[new wht],sdt=new bS;var Ql;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(Ql||(Ql={}));let ndt=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){s8(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>r1(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=E()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,ef),Ge(e,this._lodRenderer.baseBoundingSphere.center,ef)}getBoundingBoxObjectSpace(e=Mn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,ef);const r=this._lodRenderer.baseBoundingBox;Ri(e);for(let i=0;i<8;++i)te(Uu,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),Ge(Uu,Uu,ef),Ep(e,Uu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,ef),e.render.origin[0]+=ef[12],e.render.origin[1]+=ef[13],e.render.origin[2]+=ef[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=odt,l=sZ(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,ef);for(let u=0;u<l;u++){const h=a[u];Uu[0]=o[h[0]],Uu[1]=o[h[1]],Uu[2]=o[h[2]],Ge(Uu,Uu,ef),rv[3*u]=Uu[0],rv[3*u+1]=Uu[1],rv[3*u+2]=Uu[2]}if(!e(rv,0,l))return null;Ri(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],rv[u+h]),o[h+3]=Math.max(o[h+3],rv[u+h]);c&&i.push({location:rv.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(ip(o,kz),this.elevationContext.mode!=="absolute-height")){let u;const h=MJ(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(kz[0],kz[1],s,h,"ground")}catch{}u!=null&&Ave(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===c0.Highlight){const i=new F5(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const rv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Uu=E(),kz=E(),odt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],ef=xe();function adt(t,e){const r=t.stageResources.geometries.map(s=>new ITe(s,t.stageResources.textures)),i=t.lodThreshold==null||t.lodThreshold===0&&e>0?cdt(r):t.lodThreshold;return new LTe(r,i,t.pivotOffset)}function ldt(t){return new DTe(t.map((e,r)=>adt(e,r)))}function cdt(t){const e=t.reduce((r,{geometry:i})=>r+i.indexCount/3,0);return Math.sqrt(e*udt/Math.PI)}const udt=20;function hdt(t){return t=t||globalThis.location.hostname,ddt.some(e=>(t==null?void 0:t.match(e))!=null)}function Fq(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(N3e)!=null||e.match(k3e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(F3e)!=null||e.match(U3e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const N3e=/^devext.arcgis.com$/,F3e=/^qaext.arcgis.com$/,k3e=/^[\w-]*\.mapsdevext.arcgis.com$/,U3e=/^[\w-]*\.mapsqa.arcgis.com$/,ddt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,N3e,F3e,/^jsapps.esri.com$/,k3e,U3e];function pdt(t,e,r){if(t.count!==e.count)return void qJ().error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],f=r[9],g=r[10],_=r[11],v=r[12],b=r[13],w=r[14],T=r[15],S=t.typedBuffer,C=t.typedBufferStride,P=e.typedBuffer,R=e.typedBufferStride;for(let L=0;L<i;L++){const F=L*C,U=L*R,j=P[U],z=P[U+1],Z=P[U+2],W=P[U+3];S[F]=s*j+l*z+p*Z+v*W,S[F+1]=n*j+c*z+f*Z+b*W,S[F+2]=o*j+u*z+g*Z+w*W,S[F+3]=a*j+h*z+_*Z+T*W}}function fdt(t,e,r){EK(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function EK(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void qJ().error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],p=r[6],f=r[7],g=r[8];let _=0,v=0;for(let b=0;b<n;b++){const w=e[_],T=e[_+1],S=e[_+2],C=e[_+3];t[v]=o*w+c*T+p*S,t[v+1]=a*w+u*T+f*S,t[v+2]=l*w+h*T+g*S,t[v+3]=C,_+=s,v+=i}}function mdt(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,u=n[c],h=n[c+1],p=n[c+2],f=u*u+h*h+p*p;if(f>0){const g=1/Math.sqrt(f);i[l]=g*u,i[l+1]=g*h,i[l+2]=g*p}}}function gdt(t,e,r){xF(t.typedBuffer,e,r,t.typedBufferStride)}function xF(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:mdt,scale:xF,scaleView:gdt,transformMat3:EK,transformMat3View:fdt,transformMat4:pdt},Symbol.toStringTag,{value:"Module"}));function ydt(t,e){CK(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function CK(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(Oh(e)||W$e(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=Y$e(e);if(q$e(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function _dt(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:_dt,normalizeIntegerBuffer:CK,normalizeIntegerBufferView:ydt},Symbol.toStringTag,{value:"Module"}));function vdt(t,e){VR(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function VR(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function bdt(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:VR,copyView:vdt,fill:bdt},Symbol.toStringTag,{value:"Module"}));function wdt(t,e){AK(t.typedBuffer,e,t.typedBufferStride)}function AK(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function xdt(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:AK,copyView:wdt,fill:xdt},Symbol.toStringTag,{value:"Module"}));let z3e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return Cm(e)?(vt(r),vY(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Wr(r,{responseType:Tdt[e]})).data;const s=await xp(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw Uo(s.error),new J("",`Request for resource failed: ${s.error}`)}};const Tdt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Sdt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function Edt(t,e={}){return{data:t,parameters:{wrap:{s:Xt.REPEAT,t:Xt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let E8=class kq{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new J(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new kq(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!(i!=null&&i.match)||!n.test(i))throw new J((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(s!=null&&s.match)||!n.test(s))throw new J((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new kq(o,a,r)}};function LN(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:LN},Symbol.toStringTag,{value:"Module"}));let Ble=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var yM,Vle;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(yM||(yM={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Vle||(Vle={}));const B3e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Cdt={pbrMetallicRoughness:B3e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Adt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},Gle=(t={})=>{const e={...B3e,...t.pbrMetallicRoughness},r=Pdt({...Adt,...t.extras});return{...Cdt,...t,pbrMetallicRoughness:e,extras:r}};function Pdt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode="tint"}return t}const Mdt={magFilter:Gt.LINEAR,minFilter:Gt.LINEAR_MIPMAP_LINEAR,wrapS:Xt.REPEAT,wrapT:Xt.REPEAT},Odt=t=>({...Mdt,...t});function Rdt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const oL={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let $dt=class Uy{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=Rdt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new J("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new J("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new J("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(Cm(r)){const o=D_(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Uy(e,r,l)}catch{}const a=vY(r);if(Uy._isGLBData(a))return this._fromGLBData(e,r,a)}if(kdt.test(r)||(i==null?void 0:i.expectedType)==="gltf"){const o=await e.loadJSON(r,i);return new Uy(e,r,o)}const s=await e.loadBinary(r,i);if(Uy._isGLBData(s))return this._fromGLBData(e,r,s);if(Udt.test(r)||(i==null?void 0:i.expectedType)==="glb")throw new J("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(r,i);return new Uy(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new Ble(e);return r.remainingBytes()>=4&&r.readUint32()===oL.MAGIC}static async _fromGLBData(e,r,i){const s=await Uy._parseGLBData(i);return new Uy(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new Ble(e);if(r.remainingBytes()<12)throw new J("gltf-loader-error","glb binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==oL.MAGIC)throw new J("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new J("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new J("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==oL.CHUNK_TYPE_JSON)throw new J("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new J("gltf-loader-error","No JSON data found.");o=await kht(r.readUint8Array(c))}else if(l===1){if(u!==oL.CHUNK_TYPE_BIN)throw new J("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=r.readUint8Array(c)}else ae.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new J("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new J("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new J("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new J("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new J("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[yM.MAT2,yM.MAT3,yM.MAT4])throw new J("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=Ddt[i.type],a=Ndt[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Te.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Te.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Te.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Te.UNSIGNED_BYTE:return LN(this._wrapAccessor(pE,i));case Te.UNSIGNED_SHORT:return LN(this._wrapAccessor(Uk,i));case Te.UNSIGNED_INT:return LN(this._wrapAccessor(Bk,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new J("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Te.FLOAT)throw new J("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Te[i.componentType]);if(i.componentCount!==3)throw new J("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(zn,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new J("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Te.FLOAT)throw new J("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Te[i.componentType]);if(i.componentCount!==3)throw new J("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(zn,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new J("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Te.FLOAT)throw new J("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Te[i.componentType]);if(i.componentCount!==4)throw new J("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Ap(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new J("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new J("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Te.FLOAT)return this._wrapAccessor(lx,i);if(!i.normalized)throw new J("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Fdt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new J("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new J("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Te.FLOAT)return this._wrapAccessor(Ap,i);if(i.componentType===Te.UNSIGNED_BYTE)return this._wrapAccessor(_a,i);if(i.componentType===Te.UNSIGNED_SHORT)return this._wrapAccessor(xR,i)}else if(i.componentCount===3){if(i.componentType===Te.FLOAT)return this._wrapAccessor(zn,i);if(i.componentType===Te.UNSIGNED_BYTE)return this._wrapAccessor(kk,i);if(i.componentType===Te.UNSIGNED_SHORT)return this._wrapAccessor(zk,i)}throw new J("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Te[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var n,o,a,l,c,u,h,p,f,g;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const _=e.material!=null?Gle(this.json.materials[e.material]):Gle(),v=_.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(v.baseColorTexture,r),T=this.getTexture(_.normalTexture,r),S=i?this.getTexture(_.occlusionTexture,r):void 0,C=i?this.getTexture(_.emissiveTexture,r):void 0,P=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,R=e.material!=null?e.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await w,normalTexture:await T,name:_.name,id:R,occlusionTexture:await S,emissiveTexture:await C,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await P,hasVertexColors:b,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(h=_.emissiveTexture)==null?void 0:h.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(f=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:f.extensions)==null?void 0:g.KHR_texture_transform,receiveAmbientOcclusion:_.extras.ESRI_receiveAmbientOcclusion,receiveShadows:_.extras.ESRI_receiveShadows}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new J("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=Odt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return f6(this._textureCache,i,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>{throw new J("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${h}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return Idt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=ri(xe(),i,s.matrix):s.translation||s.rotation||s.scale?(r=JS(i),s.translation&&Fl(r,r,s.translation),s.rotation&&(aL[3]=ck(aL,s.rotation),bc(r,r,aL[3],aL)),s.scale&&lR(r,r,s.scale)):r=JS(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return au(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=E8.parse(this.json.asset.version,"glTF");Ldt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new J("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new J("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new $3e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new J("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new J("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new J("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return Uht(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await gV(Array.from(this._bufferLoaders.values())),r=await gV(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+((s==null?void 0:s.byteLength)??0),0)+r.reduce((i,s)=>i+(s?gM(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const Idt=K0e(xe(),Math.PI/2),Ldt=new E8(2,0,"glTF"),aL=$c(),Ddt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ndt={[Te.BYTE]:1,[Te.UNSIGNED_BYTE]:1,[Te.SHORT]:2,[Te.UNSIGNED_SHORT]:2,[Te.FLOAT]:4,[Te.INT]:4,[Te.UNSIGNED_INT]:4};function Fdt(t){switch(t.componentType){case Te.BYTE:return new Vk(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Te.UNSIGNED_BYTE:return new Fk(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Te.SHORT:return new TR(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Te.UNSIGNED_SHORT:return new BZ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Te.UNSIGNED_INT:return new VZ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Te.FLOAT:return new lx(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const kdt=/\.gltf$/i,Udt=/\.glb$/i;let zdt=0;async function V3e(t,e,r={},i=!0){var h,p;const s=await $dt.load(t,e,r),n="gltf_"+zdt++,o={lods:[],materials:new Map,textures:new Map,meta:Bdt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=(p=(h=s.json.asset.extras)==null?void 0:h.ESRI_webstyleSymbol)==null?void 0:p.webstyle,c=new Map;await Vdt(s,async(f,g,_,v)=>{var Z;const b=c.get(_)??0;c.set(_,b+1);const w=f.mode!==void 0?f.mode:sr.TRIANGLES,T=w===sr.TRIANGLES||w===sr.TRIANGLE_STRIP||w===sr.TRIANGLE_FAN?w:null;if(T==null)return void ae.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+sr[w]+"). Skipping primitive.");if(!s.hasPositions(f))return void ae.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const S=s.getPositionData(f,r),C=s.getMaterial(f,r,i),P=s.hasNormals(f)?s.getNormalData(f,r):null,R=s.hasTangents(f)?s.getTangentData(f,r):null,L=s.hasTextureCoordinates(f)?s.getTextureCoordinates(f,r):null,F=s.hasVertexColors(f)?s.getVertexColors(f,r):null,U=s.getIndexData(f,r),j={name:v,transform:JS(g),attributes:{position:await S,normal:P?await P:null,texCoord0:L?await L:null,color:F?await F:null,tangent:R?await R:null},indices:await U,primitiveType:T,material:jdt(o,await C,n)};let z=null;((Z=o.meta)==null?void 0:Z.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(z=o.meta.ESRI_lod.thresholds[_]),o.lods[_]=o.lods[_]||{parts:[],name:v,lodThreshold:z},o.lods[_].parts[b]=j});for(const f of o.lods)f.parts=f.parts.filter(g=>!!g);const u=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri,ESRI_webstyle:l},customMeta:{},size:u}}function Bdt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function Vdt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),Gdt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ae.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const h=r.meshes[c.mesh];for(const p of h.primitives)n.push(e(p,u,l,h.name))}for(const h of c.children||[])n.push(o(h,l))}await Promise.all(n)}function Gdt(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function jdt(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n!=null&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=Edt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Hdt.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=Sdt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(s,n)}return s}const Hdt=new Set([Gt.LINEAR_MIPMAP_LINEAR,Gt.LINEAR_MIPMAP_NEAREST]);function qdt(t,e){switch(e){case sr.TRIANGLES:return Wdt(t);case sr.TRIANGLE_STRIP:return Ydt(t);case sr.TRIANGLE_FAN:return Xdt(t)}}function Wdt(t){return typeof t=="number"?cx(t):o_(t)?new Uint16Array(t):t}function Ydt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=N5(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function Xdt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let Zdt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Jdt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new Zdt,this.numberOfVertices=0}};const mg=()=>ae.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function G3e(t,e){const r=await Kdt(t,e),i=await ipt(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+Ipe(r)}}async function Kdt(t,e){const r=e==null?void 0:e.streamDataRequester;if(r)return Qdt(t,r,e);const i=await xp(Wr(t,e));if(i.ok===!0)return i.value.data;Uo(i.error),j3e(i.error)}async function Qdt(t,e,r){const i=await xp(e.request(t,"json",r));if(i.ok===!0)return i.value;Uo(i.error),j3e(i.error.details.url)}function j3e(t){throw new J("",`Request for object resource failed: ${t}`)}function ept(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(mg().warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(mg().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(mg().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(mg().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else mg().warn("Indexed geometries must specify faces"),i=!1;break}default:mg().warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(mg().warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(mg().warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function tpt(t,e){var g,_;const r=new Array,i=new Array,s=new Array,n=new t1,o=t.resource,a=E8.parse(o.version||"1.0","wosr");npt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},h=t.textures;let p=0;const f=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!ept(b))continue;const w=spt(b),T=b.params.vertexAttributes,S=[],C=Y=>{if(b.params.topology==="PerAttributeArray")return null;const le=b.params.faces;for(const I in le)if(I===Y)return le[I].values;return null},P=T[O.POSITION],R=P.values.length/P.valuesPerElement;for(const Y in T){const le=T[Y],I=le.values,N=C(Y)??cx(R);S.push([Y,new qe(I,N,le.valuesPerElement,!0)])}const L=w.texture,F=h&&h[L];if(F&&!f.has(L)){const{image:Y,parameters:le}=F,I=new o1(Y,le);i.push(I),f.set(L,I)}const U=f.get(L),j=U?U.id:void 0,z=w.material;let Z=n.get(z,L);if(Z==null){const Y=u[z.substring(z.lastIndexOf("/")+1)].params;Y.transparency===1&&(Y.transparency=0);const le=F&&F.alphaChannelUsage,I=Y.transparency>0||le==="transparency"||le==="maskAndTransparency",N=F?H3e(F.alphaChannelUsage):void 0,B={ambient:la(Y.diffuse),diffuse:la(Y.diffuse),opacity:1-(Y.transparency||0),transparent:I,textureAlphaMode:N,textureAlphaCutoff:.33,textureId:j,initTextureTransparent:!0,doubleSided:!0,cullFace:Ei.None,colorMixMode:Y.externalColorMixMode||"tint",textureAlphaPremultiplied:(F==null?void 0:F.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(B,e.materialParameters),Z=new Pp(B),n.set(z,L,Z)}s.push(Z);const W=new un(Z,S);p+=((_=(g=S.find(Y=>Y[0]===O.POSITION))==null?void 0:g[1])==null?void 0:_.indices.length)??0,r.push(W)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:rpt(r)}}function rpt(t){const e=Ri();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(Ep(e,i.bbMin),Ep(e,i.bbMax))}),e}async function ipt(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){mg().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:Xt.REPEAT,t:Xt.REPEAT},preMultiplyAlpha:H3e(u)!==gi.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):d0(l,e);r.push(p.then(f=>({refId:c,image:f,parameters:h,alphaChannelUsage:u})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function H3e(t){switch(t){case"mask":return gi.Mask;case"maskAndTransparency":return gi.MaskBlend;case"none":return gi.Opaque;default:return gi.Blend}}function spt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const npt=new E8(1,2,"wosr"),r2=2.1;async function q3e(t,e){var h;const r=W3e(Fq(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):G3e(r.url,e)),{engineResources:f,referenceBoundingBox:g}=tpt(p,e);return{lods:f,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):V3e(new z3e(e.streamDataRequester),r.url,e,e.usePBR)),s=(h=i.model.meta)==null?void 0:h.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.ESRI_webstyle==="EsriRealisticTreesStyle";n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,cpt(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Ztt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...a8]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=Y3e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function W3e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function Y3e(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Ri();return s.lods.forEach((u,h)=>{const p=i.skipHighLods===!0&&(l>1&&h===0||l>3&&h===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&h!==i.singleLodIndex;if(p&&h!==0)return;const f=new Jdt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const _=p?new Pp({}):opt(s,g,f,e,r,o,a),{geometry:v,vertexCount:b}=apt(g,_??new Pp({})),w=v.boundingInfo;w!=null&&h===0&&(Ep(c,w.bbMin),Ep(c,w.bbMax)),_!=null&&(f.stageResources.geometries.push(v),f.numberOfVertices+=b)}),p||n.push(f)}),{engineResources:n,referenceBoundingBox:c}}function opt(t,e,r,i,s,n,o){var f,g;const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const h=lpt(l.alphaMode);if(!n.has(a)){if(c){const L=(F,U=!1)=>{if(F!=null&&!o.has(F)){const j=t.textures.get(F);if(j!=null){const z=j.data;o.set(F,new o1(gM(z)?z.data:z,{...j.parameters,preMultiplyAlpha:!gM(z)&&U,encoding:gM(z)&&z.encoding!=null?z.encoding:void 0}))}}};L(l.textureColor,h!==gi.Opaque),L(l.textureNormal),L(l.textureOcclusion),L(l.textureEmissive),L(l.textureMetallicRoughness)}const _=l.color[0]**(1/r2),v=l.color[1]**(1/r2),b=l.color[2]**(1/r2),w=l.emissiveFactor[0]**(1/r2),T=l.emissiveFactor[1]**(1/r2),S=l.emissiveFactor[2]**(1/r2),C=l.textureColor!=null&&c?o.get(l.textureColor):null,P=HTe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),R=((f=l.normalTextureTransform)==null?void 0:f.scale)!=null?(g=l.normalTextureTransform)==null?void 0:g.scale:Y6;n.set(a,new Pp({...i,transparent:h===gi.Blend,customDepthTest:kw.Lequal,textureAlphaMode:h,textureAlphaCutoff:l.alphaCutoff,diffuse:[_,v,b],ambient:[_,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Ei.None:Ei.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?Ir.Attribute:Ir.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:C!=null?C.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:C!=null&&!!C.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[w,T,S],mrrFactors:P?[...$J]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:P,colorTextureTransformMatrix:Gf(l.colorTextureTransform),normalTextureTransformMatrix:Gf(l.normalTextureTransform),scale:[R[0],R[1]],occlusionTextureTransformMatrix:Gf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Gf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Gf(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(r.stageResources.materials.push(p),c){const _=v=>{v!=null&&r.stageResources.textures.push(o.get(v))};_(l.textureColor),_(l.textureNormal),_(l.textureOcclusion),_(l.textureEmissive),_(l.textureMetallicRoughness)}return p}function apt(t,e){const r=t.attributes.position.count,i=qdt(t.indices||r,t.primitiveType),s=hs(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;Op(s,n,t.transform,3,o);const a=[[O.POSITION,new qe(s,i,3,!0)]];if(t.attributes.normal!=null){const l=hs(3*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.normal;a0(lL,t.transform),Rp(l,c,lL,3,u),a.push([O.NORMAL,new qe(l,i,3,!0)])}if(t.attributes.tangent!=null){const l=hs(4*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.tangent;a0(lL,t.transform),EK(l,c,lL,4,u),a.push([O.TANGENT,new qe(l,i,4,!0)])}if(t.attributes.texCoord0!=null){const l=hs(2*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.texCoord0;CK(l,c,2,u),a.push([O.UV0,new qe(l,i,2,!0)])}if(t.attributes.color!=null){const l=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof Ap?xF(l,t.attributes.color,255):t.attributes.color instanceof _a?AK(l,t.attributes.color):t.attributes.color instanceof xR&&xF(l,t.attributes.color,1/256):(l.fill(255),t.attributes.color instanceof zn?sF(l,t.attributes.color,255,4):t.attributes.color instanceof kk?VR(l,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof zk&&sF(l,t.attributes.color,1/256,4)),a.push([O.COLOR,new qe(l,i,4,!0)])}return{geometry:new un(e,a),vertexCount:r}}const lL=xi();function lpt(t){switch(t){case"BLEND":return gi.Blend;case"MASK":return gi.Mask;case"OPAQUE":case null:case void 0:return gi.Opaque}}function cpt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=E(),c=E(),u=E(),h=new Uint8Array(4*a),p=new Float64Array(3*a),f=cn(xe(),s.transform);let g=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),Ge(c,c,s.transform),ye(u,c,e.center),E4(u,u,e.radius);const b=u[2],w=Se(u),T=Math.min(.45+.55*w*w,1);E4(u,u,e.radius),f!==null&&Ge(u,u,f),fe(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&li(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],g+=3,h[_]=255*T,h[_+1]=255*T,h[_+2]=255*T,h[_+3]=255,_+=4}s.attributes.normal=new zn(p),s.attributes.color=new _a(h)}}}const v8t=Object.freeze(Object.defineProperty({__proto__:null,fetch:q3e,gltfToEngineResources:Y3e,parseUrl:W3e},Symbol.toStringTag,{value:"Module"})),upt=()=>!!se("enable-feature:force-wosr"),b8t=()=>!!se("enable-feature:direct-3d-object-feature-layer-display"),hpt=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),dpt=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),w8t=()=>!!se("enable-i3s-patching"),ppt=()=>se.add("enable-i3s-patching",!0,!0,!0),fpt=()=>se.add("enable-i3s-patching",!1,!0,!0),x8t=()=>!!se("enable-feature:SceneLayer-editing"),mpt=(t="i3s-patching")=>{switch(fpt(),dpt(),se.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":hpt();break;case"i3s-patching":ppt()}};mpt("i3s-patching");let Uz={};async function gpt(t,e){try{return{data:(await PK(t,e)).data,baseUrl:v6(t),styleUrl:t}}catch(r){return Uo(r),null}}function ypt(t,e,r){const i=e.portal!=null?e.portal:kl.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return Uz[n]||(Uz[n]=_pt(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),Uz[n]}function _pt(t,e,r){return e.load(r).then(()=>{const i=new kf({disableExtraQuery:!0,query:`owner:${jle} AND type:${Hle} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Hle&&a.owner===jle){s=a;break}}if(!s)throw new J("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function X3e(t,e,r){return(t==null?void 0:t.styleUrl)!=null?gpt(t.styleUrl,r):(t==null?void 0:t.styleName)!=null?ypt(t.styleName,e,r):Promise.reject(new J("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Z3e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function J3e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!upt())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function PK(t,e){const r={responseType:"json",query:{f:"json"},...e};return Wr(mu(t),r)}const jle="esri_en",Hle="Style",vpt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",p3={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function bpt(t,e=p3){var a,l;if(!t)return{symbol:null};const{retainId:r=p3.retainId,ignoreDrivers:i=p3.ignoreDrivers,hasLabelingContext:s=p3.hasLabelingContext,retainCIM:n=p3.retainCIM}=e;let o=null;if(Fw(t)||t instanceof rC)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new J("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():g_.fromCIMSymbol(t)}else if(t instanceof b0)o=xk.fromSimpleLineSymbol(t);else if(t instanceof eC)o=g_.fromSimpleMarkerSymbol(t);else if(t instanceof Sk)o=g_.fromPictureMarkerSymbol(t);else if(t instanceof _R)o=e.geometryType&&e.geometryType==="mesh"?Tk.fromSimpleFillSymbol(t):yR.fromSimpleFillSymbol(t);else{if(!(t instanceof tC))return{error:new J("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?wk.fromTextSymbol(t):g_.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&Fw(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function T8t(t,e,r,i){const s=K3e(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function S8t(t,e,r,i){const s=K3e(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function qle(t){return t instanceof QE||t instanceof rC}function K3e(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!qle(t)){const a=bpt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new J("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!EUe(i==null?void 0:i.layer))&&qle(t)?(o==null||o.push(new J("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function Q3e(t,e){return Ije(t,null,e)}function wpt(t,e,r,i){const s=t.name;return s==null?Promise.reject(new J("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?xpt(s,e,i):X3e(t,e,i).then(n=>OK(n,s,e,r,J3e,i))}function MK(t,e){return e.items.find(r=>r.name===t)}function OK(t,e,r,i,s,n){var f,g;const o=(r==null?void 0:r.portal)!=null?r.portal:kl.getDefault(),a={portal:o,url:$s(t.baseUrl),origin:"portal-item"},l=MK(e,t.data);if(!l){const _=`The symbol name '${e}' could not be found`;return Promise.reject(new J("symbolstyleutils:symbol-name-not-found",_,{symbolName:e}))}let c=Dw(s(l,i),a),u=((f=l.thumbnail)==null?void 0:f.href)??null;const h=(g=l.thumbnail)==null?void 0:g.imageData;hdt()&&(c=Fq(c)??"",u=Fq(u));const p={portal:o,url:$s(v6(c)),origin:"portal-item"};return PK(c,n).then(_=>{const v=i==="cimRef"?Z3e(_.data):_.data,b=Q3e(v,p);if(b&&Fw(b)){if(u){const w=Dw(u,a);b.thumbnail=new rw({url:w})}else h&&(b.thumbnail=new rw({url:`data:image/png;base64,${h}`}));t.styleUrl?b.styleOrigin=new oO({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(b.styleOrigin=new oO({portal:r.portal,styleName:t.styleName,name:e}))}return b})}function xpt(t,e,r){const i=vpt.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:kl.getDefault();return PK(i,r).then(n=>{const o=Z3e(n.data);return Q3e(o,{portal:s,url:$s(v6(i)),origin:"portal-item"})})}const Tpt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:OK,getStyleItemFromStyle:MK,resolveWebStyleSymbol:wpt},Symbol.toStringTag,{value:"Module"}));async function Spt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new J("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await X3e(t,r).catch(()=>null);if(i===null)return null;const s=MK(e,i.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await OK(i,e,r,"webRef",(l,c)=>J3e(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Ept=class{constructor(e,r,i){this._elementSize=r,this._buffer=qr.createVertex(e,Pr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},Cpt=class{constructor(e){this.modelOriginHi=e.getField(O.INSTANCEMODELORIGINHI,zn),this.modelOriginLo=e.getField(O.INSTANCEMODELORIGINLO,zn),this.model=e.getField(O.INSTANCEMODEL,K_),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,K_),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,Ap),this.color=e.getField(O.INSTANCECOLOR,_a),this.objectAndLayerIdColor=e.getField(O.INSTANCEOBJECTANDLAYERIDCOLOR,_a)}},Wle=class{constructor(e,r){this._rctx=e,this._instanceBufferLayout=r,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){ht(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){ht(this._updating,"not updating"),this.size<L$e*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){ht(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),ht(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){ht(this._updating,"not updating"),ht(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(TF,Math.floor(this._capacity*i6));this._resize(e)}_shrink(){const e=Math.max(TF,Math.floor(this._capacity*I$e));this._resize(e)}_resize(e){if(ht(this._updating,"not updating"),e===this._capacity)return;const r=new Ept(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);ht(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new Cpt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const TF=64;var Vi;function Apt(t){let e=Yi().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes(O.FEATUREATTRIBUTE)&&(e=e.vec4f(O.FEATUREATTRIBUTE)),t.includes(O.COLOR)&&(e=e.vec4u8(O.COLOR)),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e=e.u8(O.STATE).u8(O.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Vi||(Vi={}));let Yle=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,pO),this.globalTransform=e.getField(O.GLOBALTRANSFORM,pO),this.modelOrigin=e.getField(O.MODELORIGIN,Vh),this.model=e.getField(O.INSTANCEMODEL,K_),this.modelNormal=e.getField(O.INSTANCEMODELNORMAL,K_),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,lx),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,Nk),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,Ap),this.color=e.getField(O.COLOR,_a),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,_a),this.state=e.getField(O.STATE,pE),this.lodLevel=e.getField(O.LODLEVEL,pE)}},tT=class extends Me{constructor(e,r){super(e),this.events=new Gs,this._capacity=0,this._size=0,this._next=0,this._layout=Apt(r),this._capacity=TF,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Yle(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Vi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;ht(e>=0&&e<this._capacity&&(r.get(e)&Vi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Vi.ACTIVE)?this._setStateFlags(e,Vi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;ht(e>=0&&e<this._capacity&&(r.get(e)&Vi.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=ql,s=ld;r.localTransform.getMat(e,Xle),r.globalTransform.getMat(e,zz);const n=ri(zz,zz,Xle);te(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),kh(s,n),r.model.setMat(e,s);const o=p8e(ql,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),ix(s,s),Uh(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,Vi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,ld),i.modelOrigin.getVec(e,ql),r[0]=ld[0],r[1]=ld[1],r[2]=ld[2],r[3]=0,r[4]=ld[3],r[5]=ld[4],r[6]=ld[5],r[7]=0,r[8]=ld[6],r[9]=ld[7],r[10]=ld[8],r[11]=0,r[12]=ql[0],r[13]=ql[1],r[14]=ql[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ql,this,e),r*=Math.max(ql[0],ql[1],ql[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ql,this,e),r*=Ppt(ql[0],ql[1],ql[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Vi.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Vi.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Vi.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Vi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(TF,Math.floor(this._capacity*i6)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Yle(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Vi.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function Ppt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}d([m({constructOnly:!0})],tT.prototype,"shaderTransformation",void 0),d([m()],tT.prototype,"_size",void 0),d([m({readOnly:!0})],tT.prototype,"size",null),tT=d([V("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],tT);const ql=E(),ld=xi(),Xle=xe(),zz=xe();let Mpt=class extends op{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=Vs(),this._tmpMat4=xe()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Ge(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*KS(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Opt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},Rpt=class extends dR{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function RK(t){return Wh(t)&&t.intersector===ki.LOD&&!!t.target}let $pt=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new UEe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=qr.createVertex(i,Pr.STATIC_DRAW,l.buffer),this.vao=new Dp(i,Mr,{geometry:Ic(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(u,h,p,f,g)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const _=new Rpt(o.layerUid,o.graphicUid(n),c,p,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(ki.LOD,_,u,h,e.transform.transform,g),e.options.store!==Co.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(ki.LOD,_,u,h,e.transform.transform,g),e.options.store===Co.ALL){const v=$X(e.results.min.ray);v.set(ki.LOD,_,u,h,e.transform.transform,g),e.results.all.push(v)}}})}},Ipt=class eAe{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new $pt(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(kE);if(Zs(i)||n.length!==s.length){n.forEach(o=>o.destroy()),vt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new eAe(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Ri();this.components.forEach(r=>{r.boundingInfo!=null&&(Ep(e,r.boundingInfo.bbMin),Ep(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=E();ip(e,r),this._boundingSphere={center:r,radius:.5*Cve(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const Lpt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new Opt(e,r)};let Ku=class extends BXe{constructor(e,r){super(e),this.type=ki.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Je,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[ue.OPAQUE_MATERIAL,i=>this._produces(i)],[ue.TRANSPARENT_MATERIAL,i=>!!this._hasTransparentLevels()&&this._produces(i)]]),this._instanceData=new tT({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(r.registerTask(yt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=Npt(this.optionalFields),this._glInstanceBufferLayout=Ic(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,r)=>r.reduce((i,s)=>i+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Wle(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Wle(i,this._instanceBufferLayout)),Ipt.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(kE);if(Zs(r)||n.length!==s.length){n.forEach(o=>o.destroy()),vt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Lpt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(r=>{const i=r.material.produces.get(ue.TRANSPARENT_MATERIAL);return i&&i(k.Color)}))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==k.Highlight&&e!==k.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!yi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Wa),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}renderNode(e,r){const i=this._getInstanceDatas(e.output);if(!i||r==null)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==k.Highlight&&e!==k.ShadowHighlight,i=e!==k.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=E();ye(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Kle),e.transform.set(Kle),Ge(Qle,i,e.transform.inverse),Ge(ece,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;ht((l&Vi.ACTIVE)!=0,"invalid instance state"),ht(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,Qle,ece,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new Mpt(r,this.baseBoundingSphere);for(let s=0;s<r.capacity;++s)i.get(s)&Vi.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Ae(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,op.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,op.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,tf),ye(tf,tf,n);const a=de(tf,r)-tf[3];o.boundingSphere.getVec(s,tf),ye(tf,tf,n);const l=de(tf,r)+tf[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Vi.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(p&Vi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),p&Vi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),p&Vi.REMOVE)n.freeInstance(c);else if(p&Vi.VISIBLE){let _=0;r&&(o.modelOrigin.getVec(c,Jle),_=s.selectLevel(Jle,n.getCombinedMedianScaleFactor(c),i)),f=p&~(Vi.ACTIVE|Vi.TRANSFORM_CHANGED),_>=0&&(p&Vi.HIGHLIGHT?(Zle(this._highlightRenderInstanceData[0][_],o,c),f|=Vi.HIGHLIGHT_ACTIVE):(Zle(this._defaultRenderInstanceData[0][_],o,c),f|=Vi.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,_)}else f=p&~(Vi.ACTIVE|Vi.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const _=!!(p&Vi.ACTIVE),v=!!(f&Vi.ACTIVE);!_&&v?this._octreeCached.addInstance(c):_&&!v?this._octreeCached.removeInstance(c):_&&v&&p&Vi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){if(r.size===0)return null;const s=i.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,r,i,s,n){if(!r)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(r,o,s.material.parameters,Fpt);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),yi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===k.Color&&(l.setUniform4fv("externalColor",tce[Math.min(n,tce.length-1)]),l.setUniform1i("colorMixMode",W2e.replace));const c=i.capacity,u=i.headIndex,h=i.tailIndex,p=i.firstIndex,f=this._glInstanceBufferLayout,g=(_,v)=>{vZ(a,Mr,i.buffer,f,_),a.drawArraysInstanced(r.primitiveType,0,s.vertexCount,v-_),swe(a,Mr,i.buffer,f)};s.material.parameters.transparent&&p!=null?u>h?(ht(p>=h&&p<=u,"invalid firstIndex"),g(p,u),g(h,p)):u<h&&(p<=u?(ht(p>=0&&p<=u,"invalid firstIndex"),g(p,u),g(h,c),g(0,p)):(ht(p>=h&&p<=c,"invalid firstIndex"),g(p,c),g(0,u),g(h,p))):u>h?g(h,u):u<h&&(g(0,u),g(h,c)),a.bindVAO(null)}};function Zle(t,e,r){const i=t.allocateHead();Dpt(e,r,t.view,i)}function Dpt(t,e,r,i){QYe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function Npt(t){let e=Yi().vec3f(O.INSTANCEMODELORIGINHI).vec3f(O.INSTANCEMODELORIGINLO).mat3f(O.INSTANCEMODEL).mat3f(O.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(O.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([m({constructOnly:!0})],Ku.prototype,"symbol",void 0),d([m({constructOnly:!0})],Ku.prototype,"optionalFields",void 0),d([m({constructOnly:!0})],Ku.prototype,"metadata",void 0),d([m({constructOnly:!0})],Ku.prototype,"shaderTransformation",void 0),d([m()],Ku.prototype,"_instanceData",void 0),d([m()],Ku.prototype,"_cycleStartIndex",void 0),d([m({readOnly:!0})],Ku.prototype,"_enableLevelSelection",null),d([m()],Ku.prototype,"_updateCyclesWithStaticCamera",void 0),d([m({readOnly:!0})],Ku.prototype,"running",null),Ku=d([V("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Ku);const Jle=E(),tf=Yt(),Kle=xe(),Qle=E(),ece=E(),tce=[zt(1,0,1,1),zt(0,0,1,1),zt(0,1,0,1),zt(1,1,0,1),zt(1,0,0,1)],Fpt=new Srt;let rce=class{constructor(e,r,i,s,n,o,a,l,c,u,h,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=h,this.pivotOffset=p}},kpt=class extends Nm{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&n8(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&Ntt(r.primitive)?r.primitive:Nve;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Spt(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,r=(s=>(s=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(r),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?Ei.None:Ei.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=Mn(pje(e)),n=la(H$(s)),o=la($U(n,i)),a=Se(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...$J],ambient:kg,diffuse:kg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:w,minWorldLength:T,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:on(w),minWorldLength:T||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=yh;else{const w=i.material!=null?i.material.color:null,T=w!=null?Fe.toUnitRGBA(w):yh;u.externalColor=T}this._fastUpdates=gE(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const f=new Pp(u),g=NTe(e,f);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const _=$I(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,h,r),b=await this._createLodRenderer(g,r);return new rce(g,b,v,_,n,l,c,s,o,a,h,null)}async _createResourcesForUrl(e,r){var U,j;const i={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=gE(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParameters.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:z,minWorldLength:Z,maxWorldLength:W}=s.verticalOffset;i.materialParameters.verticalOffset={screenLength:on(z),minWorldLength:Z||0,maxWorldLength:W??1/0},i.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;i.signal=r,i.usePBR=n,i.skipHighLods=this._context.skipHighSymbolLods;const o=await q3e(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=ldt(o.lods),u=this._context,h=this.symbolLayer.material,p=this._getExternalColorParameters(h),f=(j=(U=this.symbolLayer)==null?void 0:U.material)==null?void 0:j.color,g=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=$I(c),b=$I(c).map(z=>({opacity:z.parameters.opacity||1,transparent:z.parameters.transparent}));v.forEach(z=>{const Z=z.parameters;z.setParameters(p);const W=Z.opacity*g,Y=W<1||_||Z.transparent;z.setParameters({opacity:W,transparent:Y}),u.screenSizePerspectiveEnabled&&z.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,T=la(H$(w)),S=la(c.levels[0].pivotOffset),C=la($U(T,this.symbolLayer)),P=Se(C),R=this._fastUpdates;yE(R,this._context.renderer,this._fastVisualVariableConvertOptions(w,C,T,S))&&v.forEach(z=>z.setParameters(R.materialParameters));const L=await this._createStageResources(c,n,r),F=await this._createLodRenderer(c,r);return new rce(c,F,L,b,T,a,l,w,C,P,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=$I(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Qne(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),i))),vt(i);const a=eoe(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,cL),Bs(u,qQe(n.materialParameters,cL,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,cL),fJ(l,n.materialParameters,cL)}}:null,a=new Ku({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=yh:(e==null?void 0:e.color)!=null?r.externalColor=Fe.toUnitRGBA(e.color):(r.externalColor=yh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=TO(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,u=s[a],h=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,p=h<1||e||u.transparent;l.setParameters({opacity:h,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?Ei.None:Ei.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,i1)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return zs.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!yE(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return zs.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return zs.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=ySe(e.levels),i=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+t0(c.data,c.indices),0),s=eoe(e).reduce((a,l)=>a+i(l),0),n=Qne(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...gSe(this.symbol,this.symbolLayer),resourceBytes:n};return new lh({verticesPerFeature:r,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Qa(r,i2,this._context.elevationProvider.spatialReference),l!=null&&!rZ(l,i2))return null;const c=this._requiresTerrainElevation(s),u=this._computeGlobalTransform(r,s,Bz,uL),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,ice),p=this._resources.lodRenderer.instanceData,f=p.addInstance();this._instanceIndexToGraphicUid.set(f,n),p.setLocalTransform(f,h,!1),p.setGlobalTransform(f,u),a&&p.setFeatureAttribute(f,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(f,sM(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(f,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new ndt(this,f,vtt,s);return c&&(g.alignedSampledElevation=uL.sampledElevation),g.needsElevationUpdates=i1(s.mode),xO(g,r,this._context.elevationProvider),g}_computeGlobalTransform(e,r,i,s){return r1(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),i2[0]=e.x,i2[1]=e.y,i2[2]=s.z,$l(e.spatialReference,i2,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return Nh(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=Jne(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||lR(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&TO(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,Bz,uL),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=uL.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Bz,!0),xO(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(g,_,v)=>(g!=null&&g.type==="complete"?g.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),h=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:h},f=this._resources;this.loadStatus===nu.LOADED&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=la($U(f.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,_)=>{const v=this._computeLocalTransform(f,p,_,ice),b=g.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?Fe.toUnitRGBA(s):yh;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!r)return Itt(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=E();switch(i.anchor){case"center":ce(s,ip(e)),Eo(s,s);break;case"top":{const n=ip(e);te(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=ip(e);te(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=ip(e),o=H$(e),a=i.anchorPosition,l=a?Pe(a.x,a.y,a.z):Cn;y6(s,o,l),pe(s,s,n),Eo(s,s);break}default:r!=null?Eo(s,r):ce(s,Cn)}return s}_applyAnchor(e,r,i){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Fl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?la(H$(e)):kg,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):Cn,a=this._context.renderCoordsHelper.unitInMeters,l=Jne(r??void 0,r,i,a),c=Pe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new AR({size:!0,color:!0,rotation:!0,opacity:!1},n,r??kg,a,o,l,c)}};const i2=E(),ice=xe(),Bz=xe(),cL=Yt(),uL=new RR;let Upt=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Pe(l,c,u),this.positions=hs(3*n);const h=this.offset+3*n;for(let p=this.offset;p<h;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return t0(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Se(r.vRight);r.vMinSiblingLength=n,fe(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Se(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,fe(l.vRight,l.vRight)}else ce(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},zpt=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=HYe(1*this.numVerticesTotal),this.profileRightAxes=hs(4*this.numVerticesTotal),this.profileUpAxes=hs(4*this.numVerticesTotal),this.profileVertexAndNormals=hs(4*this.numVerticesTotal),this.positions=D5(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return t0(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=D5(e,r,3*i.length);let s=0;const n=(a,l,c,u,h)=>this.emitCapVertex(s,a,l,c,u,h),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,h)=>{n.push(c),n.push(u),n.push(h),o.push(c),o.push(u),o.push(h),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[h])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],h=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const f=p*e+u,g=(p+1)*e+h,_=p*e+h;l(f,(p+1)*e+u,g),l(f,g,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=lm(n),this.normalIndices=lm(o),this.pathVertexIndices=lm(a)}onPathChanged(){this._rebuildGeometry()}},$K=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},sce=class extends $K{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},hL=class extends $K{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=tAe;cr(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},nce=class extends $K{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=Bpt,a=tAe;cr(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),h=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const f=i.poles[i.poleIndices[p]];Uf(o,i.vertices[p],f.position),_c(o,o,u),f.normal?(Ud(o,o,f.position),r(s,o,f.normal,n*h,0)):(hO(a,o),_c(a,a,u),Ud(o,o,f.position),r(s,o,a,n*h,this.sign*h))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let h=s+a,p=s+l;for(let f=0;f<this.numSegments-1;++f){const g=n+f*i.vertices.length+a,_=n+f*i.vertices.length+l;this.flip?(r(g,p,h),r(p,g,_)):(r(h,p,g),r(_,g,p)),h=g,p=_}this.flip?(r(c,p,h),c!==u&&r(c,u,p)):(r(h,p,c),c!==u&&r(p,u,c))}}};const Bpt=je(),tAe=je();let Vpt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},Vz=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=jpt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Su(ace,.5*-n+c*n/this.numBendSubdivisions,l),Gpt(s,a,ace);for(let u=0;u<r.vertices.length;++u)vn(r.vertices[u],o)*n>=0?i(s,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(oce,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=vn(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(oce,r.vertices[c]),r.normals[c],!u)}}},rAe=class{constructor(){this.up=E(),this.right=E()}};function Gpt(t,e,r){Ge(t.up,e.up,r),Ge(t.right,e.right,r)}const oce=je(),ace=xe(),jpt=new rAe;let Hpt=class extends un{constructor(e,r,i,s,n,o){super(e,r,null,vs.Mesh,o),this.path=i,this.geometrySR=s,this.stencilWidth=n}};var cm;function iAe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(cm||(cm={}));let sAe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},nAe=class extends sAe{constructor(e){super(e),this.vertexAttributeColor=zt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=hs(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const h=u===0||u===s.vertices.length-1;u*=3;const p=Zpt;let f=0,g=0;const _=4*c,v=te(Jpt,o[_],o[_+1],o[_+2]),b=te(Kpt,a[_],a[_+1],a[_+2]),w=cr(lce,l[_]*e[0],l[_+1]*e[1]);if(h)Ze(p,b,v),f=o[_+3]*e[0],g=a[_+3];else{const P=Wpt,R=Ypt;cr(P,o[_+3],a[_+3]);const L=fZ(P);hO(P,P);const F=vn(w,P);if(Math.abs(F)>L){cr(R,-P[1],P[0]);const U=vn(w,R);_c(P,P,L*Math.sign(F)),_c(R,R,U),Ud(w,P,R)}te(p,0,0,0)}const T=te(Xpt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=n[u]+T[0]+p[0]*f,this.vertexAttributePosition[S+1]=n[u+1]+T[1]+p[1]*f,this.vertexAttributePosition[S+2]=n[u+2]+T[2]+p[2]*f;const C=cr(lce,l[_+2],l[_+3]);$p(this.vertexAttributeNormal,c,v[0]*C[0]+b[0]*C[1]+p[0]*g,v[1]*C[0]+b[1]*C[1]+p[1]*g,v[2]*C[0]+b[2]*C[1]+p[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:r,vertexIndices:i}=this.builder;return[[O.POSITION,new qe(this.vertexAttributePosition,i,3,!0)],[O.NORMALCOMPRESSED,new qe(this.vertexAttributeNormal,r,2,!0)],[O.COLOR,new qe(this.vertexAttributeColor,v1(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new JE(this.vertexAttributePosition,3),o=s.length/3;PR(e,r,0,o,s,n,void 0,void 0,i)}},qpt=class extends sAe{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new nAe(e),this.vvData=hs(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:r,profileUpAxes:i,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[O.POSITION,new qe(e,n,3,!0)],[O.PROFILERIGHT,new qe(r,o,4,!0)],[O.PROFILEUP,new qe(i,o,4,!0)],[O.PROFILEVERTEXANDNORMAL,new qe(s,o,4,!0)],[O.FEATUREVALUE,new qe(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(O.POSITION);r&&(r.data=this.builder.positions)}};const lce=je(),Wpt=je(),Ypt=je(),Xpt=E(),Zpt=E(),Jpt=E(),Kpt=E();function Qpt(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=E(),o=E(),a=E(),l=E(),c=E(),u=E(),h=zr();let p=t.vertices[0];ce(o,e),te(n,0,1,0),k5(p.vRight,o,n,n,a,o,s),ce(p.frame.up,o),ce(p.frame.right,a);const f=t.positions;let g=t.offset;r=p;for(let _=1;_<i;++_){p=t.vertices[_],pe(c,p.vLeft,p.vRight);let v=Se(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=f[g]+r.frame.up[0],u[1]=f[g+1]+r.frame.up[1],u[2]=f[g+2]+r.frame.up[2],g+=3;const b=te(eft,f[g],f[g+1],f[g+2]);hR(b,c,h),ex(h,Eu(u,p.vLeft),l)?(l[0]-=f[g],l[1]-=f[g+1],l[2]-=f[g+2],fe(o,l),Ze(a,c,o),fe(a,a)):k5(c,r.frame.up,r.frame.right,n,a,o,s),ce(p.frame.up,o),ce(p.frame.right,a),r=p}}const eft=E();let oAe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(D3(e)),this.normals.push(D3(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:D3(e),normal:r?D3(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}get usedMemory(){return this.vertices.length*t0(this.vertices[0])*2+t0(this.indices)}};const aAe={top:[0,-.5],bottom:[0,.5]};function Gz(t){const r=$Te,i=new oAe,s={v0:0,v1:0};i.addPole(ar(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=ar(l*.5,c*.5),h=ar(l,c);i.addVertex(u,h)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=aAe[t];i.translate(o[0],o[1])}return i}const tft={center:Gz("center"),top:Gz("top"),bottom:Gz("bottom")},rft={center:jz("center"),top:jz("top"),bottom:jz("bottom")};function jz(t){const i=new oAe,s=ar(.5*-1,.5*-1),n=ar(.5*1,.5*-1),o=ar(.5*1,.5*1),a=ar(.5*-1,.5*1),l=ar(0,-1),c=ar(1,0),u=ar(0,1),h=ar(-1,0);if(i.addPole(ar(0,.5*1),u),i.addPole(ar(0,.5*1)),i.addPole(ar(0,.5*-1)),i.addPole(ar(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,h),i.addVertex(s,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=aAe[t];i.translate(p[0],p[1])}return i}function ift(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function sft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function lAe(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function nft(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function oft(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function aft(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function lft(t){return t[0]*t[3]-t[2]*t[1]}function cAe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*u,t[3]=s*c+o*u,t}function cft(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function uft(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function hft(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function dft(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function pft(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function fft(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function mft(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function gft(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function uAe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function yft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _ft(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=wa();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function vft(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function bft(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const wft=cAe,xft=uAe;Object.freeze(Object.defineProperty({__proto__:null,LDU:mft,add:gft,adjoint:aft,copy:ift,determinant:lft,equals:_ft,exactEquals:yft,frob:fft,fromRotation:hft,fromScaling:dft,identity:sft,invert:oft,mul:wft,multiply:cAe,multiplyScalar:vft,multiplyScalarAndAdd:bft,rotate:cft,scale:uft,set:lAe,str:pft,sub:xft,subtract:uAe,transpose:nft},Symbol.toStringTag,{value:"Module"}));function hAe(){return[1,0,0,1]}function Tft(t){return[t[0],t[1],t[2],t[3]]}function Sft(t,e,r,i){return[t,e,r,i]}function Eft(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Tft,create:hAe,createView:Eft,fromValues:Sft},Symbol.toStringTag,{value:"Module"}));let dAe=class{constructor(){this.vLeft=E(),this.vRight=E(),this.vMinSiblingLength=0,this.frame=new rAe}setFrameFromUpVector(e){ce(this.frame.up,e),pe(m3,this.vLeft,this.vRight),fe(m3,m3),re(hce,this.frame.up,de(m3,this.frame.up)),ye(dL,m3,hce),fe(dL,dL),Ze(this.frame.right,dL,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},Cft=class extends dAe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return fye}get rotationAngle(){return re(ly,this.frame.up,de(this.frame.up,this.vLeft)),ye(ly,this.vLeft,ly),Eo(ly,ly),fe(ly,ly),re(n2,this.frame.up,de(this.frame.up,this.vRight)),ye(n2,this.vRight,n2),fe(n2,n2),Ze(SF,this.rotationFrameUp,this.vLeft),Math.sign(de(SF,this.vRight))*(Math.PI-Bn(de(ly,n2)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=RV(Math.cos(.5*i));return cr(e,(s-1+1)*r[0],r[1])}},Aft=class extends dAe{get rotationFrameUp(){const e=Math.sign(de(this.frame.right,this.vRight));return Ze(f3,this.vRight,this.vLeft),re(f3,f3,e),fe(f3,f3)}get rotationRight(){const e=this.rotationFrameUp,r=de(e,this.frame.up),i=de(e,this.frame.right);return re(s2,this.frame.up,-i),re(uce,this.frame.right,r),pe(s2,s2,uce),fe(s2,s2),Pft(cce,this.frame,s2),cce}get rotationAngle(){const e=Math.sign(de(this.frame.right,this.vRight));return Eo(SF,this.vLeft),-e*(Math.PI-Bn(de(SF,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*RV(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=RV(Math.cos(.5*i)),n=this.rotationRight,o=lAe(Oft,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return Nbe(e,r,o)}};function Pft(t,e,r){cr(t,de(r,e.right),de(r,e.up))}function Mft(t){switch(t){case cm.World:return new Cft;case cm.Path:return new Aft}}const f3=E(),cce=je(),s2=E(),uce=E(),SF=E(),ly=E(),n2=E(),hce=E(),m3=E(),dL=E(),Oft=hAe(),Hz=8;function Rft(t,e){const r=O.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(x`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new ni("size",s=>s.size)),e.vvSize?(i.uniforms.add(new Dt("vvSizeMinSize",s=>s.vvSize.minSize),new Dt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Dt("vvSizeOffset",s=>s.vvSize.offset),new Dt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(x`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(x`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",Hz),i.uniforms.add(new Al("vvOpacityValues",s=>s.vvOpacity.values,Hz),new Al("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,Hz)),i.code.add(x`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",yS),i.uniforms.add(new Al("vvColorValues",s=>s.vvColor.values,yS),new aTe("vvColorColors",s=>s.vvColor.colors,yS)),i.code.add(x`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(wR),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let $ft=class extends MR{constructor(){super(...arguments),this.size=ar(1,1)}};function RO(t,e){e.spherical?t.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function pAe(t){const e=new Or,{vertex:r,fragment:i}=e;switch(Sc(r,t),e.varyings.add("vpos","vec3"),e.include(Rft,t),t.output!==k.Color&&t.output!==k.Alpha||(e.include(Ol,t),e.include(bE,t),e.include(nC,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===k.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Oc,t),t.output){case k.Alpha:e.include(Rs,t),i.uniforms.add(new Ie("opacity",s=>s.opacity)),i.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case k.Color:e.include(Rs,t),e.include(Gw,t),e.include(IR,t),e.include(bE,t),e.include(UTe,t),Cp(i,t),LR(i),hC(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Dt("ambient",s=>s.ambient),new Dt("diffuse",s=>s.diffuse),new Dt("specular",s=>s.specular),new Ie("opacity",s=>s.opacity)),i.include(Lm),Om(i),i.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case k.LinearDepth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:e.include(Ol,t),zw(e),e.varyings.add("depth","float"),r.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Rs,t),e.include(h0,t),i.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case k.Normal:e.include(Ol,t),e.include(RO,t),dE(r),e.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Rs,t),i.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case k.Highlight:e.include(Ol,t),e.include(RO,t),e.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Rs,t),e.include(w1,t),i.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const Ift=Object.freeze(Object.defineProperty({__proto__:null,build:pAe},Symbol.toStringTag,{value:"Module"})),fAe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);let Lft=class extends $ft{constructor(){super(...arguments),this.ambient=Pe(.2,.2,.2),this.diffuse=Pe(.8,.8,.8),this.specular=Pe(0,0,0),this.opacity=1,this.origin=E(),this.modelTransformation=null}},mAe=class gAe extends Gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Dr(e.rctx,gAe.shader.get().build(this.configuration),fAe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===dt.NONE,s=e===dt.FrontFace;return Nt({blending:r.output!==k.Color&&r.output!==k.Alpha||!r.transparent?null:i?wu:A0(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==ds.None?qbe:null,depthTest:{func:x1(e)},depthWrite:i||s?Mc:null,colorWrite:qt,stencilWrite:r.hasOccludees?Sm:null,stencilTest:r.hasOccludees?T1:null,polygonOffset:i||s?null:r8})}};mAe.shader=new Lr(Ift,()=>me(()=>Promise.resolve().then(()=>vAt),void 0));let fn=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.doubleSidedMode=ds.None,this.transparencyPassType=dt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};d([G({count:k.COUNT})],fn.prototype,"output",void 0),d([G({count:ds.COUNT})],fn.prototype,"doubleSidedMode",void 0),d([G({count:dt.COUNT})],fn.prototype,"transparencyPassType",void 0),d([G()],fn.prototype,"spherical",void 0),d([G()],fn.prototype,"receiveShadows",void 0),d([G()],fn.prototype,"receiveAmbientOcclusion",void 0),d([G()],fn.prototype,"vvSize",void 0),d([G()],fn.prototype,"vvColor",void 0),d([G()],fn.prototype,"vvOpacity",void 0),d([G()],fn.prototype,"hasSlicePlane",void 0),d([G()],fn.prototype,"transparent",void 0),d([G()],fn.prototype,"hasOccludees",void 0),d([G()],fn.prototype,"multipassEnabled",void 0),d([G()],fn.prototype,"cullAboveGround",void 0),d([G()],fn.prototype,"doublePrecisionRequiresObfuscation",void 0),d([G({constValue:!1})],fn.prototype,"occlusionPass",void 0),d([G({constValue:nt.Disabled})],fn.prototype,"pbrMode",void 0),d([G({constValue:!0})],fn.prototype,"hasVvInstancing",void 0),d([G({constValue:!1})],fn.prototype,"useCustomDTRExponentForWater",void 0),d([G({constValue:!1})],fn.prototype,"useFillLights",void 0),d([G({constValue:!1})],fn.prototype,"hasColorTexture",void 0);let Dft=class yAe extends b1{constructor(e){super(e,new Fft),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>(this.parameters.castShadows&&cS(r)||JP(r))&&!this.parameters.transparent],[ue.TRANSPARENT_MATERIAL,r=>(this.parameters.castShadows&&cS(r)||JP(r))&&this.parameters.transparent]]),this._vertexAttributeLocations=fAe,this._configuration=new fn,this._vertexBufferLayout=yAe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==k.Color&&e!==k.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ds.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ds.WindingOrder:ds.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=r.ssao!=null),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==k.Shadow&&e!==k.ShadowExcludeHighlight&&e!==k.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!iAe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:b,minSize:w,maxSize:T}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=we(v[0]+S*b[0],w[0],T[0]),c[1]*=we(v[2]+S*b[2],w[2],T[2])}const u=Math.max(c[0],c[1]),h=e.boundingInfo;if(h==null)return void this._intersectTriangles(l,c,s,n,o);const p=Nw(h.bbMin[0]-u,h.bbMin[1]-u,h.bbMin[2]-u,h.bbMax[0]+u,h.bbMax[1]+u,h.bbMax[2]+u),f=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],g=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),_=[g/f[0],g/f[1],g/f[2]];yJ(p,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new uC(this._vertexBufferLayout)}createGLMaterial(e){return new Nft(e)}static getVertexBufferLayout(){return Yi().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE)}},Nft=class extends _1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(mAe,e)}},Fft=class extends Lft{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const kft=["polyline"];let Uft=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=ar(1,1),this._upVectorAlignment=cm.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var p,f,g,_,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new AR({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((f=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:f.length)>0?gE(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?cm.World:cm.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=tft[i];break;case"quad":this._profile=rft[i]}switch(this.symbolLayer.join){case"round":this._extruder=new Vz(0,RTe);break;case"bevel":this._extruder=new Vz(0,1);break;case"miter":this._extruder=new Vz(.8*Math.PI,1);break;default:this._extruder=new Vpt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new sce,this._endCap=new sce;break;case"butt":default:this._startCap=new hL(this._profile,0),this._endCap=new hL(this._profile,0,!0);break;case"square":this._startCap=new hL(this._profile,-.5),this._endCap=new hL(this._profile,.5,!0);break;case"round":{const b=s==="quad";this._startCap=new nce({profile:this._profile,flip:!1,breakNormals:b,subdivisions:iq}),this._endCap=new nce({profile:this._profile,flip:!0,breakNormals:b,subdivisions:iq});break}}const o=(_=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=la(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?Ei.None:Ei.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(cr(this._intrinsicSize,e,r),!rq(this._intrinsicSize[0])||!rq(this._intrinsicSize[1])))throw new J("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||_c(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const b={...h,...this._fastUpdates.materialParameters,size:cye(this._intrinsicSize)};this._materials[0]=new Dft(b)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=Ir.Compressed,this._materials[0]=new Pp(h);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,kft,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){var s,n,o;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,i1)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){var i;for(const s in e.diff){if(s!=="visualVariables"||!yE(this._fastUpdates,r,this._vvConvertOptions))return zs.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return zs.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of i)r+=h.length;const l=ao(3*r);let c,u=0;for(const h of i){s.push({offset:u,numVertices:h.length});for(const p of h)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||n.equals(o)||Wi(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=yxe(l):(c=ao(3*r),Wi(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){var g,_,v;this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=Mn(),u=this._context.renderCoordsHelper,h=new LX(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const T=b.offset;if(this._context.clippingExtent!=null&&(Ri(c),pu(c,o.vertexDataES,T,w),!sp(c,this._context.clippingExtent)))continue;const S=new Array,C=T+3*w;for(let z=T;z<C;z+=3){h.offset=z;const Z=ctt(h,this._context.elevationProvider,i,u);te(Ps,o.vertexDataRS[z],o.vertexDataRS[z+1],o.vertexDataRS[z+2]),u.setAltitude(Ps,Z),o.vertexDataRS[z]=Ps[0],o.vertexDataRS[z+1]=Ps[1],o.vertexDataRS[z+2]=Ps[2],S.push(Mft(this._upVectorAlignment))}const P=new Upt(S,o.vertexDataES,o.vertexDataRS,T);_Ae(P,this._upVectorAlignment,this._context.renderCoordsHelper);const R=new zpt(P,this._profile,this._extruder,this._startCap,this._endCap);let L=null;if(this._fastUpdates){const z=this._fastUpdates.visualVariables,Z=gp((g=z.size)==null?void 0:g.field,e)??0,W=gp((_=z.color)==null?void 0:_.field,e)??0,Y=gp((v=z.opacity)==null?void 0:v.field,e)??0;L=new qpt(R,Z,W,Y)}else{const z=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Y=r.size;z[0]*=dce(Y[0],Y[2]==="symbol-value"?this.symbolLayer.height||0:Y[2],this.symbolLayer.width||0),z[1]*=dce(Y[2],Y[0]==="symbol-value"?this.symbolLayer.width||0:Y[0],this.symbolLayer.height||0)}let Z;this._drivenProperties.color&&(Z=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(Z=Z?[Z[0],Z[1],Z[2],r.opacity]:[1,1,1,r.opacity]);const W=new nAe(R);W.bake(z),Z&&W.bakeVertexColors(Z),L=W}const F=L.createGeometryData(),U=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),j=new Hpt(this._materials[0],F,L,l,this._stencilWidth,U);j.transformation=Fl(xe(),ts,R.path.origin),a.push(j),this.usedMemory+=R.usedMemory}if(a.length===0)return null;const p=new P0({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),f=new Dm(this,p,a,null,null,(b,w,T,S,C)=>Bft(b,w,S,C,this._upVectorAlignment),i);return f.alignedSampledElevation=0,f.needsElevationUpdates=i1(i.mode),f}};function _Ae(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case cm.World:for(const o of t.vertices)Ps[0]=s[n++]+i[0],Ps[1]=s[n++]+i[1],Ps[2]=s[n++]+i[2],r.worldUpAtPosition(Ps,Ps),o.setFrameFromUpVector(Ps);break;case cm.Path:Ps[0]=s[n]+i[0],Ps[1]=s[n+1]+i[1],Ps[2]=s[n+2]+i[2],r.worldUpAtPosition(Ps,Ps),Qpt(t,Ps)}}function dce(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function zft(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)te(Ps,l[u],l[u+1],l[u+2]),r(Ps,qz),s+=qz.sampledElevation,Ps[0]=a[u]+n[0],Ps[1]=a[u+1]+n[1],Ps[2]=a[u+2]+n[2],i.setAltitude(Ps,qz.z),a[u]=Ps[0]-n[0],a[u+1]=Ps[1]-n[1],a[u+2]=Ps[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function Bft(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!iAe(l))continue;const c=l.path,u=c.builder.path;a+=zft(u,e,r,i),s!==cm.World&&_Ae(u,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,O.POSITION)}return a/o.length}const Ps=E(),qz=new RR;function Vft(t,e,r,i,s=1){if(r.isGeographic&&i===Ne.Global){const c=ao(e.length),u=e.length,h=Vr(r);for(let p=0;p<u;p+=3)XY(e,p,c,p,h);e=c}cr(wn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)wn[0]=Math.min(wn[0],e[c]),wn[1]=Math.min(wn[1],e[c+1]);const n=wn[0]%s,o=wn[1]%s,a=wn[0]-n,l=wn[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function vAe(t,e,r,i,s=1){te(iv,1,0,0),te(sv,0,1,0),te(a2,0,0,1),jft(Wz,r),y8e(pce,r)&&Gft(pce,iv,sv,a2,i,Wz),cr(wn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),cr(nv,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){te(o2,r[u],r[u+1],r[u+2]);const h=de(iv,o2),p=de(sv,o2);wn[0]=Math.min(wn[0],h),wn[1]=Math.min(wn[1],p),nv[0]=Math.max(nv[0],h),nv[1]=Math.max(nv[1],p)}const n=de(a2,Wz);Xz(cy,wn[0],wn[1],n,iv,sv,a2),Xz(ov,nv[0],wn[1],n,iv,sv,a2),Xz(av,wn[0],nv[1],n,iv,sv,a2),ye(ov,ov,cy),re(ov,ov,.5),ye(av,av,cy),re(av,av,.5),pe(cy,cy,ov),pe(cy,cy,av);const o=wn[0]%s,a=wn[1]%s,l=wn[0]-o,c=wn[1]-a;for(let u=0;u<r.length;u+=3){te(o2,r[u],r[u+1],r[u+2]);const h=u/3,p=4*h;t[p]=(de(iv,o2)-l)/s,t[p+1]=(de(sv,o2)-c)/s,t[p+2]=l/s,t[p+3]=c/s;const f=9*h;for(let g=0;g<3;g++)e[f+g]=cy[g],e[f+g+3]=ov[g],e[f+g+6]=av[g]}}const Wz=E(),o2=E(),pce=zr(),iv=E(),sv=E(),a2=E(),wn=je(),nv=je(),cy=E(),ov=E(),av=E();function Gft(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,rf),te(pL,rf[0],rf[1],rf[2]),te(fL,rf[4],rf[5],rf[6]),te(Yz,rf[8],rf[9],rf[10])):(te(pL,1,0,0),te(fL,0,1,0),te(Yz,0,0,1));const o=t;de(o,Yz)<0&&re(o,o,-1),ce(i,o);const a=de(o,fL),l=de(o,pL);Math.abs(a)>Math.abs(l)?(kn(e,pL,o,-l),fe(e,e),Ze(r,e,o),fe(r,r),re(r,r,-1)):(kn(r,fL,o,-a),fe(r,r),Ze(e,r,o),fe(e,e))}const rf=xe(),pL=E(),fL=E(),Yz=E();function jft(t,e){te(g3,0,0,0);for(let r=0;r<e.length-3;r+=3)g3[0]+=e[r],g3[1]+=e[r+1],g3[2]+=e[r+2];re(t,g3,1/(e.length/3-1))}const g3=E();function Xz(t,e,r,i,s,n,o){te(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}let IK=class extends b1{intersect(e,r,i,s,n,o){return B2e(e,i,s,n,void 0,o)}};function bAe(t){const e=new Or,{vertex:r,fragment:i,attributes:s,varyings:n}=e;Sc(r,t),e.include(Ol,t),e.include(px,t),e.include(Yg,t),e.include(lC,t),s.add(O.POSITION,"vec3"),t.vvColor&&s.add(O.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&(t.output===k.Color||t.output===k.Alpha);o&&n.add("depth","float"),r.uniforms.add(new wr("eColor",c=>c.color));const a=t.output===k.LinearDepth;a&&(e.include(h0,t),zw(e),J_(e)),r.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Rs,t),o&&e.include(Oc,t),i.include(Lm);const l=t.output===k.Highlight;return l&&e.include(w1,t),i.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===k.ObjectAndLayerIdColor?x`fColor.a = 1.0;`:""}

    if (fColor.a < ${x.float(xo)}) {
      discard;
    }

    ${t.output===k.Alpha?x`fragColor = vec4(fColor.a);`:""}

    ${t.output===k.Color?x`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?x`outputHighlight();`:""};
    ${t.output===k.LinearDepth?x`outputDepth(linearDepth);`:""};
    ${t.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Hft=Object.freeze(Object.defineProperty({__proto__:null,build:bAe},Symbol.toStringTag,{value:"Module"}));let wAe=class xAe extends Gr{initializeProgram(e){return new Dr(e.rctx,xAe.shader.get().build(this.configuration),Mr)}_createPipeline(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Nt({blending:i.output!==k.Color&&i.output!==k.Alpha||!i.transparent?null:s?wu:A0(e),culling:Ok(i.cullFace),depthTest:i.draped?null:{func:x1(e)},depthWrite:i.draped?null:(s||n)&&i.writeDepth?Mc:null,colorWrite:qt,stencilWrite:i.hasOccludees?Sm:null,stencilTest:i.hasOccludees?r?s1:T1:null,polygonOffset:s||n?i.polygonOffset?qft:null:i8(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};wAe.shader=new Lr(Hft,()=>me(()=>Promise.resolve().then(()=>bAt),void 0));const qft={factor:1,units:1};let Jn=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.cullFace=Ei.None,this.transparencyPassType=dt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};d([G({count:k.COUNT})],Jn.prototype,"output",void 0),d([G({count:Ei.COUNT})],Jn.prototype,"cullFace",void 0),d([G({count:dt.COUNT})],Jn.prototype,"transparencyPassType",void 0),d([G()],Jn.prototype,"hasSlicePlane",void 0),d([G()],Jn.prototype,"hasVertexColors",void 0),d([G()],Jn.prototype,"transparent",void 0),d([G()],Jn.prototype,"polygonOffset",void 0),d([G()],Jn.prototype,"enableOffset",void 0),d([G()],Jn.prototype,"writeDepth",void 0),d([G()],Jn.prototype,"hasOccludees",void 0),d([G()],Jn.prototype,"multipassEnabled",void 0),d([G()],Jn.prototype,"cullAboveGround",void 0),d([G()],Jn.prototype,"objectAndLayerIdColorInstanced",void 0),d([G()],Jn.prototype,"vvColor",void 0),d([G()],Jn.prototype,"draped",void 0),d([G({constValue:!1})],Jn.prototype,"occlusionPass",void 0),d([G({constValue:!0})],Jn.prototype,"hasVvInstancing",void 0),d([G({constValue:!1})],Jn.prototype,"vvSize",void 0),d([G({constValue:!1})],Jn.prototype,"vvOpacity",void 0);let fce=class extends IK{constructor(e){super(e,new Yft),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===k.Highlight||ZU(r)&&!this._isTransparent],[ue.OPAQUE_NO_SSAO_DEPTH,r=>r===k.LinearDepth&&this.parameters.writeLinearDepth&&!this._isTransparent],[ue.TRANSPARENT_MATERIAL,r=>ZU(r)&&this._isTransparent&&this.parameters.writeDepth],[ue.TRANSPARENT_NO_SSAO_DEPTH,r=>r===k.LinearDepth&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(ZU(r)||r===k.LinearDepth&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[ue.DRAPED_MATERIAL,r=>qwe(r)]]),this._configuration=new Jn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<t8,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new Wft(e)}createBufferWriter(){const e=Yi().vec3f(O.POSITION);return se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new uC(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},Wft=class extends _1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e),this.ensureTechnique(wAe,e)}},Yft=class extends MR{constructor(){super(...arguments),this.color=_u,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ei.None,this.hasOccludees=!1,this.draped=!1}};var wo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(wo||(wo={}));const Uq=.70710678118,mce=Uq,Xft=.08715574274;function TAe(t){const e=new Or,r=t.multipassEnabled&&(t.output===k.Color||t.output===k.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;Sc(i,t),e.include(Ol,t),e.include(px,t),e.include(Yg,t),e.include(lC,t),t.draped?i.uniforms.add(new Ie("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):n.add(O.BOUNDINGRECT,"mat3"),n.add(O.POSITION,"vec3"),n.add(O.UVMAPSPACE,"vec4"),t.vvColor&&n.add(O.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new wr("uColor",c=>c.color));const a=t.style===wo.ForwardDiagonal||t.style===wo.BackwardDiagonal||t.style===wo.DiagonalCross;a&&i.code.add(x`
      const mat2 rotate45 = mat2(${x.float(Uq)}, ${x.float(-mce)},
                                 ${x.float(mce)}, ${x.float(Uq)});
    `),t.draped||(Cp(i,t),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(Xft)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===k.LinearDepth;return l&&(e.include(h0,t),zw(e),J_(e)),i.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Rs,t),s.include(Lm),t.draped&&s.uniforms.add(new Ie("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===k.Highlight&&e.include(w1,t),r&&e.include(Oc,t),t.output!==k.Highlight&&(s.code.add(x`
      const float lineWidth = ${x.float(t.lineWidth)};
      const float spacing = ${x.float(t.patternSpacing)};
      const float spacingINV = ${x.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(x`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==k.Highlight?x`color.a *= ${Zft(t)};`:""}

      ${t.output===k.ObjectAndLayerIdColor?x`color.a = 1.0;`:""}

      if (color.a < ${x.float(xo)}) {
        discard;
      }

      ${t.output===k.Alpha?x`fragColor = vec4(color.a);`:""}

      ${t.output===k.Color?x`fragColor = color; ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===k.Highlight?x`outputHighlight();`:""}
      ${t.output===k.LinearDepth?x`outputDepth(linearDepth);`:""};
      ${t.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function Zft(t){function e(r){return t.draped?x`coverage(vuv.${r}, texelSize)`:x`sampleAA(vuv.${r})`}switch(t.style){case wo.ForwardDiagonal:case wo.Horizontal:return e("y");case wo.BackwardDiagonal:case wo.Vertical:return e("x");case wo.DiagonalCross:case wo.Cross:return x`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const Jft=Object.freeze(Object.defineProperty({__proto__:null,build:TAe},Symbol.toStringTag,{value:"Module"}));let SAe=class EAe extends Gr{initializeProgram(e){return new Dr(e.rctx,EAe.shader.get().build(this.configuration),se("enable-feature:objectAndLayerId-rendering")?AAe:CAe)}_setPipelineState(e,r){const i=this.configuration,s=e===dt.NONE,n=e===dt.FrontFace;return Nt({blending:i.output===k.Color||i.output===k.Alpha?s?wu:A0(e):null,culling:Ok(i.cullFace),depthTest:i.draped?null:{func:x1(e)},depthWrite:i.draped?null:s?Mc:e8(e),colorWrite:qt,stencilWrite:i.hasOccludees?Sm:null,stencilTest:i.hasOccludees?r?s1:T1:null,polygonOffset:s||n?i.polygonOffset?Kft:null:i8(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};SAe.shader=new Lr(Jft,()=>me(()=>Promise.resolve().then(()=>wAt),void 0));const Kft={factor:1,units:1};let Rn=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.cullFace=Ei.None,this.transparencyPassType=dt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};d([G({count:k.COUNT})],Rn.prototype,"output",void 0),d([G({count:Ei.COUNT})],Rn.prototype,"cullFace",void 0),d([G({count:wo.COUNT})],Rn.prototype,"style",void 0),d([G({count:dt.COUNT})],Rn.prototype,"transparencyPassType",void 0),d([G()],Rn.prototype,"hasSlicePlane",void 0),d([G()],Rn.prototype,"hasVertexColors",void 0),d([G()],Rn.prototype,"polygonOffset",void 0),d([G()],Rn.prototype,"hasOccludees",void 0),d([G()],Rn.prototype,"patternSpacing",void 0),d([G()],Rn.prototype,"lineWidth",void 0),d([G()],Rn.prototype,"enableOffset",void 0),d([G()],Rn.prototype,"draped",void 0),d([G()],Rn.prototype,"multipassEnabled",void 0),d([G()],Rn.prototype,"cullAboveGround",void 0),d([G()],Rn.prototype,"vvColor",void 0),d([G({constValue:!0})],Rn.prototype,"writeDepth",void 0),d([G({constValue:!1})],Rn.prototype,"occlusionPass",void 0),d([G({constValue:!1})],Rn.prototype,"hasVvInstancing",void 0),d([G({constValue:!1})],Rn.prototype,"vvSize",void 0),d([G({constValue:!1})],Rn.prototype,"vvOpacity",void 0);const CAe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6]]),AAe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6],[O.OBJECTANDLAYERIDCOLOR,9]]);let LK=class extends IK{constructor(e){super(e,new tmt),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>nw(r)],[ue.TRANSPARENT_MATERIAL,r=>qg(r)],[ue.TRANSPARENT_NO_SSAO_DEPTH,r=>r===k.LinearDepth&&this.parameters.writeLinearDepth],[ue.DRAPED_MATERIAL,r=>this.parameters.draped&&r===k.Color||nw(r)]]),this._vertexAttributeLocations=se("enable-feature:objectAndLayerId-rendering")?AAe:CAe,this._configuration=new Rn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<t8,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new Qft(e)}createBufferWriter(){const e=Yi().vec3f(O.POSITION).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),new emt(e)}},Qft=class extends _1{_updateParameters(e){return this.ensureTechnique(SAe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},emt=class extends uC{write(e,r,i,s,n){Q2e(i,this.vertexBufferLayout,e,r,s,n);for(const o of this.vertexBufferLayout.fields.keys()){const a=i.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case O.UVMAPSPACE:{ht(a.size===4);const c=s.getField(o,Ap);c&&_E(a,c,n);break}case O.BOUNDINGRECT:{ht(a.size===9);const c=s.getField(o,K_);c&&this.writeBoundingRect(a,e,c,n);break}}}}writeBoundingRect(e,r,i,s){const{data:n,indices:o}=e,a=r,l=i.typedBuffer,c=i.typedBufferStride,u=o.length;s*=c;for(let h=0;h<u;++h){const p=9*o[h],f=n[p],g=n[p+1],_=n[p+2];l[s]=a[0]*f+a[4]*g+a[8]*_+a[12],l[s+1]=a[1]*f+a[5]*g+a[9]*_+a[13],l[s+2]=a[2]*f+a[6]*g+a[10]*_+a[14];for(let v=3;v<9;++v)l[s+v]=n[p+v];s+=c}}},tmt=class extends MR{constructor(){super(...arguments),this.color=zt(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ei.None,this.hasOccludees=!1,this.style=wo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function rmt(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new fce(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=zt(0,0,0,0),e.forceTransparentMode=!0),new fce(e)):(e.style=imt(r.style),new LK(e))}function imt(t){switch(t){case"horizontal":return wo.Horizontal;case"vertical":return wo.Vertical;case"cross":return wo.Cross;case"forward-diagonal":return wo.ForwardDiagonal;case"backward-diagonal":return wo.BackwardDiagonal;case"diagonal-cross":return wo.DiagonalCross;default:return}}function smt(t){return t.material instanceof LK&&!t.material.parameters.draped}function nmt(t,e){if(smt(t)){const r=t.attributes.get(O.POSITION).data,i=t.getMutableAttribute(O.UVMAPSPACE).data,s=t.getMutableAttribute(O.BOUNDINGRECT).data;vAe(i,s,r,e)}}function omt(t,e,r,i,s){const n=xTe(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)nmt(a,s);return n}const amt=["polyline","polygon","extent"],gce=new AR({size:!1,color:!0,rotation:!1,opacity:!1});let PAe=class MAe extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1}async doLoad(){this._fastUpdates=gE(this._context.renderer,gce)}_createMaterials(){var s,n,o;if(this._materials.length>0)return;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacityAndColor(e);this._materials[Es.Fill]=rmt(this.symbolLayer,{color:r,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[Es.Fill]instanceof LK;const i=this.symbolLayer.outline;if(this._isValidOutline(i)){const a=d3e(i.pattern);this._materials[Es.Outline]=new RT({width:on(i.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:Rq(i.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return(e==null?void 0:e.size)!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,amt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){var i;for(const s in e.diff){if(s!=="visualVariables"||!yE(this._fastUpdates,r,gce))return zs.RecreateSymbol;(i=this._materials[Es.Fill])==null||i.setParameters(this._fastUpdates.materialParameters)}return zs.FastUpdate}layerOpacityChanged(){var e,r;if(this._materials[Es.Fill]!=null){const i=this._materials[Es.Fill].parameters.color,s=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,n=this._getCombinedOpacity(s);this._materials[Es.Fill].setParameters({color:[i[0],i[1],i[2],n],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Es.Outline]!=null){const i=this._materials[Es.Outline].parameters.color;this._materials[Es.Outline].setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=OR(MAe.elevationModeChangeTypes,i,s);if(n!==bs.UPDATE)return n;const o=Gh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[Es.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Es.Outline]){const r={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Es.Outline].setParameters(r)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const s=EO(e.geometry);if(!s)return null;const n=uK(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new lmt(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=hs(4*a,!0),o.boundingRect=ao(9*a,!0),vAe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Es.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new P0({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Dm(this,l,o.outGeometries,null,null,omt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Gh(i.mode),c}_createAs3DShapeFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(Ri(cd),pu(cd,o),!sp(cd,this._context.clippingExtent)))continue;const u=ost(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const h=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=Soe({material:this._materials[Es.Fill],indices:u,mapPositions:o,attributeData:{position:n,color:h?null:r.color,colorFeature:h?gp(h.field,e):null,uvMapSpace:this._needsUV?D5(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Ah(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(this._materials[Es.Outline]==null)return;const r=e.renderData.outlines;for(const{mapPositions:i,position:s}of r){if(this._context.clippingExtent!=null&&(Ri(cd),pu(cd,i),!sp(cd,this._context.clippingExtent)))continue;const n=$q(this._materials[Es.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:i,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,r){var a;const i=EO(e.geometry);if(i==null)return null;this._materials[Es.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Es.Outline]!=null&&(this._materials[Es.Outline].renderPriority=this._renderPriority);const s=WEe(i,this._context.overlaySR),n=new cmt(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=hs(4*o,!0),Vft(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Ri(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Es.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new b8(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of i){const c=Ri(cd);if(pu(c,n),!sp(c,this._context.clippingExtent))continue;const u=TE(n,o,3);if(u.length===0)continue;aE(r.outBoundingBox,c);const h=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=Soe({material:this._materials[Es.Fill],indices:u,attributeData:{position:n,color:h?null:r.color,colorFeature:h?gp(h.field,e):null,uvMapSpace:this._needsUV?D5(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new EE(p,r))}}_createAsOverlayOutline(e){if(this._materials[Es.Outline]==null)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(Ri(cd),pu(cd,s),!sp(cd,this._context.clippingExtent))continue;aE(e.outBoundingBox,cd);const n=$q(this._materials[Es.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new EE(n,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,s;const e=(s=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:s.color,r=this._getOutlineOpacity();return sM(e!=null?Fe.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};PAe.elevationModeChangeTypes={definedChanged:bs.RECREATE,staysOnTheGround:bs.NONE,onTheGroundChanged:bs.RECREATE};const cd=Mn();let lmt=class extends f8{constructor(e,r,i,s){super(e,i,s),this.color=r}},cmt=class extends f8{constructor(e,r,i,s){super(e,i,s),this.color=r}};var Es;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Es||(Es={}));let OAe=class{constructor(e,r="center",i=!1,s=je(),n=zt(0,0,0,-1),o="world",a=E(),l=0){this.verticalOffset=e,this.anchor=r,this.hasLabelVerticalOffset=i,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},RAe=class{constructor(e,r="center",i="center",s=null,n=je()){this.placement=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.displaySize=n}},$Ae=class IAe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,r){e.font=this.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var p,f,g,_,v;const i=(p=e==null?void 0:e.material)==null?void 0:p.color,s=Fe.toUnitRGBA(i)??_u,n=e.size!=null?on(e.size):12,o=e.lineHeight,a=e.background!=null?Fe.toUnitRGBA(e.background.color):_u,l={family:((f=e.font)==null?void 0:f.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:on(c.size),color:Fe.toUnitRGBA(c.color)}:{size:0,color:_u},h=new IAe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let b=!1;const w=h.fontString(n);try{b=(await document.fonts.load(w)).some(T=>!_at(T))}catch{ae.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!umt.has(e.font.family))try{await yat(e.font)}catch{}}return h}};const umt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),uy=4096;let Vb=class extends Me{constructor(e){super(e),this.type=vs.Texture,this.id=fu(),this.events=new Gs,this._glTexture=null,this._atlas=new pmt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=ft(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return _M=0,[uy-hy-_M,uy-hy-_M-yce]}load(e){if(this._glTexture)return this._glTexture;const r=new oi;return r.wrapMode=Xt.CLAMP_TO_EDGE,r.samplingMode=Gt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Sr(e,r,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(yt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=wi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=ft(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,r){var n,o;const{width:i,height:s}=this._atlas;i===e&&s===r||(this._atlas.width=e,this._atlas.height=r,(n=this._glTexture)==null||n.resize(e,r),(o=this._glTexture)==null||o.updateData(0,0,0,i,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>Zz(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,r,i,s){const n=this._atlas;if(n.width<i||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new _ce(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+i);if(a==null){if(n.height<n.nextY+s)return!1;a=new _ce(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(r,e),this._elementsToRender.set(r,e),a.x+=i,!0}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i!=null&&i.delete(r)&&(r.geometries[0].setAttributeData(O.SIZE,[0,0]),r.geometryVertexAttributeUpdated(r.geometries[0],O.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const r=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(r,e);const i=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+hy,a=n+hy+yce;if(!this._addAtlasElement(e,r,o,a)){if(this._canRepack)this._reset();else if(i.width<o){const l=Math.min(sw(Math.max(o,1.5*i.width)),uy);this._resizeAtlas(l,i.height)}else{const l=i.nextY+a,c=Math.min(sw(Math.max(l,1.5*i.height)),uy);if(c>i.height)this._resizeAtlas(i.width,c);else if(i.width<uy){const u=Math.min(sw(1.5*i.width),uy);this._resizeAtlas(u,i.height)}}this._elements.set(r,e)}}_renderElement(e){const r=e.commitNewPosition(),i=e.textRenderer;this._ctx.clearRect(r[0]-hy,r[1]-hy,i.renderedWidth+2*hy,i.renderedHeight+2*hy),i.render(this._ctx,r[0],r[1]);const s=this._stageObjects.get(i.key);s==null||s.forEach(n=>Zz(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return Ao;for(;this._needsRepack&&(this._canRepack||this._atlas.height<uy&&this._atlas.height<uy);){this._canRepack=this._needsRepack=!1;const r=this._elements;this._elements=new Map,r.forEach(i=>this._processAddition(i)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[r,i]of this._elementsToRender){if(e.done)break;this._renderElement(i),this._elementsToRender.delete(r),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,r){const i=e.key;this._addStageObject(i,r);let s=this._elements.get(i);s==null&&(s=new dmt(this._atlas,e),this._processAddition(s),this.setDirty()),hmt(r,s),Zz(r,s)}removeTextTexture(e,r){const i=e.key;if(!this._elements.get(i))return;this._removeStageObject(i,r);const s=this._stageObjects.get(i);s&&s.size!==0||this._elements.delete(i),(s==null?void 0:s.size)===0&&this._stageObjects.delete(i),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:r,_atlas:i}=this,s=this;return{elements:e,stageObjects:r,atlas:i,resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:n=>s.runTask(n)}}};function hmt(t,e){t.geometries[0].setAttributeData(O.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],O.SIZE)}function Zz(t,e){t.geometries[0].setAttributeData(O.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],O.UV0,!0)}d([m({constructOnly:!0})],Vb.prototype,"view",void 0),d([m({type:Boolean})],Vb.prototype,"updating",void 0),Vb=d([V("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],Vb);const hy=2,yce=2;let dmt=class{constructor(e,r){this._atlas=e,this.textRenderer=r,this._uv=Yt(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return _u;const{renderedWidth:e,renderedHeight:r}=this.textRenderer;return es(this._uv,this._xOffset/this._atlas.width,(this._yOffset+r)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},pmt=class{constructor(e,r){this.width=e,this.height=r,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=_M}},_ce=class{constructor(e){this.y=e,this.x=_M}},_M=0,fmt=class{constructor(e,r,i){this._renderer=new i3e(e,r,i,Vb.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=vF(mmt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new o1(e,{wrap:{s:Xt.CLAMP_TO_EDGE,t:Xt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const mmt={canvas:null},gmt=Pe(0,0,1);let ymt=class extends Nm{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=n8(this.symbolLayer.size);if(e)throw new J("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await $Ae.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=TO(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=cZ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!Vve(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new OAe(n);Dut(o,a.screenOffset);const l=new RAe(a,this.symbolLayer.horizontalAlignment,Lut(o));return this._createAs3DShape(r,i,s,l)}createLabel(e,r,i,s,n){const o=e.graphic,a=TO(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=r.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,r,i,s,n)}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return vce(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),bs.UPDATE}slicePlaneEnabledChanged(e,r){return vce(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Gh(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return vmt}_createAs3DShape(e,r,i,s,n=null,o=null,a=()=>s.placement.elevationOffset){var j;const l=this.setGraphicElevationContext(e,new tF,s.placement.elevationOffset),c=((j=e.geometry)==null?void 0:j.type)==="polyline",u=e.uid;let h=null,p=null;if(o==null){const z=n3e(s.horizontalPlacement);h=new fmt(i,z,this._textRenderParameters);let Z=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create()),p.texture.events.on("unloaded",()=>Z==null?void 0:Z.release());const W=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(W==null||Rc(W))return p.release(),null;Z=W}}const f=_mt(h,s),g={occlusionTest:!0,screenOffset:s.placement.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(o?g.textureId=o.id:p&&(g.textureId=p.texture.id),s.placement.verticalOffset!=null){const{screenLength:z,minWorldLength:Z,maxWorldLength:W}=s.placement.verticalOffset;g.verticalOffset={screenLength:on(z),minWorldLength:Z||0,maxWorldLength:W??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:z,screenSizePerspectiveSettingsLabels:Z}=this._context.sharedResources,W=r3e(this._textRenderParameters);g.screenSizePerspective=Z.overrideFontHeight(W.maxHeight),g.screenSizePerspectiveAlignment=z}c&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled;const _=(z,Z)=>{const W=JSON.stringify(Z);let Y=z.get(W);return Y==null&&(Y=new vE(Z),z.add(W,Y)),Y},v=n?_(n,g):new vE(g),b=s.placement.translation,w=h?ar(h.displayWidth,h.displayHeight):n0,T=s.placement.centerOffset,S=gmt,C=je(),P=RH(v,S,b,null,w,T,C,null),R=kJ(this._context,r,P,l,u);if(R==null)return null;const L=(z,Z,W,Y,le,I)=>{const N=a()||s.placement.elevationOffset,B=this.setGraphicElevationContext(e,Z,N);return aw(z,B,W,Y,le,I)},F=new Dm(this,R.object,[P],n==null?[v]:null,p,L,l);F.alignedSampledElevation=R.sampledElevation,F.needsElevationUpdates=Gh(l.mode)||l.mode==="absolute-height",F.getScreenSize=(z=je())=>(z[0]=h?h.displayWidth:s.displaySize[0],z[1]=h?h.displayHeight:s.displaySize[1],z);const U=new OTe(s.placement.elevationOffset,i);return F.metadata=U,xO(F,r,this._context.elevationProvider),F}};function vce(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function _mt(t,e){if(e.verticalPlacement==="baseline"){const i=Rut[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return ar(i,s)}const r=Iut(e.horizontalPlacement,e.verticalPlacement);return RN[r]}const vmt={mode:"relative-to-ground",offset:0};function bce(t){t.fragment.uniforms.add(new at("texWaveNormal",e=>e.waveNormal),new at("texWavePerturbation",e=>e.wavePerturbation),new wr("waveParams",e=>es(bmt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new ni("waveDirection",e=>cr(wmt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(vst),t.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const bmt=Yt(),wmt=je();function LAe(t){const e=new Or,{vertex:r,fragment:i}=e;Sc(r,t),e.include(Ol,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const s=new wr("waterColor",n=>n.color);if(t.output===k.Color&&t.draped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(xo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(x`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==k.Color&&t.output!==k.Alpha||(e.include(RO,t),e.include(nC,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(xo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===k.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Oc,t),t.output){case k.Alpha:e.include(Rs,t),i.uniforms.add(s),i.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case k.Color:e.include(E5),e.include(CZ,{pbrMode:nt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(bce),e.include(Rs,t),e.include(bE,t),e.include(nEe,t),i.uniforms.add(s,new Ie("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),Cp(i,t),i.include(Lm),w0(i),Om(i),i.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case k.Normal:e.include(RO,t),e.include(bce,t),e.include(Rs,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(xo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ie("timeElapsed",n=>n.timeElapsed)),i.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case k.Highlight:e.include(w1,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(xo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Rs,t),i.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case k.ObjectAndLayerIdColor:e.include(lC,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(xo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Rs,t),i.code.add(x`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const xmt=Object.freeze(Object.defineProperty({__proto__:null,build:LAe},Symbol.toStringTag,{value:"Module"}));let DAe=class NAe extends Gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Dr(e.rctx,NAe.shader.get().build(this.configuration),Mr)}_setPipelineState(e){const r=this.configuration,i=e===dt.NONE,s=e===dt.FrontFace;return Nt({blending:r.output!==k.Normal&&r.output!==k.Highlight&&r.output!==k.ObjectAndLayerIdColor&&r.transparent?i?wu:A0(e):null,depthTest:r.draped?null:{func:x1(e)},depthWrite:r.draped?null:i?r.writeDepth?Mc:null:e8(e),colorWrite:qt,polygonOffset:i||s?null:i8(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};DAe.shader=new Lr(xmt,()=>me(()=>Promise.resolve().then(()=>xAt),void 0));let $n=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=dt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};d([G({count:k.COUNT})],$n.prototype,"output",void 0),d([G({count:dt.COUNT})],$n.prototype,"transparencyPassType",void 0),d([G()],$n.prototype,"spherical",void 0),d([G()],$n.prototype,"receiveShadows",void 0),d([G()],$n.prototype,"hasSlicePlane",void 0),d([G()],$n.prototype,"transparent",void 0),d([G()],$n.prototype,"enableOffset",void 0),d([G()],$n.prototype,"writeDepth",void 0),d([G()],$n.prototype,"hasScreenSpaceReflections",void 0),d([G()],$n.prototype,"doublePrecisionRequiresObfuscation",void 0),d([G()],$n.prototype,"hasCloudsReflections",void 0),d([G()],$n.prototype,"objectAndLayerIdColorInstanced",void 0),d([G()],$n.prototype,"draped",void 0),d([G()],$n.prototype,"multipassEnabled",void 0),d([G()],$n.prototype,"cullAboveGround",void 0),d([G({constValue:!1})],$n.prototype,"occlusionPass",void 0),d([G({constValue:nt.Water})],$n.prototype,"pbrMode",void 0),d([G({constValue:!0})],$n.prototype,"useCustomDTRExponentForWater",void 0),d([G({constValue:!0})],$n.prototype,"highStepCount",void 0),d([G({constValue:!1})],$n.prototype,"useFillLights",void 0);let Tmt=class extends _1{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const r=e.ssr.lastFrameColor!=null;r!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:r})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===k.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(DAe,e)}},Smt=class extends IK{constructor(e){super(e,new FAe),this._configuration=new $n,this._animation=new Cxe,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>qg(r)&&!this.parameters.transparent||nw(r)],[ue.TRANSPARENT_MATERIAL,r=>qg(r)&&this.parameters.transparent||nw(r)],[ue.DRAPED_MATERIAL,r=>this.parameters.draped&&r===k.Color||nw(r)],[ue.DRAPED_WATER,r=>r===k.Normal]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<t8,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<Emt;const i=this._animation.advance(e);return this.setParameters({timeElapsed:QW(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}createGLMaterial(e){return new Tmt(e)}createBufferWriter(){return new uC(se("enable-feature:objectAndLayerId-rendering")?Yht:qht)}get test(){return{animationEnabled:this._animation.enabled}}},FAe=class extends vJ{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ar(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=zt(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=E(),this.modelTransformation=null}};const Emt=35e3,Cmt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Amt=["polyline","polygon","extent"];let zq=class eb extends Nm{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Amt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._materials[0])return;const e=new FAe,r=this.symbolLayer.color;r!=null&&(e.color=Fe.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?eb.headingVectorFromAngle(this.symbolLayer.waveDirection):ar(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Cmt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new Smt(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=OR(eb.elevationModeChangeTypes,i,s);if(n!==bs.UPDATE)return n;const o=Gh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var h;const s=EO(e.geometry);if(s==null)return null;const n=uK(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=ao(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Pmt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new P0({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new Dm(this,c,l.outGeometries,null,null,xTe,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=Gh(r.mode),u}_createUVCoordsFromVertices(e,r,i,s){const n=xa(s);Tu(dy);for(let l=0;l<i;l++)cr(wce,r[3*l],r[3*l+1]),AY(dy,wce);Rw(dy,dy,n);const o=dy[0]%eb.unitSizeOfTexture,a=dy[1]%eb.unitSizeOfTexture;mL[0]=dy[0]-o,mL[1]=dy[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-mL[0])/eb.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-mL[1])/eb.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(Ri(lv),pu(lv,a),!sp(lv,this._context.clippingExtent)))continue;const c=TE(a,l,3);if(c.length===0)continue;const u=Ah(i,2*n,2*s),h=Eoe({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(h)}}_createAsOverlay(e){var a;const r=EO(e.geometry);if(r==null)return null;this._materials[0].renderPriority=this._renderPriority;const i=WEe(r,this._context.overlaySR),s=i.position.length/3,n=ao(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new Mmt(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Ri(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new b8(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(Ri(lv),pu(lv,s),!sp(lv,this._context.clippingExtent))continue;aE(e.outBoundingBox,lv);const l=TE(s,n,3);if(l.length===0)continue;const c=Ah(r,2*o,2*a),u=Eoe({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new EE(u,e))}}static headingVectorFromAngle(e){const r=je(),i=g6(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};zq.unitSizeOfTexture=100,zq.elevationModeChangeTypes={definedChanged:bs.RECREATE,staysOnTheGround:bs.NONE,onTheGroundChanged:bs.RECREATE};const mL=je(),dy=jt(),wce=je(),lv=Mn();let Pmt=class extends f8{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},Mmt=class extends f8{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function Omt(t,e,r,i){var n;const s=((n=$mt[t.type])==null?void 0:n[e.type])||Rmt[e.type];return s?new s(t,e,r,i):(ae.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Rmt={icon:Oq,object:kpt,line:p3e,path:Uft,fill:PAe,extrude:wot,text:ymt,water:zq},$mt={"mesh-3d":{fill:tdt}};let Imt=class extends FJ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;gL.renderPriority=1-(1+n)/i,gL.renderPriorityStep=1/i,gL.ignoreDrivers=o.ignoreDrivers;const a=Omt(this.symbol,o,this._context,gL),l=d6(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await $6(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),vt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,r){var o,a;const i=e.graphic,s=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),n=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new Dit(i,r||this,s,e.layer,n)}get complexity(){return NJ(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Dm?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==nu.LOADED?zs.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==zs.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,zs.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===nu.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===nu.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(kE).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return vt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const gL=new Nit;let Lmt=class extends FJ{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:fSe}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):zs.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,r,i,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function DK(t){return t instanceof Lmt?t.graphics3DSymbol:t instanceof Imt?t:null}const $O=()=>ae.getLogger("esri.views.3d.layers.graphics.labelPlacement");let Dmt=class{constructor(e,r,i,s=null){this.graphics3DGraphic=e,this.labelSymbol=r,this.labelClass=i,this.disablePlacement=s}};function xce(t){const e=jmt(t);if(e==null)return null;const r=Nmt(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return kmt(new OAe(n,i,s),r,t)}function Nmt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=ap[r],s=i||EF(t);return r&&!i&&$O().warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Fmt(s,t)}function NK(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=DK(e);return r!=null?r.symbol.symbolLayers.at(0):null}function Fmt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?($O().warnOncePerTick(Tce(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),EF(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return $O().warnOncePerTick(Tce(t==null?void 0:t.placement,`'${i}' geometries`)),EF(e);break;case"point":case"mesh":return t}return t}function Tce(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function EF(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Cn,anchor:"center"};case"polygon":{const r=NK(t);return r!=null&&r.type==="extrude"?ap["above-center"]:{placement:"center-center",normalizedOffset:Cn,anchor:"center"}}case"point":case"mesh":return ap["above-center"];default:return}}function kmt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":zmt(t,e,r);break;case"polygon":Umt(t,e,r);break;case"mesh":FK(t,e,r.graphics3DGraphic.layers[0])}const s=Eut-bF;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function Umt(t,e,r){const i=NK(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(vM),ip(vM,t.translation),t.translation[2]=y1(vM)/2):te(t.translation,0,0,0),FK(t,e,s);break}}}function zmt(t,e,r){const i=NK(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):te(t.translation,0,0,0),i.type){case"icon":case"text":Bmt(t,e,r,s);break;case"object":FK(t,e,s)}}function Bmt(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(ap[r.labelClass.labelPlacement]&&$O().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Vmt(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Vmt(t,e=Hmt){const{graphics3DGraphic:r}=t,i=r.layers[0],s=(i==null?void 0:i.stageObject.geometries[0].material)??null;if(s&&s instanceof vE){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function FK(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(vM):vM,s=Pe(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Se(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function Gmt(t){return t==="above-center"}function jmt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=DK(i.graphics3DSymbol),n=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,o=ap[e]||EF(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Sce(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&Gmt(o.placement)?{placement:"above-center",verticalOffset:Sce(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:($O().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Sce(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const ap={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Ece={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Ece){const e=Ece[t],r=ap[t];e.forEach(i=>{ap[i]=r})}Object.freeze&&(Object.freeze(ap),Object.keys(ap).forEach(t=>{var e;Object.freeze(ap[t]),Object.freeze((e=ap[t])==null?void 0:e.normalizedOffset)}));const Hmt=[0,0],vM=Mn();let Cce=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},Ace=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},qmt=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},Wmt=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new dEe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},tb=class extends Me{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([he(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),he(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(yt.LABELER,this)]),this._textTextureAtlas=new Vb({view:this.view}),this._hudMaterialCollection=new Cce(this.view._stage),this._calloutMaterialCollection=new Cce(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=ft(this._textTextureAtlas),this._hudMaterialCollection=ft(this._hudMaterialCollection),this._calloutMaterialCollection=ft(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),ud.graphic=null,ud.renderingInfo=null,ud.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new Ace(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(no.LABEL,Vo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(no.LABEL,Vo.USER,!1),this.setLabelGraphicVisibility(r,!1),r.clearLabelGraphics(),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&(this._textTextureAtlas.addTextTexture(i,r.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&(this._textTextureAtlas.removeTextTexture(i,r.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Ao}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active)if(Jz(r))this._dirty=!0;else if(Kz(r.labelClassContexts)){if(r.labelClassContexts===null){this._deactivateLabelingContext(r);continue}this._createLabelClassContext(r),this._dirty=!0}else vh(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),vt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=(a=s.labelingInfo)==null?void 0:a.filter(l=>!!l.symbol);!n||n.length===0||(await $6(n,async(l,c)=>{const u=l.symbol,h=DK(i.getOrCreateGraphics3DSymbol(u));if(h==null)return void ae.getLogger(this).error("Failed to create Graphics3DSymbol for label");await h.load(),vt(r);let p=null;cZ(u)&&u.hasVisibleCallout()&&(p=Krt(u,i.symbolCreationContext),await p.load(),vt(r));const f=await xp(att(l,e.layer.fieldsIndex,this.view.spatialReference));if(vt(r),f.ok===!0){const g=await this._createTextRenderParameters(h.symbol);vt(r),e.labelClassContexts[c]=new qmt(l,h,p,g,f.value)}else ae.getLogger(this).error(`Label expression failed to evaluate: ${f.error}`)}),vt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(ns(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:$Ae.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Ja(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n,o){const a=new RAe(i,Sle(i.anchor),$ut(i.anchor),e.text,ar(e.displayWidth,e.displayHeight));return ud.graphic=r,ud.renderingInfo=null,ud.layer=s,n.createLabel(ud,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=xce(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,r,i,s,n){ud.graphic=e,ud.layer=n;const o=s.screenOffset[0];return ud.renderingInfo=new Zrt(null,r,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(ud)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(Kz(s)||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=yL(i.layer);for(let u=0;u<s.length;u++){const h=e.textRenderers[u],p=e.textLabelPlacements[u];if(h==null||p==null)continue;const f=s[u],g=f.graphics3DSymbol,_=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,v=g.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const b=new Dmt(r,_,f.labelClass),w=this._createTextSymbolGraphic(h,o,p,a,v,b);if(w==null)return!1;w._labelClass=f.labelClass,w._labelIndex=u,r.addLabelGraphic(w,i.stageLayer),r.deconflictionPriority=((c=f.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(no.LABEL,Vo.USER,l),r.setVisibilityFlag(no.LABEL,Vo.SCALE_RANGE,!0),r.setVisibilityFlag(no.LABEL,Vo.DECONFLICTION,!1),n=!0;const T=f.graphics3DCalloutSymbolLayer;if(T&&p.hasLabelVerticalOffset){T.setElevationInfoOverride(i.elevationInfoOverride);const S=this._createLineCalloutGraphic(o,_,T,p,a);S!=null&&(f.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(S,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(Kz(i))return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?Het(s,r.layer):s;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,h=((n=u.symbol)==null?void 0:n.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=a.labelClass,g=r.disablePlacement,_=xce({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:g});if(_==null)continue;const v=Sle(_.anchor),b=n3e(v);e.textRenderers[o]=new i3e(c,b,a.textRenderParameters,Vb.maxSize),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new Ace(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.delete(r),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=yL(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=(i==null?void 0:i.elevationInfoOverride)||null,o=(i==null?void 0:i.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new Wmt(this.view._stage,a,e,r,s,n,o,yL(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>yL(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>Jz(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(Jz(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Jz(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Kz(t){return!t||t.length===0}function yL(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}d([m({constructOnly:!0})],tb.prototype,"view",void 0),d([m({constructOnly:!0})],tb.prototype,"deconflictor",void 0),d([m()],tb.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],tb.prototype,"updating",null),tb=d([V("esri.views.3d.layers.graphics.Labeler")],tb);const ud=new Jrt(null,null,null);let cP=class rT{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=jt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Tl.VISIBLE_ON_SURFACE,screenRect:jt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=rT.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new rT(r,i,s,this.tilingScheme),new rT(r,i+1,s,this.tilingScheme),new rT(r,i,s+1,this.tilingScheme),new rT(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,s0(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Tl;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Tl||(Tl={}));function Ymt(t,e,r,i,s,n,o=1){const a=k_(e,s,z6);if(a==null)return!1;if(a===Ni){if(t===i&&r===n)return!0;const c=r+o;for(let u=r,h=n;u<c;++u,++h)ce(i[h],t[u]);return!0}const l=r+o;for(let c=r,u=n;c<l;++c,++u)a(t[c],0,i[u],0);return!0}const kAe=.5*Math.PI,Xmt=kAe/Math.PI*180;let Zmt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:E(),direction:E()};for(let r=0;r<4;r++)this._extent[r]={origin:E(),direction:E(),cap:{next:null,direction:E()}},this._planes[r]=zr();this._planes[ci.NEAR]=zr(),this._planes[ci.FAR]=zr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),pe(this._center.origin,n[0].origin,n[2].origin),re(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||re(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,m0(a.cap.direction,a.origin,l.origin),JM(a.direction,a.cap.direction,a.origin,this._planes[o]),s||re(a.direction,a.direction,-1)}JM(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[ci.NEAR]),s?bG(this._planes[ci.NEAR],this._planes[ci.FAR]):(Z6(this._planes[ci.FAR],this._planes[ci.NEAR]),bG(this._planes[ci.NEAR],this._planes[ci.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Vr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ne.Global){const n=this._maxSpanSpatialReference.isGeographic?Xmt:kAe*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(Eu(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(Eu(o.origin,o.direction))||e.intersectsLineSegment(ew(o.origin,o.cap.next,Kmt),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(sZe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){PY(e,hd),hd[2]=i,$l(r,hd,Qz,this._renderCoordsHelper.spatialReference),cn(Pce,Qz),Ri(Wl);for(const{x0:n,x1:o,y0:a,y1:l}of Jmt)for(let c=0;c<5;c++){const u=c/4;hd[0]=Pt(e[n],e[o],u),hd[1]=Pt(e[a],e[l],u),hd[2]=i,ya(hd,r,hd,this._renderCoordsHelper.spatialReference),Ge(hd,hd,Pce),Ep(Wl,hd)}te(this._extent[0].origin,Wl[0],Wl[1],Wl[2]),te(this._extent[1].origin,Wl[3],Wl[1],Wl[2]),te(this._extent[2].origin,Wl[3],Wl[4],Wl[2]),te(this._extent[3].origin,Wl[0],Wl[4],Wl[2]);for(let n=0;n<4;++n)Ge(this._extent[n].origin,this._extent[n].origin,Qz)}_toRenderBoundingExtentLocal(e,r,i){G6(e,r,Jm,this._renderCoordsHelper.spatialReference),te(this._extent[0].origin,Jm[0],Jm[1],i),te(this._extent[1].origin,Jm[2],Jm[1],i),te(this._extent[2].origin,Jm[2],Jm[3],i),te(this._extent[3].origin,Jm[0],Jm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Ne.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Ne.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(bi(e.planes[ci.NEAR],this._center.origin)<0&&de(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(bi(e.planes[ci.NEAR],i.origin)<0&&de(i.direction,e.direction)<0)return!0}return!1}};const Jmt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],hd=E(),Qz=xe(),Pce=xe(),Wl=Mn(),Jm=jt(),Kmt=Lp();let Qmt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustumBoundingSphereCenter=E(),this._frustumBoundingSphereRadius=0,this._frustum=new t_(e),this._extendedFrustum=new t_(e),this._intersector=new Zmt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const r=this._renderCoordsHelper.viewingMode===Ne.Global&&e.lij[0]>=egt&&e.lij[0]<tgt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Tl.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=t_.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];ye(Bc,l,a),re(Bc,Bc,igt),pe(i[o],a,Bc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Tl.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=$ce.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Tl.INVISIBLE&&(r=o,o===Tl.VISIBLE_ON_SURFACE))break}return $ce.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ne.Global&&e.lij[0]<rgt?this._calculateSingleTileVisibilitySided(e,!1)===Tl.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Ne.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,r=e.origin,i=mgt;fe(i,e.direction);const s=e.points,n=ggt;Hi(n,s[4],r);const o=.5*de(n,n)/de(i,n),a=this._frustumBoundingSphereCenter;kn(a,r,i,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const r=e.tilingScheme.spatialReference,i=e.extent,s=this._renderCoordsHelper.spatialReference,n=lgt;if(n[0]=i[0],n[1]=i[1],n[2]=0,n[3]=i[2],n[4]=i[3],n[5]=0,!Wi(n,r,0,n,s,0,2))return!1;const o=Lce;te(o[0],n[0],n[1],0),te(o[1],n[3],n[1],0),te(o[2],n[3],n[4],0),te(o[3],n[0],n[4],0);const a=Dce;te(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const l=cgt;te(l,0,0,1);const c=.5*Vg(o[0],o[2]),u=this._frustum,h=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=_gt;Hi(f,p,a);const g=de(l,f),_=ygt;if(kn(_,a,l,g),Vg(_,p)>c+h)return!1;const v=agt,b=g+h,w=g-h;for(let T=0;T<4;++T)kn(v[T],o[T],l,b),kn(v[T+4],o[T],l,w);return!Bq(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const r=e.tilingScheme.spatialReference,i=e.extent,s=this._renderCoordsHelper.spatialReference;if(e.lij[0]<UAe)return!0;const n=Lce,o=.5*(i[0]+i[2]);if(te(n[0],i[0],i[1],0),te(n[1],i[2],i[1],0),te(n[2],i[2],i[3],0),te(n[3],i[0],i[3],0),te(n[4],o,i[1],0),te(n[5],o,i[3],0),!Ymt(n,r,0,n,s,0,6))return!1;const a=n[0][2]>0,l=n[3][2]<0,c=a||l,u=Vr(s).radius;if(c){const N=Pe(0,0,1),B=ugt;zy(B,N,n[0]);const H=hgt;if(zy(H,N,n[1]),a){const q=Nce,Q=n[4],ie=Fce;zy(ie,Q,N),zy(q,ie,Q);const _e=n[0];Ze(_e,B,q),y3(_e,u);const Oe=n[1];Ze(Oe,H,q),y3(Oe,u)}else if(l){const q=Nce,Q=n[5],ie=Fce;zy(ie,Q,N),zy(q,Q,ie);const _e=n[3];Ze(_e,q,B),y3(_e,u);const Oe=n[2];Ze(Oe,q,H),y3(Oe,u)}}const h=Dce;{const N=xgt;Hi(N,n[3],n[0]),fe(N,N);const B=Tgt;pe(B,n[0],n[3]),re(B,B,.5);const H=-de(B,N),q=Sgt,Q=Egt;pe(q,n[0],n[1]),re(q,q,.5),pe(Q,n[2],n[3]),re(Q,Q,.5);const ie=Cgt;Hi(ie,Q,q),fe(ie,ie);const _e=-(H+de(N,q))/de(N,ie);kn(h,q,ie,_e),y3(h,u)}const p=this._frustumBoundingSphereRadius,f=this._frustumBoundingSphereCenter,g=this._frustum,_=g.planes;if(n.some(N=>g.intersectsPoint(N))||g.intersectsPoint(h))return!0;const v=dgt;fe(v,h);const b=vgt;Hi(b,f,kce);const w=de(b,v);if(w<-p)return!1;const T=fgt;fe(T,n[0]);const S=de(T,v);if(S<=0)return!0;const C=pgt;re(C,v,w);const P=Vg(C,f),R=r.isWGS84,L=e.lij,F=R&&L[2]===2**L[0]-1,U=R&&L[2]===0,j=U?Ngt:F?Lgt:$gt,z=U?Fgt:F?Dgt:Igt,Z=g.points;{const N=n,B=kgt,H=Agt,q=Pgt,Q=kce;for(const ie of j){const _e=N[ie];if(Ice(H,N[(ie+1)%4],_e),Ice(q,Q,_e),zy(B,q,H),ogt(B,Z,1))return!1}}let W=null;if(w<2*p){const N=2.5*p;if(P>S*N+p)return!1;const B=wgt,H=N/S;for(let q=0;q<4;++q)re(B[q],n[q],H/u);te(B[4],0,0,0),W=B}else{const N=(w+p)/S,B=(w-p)/S,H=bgt;for(let q=0;q<4;++q){const Q=n[q];re(H[q+4],Q,B/u),re(H[q],Q,N/u)}W=H}if(Bq(_,W,W.length))return!1;const Y=g.lines,le=Mgt,I=Ogt;for(const N of z){fe(le,n[N]);for(const B of Y)if(fe(I,B.direction),Vgt(I,le,W,Z))return!1}return!0}_calculateSingleTileVisibilitySided(e,r){if(this._isTileVisibleInFrustum(e)){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Vr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Tl.VISIBLE_ON_SURFACE:Tl.VISIBLE_WHEN_EXTENDED}return Tl.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Bc);this._aboveGround||Eo(r,r);const i=Bn(-de(r,e.viewForward));if(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum)return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Bc),a){case st.FAR_BOTTOM_LEFT:case st.FAR_TOP_LEFT:case st.NEAR_BOTTOM_LEFT:case st.NEAR_TOP_LEFT:wG(this._extendedFrustum.planes[ci.LEFT],Bc,Bc);break;case st.FAR_BOTTOM_RIGHT:case st.FAR_TOP_RIGHT:case st.NEAR_BOTTOM_RIGHT:case st.NEAR_TOP_RIGHT:wG(this._extendedFrustum.planes[ci.RIGHT],Bc,Bc)}re(Bc,Bc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Eu(l,Bc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ha(n[st.NEAR_BOTTOM_LEFT],n[st.NEAR_BOTTOM_RIGHT],n[st.NEAR_TOP_RIGHT],Oce),ha(n[st.NEAR_BOTTOM_RIGHT],n[st.NEAR_TOP_RIGHT],n[st.NEAR_TOP_LEFT],Rce),de(Oce,Rce)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[st.NEAR_BOTTOM_LEFT],o[st.NEAR_BOTTOM_RIGHT]]=[o[st.NEAR_BOTTOM_RIGHT],o[st.NEAR_BOTTOM_LEFT]]:[o[st.NEAR_TOP_LEFT],o[st.NEAR_TOP_RIGHT]]=[o[st.NEAR_TOP_RIGHT],o[st.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Mce;return{zWithMargin:e,pointIndices:t_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Mce;return{zWithMargin:e,pointIndices:t_.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const egt=2,tgt=6,rgt=12,igt=.95,Mce=1,Bc=E(),Oce=zr(),Rce=zr(),$ce=new qo(Array,t=>{t.length!==4&&(t[0]=new cP,t[1]=new cP,t[2]=new cP,t[3]=new cP)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function zy(t,e,r){return Ze(t,e,r),fe(t,t),t}function Ice(t,e,r){return Hi(t,e,r),fe(t,t),t}function y3(t,e){return re(t,t,e/nc(t)),t}const sgt=[ci.LEFT,ci.RIGHT,ci.BOTTOM,ci.TOP,ci.FAR];function ngt(t,e,r){for(let i=0;i<r;++i)if(bi(t,e[i])<0)return!1;return!0}function Bq(t,e,r){for(const i of sgt)if(ngt(t[i],e,r))return!0;return!1}const UAe=3;function ogt(t,e,r){for(const i of e)if(de(i,t)<r)return!1;return!0}const agt=[E(),E(),E(),E(),E(),E(),E(),E()],lgt=[0,0,0,0,0,0],Lce=[E(),E(),E(),E(),E(),E()],Dce=E(),cgt=E(),Nce=E(),ugt=E(),hgt=E(),Fce=E(),dgt=E(),pgt=E(),fgt=E(),mgt=E(),ggt=E(),ygt=E(),_gt=E(),kce=Pe(0,0,0),vgt=E(),bgt=[E(),E(),E(),E(),E(),E(),E(),E()],wgt=[E(),E(),E(),E(),E()],xgt=E(),Tgt=E(),Sgt=E(),Egt=E(),Cgt=E(),Agt=E(),Pgt=E(),Mgt=E(),Ogt=E(),Rgt=E(),$gt=[0,1,2,3],Igt=[0,1,2,3],Lgt=[0,1,3],Dgt=[0,1,3],Ngt=[1,2,3],Fgt=[1,2,3],kgt=E();function Ugt(t,e,r){let i=1/0,s=-1/0;for(const n of r){const o=de(e,n);i=Math.min(i,o),s=Math.max(s,o)}t[0]=i,t[1]=s}function zgt(t,e,r,i){let s=1/0,n=-1/0;for(const o of i){const a=de(r,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const Bgt=[0,0];function Vgt(t,e,r,i){const s=Rgt;zy(s,t,e);const n=Bgt;return Ugt(n,s,r),zgt(n[0],n[1],s,i)}let Ggt=class{constructor(e){this._camera=new Je,this._focusOnMap=[0,0],this._screenRect=jt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Qmt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,QO(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=b4e(e.extent,this._focusOnMap),e.measures.visibility!==Tl.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=jgt,i=1<<r,s=e.measures.screenRect;Tu(s);let n=0;const o=e.lij,a=o[0],l=a+r,c=o[1]<<r,u=o[2]<<r,h=this._tileSizeWithBias(e),p=h*h,f=this._camera,{frustum:g,viewport:_}=f;if(this._renderCoordsHelper.viewingMode===Ne.Local||a>UAe){const v=Uce;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=l2,w=Wgt,T=Tu();for(let P=0;P<4;++P)this._toRenderCoords(v,Vce[P][0],Vce[P][1],w[P]),f.projectToScreen(w[P],b[P]),AY(T,b[P]);const S=Bq(g,w,4),C=T[0]>_[2]||T[1]>_[3]||T[2]<_[0]||T[3]<_[1];if(S||C)return void(e.measures.shouldSplit=!1)}for(let v=0;v<i;v++)for(let b=0;b<i;b++)if(n+=this._computeScreenArea(l,c+v,u+b,s),n>p)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Tl.VISIBLE_WHEN_EXTENDED?this._tileSize*Hgt:this._tileSize}_computeScreenArea(e,r,i,s){this._tilingScheme.ensureMaxLod(e);const n=Uce;this._tilingScheme.getExtent(e,r,i,n);const o=qgt;return this._toRenderCoords(n,0,3,o[0]),this._toRenderCoords(n,2,3,o[1]),this._toRenderCoords(n,2,1,o[2]),this._toRenderCoords(n,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],s)+this._computeTriangleScreenArea([o[2],o[1],o[3]],s)}_computeTriangleScreenArea(e,r){const i=this._camera.frustum[ci.NEAR];let s=0,n=-1,o=-1;for(let a=0;a<3;++a)bi(i,e[a])>0?(s++,n===-1&&(n=a)):o===-1&&(o=a);if(s===0)return this._computeTriangleScreenAreaInside(e,r);if(s===1){const a=Bce,l=(n+1)%3,c=(n+2)%3,u=n;ce(a[0],e[l]),ce(a[1],e[c]),vL(a[2],e[c],e[u],i);const h=this._computeTriangleScreenAreaInside(a,r);return vL(a[1],e[l],e[u],i),h+this._computeTriangleScreenAreaInside(a,r)}if(s===2){const a=Bce,l=o;ce(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return vL(a[1],e[l],e[c],i),vL(a[2],e[l],e[u],i),this._computeTriangleScreenAreaInside(a,r)}return 0}_computeTriangleScreenAreaInside(e,r){for(let i=0;i<3;i++)this._camera.projectToRenderScreen(e[i],zce),this._camera.renderToScreen(zce,l2[i]),T_(r,l2[i],r);return YYe(l2[0],l2[1],l2[2])}_toRenderCoords(e,r,i,s){return _L[0]=e[r],_L[1]=e[i],_L[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(_L,this._tilingScheme.spatialReference,s),s}};const jgt=2,Hgt=5,l2=[us(),us(),us(),us()],Uce=jt(),_L=E(),qgt=[E(),E(),E(),E()],zce=Go(),Bce=[E(),E(),E()];function vL(t,e,r,i){const s=bi(i,e),n=bi(i,r),o=Math.abs(n-s);re(t,e,Math.abs(n)/o),kn(t,t,r,Math.abs(s)/o)}const Wgt=[E(),E(),E(),E()],Vce=[[0,3],[2,3],[2,1],[0,1]];function GUt(t,e,r){if(t==null||r==null)return!1;let i=!0;return bn[0]=t.xmin!=null?t.xmin:0,bn[1]=t.ymin!=null?t.ymin:0,bn[2]=t.zmin!=null?t.zmin:0,i=i&&Wi(bn,t.spatialReference,0,e,r,0,1),bn[0]=t.xmax!=null?t.xmax:0,bn[1]=t.ymax!=null?t.ymax:0,bn[2]=t.zmax!=null?t.zmax:0,i=i&&Wi(bn,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function zAe(t,e,r){if(t==null||r==null)return!1;let i=!0;return bn[0]=t.xmin!=null?t.xmin:0,bn[1]=t.ymin!=null?t.ymin:0,bn[2]=t.zmin!=null?t.zmin:0,i=i&&Wi(bn,t.spatialReference,0,bn,r,0,1),e[0]=bn[0],e[1]=bn[1],bn[0]=t.xmax!=null?t.xmax:0,bn[1]=t.ymax!=null?t.ymax:0,bn[2]=t.zmax!=null?t.zmax:0,i=i&&Wi(bn,t.spatialReference,0,bn,r,0,1),e[2]=bn[0],e[3]=bn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const bn=E();let vo=class extends Me{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ae.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=jt();return zAe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Mt,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new kt}initialize(){this.addHandles([he(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ti),he(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),si)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(yt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=wi(this._frameWorker)}addClient(){const e=fu();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Yr(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Wa))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=yt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Ggt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new cP(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){if(e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),!(e.length>Xgt))return e.toArray();Tu(bL);for(let r=0;r<e.length;r++)if(T_(bL,e.data[r].measures.screenRect,bL),Pl(bL)>Ygt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!P6(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Tl.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Tl.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};d([m({constructOnly:!0})],vo.prototype,"scheduler",void 0),d([m({constructOnly:!0})],vo.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],vo.prototype,"tilingSchemeOwner",void 0),d([m({constructOnly:!0})],vo.prototype,"cameraOnSurface",void 0),d([m({constructOnly:!0})],vo.prototype,"focus",void 0),d([m({constructOnly:!0})],vo.prototype,"viewState",void 0),d([m({constructOnly:!0})],vo.prototype,"terrain",void 0),d([m()],vo.prototype,"tiles",void 0),d([m()],vo.prototype,"tileSize",void 0),d([m({readOnly:!0})],vo.prototype,"tilingScheme",null),d([m()],vo.prototype,"filterExtent",null),d([m({readOnly:!0})],vo.prototype,"_filterExtentRect",null),d([m({readOnly:!0})],vo.prototype,"_rootTileIds",null),d([m({value:!1})],vo.prototype,"suspended",null),d([m({readOnly:!0})],vo.prototype,"updating",null),vo=d([V("esri.views.3d.layers.support.FeatureTileTree3D")],vo);const bL=jt(),Ygt=10,Xgt=50;let gs=class extends Me{constructor(){super(...arguments),this._propertiesPool=new l0({camera:Je},this),this._lastSeenCameraProjectionValues=new Je,this.mode=Br.ANIMATING,this._cssCamera=new Je,this._camera=new Je,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Gs,this.viewingMode=Ne.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new fg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new l0({camera:Je},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ne.Global){const e=Vr(this.spatialReference).radius;this.camera=new Je({eye:Pe(4*e,0,0),center:Pe(e,0,0),up:Pe(0,0,1)})}else this.camera=new Je({eye:Pe(0,0,100),center:Pe(0,0,0),up:Pe(0,1,0)})}get animation(){return this.cameraController instanceof gO&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}get camera(){return this._camera}set camera(e){e!==zu&&zu.copyFrom(e),zu.computeUp(this.viewingMode),this.events.emit("before-camera-change",zu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,zu)&&(this._lastSeenCameraProjectionValues.copyFrom(zu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(zu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(zu),this._cameraChanged=!r.almostEquals(zu),this._cameraChanged)){const i=yfe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Br.IDLE}get updating(){return this.mode!==Br.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ne.Global}get isLocal(){return this.viewingMode===Ne.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(Gce),this.addHandles(Ih(()=>e.state===Qi.Finished||e.state===Qi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Gce),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Qi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Qi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();zu.copyFrom(this._get("camera")),e(zu),this.camera=zu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[Kt.TOP]!==r.padding[Kt.TOP]||e.padding[Kt.RIGHT]!==r.padding[Kt.RIGHT]||e.padding[Kt.BOTTOM]!==r.padding[Kt.BOTTOM]||e.padding[Kt.LEFT]!==r.padding[Kt.LEFT]}};d([m()],gs.prototype,"mode",void 0),d([m({readOnly:!0,type:lE})],gs.prototype,"animation",null),d([m({type:Je})],gs.prototype,"cssCamera",null),d([m()],gs.prototype,"_cssCamera",void 0),d([m({type:Je})],gs.prototype,"camera",null),d([m()],gs.prototype,"_camera",void 0),d([m({readOnly:!0})],gs.prototype,"pixelRatio",null),d([m()],gs.prototype,"rasterPixelRatio",void 0),d([m()],gs.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],gs.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],gs.prototype,"updating",null),d([m({})],gs.prototype,"_contentCamera",void 0),d([m({type:Je})],gs.prototype,"contentCamera",null),d([m({readOnly:!0})],gs.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],gs.prototype,"constraints",void 0),d([m({readOnly:!0})],gs.prototype,"events",void 0),d([m({readOnly:!0})],gs.prototype,"isGlobal",null),d([m({readOnly:!0})],gs.prototype,"isLocal",null),d([m({readOnly:!0})],gs.prototype,"viewingMode",void 0),d([m({readOnly:!0})],gs.prototype,"spatialReference",void 0),d([m()],gs.prototype,"navigating",null),d([m()],gs.prototype,"stationary",null),d([m()],gs.prototype,"_cameraChanged",void 0),d([m()],gs.prototype,"cameraController",null),gs=d([V("esri.views.3d.state.ViewState")],gs);const Zgt=gs,zu=new Je,Gce="ViewStateHandles";function BAe(t){return t?i0t:s0t}function Jgt(t,e){return e!=null&&e.mode?e.mode:BAe(t).mode}function Kgt(t,e){return e??BAe(t)}function Qgt(t,e){return Jgt(t!=null&&t.hasZ,e)}function qUt(t,e){return Kgt(t!=null&&!!t.hasZ,e)}function WUt(t){const e=e0t(t),r=Qgt(t.geometry,e);return{mode:r,offset:e!=null&&r!=="on-the-ground"?jAe(e):0}}function e0t(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function VAe(t,e){if(!(t!=null&&t.offset))return 0;const{offset:r,unit:i}=t;if(i==="decimal-degrees")return 0;const s=i!=="unknown"&&i?i:"meters",n=FNe(e);return n?ro(r,s,n):0}function YUt(t,e,r,i=null){return GAe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,r,i)}function XUt(t,e,r,i,s=null){return GAe(t,e[0],e[1],e.length>2?e[2]:0,r,i,s)}function GAe(t,e,r,i,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=t0t(e,r,i,s,t,n);return r0t(l,e,r,i,s,t,o,a)}function t0t(t,e,r,i,s,n){const o=VAe(n,i);switch(n.mode){case"absolute-height":return{absoluteZ:r+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,i,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,r,i,"ground")??0;return{absoluteZ:r+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,r,i,"scene")??0;return{absoluteZ:r+a+o,elevation:a}}}}function r0t(t,e,r,i,s,n,o,a){const l=VAe(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,r,i,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,r,i,s,"scene")??0)+l)}}function ZUt(t,e){if(e==null)return!1;const{mode:r}=e;return r!=null&&(t==="scene"&&r==="relative-to-scene"||t==="ground"&&r!=="absolute-height")}function JUt(t,e,r){return r&&r.mode!==e?`${t} only support ${e} elevation mode`:null}function KUt(t,e,r){return(r==null?void 0:r.mode)===e?`${t} do not support ${e} elevation mode`:null}function QUt(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function e9t(t,e){e&&t.warn(".elevationInfo=",e)}function jAe(t){return((t==null?void 0:t.offset)??0)*ETe(t==null?void 0:t.unit)}const i0t={mode:"absolute-height",offset:0},s0t={mode:"on-the-ground",offset:null},n0t="OBJECTID";let t9t=class extends dR{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function HAe(t){return Wh(t)&&t.intersector===ki.PCL&&!!t.target}let i9t=class extends C_e{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},n9t=class extends dR{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}},a9t=class extends dR{constructor(e,r){super(e,null),this.createTiles3DGraphic=r}};function C8(t){return Wh(t)&&t.intersector===ki.I3S&&!!t.target}function qAe(t){return Wh(t)&&t.intersector===ki.VOXEL&&!!t.target}function o0t(t){return Wh(t)&&t.intersector===ki.TILES3D&&!!t.target}function WAe(t,e){var r,i;return ok(t)||ak(t)?IO((r=t.target)==null?void 0:r.object,e):Xnt(t)?(i=e.map)==null?void 0:i.ground:HAe(t)||C8(t)||FEe(t)||qAe(t)?IO(t.target,e):null}function c9t(t,e){const r=kK(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function kK(t,e){var r;if(t==null)return null;if(ok(t)||ak(t))return jce((r=t.target)==null?void 0:r.object,e);if(HAe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(qAe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(o0t(t)){const i=t.target.createTiles3DGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return FEe(t)||RK(t)?jce(t.target,e):C8(t)?a0t(t.target,e):null}function jce(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const r=IO(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function a0t(t,e){const r=IO(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?c0t(i.getGraphicFromIntersectorTarget(t)):null}function l0t(t,e){const r=IO(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function c0t(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function IO(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(r=>r.uid===t.layerUid)}function u9t(t,e){if(ok(t)||ak(t))return Gg(t.target.object.boundingVolumeWorldSpace.bounds);if(RK(t)){tye(wL,t.transformation);const r=Math.max(wL[0],wL[1],wL[2]);return t.target.baseBoundingSphere.radius*r}if(C8(t)){const r=l0t(t.target,e);return r?.5*Cve(r):null}return null}function h9t(t){return!ok(t)&&!ak(t)&&(RK(t)?t.target.numLodLevels>1:!!C8(t))}const wL=E();async function u0t(t,e,r,i){const s=r?XAe(t,r):i,n=us(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=zh(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Co.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=d0t(t,o.results.all,s.graphics),l=o.results.ground,c=WAe(l,t),u=c!=null&&"type"in c&&KM(c.type)?c:null,h={screenPoint:e,results:a,ground:{mapPoint:bM(t,l),distance:Wh(l)?l.distanceInRenderSpace:0,layer:u}};return yi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=o),h}function h0t(t,e,r,i){const s=r?XAe(t,r):i,n=s.graphics!=null&&(s.graphics.include!=null||s.graphics.exclude!=null),o=Jd(e);s.enableDraped=s.include&&!s.include.has(G_)||s.exclude&&s.exclude.has(G_);const a=t.sceneIntersectionHelper,l=zh(t.state.viewingMode);if(l.options.selectionMode=!0,l.options.store=n?Co.ALL:Co.MIN,l.options.hud=!(r!=null&&r.excludeHud),a.intersectIntersectorScreen(o,l,s),n){for(const c of l.results.all){const u=kK(c,t);if(u==null||u.type!=="graphic"||YAe(s.graphics,u.graphic))return bM(t,c)}return null}return bM(t,l.results.min)}function d0t(t,e,r){const i=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=WAe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&KM(a.type)))break;const l=kK(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const h=UK(l.graphic);if(s.has(h))continue;s.add(h)}if(!YAe(r,l.graphic))continue}const c=bM(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const h=l.element.toSource(c);i.push({...l,mapPoint:c,distance:u,sourcePoint:h})}else i.push({...l,mapPoint:c,distance:u})}return i}function bM(t,e,r){return e.getIntersectionPoint(FT)?(r=Vq(t,FT,r),e.intersector===ki.TERRAIN&&t.basemapTerrain&&(r.z=Wf(t.basemapTerrain,r)??0),r):null}function UK(t){var s;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const n=i.objectIdField??n0t,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}function YAe(t,e){const r=UK(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}function Vq(t,e,r){let i=t.spatialReference||Xe.WGS84;return ya(e,t.renderSpatialReference,FT,i)?e=FT:(i=Xe.WGS84,ya(e,t.renderSpatialReference,FT,i)&&(e=FT)),r?(r.x=e[0],r.y=e[1],r.z=e[2],r.spatialReference=i):r=new Ke(e,i),r}function XAe(t,e){const r=Gq(t,e.include,LO.INCLUDE),i=Gq(t,e.exclude,LO.EXCLUDE);return{include:r.layerUids,exclude:i.layerUids,graphics:{include:r.graphicUids,exclude:i.graphicUids}}}function Gq(t,e,r,i={layerUids:void 0,graphicUids:void 0}){if(!e)return i;if(e instanceof W_)p0t(i,UK(e)),r===LO.INCLUDE&&(t.graphicsView!=null&&e.layer===t?_3(i,t.graphicsView.processor.layer.id):e.layer&&_3(i,e.layer.uid));else if(lV(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?_3(i,t.graphicsView.processor.layer.id):s===t.map.ground?_3(i,G_):Gq(t,s,r,i);else"uid"in e&&_3(i,e.uid);return i}function _3(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function p0t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}const FT=E();var LO;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(LO||(LO={}));let f0t=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new kt,this._tolerance=iE,this._tmpRay=Un(),this._tmpRegion=jt(),this._validateHUDIntersector=zh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),Hce(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,Hce(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=Co.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(TL,i,s),TL[0]+=.0466,TL[1]-=.0123,iJ(e,TL,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Wh(s)&&s.intersector!==ki.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=iE){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===ki.TERRAIN?1:i.type===ki.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===ki.TERRAIN?1:i.type===ki.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return rJ(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Ne.Local||e==null||pe(r,e.origin,fe(ze.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=HM(n.spatialReference),l=r!=null?r.mode:"absolute-height",c=jAe(r)/a,u=(l!=="on-the-ground"?c+i:0)*a/o.unitInMeters,{camera:h}=n.state;if(l==="absolute-height"){const S=o==null?void 0:o.getAltitude(h.eye),C=de(fe(v3,e.direction),o.worldUpAtPosition(h.eye,y0t));if(S<u&&C<0||S>=u&&C>0)return null;if(o.intersectInfiniteManifold(e,u,v3)){const P=Vq(n,v3);return P.z??(P.z=0),P.z-=c,P}return null}const p=ze.get();h.projectToRenderScreen(e.origin,p);const f=new qce(null,this._forEachLayer),{slicePlane:g}=n,_=g!=null?mre(g):null,v=zh(this.viewingMode);v.options.store=Co.MIN,v.options.verticalOffset=u;const b=e.origin,w=pe(ze.get(),b,e.direction);v.reset(b,w,h),v.point=p;const T=s?"type"in s&&s.type==="graphics"?S=>S.layerUid!==s.uid:S=>S.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const S=C=>(!T||T(C))&&!!C.lastValidElevationBB;v.intersect(f.layers,p,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(C=>{if(C.type===ki.I3S||C.type===ki.TERRAIN||C.type===ki.TILES3D){const P=C.slicePlaneEnabled?_:null;C.intersect(v,P,v.rayBegin,v.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const C=S.slicePlaneEnabled?_:null;S.intersect(v,C,v.rayBegin,v.rayEnd,p)}})}if(v.results.min.getIntersectionPoint(v3)){const S=Vq(n,v3);return S.z=i,S}return null}computeIntersection(e,r,i,s){var _;if(e==null)return;const n=this._view.state.camera,o=ze.get();n.projectToRenderScreen(e.origin,o);const a=new qce(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const l=e.origin,c=pe(ze.get(),e.origin,e.direction);r.reset(l,c,n),r.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,h=u!=null?mre(u):null;r.intersect(a.sliceableLayers,o,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const b=v.layerUid,w=Array.isArray(b),T=w?b:[b];w&&(r.options.filteredLayerUids=[]);let S=!1;for(const C of T)a.filterLayerUid(C)?S=!0:w&&r.options.filteredLayerUids.push(C);if(r.options.isFiltered=!S,v.isGround&&p||!r.options.isFiltered){const C=v.slicePlaneEnabled?h:null;v.intersect(r,C,l,c,o,s)}});const f=ze.get(),g=this._view.basemapTerrain;if(i&&i.enableDraped&&g.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const v=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=ze.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,g.spatialReference),w[2]=((_=this._view.elevationProvider)==null?void 0:_.getElevation(f[0],f[1],f[2],b,"ground"))??0,v.intersect(r,w,r.results.ground,T=>a.filterRenderGeometry(T))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;s0(this._tmpRegion,eG);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new g0t(b);i.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),AY(n,w.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-uP),u=Math.max(0,n[1]-uP),h=Math.min(fa(n)+2*uP,a-c),p=Math.min(Pl(n)+2*uP,l-u);if(h<=0||p<=0)return;const f=new Uint8Array(h*p*4);this._view._stage.renderer.readHUDVisibility(c,u,h,p,f);let g=!0;const _=e.results.max.dist==null;let v=0;for(const b of s)for(const w of m0t){const T=4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*h);if(!(T<0||T>=f.length)&&f[T]){g&&(e.results.min.copy(b.result),g=!1),_&&e.results.max.copy(b.result),e.options.store===Co.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const uP=1,m0t=(()=>{const t=[],e=uP;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let g0t=class{constructor(e){this.result=e,this.screenPoint=Go()}},xL;function Hce(t){return xL&&xL.viewingMode===t||(xL=zh(t)),xL}let qce=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Wce(t){return typeof t=="object"&&"intersect"in t}const v3=E(),y0t=E(),TL=Go();let m9t=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},_0t=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(yt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Wa);else for(const r of this._queries)r.result.reject(hr())}queryElevation(e,r,i,s=0){const n=Wo(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),lo(i,()=>{VW(this._queries,o),n.reject(hr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const s=r.map(u=>[u.x,u.y]),n=r.reduce((u,h)=>Math.min(u,h.minDemResolution),1/0),o=new VE({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(h=>lo(h.signal,()=>{u++,h.result.reject(hr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((h,p)=>{h.signal!=null&&h.signal.aborted?h.result.reject(hr()):h.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(h=>h.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Wa)}}},CF=class{constructor(e=1/0,r=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=r}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,r){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,r)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},hP=class extends Gs.EventedMixin(Me){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Ae(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,r,i,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&co(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=SL(o,this._im,e,r,i,s,n),o==null&&(o=SL(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=SL(o,this._scene,e,r,i,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r,i){const s=new CF;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,r,i);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),i==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new CF;for(const r of[this._im,this._ground,this._scene])r.forEach(i=>{if(i.getRootElevationBounds){const s=i.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,r,i,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,r,o,a);return n==="scene"?SL(c,this._scene,e,r,i,s,n):c}catch(c){return Uo(c),this.getElevation(e,r,i,s,n)}}register(e,r){this.addHandles(r.on("elevation-change",i=>this.emit("elevation-change",i)),r),this._providersFromContext(e).push(r)}unregister(e){this.removeHandles(e);for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const r=this._cachedQuery;if(r!=null&&co(e,r.spatialReference))return r;r==null||r.destroy({completeTasks:!0});const{wkid:i,wkt:s,wkt2:n,latestWkid:o}=e,a=new _0t(this.view.resourceController.scheduler,new Xe({wkid:i,wkt:s,wkt2:n,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function SL(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([m({constructOnly:!0})],hP.prototype,"view",void 0),d([m()],hP.prototype,"spatialReference",null),hP=d([V("esri.views.3d.support.CombinedElevationProvider")],hP);let DO=class jq{static isValidProfile(e){return e in jq.profiles}static getDefaultProfile(){return se("esri-iPhone")?"low":"medium"}static apply(e,r){const i=jq.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxNumberOfDrawCalls=i.graphics3D.maxNumberOfDrawCalls,r.graphics3D.maxTotalNumberOfVertices=i.graphics3D.maxTotalNumberOfVertices,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods,r.graphics3D.uncompressedTextureDownsamplingEnabled=i.graphics3D.uncompressedTextureDownsamplingEnabled;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.vtlContentZoom=i.tiledSurface.vtlContentZoom,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};DO.test={reset(){const t=ZAe();for(const e of Object.keys(t))DO.profiles[e]=t[e]}};const b3={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function ZAe(){const t=!!se("esri-mobile"),e=!!se("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+b3.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+b3.GalaxyS20:750+b3.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+b3.SurfacePro7:1500+b3.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=ZAe()})(DO||(DO={}));const DN=DO,JAe=new Fe([0,255,255]),KAe=1,QAe=.25,ePe=new Fe([0,0,0]),tPe=.4,rPe=.2;let Cf=class extends Me{constructor(){super(...arguments),this.color=JAe.clone(),this.haloColor=null,this.haloOpacity=KAe,this.fillOpacity=QAe,this.shadowOpacity=tPe,this.shadowColor=ePe.clone(),this.shadowDifference=rPe}};d([m({type:Fe})],Cf.prototype,"color",void 0),d([m({type:Fe})],Cf.prototype,"haloColor",void 0),d([m()],Cf.prototype,"haloOpacity",void 0),d([m()],Cf.prototype,"fillOpacity",void 0),d([m()],Cf.prototype,"shadowOpacity",void 0),d([m({type:Fe})],Cf.prototype,"shadowColor",void 0),d([m()],Cf.prototype,"shadowDifference",void 0),Cf=d([V("esri.views.3d.support.HighlightOptions")],Cf);const iPe=Cf;function v0t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function sPe(t){return typeof t=="string"?$s(t):ge(t)}function b0t(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))i[s]=n.map(o=>b0t({item:o},e,r).item);else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r==null?void 0:r[s]);i[s]=JSON.stringify(o)}else i[s]=JSON.stringify(n);else i[s]=n}return i}function w0t(t){return{geometryType:eR(t[0]),geometries:t.map(e=>e.toJSON())}}function nPe(t,e,r){const i=I4e(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let rb=class extends We{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=N4(this.outSpatialReference),i.inSR=N4(r.spatialReference),i.geometries=JSON.stringify({geometryType:eR(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};d([m()],rb.prototype,"geometries",void 0),d([m({json:{read:{source:"outSR"}}})],rb.prototype,"outSpatialReference",void 0),d([m()],rb.prototype,"transformation",void 0),d([m()],rb.prototype,"transformForward",void 0),rb=d([V("esri.rest.support.ProjectParameters")],rb);const zK=rb,x0t=ma(zK);async function oPe(t,e,r){e=x0t(e);const i=sPe(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=eR(e.geometries[0]),a=v0t(s,r);return Wr(i.path+"/project",a).then(({data:{geometries:l}})=>nPe(l,o,n))}async function BK(t=null,e){var s,n;if(ii.geometryServiceUrl)return ii.geometryServiceUrl;if(!t)throw new J("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||kl.getDefault():t,await r.load({signal:e});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new J("internal:geometry-service-url-not-configured");return i}async function T0t(t,e,r=null,i){const s=await BK(r,i),n=new zK;n.geometries=[t],n.outSpatialReference=e;const o=await oPe(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new J("internal:geometry-service-projection-failed")}const S0t=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:BK,projectGeometry:T0t},Symbol.toStringTag,{value:"Module"}));let E0t=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=xa(this.spatialReference,Vr(this.spatialReference).metersPerDegree);const i=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=BK(i).catch(()=>{throw new J("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof Ke?l:new Ke(l,this.spatialReference)),o=new zK({geometries:n,outSpatialReference:Xe.WGS84}),a=(await oPe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}};var Bt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Bt||(Bt={}));const ib=[Bt.ELEVATION,Bt.MAP];async function C0t(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=r.results[0],s=(i.distance??0)*(1+A0t),n=r.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(r.results=r.results.slice(0,n)),i&&r.ground.distance>s&&(r.ground.mapPoint=null),r}const A0t=.05;async function P0t(t,e){var p,f,g,_,v;const{results:r,ground:i}=await C0t(t,e),s=(!i.layer||!KM(i.layer.type))&&i.mapPoint,n=[],o=R0t(t),a=s?M0t(t,o):O0t;let l=0,c=0;const u=()=>{const b=a.layerViews[c];s&&b&&"fetchPopupFeaturesAtLocation"in b&&n.push({mapPoint:i.mapPoint,layerView:b}),++c};let h=null;for(;l<r.length||c<a.layerViews.length;){const b=r[l];if(b&&b.type!=="graphic")++l;else if(((p=b==null?void 0:b.layer)==null?void 0:p.type)!=="scene"||((f=b==null?void 0:b.layer)==null?void 0:f.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(_=b.layer)==null?void 0:_.uid,T=a.layerUids.has(w)&&b.distance===i.distance,S=o.get((v=b.layer)==null?void 0:v.uid);if(h??(h=b.mapPoint),c<a.layerViews.length&&(T||(b.distance??0)>i.distance)&&a.layerViews[c]!==S){u();continue}n.push({graphic:b.graphic,layerView:S}),++l}else u();else++l}return h??(h=i.mapPoint),{hits:n,location:h}}function M0t(t,e){const r=new Set,i=[];for(let n=t.basemapTerrain.numLayers(Bt.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,Bt.MAP);r.add(o.layer.uid),i.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(r.add(n),i.push(o))}return i.reverse(),{layerUids:r,layerViews:i}}const O0t={layerUids:new Set,layerViews:[]};function R0t(t){const e=new Map;for(const r of t.allLayerViews){const i=r.layer.uid;e.set(i,r)}return e}let Kc=class extends Me{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};d([m()],Kc.prototype,"minTotalNumberOfFeatures",void 0),d([m()],Kc.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],Kc.prototype,"maxNumberOfDrawCalls",void 0),d([m()],Kc.prototype,"maxTotalNumberOfVertices",void 0),d([m()],Kc.prototype,"snapshotAvailable",void 0),d([m()],Kc.prototype,"polygonLodFactor",void 0),d([m()],Kc.prototype,"polylineLodFactor",void 0),d([m()],Kc.prototype,"skipHighSymbolLods",void 0),d([m()],Kc.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Kc=d([V("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Kc);let lp=class extends Me{constructor(){super(...arguments),this.lodFactor=1}};d([m()],lp.prototype,"lodFactor",void 0),lp=d([V("esri.views.3d.support.QualitySettings.LoDFactorSettings")],lp);let Ag=class extends Me{constructor(){super(...arguments),this.object=new lp,this.point=new lp,this.integratedMesh=new lp,this.pointCloud=new lp,this.uncompressedTextureDownsamplingEnabled=!1}};d([m({type:lp})],Ag.prototype,"object",void 0),d([m({type:lp})],Ag.prototype,"point",void 0),d([m({type:lp})],Ag.prototype,"integratedMesh",void 0),d([m({type:lp})],Ag.prototype,"pointCloud",void 0),d([m()],Ag.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Ag=d([V("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Ag);let Jy=class extends Me{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0}};d([m()],Jy.prototype,"lodBias",void 0),d([m()],Jy.prototype,"angledSplitBias",void 0),d([m()],Jy.prototype,"vtlContentZoom",void 0),d([m()],Jy.prototype,"reduceTileLevelDifferences",void 0),Jy=d([V("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Jy);let kT=class extends Me{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],kT.prototype,"pixelRatio",void 0),d([m()],kT.prototype,"maxTotalNumberOfFeatures",void 0),kT=d([V("esri.views.3d.support.QualitySettings.HeatmapSettings")],kT);let Io=class extends Me{constructor(){super(...arguments),this.graphics3D=new Kc,this.sceneService=new Ag,this.tiledSurface=new Jy,this.heatmap=new kT,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:Kc})],Io.prototype,"graphics3D",void 0),d([m({type:Ag})],Io.prototype,"sceneService",void 0),d([m({type:Jy})],Io.prototype,"tiledSurface",void 0),d([m({type:kT})],Io.prototype,"heatmap",void 0),d([m()],Io.prototype,"fadeDuration",void 0),d([m()],Io.prototype,"antialiasingEnabled",void 0),d([m()],Io.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],Io.prototype,"highQualityTransparency",void 0),d([m()],Io.prototype,"highResolutionAtmosphere",void 0),d([m()],Io.prototype,"reflections",void 0),d([m()],Io.prototype,"ambientOcclusion",void 0),d([m()],Io.prototype,"memoryLimit",void 0),d([m()],Io.prototype,"additionalCacheMemory",void 0),d([m()],Io.prototype,"frameRate",void 0),d([m()],Io.prototype,"maximumPixelRatio",void 0),Io=d([V("esri.views.3d.support.QualitySettings.QualitySettings")],Io);const Yce=Io;let $0t=class Hq{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=lUe(s),this.referenceEllipsoid=Vr(r),this.sphericalPCPF=Fh(r)}set extent(e){e&&cUe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return yUe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return r_e(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){_Ue(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return pUe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return fUe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,ls.X,ze.get()),s=this.worldBasisAtPosition(e,ls.Y,ze.get()),n=this.worldBasisAtPosition(e,ls.Z,ze.get());return Pm(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,ze.get()),s=this.worldBasisAtPosition(e,ls.Y,ze.get()),n=Oye(r,s,i);return ga(n)}intersectManifoldClosestSilhouette(e,r,i){return gU(this._coordinateSystem,r,this._tmpCoordinateSystem),gUe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){gU(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=ze.get();return mUe(this._tmpCoordinateSystem,e,s)?ce(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Ne.Global)return this.intersectManifold(e,r,i);gU(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=ze.get();return ex(s.plane,e,n)?ce(i,n):null}toRenderCoords(e,r,i){return h5(e)?Qa(e,r,this.spatialReference):ya(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return h5(r)?(i!=null&&(r.spatialReference=i),_m(e,this.spatialReference,r)?r:null):ya(e,this.spatialReference,r,i)?r:null}static create(e,r){switch(e){case Ne.Local:return new Hq(Ne.Local,r,xa(r),dUe());case Ne.Global:return new Hq(Ne.Global,r,1,hUe(r))}}static renderUnitScaleFactor(e,r){return YV(e)/YV(r)}};var jf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(jf||(jf={}));const I0t=(()=>{const t=new Array;return t[jf.ELEVATION]=10,t[jf.BASEMAP]=10,t[jf.I3S_INDEX]=10,t[jf.I3S_DATA]=10,t[jf.SYMBOLOGY]=5,t})(),L0t=30;function D0t(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function N0t(t){return new Da({view:t})}const Xce=.1,EL=1,eB=1,F0t=.75,k0t=.6,Zce=1.3;let Da=class extends Me{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new BEe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(yw({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(EL),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,r){return new sot(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<k0t&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(EL)):e?(this._memoryPredicted>1.1*eB||this._usedMemory>eB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>Xce&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Zce),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>eB?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Zce),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<F0t&&this._quality<EL?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,Xce),EL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,u,h;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory;let r=(((h=this.view.basemapTerrain)==null?void 0:h.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(p=>{if(D0t(p)){const f=p.ignoresMemoryFactor?this._quality:1;r+=p.usedMemory*f,i+=p.unloadedMemory*f}});const s=this._warnMemoryUsage==null||Math.round(10*r)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(r>n&&s){this._warnMemoryUsage=r;const p=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",f=Math.round(100*this._quality);ae.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(n)} Current: ${p(r)} Projected: ${p(r+i)} Quality: ${f}%`)}this._usedMemory=r/n,this._memoryPredicted=(r+i)/n;const o=n-r;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r},disableMemCache:()=>e.disableMemCache()}}};d([m({constructOnly:!0})],Da.prototype,"view",void 0),d([m()],Da.prototype,"maxMemory",null),d([m()],Da.prototype,"additionalCacheMemory",null),d([m({readOnly:!0})],Da.prototype,"memoryFactor",null),d([m({readOnly:!0})],Da.prototype,"updating",null),d([m({readOnly:!0})],Da.prototype,"usedMemory",null),d([m({readOnly:!0})],Da.prototype,"usedCacheMemory",null),d([m()],Da.prototype,"_quality",void 0),d([m()],Da.prototype,"_usedMemory",void 0),d([m()],Da.prototype,"_updating",void 0),d([m()],Da.prototype,"_stableQuality",void 0),d([m()],Da.prototype,"_maxMemory",void 0),d([m()],Da.prototype,"_additionalCacheMemory",void 0),Da=d([V("esri.views.3d.support.MemoryController")],Da);let U0t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},z0t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new B0t}},B0t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},V0t=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new z0t(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,ht(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},NN=class extends Me{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new V0t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(yt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=wi(this._frameTask),this._tasks.forEach(e=>Ja(e.abortController)),this._loadQueue=Ae(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=Wo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return lo(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new q0t(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;$M(e.resolvers,r),r.reject(hr()),e.resolvers.length===0&&(e.status===th.DOWNLOADING&&(e.status=th.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=th.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=W0t((s==null?void 0:s.uid)||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(ht(e.status===th.DOWNLOADING),e.status=th.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();vt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==th.DOWNLOADED&&(r.err=r.err||hr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!ns(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)ns(r)?s.reject(r):s.reject(new J("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i>0?ge(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===th.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=th.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Wr(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===th.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,h=j0t(u);if(s="image",e.size=u.byteLength,h==="unknown")return e.request=Wr(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(g=>a(g.data),l);const p=new Blob([u],{type:h}),f=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(f),e.request=Wr(f,{responseType:s,timeout:i,signal:n}),e.request.then(g=>a(new VK(g.data,h,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};d([m({readOnly:!0})],NN.prototype,"updating",void 0),NN=d([V("esri.views.3d.support.StreamDataLoader")],NN);const G0t={numRetries:0};function j0t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let VK=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}};function H0t(t){return"image"in t&&"type"in t}let q0t=class extends U0t{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=th.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=G0t.numRetries}};function W0t(t,e,r){return`${t}:${e}:${r}`}var th;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(th||(th={}));let FN=class extends Me{constructor(){super(...arguments),this.updating=!1}};function Y0t(t){return new Ad({view:t})}d([m({readOnly:!0})],FN.prototype,"updating",void 0),FN=d([V("esri.views.3d.support.ResourceControllerMain")],FN);let Ad=class extends FN{constructor(){super(...arguments),this._immediateTask=hE,this._normalTask=hE,this._updatingObjects=nm([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=wYe(),this._memoryController=N0t(this.view),this._streamDataLoader=new NN,this._streamDataLoader.setup(L0t,I0t,this._scheduler),this.addHandles([he(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},ti),he(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=yw({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=wi(this._frameTask),this._streamDataLoader=Ae(this._streamDataLoader),this._memoryController=Ae(this._memoryController),this._scheduler=Ae(this._scheduler),this.view=null}get updating(){var e,r,i,s;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],Yr(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(QW(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};d([m()],Ad.prototype,"view",void 0),d([m()],Ad.prototype,"_scheduler",void 0),d([m()],Ad.prototype,"_memoryController",void 0),d([m()],Ad.prototype,"_streamDataLoader",void 0),d([m()],Ad.prototype,"_immediateTask",void 0),d([m()],Ad.prototype,"_normalTask",void 0),d([m()],Ad.prototype,"_updatingObjects",void 0),d([m({readOnly:!0})],Ad.prototype,"updating",null),Ad=d([V("esri.views.3d.support.ResourceControllerImpl")],Ad);var AF;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(AF||(AF={}));let U9t=class{constructor(e,r=0,i=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=r,this.totalFeatures=i,this.maximumFeatures=s,this.nodes=n,this.core=o}};function X0t(t){return"performanceInfo"in t}let Z0t=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const r=e.performanceInfo;this.memory=r.usedMemory,this.displayedNumberOfFeatures=r.displayedFeatures,this.maximumNumberOfFeatures=r.maximumFeatures,this.totalNumberOfFeatures=r.totalFeatures}},J0t=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*AF.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.usedMemory)??0,this.edgesMemory=e._stage.renderer.usedMemory.edges??0,this.fboMemory=e._stage.renderer.usedMemory.fbos??0,e.allLayerViews.items.forEach(i=>{X0t(i)&&this.layerPerformanceInfos.push(new Z0t(i))}),this.layerPerformanceInfos.sort((i,s)=>s.memory-i.memory)}},K0t=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>V3e(new z3e(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>G3e(e,n),r)}async _loadOnce(e,r,i,s,n){vt(n);const o=lo(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),vt(n),l}finally{wi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},UT=class extends Me{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(yt.TEXTURE_UNLOAD))??hE}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(s=>this._releaseTextureRequest(s)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r){const i=this.makeUid(e);let s=this._textureRequests.get(i);if(!s){const n=new lPe;n.texture=r(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(i,n),s=n}return s.referenceCount++,new aPe(i,s.texture,()=>this._release(i))}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){var i;if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||((i=r.texture)==null||i.unload(),this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};d([m()],UT.prototype,"_frameTask",void 0),d([m()],UT.prototype,"updating",null),UT=d([V("esri.views.3d.support.TextureCollection")],UT);let aPe=class{constructor(e,r,i){this.uid=e,this.texture=r,this.release=i}},lPe=class{constructor(){this.referenceCount=0}},Q0t=class extends UT{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){vt(i);const s=i==null?void 0:i.signal,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new lPe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const h=this._createTexture(e,u,r);return c.texture=h,c.abortController=null,await h.load(this._stage.renderView.renderingContext),this._stage.add(h),new aPe(n,h,()=>this._release(n))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await $Ie(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){var n;const s={width:r.width,height:r.height,wrap:{s:Xt.CLAMP_TO_EDGE,t:Xt.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(lme(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new o1(r,s)}},eyt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(jf.SYMBOLOGY),this.objectResourceCache=new K0t((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new Q0t(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Vr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=A2e(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=CQe(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Yr();this._graphicsOwners.push(e);const r=he(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Yr(()=>{r.remove(),$M(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new c1;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([he(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,ti),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Ae(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;CL.distance=e.centerOnSurfaceInfrequent.distance,CL.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(CL),this.screenSizePerspectiveSettingsLabels.update(CL),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const CL={distance:0,fovY:0};let iT=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new g_({symbolLayers:new Mt([new m_({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ax({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})])})}show(e,r){if(r==null)return;this.hide();const i=new Ke({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new W_({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},i_=class extends Me{constructor(e){super(e)}};d([m({constructOnly:!0})],i_.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],i_.prototype,"surface",void 0),d([m({constructOnly:!0})],i_.prototype,"state",void 0),i_=d([V("esri.views.3d.support.PointOfInterest")],i_);const tyt=Array;let Pd=class extends i_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new l0({location:Ke,renderLocation:tyt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=E(),this._tmpPoint=new Ke}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Ho(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ae(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,r=$i(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Lw(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),Ao;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const r=(this._tmpPoint.z??0)>ryt&&this.renderCoordsHelper.viewingMode===Ne.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?iyt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{ns(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Ao}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(tB,this._estimatedSurfaceAltitude,this._camera.eye),To(this._get("renderLocation"),tB)||(this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),tB)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],Pd.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Pd.prototype,"cache",void 0),d([m({constructOnly:!0})],Pd.prototype,"task",void 0),d([m()],Pd.prototype,"location",null),d([m({constructOnly:!0})],Pd.prototype,"map",void 0),d([m()],Pd.prototype,"renderLocation",void 0),d([m()],Pd.prototype,"scale",null),d([m()],Pd.prototype,"updating",null),Pd=d([V("esri.views.3d.support.CameraOnSurface")],Pd);const tB=E(),ryt=1e5,iyt=1e6,syt=Array;let rh=class extends i_{constructor(e){super(e),this._propertiesPool=new l0({location:Ke,renderLocation:syt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=E(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=wi(this._frameWorker),this._propertiesPool=Ae(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Ao}_updateRenderLocation(){const e=oyt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=ayt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ce(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=$i(this._camera.eye,e):(re(e,this._camera.viewForward,this._get("distance")),pe(e,e,this._camera.eye)),To(this._get("renderLocation"),e)||this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var s,n;const i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Vr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=pa(i.eye),c=l<a*a,u=$i(i.eye,r);if(c&&u>o/4){const h=a-Math.sqrt(l);return re(r,i.viewForward,h),pe(r,r,i.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&G6(o,(n=this.surface)==null?void 0:n.spatialReference,w3,this.renderCoordsHelper.spatialReference)&&(r[0]=we(r[0],w3[0],w3[2]),r[1]=we(r[1],w3[1],w3[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(yi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=$i(i,e),n=$i(i,r);if(Math.abs(n-s)/s>nyt)return!0}return!1}};d([m({constructOnly:!0})],rh.prototype,"scheduler",void 0),d([m({constructOnly:!0})],rh.prototype,"task",void 0),d([m()],rh.prototype,"distance",void 0),d([m({constructOnly:!0})],rh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],rh.prototype,"location",null),d([m({readOnly:!0})],rh.prototype,"renderLocation",void 0),d([m()],rh.prototype,"updating",void 0),rh=d([V("esri.views.3d.support.CenterOnSurface")],rh);const nyt=.05,oyt=E(),ayt=E(),w3=jt();let lyt=class{constructor(e){this._handles=new c1,this.events=new Gs,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ae(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",cyt)}};const cyt={},uyt=Array;let Md=class extends i_{constructor(e){super(e),this._propertiesPool=new l0({location:Ke,renderLocation:uyt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([he(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),he(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(yt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ae(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:r}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/r)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,Jce);const n=Math.max(0,(Math.acos(de(Jce,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!ww(e,r)){const c=this._propertiesPool.get("renderLocation");ce(c,r),this._set("renderLocation",c)}return Ao}const o=1-we(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Kce);const l=this._propertiesPool.get("renderLocation");return li(l,r,Kce,a),e&&ww(e,l)||this._set("renderLocation",l),Ao}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Go());if(i[1]=r.aboveGround?r.padding[Kt.BOTTOM]:r.fullHeight-r.padding[Kt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,x3)){ye(x3,x3,r.eye);const n=fe(x3,x3);if(this.renderCoordsHelper.intersectInfiniteManifold(Eu(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],Md.prototype,"_dirty",void 0),d([m({constructOnly:!0})],Md.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Md.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],Md.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m()],Md.prototype,"updating",null),d([m()],Md.prototype,"location",null),d([m()],Md.prototype,"renderLocation",void 0),d([m()],Md.prototype,"worldUnitsPerContentPixel",null),Md=d([V("esri.views.3d.support.pointsOfInterest.Focus")],Md);const Jce=E(),x3=E(),Kce=E();let gg=class extends Me{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=E();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([he(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Ho(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var i;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((i=this.surfaceView)==null?void 0:i.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=PY(this.surfaceView.extent),r=new Ke({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{ns(s)||s&&s.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",s)})):this._set("location",r)}};d([m({constructOnly:!0})],gg.prototype,"view",void 0),d([m({constructOnly:!0})],gg.prototype,"cache",void 0),d([m()],gg.prototype,"surface",null),d([m()],gg.prototype,"surfaceView",null),d([m({readOnly:!0})],gg.prototype,"location",void 0),d([m({readOnly:!0})],gg.prototype,"renderLocation",null),gg=d([V("esri.views.3d.terrain.StableSurfaceCenter")],gg);let yg=class extends Me{constructor(e){super(e),this._tileGeometryUpdateExtent=Tu(),this._tileGeometryUpdateSpatialReference=null,this.events=new Gs,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(yt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",hyt),Tu(this._tileGeometryUpdateExtent),this._set("updating",!1)),Ao}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,T_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=dyt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,cv,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,uv,r),cv[0]<uv[0]?(s[0]=cv[0],s[2]=uv[0]):(s[0]=uv[0],s[2]=cv[0]),cv[1]<uv[1]?(s[1]=cv[1],s[3]=uv[1]):(s[1]=uv[1],s[3]=cv[1]),P6(s,e)}};d([m({constructOnly:!0})],yg.prototype,"state",void 0),d([m({constructOnly:!0})],yg.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],yg.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],yg.prototype,"scheduler",void 0),d([m({constructOnly:!0})],yg.prototype,"surface",void 0),d([m({readOnly:!0})],yg.prototype,"updating",void 0),yg=d([V("esri.views.3d.support.SurfaceGeometryUpdates")],yg);const hyt={},cv=E(),uv=E(),dyt=Tu();let bl=class extends Me{constructor(e){super(e),this.renderPointOfView=E(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=Un(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new l0({renderPointOfView:pyt},this)}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=zh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Co.MIN,this._contentIntersector=zh(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new rh({...l,task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new rh({...l,task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new rh({...l,task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Pd({...l,cache:a,task:yt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new yg({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new lyt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new gg({cache:a,view:this.view})),this._set("focus",new Md({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new iT(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new iT(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new iT(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new iT(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new iT(c,"green","Focus")),this.addHandles([he(()=>e.contentCamera,h=>this._cameraChanged(h),ti),he(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Ih(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),ti),Ho(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ho(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Ih(()=>yi.SHOW_POI,h=>this._setDebug(h),ui)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,c2,myt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(c2):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=pe(c2,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(c2)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(c2)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=iJ(r,e,fyt);if(s==null)return null;const n=s.origin,o=pe(c2,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;To(this.renderPointOfView,r)||this._set("renderPointOfView",ce(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this.removeHandles("debug");for(const r of this._pois)this.addHandles(he(()=>r.renderLocation,i=>{var s;return(s=this._debugCenters.get(r))==null?void 0:s.show(i,r.renderCoordsHelper.spatialReference)},ui),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([m()],bl.prototype,"centerOnContent",void 0),d([m()],bl.prototype,"centerOnSurfaceFrequent",void 0),d([m()],bl.prototype,"centerOnSurfaceInfrequent",void 0),d([m()],bl.prototype,"cameraOnSurface",void 0),d([m()],bl.prototype,"focus",void 0),d([m()],bl.prototype,"renderPointOfView",void 0),d([m()],bl.prototype,"surfaceOrigin",void 0),d([m()],bl.prototype,"contentGeometryUpdates",void 0),d([m()],bl.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],bl.prototype,"view",void 0),d([m()],bl.prototype,"updating",null),bl=d([V("esri.views.3d.support.PointsOfInterest")],bl);const pyt=Array,c2=E(),fyt=Un(),myt={exclude:new Set([G_])},Hh=(t=>t)(["operational-layers","basemap","ground"]),v_=new Mt,wM=new WeakMap;function gyt(t){_yt(t)&&v_.push(new WeakRef(t))}function yyt(t){const e=v_.find(r=>r.deref()===t);e&&v_.remove(e)}function _yt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function cPe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:cPe(e,t%e):0}let rB=0,AL=0;function vyt(){const t=Date.now();let e=!1;for(const r of v_){const i=r.deref();i?i.refreshInterval&&t-(wM.get(i)??0)+5>=6e4*i.refreshInterval&&(wM.set(i,t),i.refresh(t)):e=!0}if(e)for(let r=v_.length-1;r>=0;r--)v_.at(r).deref()||v_.removeAt(r)}ffe(()=>{const t=Date.now();let e=0;for(const r of v_){const i=r.deref();i&&(e=cPe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?wM.get(i)||wM.set(i,t):wM.delete(i))}if(e!==AL){if(AL=e,clearInterval(rB),AL===0)return void(rB=0);rB=setInterval(vyt,AL)}});function byt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Qce=.1,szt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=afe(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||gyt(this)},()=>{})}destroy(){yyt(this)}castRefreshInterval(r){return r>=Qce?r:r<=0?0:Qce}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){IM(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{ae.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}get test(){const r=this;return{set refreshInterval(i){r._set("refreshInterval",i)}}}};return d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Hh}}}}})],e.prototype,"refreshInterval",void 0),d([zi("refreshInterval")],e.prototype,"castRefreshInterval",null),d([m({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),d([m({readOnly:!0})],e.prototype,"refreshParameters",null),e=d([V("esri.layers.mixins.RefreshableLayer")],e),e};let wyt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},xyt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},uPe=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=G6e(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>ae.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Yr(()=>{i.removed=!0,VW(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(vt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},eue=class extends uPe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(xM.forEach((e,r)=>{e===this&&xM.delete(r)}),this.destroy())}};const xM=new Map;function Tyt(t=null){let e=xM.get(t);return e||(t!=null?(e=new eue(r=>t.immediate.schedule(r)),xM.set(t,e)):(e=new eue,xM.set(null,e))),++e.ref,e}function um(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function Syt(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Eyt(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Cyt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Syt,create:um,createView:Cyt,fromValues:Eyt},Symbol.toStringTag,{value:"Module"}));var hc,p0,tue;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(hc||(hc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(p0||(p0={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(tue||(tue={}));let Ip=class sb{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}containsChild(e){const r=e.level-this.level;return r>0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new sb(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new sb(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,r){return`${this.level}/${this.row+r}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new sb(e,r,i,s),new sb(e,r,i+1,s),new sb(e,r+1,i,s),new sb(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};Ip.pool=new qo(Ip,null,null,25,50);function py(t,e){return[t,e]}function hv(t,e,r){return t[0]=e,t[1]=r,t}function Ayt(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}const dd=new Ip("0/0/0/0");let Pyt=class hPe{static create(e,r,i=null){const s=pp(e.spatialReference),n=r.origin||py(e.origin.x,e.origin.y),o=py(e.size[0]*r.resolution,e.size[1]*r.resolution),a=py(-1/0,-1/0),l=py(1/0,1/0),c=py(1/0,1/0);i!=null&&(hv(a,Math.max(0,Math.floor((i.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-i.ymax)/o[1]))),hv(l,Math.max(0,Math.floor((i.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-i.ymin)/o[1]))),hv(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:h}=r;let p,f,g,_;return!i&&u&&h&&(hv(a,u[0],h[0]),hv(l,u[1],h[1]),hv(c,u[1]-u[0]+1,h[1]-h[0]+1)),e.isWrappable?(p=py(Math.ceil(Math.round((s.valid[1]-s.valid[0])/r.resolution)/e.size[0]),c[1]),f=py(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=py(p[0]+f[0]-1,l[1]),_=!0):(f=a,g=l,p=c,_=!1),new hPe(r.level,r.resolution,r.scale,n,a,l,c,o,f,g,p,_)}constructor(e,r,i,s,n,o,a,l,c,u,h,p){this.level=e,this.resolution=r,this.scale=i,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=h,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const r=this.worldSize[0];return e<0?r-1-Math.abs((e+1)%r):e%r}denormalizeCol(e,r){return this.wrap?this.worldSize[0]*r+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,r,i=!1){dd.set(r);const s=i?dd.col:this.denormalizeCol(dd.col,dd.world),n=dd.row;return Ayt(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,r,i=!1){dd.set(r);const s=i?dd.col:this.denormalizeCol(dd.col,dd.world);return Array.isArray(e)?hv(e,this.getXForColumn(s),this.getYForRow(dd.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(dd.row)),e}},qq=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:r,colFrom:i,colTo:s}of this.spans)for(let n=i;n<=s;n++){const o=e.getWorldForColumn(n);yield new Ip(e.level,r,e.normalizeCol(n),o)}}forEach(e,r){const{spans:i,lodInfo:s}=this,{level:n}=s;if(i.length!==0)for(const{row:o,colFrom:a,colTo:l}of i)for(let c=a;c<=l;c++)e.call(r,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};qq.pool=new qo(qq);let iB=class{constructor(e,r,i){this.row=e,this.colFrom=r,this.colTo=i}};const Is=new Ip("0/0/0/0");let Myt=class dPe{static create(e,r){e[1]>r[1]&&([e,r]=[r,e]);const[i,s]=e,[n,o]=r,a=n-i,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,h=(Math.floor(s)-s)*c;return new dPe(i,Math.floor(s),Math.ceil(o),c,a<0?u:h,a<0?h:u,a<0?n:i,a<0?i:n)}constructor(e,r,i,s,n,o,a,l){this.x=e,this.ymin=r,this.ymax=i,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const Vc=[[0,0],[0,0],[0,0],[0,0]],Oyt=1e-6;let hzt=class{constructor(e,r=null,i=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=r,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=i&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>Pyt.create(e,a,r));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,r,i=!1){Is.set(r);const s=this._infoByLevel[Is.level];return s?s.getTileBounds(e,Is,i):e}getTileCoords(e,r,i=!1){Is.set(r);const s=this._infoByLevel[Is.level];return s?s.getTileCoords(e,Is,i):e}getTileCoverage(e,r=192,i=!0,s="closest"){if(!i&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=qq.pool.acquire(n),a=this._wrap;let l,c,u,h=1/0,p=-1/0;const f=o.spans;Vc[0][0]=Vc[0][1]=Vc[1][1]=Vc[3][0]=-r,Vc[1][0]=Vc[2][0]=e.size[0]+r,Vc[2][1]=Vc[3][1]=e.size[1]+r;for(const b of Vc)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let _=3;for(let b=0;b<4;b++){if(Vc[b][1]===Vc[_][1]){_=b;continue}const w=Myt.create(Vc[b],Vc[_]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),_=b}if(h==null||p==null||p-h>100)return null;let v=[];for(l=h;l<p;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(u/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)f.push(new iB(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),u)))}else f.push(new iB(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),f.push(new iB(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){Is.set(e);const r=this._infoByLevel[Is.level],i=this._lodInfos.indexOf(r)-1;return i<0?null:(this._getTileIdAtLOD(Is,this._lodInfos[i],Is),Is.id)}getTileResolution(e){const r=this._infoByLevel[typeof e=="object"?e.level:e];return r?r.resolution:-1}getTileScale(e){const r=this._infoByLevel[e.level];return r?r.scale:-1}intersects(e,r){Is.set(r);const i=this._infoByLevel[Is.level],s=e.lodInfo;if(s.resolution>i.resolution){this._getTileIdAtLOD(Is,s,Is);const o=s.denormalizeCol(Is.col,Is.world);for(const a of e.spans)if(a.row===Is.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<i.resolution){const[o,a,l,c]=e.spans.reduce((_,v)=>(_[0]=Math.min(_[0],v.row),_[1]=Math.max(_[1],v.row),_[2]=Math.min(_[2],v.colFrom),_[3]=Math.max(_[3],v.colTo),_),[1/0,-1/0,1/0,-1/0]),u=i.denormalizeCol(Is.col,Is.world),h=s.getColumnForX(i.getXForColumn(u)),p=s.getRowForY(i.getYForRow(Is.row)),f=s.getColumnForX(i.getXForColumn(u+1))-1,g=s.getRowForY(i.getYForRow(Is.row+1))-1;return!(h>c||f<l||p>a||g<o)}const n=s.denormalizeCol(Is.col,Is.world);return e.spans.some(o=>o.row===Is.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,r,i){if(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this._wrap){const s=pp(this.tileInfo.spatialReference),n=-i*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>r[0])return this._infoByScale[r[0]];for(let i=1;i<r.length-1;i++)if(e>r[i]+Oyt)return this._infoByScale[r[i-1]];return this._infoByScale[r[r.length-1]]}getClosestInfoForScale(e){const r=this.scales;return this._infoByScale[e]||(e=r.reduce((i,s)=>Math.abs(s-e)<Math.abs(i-e)?s:i,r[0])),this._infoByScale[e]}scaleToLevel(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=r.length-1;i>=0;i--)if(e<r[i])return i===r.length-1?this._infoByScale[r[r.length-1]].level:this._infoByScale[r[i]].level+(r[i]-e)/(r[i]-r[i+1]);return this._infoByScale[r[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,r,i){const s=this._infoByLevel[i.level];return e.set(i),r.resolution<s.resolution?null:(r.resolution===s.resolution||(e.level=r.level,e.col=Math.floor(i.col*s.resolution/r.resolution+.01),e.row=Math.floor(i.row*s.resolution/r.resolution+.01)),e)}},Ryt=class{constructor(e,r){this.item=e,this.controller=r,this.promise=null}},$yt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new KD,this._controllers=new KD,this._processingItems=new KD,this._pausedSignal=nm(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new H4(e.peeker),this.process=e.process;const r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=wi(this._schedule),this._task=wi(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const r=this._controllers.get(e);r&&r.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(r=>e.push(r)),this._controllers.clear(),e.forEach(r=>r.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((r,i)=>e(i))}get(e){const r=this._deferreds.get(e);return r?r.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,r){const i=this.get(e);if(i)return i;const s=new AbortController;let n=null;r&&(n=lo(r,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(hr())},a=()=>{l.remove(),n!=null&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=d6(s.signal,o),c=Wo();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var r;const e=this._queue.popLast();return e&&((r=this._deferreds.get(e))==null||r.reject(hr("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(r=>e.push(r)),this._processingItems.clear();for(const r of e)this._queue.push(r.item),r.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=zE(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(r))}_processError(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(r))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let r;const i=new AbortController,s=new Ryt(e,i);this._processingItems.set(e,s);try{r=this.process(e,i.signal)}catch(n){this._processError(s,n)}Rc(r)?(s.promise=r,r.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,r)}get test(){return{update:e=>this.runTask(e)}}};function Iyt(t,e){return t.length=0,e.forEach(r=>t.push(r)),t}const sB=new Set,PL=[],u2=new Map,rue=[0,0];let dv=class extends Me{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:r,strategy:i}=this;this._queue=new $yt({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return r(o,{signal:n})},peeker:i==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Ae(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const r=typeof e=="string"?e:e.id;this._queue.abort(r)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const r=typeof e=="string"?e:e.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(e){const r=e.key.id;if(this._queue.has(r))return this._queue.get(r);const i=this._queue.push(r),s=()=>{this._keyToItem.delete(r)};return this._keyToItem.set(r,e),i.then(s,s),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const h=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(h.key);u2.has(p)||(u2.set(p,[]),i=Math.max(p,i),s=Math.min(p,s)),u2.get(p).push(h.key),sB.add(p)});let n=this.state.scale;u2.has(n)||(Iyt(PL,sB),PL.sort((u,h)=>u-h),n=PL.reduce((u,h)=>Math.abs(h-n)<Math.abs(u-n)?h:u,PL[0])),n=Math.min(n,i),n=Math.max(n,s);const o=u2.get(n),a=r.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,h)=>{const p=a.denormalizeCol(u.col,u.world),f=a.denormalizeCol(h.col,h.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))}),sB.clear(),u2.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView,i=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);r.getTileCoords(rue,a.key);const l=Y_(rue,i);l<n&&(n=l,s=a.key)}),s.id}};d([m({constructOnly:!0})],dv.prototype,"concurrency",void 0),d([m({constructOnly:!0})],dv.prototype,"process",void 0),d([m()],dv.prototype,"state",void 0),d([m({constructOnly:!0})],dv.prototype,"strategy",void 0),d([m({constructOnly:!0})],dv.prototype,"tileInfoView",void 0),dv=d([V("esri.views.2d.tiling.TileQueue")],dv);new Ip(0,0,0,0);let Lyt=class{constructor(e,r){this.sourceTile=r,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},yzt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function vzt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let bzt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Dyt(t,e,r,i,s,n,o){const a=e[i++];for(let l=0;l<a;l++){const c=new Lyt(n,o);c.xTile=e[i++],c.yTile=e[i++],c.hash=e[i++],c.priority=e[i++],c.featureIndex=e[i++];const u=e[i++];for(let f=0;f<u;f++){const g=e[i++],_=e[i++],v=e[i++],b=e[i++],w=!!e[i++],T=e[i++],S=r[i++],C=r[i++],P=e[i++],R=e[i++];c.colliders.push({xTile:g,yTile:_,dxPixels:v,dyPixels:b,hard:w,partIndex:T,width:P,height:R,minLod:S,maxLod:C})}const h=t[i++];for(let f=0;f<h;f++)c.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)c.iconVertexRanges.push([t[i++],t[i++]]);s.push(c)}return i}function xzt(t,e,r){for(const[i,s]of t.symbols)Nyt(t,e,r,s,i)}function Nyt(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===hc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const h=u?255:0;l=h<<24|h<<16|h<<8|h}else l=0;for(const[c,u]of o.iconVertexRanges)for(let h=c;h<c+u;h+=4)n.iconOpacity[h/4]=l;if(o.selectedForRendering){const c=a.parts[1];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const h=u?255:0;l=h<<24|h<<16|h<<8|h}else l=0;for(const[c,u]of o.textVertexRanges)for(let h=c;h<c+u;h+=4)n.textOpacity[h/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function Tzt(t,e,r,i){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-i[0]+c.dxScreen,o=c.yScreen-i[1]+c.dyScreen,a=n+c.width,l=o+c.height,Tct(r,e.x,e.y,n,o,a,l)))return!0;return!1}let A8=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Fyt=class extends A8{constructor(e,r){super(e,r),this.type=hc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=ft(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=qr.createVertex(e,Pr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=qr.createIndex(e,Pr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new Bh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},kyt=class extends A8{constructor(e,r){super(e,r),this.type=hc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.usedMemory)??0)+(((i=this.outlineVAO)==null?void 0:i.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=ft(this.fillVAO),this.outlineVAO=ft(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=qr.createVertex(e,Pr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=qr.createIndex(e,Pr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=s[i++],h=qr.createVertex(e,Pr.STATIC_DRAW,new Int32Array(n.buffer,4*i,u));i+=u;const p=s[i++],f=qr.createIndex(e,Pr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,p));i+=p;const g=this.layer,_=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new Bh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Bh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:h},f)}},Uyt=class extends A8{constructor(e,r,i){super(e,r),this.type=hc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++],c=s[a++],u=s[a++],h=new Ip(l,c,u,0),p=s[a++];for(let v=0;v<p;v++){const b=s[a++],w=s[a++],T=s[a++];this.iconPerPageElementsMap.set(b,[w,T])}const f=s[a++];for(let v=0;v<f;v++){const b=s[a++],w=s[a++],T=s[a++];this.glyphPerPageElementsMap.set(b,[w,T])}const g=s[a++],_=s[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(_),a=Dyt(s,n,o,a,this.symbols,i,h),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.usedMemory)??0)+(((i=this.textVAO)==null?void 0:i.usedMemory)??0)+t0(this.iconOpacity)+t0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=ft(this.iconVAO),this.textVAO=ft(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.usedMemory&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.usedMemory&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=qr.createVertex(e,Pr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=qr.createIndex(e,Pr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=s[i++],h=qr.createVertex(e,Pr.STATIC_DRAW,new Int32Array(n.buffer,4*i,u));i+=u;const p=s[i++],f=qr.createIndex(e,Pr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,p));i+=p;const g=qr.createVertex(e,Pr.STATIC_DRAW,this.iconOpacity.buffer),_=qr.createVertex(e,Pr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new Bh(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new Bh(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:h,opacity:_},f)}},zyt=class extends A8{constructor(e,r){super(e,r),this.type=hc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=ft(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=qr.createVertex(e,Pr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=qr.createIndex(e,Pr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new Bh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const Mzt=!0,Ozt=32,iue=200,sue=se("mapview-transitions-duration")===0?0:1/se("mapview-transitions-duration");let Byt=class extends Gs{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Wo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Wo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled&&sue!==0){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*sue;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},pPe=class extends Byt{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new Ip(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;CX(i,o,0,0,0,a,0,s,n,1),tE(this.transforms.displayViewScreenMat3,e.displayViewMat3,i)}get destroyed(){return this._destroyed}},nB=class fPe extends pPe{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<iue}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<iue)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var i,s;let r=!1;for(const n of e){const o=this.layerData.get(n);o&&(this._memoryUsedByLayerData-=o.memoryUsed,o.type===hc.SYMBOL&&this.symbols.delete(n)&&(r=!0),o.destroy(),this.layerData.delete(n))}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&((s=this.featureIndex)==null||s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,mPe.delete(this),fPe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i,s;(i=this.featureIndex)==null||i.clear();let r=!1;if(e){const{bucketsWithData:n,emptyBuckets:o}=e,a=this._createRenderBuckets(n);if(o&&o.byteLength>0){const l=new Uint32Array(o);for(const c of l)this._deleteLayerData(c)}for(const[l,c]of a)this._deleteLayerData(l),c.type===hc.SYMBOL&&(this.symbols.set(l,c.symbols),r=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(l,c);(s=this._memCache)==null||s.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[n,o]of this.layerData)o.type===hc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;AX(o),c5(o,o,n),PX(o,o,Math.PI*e.rotation/180),lk(o,o,[i,s,1])}_createTransforms(){return{displayViewScreenMat3:um(),tileMat3:um(),tileUnitsToPixels:um()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;for(const i of e.values())r.has(i)||(i.destroy(),r.add(i));e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case hc.FILL:i=new kyt(e,this.styleRepository);break;case hc.LINE:i=new Fyt(e,this.styleRepository);break;case hc.SYMBOL:i=new Uyt(e,this.styleRepository,this);break;case hc.CIRCLE:i=new zyt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e)}};const mPe=new Map;function Vyt(){mPe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}let Gyt=class{constructor(e="scene"){this.context=e,this.extent=Tu()}};const Lzt={value:.5,readOnly:!0},jyt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let zT=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},Hyt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},qyt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new Hyt(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,h=.5*rO;let p=(c-1)/o,f=(i-this.j*o)*p,g=(r-this.i*o)*p;if(p<1){const _=Math.floor(f),v=Math.floor(g),b=_+v*c,w=u[b],T=u[b+1],S=u[b+c],C=u[b+c+1];if(w+T+S+C<h){const P=f-_,R=g-v,L=x$(w,T,S,C,P,R),F=x$(w,T,S,C,P+p,R),U=x$(w,T,S,C,P,R+p),j=x$(w,T,S,C,P+p,R+p);return s.min=Math.min(L,F,U,j),s.max=Math.max(L,F,U,j),s}f=_,g=v,p=1}else f=Math.floor(f),g=Math.floor(g),p=Math.ceil(p);for(let _=f;_<=f+p;_++)for(let v=g;v<=g+p;v++){const b=u[_+v*c];b<h?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const Wyt=.5*rO;function cs(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=we(i.dy*(i.y1-e),0,s),o=we(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,u=a*c+l,h=i.data.values,p=h[u],f=h[u+1],g=u+c,_=h[g],v=h[g+1];if(p+_+f+v<Wyt){n-=a,o-=l;const b=p+(f-p)*o;return b+(_+(v-_)*o-b)*n}}return null}var ca,pt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(ca||(ca={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(pt||(pt={}));const h2=E(),Yyt=E(),Km=E(),Qm=E();function Xyt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return qme(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return v4e(i,e,r*s)}function ML(t,e,r,i){ce(h2,r),h2[i]=e[i];const s=ye(h2,h2,e),n=ye(Yyt,t,e),o=de(n,s),a=de(s,s);let l;l=o<=0?e:a<=o?r:pe(h2,e,re(s,s,o/a));const c=ye(h2,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Zyt(t,e,r){const i=t.extent;if(i==null)return 0;Km[0]=i[0],Km[1]=i[1],Km[2]=r,Qm[0]=i[2],Qm[1]=i[3],Qm[2]=r;let s=1/0,n=1/0;return e[0]<Km[0]?s=ML(e,Km,Qm,0):e[0]>Qm[0]&&(s=ML(e,Qm,Km,0)),e[1]<Km[1]?n=ML(e,Km,Qm,1):e[1]>Qm[1]&&(n=ML(e,Qm,Km,1)),Math.min(s,n)}function Jyt(t,e,r){if(t==null)return kX();if(t.spatialReference.isGeographic&&!V_(t.spatialReference))return new J("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=mc.checkUnsupported(t);if(i!=null)return i;if(r==null)return new J("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=Kyt(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new J("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function Kyt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Hme(e),a=jt();mc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>xT){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new J("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:xT})}return null}const Qyt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Jyt,isInsideExtent:Xyt,tiltToExtentEdge:Zyt},Symbol.toStringTag,{value:"Module"}));function e_t(){return!0}function t_t(){return 0}function r_t(t,e){if(t==null)return kX();const r=t.lods.length-1,i=t.spatialReference,s=V_(i)||u1(i)||h1(i);if(i.isWebMercator){if(!mc.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new J("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new J("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!mc.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new J("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new J("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new J("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const i_t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:r_t,isInsideExtent:e_t,tiltToExtentEdge:t_t},Symbol.toStringTag,{value:"Module"})),s_t={[Ne.Global]:i_t,[Ne.Local]:Qyt};function mn(t,e){t||console.warn("Terrain: "+e)}let Fn=!1,PF=!1;function n_t(t){PF=t,Fn=Fn||t}function o_t(t){Fn=t}function $e(t,e){var r;if(Fn&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function Wq(t){return P8(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function MF(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function P8(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function GK(t){return(t==null?void 0:t.type)==="tile-3d"}function hw(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function gPe(t){return(t==null?void 0:t.type)==="wmts-3d"}function Yq(t){return(t==null?void 0:t.type)==="elevation-3d"}function T3(t){return(t==null?void 0:t.type)==="group"}function NO(t){return t&&(GK(t)||gPe(t)||P8(t)||hw(t))}function Xq(t){return t&&(GK(t)||P8(t)||hw(t)||gPe(t))}function Zq(t){return Xq(t)||Yq(t)}function a_t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function l_t(t){return yPe(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function c_t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function u_t(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof VK||e instanceof HTMLCanvasElement||e instanceof ImageData}function yPe(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function wS(t){return t!=null&&"release"in t&&t.release(),null}function nue(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function jK(t,e,r,i){return s_t[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function M8(t,e,r){let i=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=h_t(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=MF(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===Ne.Local;if(MF(t))i=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!d_t(e)||p_t.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&jK(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function h_t(t,e,r){const i=AUe(t);if(i!=null){if(!Mt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>jK(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function d_t(t){return t.isWGS84||t.isWebMercator||Sme(t)||!BM(t)}const p_t={force512VTL:!1};function oue(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function eg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function mh(t,e,r=g_t){return Math.abs(t-e)<r}function OF(t){return t===pt.NORTH_EAST?pt.SOUTH_WEST:t===pt.NORTH_WEST?pt.SOUTH_EAST:t===pt.SOUTH_WEST?pt.NORTH_EAST:pt.NORTH_WEST}function HK(t){return t===pt.NORTH?pt.SOUTH:t===pt.EAST?pt.WEST:t===pt.SOUTH?pt.NORTH:pt.EAST}function f_t(t){return t===pt.NORTH_WEST||t===pt.SOUTH_WEST}function m_t(t){return t===pt.NORTH_WEST||t===pt.NORTH_EAST}function aue(t){return t===pt.NORTH_WEST||t===pt.WEST||t===pt.SOUTH_WEST}function lue(t){return t===pt.NORTH_EAST||t===pt.EAST||t===pt.SOUTH_EAST}function cue(t){return t===pt.SOUTH_EAST||t===pt.SOUTH||t===pt.SOUTH_WEST}function uue(t){return t===pt.NORTH_EAST||t===pt.NORTH||t===pt.NORTH_WEST}const cp=[pt.NORTH,pt.EAST,pt.SOUTH,pt.WEST],RF=[pt.NORTH_EAST,pt.SOUTH_EAST,pt.SOUTH_WEST,pt.NORTH_WEST],g_t=1e-5;let eh=class extends Me{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(CUe(i.operationalLayerType)&&this.viewSpatialReference!=null){const s=_Pe(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Hme(s))}}),e}};function y_t(t,e){return t===Ne.Global?new Jq(e):new Kq(e)}d([m({readOnly:!0})],eh.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],eh.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],eh.prototype,"stencilEnabledExtents",null),d([m()],eh.prototype,"viewSpatialReference",void 0),d([m()],eh.prototype,"tilingScheme",void 0),d([m()],eh.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],eh.prototype,"layers",void 0),d([m({constructOnly:!0})],eh.prototype,"layerViews",void 0),eh=d([V("esri.views.3d.terrain.ExtentHelper")],eh);let Jq=class extends eh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?A1e:cVe}};Jq=d([V("esri.views.3d.terrain.ExtentHelperGlobal")],Jq);let Kq=class extends eh{_computeLayerViewsExtent(){const e=Tu(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=_Pe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);T_(e,a,e)}});const i=JV(e)?e:null,s=this._get("layerViewsExtent");return Zb(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Tu();this.layers.forEach(o=>{if(o.loaded&&VP(o)){const a=M8(o,r,Ne.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(MF(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&T_(i,c,i)}}),T_(i,this.defaultTiledLayersExtent,i);const s=JV(i)?i:null,n=this._get("tiledLayersExtent");return Zb(s,n)?n:s}};function _Pe(t,e){return t==null||t.spatialReference.equals(e)?t:UP(t,t.spatialReference,e)}Kq=d([V("esri.views.3d.terrain.ExtentHelperLocal")],Kq);function vPe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.includes(".glsl")&&delete t[i]}}const bPe=1.3,__t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let fy,yl=class extends Me{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=se("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Zu({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const r=()=>this.setDrawTexturesDirty();this._groundIntersector=zh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([he(()=>this.renderer.hasHighlights,r),this.renderer.events.on("has-water",i=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("content-changed",r),he(()=>e.state.camera.pixelRatio,r),he(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),he(()=>{var i,s,n;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),he(()=>{var i,s;return[(i=e.state)==null?void 0:i.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),ti),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(yt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(Wa,i.camera,Os.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Os.BACKGROUND,i)})]),e._stage.renderer.renderOverlay=i=>this._renderOverlay(i)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),fy&&(fy.hide(),fy=null),this.renderer=Ae(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||yi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Vr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return bPe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(Os.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new I_(-20037508342787e-6,20037508342787e-6):new I_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Zc)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Os.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Ao;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,sf),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,sf.stretch);const n=this._updateOverlay(rn.INNER,sf.inner,s,1*sf.pixelRatioAdjustment,sf.mapUnitsPerPixel),o=fa(sf.inner)/fa(sf.outer),a=this._updateOverlay(rn.OUTER,sf.outer,s,o*sf.pixelRatioAdjustment,sf.mapUnitsPerPixel);n!==If.EXTENT&&a!==If.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),n===If.NONE&&a===If.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min(sw(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return If.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,v_t(r,o.extent)&&i===o.resolution)return a===n?If.NONE:If.RERENDER_ONLY;s0(o.extent,r),o.resolution=i;const l=PY(o.extent);return o.renderLocalOrigin=oF(l[0],l[1],0,"OV_"+this._latestOriginId++),If.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[rn.INNER],s=this.renderer.overlays[rn.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,rn.INNER,r),this._setTileOverlayData(n,rn.OUTER,r)):(this._clearTileOverlayData(rn.INNER,r),this._clearTileOverlayData(rn.OUTER,r))}else this._clearTileOverlayData(rn.INNER,r),this._clearTileOverlayData(rn.OUTER,r)}overlayPixelSizeInMapUnits(e,r){if(this.renderer.overlays.length===0)return r();const i=this.renderer.overlays[rn.INNER],s=this.renderer.overlays[rn.OUTER],n=this._pointIsInExtent(e,i.extent)?i:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=fa(s),o=Pl(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,fa(e)/n,Pl(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){vPe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Wa)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new Y2e(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,T_t,r,i);if(n==null)return!1;const o=n.origin,a=pe(OL,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=we(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=OL;ZE(ek(tk,Vr(this.view.spatialReference).radius+l),Eu(e.eye,e.viewForward),u),ye(u,u,e.eye);const h=L_.normalize(Oye(e.viewForward,u,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:s;i=c?p*h:h+p*(1-h)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(u),p=zt(0,h,1,0),f=wc(p,p,e.projectionMatrix)[1],g=we(.5+.5*f,0,1);i=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&kM(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=E();this._findHorizonBasedPointOfInterest(e,n)||ce(n,s),yi.OVERLAY_SHOW_CENTER?(fy==null&&(fy=new iT(this.view.graphics,"red")),fy.show(n,this._renderSR)):fy!=null&&fy.hide();const o=Math.max(.1,$i(e.eye,n)),a=Q_(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||ya(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,u=c&&this._spatialReference?1/Vr(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/h*o*u;i.mapUnitsPerPixel=p/this._worldToPCSRatio,i.stretch=this._overlayStretch;let f=r*p/2*i.stretch,g=!1,_=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(f/=Math.cos(z4(n[1])),_=l[3]):(g=!0,f/=Vr(this._spatialReference).metersPerDegree,_=90),f>=_&&(f=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(Lt(n[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,T=32,S=.5*r/(T*w),C=.5*r/(T*f);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*C)/C;const P=i.inner;P[0]=n[0]-w,P[1]=n[1]-f,P[2]=n[0]+w,P[3]=n[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(P,1/0,_);const R=i.outer;if(6*w>fa(l))s0(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=P[0]-w,R[1]=P[1]-f,R[2]=P[2]+w,R[3]=P[3]+f;else{ya(e.eye,this._renderSR,OL,this._spatialReference),Uf(pv,n,OL);let F=-Math.atan2(pv[1],pv[0])+.125*Math.PI;F<0&&(F+=2*Math.PI);const U=Math.floor(F/(.25*Math.PI));Rw(pv,__t[U],2*f),pv[0]*=v,pv[2]*=v,lX(R,P,pv)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-_),R[3]=Math.min(R[3],_);else{const F=KV(P,l,w_t),U=KV(R,l,x_t);Wee(F,U)&&(R[2]=R[0],R[3]=R[1])}const L=Math.abs(P[2]-P[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,L),i.pixelRatioAdjustment=i.mapUnitsPerPixel/L}_drawOverlays(e,r){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(r),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Os.UPDATE),i?(this.surface.requestRender(e),e===Os.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Os.BACKGROUND),this.renderer}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):P6(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:Wee(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),j4(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Wa)}}};function v_t(t,e){const i=yi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}d([m()],yl.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],yl.prototype,"running",null),d([m()],yl.prototype,"_placementDirty",void 0),d([m()],yl.prototype,"_contentUpdated",void 0),d([m()],yl.prototype,"_isSpherical",null),d([m()],yl.prototype,"_worldToPCSRatio",null),d([m()],yl.prototype,"renderer",void 0),d([m({constructOnly:!0})],yl.prototype,"view",void 0),d([m({constructOnly:!0})],yl.prototype,"surface",void 0),d([m()],yl.prototype,"suspended",null),d([m()],yl.prototype,"updating",null),d([m({type:Boolean})],yl.prototype,"rendersOccludedDraped",null),yl=d([V("esri.views.3d.terrain.OverlayManager")],yl);let b_t=class{constructor(){this.inner=jt(),this.outer=jt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=bPe}};const pv=Yt(),OL=E(),sf=new b_t,w_t=jt(),x_t=jt(),T_t=Un();var If;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(If||(If={}));let S_t=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Ri(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=er(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Ri(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,r){return this.getEdgeAttributeIndex(e,r)}getEdgeVertexPosition(e,r,i,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),r),pe(r,r,i)}getEdgeNormal(e,r,i){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;vot(r,s,this.getEdgeAttributeIndex(e,i),n)}setEdgeNormalFromValues(e,r,i,s,n){this._setNormal(this.getEdgeAttributeIndex(e,r),i,s,n)}setEdgeVertexFromValuesRawPositionUV(e,r,i,s,n,o,a){const l=this.getEdgeAttributeIndex(e,r);this.vertexAttributes.position.setValues(l,i,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c,u){const h=this.getEdgeAttributeIndex(e,r);this.vertexAttributes.position.setValues(h,i,s,n),this._setUV(h,o,a),this._setNormal(h,l,c,u)}_getEdgeVertexRaw(e,r){this.vertexAttributes.position.getVec(e,r)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;$p(n,e,r,i,s,o)}_setUV(e,r,i){_p(this.vertexAttributes.uv0,e,r,i)}getEdgeAttributeIndex(e,r){return $e(0<=r&&r<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+r}};const hue=16384;function _p(t,e,r,i){t.setValues(e,r*hue,i*hue)}let E_t=class{constructor(){this.sinLonLUT=new Array(z3+1),this.cosLonLUT=new Array(z3+1),this.sinLatLUT=new Array(z3+1),this.cosLatLUT=new Array(z3+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},C_t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},wPe=class kN{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ae(this._current),this._next=Ae(this._next),this._waiting=Ae(this._waiting),this._delayed=Ae(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=kN.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,O_.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==nn.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Ae(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=kN.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=O_.Immediate){this._delayed=Ae(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=kN.test.fadeMoment||performance.now();return r!==O_.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Ae(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var O_;wPe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(O_||(O_={}));var CE;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(CE||(CE={}));let xPe=class{constructor(){this._queue=new kt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},A_t=class{constructor(){this._q=new kt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function TM(t,e,r){if((e==null?void 0:e.fullExtent)==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Kg(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function TPe(t,e,r=null){r==null||r.length===0?t===CE.BACK_TO_FRONT?e.sort(P_t):e.sort(M_t):e.sort((i,s)=>O_t(i,s,t,r))}function P_t(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function M_t(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function SPe(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:Kg(t,e)}function O_t(t,e,r,i){return due(t,i)===due(e,i)?SPe(t,e,r):t?r:-r}function due(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function R_t(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function $_t(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(R_t)}function I_t(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function L_t(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function Yzt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let qK=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,nn.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=Wq(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?TM:()=>!0;let u=this.tile;const h=u.level;let p;const f=this._tileLayerInfo.upsampleInfo,g=f!=null?f.tile.level:-1,_=f!=null&&g-h>=a,v=s==null?void 0:s.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const w=u.level,T=h-w,S=u.layerInfo[r][e];if(S.data&&T>=a){(!_||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const C=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(C[0],C[1],u.lij[2]))!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!p||u.level===n||w%C1e==0||h-p.level<a)&&(p=u),T>=l))break;u=u.parent}if(p!=null&&h-p.level<a)if(f)p=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),p=w.layerInfo[r][e].dataInvalidated?w:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,nn.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},D_t=class extends qK{get _desiredMinLevelDelta(){throw pue}get _progressiveLevelModulo(){throw pue}dispose(){}};const pue=new Error("Abstract method called on TileAgent"),Yl=new D_t;let EPe=class extends qK{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return FG(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},CPe=class extends qK{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return C1e}};var dw,qw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(dw||(dw={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(qw||(qw={}));function N_t(t){t.fragment.uniforms.add(new at("u_colormap",e=>e.u_colormap),new Ie("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ie("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ie("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(x`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function F_t(t){t.fragment.uniforms.add(new at("u_transformGrid",e=>e.u_transformGrid),new ni("u_transformSpacing",e=>e.common.u_transformSpacing),new ni("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(x`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let APe=class extends Ci{constructor(){super(...arguments),this.scale=1,this.offset=n0}};function PPe(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.vertex.uniforms.add(new Ie("scale",e=>e.scale)),t.vertex.uniforms.add(new ni("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let k_t=class extends APe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function U_t(t,e){t.include(F_t),t.fragment.uniforms.add(new at("u_image",i=>i.u_image),new am("u_flipY",i=>i.common.u_flipY),new am("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new ni("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(x`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(x`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var De;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(De||(De={}));const Qq={normal:De.Normal,average:De.Average,lighten:De.Lighten,lighter:De.Lighter,screen:De.Screen,plus:De.Plus,"color-dodge":De.ColorDodge,darken:De.Darken,multiply:De.Multiply,"color-burn":De.ColorBurn,overlay:De.Overlay,"soft-light":De.SoftLight,"hard-light":De.HardLight,"vivid-light":De.VividLight,hue:De.Hue,saturation:De.Saturation,luminosity:De.Luminosity,color:De.Color,difference:De.Difference,exclusion:De.Exclusion,minus:De.Minus,invert:De.Invert,reflect:De.Reflect,"destination-over":De.DestinationOver,"destination-atop":De.DestinationAtop,"destination-in":De.DestinationIn,"destination-out":De.DestinationOut,"source-atop":De.SourceAtop,"source-in":De.SourceIn,"source-out":De.SourceOut,xor:De.Xor};function z_t(t){return t===De.DestinationOver||t===De.DestinationAtop||t===De.DestinationIn||t===De.DestinationOut||t===De.SourceAtop||t===De.SourceIn||t===De.SourceOut||t===De.Xor}function WK(t){t.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function B_t(t,e){const r=e.blendMode;r!==De.Normal&&(r===De.Reflect&&t.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==De.ColorDodge&&r!==De.VividLight||t.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==De.ColorBurn&&r!==De.VividLight||t.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===De.Overlay&&t.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===De.HardLight&&t.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===De.SoftLight&&t.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===De.VividLight&&t.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==De.Hue&&r!==De.Saturation&&r!==De.Color&&r!==De.Luminosity||(t.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==De.Hue&&r!==De.Saturation||t.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===De.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:r===De.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===De.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===De.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===De.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===De.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===De.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===De.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===De.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===De.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===De.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:r===De.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:r===De.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===De.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var sn,sa,Gd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(sn||(sn={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(sa||(sa={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Gd||(Gd={}));function MPe(t,e){const r=e.output===sn.GridComposite,i=e.output===sn.ColorComposite,s=e.output===sn.GroupBackgroundComposite,n=e.output===sn.Composite;r&&t.fragment.include(WK),i&&t.fragment.uniforms.add(new Dt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===sa.Required;o&&t.fragment.uniforms.add(new Ie("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new at("fboColor",c=>c.fboTexture));const a=e.blendMode!==De.Normal,l=e.premultipliedSource===Gd.On;t.fragment.include(B_t,e),t.fragment.code.add(x`
    vec4 getBackground(vec2 uv) {
      return ${o?x`baseOpacity *`:""} ${s?x`vec4(0.0, 0.0, 0.0, 0.0)`:i?x`vec4(backgroundColor, 1.0)`:r?x`vec4(gridColor(uv), 1.0)`:x`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?x`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:x`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?x`colorLayer * opacity;`:x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let GR=class extends k_t{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Cn,this.fboTexture=null,this.baseOpacity=1}},OPe=class extends GR{},RPe=class extends GR{};function $Pe(t){const e=new Or;return e.include(PPe),e.include(U_t,t),e.include(N_t,t),e.include(MPe,t),e.fragment.code.add(x`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===dw.Stretch?G_t(e,t):t.colorizerType===dw.Lut?V_t(e):t.colorizerType===dw.Hillshade&&j_t(e,t),e}function V_t(t){t.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function G_t(t,e){t.fragment.uniforms.add(new $R("u_bandCount",i=>i.symbolizer.u_bandCount),new Al("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Al("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Al("u_factor",i=>i.symbolizer.u_factor,3),new Ie("u_minOutput",i=>i.symbolizer.u_minOutput),new Ie("u_maxOutput",i=>i.symbolizer.u_maxOutput),new am("u_useGamma",i=>i.symbolizer.u_useGamma),new Al("u_gamma",i=>i.symbolizer.u_gamma,3),new Al("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ie("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?x`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===qw.Noop?x`
        fragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function j_t(t,e){const r=t.fragment;r.uniforms.add(new at("u_image",s=>s.u_image),new $R("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Al("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Al("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Al("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Al("u_weights",s=>s.symbolizer.u_weights,6),new ni("u_factor",s=>s.symbolizer.u_factor),new Ie("u_minValue",s=>s.symbolizer.u_minValue),new Ie("u_maxValue",s=>s.symbolizer.u_maxValue),new ni("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(Lm),r.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?x`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const H_t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:RPe,ColorizerStretchUniforms:OPe,ColorizerUniforms:GR,build:$Pe},Symbol.toStringTag,{value:"Module"}));function q_t(t,e,r="nearest",i=!1){var c;const s=!(i&&e.pixelType==="u8"),n=s?An.FLOAT:An.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new oi;return l.width=e.width,l.height=e.height,l.internalFormat=s?tt.RGBA32F:wt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Gt.NEAREST:Gt.LINEAR,l.dataType=n,l.wrapMode=Xt.CLAMP_TO_EDGE,new Sr(t,l,o)}function W_t(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new oi;l.width=a?4*n:n,l.height=o,l.internalFormat=tt.RGBA32F,l.dataType=An.FLOAT,l.samplingMode=Gt.NEAREST,l.wrapMode=Xt.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let u=0,h=0;u<s.length;u++)c[h++]=s[u],u%3==2&&(c[h++]=1);else for(let u=0;u<o;u++)for(let h=0;h<n;h++){const p=4*(u*n+h),f=2*(h*o+u);c[p]=i[f],c[p+1]=i[f+1],c[p+3]=i[f]===-1?0:1}return new Sr(t,l,c)}function fue(t,e){const r=new oi;return r.internalFormat=wt.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Gt.NEAREST,r.wrapMode=Xt.CLAMP_TO_EDGE,new Sr(t,r,e)}function Y_t(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:n0,u_transformGridSize:t?t.size:n0,u_targetImageSize:e,u_srcImageSize:r}}function X_t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Z_t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function J_t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const mue={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let K_t=class{constructor(e,r,i=null,s=null){this.lij=e,this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.opacity=1,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=ft(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...mue,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||mue}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Gt.LINEAR:Gt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=ft(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=W_t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=Y_t(r,[i,s],[this.source.width,this.source.height],n),a=X_t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Z_t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?J_t(this.symbolizerParameters):null;return new GR(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=ft(this._rasterTexture),this._transformGridTexture=ft(this._transformGridTexture),this._colormapTexture=ft(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=ft(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=ft(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=q_t(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=ft(this._colormapTexture),this._colormapTexture=fue(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=fue(e,i),void(this._colormap=i)):(this._colormapTexture=ft(this._colormapTexture),void(this._colormap=null))}},UN=class{constructor(){this.waitingAgents=new kt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=oB.acquire();return r._init(e),r}release(){this.dispose(),zN.delete(this),oB.release(this)}dispose(){this.loadingAgent=ft(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=wS(this._data)}static prune(){oB.prune(0)}_init(e){this.waitingAgents.clear(),this._data=wS(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ja(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),I_t(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){wS(this._data),this._data=e}};const oB=new qo(UN,null,()=>{}),zN=new Map;function Q_t(){zN.size>0&&(console.log(`${zN.size} live TilePerLayerInfo allocations:`),zN.forEach(t=>console.log(t,`
`)))}let dP=class{constructor(e,r){this._texture=e,this._cache=r,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}};var ot;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(ot||(ot={}));const e1t=.1;let YK=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=jt(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=jt(),this.centerAtSeaLevel=E(),this._center=[E(),Vs(),E()],this.up=oY(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=E(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}static prune(){XK.prune(0),ZK.prune(0),UN.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Ys.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??ca.INTERSECTS;this._frustumVisibility=r===ca.INSIDE?ca.INSIDE:r===ca.OUTSIDE?ca.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==ca.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,r,i,s,n){this._lij[0]=e,this._lij[1]=r,this._lij[2]=i,this.ellipsoid=Vr(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,r,i,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Ys.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of ib){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=UN.acquire(this._surface.upsampleInfoPool),o===Bt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,z3)}dispose(){mn(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of ib){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Bt.MAP].reduce((e,r)=>e+(r instanceof nB?r.usedMemory/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[Bt.MAP])s instanceof nB?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const r=this._cpuImageMemorySize;for(const s of this.layerInfo[Bt.ELEVATION])this._usedMemory+=s.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===Bt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===Bt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof dP?e.texture.usedMemory:e instanceof HTMLImageElement||e instanceof VK?this._cpuImageMemorySize:e instanceof K_t?e.memoryUsage:e instanceof nB?e.usedMemory/e.referenced:0}updateScreenDepth(e){const r=this._center[Ys.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===ca.OUTSIDE))return ot.NONE;const s=this.level;ye($L,this._center[Ys.MIDDLE],r);let n=pa($L),o=$L,a=this._center[Ys.MIDDLE];ye(aB,this._center[Ys.TOP],r);const l=pa(aB);l<n&&(n=l,o=aB,a=this._center[Ys.TOP]),ye(lB,this._center[Ys.BOTTOM],r);const c=pa(lB);if(c<n&&(n=c,o=lB,a=this._center[Ys.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return ot.SPLIT;const u=Math.sqrt(n),h=e.fovX*u*2,p=this._edgeLen/h,f=()=>{if(s<e.maxLod)return this.elevationLevel=s,ot.NONE;const R=s+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return R!==this.elevationLevel?(this.elevationLevel=R,ot.ELEVATION):ot.NONE},g=i!=null?i-s:1/0;if(g<=.5)return f();const _=de(this.up,$L),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&_>0&&b<.001&&_/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return ot.NONE;const w=i!=null?3-Math.min(g,2):1;if(p*w<e.relativeWidthLimit||s>=e.maxLod)return f();if(s<7)return ot.SPLIT;re(fo,this.up,_),ye(fo,fo,o);const T=pa(fo);if(T<=this.radius*this.radius)return ot.SPLIT;re(fo,fo,this.radius/Math.sqrt(T)),pe(fo,fo,a),ye(fo,r,fo);const S=Math.min(1,(Math.abs(de(fo,this.up))+.5*v+this._curvatureHeight)/Se(fo)),C=e1t/e.angledSplitBias,P=e.fovY*u*2;return S*(this._edgeLen/P*w)<C*e.relativeHeightLimit?ot.NONE:ot.SPLIT}setChildren(e,r,i,s){mn(!!(e&&r&&i&&s),"Null child passed");const n=this._children;return n[0]=e,n[1]=r,n[2]=i,n[3]=s,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of ib)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of ib){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==Yl&&(RL(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(ot.GEOMETRY),this.resetPendingUpdate(ot.TEXTURE_NOFADING),this.resetPendingUpdate(ot.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Bt.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Yl&&(RL(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Zb(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(ot.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!(i!=null&&i.data)||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of ib){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Yl&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(ot.SPLIT)||e!==Bt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const r=this._pendingUpdates;return this._pendingUpdates|=e,e===ot.SPLIT||e===ot.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),r!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;Ja(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return pa(ye(fo,this._center[Ys.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;mn(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this._lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case Bt.MAP:return this._updateTexture(r);case Bt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===nn.FADING?ot.TEXTURE_NOFADING:ot.TEXTURE_FADING),this.setPendingUpdate(e===nn.FADING?ot.TEXTURE_FADING:ot.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ot.GEOMETRY);for(const e of this.layerInfo[Bt.ELEVATION])e.pendingUpdates|=ot.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBoundsMin,r=this._elevationBoundsMax;let i=1/0,s=-1/0;const n=this.layerInfo[Bt.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(i=Math.min(i,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(i=Math.min(i,0),s=Math.max(s,0)),e===i&&r===s||(this._elevationBoundsMin=i,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,r=this._elevationBoundsMax,i=.5*(e+r),s=this._center;re(fo,this.up,i),pe(s[Ys.MIDDLE],this.centerAtSeaLevel,fo),re(fo,this.up,e),pe(s[Ys.TOP],this.centerAtSeaLevel,fo),re(fo,this.up,r),pe(s[Ys.BOTTOM],this.centerAtSeaLevel,fo)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[Bt.ELEVATION][e],s=FG(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Bt.ELEVATION),l=Wq(a);if(!TM(this,l,!1))return;const c=r1t;let u=!1;const h=i.data;if(h&&h.level<=n){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,f,g=0;for(let _=this._parent;_&&(!f||g<s)&&(g=this.elevationLevel-_.level,p=f||p,f=_.layerInfo[Bt.ELEVATION][e].data,!(!f&&p&&_.level<=n));_=_.parent);f=f||p,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=f.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new zT),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==Yl&&(RL(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:UN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,nn.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Yl&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of ib){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Yl&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Yl&&this.updateRenderData(e,nn.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Yl&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Yl,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||QS(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var s,n,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(NO(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||QS((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=Wq(l);if(o.loadingAgent?TM(this,c,!1)?(o.loadingAgent!==Yl&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Yl&&(a=o.loadingAgent.update())):o.dispose():TM(this,c,!1)&&(o.loadingAgent=t1t(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Yl&&this.setPendingUpdate(ot.GEOMETRY):(RL(o.loadingAgent),o.loadingAgent=Yl)),o.loadingAgent===Yl&&this.updateRenderData(r,nn.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,FG(this.level)-r),s=we(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(i1t(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this._lij,s=this.getNeighborLIJ(i,e);return s?BN(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===pt.NORTH_EAST?1:e===pt.NORTH_WEST?0:e===pt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(OF(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===pt.NORTH?[0,1]:e===pt.NORTH_EAST?[1]:e===pt.EAST?[1,3]:e===pt.SOUTH_EAST?[3]:e===pt.SOUTH?[2,3]:e===pt.SOUTH_WEST?[2]:e===pt.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if($e(!Fn||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this._lij[o+1],c=l-a,u=n?s-1-c:c;return Fn&&($e(a<=l&&l<a+s),$e(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;cp.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(HK(s),o=>!!o.isLoaded&&(e(o,s),!0))}),RF.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(OF(s),a=>a.isLoaded);$e(!n||eW(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=uue(r)?-1:cue(r)?1:0,s=aue(r)?-1:lue(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+wa()>=r}checkGeometryWaterproofness(){var e;PF&&($e(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(uue(e)&&r[3]+s>=i[3]||cue(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&aue(e)&&r[0]-s<=i[0])&&!(!n&&lue(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;ce(this._lastPOI,e);const i=this._center[Ys.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function t1t(t,e,r,i){const s=r===Bt.ELEVATION?ZK.acquire():XK.acquire();return s.init(t,e,r,i),s}function RL(t){t.dispose(),t instanceof EPe?ZK.release(t):t instanceof CPe&&XK.release(t)}const XK=new qo(CPe),ZK=new qo(EPe),r1t=new zT;var Ys;function i1t(t,e){const r=t.lij,i=e[0]-r[0];return!(i<0)&&e[1]>>i===r[1]&&e[2]>>i===r[2]}function BN(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function s1t(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===pt.EAST||t.isWestEnd&&e.isEastEnd&&r===pt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case pt.NORTH:return mh(t.extent[3],e.extent[1],i);case pt.SOUTH:return mh(t.extent[1],e.extent[3],i);case pt.EAST:return mh(t.extent[2],e.extent[0],i)||mh(t.extent[2],-e.extent[0],i);case pt.WEST:return mh(t.extent[0],e.extent[2],i)||mh(t.extent[0],-e.extent[2],i)}}function eW(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?gue(t,e,r):gue(e,t,OF(r)))}function gue(t,e,r){$e(t.level>=e.level);const i=f_t(r),s=m_t(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=mh(a[0],l[0],c)||t.surface.isGlobal&&mh(a[0],-l[0],c),h=mh(a[1],l[1],c);if(u&&h)return!0;if(t.level===e.level||!u&&!h)return $e(!1),!1;const p=u?yue(o[1],o[3],n[1],n[3],c):yue(o[0],o[2],n[0],n[2],c);return $e(p),p}function yue(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Ys||(Ys={}));const $L=E(),aB=E(),lB=E(),fo=E();let n1t=class{constructor(){this._scales=zt(-1,-1,-1,-1),this._offsets=zt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function o1t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var Qf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Qf||(Qf={}));let a1t=class extends LJ{constructor(){super(...arguments),this.overlayOpacity=1}};function l1t(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new _ue("texOffsetAndScale")),i.uniforms.add(new vue("tex")),i.uniforms.add(new cB("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new _ue("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new vue("texNext")),i.uniforms.add(new cB("nextTexOpacities")),i.uniforms.add(new c1t("fadeFactor")));const o=e.tileBlendInput===Qf.ColorComposite,a=e.tileBlendInput===Qf.GridComposite;a&&i.include(WK),o&&i.uniforms.add(new cB("backgroundColor")),r.code.add(x`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),i.code.add(x`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?x`backgroundColor`:x`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:x`return color;`}
    }`),n?i.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(x`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let c1t=class extends ps{constructor(e){super(e,"float")}},cB=class extends ps{constructor(e){super(e,"vec3")}},_ue=class extends ps{constructor(e){super(e,"vec4")}},vue=class extends ps{constructor(e){super(e,"sampler2D")}},JK=class extends a1t{};function IPe(t){const e=new Or,{vertex:r,fragment:i,varyings:s}=e;e.include(wR),e.include(cC,t),e.include(om,t);const n=()=>{e.include(RO,t),r.code.add(x`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Sc(r,t),e.include(Ol,t);const o=t.overlayMode!==Zf.Disabled,a=o&&t.invisible;switch(t.output){case k.Color:{e.include(l1t,t),e.include(Gw,t),o&&e.include(i3,{...t,pbrMode:t.pbrMode===nt.Simplified?nt.TerrainWithWater:nt.Water});const l=t.overlayMode===Zf.EnabledWithWater;l&&e.include(o1t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&dE(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(nC,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(x`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?x`forwardVertexTangent(vnormal);`:x``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?x`setOverlayVTC(uv);`:""}
          ${t.tileBorders?x`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?x`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?x`forwardLinearDepth();`:""}

        }
      `),e.include(Rs,t),e.include(Gw,t),e.include(IR,t),e.include(bE,t),Cp(i,t),LR(i),hC(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Dt("viewDirection",(u,h)=>fe(bue,te(bue,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))),l&&i.uniforms.add(new at("ovWaterTex",(u,h)=>{var p;return(p=h.overlay)==null?void 0:p.getTexture(Fi.WaterNormal)}),new Wwe("view",(u,h)=>Fl(u1t,h.camera.viewMatrix,u.origin))),i.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),w0(i),Om(i),i.code.add(x`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?x`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?x`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===nt.Simplified||t.pbrMode===nt.TerrainWithWater?x`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:x`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?x`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?x`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?x`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:x`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?x`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case k.LinearDepth:a&&e.include(i3,t),e.include(h0,t),J_(e),zw(e),r.code.add(x`
              void main(void) {
                ${a?x`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(x`
              void main() {
                ${a?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:e.include(h0,t),J_(e),zw(e),r.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(x`void main() {
outputDepth(linearDepth);
}`);break;case k.Normal:a&&e.include(i3,t),s.add("vnormal","vec3"),dE(r),n(),r.code.add(x`
        void main(void) {
          ${a?x`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),i.code.add(x`
        void main() {
          ${a?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case k.Highlight:o&&e.include(i3,t),r.code.add(x`
          void main() {
            ${o?x`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(w1,t),i.code.add(x`
          void main() {
            ${o?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===k.ObjectAndLayerIdColor&&(o?(e.include(i3,{...t,pbrMode:nt.Disabled}),r.code.add(x`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(x`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(r.code.add(x`void main(void) {}`),i.code.add(x`void main() {
fragColor = vec4(0.0);
}`))),e}const u1t=xe(),bue=E(),h1t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:JK,build:IPe},Symbol.toStringTag,{value:"Module"}));let LPe=class DPe extends Gr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Dr(e.rctx,DPe.shader.get().build(this.configuration),NPe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Nt({blending:r.renderOccluded?Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA):null,culling:i?yZ:null,depthTest:r.renderOccluded?null:{func:Qr.LESS},depthWrite:r.renderOccluded?null:Mc,colorWrite:qt,stencilTest:e?Ytt(Il.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};LPe.shader=new Lr(h1t,()=>me(()=>Promise.resolve().then(()=>TAt),void 0));const NPe=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let d1t=class{constructor(){this.geometry=new S_t,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new wPe(()=>this.tile.surface.fadeDuration),this.overlay=new n1t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,r){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new C_t,this._localOrigin=r,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Fn&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)$e(this.geometry.getEdgeCount(r)===this.geometryState.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return s}const n=i.level,o=cp[e];if(!r)return $e(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,u=c.renderData.geometryState,h=n-c.level;if($e(h>=0),h===0){const g=u.numVerticesPerSide-1;return Math.max(g,s)}const p=2**h,f=u.edgeResolutions[(e+2)%4]/p;return Math.max(1,f)}$e(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(HK(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):($e(!c.isLeaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState,i=a=>(a.isLoaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(cp[a],i),c=Sb(e,l),u=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,h=s[a],p=c!==Sb(e,h),f=n[a]!==u;Fn&&l&&($e(e.level>=l.level),$e(e.level-l.level<=_n)),s[a]=l,(p||f)&&(n[a]=u,this._markEdgeDirty(a));const g=r.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);$e(UM(_)),$e(_>=1),r.edgeResolutions[a]=_,g!==_&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(RF[a],i);r.cornerPeerNeighbors[a]=l;const c=Sb(e,s[a]),u=Sb(e,s[(a+1)%4]),h=Sb(e,l);pd[a]=h,pd[(a+1)%4]=u,pd[(a+2)%4]=e,pd[(a+3)%4]=c,$e(pd.some(_=>(_==null?void 0:_.isLoaded)||_===e));const p=pd.reduce((_,v)=>Math.min(_,(v==null?void 0:v.level)??1/0),1/0);pd.forEach((_,v)=>{_&&(_==null?void 0:_.level)>p&&(pd[v]=null)}),$e(pd.some(_=>(_==null?void 0:_.isLoaded)||_===e));const f=r.cornerNeighborCornerTiles,g=r.cornerNeighborCornerTileSamplerVersions;for(let _=0;_<4;++_){const v=pd[_],b=(v==null?void 0:v.renderData.geometryState.samplerDataVersion)??-1,w=4*a+_,T=f[w]!==v,S=!T&&g[w]!==b;(T||S)&&(f[w]=v,g[w]=b,this._markCornerDirty(a))}Fn&&$e(KK.some(_=>{var v;return((v=f[4*a+_])==null?void 0:v.isLoaded)||f[4*a+_]===e}))}Fn&&$e(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)pd[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Fn&&$e(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;const{tile:r,_vao:i,geometry:s,geometryState:n}=this,o=!i||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((f,g)=>f+g+1,0),c=o||a&&l>((s==null?void 0:s.maxEdgeVertexCount)??0),u=!c&&a,h=!u&&(this.dirtyEdges!==0||a),p=!h&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?r.updateEdgeElevationsAndResolutions():h||p?r.updateEdgeElevations():p?r.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=ft(this._vao),this.geometry.release(),!0)}ensureTexture(e,r,i){const s=r?wt.RGBA:wt.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return(this._modifiedFlags&f1t)!=0}get samplerDataChanged(){return(this._modifiedFlags&m1t)!=0}get clippingAreaChanged(){return(this._modifiedFlags&g1t)!=0}get wireframeChanged(){return(this._modifiedFlags&y1t)!=0}get dirtyEdges(){return this._modifiedFlags>>uB&15}get dirtyCorners(){return this._modifiedFlags>>hB&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>dB&15}_markCornerDirty(e){const r=1<<e<<hB;this._modifiedFlags|=r}_markEdgeDirty(e){const r=1<<e<<uB;this._modifiedFlags|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e<<dB;this._modifiedFlags|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<hB|15<<uB|15<<dB}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),e0(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new Dp(e,NPe,{geometry:Ic(r.layout)},{geometry:qr.createVertex(e,s.STATIC_DRAW,r.buffer)},qr.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=O_.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[Bt.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let u=0;u<i;u++){const h=r[u];if(h.upsampleInfo!=null){const p=h.upsampleInfo.tile,f=p.layerInfo[Bt.ELEVATION][u].data,g=f&&f.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,p.lij[0])}else if(h.data){const p=this.tile.surface.layerViewByIndex(u,Bt.ELEVATION);if(TM(this.tile,p.layer,!1)){const f=h.data;e&&e[n]===f.samplerData||(a=!0),s[n++]=f.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Fn)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void $e(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=cp.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;$e(this.dirtyCorners===0),$e(this.dirtyEdges===0),$e(this.dirtyEdgeResolutions===0),$e(!this.numVerticesPerSideChanged),$e(!this.samplerDataChanged),$e(!this.clippingAreaChanged),$e(!this.wireframeChanged);const n=RF.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];$e(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}cp.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,q=>(q.level===s||(q==null?void 0:q.isLoaded))&&(q==null?void 0:q.intersectsClippingArea));if(!c){const q=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void $e(!q)}$e(c.isLoaded||c.level===e.level),$e(c===this.geometryState.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return $e(!c.isLeaf),void $e(u===0);const h=c.renderData;$e(s1t(e,c,a)),$e(u>=0);const p=2**u;if(u<0)return void $e(!1);const f=e.renderData,g=f.geometry,_=f.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=h.geometry;if(!w)return void $e(!1);const T=h.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S!=null&&S.isLoaded){const q=S.renderData;$e(f.geometryState.edgePeerNeighborSamplerVersions[l]===q.geometryState.samplerDataVersion),$e(this.geometryState.edgePeerNeighborSamplerVersions[l]===q.geometryState.samplerDataVersion)}const C=(l+2)%4,P=w.getEdgeCount(C),R=v-1,L=P-1;$e(R*p===L,`Tile[${e.lij}]:e${l},res=${R} edgeRes mismatch with Neighbor[${c.lij}]:e${C},res=${L} (expected:${R*p})`);const F=e.extent,U=a===pt.NORTH||a===pt.SOUTH,j=P-1,z=j>>u,Z=v-1;if(z<1)return void $e(Z===1);$e(z===Z),$e(UM(z));const W=w.numVerticesPerSide-1;$e(u>0||z===Math.max(W,b));const Y=e.getNeighborEdgeStartVertexIndex(l,c);$e(0<=Y&&Y<p);const le=Y*z;$e(0<=le&&le<=j-z);let I=0,N=le;g.getEdgeVertexPosition(l,nf,_,0),g.getEdgeVertexPosition(l,of,_,v-1);const B=$i(nf,of),H=Math.max(p1t,1e-4*B);for(let q=0;q<=z;++q){g.getEdgeVertexPosition(l,nf,_,I),w.getEdgeVertexPosition(C,of,T,N);const Q=q/z,ie=U?F[0]+Q*(F[2]-F[0]):a===pt.WEST?F[0]:F[2],_e=U?a===pt.SOUTH?F[1]:F[3]:F[1]+Q*(F[3]-F[1]),Oe=e.surface.extent;if(Oe==null||A6(Oe,ie,_e)){const gt=Vg(nf,of),It=nc(nf)-Kr.radius,xt=nc(of)-Kr.radius,ct=gt<H;if(!ct){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${I}/${v}] and [${c.lij}].edge${C}[${N}/${P}]`),Oe!=null&&console.warn("  surface extent= ",Oe," x,y=",ie,",",_e);const yr=E();ye(yr,f.localOrigin,h.localOrigin),nc(yr)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${h.localOrigin} d=${nc(yr)} [${yr}]`),(()=>{const Ue=qi(nf),dr=qi(of);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,nf,_,I),w.getEdgeVertexPosition(C,of,T,N);const Re=E();Hi(Re,nf,Ue),nc(Re)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ue} vs ${nf} d=${nc(Re)} [${Re}]`),Hi(Re,of,dr),nc(Re)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${dr} vs ${of} d=${nc(Re)} [${Re}]`)})();const Er=g.getEdgeCount(l),Ii=w.getEdgeCount(P);$e(ct,`Mismatch in tile [${e.lij}].edge[${l}][${I}/${Er}] vs neighbor [${c.lij}].edge[${C}][${N}/${Ii}] ${eg(nf)} vs ${eg(of)}  dist=${gt} h(t|n|d)=${It}|${xt}|${xt-It}`)}g.getEdgeNormal(l,d2,I),w.getEdgeNormal(C,p2,N),fe(wue,d2),fe(xue,p2);const Qe=de(wue,xue),Ve=1-Qe<.01||!1||e===c;if(!Ve){const yr=E();Hi(yr,d2,p2);const Er=()=>`Mismatch in tile edge normal ${oue(e.lij)} (${I}/${v-1}) edge ${l} vs neighbor ${oue(c.lij)}  (${N}/${P-1}) nedge ${C} :${eg(d2)} vs ${eg(p2)}  dot = ${Qe} : ${eg(yr)}`;console.warn("Mismatch in tile edge normal: ",Er());{e.updateEdgeElevations(),c.updateEdgeElevations();const Ii=E(),Ue=E();g.getEdgeNormal(l,Ii,I),w.getEdgeNormal(C,Ue,N),ww(d2,Ii)||console.warn("Missing update in tile normal: ",eg(d2)," => ",eg(Ii)),ww(p2,Ue)||console.warn("Missing update in neighbor normal: ",eg(p2)," => ",eg(Ue))}$e(Ve,Er())}}I+=1,N+=1}})}};const nf=E(),of=E(),d2=E(),p2=E(),wue=E(),xue=E(),p1t=1,pd=[null,null,null,null];function Sb(t,e){return e!=null&&e.isLoaded||e===t?e:null}const f1t=1,m1t=2,g1t=4,y1t=8,uB=4,hB=8,dB=12,KK=[0,1,2,3],_1t=65536;function v1t(t,e){const{tile:r,geometry:i,geometryState:s}=t,{extentInRadians:n,surface:o}=r,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=s,h=c-1,p=(c-2)**2,f=a&&(e===fh.HAS_SOUTH_POLE||e===fh.HAS_BOTH_POLES),g=a&&(e===fh.HAS_NORTH_POLE||e===fh.HAS_BOTH_POLES),_=((f?1:0)+(g?1:0))*VN*c,v=JPe(s),b=p+_+4*v,w=l.tileGeometryCache.acquire(b);i.numVerticesPerSide=c,i.vertexAttributes=w,i.maxEdgeVertexCount=v;const{boundingBox:T}=i;Ri(T);const S=eQ(t);bo.update(h,n,S),w1t(t),i.poleVerticesStartIndex=p;const C=b1t(t,f,g);i.edgeVerticesStartIndex=p+_,rQ(t),QK(t),GPe(i,C,u),t.intersectionData=null}function b1t(t,e,r){const{tile:i,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=i,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=n,p=c-1,f=s[0],g=s[1],_=s[2],v=a.radius,b=o[1],w=o[3],T=[];let S=h;const C=(P,R)=>{const L=R*c;Mh(-f,-g,P*v-_,l),T.push({connectedRowOffset:L,connectedOuterEdgeOffset:P===1?0:2,rowOffset:S,latitudeResolution:VN});const F=UPe(P===-1?b:w,v),U=P*Math.PI/2-F,j=.99*(P===1?1:-1),z=v+0,{position:Z,uv0:W}=u,{typedBuffer:Y,typedBufferStride:le}=u.normalCompressed;for(let I=1;I<=VN;++I){const N=F+U*(I/VN),B=Math.cos(N),H=Math.sin(N);for(let q=0;q<=p;q++){const Q=q/p,ie=bo.sinLonLUT[q],_e=bo.cosLonLUT[q]*B,Oe=ie*B,gt=H,It=_e*z-f,xt=Oe*z-g,ct=gt*z-_;Mh(It,xt,ct,l),Z.setValues(S,It,xt,ct),_p(W,S,Q,j),$p(Y,S,_e,Oe,gt,le),++S}}};return e&&C(-1,0),r&&C(1,p),T}function w1t(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=i,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:u}=r,h=c.position,p=c.uv0,{typedBuffer:f,typedBufferStride:g}=c.normalCompressed,{extent:_}=e,v=_[0],b=_[2],w=_[1],T=_[3],S=e.ellipsoid.radius,C=s[0],P=s[1],R=s[2],L=h.typedBuffer,F=h.typedBufferStride,U=1/l;let j=0;if(1<=a){const z=U,Z=w*(1-z)+T*z,W=bo.sinLatLUT[1],Y=bo.cosLatLUT[1];for(let le=1;le<=a;le++){const I=le*U,N=v*(1-I)+b*I,B=bo.sinLonLUT[le],H=bo.cosLonLUT[le],q=S+cs(N,Z,o),Q=q*H*Y-C,ie=q*B*Y-P,_e=q*W-R;Mh(Q,ie,_e,u);const Oe=(le-1)*F;L[Oe]=Q,L[Oe+1]=ie,L[Oe+2]=_e,_p(p,le-1,I,z)}}for(let z=1;z<=a;z++){const Z=z*U,W=w*(1-Z)+T*Z,Y=bo.sinLatLUT[z],le=bo.cosLatLUT[z],I=z+1,N=I*U,B=w*(1-N)+T*N,H=bo.sinLatLUT[I],q=bo.cosLatLUT[I],Q=bo.sinLonLUT[0],ie=bo.cosLonLUT[0],_e=S+cs(v,W,o);let Oe=ie*le*_e-C,gt=Q*le*_e-P,It=Y*_e-R;const xt=j*F;let ct=L[xt],Qe=L[xt+1],Ve=L[xt+2];for(let yr=1;yr<=a;yr++){const Er=yr*U,Ii=v*(1-Er)+b*Er,Ue=bo.sinLonLUT[yr],dr=bo.cosLonLUT[yr];let Re=0,Be=0,bt=0;if(yr<a){const ur=(j+1)*F;Re=L[ur],Be=L[ur+1],bt=L[ur+2]}else{const ur=bo.sinLonLUT[l],Li=bo.cosLonLUT[l],ws=S+cs(b,W,o);Re=Li*le*ws-C,Be=ur*le*ws-P,bt=Y*ws-R}const Ft=Oe,He=gt,Et=It;Oe=ct,gt=Qe,It=Ve,ct=Re,Qe=Be,Ve=bt;const Le=Re-Ft,et=Be-He,Ct=bt-Et;let di=0,jr=0,Ai=0;if(z>1){const ur=(j-a)*F;di=L[ur],jr=L[ur+1],Ai=L[ur+2]}else{const ur=bo.sinLatLUT[0],Li=bo.cosLatLUT[0],ws=S+cs(Ii,w,o);di=dr*Li*ws-C,jr=Ue*Li*ws-P,Ai=ur*ws-R}const Nr=S+cs(Ii,B,o),Xr=dr*q*Nr-C,pr=Ue*q*Nr-P,Fr=H*Nr-R;if(z<a){const ur=j+a,Li=ur*F;L[Li]=Xr,L[Li+1]=pr,L[Li+2]=Fr,Mh(Xr,pr,Fr,u),_p(p,ur,Er,N)}const _r=di-Xr,ei=jr-pr,Tt=Ai-Fr;let nr=dr*le,vr=Ue*le,pi=Y;pi*pi<.999&&(nr=Ct*ei-et*Tt,vr=Le*Tt-Ct*_r,pi=et*_r-Le*ei);const js=1/Math.sqrt(nr*nr+vr*vr+pi*pi);$p(f,j,nr*js,vr*js,pi*js,g),++j}}}function x1t(t){t.tile.intersectsClippingArea&&(QK(t),fC(t),t.intersectionData=null)}function T1t(t){t.tile.intersectsClippingArea&&(qPe(t),QK(t),fC(t),XPe(t),t.intersectionData=null)}function S1t(t){t.tile.intersectsClippingArea&&(kPe(t),FPe(t,!0),fC(t),t.intersectionData=null)}function QK(t){t.tile.intersectsClippingArea&&(kPe(t),FPe(t))}function FPe(t,e=!1){const{geometry:r,geometryState:i,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,u=c.radius,h=l[0],p=l[2],f=l[1],g=l[3],{samplerData:_}=i,v=a[0],b=a[2],w=a[1],T=a[3],S=eQ(t),{boundingBox:C,vertexAttributes:P}=r,R=n[0],L=n[1],F=n[2],U=P.position,j=U.typedBuffer,z=U.typedBufferStride,Z=P.uv0;for(let W=0;W<4;++W){const Y=W===1||W===3,le=i.edgeResolutions[W];$e(UM(le));const I=le+1,N=Sb(s,i.edgePeerNeighbors[W]);if(ZPe(s,N,W)){WPe(t,W,N);continue}const B=N!=null;$e(!B||N.level===s.level),$e(!B||Kg(s,N)<=0);const H=N==null?void 0:N.renderData,q=H==null?void 0:H.geometryState;if(Fn){const Le=s.surface;if(!N&&Le&&!Le.updatingRootTiles){const et=cp[W],Ct=s.findNeighborTile(et,di=>di.isLoaded||di.isLeaf||di.level===s.level);Ct?Ct.intersectsClippingArea&&($e(!Ct.isLoaded),$e(!Ct.isLeaf),$e(Ct.level===o)):$e((Le==null?void 0:Le.rootTiles)==null||!s.shouldHaveNeighbor(et))}}const Q=W===1?a[2]:a[0],ie=N==null?void 0:N.extent,_e=ie&&Y?W===1?ie[0]:ie[2]:Q,Oe=W===0?a[3]:a[1],gt=W===1?1:0,It=W===0?1:0,xt=W===1?p:h,ct=W===0?g:f,Qe=Math.sin(xt),Ve=Math.cos(xt),yr=Math.sin(ct),Er=Math.cos(ct),Ii=q==null?void 0:q.samplerData,Ue=B?(Le,et,Ct)=>.5*(cs(Le,et,_)+cs(Ct,et,Ii)):(Le,et,Ct)=>cs(Le,et,_),dr=r.outerEdgesOffsetAndLength[2*W+0],Re=e&&I>3?I-3:1,Be=_!=null&&_.some(Le=>Le!=null),bt=Ii!=null&&Ii.some(Le=>Le!=null),Ft=Be||bt,He=1/le,Et=dr;$e(!ie||mh(ie[2]-ie[0],a[2]-a[0])),(()=>{const Le=W===1?-1:W===3?1:0,et=W===0?-1:W===2?1:0,Ct=(a[2]-a[0])*He,di=Le*Ct,jr=et*Ct,Ai=Y?Le*((p-h)*He):0,Nr=Y?0:et*He,Xr=It,pr=Y?xt+Ai:xt,Fr=Y?Math.sin(pr):Qe,_r=Y?Math.cos(pr):Ve,ei=Y?xt-Ai:xt,Tt=Y?Math.sin(ei):Qe,nr=Y?Math.cos(ei):Ve,vr=Y?ct:S(Xr+Nr),pi=Y?yr:Math.sin(vr),js=Y?Er:Math.cos(vr),ur=Y?ct:S(Xr-Nr),Li=Y?yr:Math.sin(ur),ws=Y?Er:Math.cos(ur);let uo=0,Sa=0,Ea=0;{const fr=0*He,Bi=Y?Q:v*(1-fr)+b*fr,dn=Y?_e:Bi,Gn=Y?w*(1-fr)+T*fr:Oe,oe=Y?xt:h*(1-fr)+p*fr,Hr=Y?Qe:Math.sin(oe),Kh=Y?Ve:Math.cos(oe),jn=Y?S(fr):ct,Qh=Y?Math.sin(jn):yr,lt=Y?Math.cos(jn):Er,Bl=u+Ue(Bi,Gn,dn);uo=Kh*lt*Bl,Sa=Hr*lt*Bl,Ea=Qh*Bl}let ho=0,Ks=0,xs=0;{const fr=1*He,Bi=Y?Q:v*(1-fr)+b*fr,dn=Y?_e:Bi,Gn=Y?w*(1-fr)+T*fr:Oe,oe=Y?xt:h*(1-fr)+p*fr,Hr=Y?Qe:Math.sin(oe),Kh=Y?Ve:Math.cos(oe),jn=Y?S(fr):ct,Qh=Y?Math.sin(jn):yr,lt=Y?Math.cos(jn):Er,Bl=u+Ue(Bi,Gn,dn);ho=Kh*lt*Bl,Ks=Hr*lt*Bl,xs=Qh*Bl}for(let fr=1;fr<I-1;fr+=Re){let Bi=0,dn=0,Gn=0;{const Ca=(fr+1)*He,Vl=Y?Q:v*(1-Ca)+b*Ca,Fp=Y?_e:Vl,qn=Y?w*(1-Ca)+T*Ca:Oe,fs=Y?xt:h*(1-Ca)+p*Ca,$0=Y?Qe:Math.sin(fs),P1=Y?Ve:Math.cos(fs),M1=Y?S(Ca):ct,mx=Y?Math.sin(M1):yr,O1=Y?Math.cos(M1):Er,I0=u+Ue(Vl,qn,Fp);Bi=P1*O1*I0,dn=$0*O1*I0,Gn=mx*I0}const oe=Bi,Hr=dn,Kh=Gn,jn=ho,Qh=Ks,lt=xs;ho=oe,Ks=Hr,xs=Kh;{const Ca=Et+fr,Vl=Ca*z,Fp=jn-R,qn=Qh-L,fs=lt-F;j[Vl]=Fp,j[Vl+1]=qn,j[Vl+2]=fs,Mh(Fp,qn,fs,C);const $0=fr*He;_p(Z,Ca,Y?gt:$0,Y?$0:It)}const Bl=uo,Hn=Sa,E1=Ea;uo=jn,Sa=Qh,Ea=lt;const C1=jn,el=Qh,Fm=lt,A1=1/Math.sqrt(C1*C1+el*el+Fm*Fm),Jt=Fm*A1;let O0=0,km=0,R0=0;if(Ft&&Jt*Jt<.999){let Ca=0,Vl=0,Fp=0;{const qn=W===0?-1:1;Ca=qn*(oe-Bl),Vl=qn*(Hr-Hn),Fp=qn*(Kh-E1)}{const qn=fr*He,fs=Y?Q:v*(1-qn)+b*qn,$0=Y?_e:fs,P1=Y?w*(1-qn)+T*qn:Oe,M1=Y?xt:h*(1-qn)+p*qn,mx=Y?Qe:Math.sin(M1),O1=Y?Ve:Math.cos(M1),I0=Y?S(qn):ct,KR=Y?Math.sin(I0):yr,tl=Y?Math.cos(I0):Er;let yC=C1,_C=el,X=Fm;if(B){const ve=u+cs($0-di,P1-jr,Ii),Ce=Y?tl:ws;yC=(Y?nr:O1)*Ce*ve,_C=(Y?Tt:mx)*Ce*ve,X=(Y?KR:Li)*ve}{const ve=u+cs(fs+di,P1+jr,_),Ce=Y?tl:js,mr=(Y?_r:O1)*Ce*ve,Qs=(Y?Fr:mx)*Ce*ve,os=(Y?KR:pi)*ve;B||(yC=2*C1-mr,_C=2*el-Qs,X=2*Fm-os);const Aa=W===3?-1:1,R1=Aa*(yC-mr),XQ=Aa*(_C-Qs),ZQ=Aa*(X-os);O0=Fp*XQ-Vl*ZQ,km=Ca*ZQ-Fp*R1,R0=Vl*R1-Ca*XQ;const z8=1/Math.sqrt(O0*O0+km*km+R0*R0);O0*=z8,km*=z8,R0*=z8}}}else O0=C1*A1,km=el*A1,R0=Fm*A1;r.setEdgeNormalFromValues(W,fr,O0,km,R0)}})()}}function kPe(t){YPe(t)}function UPe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function E1t(t,e,r,i){return UPe(t*(1-i)+e*i,r)}function C1t(t,e,r){return t*(1-r)+e*r}function eQ(t){const{tile:e}=t;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>E1t(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>C1t(r[1],r[3],i)}function A1t(t,e){const{tile:r,geometryState:i,geometry:s}=t,{extent:n,surface:o}=r,{wireframe:a}=i,l=n[0],c=n[1],u=n[2]-l,h=n[3]-c,{numVerticesPerSide:p,clippingArea:f}=i,g=f!=null?Math.max(0,(f[0]-l)/u):0,_=f!=null?Math.max(0,(f[1]-c)/h):0,v=f!=null?Math.min(1,(f[2]-l)/u):1,b=f!=null?Math.min(1,(f[3]-c)/h):1,w=(p-2)**2,T=JPe(i),S=w+4*T,C=o.renderer.tileGeometryCache.acquire(S),{boundingBox:P}=s;Ri(P),s.numVerticesPerSide=p,s.vertexAttributes=C,s.maxEdgeVertexCount=T,s.minu=g,s.minv=_,s.maxu=v,s.maxv=b,P1t(t),s.edgeVerticesStartIndex=w,rQ(t),tQ(t),GPe(s,[],a),t.intersectionData=null}function P1t(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=i,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:h}=l,p=o??iQ,f=c[0],g=c[1],_=c[2],v=c[3],b=Math.max(f,p[0]),w=Math.min(_,p[2]),T=Math.max(g,p[1]),S=Math.min(v,p[3]),C=u.radius,P=e.horizontalScale,R=a-1,L=a-2,{minu:F,minv:U,maxu:j,maxv:z,boundingBox:Z,vertexAttributes:W}=r,Y=W.position,le=W.uv0,{typedBuffer:I,typedBufferStride:N}=W.normalCompressed,B=s[0],H=s[1],q=s[2],Q=Y.typedBuffer,ie=Y.typedBufferStride;let _e=0;const Oe=we(g,T,S),gt=h?(Math.PI/2-2*Math.atan(Math.exp(-Oe/C)))*C:Oe*P,It=1/R,xt=we(g*(1-It)+v*It,T,S);let ct=gt,Qe=h?(Math.PI/2-2*Math.atan(Math.exp(-xt/C)))*C:xt*P;for(let Ve=1;Ve<=L;Ve++){const yr=Ve/R,Er=we(g*(1-yr)+v*yr,T,S),Ii=we(yr,U,z),Ue=Qe,dr=(Ve-1)/R,Re=we(g*(1-dr)+v*dr,T,S),Be=ct,bt=(Ve+1)/R,Ft=we(g*(1-bt)+v*bt,T,S),He=h?(Math.PI/2-2*Math.atan(Math.exp(-Ft/C)))*C:Ft*P,Et=we(bt,U,z);ct=Qe,Qe=He;const Le=we(f,b,w);let et=Le*P,Ct=cs(Le,Er,n);const di=1/R,jr=we(di,F,j),Ai=we(f*(1-jr)+_*jr,b,w);let Nr=jr,Xr=Ai,pr=Ai*P,Fr=cs(Ai,Er,n);if(Ve===1){const _r=pr-B,ei=ct-H,Tt=Fr-q,nr=0*ie;Q[nr]=_r,Q[nr+1]=ei,Q[nr+2]=Tt,Mh(_r,ei,Tt,Z);const vr=we(di,F,j);_p(le,_e,vr,Ii)}for(let _r=1;_r<=L;_r++){const ei=pr,Tt=Fr,nr=(_r+1)/R,vr=we(nr,F,j),pi=we(f*(1-nr)+_*nr,b,w),js=Xr;Xr=pi;{const Ks=_e+1,xs=Ks*ie;if(Ve===1||_r===L){const fr=pi*P,Bi=cs(pi,Er,n);if(Ve===1&&_r<L){const dn=fr-B,Gn=Ue-H,oe=Bi-q;Q[xs]=dn,Q[xs+1]=Gn,Q[xs+2]=oe,Mh(dn,Gn,oe,Z),_p(le,Ks,vr,Ii)}pr=fr,Fr=Bi}else pr=Q[xs]+B,Fr=Q[xs+2]+q}const ur=pr,Li=Fr,ws=et,uo=Ct;et=ei,Ct=Tt;const Sa=(_e-L)*ie,Ea=Ve===1?cs(js,Re,n):Q[Sa+2]+q,ho=cs(js,Ft,n);if(Ve<L){const Ks=_e+L,xs=Ks*ie,fr=ei-B,Bi=He-H,dn=ho-q;Q[xs]=fr,Q[xs+1]=Bi,Q[xs+2]=dn,Mh(fr,Bi,dn,Z);const Gn=Nr;Nr=vr,_p(le,Ks,Gn,Et)}{const Ks=ur-ws,xs=Be-He,fr=xs*(Li-uo),Bi=Ks*(Ea-ho),dn=-xs*Ks,Gn=fr*fr+Bi*Bi+dn*dn;if(Gn===0)$p(I,_e,0,0,1,N);else{const oe=1/Math.sqrt(Gn);$p(I,_e,fr*oe,Bi*oe,dn*oe,N)}}++_e}}}function M1t(t,e){t.tile.intersectsClippingArea&&(BPe(t),zPe(t,!0),fC(t),t.intersectionData=null)}function O1t(t,e){t.tile.intersectsClippingArea&&(qPe(t),tQ(t),fC(t),XPe(t),t.intersectionData=null)}function R1t(t,e){t.tile.intersectsClippingArea&&(tQ(t),fC(t),t.intersectionData=null)}function tQ(t,e){t.tile.intersectsClippingArea&&(BPe(t),zPe(t,!1))}function zPe(t,e){const{geometry:r,geometryState:i,tile:s,localOrigin:n}=t,{surface:o,extent:a}=s,{clippingArea:l,samplerData:c}=i,u=l??iQ,h=a[0],p=a[2],f=a[1],g=a[3],_=[g>u[3],p>u[2],f<u[1],h<u[0]],v=s.horizontalScale,b=VPe(o.isWebMercatorOnPlateCarree,s.ellipsoid.radius,v),{minu:w,minv:T,maxu:S,maxv:C,boundingBox:P}=r,R=Math.max(h,u[0]),L=Math.min(p,u[2]),F=Math.max(f,u[1]),U=Math.min(g,u[3]),j=n[0],z=n[1],Z=n[2];for(let W=0;W<4;++W){const Y=W===1||W===3,le=i.edgeResolutions[W];$e(UM(le));const I=le+1,N=_[W],B=Sb(s,i.edgePeerNeighbors[W]);if(!N&&ZPe(s,B,W)){WPe(t,W,B);continue}const H=B!=null&&!N,q=B==null?void 0:B.renderData,Q=q==null?void 0:q.geometryState;if(Fn&&($e(!H||B.level===s.level),$e(!H||Kg(s,B)<=0),s&&!B&&!o.updatingRootTiles)){const He=cp[W],Et=s.findNeighborTile(He,Le=>Le.isLoaded||Le.isLeaf||Le.level===s.level);o.updatingRootTiles||(Et?Et.intersectsClippingArea&&($e(!Et.isLoaded),$e(!Et.isLeaf),$e(Et.level===s.level)):$e((o==null?void 0:o.rootTiles)==null||!s.shouldHaveNeighbor(He)))}const ie=we(W===1?p:h,R,L),_e=we(W===0?g:f,F,U),Oe=Q==null?void 0:Q.samplerData,gt=e&&I>3?I-3:1,It=we(W===1?1:0,w,S),xt=we(W===0?1:0,T,C),ct=H?(He,Et)=>.5*(cs(He,Et,Oe)+cs(He,Et,c)):(He,Et)=>cs(He,Et,c),Qe=(p-h)/le,Ve=Y?W===1?Qe:-Qe:0,yr=Y?0:W===0?Qe:-Qe,Er=-Ve,Ii=-yr;let Ue=0,dr=0,Re=0;{const He=0/le,Et=Y?ie:we(h*(1-He)+p*He,R,L),Le=Y?we(f*(1-He)+g*He,F,U):_e,et=ct(Et,Le);Ue=Et*v,dr=b(Le),Re=et}let Be=0,bt=0,Ft=0;{const He=1/le,Et=Y?ie:we(h*(1-He)+p*He,R,L),Le=Y?we(f*(1-He)+g*He,F,U):_e,et=ct(Et,Le);Be=Et*v,bt=b(Le),Ft=et}for(let He=1;He<I-1;He+=gt){const Et=He/le,Le=Be,et=bt,Ct=Ft;{const Tt=Y?It:we(Et,w,S),nr=Y?we(Et,T,C):xt,vr=Le-j,pi=et-z,js=Ct-Z;Mh(Le,pi,js,P),r.setEdgeVertexFromValuesRawPositionUV(W,He,vr,pi,js,Tt,nr)}{const Tt=(He+1)/le,nr=Y?ie:we(h*(1-Tt)+p*Tt,R,L),vr=Y?we(f*(1-Tt)+g*Tt,F,U):_e,pi=ct(nr,vr);Be=nr*v,bt=b(vr),Ft=pi}const di=Be,jr=Ft,Ai=Ue,Nr=dr,Xr=Re;Ue=Le,dr=et,Re=Ct;let pr=0,Fr=0,_r=0;if(Y){const Tt=bt-et,nr=jr-Ct,vr=Nr-et,pi=Xr-Ct,js=we(f*(1-Et)+g*Et,F,U),ur=ie+Er,Li=ur*v-Le,ws=cs(ur,js,c)-Ct,uo=W===3?-1:1;if(pr=uo*(-vr+Tt)*ws,Fr=uo*Li*(-pi+nr),_r=-uo*Li*(-vr+Tt),H){const Sa=ie+Ve,Ea=Sa*v-Le;pr=(-vr+Tt)*(ws-(cs(Sa,js,Oe)-Ct)),Fr=(Li-Ea)*(-pi+nr),_r=-(Li-Ea)*(-vr+Tt)}}else{const Tt=di-Le,nr=jr-Ct,vr=Ai-Le,pi=Xr-Ct,js=we(h*(1-Et)+p*Et,R,L),ur=_e+Ii,Li=cs(js,ur,c)-Ct,ws=b(ur)-et,uo=W===2?-1:1;if(pr=uo*ws*(-pi+nr),Fr=uo*(-vr+Tt)*Li,_r=-uo*ws*(-vr+Tt),H){const Sa=js,Ea=_e+yr,ho=b(Ea)-et;pr=(-ws+ho)*(-pi+nr),Fr=(-vr+Tt)*(-Li+(cs(Sa,Ea,Oe)-Ct)),_r=-(-ws+ho)*(-vr+Tt)}}const ei=1/Math.sqrt(pr*pr+Fr*Fr+_r*_r);r.setEdgeNormalFromValues(W,He,pr*ei,Fr*ei,_r*ei)}}}function BPe(t,e){YPe(t)}function $1t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function I1t(t,e){return t*e}function VPe(t,e,r){return t?i=>$1t(i,e):i=>I1t(i,r)}function GPe(t,e,r){const{numVerticesPerSide:i,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=i-1,a=s.count,l=2*(i-3)*(i-3),c=4*(o+n-3),u=KK.reduce((_,v)=>_+(o+t.getEdgeCount(v)-3),0),h=e.reduce((_,v)=>_+o*(2*(v.latitudeResolution-1)+1),0),p=3*(r?2:1),f=(l+c+h)*p,g=a>=_1t?new Uint32Array(f):new Uint16Array(f);for(let _=0;_<f;++_)g[_]=0;t.indices=g,t.indexCount=(l+u+h)*p,t.poleIndicesStartIndex=l*p,t.edgeIndicesStartIndex=(l+h)*p,r?(N1t(t),F1t(t,e),HPe(t)):(L1t(t),D1t(t,e),jPe(t))}function L1t(t){const{numVerticesPerSide:e,indices:r,vertexAttributes:i}=t,{position:s}=i,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,u=e-3;let h=0;for(let p=0;p<l;++p){const f=p*a;for(let g=c;g<u;++g){const _=f+g,v=_+1,b=v+a,w=b-1;KPe(_,v,b,w,o,n)?(r[h]=_,r[h+1]=v,r[h+2]=b,r[h+3]=b,r[h+4]=w,r[h+5]=_):(r[h]=_,r[h+1]=v,r[h+2]=w,r[h+3]=w,r[h+4]=v,r[h+5]=b),h+=6}}}function D1t(t,e){const{numVerticesPerSide:r,indices:i,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){let l=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),c=1;for(let u=0;u<a.latitudeResolution;++u){const h=u===0?a.rowOffset:l+r;for(let p=0;p<n;p++){const f=h+p;i[o]=l,i[o+1]=l+1,i[o+2]=f,u<a.latitudeResolution-1?(i[o+3]=l+1,i[o+4]=f+1,i[o+5]=f,o+=6):o+=3,l+=c}l=h,c=1}}}function jPe(t){const{indices:e,numVerticesPerSide:r,edgeIndicesStartIndex:i}=t,s=r-1,n=s-2;let o=i;for(let a=0;a<4;++a){const l=sQ[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;$e(p===s-1);const f=a===1||a===2,g=f?1:2,_=f?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,T=l.stride;for(;c<h-1||u<p-1;){const S=w+u*T,C=v+c*b,P=c<h-1,R=u<p-1,L=P&&(!R||(P?0+s*(c+.5)/(h-1):0)<=(R?1+n*(u+.5)/(p-1):0));L?++c:++u;const F=L?C+b:S+T;e[o]=S,e[o+g]=C,e[o+_]=F,o+=3}}t.indexCount=o}function N1t(t){const{indices:e,numVerticesPerSide:r,vertexAttributes:i}=t,{position:s}=i,{typedBuffer:n,typedBufferStride:o}=s,a=r-2;let l=0;for(let c=0;c<r-3;++c){const u=c*a;for(let h=0;h<r-3;++h){const p=c*a+h,f=p+1,g=f+a,_=g-1,v=u+h,b=v+1,w=b+a;KPe(v,b,w,w-1,o,n)?(BT(e,l,p,f,g),l+=6,BT(e,l,g,_,p)):(BT(e,l,p,f,_),l+=6,BT(e,l,_,g,f)),l+=6}}}function F1t(t,e){const{indices:r,numVerticesPerSide:i,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let h=0;h<a.latitudeResolution;++h){const p=h===0?a.rowOffset:c+i;for(let f=0;f<n;f++)BT(r,o,c,c+1,p+f),o+=6,h<a.latitudeResolution-1&&(BT(r,o,c+1,p+f+1,p+f),o+=6),c+=u;c=p,u=1}}}function HPe(t){const{indices:e,numVerticesPerSide:r,edgeIndicesStartIndex:i}=t,s=r-1,n=s-2;let o=i;for(let a=0;a<4;++a){const l=sQ[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;$e(p===s-1);const f=a===1||a===2,g=f?1:3,_=f?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,T=l.stride;for(;c<h-1||u<p-1;){const S=w+u*T,C=v+c*b,P=c<h-1,R=u<p-1,L=P&&(!R||(P?0+s*(c+.5)/(h-1):0)<=(R?1+n*(u+.5)/(p-1):0));L?++c:++u;const F=L?C+b:S+T;e[o]=S,e[o+g]=C,e[o+g+1]=C,e[o+_]=F,e[o+_+1]=F,e[o+5]=S,o+=6}}t.indexCount=o}function rQ(t){const{geometry:e,geometryState:r}=t,{edgeResolutions:i}=r,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),h=(c?0:1)*o+(c?1:0),p=sQ[l];p.vertex0Index=u,p.stride=h,p.count=o}{const c=i[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function qPe(t){rQ(t),t.geometryState.wireframe?HPe(t.geometry):jPe(t.geometry)}function WPe(t,e,r){const i=(e+2)%4,{geometryState:s,geometry:n,tile:o,localOrigin:a}=t,l=o.level-r.level,c=e===1||e===3,u=s.edgeResolutions[e];$e(UM(u));const h=u+1,{boundingBox:p,minu:f,minv:g,maxu:_,maxv:v,vertexAttributes:b}=n,w=we(e===1?1:0,f,_),T=we(e===0?1:0,g,v),S=r.renderData,C=S.geometryState,P=S.geometry,R=P.getEdgeCount(i),L=o.getNeighborEdgeStartVertexIndex(e,r)*u,F=u*2**l;$e(C.edgeResolutions[i]===F),$e(R-1===F);const U=S.localOrigin[0]-a[0],j=S.localOrigin[1]-a[1],z=S.localOrigin[2]-a[2],Z=n.getEdgeFirstVertexIndex(e),W=b.position,Y=W.typedBuffer,le=W.typedBufferStride,I=b.normalCompressed,N=I.typedBuffer,B=I.typedBufferStride,H=b.uv0,q=P.vertexAttributes,Q=P.getEdgeFirstVertexIndex(i),ie=q.position.typedBuffer,_e=q.position.typedBufferStride,Oe=q.normalCompressed.typedBuffer,gt=q.normalCompressed.typedBufferStride;for(let It=1;It<h-1;++It){const xt=Z+It,ct=Q+(L+It),Qe=xt*le,Ve=ct*_e,yr=ie[Ve]+U,Er=ie[Ve+1]+j,Ii=ie[Ve+2]+z;Y[Qe]=yr,Y[Qe+1]=Er,Y[Qe+2]=Ii,Mh(yr,Er,Ii,p);const Ue=xt*B,dr=ct*gt;N[Ue]=Oe[dr],N[Ue+1]=Oe[dr+1];const Re=It/u,Be=c?w:we(Re,f,_),bt=c?we(Re,g,v):T;_p(H,xt,Be,bt)}}function YPe(t){var Ii;const{geometry:e,geometryState:r,localOrigin:i,tile:s}=t,{clippingArea:n,samplerData:o}=r,{minu:a,minv:l,maxu:c,maxv:u,boundingBox:h,vertexAttributes:p}=e,{surface:f,ellipsoid:g,extent:_,extentInRadians:v,horizontalScale:b}=s,w=((Ii=f.view)==null?void 0:Ii.viewingMode)==="local",T=g.radius;let S=0,C=0,P=0;const R=(Ue,dr,Re)=>{const Be=v[dr===0?1:3],bt=v[Ue===0?0:2],Ft=Math.cos(Be),He=Math.sin(Be),Et=Math.sin(bt),Le=Math.cos(bt),et=T+Re;S=Le*Ft*et,C=Et*Ft*et,P=He*et},L=w?(()=>{const Ue=n,dr=Ue!=null&&(_[3]>Ue[3]||_[2]>Ue[2]||_[1]<Ue[1]||_[0]<Ue[0]),Re=VPe(f.isWebMercatorOnPlateCarree,T,b);return(Be,bt,Ft)=>{const He=Be===0?_[0]:_[2],Et=bt===0?_[1]:_[3],Le=dr?we(He,Ue[0],Ue[2]):He,et=dr?we(Et,Ue[1],Ue[3]):Et,Ct=Ft;S=Le*b,C=Re(et),P=Ct}})():R;let F=0,U=0,j=0,z=0,Z=0,W=0,Y=0,le=0,I=0;const N=w&&f.isWebMercatorOnPlateCarree,B=(Ue,dr,Re,Be,bt)=>{let Ft=0,He=0,Et=0;if(w){const Le=dr*b,et=N?(Math.PI/2-2*Math.atan(Math.exp(-Re/T)))*T:Re*b;Ft=Le-S,He=et-C,Et=Be-P}else{const Le=eQ(Ue),et=Ue.tile,Ct=et.extent,di=et.extentInRadians,jr=(dr-Ct[0])/(Ct[2]-Ct[0]),Ai=(Re-Ct[1])/(Ct[3]-Ct[1]),Nr=di[0]*(1-jr)+di[2]*jr,Xr=Le(Ai),pr=Math.cos(Xr),Fr=Math.sin(Xr),_r=Math.sin(Nr),ei=Math.cos(Nr),Tt=T+Be;Ft=ei*pr*Tt-S,He=_r*pr*Tt-C,Et=Fr*Tt-P}switch(bt){case 0:Y+=Ft,le+=He,I+=Et;break;case 1:z-=Ft,Z-=He,W-=Et;break;case 2:Y-=Ft,le-=He,I-=Et;break;case 3:z+=Ft,Z+=He,W+=Et}},H=n??iQ,q=_[0],Q=_[2],ie=_[1],_e=_[3],Oe=[_e>H[3],Q>H[2],ie<H[1],q<H[0]],gt=Math.max(q,H[0]),It=Math.min(Q,H[2]),xt=Math.max(ie,H[1]),ct=Math.min(_e,H[3]),Qe=Ue=>Math.max(H[0],Math.min(H[2],Ue)),Ve=Ue=>Math.max(H[1],Math.min(H[3],Ue)),yr=Ue=>{const dr=r.cornerNeighborCornerTiles;F=0,U=0,j=1,z=0,Z=0,W=0,Y=0,le=0,I=0;let Re=1/0;for(let Le=0;Le<4;++Le){const et=dr[4*Ue+Le];Re=Math.min(Re,(et==null?void 0:et.level)??1/0)}for(let Le=0;Le<4;++Le){const et=dr[4*Ue+Le];S3[Le]=(et==null?void 0:et.level)===Re?et:null}let Be=1,bt=0;for(let Le=0;Le<4;++Le){const et=S3[Le];et&&(Be=Math.max(Be,et==null?void 0:et.renderData.geometryState.numVerticesPerSide),bt=et.extent[2]-et.extent[0])}const Ft=bt,He=Be;$e(He>1);const Et=Ft/He;for(let Le=0;Le<4;++Le){const et=S3[(Le+3)%4],Ct=S3[Le%4];if(!et&&!Ct)continue;const di=Le===0?1:Le===1?2:Le===2?3:0,jr=Le===0?2:Le===1?3:Le===2?0:1;if(et&&Ct){const Ai=pB[Le][0]*Et,Nr=pB[Le][1]*Et,Xr=et.extent,pr=Qe(Xr[di===0||di===1?2:0]+Ai),Fr=Ve(Xr[di===0||di===3?3:1]+Nr),_r=Ct.extent,ei=Qe(_r[jr===0||jr===1?2:0]+Ai),Tt=Ve(_r[jr===0||jr===3?3:1]+Nr),nr=et.renderData,vr=Ct.renderData,pi=cs(pr,Fr,nr.geometryState.samplerData),js=cs(ei,Tt,vr.geometryState.samplerData);B(nr,pr,Fr,.5*(pi+js),Le)}else{const Ai=et??Ct,Nr=et?di:jr,Xr=Ai.extent,pr=pB[Le],Fr=Qe(Xr[Nr===0||Nr===1?2:0]+pr[0]*Et),_r=Ve(Xr[Nr===0||Nr===3?3:1]+pr[1]*Et),ei=Ai.renderData,Tt=cs(Fr,_r,ei.geometryState.samplerData);B(ei,Fr,_r,Tt,Le)}}if(!w){const Le=Math.sqrt(S*S+C*C+P*P);F=S/Le,U=C/Le,j=P/Le}if(w||j*j<.999){const Le=Math.sqrt(z*z+Z*Z+W*W);z/=Le,Z/=Le,W/=Le;const et=Math.sqrt(Y*Y+le*le+I*I);Y/=et,le/=et,I/=et,F=W*le-Z*I,U=z*I-W*Y,j=Z*Y-z*le;const Ct=1/Math.sqrt(F*F+U*U+j*j);F*=Ct,U*=Ct,j*=Ct}},Er=r.cornerNeighborCornerTiles;for(let Ue=0;Ue<4;++Ue){const dr=Ue,Re=(Ue+1)%4,Be=Ue===0||Ue===1?1:0,bt=Ue===0||Ue===3?1:0,Ft=we(Be,a,c),He=we(bt,l,u),Et=e.getEdgeFirstVertexIndex(dr),Le=e.getEdgeCount(dr),et=Ue===0||Ue===3?Le-1:0,Ct=e.getEdgeFirstVertexIndex(Re),di=e.getEdgeCount(Re),jr=Ue===0||Ue===1?di-1:0;let Ai=-1;for(let pr=0;pr<4;++pr){const Fr=Er[4*Ue+pr],_r=Er[4*Ue+Ai];Fr&&(Ai===-1||Kg(_r,Fr)>0)&&(Ai=pr)}const Nr=Ai,Xr=Er[4*Ue+Nr];if(Xr!==s){const pr=s.level-Xr.level,Fr=2**pr,_r=[Xr.lij[0]+pr,Xr.lij[1]*Fr,Xr.lij[2]*Fr],ei=[_r[1]+Fr===s.lij[1],Ue===0&&(Nr===1||Nr===0&&Xr!==Er[4*Ue+3])||Ue===1&&(Nr===0||Nr===1&&Xr!==Er[4*Ue+2]),_r[1]===s.lij[1]+1,Ue===2&&(Nr===3||Nr===2&&Xr!==Er[4*Ue+1])||Ue===3&&(Nr===2||Nr===3&&Xr!==Er[4*Ue+0])],Tt=ei.reduce((ur,Li)=>ur+(Li?1:0),0);$e(Tt===1||Tt===2);let nr=-1,vr=-1;const pi=Xr.renderData;if(Tt===1){const ur=ei.findIndex(ws=>ws);$e(0<=ur&&ur<=3),nr=(ur+2)%4;const Li=r.edgeResolutions[ur];vr=s.getNeighborEdgeStartVertexIndex(ur,Xr)*Li+Li*(ur===0&&Ue===0||ur===1&&Ue===0||ur===2&&Ue===1||ur===3&&Ue===3?1:0)}else{$e(ei[1]||ei[3]),nr=ei[1]?3:1;const ur=pi.geometryState.edgeResolutions[nr];vr=Ue===0||Ue===3?0:ur}const js=pi.geometry;{const ur=Et+et,Li=Ct+jr,ws=js.getEdgeFirstVertexIndex(nr)+vr,uo=js.vertexAttributes,Sa=pi.localOrigin;{const ho=uo.position,Ks=ho.typedBuffer,xs=ws*ho.typedBufferStride,fr=Ks[xs]+Sa[0]-i[0],Bi=Ks[xs+1]+Sa[1]-i[1],dn=Ks[xs+2]+Sa[2]-i[2];Mh(fr,Bi,dn,h);const Gn=p.position,oe=Gn.typedBuffer;{const Hr=ur*Gn.typedBufferStride;oe[Hr]=fr,oe[Hr+1]=Bi,oe[Hr+2]=dn}{const Hr=Li*Gn.typedBufferStride;oe[Hr]=fr,oe[Hr+1]=Bi,oe[Hr+2]=dn}}const Ea=p.uv0;_p(Ea,ur,Ft,He),_p(Ea,Li,Ft,He);{const ho=uo.normalCompressed.typedBuffer,Ks=ws*uo.normalCompressed.typedBufferStride,xs=p.normalCompressed,fr=xs.typedBuffer;{const Bi=ur*xs.typedBufferStride;fr[Bi]=ho[Ks],fr[Bi+1]=ho[Ks+1]}{const Bi=Li*xs.typedBufferStride;fr[Bi]=ho[Ks],fr[Bi+1]=ho[Ks+1]}}}}else{const pr=Oe[dr],Fr=Oe[Re];let _r;if(pr||Fr){const vr=we(q*(1-Be)+Q*Be,gt,It),pi=we(ie*(1-bt)+_e*bt,xt,ct);_r=cs(vr,pi,o)}else _r=k1t(Er,Ue);L(Be,bt,_r),yr(Ue);const ei=S-i[0],Tt=C-i[1],nr=P-i[2];Mh(ei,Tt,nr,h),e.setEdgeVertexFromValuesRawPositionUVNormal(dr,et,ei,Tt,nr,Ft,He,F,U,j),e.setEdgeVertexFromValuesRawPositionUVNormal(Re,jr,ei,Tt,nr,Ft,He,F,U,j)}}for(let Ue=0;Ue<4;++Ue)S3[Ue]=null}function k1t(t,e){var a,l;const r=4*e,i=KK.reduce((c,u)=>{var h;return Math.min(c,((h=t[r+u])==null?void 0:h.level)??1/0)},1/0);Fn&&($e(!t[r+0]||!t[r+2]||eW(t[r+0],t[r+2],pt.SOUTH_WEST)),$e(!t[r+1]||!t[r+3]||eW(t[r+1],t[r+3],pt.NORTH_WEST)));let s=0,n=0;for(let c=0;c<4;++c){const u=t[r+c];if(u&&u.level===i){const h=c===0||c===1,p=c===0||c===3,f=u.extent,g=f[h?0:2],_=f[p?1:3],v=(l=(a=u.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;n+=cs(g,_,v),s++}}const o=s?n/s:0;return $e(o!=null),o}function fC(t){const{vao:e,geometry:r}=t,{vertexAttributes:i,edgeVerticesStartIndex:s}=r,n=i.position.typedBuffer;e.vertexBuffers.geometry.setSubData(n,s,s,n.length)}function XPe(t){const{vao:e,geometry:r}=t,{indices:i,indexCount:s,edgeIndicesStartIndex:n}=r;e.indexBuffer.setSubData(i,n,n,s)}const pB=[[0,1],[1,0],[0,-1],[-1,0]],bo=new E_t,iQ=QO(-1/0,-1/0,1/0,1/0),S3=[null,null,null,null];function ZPe(t,e,r){if(!e)return!1;const i=Kg(t,e);return i>0||i===0&&r>=2}let IL=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return $e(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const sQ=[new IL,new IL,new IL,new IL];function Mh(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}function JPe(t){const{edgeResolutions:e,numVerticesPerSide:r}=t,i=1+Math.max(...e);return Math.max(r,i)}function KPe(t,e,r,i,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],u=e*s,h=n[u],p=n[u+1],f=n[u+2],g=r*s,_=n[g],v=n[g+1],b=n[g+2],w=i*s,T=n[w],S=n[w+1],C=n[w+2];return(h-T)*(h-T)+(p-S)*(p-S)+(f-C)*(f-C)>(a-_)*(a-_)+(l-v)*(l-v)+(c-b)*(c-b)}function BT(t,e,r,i,s){t[e]=r,t[e+1]=i,t[e+2]=i,t[e+3]=s,t[e+4]=s,t[e+5]=r}const VN=6;let U1t=class extends YK{constructor(e,r,i,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=jt(),this._baseUsedMemory=900,this.init(e,r,i,s,n)}init(e,r,i,s,n){super.init(e,r,i,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&GM(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,u=this._extentInRenderSR,h=this.extent;if(c){const p=Pe(h[0],h[1],0);ya(p,Xe.WebMercator,p,Xe.PlateCarree);const f=Pe(h[2],h[3],0);ya(f,Xe.WebMercator,f,Xe.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=f[0],u[3]=f[1]}else for(let p=0;p<4;++p)u[p]=h[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[Ys.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const h=e[u],p=h[0],f=h[1],g=h[2],_=h[3];if(p*(p>0?i:o)+f*(f>0?s:a)+g*(g>0?n:l)+_>=0)return ca.OUTSIDE;c=c&&p*(p<0?i:o)+f*(f<0?s:a)+g*(g<0?n:l)+_<=0}return c?ca.INSIDE:ca.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return lje(e[0],e[1],this.elevationBoundsMin,e[2],e[3],this.elevationBoundsMax)}intersectsRay(e,r,i,s){return LL[0]=1/r[0],LL[1]=1/r[1],LL[2]=1/r[2],_J(this._aabb(),e,LL,i,s)}createGeometry(){A1t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){M1t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){R1t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevationsAndResolutions(){O1t(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const LL=E();let z1t=class{constructor(){this.extent=Yt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},GN=class extends Me{constructor(){super(...arguments),this._queries=new kt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new kt({initialSize:30}),this._queryPool=new qo(z1t)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();xh(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};d([m()],GN.prototype,"updating",null),GN=d([V("esri.views.3d.terrain.ScaleRangeQueries")],GN);function B1t(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}let V1t=class extends YK{constructor(e,r,i,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=Vs(),this._baseUsedMemory=1816,this.init(e,r,i,s,n)}init(e,r,i,s,n){super.init(e,r,i,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],h=Pt(l,u,.5),p=Pt(a,c,.5),f=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),B1t(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),fe(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)te(e[Ys.MIDDLE],0,0,0),te(e[Ys.TOP],0,0,0),te(e[Ys.BOTTOM],0,0,0),e[Ys.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const r=e[Ys.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,G1t(r,i,3*n));e[Ys.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!y_(e,this._boundingSphere))return ca.OUTSIDE;if(this.lij[0]<10)return ca.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<iC;n++){const o=n===ci.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],h=a[3]-(o?i:0);let p=!1;for(let f=0;f<8;++f){const g=3*f;if(l*r[g]+c*r[g+1]+u*r[g+2]+h<0){if(p=!0,!s)break}else s=!1}if(!p)return ca.OUTSIDE}return s?ca.INSIDE:ca.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){v1t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Fn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)te(r,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];fv(Eue,l,c,n),fv(Cue,l,u,n),pe(r,Eue,Cue),re(r,r,(n+.5*(i+s))/nc(r));const h=this.convexHull;let p=0;const f=(_,v)=>{const b=_[0]-h[3*v],w=_[1]-h[3*v+1],T=_[2]-h[3*v+2];return Math.sqrt(b*b+w*w+T*T)};for(let _=0;_<8;++_){const v=f(r,_);p=Math.max(p,v)}const g=p;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===fh.HAS_NORTH_POLE,l=o&&n===fh.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,h=e[0],p=e[2],f=l?-u:e[1],g=a?u:e[3],_=.5*(h+p),v=i,b=r+(c?Math.min(0,v-1):v),w=(I,N,B)=>fv(I,N,B,b),T=E(),S=E(),C=E(),P=E();w(T,h,f),w(S,h,g),w(C,p,g),w(P,p,f);const R=(I,N)=>{for(let B=0;B<3;++B)this._convexHull[3*N+B]=I[B]};R(T,0),R(S,1),R(C,2),R(P,3);const L=s,F=r+(c?Math.max(0,L+1):L),U=E(),j=E(),z=E();fv(j,_,g,b),fv(z,_,f,b),pe(U,j,z),fe(U,U);const Z=E(),W=E(),Y=(I,N)=>{Hi(W,I,N),fe(W,W);const B=-de(I,Z)/de(W,Z);$e(B>=0),re(W,W,B),pe(I,I,W)};if(2**this.lij[0]>2*this.lij[1]){const I=z,N=E();Ze(N,Sue,I),fe(N,N),Ze(Z,I,N),fe(Z,Z),$e(mh(de(Z,I)/nc(I),0)),Y(T,S),Y(P,C),R(T,0),R(P,3)}else if(2**this.lij[0]!==2*this.lij[1]){const I=j,N=E();Ze(N,Sue,I),fe(N,N),Ze(Z,N,I),fe(Z,Z),Y(S,T),Y(C,P),R(S,1),R(C,2)}const le=(I,N)=>{const B=F/de(N,U);for(let H=0;H<3;++H)this._convexHull[3*I+H]=N[H]*B};le(4,T),le(5,S),le(6,C),le(7,P)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?fh.HAS_BOTH_POLES:fh.HAS_NORTH_POLE:i?fh.HAS_SOUTH_POLE:fh.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],h=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*h-l,f=r[1]*h-c,g=r[2]*h-u;return p*p+f*f+g*g<o*o}getDefaultVerticesPerSide(){return this.level<Tue.length?Tue[this.level]+1:2}updateCornerElevations(){S1t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){x1t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){T1t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var dr;if(!Fn||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=E(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,u=0,h=this._center[Ys.MIDDLE][3],p=this.convexHull,f=(Re,Be)=>{for(let bt=0;bt<3;++bt)Re[bt]=p[3*Be+bt]};{const Re=E(),Be=E(),bt=E(),Ft=E(),He=E(),Et=(Le,et,Ct,di)=>{f(Be,Le),f(bt,et),f(Ft,Ct),Hi(Be,Be,bt),Hi(Ft,Ft,bt),Ze(Re,Be,Ft),fe(Re,Re);const jr=de(Re,bt);f(He,di);const Ai=de(Re,He),Nr=Math.abs(Ai-jr);$e(mh(Nr,0),`Non coplanar ${Le},${et},${Ct},${di} diff = ${Nr}`)};Et(0,1,2,3),Et(4,5,6,7),Et(0,1,4,5),Et(1,2,5,6),Et(2,3,6,7),Et(3,0,7,4)}const g=ao(24),_=(Re,Be,bt)=>{const Ft=4*Re;for(let He=0;He<3;++He)g[Ft+He]=Be[He];g[Ft+3]=bt},v=E(),b=E(),w=E(),T=E(),S=(Re,Be,bt,Ft)=>{f(v,Be),f(b,bt),f(w,Ft),Hi(v,v,b),fe(v,v),Hi(w,w,b),fe(w,w),Ze(T,v,w),fe(T,T);const He=de(T,b);_(Re,T,He)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const C=1,P=(Re,Be,bt,Ft)=>{const He=4*Re;return g[He]*Be+g[He+1]*bt+g[He+2]*Ft-g[He+3]},R=(Re,Be,bt,Ft)=>P(Re,Be,bt,Ft)>=-C,L=(Re,Be)=>R(Re,Be[0],Be[1],Be[2]),F=2**this.lij[0]>2*this.lij[1],U=(Re,Be,bt)=>Math.sqrt(QPe(Re,Be,bt,i[0],i[1],i[2]))<r,j=Re=>U(Re[0],Re[1],Re[2]),z=(Re,Be)=>U(Re[Be],Re[Be+1],Re[Be+2]),Z=this.extentInRadians,W=.5*(Z[0]+Z[2]),Y=Z[1],le=Z[3],I=E(),N=E();fv(I,W,le,l),fv(N,W,Y,l);const B=F?"Upper":"Lower";let H=!0;for(let Re=0;Re<6;++Re){for(let Be=0;Be<8;++Be){const bt=3*Be,Ft=R(Re,p[bt],p[bt+1],p[bt+2]);H&&(H=Ft),$e(Ft,`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Re}`)}$e(L(Re,N),`Tile[${this.lij}] (${B}) bottom mid outside of plane ${Re}`),$e(L(Re,I),`Tile[${this.lij}] (${B}) top mid outside of plane ${Re}`)}$e(H,"Not all convex hull points are inside  convex hull polyhedron"),$e(j(N),`Tile[${this.lij}] (${B}) bottom mid outside of bounding sphere`),$e(j(I),`Tile[${this.lij}] (${B}) top mid outside of bounding sphere`);for(let Re=0;Re<8;++Re){const Be=z(p,3*Re);$e(Be,`Tile[${this.lij}] Convex hull point ${Re} outside of bounding sphere`)}for(let Re=0;Re<6;++Re)for(let Be=0;Be<8;++Be){const bt=3*Be;R(Re,p[bt],p[bt+1],p[bt+2])||console.error(`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Re}`)}const{extentInRadians:q}=this,Q=Math.max(q[2]-q[0],q[3]-q[1]),ie=Math.round(Q*n),{renderData:_e}=this;if(!_e)return;const{geometry:Oe,geometryState:gt,localOrigin:It}=_e,xt=(dr=Oe.vertexAttributes)==null?void 0:dr.position;if(!xt)return;const ct=E(),Qe=Oe.numVerticesPerSide-2,{indices:Ve,indexCount:yr,edgeVerticesStartIndex:Er,poleVerticesStartIndex:Ii}=Oe;if(!Ve)return;const Ue=new Set;for(let Re=0;Re<yr;++Re){const Be=Ve[Re];if(Ue.has(Be))continue;Ue.add(Be);const bt=Be<Ii,Ft=Be>=Er;let He=!1,Et=-1;if(Ft){let Tt=Er;for(let nr=0;nr<4;++nr){const vr=gt.edgeResolutions[nr];if(Be===Tt||Be===Tt+vr-1){He=!0;break}if(Tt+=vr,Be<Tt){Et=nr;break}}}const Le=Ft?gt.edgePeerNeighbors[Et]:null,et=Ft&&Le&&Kg(this,Le)>0;xt.getVec(Be,s),pe(ct,s,It);const Ct=nc(ct)-n;let di=0,jr=!1;const Ai=o-Ct,Nr=Ct-a,Xr=Ai>c,pr=Nr>c,Fr=Xr||pr,_r=()=>{const Tt=bt?"internal":Ft&&!He?"edge":He?"corner":"pole";return`Tile[${this.lij}].vertex[${Be}]:${Tt}`+(Xr?"(below)":pr?"(above)":"")+(et?"(Neighbor)":"")},ei=Vg(ct,i);if(ei>=r+u){const Tt=ei-r;Fr||(console.error(`${_r()} is out of the bounding sphere by ${Tt.toFixed(0)} / ${r.toFixed(0)}[tol=${u}] h=${Ct.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Tt/r).toFixed(0)})`),jr=!0)}for(let Tt=0;Tt<6;++Tt)if(!R(Tt,ct[0],ct[1],ct[2])){const nr=P(Tt,ct[0],ct[1],ct[2]),vr=Be%Qe,pi=(Be-vr)/Qe;Tt===0&&Ai||Tt===5&&Nr||(console.error(`${_r()} (${vr},${pi})|${Qe}] is out of the bounding trapezoid plane ${Tt} h=${Math.round(Ct)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(nr)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${ie}`),++di)}if(jr||di>0)break}}get convexHull(){return this._convexHull}};const Tue=[128,64,64,32,16,8,8,4];function G1t(t,e,r){return QPe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function QPe(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const fv=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},Sue=[0,0,1],Eue=E(),Cue=E();let Od=class extends Me{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],Od.prototype,"fovX",void 0),d([m()],Od.prototype,"fovY",void 0),d([m()],Od.prototype,"relativeWidthLimit",void 0),d([m()],Od.prototype,"relativeHeightLimit",void 0),d([m()],Od.prototype,"maxLod",void 0),d([m()],Od.prototype,"angledSplitBias",void 0),d([m()],Od.prototype,"aboveGround",void 0),d([m()],Od.prototype,"frustum",void 0),Od=d([V("esri.views.3d.terrain.SplitLimits")],Od);const j1t=Yi().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0});let H1t=class{constructor(e){this._storage=new UR((r,i)=>e.newCache(r,i),"TileGeometry")}acquire(e){const i=Math.ceil(e/4)*4,s=this._storage,n=q1t(i),o=s.pop(n);if(o)return o;const a=j1t.createBuffer(i);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function q1t(t){return t.toString()}let eMe=class extends zl{constructor(){super(...arguments),this.blendMode=De.Normal}};d([G({count:De.COUNT})],eMe.prototype,"blendMode",void 0);let SM=class extends eMe{constructor(){super(...arguments),this.output=sn.Composite,this.baseOpacityMode=sa.NotRequired,this.premultipliedSource=Gd.Off}};d([G({count:sn.COUNT})],SM.prototype,"output",void 0),d([G({count:sa.COUNT})],SM.prototype,"baseOpacityMode",void 0),d([G()],SM.prototype,"premultipliedSource",void 0);var a1;function tMe(t){const e=new Or;if(e.include(PPe),t.background===a1.Only){const r=t.output===sn.ColorComposite;return r?e.fragment.uniforms.add(new Dt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(WK),e.fragment.code.add(x`
    void main() {
      fragColor = vec4(${r?x`backgroundColor`:x`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(MPe,t),e.fragment.uniforms.add(new at("tex",r=>r.texture)),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(x`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(a1||(a1={}));const W1t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a1},build:tMe},Symbol.toStringTag,{value:"Module"}));let Y1t=class extends APe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Cn}},rMe=class iMe extends Gr{initializeProgram(e){return new Dr(e.rctx,iMe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};rMe.shader=new Lr(W1t,()=>me(()=>Promise.resolve().then(()=>SAt),void 0));let sMe=class extends SM{constructor(){super(...arguments),this.background=a1.BelowLayer}};d([G()],sMe.prototype,"background",void 0);let fB=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=zt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Pe(s,n,o)}destroy(){this.texture.release()}};function EM(){return[1,0,0,1,0,0]}function X1t(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Z1t(t,e,r,i,s,n){return[t,e,r,i,s,n]}function J1t(t,e){return new Float64Array(t,e,6)}const K1t=EM();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:K1t,clone:X1t,create:EM,createView:J1t,fromValues:Z1t},Symbol.toStringTag,{value:"Module"}));function Q1t(t){return t instanceof Float32Array&&t.length>=2}function evt(t){return Array.isArray(t)&&t.length>=2}function DL(t){return Q1t(t)||evt(t)}const NL={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new tp({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Xe.WebMercator}),minus180Line:new tp({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Xe.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new tp({paths:[[[180,-180],[180,180]]],spatialReference:Xe.WGS84}),minus180Line:new tp({paths:[[[-180,-180],[-180,180]]],spatialReference:Xe.WGS84})}};function Gb(t,e){return Math.ceil((t-e)/(2*e))}function nMe(t,e){const r=CM(t);for(const i of r)for(const s of i)s[0]+=e;return t}function CM(t){return yc(t)?t.rings:t.paths}async function tvt(t,e,r,i){const s=sPe(t),n=e[0].spatialReference,o={...i,responseType:"json",query:{...s.query,f:"json",sr:N4(n),target:JSON.stringify({geometryType:eR(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await Wr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const h=Mw(u);return h.spatialReference=n,h})}}async function rvt(t,e,r){const i=typeof t=="string"?$s(t):t,s=e[0].spatialReference,n=eR(e[0]),o={...r,query:{...i.query,f:"json",sr:N4(s),geometries:JSON.stringify(w0t(e))}},{data:a}=await Wr(i.path+"/simplify",o);return nPe(a.geometries,n,s)}const oMe=()=>ae.getLogger("esri.geometry.support.normalizeUtils");function ivt(t){return t.type==="polygon"}function svt(t){return t[0].type==="polygon"}function nvt(t){return t[0].type==="polyline"}function ovt(t,e){if(!(t instanceof tp||t instanceof bp)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw oMe().error(s),new J(s)}const r=CM(t),i=[];for(const s of r){const n=[];i.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],u=s[o+1][1],h=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),p=(u-l)/h,f=(c-a)/h,g=h/e;if(g>1){for(let w=1;w<=g-1;w++){const T=w*e,S=f*T+a,C=p*T+l;n.push([S,C])}const _=(h+Math.floor(g-1)*e)/2,v=f*_+a,b=p*_+l;n.push([v,b])}n.push([c,u])}}return ivt(t)?new bp({rings:i,spatialReference:t.spatialReference}):new tp({paths:i,spatialReference:t.spatialReference})}function Aue(t,e,r){if(e){const i=ovt(t,1e6);t=_T(i,!0)}return r&&(t=nMe(t,r)),t}function Pue(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const s=Gb(i,e);t[0]=i+s*(-2*e)}else if(i<r){const s=Gb(i,r);t[0]=i+s*(-2*r)}}else{const i=t.x;if(i>e){const s=Gb(i,e);t=t.clone().offset(s*(-2*e),0)}else if(i<r){const s=Gb(i,r);t=t.clone().offset(s*(-2*r),0)}}return t}function avt(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const s=e.cutIndexes[i],n=e.geometries[i],o=CM(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const f=l[p][0];u=f>u?f:u}u=Number(u.toFixed(9));const h=-360*Gb(u,180);for(let p=0;p<l.length;p++){const f=n.getPoint(a,p);n.setPoint(a,p,f.clone().offset(h,0))}return!0}})}if(s===r){if(svt(t))for(const a of CM(n))t[s]=t[s].addRing(a);else if(nvt(t))for(const a of CM(n))t[s]=t[s].addPath(a)}else r=s,t[s]=n}return t}async function lvt(t,e,r){if(!Array.isArray(t))return lvt([t],e);e&&typeof e!="string"&&oMe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??ii.geometryServiceUrl;let s,n,o,a,l,c,u,h,p=0;const f=[],g=[];for(const S of t)if(S!=null)if(s||(s=S.spatialReference,n=pp(s),o=s.isWebMercator,c=o?102100:4326,a=NL[c].maxX,l=NL[c].minX,u=NL[c].plus180Line,h=NL[c].minus180Line),n)if(S.type==="mesh")g.push(S);else if(S.type==="point")g.push(Pue(S.clone(),a,l));else if(S.type==="multipoint"){const C=S.clone();C.points=C.points.map(P=>Pue(P,a,l)),g.push(C)}else if(S.type==="extent"){const C=S.clone()._normalize(!1,!1,n);g.push(C.rings?new bp(C):C)}else if(S.extent){const C=S.extent,P=Gb(C.xmin,l)*(2*a);let R=P===0?S.clone():nMe(S.clone(),P);C.offset(P,0),C.intersects(u)&&C.xmax!==a?(p=C.xmax>p?C.xmax:p,R=Aue(R,o),f.push(R),g.push("cut")):C.intersects(h)&&C.xmin!==l?(p=C.xmax*(2*a)>p?C.xmax*(2*a):p,R=Aue(R,o,360),f.push(R),g.push("cut")):g.push(R)}else g.push(S.clone());else g.push(S);else g.push(S);let _=Gb(p,a),v=-90;const b=_,w=new tp;for(;_>0;){const S=360*_-180;w.addPath([[S,v],[S,-1*v]]),v*=-1,_--}if(f.length>0&&b>0){const S=avt(f,await tvt(i,f,w,r)),C=[],P=[];for(let F=0;F<g.length;F++){const U=g[F];if(U!=="cut")P.push(U);else{const j=S.shift(),z=t[F];z!=null&&z.type==="polygon"&&z.rings&&z.rings.length>1&&j.rings.length>=z.rings.length?(C.push(j),P.push("simplify")):P.push(o?rm(j):j)}}if(!C.length)return P;const R=await rvt(i,C,r),L=[];for(let F=0;F<P.length;F++){const U=P[F];U!=="simplify"?L.push(U):L.push(o?rm(R.shift()):R.shift())}return L}const T=[];for(let S=0;S<g.length;S++){const C=g[S];if(C!=="cut")T.push(C);else{const P=f.shift();T.push(o===!0?rm(P):P)}}return T}function cvt(t,e,r){const i=pp(r);if(i==null)return t;const[s,n]=i.valid,o=2*n;let a=0,l=0;e>n?a=Math.ceil(Math.abs(e-n)/o):e<s&&(a=-Math.ceil(Math.abs(e-s)/o)),t>n?l=Math.ceil(Math.abs(t-n)/o):t<s&&(l=-Math.ceil(Math.abs(t-s)/o));let c=t+(a-l)*o;const u=c-e;return u>n?c-=o:u<s&&(c+=o),c}const uvt=96,hvt=39.37;function nQ(t,e){return e.type?cr(t,e.x,e.y):Vn(t,e)}function dvt(t){return xa(t)}function pvt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const fvt=function(){const t=je();return function(e,r,i){const s=r.targetGeometry;nQ(t,s);const n=.5*O8(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function O8(t){return t.scale*mvt(t.targetGeometry)}function mvt(t){return t!=null&&qf(t.spatialReference)?1/(dvt(t.spatialReference)*hvt*uvt):1}function gvt(t){return g6(t.rotation)||0}const oQ=function(){const t=je(),e=je(),r=je();return function(i,s,n,o,a,l){return mZ(t,s),_c(e,n,.5*l),cr(r,1/o*l,-1/o*l),mK(i,e),a&&pK(i,i,a),DCe(i,i,r),fK(i,i,t),i}}(),yvt=function(){const t=je();return function(e,r,i,s){const n=O8(r),o=gvt(r);return nQ(t,r.targetGeometry),oQ(e,t,i,n,o,s)}}(),_vt=function(){const t=je();return function(e,r,i,s){const n=O8(r);return nQ(t,r.targetGeometry),oQ(e,t,i,n,0,s)}}();function vvt(t){const e=pp(t);return e?e.valid[1]-e.valid[0]:0}function bvt(t,e){return Math.round(vvt(t)/e)}var tW;const Oa=[0,0];let By=tW=class extends We{constructor(t){super(t),this._viewpoint2D={center:je(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new $r,this.id=0,this.inverseTransform=EM(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=EM(),this.transformNoRotation=EM(),this.displayMat3=um(),this.displayViewMat3=um(),this.viewMat3=um(),this.viewMat2d=FCe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=pvt(r,t.viewpoint),this._set("size",Vn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new tW({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return DL(e)?Ny(t,e,this.inverseTransform):(Oa[0]=e,Oa[1]=r,Ny(t,Oa,this.inverseTransform))}toScreen(t,e,r){return DL(e)?Ny(t,e,this.transform):(Oa[0]=e,Oa[1]=r,Ny(t,Oa,this.transform))}toScreenNoRotation(t,e,r){return DL(e)?Ny(t,e,this.transformNoRotation):(Oa[0]=e,Oa[1]=r,Ny(t,Oa,this.transformNoRotation))}toScreenClosest(t,e,r){DL(e)?(Oa[0]=e[0],Oa[1]=e[1]):(Oa[0]=e,Oa[1]=r);const[i]=Oa,{center:s,extent:n,spatialReference:o,transform:a}=this;return(i<n.xmin||i>n.xmax)&&(Oa[0]=cvt(i,s[0],o)),Ny(t,Oa,a)}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return oQ(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new wp({targetGeometry:new Ke(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=O8(o),this.rotation=i,this.scale=r,this.spatialReference=e,Vn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;CX(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=AX(this.viewMat3),u=ph(n[0]/2,n[1]/2),h=ph(-n[0]/2,-n[1]/2),p=g6(i);c5(c,c,u),PX(c,c,p),c5(c,c,h),tE(this.displayViewMat3,this.displayMat3,c);const f=mK(this.viewMat2d,u);return pK(f,f,p),fK(f,f,h),fvt(this.extent,o,n),yvt(this.transform,o,n,s),ICe(this.inverseTransform,this.transform),_vt(this.transformNoRotation,o,n,s),this.worldScreenWidth=bvt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([m({readOnly:!0})],By.prototype,"id",void 0),d([m({value:1,json:{write:!0}})],By.prototype,"pixelRatio",null),d([m({json:{write:!0}})],By.prototype,"size",null),d([m()],By.prototype,"spatialReference",void 0),d([m({type:wp,json:{write:!0}})],By.prototype,"viewpoint",null),By=tW=d([V("esri.views.2d.ViewState")],By);const wvt=By;var tn,Eb,rW,hm,iW,$F,sW,Cb,nW;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(tn||(tn={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(Eb||(Eb={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(rW||(rW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(hm||(hm={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(iW||(iW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}($F||($F={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(sW||(sW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(Cb||(Cb={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(nW||(nW={}));let In=class{};In.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Eb.VISIBLE}},In.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Eb.VISIBLE}},In.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Eb.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:yq.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:_q.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},In.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Eb.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:rW.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:$F.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:hm.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:$F.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:iW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:hm.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:sW.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[nW.HORIZONTAL]}},In.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Eb.VISIBLE}},In.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},In.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:Cb.MAP}},In.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:Cb.MAP},"line-width":{type:"number",minimum:0,default:1}},In.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:Cb.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:Cb.MAP}},In.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},In.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:Cb.MAP}};let xvt=class extends pPe{_createTransforms(){return{displayViewScreenMat3:um(),tileMat3:um()}}},Tvt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const r=[];for(const i of this._candidateTiles)e>0?(i.reshuffle(),e--):r.push(i);this._candidateTiles=r}};const Svt=.125;let Evt=class{constructor(){this._renderParams={reshuffleManager:new Tvt,context:null,drawPhase:1,state:new wvt({viewpoint:new wp({targetGeometry:new Ke(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new xvt(new Ip(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,r,i,s,n,o,a,l,c,u){const h=this._backgroundTile;this._updateRenderParameters(e,r,h,i,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,i.drawBackground(this._renderParams,h,s)}renderContent(e,r,i,s,n,o,a,l,c,u,h,p){this._stencilSymbols(e,r,i,s,n,o,a,Math.round(1/l),c,u,h,p);let f=1;i.stencilRef=f++,e.setStencilFunction(Qr.EQUAL,i.stencilRef,255),this._render(e,r,i,n,o,a,l,c,u,h,p),s.forAll(g=>{g.sourceLayerInfo.data.stencilRef=f++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,n,o,a,Math.round(1/l),g.offset,u,h,p)})}_stencilSymbols(e,r,i,s,n,o,a,l,c,u,h,p){let f=1;i.stencilRef=f++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(ss.KEEP,ss.KEEP,ss.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Qr.ALWAYS,i.stencilRef,255),this._stencilTileSymbols(e,r,i,n,o,a,l,c,u,h,p);for(const g of s.toArray()){const{sourceLod:_,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=f++,e.setStencilFunction(Qr.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,_,b.data,n,o,a,l,v,u,h,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,r,i,s,n,o,a,l,c,u,h){e.setStencilFunction(Qr.EQUAL,i.stencilRef,255),this._render(e,r,i,s,n,o,a,l,c,u,h,tn.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,u,h,p){this._updateRenderParameters(e,r,i,s,o,a,l,c,u,h),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,i,n,p)}_stencilTileSymbols(e,r,i,s,n,o,a,l,c,u,h){this._updateRenderParameters(e,r,i,s,o,a,l,c,u,h),this._renderParams.stencilSymbols=!0,i.triangleCount=0,s.drawSymbols(this._renderParams,i,n)}_updateRenderParameters(e,r,i,s,n,o,a,l,c,u){"type"in i&&i.type==="vector-tile"&&!i.stage&&i.attachWithContext(e);const h=r[0]-n.getLevelShift(r[0]),p=this._renderParams;p.context=e,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=h,p.requiredLevel=h;const f=n.getScale(r[0]),[g,_]=n.getOffset(r,o*f),v=Svt*o*f/l,b=i.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+_+(1-a[1])*o*2-2,p.state.size[0]=l/u,p.state.size[1]=l/u,p.state.pixelRatio=u}},aMe=class lMe extends Gr{initializeProgram(e){return new Dr(e.rctx,lMe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};aMe.shader=new Lr(H_t,()=>me(()=>Promise.resolve().then(()=>EAt),void 0));let pP=class extends SM{constructor(){super(...arguments),this.colorizerType=dw.Stretch,this.stretchType=qw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([G({count:dw.COUNT})],pP.prototype,"colorizerType",void 0),d([G({count:qw.COUNT})],pP.prototype,"stretchType",void 0),d([G()],pP.prototype,"applyColormap",void 0),d([G()],pP.prototype,"requireBilinearWithNN",void 0);let Mue=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new Np(this._rctx,new oi(e),new Pwe(ko.DEPTH24_STENCIL8,e));return this._fbos.set(e,i),i}};const Cvt=()=>ae.getLogger("esri.views.3d.terrain");let Avt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new Evt,this._bindParameters=new $k(null,null),this._blendLayersTechniqueConfig=new sMe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Im(this._rctx,vR)}dispose(){this._fbos.forEach(ft),this._fbos=null,this._vtFBO=ft(this._vtFBO),this._vaoQuad=ft(this._vaoQuad),this._vectorTileHelper=ft(this._vectorTileHelper),this._backgroundTechnique=er(this._backgroundTechnique),this._applyOpacityTechnique=er(this._applyOpacityTechnique),this._blendLayersTechnique=er(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Gd.Off,n=a1.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(rMe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(De.Normal,r?sn.ColorComposite:sn.GridComposite,sa.NotRequired,Gd.Off,a1.Only),s=this._rctx.bindTechnique(i,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(sr.TRIANGLE_STRIP,0,Hg(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n=Gd.On){r===sn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const o=e.baseOpacity<1?sa.Required:sa.NotRequired,a=this._getBlendLayersTechnique(s,r,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,r,i,s,n=Gd.Off){if(e.texture==null)return;const o=e.baseOpacity<1?sa.Required:sa.NotRequired;e.fboTexture=r===sn.GroupBackgroundComposite||s===De.Normal&&o===sa.NotRequired&&n===Gd.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageryTileData(e,r,i,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,Bt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?sa.Required:sa.NotRequired;e.fboTexture=s===De.Normal&&a===sa.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(o,r,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new pP,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?qw.Noop:qw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(aMe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l){const c=this._rctx,u=n.sourceLayerInfo.data,h=n.tile.surface.layerViewByIndex(n.layerIndex,Bt.MAP),p=e.baseOpacity<1?sa.Required:sa.NotRequired,f=p===sa.Required||e.opacity<1||s!==De.Normal||r!==sn.Composite,g=f?Gd.On:Gd.Off,_=this._getBlendLayersTechnique(s,r,p,g);c.setPipelineState(_.getPipeline());let v=null,b=null;f?(b=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Mue(this._rctx)),v=this._vtFBO.get(i),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clearSafe(Si.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/n.scale),n.offset,a,o,h.contentZoom),u&&this._vectorTileHelper.renderContent(c,n.sourceLod,u,n.vtlNeighborInfos,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/n.scale),n.offset,a,o,h.contentZoom)}catch(w){Cvt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=n0,e.scale=1,this.drawRasterData(e,r,i,s,g),l)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Sr.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(_s.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Sr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Mue(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Pvt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new kt({allocator:e=>e||new Mvt})}},Mvt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},Ovt=class{constructor(e,r,i,s,n,o){this.start=e,this.end=r,this.blendMode=i,this.opacity=s,this.output=n,this.baseOpacity=o}},Rvt=class{constructor(e,r,i,s){this._rctx=e,this.tileSize=r,this._techniques=i,this._cache=s,this._passParameters=new Y1t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Avt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=ft(this._composition),this._backgroundTexture=er(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=i.view.state.contentPixelRatio;let h=!1;IF.clear(),f2.length=0;const p=e.layerInfo[Bt.MAP];let f=0,g=null;for(;f<p.length;f++){const b=i.layerViewByIndex(f,Bt.MAP),w=b.layer.opacity,T=b.fullOpacity;if(c=c||CD(b.layer),NO(b)){let P=b.layer.blendMode!=="normal";if(QS(b.layer.parent)){const R=oW(b.layer.parent);R!=null&&R!==""&&(P=cMe(b.layer.parent)||P)}P&&(h=P,l=!1)}if(w===0&&!h){p[f].pendingUpdates&=~(ot.TEXTURE_NOFADING&ot.TEXTURE_FADING);continue}++o;const S=hw(b),C=mB(e,f,S);if(C){if(p[f].pendingUpdates&=~(ot.TEXTURE_NOFADING&ot.TEXTURE_FADING),QS(b.layer.parent)){const P=oW(b.layer.parent);P!=null&&P!==""&&uMe(b.layer.parent,f)}S?a=Math.max(a,this.tileSize*u):s===1&&T===1&&(b.isOpaque||this._dataToTexture(C)&&C.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=f)}}const _=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!h&&this._useLayerTexture(e,g)||this._composeMapLayers(e,r,f-1,c,a,_,!l||h,IF,h):this._useBackgroundTexture(e,o,v,r!==nn.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=n0,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,r,i,s){const n=e.renderData,o=!s&&n.textureReference!=null&&(e.surface.view.layerViewManager.updating||r>0)?O_.Delayed:O_.Immediate;n.setTextureReference(new fB(i,nn.FADING,Oue,e.surface.baseOpacity,0,1),o)}_useLayerTexture(e,r){const i=e.surface.layerViewByIndex(r,Bt.MAP),s=CD(i.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=i.fullOpacity,l=mB(e,r,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new fB(l.sourceLayerInfo.data,nn.FADING,l,n,o,a)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c){this._composition.ensureBuffer(n);const u=e.surface.baseOpacity;let h=!1,p=Gt.LINEAR_MIPMAP_LINEAR,f=!1,g=0;for(let w=i;w>=0;w--){const T=e.surface.layerViewByIndex(w,Bt.MAP),S=hw(T),C=mB(e,w,S),P=T.layer.opacity;if(!C||P===0&&!c)continue;const R=!CD(T.layer)&&!h;R&&(h=!0);let L=!1;l.forEach(z=>{z.start===w&&(z.output=s?sn.Composite:a&&R?this.backgroundIsGrid?sn.GridComposite:sn.ColorComposite:sn.Composite,z.baseOpacity=R?u:1,f2.push(z),this._composition.openGroup(n),L=!0)}),this._passParameters.baseOpacity=R&&!L&&u<1?u:1;const F=g===0,U=L?sn.GroupBackgroundComposite:a&&F?this.backgroundIsGrid?sn.GridComposite:sn.ColorComposite:sn.Composite,j=Qq[NO(T)?T.layer.blendMode:"normal"];for(this._passParameters.opacity=P,l_t(C)?f=this._composition.drawVectorData(this._passParameters,U,n,j,C,o,this.tileSize,f):a_t(C)?(this._composition.drawImageryTileData(this._passParameters,U,n,j,C),this._hasNearestInterpolation(C)&&(p=Gt.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._composition.drawRasterData(this._passParameters,U,n,j));f2.length>0&&f2[f2.length-1].end===w;){const z=f2.pop();this._passParameters.baseOpacity=z.baseOpacity,this._passParameters.opacity=z.opacity,this._passParameters.offset=n0,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,z.output,n,Qq[z.blendMode])}g++}const _=e.renderData,v=c||h&&u<1,b=_.ensureTexture(n,v,()=>this._buildTexture(n,v,p));this._composition.copyFBOToTexture(b),this._composition.unbind(),_.setTextureReference(new fB(b,r,Oue,h?1:u,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(u_t(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data,!0),e.tile.setMemoryDirty()}return c_t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r,i=Gt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new oi;s.wrapMode=Xt.CLAMP_TO_EDGE,s.samplingMode=i,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,r||(s.pixelFormat=wt.RGB);const n=this._rctx;let o;if(typeof e=="number"){s.width=s.height=e;const l=`${e} ${s.pixelFormat}`;o=this._cache.pop(l),o?o.retain():o=new dP(new Sr(n,s),this._cache)}else if(H0t(e)){s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=wt.RGB);const l=`${e} ${s.pixelFormat}`;o=this._cache.pop(l),o?(o.retain(),o.texture.setData(e.image)):o=new dP(new Sr(n,s,e.image),this._cache),e.release()}else try{s.width=e.width,s.height=e.height,o=new dP(new Sr(n,s,e))}catch{o=new dP(owe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,Sr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Sr.TEXTURE_UNIT_FOR_UPDATES),o}get test(){return{backgroundTexture:this._backgroundTexture}}};function mB(t,e,r){Qo.layerIndex=e,Qo.vtlNeighborInfos.clear();const i=t.layerInfo[Bt.MAP][e];if(cr(Qo.offset,0,0),Qo.tile=t,Qo.scale=1,Qo.sourceLod=t.lij,Qo.sourceLayerInfo=i,Qo.isVTLBackground=r,i.data)return r&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[Bt.MAP][e];if(!yPe(a)||i.data===a.data)return;const l=Qo.vtlNeighborInfos.pushNew();l.offset=_g[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),Qo;const s=i.upsampleInfo;if(s){const n=s.tile.layerInfo[Bt.MAP][e];return Qo.tile=s.tile,Vn(Qo.offset,s.offset),Qo.scale=s.scale,Qo.sourceLod=s.tile.lij,Qo.sourceLayerInfo=n,Qo}return r?Qo:null}function oW(t){return t.uid}function cMe(t){let e=t.blendMode!=="normal";return QS(t.parent)&&(e=cMe(t.parent)||e),e}function uMe(t,e){QS(t.parent)&&uMe(t.parent,e);const r=oW(t);if(r!=null&&r!==""){const i=IF.get(r);i?i.start=e:IF.set(r,new Ovt(e,e,t.blendMode,t.opacity,sn.Composite,1))}}const IF=new Map,f2=new Array,Qo=new Pvt,Oue={offset:[0,0],scale:1},_g=new Array;_g[pt.NORTH]=[0,-1],_g[pt.NORTH_EAST]=[-1,-1],_g[pt.EAST]=[-1,0],_g[pt.SOUTH_EAST]=[-1,1],_g[pt.SOUTH]=[0,1],_g[pt.SOUTH_WEST]=[1,1],_g[pt.WEST]=[1,0],_g[pt.NORTH_WEST]=[1,-1];const hMe=200,gB=40,$vt=.8,Ivt=10,fP=1e-6;function Lvt(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=fP)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-fP){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-fP)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=fP){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let Rue=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},aQ=class aW{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positions=s,this._rayDirection=E(),this.bspNodeTree=new Array;const n=i-r,o=n<=dMe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=Uvt(e,r,i,s.data,s.stride),l=we(Math.log2(n/gB),2,Ivt),c=(u,h,p)=>{const f=Fvt(o,a,u,h),g=h-u;if(g<=gB){const S=new Rue(f,void 0,0,u,h);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=kvt(f),b=Nvt(o,a,u,h,_,v),w=(S,C)=>{if(p>l)return;const P=C-S;return P<gB||P>=$vt*g?void 0:c(S,C,p+1)},T=new Rue(f,_,v,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=w(u,b.next),T.rightNode=w(b.mid,h),T};c(0,n,0),this.triangleVertexIndices=zvt(o,e,r,i)}}intersectRayTriangleRange(e,r){if(e>=r)return;const i=this.triangleVertexIndices,s=this.positions.data,n=this.positions.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,h=u[0],p=u[1],f=u[2];for(let g=e,_=3*e;g<r;++g){const v=i[_]*n,b=s[v],w=s[v+1],T=s[v+2],S=i[_+1]*n,C=s[S],P=s[S+1],R=s[S+2],L=i[_+2]*n;_+=3;const F=C-b,U=P-w,j=R-T,z=s[L]-b,Z=s[L+1]-w,W=s[L+2]-T,Y=p*W-Z*f,le=f*z-W*h,I=h*Z-z*p,N=F*Y+U*le+j*I;if(Math.abs(N)<=Number.EPSILON)continue;const B=a-b,H=l-w,q=c-T,Q=B*Y+H*le+q*I;if(N>0){if(Q<0||Q>N)continue}else if(Q>0||Q<N)continue;const ie=H*j-U*q,_e=q*F-j*B,Oe=B*U-F*H,gt=h*ie+p*_e+f*Oe;if(N>0){if(gt<0||Q+gt>N)continue}else if(gt>0||Q+gt<N)continue;const It=(z*ie+Z*_e+W*Oe)/N;if(It>=0){const xt=this.indices[g]+this.firstTriangleIndex,ct=gJ(F,U,j,z,Z,W,Dvt);this._callback(It,ct,xt,!1)}}aW.numFacesTested+=r-e}intersectRay(e,r,i){aW.numFacesTested=0;const s=e,n=r,o=n[0]-s[0],a=n[1]-s[1],l=n[2]-s[2];if(o*o+a*a+l*l<fP)return;this._rayOrigin=s;const c=this._rayDirection;c[0]=o,c[1]=a,c[2]=l;const u=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,u)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!Lvt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};aQ.numFacesTested=0;const Dvt=E(),m2=[1/0,1/0,1/0],g2=[-1/0,-1/0,-1/0];function Nvt(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function Fvt(t,e,r,i){if(i<=r)return Nw(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)m2[n]=e[s+0+n],g2[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)m2[o]=Math.min(m2[o],e[n+0+o]),g2[o]=Math.max(g2[o],e[n+3+o])}return Nw(m2[0],m2[1],m2[2],g2[0],g2[1],g2[2])}function kvt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function Uvt(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,h=t[l+2]*s;for(let p=0;p<3;++p){const f=i[c+p],g=i[u+p],_=i[h+p];o[6*a+p]=Math.min(f,g,_),o[6*a+3+p]=Math.max(f,g,_)}}return o}function zvt(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=dMe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const dMe=65535;let Ns=class extends Za{constructor(){super(...arguments),this.output=k.Color,this.overlayMode=Zf.Disabled,this.tileBlendInput=Qf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=nt.Simplified}};d([G({count:k.COUNT})],Ns.prototype,"output",void 0),d([G({count:Zf.COUNT})],Ns.prototype,"overlayMode",void 0),d([G({count:Qf.COUNT})],Ns.prototype,"tileBlendInput",void 0),d([G()],Ns.prototype,"spherical",void 0),d([G()],Ns.prototype,"doublePrecisionRequiresObfuscation",void 0),d([G()],Ns.prototype,"receiveShadows",void 0),d([G()],Ns.prototype,"hasSlicePlane",void 0),d([G()],Ns.prototype,"backfaceCullingEnabled",void 0),d([G()],Ns.prototype,"textureFadingEnabled",void 0),d([G()],Ns.prototype,"renderOccluded",void 0),d([G()],Ns.prototype,"hasScreenSpaceReflections",void 0),d([G()],Ns.prototype,"hasCloudsReflections",void 0),d([G()],Ns.prototype,"invisible",void 0),d([G()],Ns.prototype,"tileBorders",void 0),d([G()],Ns.prototype,"visualizeNormals",void 0),d([G()],Ns.prototype,"screenSizePerspective",void 0),d([G()],Ns.prototype,"receiveAmbientOcclusion",void 0),d([G({count:nt.COUNT})],Ns.prototype,"pbrMode",void 0),d([G({constValue:Ir.Compressed})],Ns.prototype,"normalType",void 0),d([G({constValue:rs.Compressed})],Ns.prototype,"textureCoordinateType",void 0),d([G({constValue:!1})],Ns.prototype,"highStepCount",void 0),d([G({constValue:!1})],Ns.prototype,"useCustomDTRExponentForWater",void 0),d([G({constValue:!1})],Ns.prototype,"useFillLights",void 0),d([G({constValue:!0})],Ns.prototype,"hasColorTexture",void 0);const yB=7,Bvt=10,_B=Mn();var ja;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ja||(ja={}));let Qu=class extends Ixe{get _isGlobal(){return this._stage.viewingMode===Ne.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,r,i,s,n){super({}),this._overlayRenderer=e,this._stage=r,this._allTiles=i,this._ellipsoidRadius=s,this.type=ki.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ns,this._passParameters=new JK,this._drawParameters=new pq,this._renderDataPool=new qo(d1t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new xPe,this._transparencyState=ja.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Ur.Occlude,this.produces=new Map([[ue.OPAQUE_TERRAIN,()=>this._produces()],[ue.TRANSPARENT_TERRAIN,()=>this._produces()],[ue.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new UR((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new H1t(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(he(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?dF:Ur.Occlude,this.setNeedsRender()},ti))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?Oxe:Gk}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ja.TransparentWithDraped||e===ja.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return G_}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,ot.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===ot.TEXTURE_FADING?nn.FADING:nn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[Bt.ELEVATION])i.pendingUpdates&=~ot.GEOMETRY;e.resetPendingUpdate(ot.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=Bvt-yB,i=Math.max(0,Math.floor((e.level-r)/yB)*yB);if(this._isGlobal&&i===0)return Cn;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Os.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Os.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Os.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new Rvt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=owe(this._rctx)}uninitializeRenderContext(){this._emptyTex=ft(this._emptyTex),this._tileRenderer=ft(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ja.Opaque)return;const n=Vvt,o=Gvt;ye(n,s,i),te(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Co.MIN,h=!!e.results.ground.target,p=yBe(e.verticalOffset),f=e.tolerance;let g,_=u&&a.dist!=null?a.dist:1/0;const v=w=>{const T=w.renderData;if(!(T!=null&&T.vao))return;const S=T.geometry;bk(_B,S.boundingBox);const C=T.localOrigin;p!=null&&(p.localOrigin=C,p.applyToAabb(_B));const P=_B;if(y2[0]=i[0]-C[0],y2[1]=i[1]-C[1],y2[2]=i[2]-C[2],!_J(P,y2,o,f,_))return;const R=(le,I,N)=>{le.set(this.type,w,I,N,ts),_=u&&a.dist!=null?a.dist:1/0},L=(le,I)=>{if(I!=null&&le>=0&&(e.options.backfacesTerrain||de(I,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,le))){if((c.dist==null||le<c.dist)&&R(c,le,I),e.options.isFiltered)return;e.options.store===Co.ALL&&(g==null?(g=$X(e.ray),R(g,le,I),e.results.all.push(g)):le<g.dist&&R(g,le,I)),(a.dist==null||le<a.dist)&&R(a,le,I),e.options.store!==Co.MIN&&(l.dist==null||le>l.dist)&&R(l,le,I)}},F=jvt;ye(F,s,C);const{indices:U,indexCount:j}=S,z=S.vertexAttributes,Z=z.getField(O.POSITION,zn),W=new JE(Z.typedBuffer,3,z.stride/4),Y=j/3;if(!p&&Y>hMe){const le=w.renderData;le.intersectionData==null&&(le.intersectionData=new aQ(U,0,Y,W)),le.intersectionData.intersectRay(y2,F,L)}else PR(y2,F,0,Y,U,W,null,p,L)},b=this._rootTiles;b!=null&&(()=>{const w=this._tileIterator;w.reset(b);const T=e.options.invisibleTerrain;for(let S=w.next();S;S=w.next())!(S.visible||T&&S.intersectsClippingArea)||p==null&&!S.intersectsRay(i,n,f,_)||h&&this._useStencilForTile(S)?w.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const n of s)((i=n.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(n);e.process(),r.madeProgress()}}prepareTechnique(e){const r=se("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(r!==this._castShadows&&(this._castShadows=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===ue.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&dF))return null}else{const i=this.transparency===ja.Opaque?ue.OPAQUE_TERRAIN:ue.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}if(this.transparency===ja.Empty)return null;switch(e.output){case k.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(k.Color,e.bindParameters.slot===ue.OCCLUDED_TERRAIN);case k.Shadow:case k.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Shadow,!1)):null;case k.LinearDepth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.LinearDepth,!1);case k.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Normal,!1);case k.ObjectAndLayerIdColor:return this._updateTechnique(k.ObjectAndLayerIdColor,!1);case k.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Highlight,!1)):null}return null}renderNode(e,r){switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case k.Color:{const i=e.bindParameters.slot===ue.OCCLUDED_TERRAIN?Fi.Occluded:Fi.Color;this._renderMaterialPass(e,r,i);break}case k.LinearDepth:case k.Normal:this._renderAuxiliaryPass(e,r,Fi.Color,this._visiblePatchesByOrigin);break;case k.Highlight:this._renderAuxiliaryPass(e,r,Fi.Highlight,this._visiblePatchesByOrigin);break;case k.Shadow:case k.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,r,null,this._allPatchesByOrigin);break;case k.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Fi.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i;if(e!=null){const s=Fe.toUnitRGBA(e);i=Pe(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,nn.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?Qf.GridComposite:r.backgroundColor!=null?Qf.ColorComposite:Qf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==CE.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),r=this._stencilEnabledLayerExtents;for(const i of e)TPe(this.renderOrder,i,r);e.sort((i,s)=>SPe(i[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows){let a=this._allPatchesByOrigin.get(n);a||(a=[],this._allPatchesByOrigin.set(n,a)),a.push(i)}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=[],this._visiblePatchesByOrigin.set(n,o)),o.push(i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderAuxiliaryPass(e,r,i,s){const n=e.rctx;this._passParameters.overlayContent=i,n.bindTechnique(r,e.bindParameters,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,r.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,r,a[l],sr.TRIANGLES,o,i)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,r,i){var p;const{rctx:s}=e;this._passParameters.overlayContent=i,s.bindTechnique(r,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bindParameters.camera,o=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const f=A2e(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;f.update({distance:g,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=i===Fi.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",Cn),o.setUniform4fv("texOffsetAndScale",_u));const c=((p=this._tileRenderer)==null?void 0:p.backgroundColor)!=null?this._tileRenderer.backgroundColor:Cn;this._techniqueConfiguration.tileBlendInput===Qf.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?sr.LINES:sr.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const h=this._visiblePatchesByOrigin;for(const f of h.values()){const g=f[0].renderData.localOrigin;r.program.bindDraw(new pq(g),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const _ of f){const v=_.renderData,b=v.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=v.textureFadeFactor,T=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&T!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",T.offsetAndScale),o.setUniform3fv("nextTexOpacities",T.opacities),o.bindTexture("texNext",T.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,r,_,u,a,i),_.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(Fn&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(r.getPipeline()));const h=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,h,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniques.releaseAndAcquire(LPe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};d([m({readOnly:!0})],Qu.prototype,"_isGlobal",null),d([m()],Qu.prototype,"renderOccludedFlags",void 0),d([m({value:!1})],Qu.prototype,"renderingDisabled",null),d([m({value:!0})],Qu.prototype,"visible",null),d([m()],Qu.prototype,"renderPatchBorders",null),d([m()],Qu.prototype,"visualizeNormals",null),d([m()],Qu.prototype,"cullBackFaces",null),d([m({value:CE.FRONT_TO_BACK})],Qu.prototype,"renderOrder",null),d([m()],Qu.prototype,"wireframe",null),Qu=d([V("esri.views.3d.terrain.TerrainRenderer")],Qu);const Vvt=E(),Gvt=E(),y2=E(),jvt=E();let Hvt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Af=class extends Me{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),he(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!VP(r)||r.isRejected())&&!(r.isFulfilled()&&!qvt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||MF(r)))),e)if(e.isResolved()){const r=M8(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new mc(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Ne.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=mc.makeWebMercatorAuxiliarySphere(r):V_(e.spatialReference)&&(e=mc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(he(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ne.Global){const e=this.extentHelper.viewSpatialReference,r=V_(e)||u1(e)||h1(e);e.isWebMercator?this.tilingScheme=mc.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=mc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Zb(e,this.extent)||(this.tilingScheme=mc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function qvt(t,e,r){return M8(t,e,r)!=null}d([m()],Af.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],Af.prototype,"extent",void 0),d([m({value:!1})],Af.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],Af.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],Af.prototype,"layers",void 0),d([m({constructOnly:!0})],Af.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],Af.prototype,"viewingMode",void 0),Af=d([V("esri.views.3d.terrain.TilingSchemeLogic")],Af);let Wvt=class{constructor(){this.offset=je(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var jN;let Ht=jN=class extends Gs.EventedMixin(Me){constructor(t){var e,r,i;super(t),this._scaleRangeQueries=new GN,this._iteratorPool=new qo(xPe,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new A_t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new Hvt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=E(),this._eyePosSurfaceSR=E(),this._splitLimits=new Od,this._frustum=dO(),this._viewProjectionMatrix=xe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new mp,this._frameTask=hE,this._allTiles=new kt,this._upsampleInfoPool=new qo(Wvt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=jt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Xe.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new zT(1/0,-1/0),this.rootTileElevationBounds=new zT(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=KY(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new yl({...t,surface:this}),this._isGlobal=!((r=(e=t.view)==null?void 0:e.state)!=null&&r.isLocal),this._isGeographic=((i=this._spatialReference)==null?void 0:i.isGeographic)??!1,this._tileConstructor=this._isGlobal?V1t:U1t}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=Tyt(e);const r=e.memoryController;this._tileCache=new UR((l,c)=>r.newCache(l,c),"terrain-tile"),this._upsampleMapCache=r.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new wyt(r.newCache("elevation-query"));const i=this.overlayManager;this._renderer=new Qu(i.renderer,t._stage,this._allTiles,Vr(t.spatialReference).radius,r),this.addHandles([he(()=>i.renderer.isEmpty,()=>this._evaluateTransparency()),he(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([he(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?nn.UNFADED:nn.IMMEDIATE)},si),he(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?nn.UNFADED:nn.IMMEDIATE),si),he(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},ti),he(()=>this.snapLevel,()=>this._viewChanged=!0,ti),he(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),he(()=>yi.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?me(()=>import("./TerrainTileTree3DDebugger-D_TNOhTi.js"),__vite__mapDeps([208,209])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&yi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Ae(this._treeDebugger))},ui)]);const{spatialReference:s}=t;this._extentHelper=y_t(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new sO({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Af({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(jf.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(jf.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(yt.TERRAIN_SURFACE,this),this.addHandles([he(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),ui),he(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ti),he(()=>this.extent,()=>this._updateRootTiles(),ui),t.on("resize",()=>this._viewChangeUpdate()),he(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),si),he(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,ui),he(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?nt.Simplified:nt.Disabled,ui),he(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ti)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=er(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",Ae(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ae(this.overlayManager)),this._tileCache=Ae(this._tileCache),YK.prune(),this._treeDebugger=Ae(this._treeDebugger),this._renderer=Ae(this._renderer),this._iteratorPool=Ae(this._iteratorPool),this._upsampleMapCache=Ae(this._upsampleMapCache),this._elevationQueryCache=Ae(this._elevationQueryCache),this._set("view",null),this._extentHelper=Ae(this._extentHelper),this._upsampleInfoPool=Ae(this._upsampleInfoPool),Vyt(),Q_t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,e;if(this.lodSnapping===lM.ON){const r=this.view,i=this.tilingScheme,s=(e=(t=r.pointsOfInterest)==null?void 0:t.cameraOnSurface)==null?void 0:e.scale;if(i&&s){const n=r.state.contentCamera;let o=pk(r,n.eye,n.viewForward,n.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=i.levelAtScale(s)-a,c=Math.min(l+r.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return c<=0?null:c}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?lM.ON:lM.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const r=jt(),i=zAe(e,r,t)?r:null,s=this._get("extent");return Zb(i,s)?s:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=KV(this.groundExtent,this._userClippingExtent,jt()),e=this._get("extent");return Zb(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,r;return((r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,r;return(r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ja.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,r,i){this._renderer.intersect(t,e,r,i)}getElevation(t,e,r,i){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[Bt.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(i);if(n===void 0&&(n=k_(i,this._spatialReference)??null,this._elevationProjectorCache.set(i,n)),n==null)return ae.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=te(E3,t,e,r);return n(o,0,o,0),$ue(s,o[0],o[1])}getElevations(t,e,r){const i=this._rootTiles,s=i?i[0].layerInfo[Bt.ELEVATION].length:0;if(i!=null&&i.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;r(n,$ue(i,t[o],t[o+1]))}else for(let n=0;n<e;++n)r(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!Qa(t,E3,this.spatialReference))return ae.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const r of e)if(r!=null&&r.containsPoint(E3)){let i=r;for(;i.children[0]&&!i.rendered;){const s=i.children[0].extent;let n=0;E3[0]>s[2]&&(n+=1),E3[1]<s[1]&&(n+=2),i=i.children[n]}return this._getLodBiasCorrectedScale(i.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const r=k_(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,r),r}getSphereElevationBounds(t,e){const r=this._ensureSEBProject(e);if(r==null)return ae.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;Iw(t,_2);const i=_2;r(i,0,i,0);const s=new CF,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!qee(l.extent,_2))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return s}getRootElevationBounds(){return new CF(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!Qa(t,_2,this.spatialReference))return ae.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;_2[3]=e;let r=null;const i=n=>{if(n&&qee(n.extent,_2)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)i(a);else{const a=this._getLodBiasCorrectedScale(n.level);r=r==null?a:Math.min(r,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)i(n);return r}queryVisibleScaleRange(t,e,r,i){const s=e?this.tilingScheme.levelAtScale(e):0,n=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,i)}_evaluateTransparency(){var n,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?e?ja.Empty:ja.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ja.Opaque:ja.Semitransparent,s=r!==i;return s&&(this._renderer.transparency=i,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var r,i,s,n;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;mn(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(r=this.view)==null?void 0:r.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??Xe.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&GM((s=this.view)==null?void 0:s.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(n=this.tilingScheme)==null?void 0:n.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,r,i){const s=this._tileCache.pop(jN._tileMemcacheKey);return s?(s.init(t,e,r,i,this),s):new this._tileConstructor(t,e,r,i,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const r=Xvt;let i=e.rootTilesInExtent(t,r,5*xT);if(this._rootTiles!=null){if(i.length>xT)return void ae.getLogger(this).warn(uVe);const s=this._rootTiles.map(o=>o.lij),n=uV(s,i,BN);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>BN(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>xT&&(ae.getLogger(this).warn(hVe),i=e.rootTilesInExtent(t,r,xT)),this._setRootTiles(i.map(s=>this._newRootTile(s)));Zb(r,this._rootTilesExtent)||(this._rootTilesExtent=jt(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Kg);const e=this.renderer;t.forEach(r=>e.updateGeometryIfNeeded(r)),t.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ot.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(ot.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(ot.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=L_t(t),r=this.visibleElevationBounds;let i=e?r.min:1/0,s=e?r.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(ot.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBoundsMin,i),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(i)&&isFinite(s)&&(r.min!==i||r.max!==s)&&(this.visibleElevationBounds=new zT(i,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const r=this._rootTiles;r!=null&&r.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const i=this.rootTileElevationBounds;i.min===t&&i.max===e||(this.rootTileElevationBounds=new zT(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,r=Math.tan(.5*e.fovX),i=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=O5(this._splitLimits.frustum??dO(),e.frustum):this._splitLimits.frustum=null,O5(this._frustum,t.frustum),ri(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ce(this._eyePosRenderSR,e.eye),ya(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Bt.MAP].some(hw)&&e.setPendingUpdate(ot.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const r=t.resetPendingUpdate(ot.TEXTURE_FADING)?ot.TEXTURE_FADING:!!t.resetPendingUpdate(ot.TEXTURE_NOFADING)&&ot.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(t,r),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=bB.extent;Tu(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>T_(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),bB.spatialReference=this.spatialReference,this.emit("elevation-change",bB),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Fn&&this._checkTileInvariant(),!t.hasProgressed)return Ao}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var r;if(mn(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const i=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=e.children.reduce((n,o)=>n+(i(o)?0:1),0);if(mn(e.unmergableChildCount===s,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${s}`),e.hasPendingUpdate(ot.MERGE)){mn(!e.hasPendingUpdate(ot.SPLIT),"Tile can be both split and merge at the same time");for(const n of e.children)mn(n.isLeaf||n.hasPendingUpdate(ot.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(e.rendered){const a=(r=e.renderData)==null?void 0:r.geometryState.edgePeerNeighbors[i];if(a!=null){{const l=e.level-a.level<=_n;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${_n}  (edge[${i}])`),mn(l,`tile level delta [${e.level}] vs [${a.level}] > ${_n}`))}mn(e.level-a.level<=_n,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const s=e.level-_n,n=a=>a.isLeaf||a.level===e.level,o=e.findNeighborTile(cp[i],n);if(o!=null){if(e.isLeaf&&e.level>=_n){let a=o;for(;e.level-a.level<_n;)a=a.parent;const l=[s,e.lij[1]>>_n,e.lij[2]>>_n];if(!BN(l,a.lij)){const c=t.get(a);mn(!c.has(e),"Cannot already have neighbor"),c.add(e)}}mn(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),mn(e.level-o.level<=_n,`Tile level delta [${e.level}] vs [${o.level}] > ${_n}`)}}}),this._allTiles.forAll(e=>{const r=e.maxLevelDeltaNeighborCount,i=t.get(e);mn(r===i.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${r} vs ${i.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new Zvt(this._allTiles.length);e.pushAll(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(ot.MERGE),c=l?ot.MERGE:o.shouldSplit(i,s,r),u=c===ot.SPLIT;o.isLeaf?wB(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(ot.SPLIT),o.isLeaf||o.setPendingUpdate(ot.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(ot.MERGE),o.isLeaf&&o.setPendingUpdate(ot.SPLIT)):(o.resetPendingUpdate(ot.SPLIT)&&o.updateAgentSuspension(),c===ot.ELEVATION&&o.updateAgents(Bt.ELEVATION),o.isLeaf||(o.setPendingUpdate(ot.MERGE),o.resetPendingUpdate(ot.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||($_t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){$e(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const r=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(Kg);const i=e.length;for(let s=0;s<i;++s){const n=e[s];$e(n.isLoaded),$e(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{var p;const h=RF[u];r(n,(p=l.cornerPeerNeighbors[u])==null?void 0:p.findCorner(OF(h),f=>f.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const h=o.geometryState.edgePeerNeighbors[u];h&&(h==null?void 0:h.level)>=n.level&&h.forAllSubtreeOnSide(HK(cp[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&($e(t.has(p)||Kg(n,p)<0),r(n,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Fn&&PF&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!r&&!i&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(ot.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(ot.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(ot.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(ot.SPLIT)){let c=!0;const u=a.level;if(u>=_n){const h=p=>p.isLeaf||u-p.level<_n;for(let p=0;p<4;++p){const f=a.findNeighborTile(cp[p],h);f!=null&&u-f.level===_n&&(c=!1,Fn&&($e(f.isLeaf),$e(f.hasPendingUpdate(ot.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(ot.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!r){r=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(ot.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Os.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*lVe}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,r=we(t-this._lodBias,0,e.length-1),i=r-Math.floor(r);return e[Math.floor(r)].scale*(1-i)+e[Math.ceil(r)].scale*i}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let r=0;r<4;++r)this._purgeTile(e[r])}_purgeTile(t){t.isLeaf?Iue(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(jN._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){mn(t.isLeaf,"Tile that is already split should not be split again!"),mn(t.rendered,"Tile marked to split is not rendered"),Iue(t);const e=t.level+1,r=2*t.lij[1],i=2*t.lij[2],s=t.setChildren(this._createTile(e,r,i,t),this._createTile(e,r,i+1,t),this._createTile(e,r+1,i,t),this._createTile(e,r+1,i+1,t));this._allTiles.pushArray(s),t.updateAgentSuspension(),mn(t.rendered,"parent should be rendered"),this._unloadTile(t),s.forEach(n=>this._loadTile(n)),s.forEach(n=>this._pendingTilesToUpdate.add(n)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),s.forEach(n=>wB(n,n.hasPendingUpdate(ot.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){FL.spatialReference=this.spatialReference,FL.extent=t.extent,FL.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",FL)}_createTile(t,e,r,i){mn(!!i,"_createTile sanity check");const s=this._acquireTile(t,e,r,i);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(ot.SPLIT),s}get _shortBatches(){return this.view.state.mode!==Br.IDLE}_mergeTile(t){mn(!t.hasPendingUpdate(ot.SPLIT),"_mergeTile sanity check"),mn(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),mn(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),wB(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,r){const i=new qyt(t.lij,t.extent,r);t.dataArrived(e,Bt.ELEVATION,i);const s=[t],n=t.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(e,n),a.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(t=Wa){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const r=new Set;let i=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(r.add(n.uid),Zq(n)||T3(n))if(this._basemapLayerViewHandles.has(n.uid)&&!T3(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<i||i==null)&&(e=!0),i=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{r.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,r;let t=((r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(Xq(i)&&!CD(i.layer)&&i.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((NO(t)||T3(t))&&z_t(Qq[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return Yq(t)?Bt.ELEVATION:Bt.MAP}_registerTiledLayerView(t){const e=[];if((NO(t)||T3(t))&&e.push(he(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(nn.UNFADED)})),!T3(t)){const r=this._layerClassFromLayerView(t);e.push(he(()=>t.suspended,()=>this._updateTiledLayers())),e.push(he(()=>t.fullOpacity,()=>this._updateTileTextures(nn.UNFADED))),e.push(he(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.push(t.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,t.uid);i!=null&&this._invalidateLayerData(i,r)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const r of e)r.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let r=null;t.forEach(i=>{if(!i.layer||i.suspended||!Zq(i)||!i.fullExtent)return;const s=this._layerClassFromLayerView(i);if(s===Bt.MAP){const n=i.displayLevelRange.maxLevel;n!==1/0&&(r===null||n>r)&&(r=n)}e[s].push(i)});for(const i of ib){const s=this._layerViews[i],n=e[i];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[i].clear();for(let u=0;u<o;u++){const h=n[u].uid;this._layerIndexByUid[i].set(h,u);const p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,i);this._layerViews[i]=n,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const r=e.next();r.restartAgents(t),t===Bt.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Bt.MAP),t===nn.IMMEDIATE?this.renderer.updateTileTexture(e,ot.TEXTURE_NOFADING):e.updateRenderData(Bt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(r=>r.removeLayerAgent(t,e)),this._allTiles.forAll(r=>r.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=Os.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,r,i){const s=this.layerViewByIndex(e,r),n=s.layer;return!n.tilemapCache||hw(s)?this._requestTileData(t,r,s,i):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,vt(i),ns(o)||this._dataMissing(t,r,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,r,s,i),i.signal)))}_requestTileData(t,e,r,i){return e===Bt.ELEVATION?Yq(r)?this._requestElevationTileData(t,r,i):Promise.reject():Xq(r)?this._requestMapTileData(t,r,i):Promise.reject()}_requestElevationTileData(t,e,r){++this._asyncWorkItems;const i=o=>{if(Zs(r))return;const a=this._layerIndexByUid[Bt.ELEVATION].get(e.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,a,o)):ae.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Bt.ELEVATION,t.lij.toString())},s=o=>{ns(o)||(this._dataMissing(t,Bt.ELEVATION,e,o),this.requestUpdate())};if(nue(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:rO,signal:r.signal}).then(o=>{if(!Zs(r))return this._frameTask.schedule(()=>i(o),r.signal,s);ae.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(n,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:rO},r.signal)).then(o=>{o?i(new xyt(o)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,r){++this._asyncWorkItems;const i=(c,u)=>{--this._asyncWorkItems,wS(u),Zs(r)||(this._dataMissing(t,Bt.MAP,e,c),this.requestUpdate())},s=c=>u=>i(u,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Zs(r)?wS(c):this._mapTileDataArrived(t,e,c)},r.signal,s(c)).catch(s(c)),o=(c,u=null)=>this._frameTask.schedule(()=>i(c,u));if(hw(e)){const c=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(c[0],c[1],c[2],r).then(n,o)}if(P8(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(n,o);if(GK(e)&&nue(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(c=>{if(Zs(r))return ae.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(hr());n(c)},o);let a=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);byt(e.layer)&&e.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(n,o)}_mapTileDataArrived(t,e,r){const i=this._getLayerIdxByUID(Bt.MAP,e.uid);i!=null?t.dataArrived(i,Bt.MAP,r):(wS(r),ae.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,r,i){const s=this._getLayerIdxByUID(e,r.uid);s!=null?t.dataMissing(s,e,i):ae.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const r=e.level;e.renderData&&(t.numLoadedPerLevel[r]=(t.numLoadedPerLevel[r]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[r]=(t.numRenderedPerLevel[r]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const r=this._layerClassFromLayerView(t),i=this._getLayerIdxByUID(r,t.uid);return i!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(r,i)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const r=e[0],i=e[1]>>r,s=e[2]>>r;let n;if(this._rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return mn(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){vB.clear(),t._allTiles.forAll(r=>{r.visible&&r.rendered&&vB.push(r)});const e=vB.toArray();return TPe(t.renderOrder,e),e},lockTilingScheme(e,r){t._extentHelper.defaultTiledLayersExtent=r,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!PF)return;const t=this._rootTiles;if(t==null)return;const e=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},r=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},i=n=>{var o,a;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometry)||(((a=n.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)r(l,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)i(l)},s=n=>{var c;const o=((c=n.parent)==null?void 0:c.visible)??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const u of n.children)s(u)};for(const n of t)i(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),r=t[2];if(0<=r&&r<e)return t;if(!this._isGlobal)return null;const i=(r+(r<0?e:0))%e;return[t[0],t[1],i]}enableInternalChecks(t){o_t(t)}enableWaterproofnessChecks(t){n_t(t)}};Ht._tileMemcacheKey="TerrainTileMemcache",d([m()],Ht.prototype,"_renderer",void 0),d([m({constructOnly:!0})],Ht.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],Ht.prototype,"view",void 0),d([m({constructOnly:!0})],Ht.prototype,"overlayManager",void 0),d([m()],Ht.prototype,"_hasPendingUpdates",void 0),d([m()],Ht.prototype,"_asyncWorkItems",void 0),d([m()],Ht.prototype,"_allTilesDirty",void 0),d([m()],Ht.prototype,"_allTilesSorted",void 0),d([m()],Ht.prototype,"_viewChanged",void 0),d([m()],Ht.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],Ht.prototype,"_watchUpdatingTracking",void 0),d([m()],Ht.prototype,"_frameTask",void 0),d([m({readOnly:!0})],Ht.prototype,"snapLevel",null),d([m({readOnly:!0})],Ht.prototype,"lodSnapping",null),d([m()],Ht.prototype,"_userClippingExtent",null),d([m()],Ht.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],Ht.prototype,"extent",null),d([m({readOnly:!0})],Ht.prototype,"groundExtent",null),d([m({readOnly:!0})],Ht.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],Ht.prototype,"updating",null),d([m({readOnly:!0})],Ht.prototype,"running",null),d([m(jyt)],Ht.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],Ht.prototype,"updatingProgressValue",null),d([m()],Ht.prototype,"_maxNumUpdating",void 0),d([m()],Ht.prototype,"baseOpacity",null),d([m()],Ht.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],Ht.prototype,"viewingMode",null),d([m()],Ht.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],Ht.prototype,"ready",null),d([m({value:CE.FRONT_TO_BACK})],Ht.prototype,"renderOrder",null),d([m({readOnly:!0})],Ht.prototype,"rootTiles",null),d([m()],Ht.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],Ht.prototype,"spatialReference",null),d([m({type:Fe})],Ht.prototype,"backgroundColor",null),d([m({value:!1})],Ht.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],Ht.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],Ht.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],Ht.prototype,"tilingSchemeLogic",void 0),d([m()],Ht.prototype,"wireframe",null),d([m({value:!1})],Ht.prototype,"suspended",null),d([m()],Ht.prototype,"fadeDuration",null),d([m()],Ht.prototype,"visibleElevationBounds",void 0),d([m()],Ht.prototype,"rootTileElevationBounds",void 0),d([m()],Ht.prototype,"_layerViewsDirty",void 0),d([m()],Ht.prototype,"renderPatchBorders",null),d([m()],Ht.prototype,"visualizeNormals",null),d([m()],Ht.prototype,"renderingDisabled",null),Ht=jN=d([V("esri.views.3d.terrain.TerrainSurface")],Ht);const Yvt=Ht,E3=E(),_2=Vs(),Xvt=jt(),vB=new kt,bB=new Gyt("ground"),FL={spatialReference:null,extent:null,scale:0};function $ue(t,e,r){var i;for(const s of t){if(!s.containsPointXY(e,r))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(r<n.extentMidY?2:0);n=n.children[a]}const o=((i=n==null?void 0:n.renderData)==null?void 0:i.geometryState.samplerData)??null;return cs(e,r,o)}return null}class Zvt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const r=this._tail;if(!(r<this.capacity))throw new Error("Queue full");this._data[r]=e,this._tail=r+1}pushAll(e){const r=e.length;if(r===0)return;const i=this._tail;if(!(i+r<=this.capacity))throw new Error("Queue full");for(let s=0;s<r;++s)this._data[i+s]=e[s];this._tail=i+r}pop(){const e=this._head;if(e<this._tail){const r=this._data[e];return this._head=e+1,r}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function wB(t,e){!t.isLeaf||t.level<_n||lQ(t,r=>{e&&pMe(r);const i=lW(r);if(r.maxLevelDeltaNeighborCount++,i){let s=r.parent;for(;s;){const n=lW(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function pMe(t){if(t.hasPendingUpdate(ot.SPLIT))return;let e=t.parent;for(;e&&e.resetPendingUpdate(ot.MERGE);)e=e.parent;t.resetPendingUpdate(ot.MERGE),t.isLeaf&&t.setPendingUpdate(ot.SPLIT),t.level<_n||lQ(t,r=>{pMe(r)})}function Iue(t){t.level<_n||lQ(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let r=e.parent;for(;r&&(r.unmergableChildCount--,lW(r));)r=r.parent}})}function lW(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function lQ(t,e){if(t.level<_n)return;const r=t.level-_n,i=t.lij[1]>>_n,s=t.lij[2]>>_n,n=o=>o.isLeaf||o.level===r;for(let o=0;o<4;++o){const a=t.findNeighborTile(cp[o],n);if(!a||a.level!==r)continue;const l=a.lij;l[1]===i&&l[2]===s||e(a)}}let Jvt=class{constructor(e,r,i,s){this.operation=e,this.geometry=r,this.states=i,this.sync=s}},mP=class extends Me{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let h=!1;if(l===Ji.UPDATE){const p=o.get(u);if(p){if(c&Tn.TRANSFORMATION){const f=this.model.getObject(n);this.model.updateRenderGeometryTransformation(f,a,p)&&(h=!0)}h||r.updates.push({renderGeometry:p,updateType:c})}else ht(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===Ji.REMOVE||h){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===Ji.REMOVE&&ht(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===Ji.ADD||h){const p=this.model.getObject(n);if(p!=null){const f=this.model.getRenderGeometry(p,a);r.adds.push(f),o.set(u,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,r){const i=this._dirtyGeomRecords.get(e);i&&i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},h)=>{let p=!1;if(l===Ji.UPDATE&&u){const f=o.get(h);if(f){if(c&Tn.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else ht(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Ji.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Tn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Tn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Tn.OCCLUDEE,e)}attributesChanged({object:e,geometry:r,sync:i}){this._updateOrCreateDirtyRecord(e,r,null,Ji.UPDATE,Tn.GEOMETRY,i)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._geometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._geometryRemoved(r,s,i)}transformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,Ji.UPDATE,Tn.TRANSFORMATION)})}shaderTransformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Ji.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Ji.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=Tn.NONE,o=!1){i=i??this._getParentLayerId(e);const a=e.id,l=r.id,c=this._ensureDirtyRecord(i,a),u=c.get(l);if(u){const h=u.operation;h===Ji.REMOVE&&s===Ji.ADD&&u.states!==Tn.NONE?u.operation=Ji.UPDATE:h===Ji.REMOVE&&s===Ji.ADD||h===Ji.ADD&&s===Ji.REMOVE?c.delete(l):h!==Ji.UPDATE||s!==Ji.REMOVE&&s!==Ji.UPDATE?(ht((h===Ji.REMOVE||h===Ji.ADD)&&s===Ji.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new Jvt(s,r,n,o));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return vh(this._dirtyGeomRecords,e=>vh(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:YIe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};d([m({constructOnly:!0})],mP.prototype,"model",void 0),d([m()],mP.prototype,"dirty",void 0),mP=d([V("esri.views.3d.webgl-engine.lib.ModelDirtySet")],mP);const Kvt=mP;let HN=class extends Me{constructor(){super(...arguments),this.dirtySet=new Kvt({model:this}),this._content=new Map,this._originFactory=new iK(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;ht(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),lF(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),lF(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const r of e)r&&(ht(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)r&&(ht(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id))}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const i=new EE(r,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(r,Lue);const{localOrigin:s}=r;return i.localOrigin=s??this._originFactory.getOrigin(i.boundingSphere),i}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.transformation=e.getCombinedStaticTransformation(r,Lue);const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<vs.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([m({constructOnly:!0})],HN.prototype,"dirtySet",void 0),HN=d([V("esri.views.3d.webgl-engine.parts.Model")],HN);const Lue=xe();let Qvt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const r=this._indexRanges;let i=0,s=r.length/2;if(e<r[2*i]||e>r[2*s]+r[2*s+1])return!1;for(;s-i>0;){const n=Math.floor(.5*(i+s)),o=r[2*n];if(e<o){if(s-i==1)return!1;s=n;continue}if(e<o+r[2*n+1])return!0;if(s-i==1)return!1;i=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];this._componentCountCache=r}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=ebt(e),this._componentCountCache=-1}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function ebt(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let tbt=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new Qvt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=rbt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function rbt(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let ibt=class{constructor(e,r,i,s,n,o){this.transform=e,this.toMapSpace=r,this.obb=i,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Ae(this.intersectionGeometry),this.renderable=Ae(this.renderable),this.components=Ae(this.components)}};function sbt(t,e,r,i){if(r>=e)return t;t==null&&(t=nbt());const s=t.isVisibleBit;let n=t.data;const o=fMe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=n,h=i===s;if(!(r<u.length*o)&&h){const p=a+1,f=Math.ceil(u.length*i6),g=c+1;let _=Math.max(p,f);_=Math.min(_,g),n=new Uint32Array(_),n.set(u)}return a<n.length&&(n[a]=abt(n[a],l,h)),t.data=n,t}function cW(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=fMe(i);return e<i.length*s?obt(r,i,e,s):!t.isVisibleBit}function nbt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function obt(t,e,r,i){const s=r/i|0,n=r-s*i;return lbt(e[s],n)===t}function fMe(t){return t.BYTES_PER_ELEMENT*8}function abt(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function lbt(t,e){return(t&1<<e)!=0}let cbt=class{constructor(e,r,i){this.viewingMode=e,this.positionData=r,this._components=i,this._planetCenter=E(),this._planetNorth=E(),this._componentIndicesForBsp=null,this._componentBspNodes=[],this._aabb=[0,0,0,0,0,0],this._indices=r.indices?lm(r.indices):cx(r.positions.length/3),this._positions=r.positions,this._componentIntersectionData=new Array(i.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,r){const i=this._ensureComponentAabbs(),s=6*e;return r[0]=i[s],r[1]=i[s+1],r[2]=i[s+2],r[3]=i[s+3],r[4]=i[s+4],r[5]=i[s+5],r}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a,l){const{position:c}=a,u=Hi(dbt,e,c),h=Hi(pbt,r,c),p=ix(fbt,a.rotationScale);Bo(u,u,p),Bo(h,h,p);const f=Uh(mbt,p),g=new JE(this._positions,3),_=this._indices,v=this._components.offsets,b=j2e(u,h,ubt);if(this.viewingMode===Ne.Global){const P=this._planetCenter;Eo(P,c),Bo(P,P,p);const R=this._planetNorth;te(R,0,0,1),Bo(R,R,p),fe(R,R)}const w=ce(gbt,u),T=ce(ybt,h),S=Hi(_bt,h,u);fe(S,S);const C=P=>{const R=this.getComponentAabb(P,hbt);if(n!=null){const j=n[P];s==null||l?(u[2]=w[2]-j,h[2]=T[2]-j):s.componentOffset=j}if(s==null||l||s.applyToAabb(R),!yJ(R,u,b,i))return;const L=v[P]/3,F=v[P+1]/3,U=(j,z,Z)=>o(P,j,Bo(z,z,f),Z);(s==null||l)&&F-L>hMe?(this._componentIntersectionData[P]==null&&(this._componentIntersectionData[P]=new aQ(this._indices,L,F,g)),this._componentIntersectionData[P].intersectRay(u,h,U)):PR(u,h,L,F,_,g,void 0,s,U)};this._intersectComponents(C,l,u,h)}_intersectComponents(e,r,i,s){const n=this._components.pickability,o=this._components.visibility;if(this._components.visibility.componentCount<Sbt){const u=h=>(cW(n,h)&&e(h),!0);return void o.forEachComponent(u)}this._componentBspNodes.length===0&&this._generateComponentBspRoot();const a=this._componentIndicesForBsp,l=u=>{cW(n,u)&&o.isVisible(u)&&e(u)},c=(u,h)=>{for(let p=u;p<h;++p)l(a[p])};if(r){let u=0;for(;u>=0;){const h=this._componentBspNodes[u],p=h.plane;if(!p||h.child0===-1&&h.child1===-1){c(h.minComponentIndexIndex,h.maxComponentIndexIndex);break}{c(h.minMidComponentIndexIndex,h.maxMidComponentIndexIndex);const f=de(p,i)-p[3];if(f<0){if(h.child0===-1){c(h.minComponentIndexIndex,h.minMidComponentIndexIndex);break}u=h.child0}else{if(!(f>0))break;if(h.child1===-1){c(h.maxMidComponentIndexIndex,h.maxComponentIndexIndex);break}u=h.child1}}}}else{const u=Ebt;Hi(u,s,i),fe(u,u);const h=this._componentBspNodes,p=f=>{const g=h[f],_=g.plane;if(!_||g.child0===-1&&g.child1===-1)c(g.minComponentIndexIndex,g.maxComponentIndexIndex);else{const v=de(_,i)-_[3],b=de(_,u);g.minComponentIndexIndex<g.minMidComponentIndexIndex&&(v<=0||b<0)&&(g.child0!==-1?p(g.child0):c(g.minComponentIndexIndex,g.minMidComponentIndexIndex)),c(g.minMidComponentIndexIndex,g.maxMidComponentIndexIndex),g.maxMidComponentIndexIndex<g.maxComponentIndexIndex&&(v>=0||b>0)&&(g.child1!==-1?p(g.child1):c(g.maxMidComponentIndexIndex,g.maxComponentIndexIndex))}};p(0)}}_generateComponentBspRoot(){const e=this._components.count,r=new Uint16Array(e);this._componentIndicesForBsp=r;for(let b=0;b<e;++b)r[b]=b;const i=this._ensureComponentAabbs(),s=this._planetCenter,n=this._planetNorth,o=wbt;Eo(o,s),fe(o,o),Ze(xbt,n,o);const a=this._aabb,l=a[2],c=[];let u=0;const h=this._componentBspNodes;h.length=0;const p=(b,w)=>{const T=6*b,S=i[T],C=i[T+1],P=i[T+2],R=i[T+3],L=i[T+4],F=i[T+5],U=te(Nue,.5*(S+R),.5*(C+L),.5*(P+F)),j=.5*(R-S),z=.5*(L-C),Z=.5*(F-P),W=Math.sqrt(j*j+z*z+Z*Z),Y=w,le=w[3],I=de(Y,U)-le;return Math.abs(I)>W?Math.sign(I):0},f=(b,w,T)=>{let S=1/0,C=1/0,P=1/0,R=-1/0,L=-1/0,F=-1/0;for(let U=w;U<T;++U){const j=6*r[U];S=Math.min(S,i[j]),R=Math.max(R,i[j+3]),C=Math.min(C,i[j+1]),L=Math.max(L,i[j+4]),P=Math.min(P,i[j+2]),F=Math.max(F,i[j+5])}b[0]=S,b[1]=C,b[2]=P,b[3]=R,b[4]=L,b[5]=F},g=this.viewingMode===Ne.Local;let _=!1;if(!g){const b=te(Nue,.5*(a[0]+a[3]),.5*(a[1]+a[4]),.5*(a[2]+a[5])),w=Vg(s,b);_=l>.5*w}const v=(b,w,T,S,C)=>{const P=h.length;let R;if(_||T>=Tbt||w-b<xB)R=new Due(b,w,w,w,null);else{f(v2,b,w);const L=v2[0],F=v2[1],U=v2[2],j=v2[3],z=v2[4],Z=j-L,W=z-F,Y=Yt(),le=Y;if(g)Z>=W?(te(le,1,0,0),Y[3]=-.5*(L+j)):(te(le,0,1,0),Y[3]=-.5*(F+z));else{const B=vbt,H=bbt;te(B,.5*(L+j),.5*(F+z),U),Hi(B,B,s),fe(B,B),Ze(H,B,n),fe(H,H),Z>=W?ce(le,H):(Ze(le,H,B),fe(le,le)),Y[3]=de(le,s)}let I,N;{let B=b,H=w;for(;B<H;){const Q=r[B];p(Q,Y)<0?++B:(--H,r[B]=r[H],r[H]=Q)}I=B;let q=B;for(H=w;q<H;){const Q=r[H-1];p(Q,Y)>0?--H:(r[H-1]=r[q],r[q]=Q,++q)}N=H}R=new Due(b,I,N,w,Y),I>=b+xB&&c.push(()=>v(b,I,T+1,P,!0)),w>=N+xB&&c.push(()=>v(N,w,T+1,P,!1))}if(h.push(R),S!==-1){const L=h[S];C?L.child0=P:L.child1=P}};for(c.push(()=>v(0,e,0,-1,!1));u<c.length;)(0,c[u])(),++u}_computePerComponentAabbs(){const e=this._components.count,r=hs(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0,a=1/0,l=1/0,c=1/0,u=-1/0,h=-1/0,p=-1/0;for(let f=0;f<e;f++){const g=n[f],_=n[f+1];let v=1/0,b=1/0,w=1/0,T=-1/0,S=-1/0,C=-1/0;for(let P=g;P<_;P++){const R=3*i[P],L=s[R],F=s[R+1],U=s[R+2];v=Math.min(v,L),b=Math.min(b,F),w=Math.min(w,U),T=Math.max(T,L),S=Math.max(S,F),C=Math.max(C,U)}r[o++]=v,r[o++]=b,r[o++]=w,r[o++]=T,r[o++]=S,r[o++]=C,a=Math.min(a,v),l=Math.min(l,b),c=Math.min(c,w),u=Math.max(u,T),h=Math.max(h,S),p=Math.max(p,C)}return this._aabb[0]=a,this._aabb[1]=l,this._aabb[2]=c,this._aabb[3]=u,this._aabb[4]=h,this._aabb[5]=p,r}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}},Due=class{constructor(e,r,i,s,n){this.minComponentIndexIndex=e,this.minMidComponentIndexIndex=r,this.maxMidComponentIndexIndex=i,this.maxComponentIndexIndex=s,this.plane=n,this.child0=-1,this.child1=-1}};const ubt=E(),hbt=Mn(),v2=[0,0,0,0,0,0],dbt=E(),pbt=E(),fbt=xi(),mbt=xi(),gbt=E(),ybt=E(),_bt=E(),vbt=E(),bbt=E(),wbt=E(),xbt=E(),Nue=E(),xB=5,Tbt=10,Sbt=7,Ebt=E();let Cbt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},Abt=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},cQ=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function Pbt(t,e){return{near:t,far:e}}function jR(t){return Pbt(1/0,-1/0)}function LF(t,e,r){return t.near=e,t.far=r,t}function AE(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function kL(t,e){return t.near<=e&&e<=t.far}const uW={near:0,far:0};function Mbt(t,e){const r=jR(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=de(Hi(Yc,a.center,i),n),c=a.projectedRadius(n);if(kL(r,l-c)&&kL(r,l+c))return;const u=Lbt(a,s);if(u===-1)return;if(u===0)return tg.far=l+c,tg.near=l-c,void AE(r,tg);const h=UL.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=o});for(let o=0;o<UL.length;o++){const a=UL.data[o];if(kL(r,a.near)&&kL(r,a.far))continue;tg.far=a.far,tg.near=1/0,Ibt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,Obt,c=>{let u=Rbt;for(let h=0;h<mMe&&c.length>0;h++){if(!(a.mask&1<<h))continue;$bt(s[h],c,u);const p=c;c=u,u=p}for(let h=0;h<c.length;h+=3){te(wl,c.data[h],c.data[h+1],c.data[h+2]);const p=de(Hi(wl,wl,i),n);tg.near=Math.min(tg.near,p)}})===0&&(tg.near=0),AE(r,tg)}return UL.length=0,r}const UL=new kt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),tg=jR(),wl=E(),mv=E(),Obt=new kt({deallocator:null}),Rbt=new kt({deallocator:null});function $bt(t,e,r){r.length=0;const i=e.length-3;TB(wl,e,i);const s=bi(t,wl);s<=0&&(r.push(wl[0]),r.push(wl[1]),r.push(wl[2]));let n=0,o=s;for(;n<i;n+=3){TB(mv,e,n);const a=bi(t,mv);o*a<0&&(li(wl,mv,wl,a/(a-o)),xl(r,wl)),a<=0&&xl(r,mv),o=a,ce(wl,mv)}o*s<0&&(TB(mv,e,i),li(wl,mv,wl,s/(s-o)),xl(r,wl))}function TB(t,e,r){return te(t,e.data[r],e.data[r+1],e.data[r+2])}function xl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function Ibt(t,e,r,i){S_(kue,t.quaternion),Hi(Yc,e,t.center),lc(Yc,Yc,kue);const s=t.halfSize,n=8*((Yc[0]<-s[0]?-1:Yc[0]>s[0]?1:0)+3*(Yc[1]<-s[1]?-1:Yc[1]>s[1]?1:0)+9*(Yc[2]<-s[2]?-1:Yc[2]>s[2]?1:0)+13),o=Fue[n];if(o===0)return o;eO(zL,t.quaternion),lk(zL,zL,t.halfSize);const a=(l,c)=>{const u=Fue[n+c+1];return te(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),Bo(l,l,zL),pe(l,t.center,l)};return r.length=0,xl(r,a(SB,0)),xl(r,a(Uue,1)),xl(r,a(Yc,2)),xl(r,a(zue,3)),i(r),o===1||(r.length=0,xl(r,SB),xl(r,zue),xl(r,a(Yc,4)),xl(r,a(Bue,5)),i(r),o===2||(r.length=0,xl(r,SB),xl(r,Bue),xl(r,a(Yc,6)),xl(r,Uue),i(r))),o}const Fue=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),mMe=4;function Lbt(t,e){let r=0;for(let i=0;i<mMe;i++){const s=t.intersectPlane(e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const zL=xi(),kue=$c(),Yc=E(),SB=E(),Uue=E(),zue=E(),Bue=E();let Dbt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Mbt(e,this._objects.visibleObjects):null}};function Nbt(t){const e=Yi().vec3f(O.POSITION);return t.hasNormals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===rs.Default?e.vec2f(O.UV0):t.textureCoordinates===rs.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e}let Fbt=class{constructor(){this.externalColor=Yt(),this.externalColorMixMode=Sn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},kbt=class extends ps{constructor(e,r){super(e,"int",Rr.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var dm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(dm||(dm={}));const uQ=429496.7296;function gMe(t,e){CO(t/uQ*.5+.5,e)}function Ubt(t,e){switch(e.componentData){case dm.Varying:return zbt(t,e);case dm.Uniform:return Bbt(t,e);case dm.COUNT:return;default:e.componentData}}function zbt(t,e){const{vertex:r,fragment:i}=t;r.include(Yh),r.uniforms.add(new Ch("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===k.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(YTe),r.constants.add("elevationScale","float",2*uQ),r.constants.add("stride","float",se("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(x`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(x`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?x`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:x`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(x`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?x`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Bbt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new aF("externalColor",n=>n.componentParameters.externalColor)),i.uniforms.add(new kbt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),r.code.add(x`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===k.ObjectAndLayerIdColor;i.code.add(x`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${s?x`fragColor = vec4(0,0,0,0);`:""}
 }
`)}var hu;function Vbt(t,e){const r=t.vertex;switch(r.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case hu.None:r.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case hu.Opaque:r.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case hu.Transparent:r.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case hu.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(hu||(hu={}));var pm;function nVt(t){return t&&u1(t)?pm.Mars:t&&h1(t)?pm.Moon:pm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(pm||(pm={}));var _h;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(_h||(_h={}));let ir=class extends zl{constructor(){super(...arguments),this.output=k.Color,this.textureCoordinateType=rs.None,this.componentData=dm.Uniform,this.cullFace=Ei.Back,this.vertexDiscardMode=hu.None,this.doubleSidedMode=ds.WindingOrder,this.alphaDiscardMode=gi.Opaque,this.integratedMeshMode=_h.None,this.transparencyPassType=dt.NONE,this.ellipsoidMode=pm.Earth,this.pbrMode=nt.Disabled,this.normalType=Ir.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([G({count:k.COUNT})],ir.prototype,"output",void 0),d([G({count:rs.COUNT})],ir.prototype,"textureCoordinateType",void 0),d([G({count:dm.COUNT})],ir.prototype,"componentData",void 0),d([G({count:Ei.COUNT})],ir.prototype,"cullFace",void 0),d([G({count:hu.COUNT})],ir.prototype,"vertexDiscardMode",void 0),d([G({count:ds.COUNT})],ir.prototype,"doubleSidedMode",void 0),d([G({count:gi.COUNT})],ir.prototype,"alphaDiscardMode",void 0),d([G({count:_h.COUNT})],ir.prototype,"integratedMeshMode",void 0),d([G({count:dt.COUNT})],ir.prototype,"transparencyPassType",void 0),d([G({count:pm.COUNT})],ir.prototype,"ellipsoidMode",void 0),d([G({count:nt.COUNT})],ir.prototype,"pbrMode",void 0),d([G({count:Ir.COUNT})],ir.prototype,"normalType",void 0),d([G()],ir.prototype,"spherical",void 0),d([G()],ir.prototype,"doublePrecisionRequiresObfuscation",void 0),d([G()],ir.prototype,"hasVertexColors",void 0),d([G()],ir.prototype,"hasNormals",void 0),d([G()],ir.prototype,"hasSlicePlane",void 0),d([G()],ir.prototype,"hasColorTexture",void 0),d([G()],ir.prototype,"receiveAmbientOcclusion",void 0),d([G()],ir.prototype,"receiveShadows",void 0),d([G()],ir.prototype,"blendingEnabled",void 0),d([G()],ir.prototype,"hasScreenSpaceReflections",void 0),d([G()],ir.prototype,"hasPolygonOffset",void 0),d([G()],ir.prototype,"hasMetallicRoughnessTexture",void 0),d([G()],ir.prototype,"hasEmissionTexture",void 0),d([G()],ir.prototype,"hasOcclusionTexture",void 0),d([G()],ir.prototype,"hasNormalTexture",void 0),d([G()],ir.prototype,"hasOccludees",void 0),d([G()],ir.prototype,"multipassEnabled",void 0),d([G()],ir.prototype,"cullAboveGround",void 0),d([G()],ir.prototype,"hasNormalTextureTransform",void 0),d([G()],ir.prototype,"hasCloudsReflections",void 0),d([G()],ir.prototype,"snowCover",void 0),d([G()],ir.prototype,"objectAndLayerIdColor",void 0),d([G({constValue:!1})],ir.prototype,"occlusionPass",void 0),d([G({constValue:Rr.Draw})],ir.prototype,"pbrTextureBindType",void 0),d([G({constValue:!0})],ir.prototype,"hasSliceHighlight",void 0),d([G({constValue:!1})],ir.prototype,"hasSliceInVertexProgram",void 0),d([G({constValue:!1})],ir.prototype,"useCustomDTRExponentForWater",void 0),d([G({constValue:!1})],ir.prototype,"hasVertexTangents",void 0),d([G({constValue:!0})],ir.prototype,"supportsTextureAtlas",void 0),d([G({constValue:!1})],ir.prototype,"highStepCount",void 0),d([G({constValue:!1})],ir.prototype,"instancedDoublePrecision",void 0),d([G({constValue:!1})],ir.prototype,"hasModelTransformation",void 0),d([G({constValue:!0})],ir.prototype,"useFillLights",void 0),d([G({constValue:!1})],ir.prototype,"objectAndLayerIdColorInstanced",void 0);function Vue(t,e){t.include(px,e),t.fragment.include(wO);const r=t.fragment;r.uniforms.add(new aF("baseColor",i=>i.baseColor)),r.uniforms.add(new lw("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Gue(t,e){const r=t.fragment;switch(e.doubleSidedMode){case ds.None:r.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case ds.View:t.include(uS,e),r.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case ds.WindingOrder:r.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case ds.COUNT:}switch(e.normalType){case Ir.Attribute:case Ir.Compressed:t.include(o8,e),r.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ir.ScreenDerivative:t.include(uS,e),r.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ir.Ground:e.spherical?(t.include(uS,e),r.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ir.COUNT:}}function Gbt(t,e){const r=t.fragment;if(e.hasColorTexture&&(e.output===k.Color||e.alphaDiscardMode!==gi.Opaque)){t.include(TZ,e);const i=e.textureCoordinateType===rs.Atlas;r.uniforms.add(new Ch("baseColorTexture",s=>s.texture)),i?(t.include(hwe),r.code.add(x`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(x`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function yMe(t){const e=new Or;e.include(uS,t),e.include(o8,t),e.include(px,t),e.include(om,t),e.include(nC,t),e.include(Ubt,t),e.include(trt,t),e.include(set,t),e.include(Gbt,t),e.include(Vbt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==nt.Normal&&t.pbrMode!==nt.Schematic||(e.include(EZ,t),t.hasNormalTexture&&e.include(QTe,t));const s=t.output===k.Shadow||t.output===k.ShadowHighlight||t.output===k.ShadowExcludeHighlight;s&&t.componentData===dm.Varying?r.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(x`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===_h.ColorOverlay||t.integratedMeshMode===_h.ColorOverlayWithWater,o=n&&t.output===k.Color&&t.pbrMode===nt.WaterOnIntegratedMesh;return n&&(e.include(Gw,t),e.include(xst,t),t.spherical?r.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(t.ellipsoidMode===pm.Earth?Kr.radius:t.ellipsoidMode===pm.Mars?hp.radius:i0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===k.ObjectAndLayerIdColor?x`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${x.float(xo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===k.ObjectAndLayerIdColor?x`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===k.Alpha&&(i.include(bm),e.include(Oc,t),e.include(Vue,t),n&&i.uniforms.add(new at("ovColorTex",(a,l)=>cq(a,l))),i.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?x`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===k.Color&&(i.include(bm),e.include(Oc,t),e.include(Vue,t),e.include(Gue,t),e.include(Gw,t),t.receiveShadows?(e.include(DR,t),i.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(x`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new at("ovColorTex",(a,l)=>cq(a,l))),i.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?x`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===nt.Normal||t.pbrMode===nt.Schematic||t.pbrMode===nt.Simplified?(Om(i),i.code.add(x`
        ${t.pbrMode===nt.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(x`vec3 shadingNormal = normalVertex;`),i.code.add(x`${t.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        ${t.pbrMode===nt.Simplified?x` float ssao = 1.0 - evaluateAmbientOcclusionInverse();`:x` float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();`}
        ${t.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${t.pbrMode===nt.Simplified?x` vec4 shadedColor = vec4(evaluatePBRSimplifiedLighting(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround), materialColor.a);`:"vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);"}
        `)):(t.receiveShadows?i.code.add(x`float shadow = evaluateShadow();`):t.spherical?(hC(i),i.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(x`float shadow = 0.0;`),o&&i.uniforms.add(new at("ovNormalTex",(a,l)=>{var c;return(c=l.overlay)==null?void 0:c.getTexture(Fi.WaterNormal)})),t.snowCover&&i.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(x`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===dt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===k.LinearDepth||s)&&(e.include(h0,t),i.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===k.Normal&&(e.include(Gue,t),i.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===Ir.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===k.ObjectAndLayerIdColor&&e.fragment.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===k.Highlight&&(e.include(w1),i.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const jbt=Object.freeze(Object.defineProperty({__proto__:null,build:yMe},Symbol.toStringTag,{value:"Module"}));let _Me=class vMe extends Gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ne.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Dr(e.rctx,vMe.shader.get().build(this.configuration),bMe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==_h.None,s=e===dt.NONE,n=e===dt.FrontFace;return Nt({blending:r.output!==k.Color&&r.output!==k.Alpha||!r.blendingEnabled?null:s?wu:A0(e),culling:Ok(r.cullFace),depthTest:{func:x1(e)},depthWrite:s||n?Mc:null,colorWrite:qt,stencilWrite:i||r.hasOccludees?Sm:null,stencilTest:i?Xtt(Il.IntegratedMeshMaskExcluded):r.hasOccludees?T1:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:r8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};_Me.shader=new Lr(jbt,()=>me(()=>Promise.resolve().then(()=>CAt),void 0));const bMe=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let Hbt=class extends Ci{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},hQ=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function ys(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function jue(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let R8=class{constructor(e){this._low=E(),this._high=E(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ce(this._low,ce(Hue,e));const r=Hi(Hue,e,this._low);ce(this._high,r)}get(e){return pe(e,this._low,this._high)}getLowScaled(e){return re(e,this._low,1)}};const Hue=gc();let Kn=class extends Hbt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=zt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=la(a8),this.emissiveFactor=Pe(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new qN,this.componentParameters=new AM,this.textureAlphaCutoff=Q5,this.alphaDiscardMode=gi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=pm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ir;const i=new R8(e.position),s=lye(e.rotationScale);ix(s,s),Uh(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=er(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===vc.Material&&i.transparencyPassType!=null?i.transparencyPassType:dt.NONE,n.multipassEnabled=r.identifier===vc.Material&&i.multipassEnabled,n.cullAboveGround=r.identifier===vc.Material&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?ds.View:ds.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===Fa.Transparent||o===Fa.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Ybt(i)?Wbt(i)?_h.ColorOverlayWithWater:_h.ColorOverlay:_h.NoOverlay:_h.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===_h.ColorOverlayWithWater?nt.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?se("enable-feature:im-shading")&&this.isIntegratedMesh?nt.Simplified:nt.Schematic:nt.Normal:nt.Disabled,n.normalType=s.needsNormals?n.hasNormals?Ir.Compressed:Ir.ScreenDerivative:Ir.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===vc.ShadowMap)n.output=k.Shadow,n.vertexDiscardMode=hu.None;else if(r.identifier===vc.Highlight)n.output=k.Highlight,n.vertexDiscardMode=hu.None;else{switch(o===Fa.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?hu.Opaque:hu.Transparent:n.vertexDiscardMode=hu.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case k.Color:n.receiveAmbientOcclusion=i.ssao!=null,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.lastFrameColor!=null,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case k.Alpha:n.hasOccludees=i.hasOccludees;break;case k.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(_Me,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Fa.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Fa.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Fa.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Fa.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),qbt(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==Nn.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Fa.IntegratedMesh:this.objectOpacity<1?Fa.Transparent:this.componentParameters.opaqueOverride===Nn.All?Fa.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===gi.Blend||this.alphaDiscardMode===gi.MaskBlend?Fa.Transparent:this.componentParameters.transparent===Nn.None?Fa.Opaque:this.componentParameters.transparent===Nn.All?Fa.Transparent:Fa.OpaqueAndTransparent}};var Fa,Nn;d([ys({vectorOps:Mye})],Kn.prototype,"baseColor",void 0),d([ys()],Kn.prototype,"usePBR",void 0),d([ys()],Kn.prototype,"hasParametersFromSource",void 0),d([ys({vectorOps:Pee})],Kn.prototype,"mrrFactors",void 0),d([ys({vectorOps:Pee})],Kn.prototype,"emissiveFactor",void 0),d([ys({dispose:!0})],Kn.prototype,"baseColorTexture",void 0),d([ys({dispose:!0})],Kn.prototype,"metallicRoughnessTexture",void 0),d([ys({dispose:!0})],Kn.prototype,"emissionTexture",void 0),d([ys({dispose:!0})],Kn.prototype,"occlusionTexture",void 0),d([ys({dispose:!0})],Kn.prototype,"normalTexture",void 0),d([ys()],Kn.prototype,"objectOpacity",void 0),d([jue()],Kn.prototype,"commonMaterialParameters",void 0),d([jue()],Kn.prototype,"componentParameters",void 0),d([ys()],Kn.prototype,"textureAlphaCutoff",void 0),d([ys()],Kn.prototype,"alphaDiscardMode",void 0),d([ys()],Kn.prototype,"isIntegratedMesh",void 0),d([ys()],Kn.prototype,"polygonOffsetEnabled",void 0),d([ys()],Kn.prototype,"ellipsoidMode",void 0),d([ys()],Kn.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Fa||(Fa={}));let qN=class extends hQ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Ei.Back,this.hasSlicePlane=!0}};d([ys()],qN.prototype,"doubleSided",void 0),d([ys()],qN.prototype,"cullFace",void 0),d([ys()],qN.prototype,"hasSlicePlane",void 0);let AM=class extends hQ{constructor(){super(...arguments),this.externalColor=zt(1,1,1,1),this.externalColorMixMode=Sn.Multiply,this.castShadows=Nn.All}get transparent(){return this.externalColor[3]<1?Nn.All:Nn.None}get opaqueOverride(){return this.externalColorMixMode===Sn.Replace&&this.externalColor[3]===1?Nn.All:Nn.None}get visible(){return this.externalColor[3]>0?Nn.All:Nn.None}get type(){return dm.Uniform}};d([ys({vectorOps:Mye})],AM.prototype,"externalColor",void 0),d([ys()],AM.prototype,"externalColorMixMode",void 0),d([ys()],AM.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Nn||(Nn={}));let gP=class extends hQ{constructor(){super(...arguments),this.texture=null,this.transparent=Nn.None,this.opaqueOverride=Nn.None,this.castShadows=Nn.None}get type(){return dm.Varying}};function qbt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Fi.Highlight))!=null}function Wbt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Fi.WaterNormal))!=null}function Ybt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Fi.ColorNoRasterImage))!=null}d([ys()],gP.prototype,"texture",void 0),d([ys()],gP.prototype,"transparent",void 0),d([ys()],gP.prototype,"opaqueOverride",void 0),d([ys()],gP.prototype,"castShadows",void 0);const DF=Yi().vec3f(O.POSITION).u16(O.COMPONENTINDEX),wMe=Yi().vec2u8(O.SIDENESS),Xbt=Ic(wMe),hW=Yi().vec3f(O.POSITION0).vec3f(O.POSITION1).vec2i16(O.NORMALCOMPRESSED).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}),dW=Yi().vec3f(O.POSITION0).vec3f(O.POSITION1).vec2i16(O.NORMALCOMPRESSED).vec2i16(O.NORMAL2COMPRESSED).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}),xMe=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMALCOMPRESSED,6],[O.NORMAL2COMPRESSED,7],[O.SIDENESS,8]]);function que(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<i;b++){const w=t[3*b],T=t[3*b+1],S=t[3*b+2];o(w,T),o(T,S),o(S,w)}let a=0,l=0;for(let b=0;b<r;b++){const w=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=T}const c=new Uint32Array(6*i),u=s[r],h=(b,w,T)=>{if(b<w){const S=s[b+1]++;c[2*S]=w,c[2*S+1]=T}else{const S=n[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=T}};for(let b=0;b<i;b++){const w=t[3*b],T=t[3*b+1],S=t[3*b+2];h(w,T,b),h(T,S,b),h(S,w,b)}const p=(b,w)=>{const T=2*b,S=w-b;for(let C=1;C<S;C++){const P=c[T+2*C],R=c[T+2*C+1];let L=C-1;for(;L>=0&&c[T+2*L]>P;L--)c[T+2*L+2]=c[T+2*L],c[T+2*L+3]=c[T+2*L+1];c[T+2*L+2]=P,c[T+2*L+3]=R}};for(let b=0;b<r;b++)p(s[b],s[b+1]),p(u+n[b],u+n[b+1]);const f=new Int32Array(3*i),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,_=(b,w)=>{const T=g(b,w);f[3*w+T]=-1},v=(b,w,T,S)=>{const C=g(b,w);f[3*w+C]=S;const P=g(T,S);f[3*S+P]=w};for(let b=0;b<r;b++){let w=s[b];const T=s[b+1];let S=n[b];const C=n[b+1];for(;w<T&&S<C;){const P=c[2*w],R=c[2*u+2*S];P===R?(v(b,c[2*w+1],R,c[2*u+2*S+1]),w++,S++):P<R?(_(b,c[2*w+1]),w++):(_(R,c[2*u+2*S+1]),S++)}for(;w<T;)_(b,c[2*w+1]),w++;for(;S<C;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return f}let TMe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?Jbt:Zbt}write(e,r,i){const s=this._edgeHashFunction(i);BL.seed=s;const n=BL.getIntRange(0,255),o=BL.getIntRange(0,this.settings.variants-1),a=.7,l=BL.getFloat(),c=255*(.5*Kbt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const dQ=new Float32Array(6),NF=new Uint32Array(dQ.buffer),b_=new Uint32Array(1);function Zbt(t){const e=dQ;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],b_[0]=5381;for(let r=0;r<NF.length;r++)b_[0]=31*b_[0]+NF[r];return b_[0]}function Jbt(t){const e=dQ;e[0]=b2(t.position0[0]),e[1]=b2(t.position0[1]),e[2]=b2(t.position0[2]),e[3]=b2(t.position1[0]),e[4]=b2(t.position1[1]),e[5]=b2(t.position1[2]),b_[0]=5381;for(let r=0;r<NF.length;r++)b_[0]=31*b_[0]+NF[r];return b_[0]}const Wue=1e4;function b2(t){return Math.round(t*Wue)/Wue}function Kbt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let FF=class{constructor(){this._commonWriter=new TMe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return hW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),pe(w2,i.faceNormal0,i.faceNormal1),fe(w2,w2);const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;$p(s,r,w2[0],w2[1],w2[2],n)}trim(e,r){return this._commonWriter.trim(e,r)}};FF.Layout=hW,FF.glLayout=Ic(hW,1);let kF=class{constructor(){this._commonWriter=new TMe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return dW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i);{const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;$p(s,r,i.faceNormal0[0],i.faceNormal0[1],i.faceNormal0[2],n)}{const{typedBuffer:s,typedBufferStride:n}=e.normal2Compressed;$p(s,r,i.faceNormal1[0],i.faceNormal1[1],i.faceNormal1[2],n)}}trim(e,r){return this._commonWriter.trim(e,r)}};kF.Layout=dW,kF.glLayout=Ic(dW,1);const w2=E(),BL=new Wb,nb=-1;var UF;function Qbt(t,e,r,i=nwt){const s=t.vertices.position,n=t.vertices.componentIndex,o=Lt(i.anglePlanar),a=Lt(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=pW.edge,h=u.position0,p=u.position1,f=u.faceNormal0,g=u.faceNormal1,_=swt(t),v=iwt(t),b=v.length/4,w=e.allocate(b);let T=0;const S=b,C=r.allocate(S);let P=0,R=0,L=0;const F=k$e(0,b),U=new Float32Array(b);U.forEach((Y,le,I)=>{s.getVec(v[4*le],h),s.getVec(v[4*le+1],p),I[le]=$i(h,p)}),F.sort((Y,le)=>U[le]-U[Y]);const j=new Array,z=new Array;for(let Y=0;Y<b;Y++){const le=F[Y],I=U[le],N=v[4*le],B=v[4*le+1],H=v[4*le+2],q=v[4*le+3],Q=q===nb;if(s.getVec(N,h),s.getVec(B,p),Q)te(f,_[3*H],_[3*H+1],_[3*H+2]),ce(g,f),u.componentIndex=n.get(N),u.cosAngle=de(f,g);else{if(te(f,_[3*H],_[3*H+1],_[3*H+2]),te(g,_[3*q],_[3*q+1],_[3*q+2]),u.componentIndex=n.get(N),u.cosAngle=de(f,g),twt(u,c))continue;u.cosAngle<-.9999&&ce(g,f)}R+=I,L++,Q||ewt(u,l)?(e.write(w,T++,u),j.push(I)):rwt(u,o)&&(r.write(C,P++,u),z.push(I))}const Z=new Float32Array(j.reverse()),W=new Float32Array(z.reverse());return{regular:{instancesData:e.trim(w,T),lodInfo:{lengths:Z}},silhouette:{instancesData:r.trim(C,P),lodInfo:{lengths:W}},averageEdgeLength:R/L}}function ewt(t,e){return t.cosAngle<e}function twt(t,e){return t.cosAngle>e}function rwt(t,e){const r=Bn(t.cosAngle),i=pW.fwd,s=pW.ortho;return m0(i,t.position1,t.position0),r*(de(Ze(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function iwt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],p=r[3*a+1],f=r[3*a+2];s+=l===nb||h<p?1:0,s+=c===nb||p<f?1:0,s+=u===nb||f<h?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],p=r[3*a+1],f=r[3*a+2];(l===nb||h<p)&&(n[o++]=h,n[o++]=p,n[o++]=a,n[o++]=l),(c===nb||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=c),(u===nb||f<h)&&(n[o++]=f,n[o++]=h,n[o++]=a,n[o++]=u)}return n}function swt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=EB.v0,n=EB.v1,o=EB.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],h=i[3*l+2];r.getVec(c,s),r.getVec(u,n),r.getVec(h,o),ye(n,n,s),ye(o,o,s),Ze(s,n,o),fe(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(UF||(UF={}));const pW={edge:{position0:E(),position1:E(),faceNormal0:E(),faceNormal1:E(),componentIndex:0,cosAngle:0},ortho:E(),fwd:E()},EB={v0:E(),v1:E(),v2:E()},nwt={anglePlanar:4,angleSignificantEdge:35};function owt(t){const e=awt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Yue.updateSettings(t.writerSettings),Xue.updateSettings(t.writerSettings),Qbt(e,Yue,Xue)}function awt(t,e,r,i){if(e){const o=que(r,i,t.count);return new lwt(r,i,o,t)}const s=aq(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=que(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:DF.createView(s.buffer)}}let lwt=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const Yue=new FF,Xue=new kF,_Vt=Yi().vec3f(O.POSITION0).vec3f(O.POSITION1),cwt=Yi().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX);let uwt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},hwt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new oi(this.textureWidth,1);i.samplingMode=Gt.NEAREST,i.wrapMode=Xt.CLAMP_TO_EDGE,this._texture=new Sr(this._rctx,i),this._data=new _a(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new _a(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const SMe=65536;let dwt=class{constructor(e,r=1){this.textureBuffer=new hwt(e,r),this._indexManager=new uwt(SMe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},EMe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>SMe)return null;const r=new dwt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Zue=()=>ae.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let pwt=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new kt,this._hidden=new kt,this._renderSubmit=new Dbt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=se("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new EMe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){ht(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const r=e.geometry,i=new tbt(this._componentBufferManager,lm(r.componentOffsets)),s=this._createRenderable(e,i),n=new cbt(this._viewingMode,r.positionData,i),o=new ibt(e.transform,e.toMapSpace,e.obb.clone(),i,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const r=e;(r.visible?this._visible:this._hidden).removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(r?(this._hidden.removeUnordered(i),this._visible.push(i)):(this._visible.removeUnordered(i),this._hidden.push(i)),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=So(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount;return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new Fbt,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let p=0,f=0,g=0,_=n.verticalOffsets,v=1/0,b=-1/0,w=!1,T=!1,S=0;for(let C=0;C<n.count;C++){r(C,l),p+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===Sn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,WTe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[C],0,u[0],u[1],u[2],u[3]),w||(w=C>0&&S!==h[0]),S=h[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(C).fill(0)),_!=null&&(_[C]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),gMe(l.elevationOffset,u),c.setData(a[C],1,u[0],u[1],u[2],u[3]);const P=l.objectAndLayerIdColor;P!=null&&c.setData(a[C],2,P[0],P[1],P[2],P[3]),l.pickable!==cW(n.pickability,C)&&(n.pickability=sbt(n.pickability,n.count,C,l.pickable))}n.verticalOffsets=T?_:null,i.offsetObb=T?U_e(i.obb,v,b,this._viewingMode,i.offsetObb??i.obb.clone()):null,w||T||this._hasObjectAndLayerId?(s.componentParameters=new gP,s.componentParameters.castShadows=CB(g,n.count),s.componentParameters.transparent=CB(p,n.count),s.componentParameters.opaqueOverride=CB(f,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new AM,s.componentParameters.castShadows=l.castShadows?Nn.All:Nn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Ne.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=Pre(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}expandRangeWithComponentObjectElevationRange(e,r,i,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==r||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.components,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,u=this._viewingMode===Ne.Local,h=c.getComponentAabbs(),p=mwt;let f=1/0,g=-1/0;for(let _=0;_<a;_++){const v=6*_,b=(l==null?void 0:l[_])??0;let w=1/0,T=-1/0;if(u)w=h[v+2]+b+r,T=h[v+5]+b+r;else{if(p[0]=h[v],p[1]=h[v+1],p[2]=h[v+2],p[3]=h[v+3],p[4]=h[v+4],p[5]=h[v+5],b!==0){const R=Pre(b);R.localOrigin=n.transform.position,R.applyToAabb(p)}const S=Math.max(Math.abs(p[3]),Math.abs(p[0])),C=Math.max(Math.abs(p[4]),Math.abs(p[1])),P=r+p[5]+i;s.expandElevationRangeValues(r+p[2],Math.sqrt(S*S+C*C+P*P)-i)}s.expandElevationRangeValues(w,T),f=Math.min(f,w),g=Math.max(g,T)}this._elevationRangeCacheVerticalOffset=r,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(e,r,i,s,n,o,a){const l=e,{transform:c}=l,{position:u}=c;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(r,i,s,n,l.components.verticalOffsets,o,c,a??!1)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(n,a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:cwt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=DF.createBuffer(a.length/3);VR(c.position.typedBuffer,a,c.position.typedBufferStride,3),KSe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,h=this._computeVisibilityIndices(o,n,l,u);return{origin:qi(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Oh(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],h=i[c];for(let p=u;p<h;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void Zue().warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Zue().warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=qr.createVertex(i,Pr.STATIC_DRAW,s.vertices.data),a=s.indices?qr.createIndex(i,Pr.STATIC_DRAW,s.indices):null,l=Ic(Nbt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],b=r.offsets[_+1],w=r.materialDataIndices[_];if(s.indices!=null)for(let T=v;T<b;T++)c[s.indices[T]]=w;else for(let T=v;T<b;T++)c[T]=w}const u=qr.createVertex(i,Pr.STATIC_DRAW,c.buffer),h=new Kn(e.transform,e.toMapSpace),p=new Bh(i,bMe,{data:l,componentIndices:fwt},{data:o,componentIndices:u},a),f=new Abt(p,sr.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new Cbt(h,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const fwt=Ic(Yi().u16(O.COMPONENTINDEX));function CB(t,e){return t===e?Nn.All:t===0?Nn.None:Nn.Some}const mwt=Mn();let $8=class extends Ci{constructor(){super(...arguments),this.opacity=1}};function CMe(t){const e=new Or;return e.include(Ta),e.fragment.uniforms.add(new at("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(x`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const gwt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:$8,build:CMe},Symbol.toStringTag,{value:"Module"}));var ua;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ua||(ua={}));let zF=class extends zl{constructor(){super(...arguments),this.alphaMode=ua.None,this.hasOpacityFactor=!1}};d([G({count:ua.COUNT})],zF.prototype,"alphaMode",void 0),d([G()],zF.prototype,"hasOpacityFactor",void 0);let pQ=class AMe extends Gr{initializeProgram(e){return new Dr(e.rctx,AMe.shader.get().build(this.configuration),Mr)}initializePipeline(){switch(this.configuration.alphaMode){case ua.None:return Nt({colorWrite:qt});case ua.Alpha:return Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt});case ua.PremultipliedAlpha:case ua.COUNT:return Nt({blending:Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}}};pQ.shader=new Lr(gwt,()=>me(()=>Promise.resolve().then(()=>AAt),void 0));let fQ=class extends Ci{};function PMe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("tex",e=>e.texture)),t.fragment.code.add(x`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const ywt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:fQ,build:PMe},Symbol.toStringTag,{value:"Module"}));let MMe=class OMe extends Gr{initializeProgram(e){return new Dr(e.rctx,OMe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};MMe.shader=new Lr(ywt,()=>me(()=>Promise.resolve().then(()=>PAt),void 0));let mQ=class extends Ci{};function RMe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("colorTexture",e=>e.colorTexture),new at("alphaTexture",e=>e.alphaTexture),new at("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(x`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const _wt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:mQ,build:RMe},Symbol.toStringTag,{value:"Module"}));let $Me=class IMe extends Gr{initializeProgram(e){return new Dr(e.rctx,IMe.shader.get().build(),Mr)}initializePipeline(){return Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};$Me.shader=new Lr(_wt,()=>me(()=>Promise.resolve().then(()=>MAt),void 0));let vwt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new zF,this._passParameters=new $8,this._oitParameters=new mQ,this._hudParameters=new fQ}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._techniqueRepository.acquire($Me);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._techniqueRepository.acquire(MMe);this._rctx.bindTechnique(i,e,this._hudParameters),this._rctx.screen.draw(),i.release()}composite(e,r,i=ua.None,s=1){this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const n=this._techniqueRepository.acquire(pQ,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}};const bwt=1e4,fW=100,wwt=500,xwt=500,Twt=.1;function Swt(t,e,r){return KJ(e,t)*(r[1]-r[0])+r[0]}function Ewt(t,e,r){let i=0;if(!e.some(n=>!!n.materialReference&&(i+=n.numGeometries,i>=bwt)))return Iwt.compute(t,e);const s=jR();return r.forAll(n=>AE(s,Cwt(t,n))),s}function Cwt(t,e){if(!e.visible)return;const r=jR(),i=e.getSpatialQueryAccelerator();return i?Awt(r,t,i):Pwt(r,t,e.objects),r}function Awt(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<wwt)LF(oh,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,op.DepthOrder.FRONT_TO_BACK,oh,(l,c)=>{mW(t,e,l),oh.far=t.near,c.setRange(oh)},n,o),LF(oh,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,op.DepthOrder.BACK_TO_FRONT,oh,(l,c)=>{mW(t,e,l),oh.near=t.far,c.setRange(oh)},n,o);else{const l=Math.max(Math.min(a,xwt),Math.ceil(a*Twt)),c=r.findClosest(s,op.DepthOrder.FRONT_TO_BACK,n,o,l),u=r.findClosest(s,op.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(Jue(t,e,c.boundingVolumeWorldSpace.bounds),Jue(t,e,u.boundingVolumeWorldSpace.bounds))}}function Pwt(t,e,r){x2.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&x2.add(i)}),x2.empty||(x2.sort(e),LF(oh,e.near,Math.min(t.near,e.far)),x2.forEachInDepthRange(oh,op.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&mW(t,e,i)}),LF(oh,Math.max(t.far,e.near),e.far),x2.forEachInDepthRange(oh,op.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function mW(t,e,r){if(!r.visible||!y_(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=$wt;r.geometries.forEach(n=>{ri(s,i,n.transformation);const o=KS(s);LMe(t,e,n.boundingInfo,s,o)})}function LMe(t,e,r,i,s){if(r==null)return;Ge(Ba,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(Ba[0]-n[0])+o[1]*(Ba[1]-n[1])+o[2]*(Ba[2]-n[2]);if(Ba[3]=r.radius*s,!(a-Ba[3]>t.near&&a+Ba[3]<t.far)&&y_(e.frustum,Ba))if(r.radius>fW&&r.getChildren())for(const l of r.getChildren())LMe(t,e,l,i,s);else gW.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Jue(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let Mwt=class{constructor(){this._items=new kt({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===op.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.object,n.near,n.far)}}},Owt=class{constructor(){this._view=xe(),this._viewProj=xe(),this._frustum=dO(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Bs(this._view,e.viewMatrix),ri(this._viewProj,e.projectionMatrix,this._view),O5(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(p=>{p.materialReference&&p.forEachGeometry&&p.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;const g=f.boundingSphere,_=s*g[0]+n*g[1]+o*g[2]+a,v=_-g[3],b=_+g[3];this._geometries.push(f),this._near.push(-b),this._far.push(-v)})});const l=new cQ;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,h=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[h++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,f)=>this._near[p]<this._near[f]?-1:this._near[p]>this._near[f]?1:0),this._farCandidates.sort((p,f)=>this._far[p]<this._far[f]?1:this._far[p]>this._far[f]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const f=this._nearCandidates[p];if(this._near[f]<l.near){const g=this._geometries[f],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const f=this._farCandidates[p];if(this._far[f]>l.far){const g=this._geometries[f],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;Ge(Ba,s,r);const n=KS(r),o=Ba[0],a=Ba[1],l=Ba[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const h=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=h+c;if(!(-(h-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>fW){const f=e.getChildren();if(f!==void 0){for(const g of f)this._includeNearBoundingInfoRec(g,r,i);return}}gW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;Ge(Ba,n,r);const o=KS(r),a=Ba[0],l=Ba[1],c=Ba[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const h=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-h<=i.far))if(-h<this._looseRange.far)i.far=-h;else{if(s>fW){const p=e.getChildren();if(p!==void 0){for(const f of p)this._includeFarBoundingInfoRec(f,r,i);return}}gW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},Rwt=class{constructor(){this._modelViewProj=xe(),this._clipPosition=[Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;ri(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],h=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*h+o[8]*p+o[12],c[1]=o[1]*u+o[5]*h+o[9]*p+o[13],c[2]=o[2]*u+o[6]*h+o[10]*p+o[14],c[3]=o[3]*u+o[7]*h+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[AB[l][0]],u=this._clipPosition[AB[l][1]],h=this._clipPosition[AB[l][2]],p=this._clipTriangle(c,u,h);let f=!0;for(let g=0;g<p.length;++g)if(p[g][3]>=2){f=!1;break}if(!f){a=!0;for(let g=0;g<p.length;++g){const _=p[g][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void ht(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),hX(Yt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const AB=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Ba=Vs(),$wt=xe(),oh=jR(),x2=new Mwt,Iwt=new Owt,gW=new Rwt;let Lwt=class{},Dwt=class extends Ci{constructor(){super(...arguments),this.textures=new Lwt}};function Nwt(){const t=new Or;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new wr("drawPosition",(e,r)=>Fwt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new at("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new at("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new at("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new am("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new am("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Fwt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;Jd(t.magnifier.position,Kue);const n=e.camera.screenToRender(Kue,kwt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return es(Uwt,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Kue=us(),kwt=mge(),Uwt=Yt();async function zwt(t){const e=me(()=>import("./mask-svg-cNit2NTT.js"),[]),r=me(()=>import("./overlay-svg-DioSRl-7.js"),[]),i=d0((await e).default,{signal:t}),s=d0((await r).default,{signal:t}),n={mask:await i,overlay:await s};return vt(t),n}let sT=class extends Me{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Dwt,this.events=new Gs,this.attributeLocations=new Map([[O.POSITION,0]]),this._tmpScreenPoint=us(),this._tmpRenderPoint=mge()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(he(()=>{var i;return(i=this._magnifier)==null?void 0:i.version},r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),Jd(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,h=.5*a,p=.5*a;l[0]=we(l[0],h,c-h-1),l[1]=we(l[1],p,u-p-1);const f=Math.floor(l[0]-h),g=Math.floor(l[1]-p),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,f,g,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(sr.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:Am(async s=>{const n=r==null||i==null?zwt(s):null,o=r!=null?d0(r,{signal:s}):n.then(l=>l.mask),a=i!=null?d0(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Im(e,_Z,this.attributeLocations,0,1),pipelineState:Nt({blending:Pc(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:qt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new oi;i.internalFormat=wt.RGBA,i.wrapMode=Xt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!lme(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Sr(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=wt.ALPHA,i.preMultiplyAlpha=!1;const n=new Sr(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=wt.RGBA,i.flipped=!1,{input:new Sr(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new Dr(e,Nwt(),this.attributeLocations)}};d([m()],sT.prototype,"_imageSources",void 0),d([m()],sT.prototype,"_imageLoadTask",void 0),d([m({readOnly:!0})],sT.prototype,"updating",null),sT=d([V("esri/views/3d/webgl-engine/lib/MagnifierHelper")],sT);let Bwt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new _a(new ArrayBuffer(4)),this._layerToOidToColor=new t1,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new t1,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){e&&r&&i&&s&&(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return zt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return ae.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;const i=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!i)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,i);if(!s){for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,i,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new _a(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid,i.graphicUid);s||ae.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid);const n=this._layerUidToId.get(i.layerUid);n||ae.getLogger(this).warn("no layerId found for uid "+i.layerUid),s&&n&&e.set(r,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:n})}return e}},DMe=class{constructor(e,r){this.key=e,this.free=r,this.incarnation=0,this._refCount=1}retain(){++this._refCount}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var PE;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(PE||(PE={}));let NMe=class extends DMe{constructor(e,r,i){super(e,i),this.attachment=r,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},Vwt=class extends NMe{constructor(e,r,i){super(e,r,i),this.attachment=r,this.type=PE.COLOR}},Que=class extends NMe{constructor(){super(...arguments),this.type=PE.DEPTH}},Gwt=class extends DMe{constructor(e,r,i,s,n,o){super(e,o),this.type=PE.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=r,this.fbo=i,this.acquireDepth=s,this.acquireColor=n}dispose(){this.fbo.dispose()}get usedMemory(){return this.fbo.usedMemory}get name(){return this._name}setName(e){this._name=e}getTexture(e=Ua.COLOR_ATTACHMENT0){var r,i;return e===uE?(r=this.fbo)==null?void 0:r.depthStencilTexture:(i=this.fbo)==null?void 0:i.getColorTexture(e)}getAttachment(e=Ua.COLOR_ATTACHMENT0){return e===uE?this._depth:this._colors.get(e)}attachDepth(e){return e==null||e.retain(),this.detachDepth(),e&&this.fbo.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this._depth=er(this._depth)}attachColor(e,r){return e.retain(),this.detachColor(r),this.fbo.attachColorTexture(e.attachment,r),this._colors.set(r,e),this}detachColor(e){this.fbo.detachColorTexture(e);const r=this._colors.get(e);this._colors.delete(e),r==null||r.release()}detachAll(){this._colors.forEach((e,r)=>this.detachColor(r)),this.detachDepth()}},PB=class{constructor(e,r){this._last=new kt,this._incarnation=0,this._cache=new UR(e,r)}destroy(){var e;(e=this._last)==null||e.forAll(r=>r.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var r;e&&!this._last?this._last=new kt:e||((r=this._last)==null||r.forAll(i=>i.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(r=>!(r.incarnation<this._incarnation)||(this._cache.put(r.key,r),!1))}frame(){++this._incarnation}pop(e){if(this._last){const r=this._last.find(i=>i.key===e);if(r)return this._last.removeUnordered(r),r}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((r,i)=>r+i.usedMemory,0))??0}},jwt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new PB(e.newCache,"FBOCache"),this._depthCache=new PB(e.newCache,"DepthAttachmentCache"),this._colorCache=new PB(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(r=>r.type===PE.FBO&&e(r.name,r.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,r)=>{var i;return e+("getTexture"in r?((i=r.getTexture())==null?void 0:i.usedMemory)??0:r.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,r,i,s=ji.RGBA){const n=MB(s,e,r);let o=this._cache.pop(n);return o?(o.retain(),o.setName(i)):o=new Gwt(n,i,new Np(this.rctx,{...ehe[s],width:e,height:r}),a=>{a??(a=Fo.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=ji.RGBA);const c=this._acquireColor(l,e,r,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)}),this._trackHandle(o)}acquireDepth(e,r,i,s){return this._acquireDepth(e,r,i,s)}_acquireDepth(e,r,i,s){const n=MB(e,r,i),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===Fo.DEPTH_STENCIL_TEXTURE?new Que(n,new Sr(this.rctx,{...the[e],width:r,height:i}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Que(n,new Mwe(this.rctx,{...the[e],width:r,height:i}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,r,i,s){const n=MB(e,r,i),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new Vwt(n,new Sr(this.rctx,{...ehe[e],width:r,height:i}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};function MB(t,e,r){return`${t}x${e}x${r}`}const WN=new oi;WN.pixelFormat=wt.RED,WN.internalFormat=tt.R8,WN.wrapMode=Xt.CLAMP_TO_EDGE;const YN=new oi;YN.pixelFormat=wt.RG,YN.internalFormat=tt.RG8,YN.wrapMode=Xt.CLAMP_TO_EDGE;const XN=new oi;XN.internalFormat=tt.RGBA4,XN.dataType=An.UNSIGNED_SHORT_4_4_4_4,XN.wrapMode=Xt.CLAMP_TO_EDGE;const FMe=new oi;FMe.wrapMode=Xt.CLAMP_TO_EDGE;const yP=new oi;yP.wrapMode=Xt.CLAMP_TO_EDGE,yP.samplingMode=Gt.LINEAR_MIPMAP_LINEAR,yP.hasMipmap=!0,yP.maxAnisotropy=8;const _P=new oi;_P.pixelFormat=wt.RED,_P.dataType=An.HALF_FLOAT,_P.internalFormat=tt.R16F,_P.samplingMode=Gt.NEAREST;const ZN=new oi;ZN.dataType=An.HALF_FLOAT,ZN.internalFormat=tt.RGBA16F,ZN.samplingMode=Gt.NEAREST;const ehe={[ji.RED]:WN,[ji.RG]:YN,[ji.RGBA4]:XN,[ji.RGBA]:FMe,[ji.RGBA_MIPMAP]:yP,[ji.R16F]:_P,[ji.RGBA16F]:ZN},vP=new oi;vP.pixelFormat=wt.DEPTH_STENCIL,vP.dataType=An.UNSIGNED_INT_24_8,vP.samplingMode=Gt.NEAREST,vP.wrapMode=Xt.CLAMP_TO_EDGE;const the={[Fo.DEPTH_STENCIL_TEXTURE]:vP,[Fo.DEPTH16_BUFFER]:new Pwe(ko.DEPTH_COMPONENT16,4)};var FO;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(FO||(FO={}));let my=class{constructor(e,r,i=FO.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new kt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===dt.NONE||(s.bindTechnique(l,r,e),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,p=h.length;if(c.indexType!==0){const f=JN.get(c.indexType);for(let g=0;g<p;g+=2){const _=h[g],v=h[g+1];s.drawElements(u.primitiveType,v,c.indexType,_*f)}}else for(let f=0;f<p;f+=2){const g=h[f],_=h[f+1];s.drawArrays(u.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===FO.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const JN=new Map;JN.set(Te.UNSIGNED_BYTE,1),JN.set(Te.UNSIGNED_SHORT,2),JN.set(Te.UNSIGNED_INT,4);let yW=class extends zXe{constructor(){super({}),this._passes=null,this.produces=new Map([[ue.OPAQUE_MATERIAL,e=>this._produces(e)],[ue.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[ue.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new gst,this._shadowPassParameters=new yst,this._highlightPassParameters=new _st,this._systems=new Set}initializeRenderContext(e){this._context=e;const r=e.renderContext.rctx,i=e.techniqueRepository;this._passes={materialOpaque:new my(r,i),materialTransparent:new my(r,i,FO.BackToFront),materialIntegratedMesh:new my(r,i),shadowMap:new my(r,i),highlight:new my(r,i),highlightIntegratedMesh:new my(r,i),highlightShadowMap:new my(r,i),defaultShadowMap:new my(r,i)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===k.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==k.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const r=e.output===k.Shadow||e.output===k.ShadowHighlight||e.output===k.ShadowExcludeHighlight?this._shadowPassParameters:e.output===k.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bindParameters;return this._updateParameters(i.camera,r,i.slot===ue.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){if(this._passes===null)return null;switch(e.bindParameters.slot){case ue.OPAQUE_MATERIAL:switch(e.output){case k.Color:case k.LinearDepth:case k.Normal:case k.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case k.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case k.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case k.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case k.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ue.TRANSPARENT_MATERIAL:switch(e.output){case k.Color:case k.Alpha:case k.LinearDepth:case k.Normal:case k.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ue.INTEGRATED_MESH:switch(e.output){case k.Color:case k.LinearDepth:case k.Normal:case k.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case k.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const r=new cQ;return this._systems.forEach(i=>AE(r,i.queryShadowCasterDepthRange(e))),r}_updateParameters(e,r,i){const s=e.viewInverseTransposeMatrix;te(OB,s[3],s[7],s[11]),RB.set(OB),ce(r.transformWorldFromViewTH,RB.high),ce(r.transformWorldFromViewTL,RB.low),ce(r.slicePlaneLocalOrigin,OB),kh(r.transformViewFromCameraRelativeRS,e.viewMatrix),Bs(r.transformProjFromView,e.projectionMatrix),r.identifier===vc.Material&&(this._materialPassParameters.transparent=i,Uh(rhe,r.transformViewFromCameraRelativeRS),ix(r.transformNormalViewFromGlobal,rhe))}};yW=d([V("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],yW);const OB=E(),rhe=xi(),RB=new R8;let Hwt=class{constructor(e){this._context=e,this._nodes=new kt}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),A5&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:r})=>r).join(", ")}`)}remove(e){this._nodes.remove(e),A5&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:r})=>r).join(", ")}`)}produces(e){return this._nodes.some(({produces:r})=>r===e)}require(e,r){return this._nodes.reduce((i,{consumes:s,produces:n})=>i+(s.required.includes(e)&&n===r?1:0),0)}optional(e,r){return this._nodes.reduce((i,{consumes:s,produces:n})=>{var o;return i+((o=s.optional)!=null&&o.includes(e)&&n===r?1:0)},0)}updateAnimation(){return this._nodes.reduce((e,r)=>r.updateAnimation()||e,!1)}render(e,r,i){const s=e.name,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0||(n.forEach(o=>{const a=[e];for(const l of o.consumes.required){if(l===s)continue;const c=r.get(l);if(!c)return void i(a);a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=r.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(e.release(),e=l,r.set(s,e))}catch(l){ae.getLogger(o).errorOnce(l)}i(a)}),this._context.rctx.enforceState()),e}},qwt=class{constructor(e){this._context=e,this._renderPlugins=new kt,this._slots=new Array,this._renderVersion=nm(0);for(let r=0;r<ue.MAX_SLOTS;++r)this._slots[r]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,r){const i=()=>{if(r!=null&&r.aborted)throw e.uninitializeRenderContext(),hr();this._renderPlugins.push(e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},s=e.initializeRenderContext(this._context,r);if(Rc(s))return s.then(i);i()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(r=>{const i=r.produces.get(e);i&&i(k.Color)&&(DH(r)&&r.prepareTechnique(this._context.renderContext),Rse(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const r=this._context.renderContext.output??k.Color,i=new Map;return this._slots[e].forEach(s=>{const n=s.produces.get(e);if(n&&n(r)&&(!s.isDecoration||this._context.renderContext.bindParameters.decorations!==Cl.OFF))if(DH(s)){const o=s.prepareTechnique(this._context.renderContext);o!=null&&i.set(s,o)}else if(Rse(s)){const o=s.prepareTechniques(this._context.renderContext);o!=null&&i.set(s,o)}else i.set(s,null)}),i}render(e,r=null,i=null){return this._getRenderables(e).forEach((s,n)=>i=n.renderNode(this._context.renderContext,s,r,i)),i}queryDepthRange(e){const r=new cQ;return this._renderPlugins.forAll(i=>{var n;const s=(n=i.queryDepthRange)==null?void 0:n.call(i,e);AE(r,s)}),r}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,r=k.Color){return this._slots[e].some(i=>{const s=i.produces.get(e);return!!s&&s(r)})}consumes(e){return this._renderPlugins.some(r=>r.consumes().required.includes(e))}getMaterialRenderer(e){return this._renderPlugins.find(r=>r.materialReference===e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Ur.None)}get usedMemory(){return this._renderPlugins.reduce((e,r)=>r.materialReference!==null?e:e+(r.usedMemory??0),0)}get test(){return{plugins:this._renderPlugins}}},nT=class extends ux{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=ua.None,this._blitConfiguration=new zF,this._blitParameters=new $8,this.produces=new Map([[ue.BLIT,()=>this._context!=null]])}consumes(){return Rxe}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,r,i,s){var a;const n=(a=i==null?void 0:i.get("composite-color"))==null?void 0:a.getTexture();if(!this._context||!n)return s;const o=this._context.techniqueRepository.acquire(pQ,this._blitConfiguration);return o!=null&&o.compiled?(e.rctx.bindFramebuffer(s==null?void 0:s.fbo),this._blitParameters.texture=n,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(o,e.bindParameters,this._blitParameters),e.rctx.screen.draw(),o.release(),s):(this._context.requestRender(),s)}};d([m()],nT.prototype,"_context",void 0),d([m()],nT.prototype,"opacity",void 0),d([m()],nT.prototype,"alphaMode",void 0),nT=d([V("esri.views.3d.webgl-engine.effects.blit.Blit")],nT);let gQ=class extends Ci{};function kMe(){const t=new Or,{outputs:e,fragment:r}=t;return t.include(Ta),r.uniforms.add(new Ch("textureInput",i=>i.input)),r.constants.add("sampleArea","int",Math.ceil(kO/2)),e.add("fragGrid","vec2"),r.code.add(x`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${x.int(Nd)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const Nd=32,kO=9,yQ=.4,Wwt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:gQ,blurSize:yQ,build:kMe,gridCellPixelSize:Nd,outlineSize:kO},Symbol.toStringTag,{value:"Module"}));function UMe(){const t=new Or,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new at("coverageTex",n=>n.coverageTexture),new ni("coverageRounding",n=>n.coverageRounding)),i.add(x`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new at("tex",n=>n.blurTexture),new at("highlightTexture",n=>n.highlightTexture),new wr("uColor",n=>n.color),new wr("haloColor",n=>n.haloColor),new wr("opacities",n=>es(Ywt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("inner","float",1-(kO-yQ)/kO),s.add(x`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Ywt=Yt(),Xwt=Object.freeze(Object.defineProperty({__proto__:null,build:UMe},Symbol.toStringTag,{value:"Module"}));let zMe=class BMe extends Gr{initializeProgram(e){return new Dr(e.rctx,BMe.shader.get().build(),Mr)}initializePipeline(){return Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt})}};zMe.shader=new Lr(Xwt,()=>me(()=>Promise.resolve().then(()=>OAt),void 0));let _Q=class extends Ci{constructor(){super(...arguments),this.blurSize=je()}};function VMe(){const t=new Or,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(O.POSITION,"vec2"),e.add(O.UV0,"vec2"),r.add("blurCoordinate","vec3"),i.uniforms.add(new at("coverageTex",n=>n.coverageTexture),new ni("coverageRounding",n=>n.coverageRounding)),i.code.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new tSe("blurSize",n=>n.blurSize),new Ch("tex",n=>n.blurInputTexture)),s.code.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const Zwt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:_Q,build:VMe},Symbol.toStringTag,{value:"Module"}));let GMe=class jMe extends Gr{initializeProgram(e){return new Dr(e.rctx,jMe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};GMe.shader=new Lr(Zwt,()=>me(()=>Promise.resolve().then(()=>RAt),void 0));let HMe=class qMe extends Gr{initializeProgram(e){return new Dr(e.rctx,qMe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};HMe.shader=new Lr(Wwt,()=>me(()=>Promise.resolve().then(()=>$At),void 0));let Jwt=class extends Ci{constructor(){super(...arguments),this.color=zt(1,0,1,1),this.haloColor=zt(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=ar(1,1)}},bP=class extends ux{constructor(e){super(e),this._context=null,this._passParameters=new Jwt,this._downsampleDrawParameters=new gQ,this._blurDrawParameters=new _Q,this._blurColorFormat=se("mac")?ji.RGBA:ji.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[ue.HIGHLIGHT,()=>!0]])}consumes(){return $xe}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(GMe)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(HMe)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(zMe)),this.addHandles([he(()=>this.view.highlightOptions.color,r=>{this._passParameters.color=uO(r??JAe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},si),he(()=>this.view.highlightOptions.haloColor,r=>{this._passParameters.haloColor=r!=null?uO(r):this._passParameters.color,this._context.requestRender()},si),he(()=>this.view.highlightOptions.haloOpacity,r=>{this._passParameters.haloOpacity=r??KAe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},si),he(()=>this.view.highlightOptions.fillOpacity,r=>{this._passParameters.fillOpacity=r??QAe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},si)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=er(this._blurTechnique),this._downsampleTechnique=er(this._downsampleTechnique),this._applyTechnique=er(this._applyTechnique),this._grid.coverage=er(this._grid.coverage),this._grid.vao=ft(this._grid.vao)}renderNode(e,r,i,s){var S,C;const n=(S=i==null?void 0:i.get("highlights"))==null?void 0:S.getTexture();if(!this._context||!n)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const o=e.bindParameters.camera,a=o.fullWidth,l=o.fullHeight,c=o.pixelRatio,u=Math.ceil(a/c),h=Math.ceil(l/c),p=this._context.fbos,f=p.rctx;this._gridUpdateResources(n),this._gridComputeCoverage(n,e.bindParameters),this._passParameters.highlightTexture=n,this._passParameters.coverageTexture=(C=this._grid.coverage)==null?void 0:C.getTexture();const{width:g,height:_}=n.descriptor;cr(this._passParameters.coverageRounding,g/(Math.ceil(g/Nd)*Nd),_/(Math.ceil(_/Nd)*Nd));const v=this._grid.vao;f.bindVAO(v);const b=p.acquire(u,h,"highlight blur",this._blurColorFormat);f.unbindTexture(b.fbo.colorTexture),f.bindFramebuffer(b.fbo),f.setClearColor(0,0,0,0),f.clearSafe(Si.COLOR_BUFFER_BIT),f.setViewport(0,0,u,h),this._blurDrawParameters.blurInputTexture=n,cr(this._blurDrawParameters.blurSize,1/u,0);const w=f.bindTechnique(this._blurTechnique,e.bindParameters,this._passParameters,this._blurDrawParameters);f.drawArrays(this._blurTechnique.primitiveType,0,Hg(v,"geometry"));const T=p.acquire(u,h,"highlight blur",this._blurColorFormat);f.unbindTexture(T.fbo.colorTexture),f.bindFramebuffer(T.fbo),f.setClearColor(0,0,0,0),f.clearSafe(Si.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=b.getTexture(),cr(this._blurDrawParameters.blurSize,0,1/h),w.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),f.drawArrays(this._blurTechnique.primitiveType,0,Hg(v,"geometry")),f.bindFramebuffer(s==null?void 0:s.fbo),f.setViewport4fv(o.fullViewport),this._passParameters.blurTexture=T.getTexture(),f.bindTechnique(this._applyTechnique,e.bindParameters,this._passParameters),f.drawArrays(this._applyTechnique.primitiveType,0,Hg(v,"geometry")),b.release(),T.release()}_gridUpdateResources(e){var p;if(!this._context)return;const r=this._context.fbos.rctx,i=this._grid,s=Math.ceil(e.descriptor.height/Nd),n=Math.ceil(e.descriptor.width/Nd);if(i.vao&&i.verticalCellCount===s&&i.horizontalCellCount===n)return;i.verticalCellCount=s,i.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let h=0;for(let f=0;f<o;f++)for(let g=0;g<a;g++)u[h++]=(g-.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g-.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g-.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l;(p=i.vao)==null||p.dispose(),i.vao=new Dp(r,Mr,{geometry:vR},{geometry:qr.createVertex(r,Pr.STATIC_DRAW,u)})}_gridComputeCoverage(e,r){var l;if(!this._context)return;const i=this._context.fbos.rctx,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/Nd),a=Math.ceil(n.height/Nd);this._downsampleDrawParameters.input=e,(l=s.coverage)==null||l.release(),s.coverage=this._context.fbos.acquire(o,a,"highlight coverage",ji.RG),i.unbindTexture(s.coverage.fbo.colorTexture),i.bindFramebuffer(s.coverage.fbo),i.bindTechnique(this._downsampleTechnique,r,this._passParameters,this._downsampleDrawParameters),i.setViewport(0,0,o,a),i.screen.draw()}get test(){return{coverage:this._grid.coverage}}};d([m()],bP.prototype,"_context",void 0),d([m()],bP.prototype,"view",void 0),bP=d([V("esri.views.3d.webgl-engine.effects.highlight.Highlight")],bP);let vQ=class extends zl{constructor(){super(...arguments),this.receiveShadows=!0}};d([G()],vQ.prototype,"receiveShadows",void 0);const Kwt=.99999,Qwt=.025;function WMe(t){const e=new Or;e.include(DR,t),e.include(l8),e.include(Ta);const r=e.fragment;return r.include(Yh),r.include(bm),r.uniforms.add(new at("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(Hw.ExcludeHighlight)),new at("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(Hw.Highlight)),new at("depthMap",(i,s)=>{var n;return(n=s.linearDepth)==null?void 0:n.getTexture()}),new at("highlightTexture",i=>i.highlight),new wr("uColor",i=>i.shadowColor),new ni("nearFar",(i,s)=>s.camera.nearFar),new Ie("opacity",i=>i.shadowOpacity),new Ie("occludedOpacity",i=>i.occludedShadowOpacity),new Ie("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Dt("lightingMainDirectionView",(i,s)=>fe(she,Ge(she,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new is("inverseViewMatrix",(i,s)=>cn(ihe,Fl(ihe,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",xJ),r.code.add(x`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${x.float(Kwt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${x.float(Qwt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const ihe=xe(),she=E(),ext=Object.freeze(Object.defineProperty({__proto__:null,build:WMe},Symbol.toStringTag,{value:"Module"}));let txt=class extends LJ{constructor(){super(...arguments),this.shadowColor=zt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},YMe=class XMe extends Gr{constructor(e){super(e,new vQ,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,XMe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:Po(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:qt,depthTest:null,depthWrite:null})}get primitiveType(){return sr.TRIANGLE_STRIP}};YMe.shader=new Lr(ext,()=>me(()=>Promise.resolve().then(()=>IAt),void 0));const rxt=.001953125,ixt=4e4,sxt=5e4;let oT=class extends ux{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new txt,this._shadowDifference=.2,this._context=null,this.produces=new Map([[ue.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return $xe}initializeRenderContext(e){this._context=e,this.addHandles([he(()=>this.view.highlightOptions.shadowOpacity,r=>{this._passParameters.shadowOpacity=r??tPe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},si),he(()=>this.view.highlightOptions.shadowDifference,r=>{this._shadowDifference=r??rPe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},si),he(()=>this.view.highlightOptions.shadowColor,r=>{this._passParameters.shadowColor=uO(r??ePe),this._updateMaxOpacity()},si)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(YMe))}renderNode(e,r,i,s){var l,c;const n=(l=i==null?void 0:i.get("highlights"))==null?void 0:l.getTexture();if(!this._context||!n||!this._isVisible)return;if(!((c=this._technique)!=null&&c.compiled))return void this._context.requestRender();const o=e.bindParameters;if(!o.shadowMap.enabled||!o.linearDepth)return;this._passParameters.highlight=n,this._passParameters.origin=o.camera.center;const a=e.rctx;a.bindFramebuffer(s==null?void 0:s.fbo),a.bindTechnique(this._technique,o,this._passParameters),a.screen.draw()}updateParameters(e,r){this._passParameters.opacityElevation=1-zM(ixt,sxt,e.relativeElevation);const i=this.viewingMode===Ne.Global?fe(nhe,e.center):te(nhe,0,0,1),s=de(i,r);this._passParameters.dayNightTerminator=zM(0,1,we(30*s,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=rxt}};d([m()],oT.prototype,"_context",void 0),d([m()],oT.prototype,"view",void 0),d([m()],oT.prototype,"viewingMode",void 0),oT=d([V("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],oT);const nhe=E(),T2={maxSearchSteps:8,maxDistanceAreaTex:16};function ZMe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("edgesTexture",e=>e.inputTexture),new at("areaTexture",e=>e.areaTexture),new at("searchTexture",e=>e.searchTexture)),t.fragment.code.add(x`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${x.int(T2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${x.int(T2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${x.int(T2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${x.int(T2.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${x.int(T2.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(T2.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const nxt=Object.freeze(Object.defineProperty({__proto__:null,build:ZMe},Symbol.toStringTag,{value:"Module"}));let JMe=class KMe extends Gr{initializeProgram(e){return new Dr(e.rctx,KMe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};JMe.shader=new Lr(nxt,()=>me(()=>Promise.resolve().then(()=>LAt),void 0));function QMe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("blendWeightsTexture",e=>e.inputTexture),new at("colorTexture",e=>e.color)),t.fragment.code.add(x`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const oxt=Object.freeze(Object.defineProperty({__proto__:null,build:QMe},Symbol.toStringTag,{value:"Module"}));let eOe=class tOe extends Gr{initializeProgram(e){return new Dr(e.rctx,tOe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};eOe.shader=new Lr(oxt,()=>me(()=>Promise.resolve().then(()=>DAt),void 0));const ohe={threshold:.05,localConstrastAdaption:2};function rOe(){const t=new Or;return t.include(Ta),t.fragment.uniforms.add(new at("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(x`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${x.float(ohe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${x.float(ohe.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const axt=Object.freeze(Object.defineProperty({__proto__:null,build:rOe},Symbol.toStringTag,{value:"Module"}));let iOe=class sOe extends Gr{initializeProgram(e){return new Dr(e.rctx,sOe.shader.get().build(),Mr)}initializePipeline(){return Nt({colorWrite:qt})}};iOe.shader=new Lr(axt,()=>me(()=>Promise.resolve().then(()=>NAt),void 0));let lxt=class extends Ci{},ob=class extends ux{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new lxt,this.produces=new Map([[ue.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return Rxe}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([he(()=>this.view.qualitySettings.antialiasingEnabled,()=>this.renderFeatureChanged(),si)])}renderFeatureChanged(){var e;this.view.qualitySettings.antialiasingEnabled||(e=this._context)!=null&&e.isFeatureEnabled(xn.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}async enable(){var r;if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique??(this._edgeTechnique=this._context.techniqueRepository.acquire(iOe)),this._blendTechnique??(this._blendTechnique=this._context.techniqueRepository.acquire(JMe)),this._blurTechnique??(this._blurTechnique=this._context.techniqueRepository.acquire(eOe)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await me(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(this._context,i,e),(r=this._context)==null||r.requestRender()}catch{}this._abortController=null}async _loadTextures(e,r,i){if(vt(i),!e)throw hr();const[s,n]=await Promise.allSettled([d0(r.areaTexture,{signal:i}),d0(r.searchTexure,{signal:i})]);vt(i),s.status==="fulfilled"&&n.status==="fulfilled"&&(this._areaTexture=ahe(e.fbos.rctx,Gt.LINEAR,wt.RGB,s.value),this._searchTexture=ahe(e.fbos.rctx,Gt.NEAREST,wt.LUMINANCE,n.value),this._isEnabled=!0)}_disposeTextures(){this._areaTexture=ft(this._areaTexture),this._searchTexture=ft(this._searchTexture)}disable(){this._abortController=Ja(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,r,i,s){var p,f,g,_;const n=(p=i==null?void 0:i.get("composite-color"))==null?void 0:p.getTexture();if(!(this._isEnabled&&this._context&&i&&n))return s;if(!((f=this._edgeTechnique)!=null&&f.compiled&&((g=this._blendTechnique)!=null&&g.compiled)&&((_=this._blurTechnique)!=null&&_.compiled)))return this._context.requestRender(),s;const o=n.descriptor.width,a=n.descriptor.height,l=this._context.fbos,c=e.rctx;c.setViewport(0,0,o,a);const u=l.acquire(o,a,"smaa edges",ji.RG);c.unbindTexture(u.fbo.colorTexture),c.bindFramebuffer(u.fbo),c.setClearColor(0,0,0,1),c.clear(Si.COLOR_BUFFER_BIT),this._smaaParameters.color=n,c.bindTechnique(this._edgeTechnique,null,this._smaaParameters),c.screen.draw();const h=l.acquire(o,a,"smaa blend");return c.unbindTexture(h.fbo.colorTexture),c.bindFramebuffer(h.fbo),c.setClearColor(0,0,1,1),c.clear(Si.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=u.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(this._blendTechnique,null,this._smaaParameters),c.screen.draw(),c.bindFramebuffer(s==null?void 0:s.fbo),u.release(),c.setClearColor(0,1,0,1),c.clear(Si.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=h.getTexture(),c.bindTechnique(this._blurTechnique,null,this._smaaParameters),c.screen.draw(),h.release(),s}};function ahe(t,e,r,i){const s=new oi;return s.pixelFormat=r,s.wrapMode=Xt.CLAMP_TO_EDGE,s.width=i.width,s.height=i.height,s.samplingMode=e,new Sr(t,s,i)}d([m()],ob.prototype,"view",void 0),d([m()],ob.prototype,"_context",void 0),d([m()],ob.prototype,"_abortController",void 0),d([m({readOnly:!0})],ob.prototype,"updating",null),ob=d([V("esri.views.3d.webgl-engine.effects.smaa.SMAA")],ob);let cxt=class{constructor(){this._step=uhe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,se("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=lhe+hxt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=lhe?dxt:1}const i=we(e/uxt,uhe,fxt);this._step===1/0?this._step=i:this._step=this._step*che+i*(1-che)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const uxt=.5,lhe=12e4,hxt=1e4,dxt=10,che=.9,pxt=30,uhe=1e3/1,fxt=1e3/pxt;let mxt=class{constructor(e,r){this._fbos=e,this.compositingHelper=r,this._width=4,this._height=4,this._clearColor=Yt()}dispose(){this._color=er(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,r,i){this._fbos.interactive=i===Wd.Default;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,kb(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),xh(this._clearColor,r),n}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=er(this._depth)}renderHUDVisibility(e,r,i){return(e==null?void 0:e.fbo.width)===this._width&&(e==null?void 0:e.fbo.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",ji.RGBA4)),e.attachDepth(i||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(gxt),r(),e.detachDepth(),e}compositeToHUDVisibility(e,r){var i;this._fbos.rctx.bindFramebuffer((i=e.hudVisibility)==null?void 0:i.fbo),this.compositingHelper.compositeHUD(e,r)}renderOITPass(e,r,i){let s,n;const{_width:o,_height:a}=this;switch(r){case dt.Color:s=this._fbos.acquire(o,a,i?"oit hud color":"oit color",ji.RGBA16F),n=[0,0,0,0];break;case dt.Alpha:s=this._fbos.acquire(o,a,i?"oit hud alpha":"oit alpha",ji.R16F),n=[1,1,1,1];break;case dt.FrontFace:s=this._fbos.acquire(o,a,i?"oit hud front":"oit front"),n=[0,0,0,0]}return i?s.acquireDepth(Fo.DEPTH16_BUFFER):s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.clearFramebuffer(n,i,i),e(),s.detachDepth(),s}compositeToFramebuffer(e,r,i,s){this.bindFbo(),this.compositingHelper.composite(e,r,i,s)}compositeTransparentOntoOpaque(e,r,i,s,n){n?(this._fbos.rctx.bindFramebuffer(n.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(Si.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,r.getTexture(),i.getTexture(),s.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,r,i,s,n=ji.RGBA,o=Fo.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){return(e==null?void 0:e.fbo.width)===a&&(e==null?void 0:e.fbo.height)===l||(e=er(e)),e=e??this._fbos.acquire(a,l,r,n),c==null||c.forEach(u=>e.acquireColor(u.attachment,u.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(s,!0,!0),i(),e}renderToTargets(e,r,i,s,n=!1,o=!1){this._bindTarget(r,i),this._fbos.rctx.clearFramebuffer(s,n,o),e(),r.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const r=this._fbos.rctx;r.setClearStencil(0),r.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),r.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT)}}_bindTarget(e,r){e.attachDepth(r),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e,r){const i=this._ensureColor();i.attachDepth(this.depth),i.setName(r),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Fo.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const gxt=[0,1,0,1],HR=255,yxt=1/HR;function nOe(t){const e=new Or,r=e.fragment;return r.include(Yh),r.include(bm),e.include(l8),e.include(Ta),e.include(DR,t),r.uniforms.add(new at("shadowMap",(i,s)=>s.shadowMap.depthTexture),new at("depthMap",(i,s)=>{var n;return(n=s.linearDepth)==null?void 0:n.getTexture()}),new is("inverseViewMatrix",(i,s)=>cn(hhe,Fl(hhe,s.camera.viewMatrix,s.camera.center))),new ni("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",yxt),e.outputs.add("sampleCount","float"),r.code.add(x`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const hhe=xe(),_xt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:HR,build:nOe},Symbol.toStringTag,{value:"Module"}));var ME;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(ME||(ME={}));let _W=class extends zl{constructor(){super(...arguments),this.visualization=ME.Gradient,this.bandsEnabled=!1}};d([G({count:ME.COUNT})],_W.prototype,"visualization",void 0),d([G()],_W.prototype,"bandsEnabled",void 0);let bQ=class extends Ci{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=uR(vxt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const vxt=zt(.01,0,.25,1);function oOe(t){const e=new Or,r=e.fragment;r.include(Yh),r.include(bm),e.include(l8),e.include(Ta);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",HR),r.uniforms.add(new at("shadowCastMap",a=>a.shadowCastMap),new Ie("sampleScale",a=>a.sampleScale),new Ie("opacityFromElevation",a=>a.opacityFromElevation),new wr("uColor",a=>a.color));const n=i===ME.Gradient,o=i===ME.Threshold;return n&&s?r.uniforms.add(new Ie("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ie("threshold",a=>a.threshold)),r.code.add(x`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?x`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
    }
  `),e}const bxt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:bQ,build:oOe},Symbol.toStringTag,{value:"Module"}));let aOe=class lOe extends Gr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,lOe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:wu,colorWrite:qt,depthTest:null,depthWrite:null})}get primitiveType(){return sr.TRIANGLE_STRIP}};aOe.shader=new Lr(bxt,()=>me(()=>Promise.resolve().then(()=>FAt),void 0));const wxt=4e4,xxt=5e4,cOe=1/512;let KN=class extends Me{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new bQ(this._data),this._techniqueConfig=new _W,this._enabled=!1,this._vao=Im(r)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=ft(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(aOe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,e,this._passParameters),this._rctx.drawArrays(r.primitiveType,0,Hg(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>cOe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;eS(e,r)||(xh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],KN.prototype,"opacityFromElevation",null),KN=d([V("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],KN);let uOe=class hOe extends Gr{constructor(e){super(e,new vQ,()=>this.destroy())}initializeProgram(e){return new Dr(e.rctx,hOe.shader.get().build(this.configuration),Mr)}initializePipeline(){return Nt({blending:Po(Ee.ONE,Ee.ONE,Ee.ONE,Ee.ONE),colorWrite:qt,depthTest:null,depthWrite:null})}get primitiveType(){return sr.TRIANGLE_STRIP}};uOe.shader=new Lr(_xt,()=>me(()=>Promise.resolve().then(()=>kAt),void 0));let _l=class extends Me{constructor(e,r,i,s,n,o){super({}),this.fbos=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new LJ,this._cachedLightDirections=[],this._depthRange=uW,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new $k(new sK(e,i.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=Im(this._rctx),this._accumulationRenderer=new KN(r,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(yt.SHADOW_ACCUMULATOR,this),he(()=>i.renderView,l=>{this.removeHandles(dhe),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),dhe)},si),he(()=>this._previewing,()=>this._requestRenderIfEnabled(),ti)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=ft(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=ft(this._fbo),this._vao=ft(this._vao),this._accumulationTechniqueCached=er(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new uOe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){var e;return((e=this._bindParameters.linearDepth)==null?void 0:e.getTexture())!==null&&this._depthRange!==uW&&this._opacityFromElevation>cOe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(e0(r,e,ww))return;const i=Math.min(HR,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=ce(r[s]??E(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Txt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,wt.RED,An.UNSIGNED_BYTE,phe),phe[0]/this._progress)}_enable(){this._progress=0;const e=new oi;e.pixelFormat=wt.RED,e.internalFormat=tt.R8,e.wrapMode=Xt.CLAMP_TO_EDGE,this._fbo=new Np(this._rctx,e),this._requestRender()}_disable(){this._fbo=ft(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Hg(this._vao,"geometry"))}_updateCamera(e){const r=this._fbo;if(r==null)return;const i=this._bindParameters.camera;e.equals(i)||i.copyFrom(e),r.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-zM(wxt,xxt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};d([m()],_l.prototype,"_progress",void 0),d([m()],_l.prototype,"_sampleCount",void 0),d([m()],_l.prototype,"_fbo",void 0),d([m()],_l.prototype,"_depthRange",void 0),d([m()],_l.prototype,"_previewing",void 0),d([m()],_l.prototype,"_accumulationRenderer",void 0),d([m()],_l.prototype,"_isRefining",null),d([m()],_l.prototype,"_isActive",null),d([m()],_l.prototype,"canAccumulate",null),d([m()],_l.prototype,"_isDoneAccumulating",null),d([m()],_l.prototype,"_opacityFromElevation",null),d([m()],_l.prototype,"running",null),_l=d([V("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],_l);const Txt=6,dhe="renderView",phe=new Uint8Array(1),fhe=y0();let Sxt=class{constructor(){this._plane=y0()}get isEnabled(){return!Vye(this.plane,fhe)}get plane(){return this._plane}set plane(e){tx(e||fhe,this._plane)}};function Ext(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function Cxt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let Axt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Pxt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Bs(r.viewMatrix,e),Cxt(r.origin.vec3,r.viewMatrix)})}},Pxt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=xe()}},Mxt=class extends Zwe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=xi()}},Oxt=class extends Jwe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=xi(),this.slicePlaneLocalOrigin=E(),this.transformNormalGlobalFromModel=xi()}};function Rxt(t){const e=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const $xt=ar(.5,-4e-4);function Ixt(t,e){const r=t.vertex;r.include(Rxt),r.constants.add("depthBias","vec2",$xt),r.uniforms.add(new ni("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new is("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Mu("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new is("transformProjFromView",i=>i.transformProjFromView)),r.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Lxt(t){const e=t.fragment;e.constants.add("coverageTestThreshold","float",.01),e.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`)}function Dxt(t,e){const r=t.vertex;e.silhouette?(r.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 viewNormalA = _modelToViewNormal(data.normal);
vec3 viewNormalB = _modelToViewNormal(data.normal2);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 worldNormalA = _modelToWorldNormal(data.normal);
vec3 worldNormalB = _modelToWorldNormal(data.normal2);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
return false;
}`)}function Nxt(t,e){const r=t.vertex;r.include(Yh),t.include(cC,e),r.uniforms.add(new Ie("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Ch("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(O.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*uQ),r.code.add(x`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?x`decompressNormal(normal2Compressed)`:x`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?r.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new I5("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMAL2COMPRESSED,"vec2"),r.code.add(x`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):r.code.add(x`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?r.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include($Z,e),r.uniforms.add(new Mu("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new I5("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new bu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new bu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Dt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Dt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new is("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Fxt(t){return t.mode===En.SKETCH||t.mode===En.MIXED}var En,Ab;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(En||(En={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Ab||(Ab={}));function wQ(t,e){const r=t.vertex;switch(t.attributes.add(O.SIDENESS,"vec2"),e.mode===En.MIXED?r.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case En.MIXED:r.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case En.SKETCH:r.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case En.SOLID:r.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case En.COUNT:break;default:e.mode}}function kxt(t,e){const r=t.vertex;switch(t.include(wQ,e),e.mode){case En.SOLID:r.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case En.SKETCH:r.uniforms.add(new lw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case En.MIXED:r.uniforms.add(new lw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Uxt(t,e){t.include(wQ,e);const{vertex:r,fragment:i}=t;switch(Fxt(e)&&(r.uniforms.add(new Ch("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new lw("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new lw("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Ch("strokesTexture",s=>s.strokesTexture.texture),new lw("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(x`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Yh),i.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case En.SOLID:r.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case En.SKETCH:r.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case En.MIXED:t.varyings.add("vType","float"),r.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function dOe(t){const e=new Or,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new mhe("model"),new mhe("localView")),e.include(Ixt,t),e.include(Nxt,t),e.include(kxt,t),e.include(wQ,t),e.include(Uxt,t),e.include(Rs,t),e.include(Dxt,t),e.include(Lxt,t),e.include(Oc,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new ni("pixelToNDC",(s,n)=>cr(zxt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new wr("viewport",(s,n)=>n.camera.fullViewport),new Ie("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(O.POSITION0,"vec3"),e.attributes.add(O.POSITION1,"vec3"),e.attributes.add(O.VARIANTOFFSET,"float"),e.attributes.add(O.VARIANTSTROKE,"float"),e.attributes.add(O.VARIANTEXTENSION,"float"),r.code.add(x`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      const float aaPaddingPixels = 1.0;

      // Line size with padding
      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===En.SKETCH?x`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===En.MIXED?x`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0, component)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(component), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const zxt=je();let mhe=class extends ps{constructor(e){super(e,"mat4")}};const Bxt=Object.freeze(Object.defineProperty({__proto__:null,build:dOe},Symbol.toStringTag,{value:"Module"}));let pOe=class fOe extends Gr{initializeProgram(e){return new Dr(e.rctx,fOe.shader.get().build(this.configuration),xMe)}initializePipeline(e){return Nt({blending:Po(Ee.ONE,Ee.ONE,Ee.ZERO,Ee.ONE,wm.ADD,e.rctx.gl.MAX),depthTest:{func:Qr.LEQUAL},colorWrite:qt})}};pOe.shader=new Lr(Bxt,()=>me(()=>Promise.resolve().then(()=>UAt),void 0));let Rd=class extends Za{constructor(){super(...arguments),this.mode=En.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};d([G({count:En.COUNT})],Rd.prototype,"mode",void 0),d([G()],Rd.prototype,"hasSlicePlane",void 0),d([G()],Rd.prototype,"silhouette",void 0),d([G()],Rd.prototype,"legacy",void 0),d([G()],Rd.prototype,"doublePrecisionRequiresObfuscation",void 0),d([G()],Rd.prototype,"multipassEnabled",void 0),d([G()],Rd.prototype,"cullAboveGround",void 0),d([G()],Rd.prototype,"spherical",void 0),d([G({constValue:!1})],Rd.prototype,"occlusionPass",void 0),d([G({constValue:Ir.Compressed})],Rd.prototype,"normalType",void 0);const Vxt=8,$B=128,Gxt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},jxt={solid:En.SOLID,sketch:En.SKETCH,uber:En.MIXED};let IB=class mOe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new Rd,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Wt.TRANSPARENT]:{[Wt.TRANSPARENT]:new kt,[Wt.OPAQUE]:new kt},[Wt.OPAQUE]:{[Wt.TRANSPARENT]:new kt,[Wt.OPAQUE]:new kt}},this._renderablesDirty=!1,this._drawParameters=new Oxt,this._settings={...Gxt,...i},this.key=mOe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:yi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=jxt[this._settings.type],this._configuration.silhouette=!1,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=er(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables();const i=this._sortedRenderables[r];i[Wt.TRANSPARENT].forAll(e),i[Wt.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(pOe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),r,e)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),r,e)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.drawArraysInstanced(sr.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new R8(r.transform.position),o=Uh(ghe,ix(ghe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;te(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Wt.TRANSPARENT][Wt.TRANSPARENT].clear(),this._sortedRenderables[Wt.TRANSPARENT][Wt.OPAQUE].clear(),this._sortedRenderables[Wt.OPAQUE][Wt.TRANSPARENT].clear(),this._sortedRenderables[Wt.OPAQUE][Wt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Wt.INVISIBLE&&r.edgeTransparency!==Wt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Wt.TRANSPARENT][Wt.TRANSPARENT].sort(e),this._sortedRenderables[Wt.TRANSPARENT][Wt.OPAQUE].sort(e),this._sortedRenderables[Wt.OPAQUE][Wt.TRANSPARENT].sort(e),this._sortedRenderables[Wt.OPAQUE][Wt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const ghe=um();function gGt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new zYe(t.layout)}}function VL(t){return new pxe(t.layout).createView(t.buffer)}let Hxt=class extends uPe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return owt(e);const s=await this.invoke(new LB(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new LB(e),r);return VL(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new LB(e),r);return VL(i)}_unpackOutput(e){return{regular:{instancesData:VL(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:VL(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},LB=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Oh(e.indices)?e.indices:e.indices.buffer,this.indicesType=Oh(e.indices)?"Array":o6(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function qxt(t){const r=C3.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=C3.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=C3.strokes.length;let h=(c-1)*u*l;for(const{distance:f,pressure:g}of C3.strokes){let _=f,v=g,b=h;for(let w=0;w<c;w++){w!==0&&(_=yhe(_,UO.DISTANCE),v=yhe(v,UO.PRESSURE));for(let T=0;T<C3.resolution;T++){const S=.5+(_?_[T%_.length]/a:0),C=v?v[T%v.length]:1;CO(S,s,b),CO(C,s,b+n),b+=4}b-=l*(u+1)}h+=l}const p=new Sr(t,new oi(r),s);return new Yxt(r,a,o,u,p)}function yhe(t,e){if(!t)return null;const r=t.length/2,i=Wxt*r,s=new Array(r);let n=0;const o=e===UO.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*_he):Math.min(i,l*_he)}return s}var UO;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(UO||(UO={}));const Wxt=.1,_he=.5;let Yxt=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=ft(this.texture)}};const C3={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function vhe(t){let e=null;for(const r of t){const i=r.type;if(Xxt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function bhe(t){let e=Wt.INVISIBLE;for(const{material:r}of t)if(gOe(r)){if(r.color[3]*r.opacity<1)return Wt.TRANSPARENT;e=Wt.OPAQUE}return e}function whe(t){let e=Wt.INVISIBLE;for(const{material:r}of t)if(gOe(r)){switch(r.objectTransparency){case Wt.TRANSPARENT:case Wt.INVISIBLE:return Wt.TRANSPARENT;case Wt.OPAQUE:if(r.opacity<1)return Wt.TRANSPARENT}e=Wt.OPAQUE}return e}function gOe(t){return t.size*t.color[3]*t.opacity>0}function Xxt(t){return t.size*t.color[3]>0}function xhe(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let $d=class extends Me{constructor(t){super(t),this._updatingHandles=new mp,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=E(),this._localOrigins=new Axt(new iK(t.renderSR))}initialize(){this._worker=new Hxt(this.schedule),this._componentColorManager=new EMe(this.rctx,3);const t=wMe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=qr.createVertex(this.rctx,Pr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=ft(this._strokesTexture),this._componentColorManager=Ae(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=ft(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",e2t))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,s,n){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let o;const a=new She(new Promise(c=>o=c),t.obb.center,t.obb.radius);this._perObjectData.set(t,a);const l=await this._updatingHandles.addPromise(this._addComponentGeometry(t.transform,a,e,r,i,s,n));return this.setNeedsRender(),o(),l}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void ae.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new She(new Promise(c=>n=c),o,Gg(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&Zxt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}fastUpdateObject3DEdgesTransform(t){if(this.destroyed)return!1;const e=this._perObjectData.get(t);if(!e)return!1;const{geometries:r}=t,{renderables:i}=e;if(r.length===0||i.length===0)return!0;if(i.length>1)return!1;const[s]=i,n=s.transform;if(!(n instanceof DB))return!1;const[o]=r;if(o.localOrigin!==n.origin.origin)return!1;const a=xe(),l=this._computeModelTransformWithLocalOrigin(t,o,a);return s.transform=new DB(a,l),this.setNeedsRender(),!0}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?s=>e[s]:()=>e;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const s=t instanceof P0,n=!!r.hasSlicePlane,o=vhe(e),a=IB.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),h=this._acquireRenderer(o,n,s);u.removeRenderable(c),--u.refCount,c.rendererKey=a,h.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=E(),s=new R8;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)return this._renderers.delete(l.key),void l.dispose();let c=!0,u=!0;l.forEachRenderable(h=>{h.visible&&(n+=h.statistics.averageEdgeLength,o++,c&&h.regular&&(l.updateTechnique(t,!1),c=!1),u&&h.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Mxt(40*n/o,e);te(i,r[3],r[7],r[11]),s.set(i),ce(a.transformWorldFromViewTH,s.high),ce(a.transformWorldFromViewTL,s.low),kh(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Uh(Phe,a.transformViewFromCameraRelativeRS),ix(a.transformNormalViewFromGlobal,Phe),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=bhe(t.components.meta),r=whe(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedShaderTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(te(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,Ext(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=we(Math.round(n.size*Vxt),0,255),l=we(n.extensionLength,-$B,255-$B)+$B,c=n.type==="solid"?UF.SOLID:UF.SKETCH,u=255*n.opacity,h=n.color,p=255*h[0],f=255*h[1],g=255*h[2],_=255*h[3];r.textureBuffer.setData(o,0,p,f,g,_),r.textureBuffer.setData(o,1,a,l,c,u),gMe(e[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const i=new Jxt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,s){const n=c=>this._verticesBufferObject!=null?new Kxt(new Dp(this.rctx,xMe,{vertices:Xbt,instances:c===Ab.REGULAR?FF.glLayout:kF.glLayout},{vertices:this._verticesBufferObject,instances:qr.createVertex(this.rctx,Pr.STATIC_DRAW,c===Ab.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===Ab.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(Ab.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(Ab.SILHOUETTE):null,l=((o==null?void 0:o.vao.usedMemory)??0)+((a==null?void 0:a.vao.usedMemory)??0);return new Qxt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},r,bhe(e.meta),whe(e.meta),e,i)}async _addGeometry(t,e,r,i,s,n){if(r.edgeIndicesLength<=0)return;const o=r.attributes.get(O.POSITION),a=xe(),l=this._computeModelTransformWithLocalOrigin(t,r,a),c=new Ahe(o,a,l);return this._addPositionData(e,c,r.edgeIndicesLength,i,s,n)}async _addPositionData(t,e,r,i,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.position.indices,h=e.position,p=h.data.length/h.size,f=DF.createBuffer(p);for(let v=0;v<p;v++)f.position.set(v,0,h.data[v*h.size]),f.position.set(v,1,h.data[v*h.size+1]),f.position.set(v,2,h.data[v*h.size+2]);xhe(o.meta,[0,f.componentIndex.count],f.componentIndex);const g=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,f,!1,n,u,r));if(t.loaded==null)return;const _=this._createRenderable(g,o,new DB(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(a==null)return 0;const l=vhe(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=DF.createBuffer(r.length/3);VR(u.position.typedBuffer,r,u.position.typedBufferStride,3),xhe(a.meta,s,u.componentIndex,i);const h=!0,p=c.writerSettings,f=await this._updatingHandles.addPromise(this._extractEdges(p,u,h,!1,i));if(e.loaded==null)return 0;const g=this._createRenderable(f,a,t,c.key,!0);return e.renderables.push(g),c.addRenderable(g),g.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,s){const n=new Map;let o=0,a=null,l=0;const c=t.geometries.filter(w=>{if(w.edgeIndicesLength<=0||!w.material.supportsEdges)return!1;!a&&w.localOrigin&&(a=w);const T=w.attributes.get(O.POSITION);return l+=T.data.length/T.size,o+=w.edgeIndicesLength,!0});if(c.length===0)return;const u=l>=65536?Uint32Array:Uint16Array,h=o?new u(o):null,p=[];let f=0;c.forEach(w=>{const T=w.attributes.get(O.POSITION),S=T.indices;let C=n.get(T.data);if(C==null){C=p.length/3;for(let P=0;P<T.data.length;P+=T.size)p.push(T.data[P]),p.push(T.data[P+1]),p.push(T.data[P+2]);n.set(T.data,C)}for(let P=0;P<w.edgeIndicesLength;P++)h[f++]=C+S[P]});const g=a||t.geometries[0],_=xe(),v=this._computeModelTransformWithLocalOrigin(t,g,_);for(let w=0;w<t.geometries.length;w++)t.geometries[w].localOrigin=v.origin;const b=new Ahe(new qe(p,h,3),_,v);await this._updatingHandles.addPromise(this._addPositionData(e,b,h.length,r[0],i,s))}_acquireRenderer(t,e,r){const i=IB.getKey(t,e,r);let s=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=qxt(this.rctx)),s||(s=new IB(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===Ne.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(t){The(t.regular),The(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=E(),s=n=>{Hi(i,n.center,e);const o=de(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Ehe(o)||!o.visible)return;const a=GL(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(i,o,r,e,a)},s)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Che(o)||!o.visible)return;const a=GL(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(i,o,r,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(Ehe(o)&&(e=GL(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&Che(o)&&(e=GL(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{e||(i(s,Wt.OPAQUE),i(s,Wt.TRANSPARENT))}),e},getObjectData:t=>this._perObjectData.get(t)}}};function The(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function Zxt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!e0(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if((r==null?void 0:r.localOrigin)!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}d([m({constructOnly:!0})],$d.prototype,"rctx",void 0),d([m({constructOnly:!0})],$d.prototype,"renderSR",void 0),d([m({constructOnly:!0})],$d.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],$d.prototype,"techniqueRepository",void 0),d([m({constructOnly:!0})],$d.prototype,"setNeedsRender",void 0),d([m({constructOnly:!0})],$d.prototype,"schedule",void 0),d([m({readOnly:!0})],$d.prototype,"_updatingHandles",void 0),d([m({readOnly:!0})],$d.prototype,"updating",null),$d=d([V("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],$d);class She{constructor(e,r,i){this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)}),this.center=qi(r)}}class Jxt{constructor(e,r){this.buffer=e,this.meta=r}}class Kxt{constructor(e,r){this.vao=e,this.lod=r}}class DB{constructor(e,r){this.modelMatrix=e,this.origin=r}}class Qxt{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function Ehe(t){return t.regular!=null}function Che(t){return t.silhouette!=null}function GL(t,e,r){const i=e*r,s=U$e(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}let Ahe=class{constructor(e,r,i){this.position=e,this.modelTransform=r,this.origin=i}};const Phe=xi(),e2t=()=>Promise.reject();let Mhe=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},vg=!1;function t2t(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r?new Mhe(()=>t.createQuery(),i=>{t.deleteQuery(i),vg=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{vg||(vg=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),vg=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new Mhe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),vg=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{vg||(vg=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),vg=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function r2t(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new i2t(r,e)}let i2t=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){vg||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Pi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Pi||(Pi={}));const Ohe="Total";let s2t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Fg(Ohe),this._cpuTimeSamplers=new Map(Object.values(Pi).map(r=>[r,new Fg(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Fg("GPU"),this._gpuTimeSamplers=new Map(Object.values(Pi).map(r=>[r,new Fg(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const r=[...Object.values(Pi),Ohe];this._gpuTimerPool=r2t(this._rctx,r)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=ft(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const r=this._gpuTimerPool.stop(Pi.FINISH);this._gpuTimeSamplers.get(Pi.FINISH).record(r),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}};class aT{constructor(e,r,i,s,n,o,a,l){this._stage=e,this._techniqueRepository=s,this._rctx=n,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=c=>{},this._isRendering=!1,this._backgroundColor=zt(0,0,0,1),this._sliceHelper=new Sxt,this._state=nm(Br.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=ja.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new cxt,this._reprojectionMatrixVersion=nm(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new Map,this._releaseNormals=c=>{var u;(u=c.find(({name:h})=>h==="normals"))!=null&&u.release()&&this._pluginInput.delete("normals")},this._debugLinearDepth=!1,this.fboCache=new jwt(n),this._renderStateFeatures=nm(x9(!se("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new mxt(this.fboCache,this._compositingHelper),this.performanceInfo=new s2t(this._rctx),this._shadowMap=new sK(this.fboCache,e.viewingMode),this._highlight=new bP({view:e.view}),this._shadowHighlight=new oT({view:e.view,viewingMode:e.viewingMode}),this._shadowAccumulator=new _l(this.fboCache,s,e,c=>{const u=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(c.camera,c.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=u},(c,u,h)=>{const p=this._stage.view.qualitySettings.maximumPixelRatio;c.shadowMap.start(c.camera,u,h,!0,p),this._renderShadowCascades(k.Shadow,c.shadowMap),c.shadowMap.finish(),c.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(c.camera,c.contentCamera)},l),this._ssao=new $A({view:this._stage.view}),this._renderContext=new Vnt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new Hwt(this._renderContext),this._plugins=new qwt({renderContext:this._renderContext,techniqueRepository:s,textureRepository:i,materialRepository:r,requestRender:l,controller:e,fbos:this.fboCache,isFeatureEnabled:c=>this.isFeatureEnabled(c)}),this.renderPassManager=new yW,this._plugins.add(this.renderPassManager),this._smaa=new ob({view:this._stage.view}),this._plugins.add(this._smaa),this._blit=new nT({opacity:1,alphaMode:ua.None}),this._plugins.add(this._blit),this._plugins.add(this._ssao),this._plugins.add(this._highlight),this._plugins.add(this._shadowHighlight),this._handles=[he(()=>this._stage.view.state.camera,()=>l(),si),he(()=>yi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Wt.TRANSPARENT):()=>{},l()},ui),he(()=>{var c;return(c=this._stage.view.environment.background)==null?void 0:c.color},c=>{const u=c?uO(c):_u;es(this._backgroundColor,u[0]*u[3],u[1]*u[3],u[2]*u[3],u[3]),l()},si)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=wi(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._highlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Ae(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),vxe.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,r=!se("disable-feature:high-quality-idle")){this._renderStateFeatures.value=x9(r,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,r=this._state.value){return this._renderStateFeatures.value.get(r,e)??!1}setFeatureEnabled(e,r,i){this._renderStateFeatures.mutate(s=>s.set(r,e,i)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(xn.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(xn.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations}get hasHighlights(){return this._plugins.produces(ue.OPAQUE_MATERIAL,k.Highlight)||this._plugins.produces(ue.TRANSPARENT_MATERIAL,k.Highlight)||this._plugins.produces(ue.DRAPED_MATERIAL,k.Highlight)}get _magnifierEnabled(){return this._bindParameters.decorations===Cl.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(xn.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=er(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=er(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=er(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=er(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=er(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new $d({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:n2t(e)}),this._handles.push(he(()=>{var r;return(r=this._edgeView)==null?void 0:r.updating},()=>this._requestRender(),ti)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&q6(this._bindParameters.ssr.reprojectionMatrix,ts)}set _reprojectionMatrix(e){Ppe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s;const{_shadowMap:r,_bindParameters:i}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const n=e.environment.lighting.type!=="virtual";i.enableFillLights!==n&&(i.enableFillLights=n,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:s,updates:n}=e;if(i.length===0&&s.length===0&&n.length===0)return;const o=kEe(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const h=new uM({material:c});h.initializeRenderContext(this._plugins._context),u=h,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(h=>e.removes.removeUnordered(h)),l.adds.forEach(h=>e.adds.removeUnordered(h)),l.updates.forEach(h=>e.updates.removeUnordered(h)),r.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(ue.LINE_CALLOUTS_HUD_DEPTH)||this._plugins.produces(ue.HUD_MATERIAL)||this._plugins.produces(ue.LABEL_MATERIAL),e.water=this._plugins.produces(ue.DRAPED_WATER,k.Normal),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?wi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,r,i=Wd.Default,s=Cl.ON){this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(r),this.performanceInfo.advance(Pi.OVERLAY),this._renderContext.time=r,this._bindParameters.transparencyPassType=dt.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=s,this._bindParameters.mainColor=this._bindParameters.mainDepth=null;const u=y0(this._sliceHelper.plane);s===Cl.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const h=n.initializeFrame(o,this._backgroundColor,i);this.hasReflections?this._bindParameters.ssr.lastFrameColor=h:h==null||h.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this.performanceInfo.advance(Pi.PREPARE);const p=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(Pi.SHADOW_MAP),this._ensureBindParametersCamera(o,a);const f=this._plugins.produces(ue.OPAQUE_TERRAIN)&&(this._terrainTransparency===ja.Semitransparent||this._terrainTransparency===ja.TransparentWithDraped),g=this._highQualityTransparency&&f,_=this._plugins.produces(ue.TRANSPARENT_MATERIAL,k.Color);this._prepareShaders(g,_),this._pluginInput.set("normals",this._renderNormals()),this.performanceInfo.advance(Pi.NORMALS),this._renderSSAO(),this.performanceInfo.advance(Pi.SSAO),this._renderLinearDepth(),this.performanceInfo.advance(Pi.LINEAR_DEPTH),this._renderShadowAccumulation(p,o,a),this.performanceInfo.advance(Pi.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(r),this._renderContext.output=k.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture,this._renderOpaqueGeometry(),this._offscreen.updateColor(R=>this._invokeRenderNodes(R),"opaque-color"),this._plugins.render(ue.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(Pi.OPAQUE),this.fboCache.debugCallback&&this.fboCache.debugCallback("opaque-color",this._offscreen.color.fbo),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(Wt.OPAQUE),this.performanceInfo.advance(Pi.OPAQUE_EDGES),n.bindFbo(),this._plugins.render(ue.VOXEL),this.performanceInfo.advance(Pi.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOITPass(VT.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(R=>this._invokeRenderNodes(R),"transparent-color"),this.performanceInfo.advance(Pi.TRANSPARENT);const v=this._renderGeometryLinearDepth(g);this._renderHUDVisibility(v),g||this._plugins.render(ue.LINE_CALLOUTS),this.performanceInfo.advance(Pi.HUD_VISIBILITY);const b=i===Wd.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this.performanceInfo.advance(Pi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Wt.TRANSPARENT,v),v==null||v.release(),this.performanceInfo.advance(Pi.TRANSPARENT_EDGES);const w=f?this._renderTransparentTerrain():null;w&&this._bindParameters.hudVisibility&&(g?this._renderLineCallouts(sc.Occluded):n.compositeToHUDVisibility(this._bindParameters,w.getTexture()),this._renderHUD(sc.Occluded,n.color),this.performanceInfo.advance(Pi.HUD_OCCLUDED)),this.performanceInfo.advance(Pi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),w&&(n.compositeToFramebuffer(this._bindParameters,w.getTexture(),ua.PremultipliedAlpha,1),w.release(),g&&(this._renderEdges(Wt.OPAQUE),this.performanceInfo.advance(Pi.OPAQUE_EDGES),_&&(this._oitEnabled?this._renderOITPass(VT.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Pi.TRANSPARENT),this._renderEdges(Wt.TRANSPARENT),this.performanceInfo.advance(Pi.TRANSPARENT_EDGES))),this._bindParameters.ssao=er(this._bindParameters.ssao),g&&this._renderLineCallouts(sc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),n.bindFbo(),this._plugins.render(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._plugins.render(ue.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(Pi.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(Pi.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(Pi.OCCLUDED);let T=this._renderHighlightPrepass();T&&this._renderShadowHighlights(T,this._bindParameters);const S=this._magnifierEnabled&&i===Wd.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"magnifier"):null,C=i!==Wd.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"screenshot"):null,P=this._renderComposite(S??C,T)??C;return this.performanceInfo.advance(Pi.ANTIALIASING),this._renderHUD(sc.NotOccluded,P),this.performanceInfo.advance(Pi.HUD),T&&(this._renderHighlights(P,T,this._bindParameters),T=er(T)),this.performanceInfo.advance(Pi.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),P!==C&&(this._rctx.bindFramebuffer(C==null?void 0:C.fbo),this._compositingHelper.composite(this._bindParameters,S==null?void 0:S.getTexture(),ua.None)),i===Wd.Default&&(S==null||S.release()),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),i!==Wd.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:C,oid:b}}_prepareShaders(e,r){this._renderContext.output=k.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(ue.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(ue.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._plugins.prepare(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._plugins.prepare(ue.ENVIRONMENT_TRANSPARENT),this._plugins.prepare(ue.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!se("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,r=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return r.acquireDepth(Fo.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(k.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(r.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=sc.NotOccluded,this._plugins.render(ue.HUD_MATERIAL),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===Os.BACKGROUND;if(i||r){const s=i?this.performanceInfo.elapsedTime:0,n=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){var a;const s=(a=this._bindParameters.linearDepth)==null?void 0:a.fbo;if(s!=null&&s.colorTexture)return void s.readPixels(r[0],r[1],r[2],r[3],wt.RGBA,An.UNSIGNED_BYTE,i);const n=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"depth").acquireDepth(Fo.DEPTH16_BUFFER);this._rctx.bindFramebuffer(n.fbo),this._ensureBindParametersCamera(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const o=Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT;this._rctx.clearSafe(o),this._renderAllGeometry(k.LinearDepth),n.fbo.readPixels(r[0],r[1],r[2],r[3],wt.RGBA,An.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,r,i,s,n){var o;(o=this._bindParameters.hudVisibility)==null||o.fbo.readPixels(e,r,i,s,wt.RGBA,An.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e,r){const i=this._edgeView;if(i!=null&&i.shouldRender()){const{width:s,height:n,depth:o}=this._offscreen,a=this.fboCache.acquire(s,n,"edges"),l=()=>i.render(this._bindParameters,e);this._offscreen.renderToTargets(l,a,r??o,Rhe),this._offscreen.compositeToFramebuffer(this._bindParameters,a.getTexture(),ua.Alpha,1),a.release()}}_renderShadowMap(e,r,i){const s=this._shadowMap;s.enabled&&(s.start(e,r,i,this.isFeatureEnabled(xn.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(k.ShadowHighlight,this._shadowMap),s.moveSnapshot(Hw.Highlight),this._renderShadowCascades(k.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(Hw.ExcludeHighlight),this._renderShadowCascades(k.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(k.Shadow),s.finish(),e.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap){for(const i of r.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._renderAllGeometry(e)}get _needsLinearDepth(){return this._plugins.consumes(k.LinearDepth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugLinearDepth}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,"linear-depth",()=>this._renderAllGeometry(k.LinearDepth),[0,0,0,0],ji.RGBA,Fo.DEPTH_STENCIL_TEXTURE),this._bindParameters.linearDepth.detachDepth()):this._bindParameters.linearDepth=er(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=k.LinearDepth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,"terrain depth",()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.detachDepth(),this._renderContext.output=r}else this._bindParameters.multipassTerrain.linearDepth=er(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.linearDepth=er(this._bindParameters.multipassGeometry.linearDepth));const r=this._renderContext.output;this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,"geometry depth",()=>this._renderOpaqueGeometryAndTransparentMaterial(k.LinearDepth),[1,1,1,1]),this._renderContext.output=r;const i=this._bindParameters.multipassGeometry.linearDepth.getAttachment(uE);return i==null||i.retain(),this._bindParameters.multipassGeometry.linearDepth.detachDepth(),i}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return uW;const r=Ewt(e,this._plugins.plugins,this._stage.layers);return AE(r,this._plugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderNormals(){const e=this._plugins.produces(ue.SSAO),r=this._nodes.require("normals","composite-color")+this._nodes.require("normals","opaque-color")+this._nodes.require("normals","transparent-color");let i=(e?1:0)+r+(e||r>0?this._nodes.optional("normals","composite-color")+this._nodes.optional("normals","opaque-color")+this._nodes.optional("normals","transparent-color"):0);if(i===0)return;const s=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(k.Normal),[0,0,0,0],ji.RGBA,Fo.DEPTH_STENCIL_TEXTURE);for(;--i>0;)s.retain();return s}_renderSSAO(){const e=this._pluginInput.get("normals");this._plugins.produces(ue.SSAO)&&e&&(this._bindParameters.ssao=this._plugins.render(ue.SSAO,this._pluginInput),e.detachDepth(),e.release()&&this._pluginInput.delete("normals"))}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(ue.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._plugins.prepare(ue.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(ue.INTEGRATED_MESH),this._plugins.render(ue.OPAQUE_TERRAIN),this._plugins.render(ue.OPAQUE_MATERIAL),this._plugins.render(ue.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_prepareOpaqueGeometry(){this._plugins.prepare(ue.INTEGRATED_MESH),this._plugins.prepare(ue.OPAQUE_TERRAIN),this._plugins.prepare(ue.OPAQUE_MATERIAL),this._plugins.prepare(ue.OPAQUE_NO_SSAO_DEPTH),this._plugins.prepare(ue.ENVIRONMENT_OPAQUE)}_renderOpaqueGeometry(){this._plugins.render(ue.INTEGRATED_MESH),this._plugins.render(ue.OPAQUE_TERRAIN),this._plugins.render(ue.OPAQUE_MATERIAL),this._plugins.render(ue.OPAQUE_NO_SSAO_DEPTH)}_renderTransparentMaterial(){this._plugins.render(ue.TRANSPARENT_MATERIAL),this._plugins.render(ue.TRANSPARENT_NO_SSAO_DEPTH)}_renderTransparentTerrain(){if(!this._plugins.produces(ue.TRANSPARENT_TERRAIN))return;const e=()=>this._plugins.render(ue.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==k.Color)return void e();const{width:r,height:i,depth:s}=this._offscreen,n=this.fboCache.acquire(r,i,"transparent terrain");return this._offscreen.renderToTargets(e,n,s,[0,0,0,0]),n}_renderHUDVisibility(e){this._plugins.produces(ue.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(ue.OCCLUSION_PIXELS),e),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=er(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===sc.Occluded){const r=()=>{this._plugins.render(ue.LINE_CALLOUTS)},{width:i,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(Fo.DEPTH16_BUFFER,i,s,"line callouts");this._offscreen.renderToTargets(r,n,o,void 0,!0,!0),o.release()}else this._plugins.render(ue.LINE_CALLOUTS)}_renderLaserlines(){if(this._plugins.render(ue.LASERLINES),this._plugins.produces(ue.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:r,height:i,depth:s}=e,n=this.fboCache.acquire(r,i,"laser lines"),o=()=>this._plugins.render(ue.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,n,s,Rhe),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),ua.PremultipliedAlpha,1),n.release()}}_renderHUD(e,r){if(this._pluginsHas.hudElements)if(this._oitEnabled){const i=this._renderOITPass(VT.HUD,e);this._rctx.bindFramebuffer(r==null?void 0:r.fbo),this._compositingHelper.composite(this._bindParameters,i.getTexture(),ua.PremultipliedAlpha),i.release()}else if(e===sc.Occluded){this._renderContext.output=k.Color;const i=()=>this._renderHUDElements(e),{width:s,height:n,color:o}=this._offscreen,a=this.fboCache.acquireDepth(Fo.DEPTH16_BUFFER,s,n,"hud");this._offscreen.renderToTargets(i,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=k.Color,this._rctx.bindFramebuffer(null),r==null||r.acquireDepth(Fo.DEPTH16_BUFFER),this._rctx.bindFramebuffer(r==null?void 0:r.fbo),this._renderHUDElements(e),r==null||r.detachDepth()}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(ue.LINE_CALLOUTS_HUD_DEPTH),this._plugins.prepare(ue.HUD_MATERIAL),this._plugins.prepare(ue.LABEL_MATERIAL),this._plugins.render(ue.LINE_CALLOUTS_HUD_DEPTH),this._plugins.render(ue.HUD_MATERIAL),this._plugins.render(ue.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(ue.SHADOW_HIGHLIGHT)&&this._plugins.produces(ue.OPAQUE_MATERIAL,k.ShadowHighlight)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(k.Highlight),this._rctx.clearSafe(Si.DEPTH_BUFFER_BIT),this._renderHUDElements(sc.Both)},r=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],ji.RGBA4,Fo.DEPTH_STENCIL_TEXTURE);return r.detachDepth(),r}_renderShadowHighlights(e,r){this.hasHighlights&&r.decorations!==Cl.OFF&&this._needsShadowHighlight&&this._offscreen.updateColor(i=>(this._pluginInput.set("highlights",e),this._plugins.render(ue.SHADOW_HIGHLIGHT,this._pluginInput,i),i),"transparent-color")}_renderHighlights(e,r,i){this.hasHighlights&&i.decorations!==Cl.OFF&&this._plugins.produces(ue.HIGHLIGHT)&&(this._pluginInput.set("highlights",r),this._plugins.render(ue.HIGHLIGHT,this._pluginInput,e))}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,r,i){var s;this._needsShadowCast&&((s=this._bindParameters.linearDepth)!=null&&s.getTexture())&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=k.Alpha,this._bindParameters.transparencyPassType=dt.Alpha,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._renderContext.output=k.Color,this._bindParameters.transparencyPassType=dt.Color,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=dt.FrontFace,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=dt.NONE}_renderOITPass(e,r=sc.Both){const i=e===VT.HUD,s=i?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=i?()=>this._renderHUDElements(r):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=k.Alpha,this._bindParameters.transparencyPassType=dt.Alpha;const a=this._offscreen.renderOITPass(n,dt.Alpha,i);this._renderContext.output=k.Color,this._bindParameters.transparencyPassType=dt.Color;const l=this._offscreen.renderOITPass(n,dt.Color,i);this._bindParameters.transparencyPassType=dt.FrontFace;const c=this._offscreen.renderOITPass(n,dt.FrontFace,i);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,l,a,c,s),s==null||s.detachDepth(),c.release(),l.release(),a.release(),this._bindParameters.transparencyPassType=dt.NONE,this._renderContext.output=o,s}_renderOccluded(){let e=0;fd.clear(),this._plugins.plugins.forAll(a=>{a.materialReference&&a.queryRenderOccludedState(Ur.OccludeAndTransparentStencil)&&(e|=Ur.OccludeAndTransparentStencil,fd.push(a))});const r=this._offscreen,i=(a,l,c,u,h)=>{if(!(e&l))return;const{width:p,height:f,depth:g}=r,_=this.fboCache.acquire(p,f,"tmp color");r.renderToTargets(c,_,g,[0,0,0,0],u,h),r.compositeToFramebuffer(this._bindParameters,_.getTexture(),ua.PremultipliedAlpha,a),_.release()},s=(a,l)=>{this._bindParameters.slot=a,l.forAll(c=>{if(DH(c)){const u=c.prepareTechnique(this._renderContext);u&&c.renderNode(this._renderContext,u)}})};fd.length!==0&&(s(ue.OCCLUDER_MATERIAL,fd),i(.5,Ur.OccludeAndTransparentStencil,()=>s(ue.TRANSPARENT_OCCLUDER_MATERIAL,fd),!1,!1)),fd.clear(),this._plugins.plugins.forAll(a=>{if(!a.materialReference)return;const l=a.queryRenderOccludedState(Ur.OccludeAndTransparent),c=a.queryRenderOccludedState(Ur.Transparent),u=a.queryRenderOccludedState(Ur.Opaque);(l||c||u)&&(e|=l?Ur.OccludeAndTransparent:c?Ur.Transparent:Ur.Opaque,fd.push(a))});const n=this._plugins.renderOccludedFlags;if(e|=n,!e)return;const o=a=>{this._renderContext.renderOccludedMask=a,n>Ur.Occlude&&this._plugins.render(ue.OCCLUDED_TERRAIN),s(ue.OPAQUE_MATERIAL,fd),s(ue.TRANSPARENT_MATERIAL,fd),s(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,fd),this._renderContext.renderOccludedMask=uF};this._renderContext.output=k.Color,i(.5,Ur.OccludeAndTransparent,()=>o(Ur.OccludeAndTransparent),!0,Il.OutlineVisualElementMask),i(.5,Ur.Transparent,()=>o(Ur.Transparent),!0,Il.OutlineVisualElementMask),i(1,Ur.Opaque,()=>o(Ur.Opaque),!0,Il.OutlineVisualElementMask),fd.clear()}_invokeRenderNodes(e){return this._nodes.render(e,this._pluginInput,this._releaseNormals)}_renderComposite(e,r){this._offscreen.updateColor(s=>(this._pluginInput.set("highlights",r),s=this._nodes.render(s,this._pluginInput,this._releaseNormals),this._pluginInput.set(s.name,s),this._pluginInput.delete("highlights"),s),"composite-color");const i=this._plugins.produces(ue.ANTIALIASING);return this._plugins.render(i?ue.ANTIALIASING:ue.BLIT,this._pluginInput,e)}_ensureBindParametersCamera(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=ts:(cn(Ihe,this._bindParameters.camera.viewMatrix),cn($he,this._bindParameters.camera.projectionMatrix),ri(S2,Ihe,$he),ri(S2,this._renderContext.lastFrameCamera.viewMatrix,S2),ri(S2,this._renderContext.lastFrameCamera.projectionMatrix,S2),this._reprojectionMatrix=S2);const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=ts,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}get test(){return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,renderPlugins:this._plugins,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{this._renderStateFeatures.value=x9(),this._plugins.renderFeatureChanged(),this._requestRender()},getFramebufferTexture:e=>{var r,i;switch(e){case GT.Color:return this._offscreen.colorTexture;case GT.LinearDepth:return(r=this._bindParameters.linearDepth)==null?void 0:r.getTexture();case GT.ShadowMap:return this._shadowMap.depthTexture;case GT.HudVisibility:return(i=this._bindParameters.hudVisibility)==null?void 0:i.getTexture()}},debugLinearDepth:e=>{this._debugLinearDepth=e,this._requestRender()}}}}var VT,GT;d([m({readOnly:!0})],aT.prototype,"fullResolutionAtmosphere",null),d([m()],aT.prototype,"_smaa",void 0),d([m()],aT.prototype,"_blit",void 0),d([m()],aT.prototype,"_edgeView",void 0),d([m()],aT.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(VT||(VT={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(GT||(GT={}));const Rhe=[0,0,0,0],fd=new kt,$he=xe(),Ihe=xe(),S2=xe();function n2t(t){return e=>t.immediate.schedule(e)}let o2t=class{constructor(e){this._rctx=e,this._vao=a2t(e)}destroy(){this._vao=ft(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(sr.TRIANGLES,0,3))}get test(){var e,r,i,s;return{cachedWebGLObjects:NB((e=this._vao)==null?void 0:e.glName)+NB((i=(r=this._vao)==null?void 0:r.indexBuffer)==null?void 0:i.glName)+NB((s=this._vao)==null?void 0:s.vertexBuffers.geometry)}}};function a2t(t,e=_Z,r=Mr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Dp(t,r,{geometry:e},{geometry:qr.createVertex(t,Pr.STATIC_DRAW,i)})}function NB(t){return t!=null?1:0}let yOe=class _Oe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=_Oe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return qr.createIndex(this._rctx,Pr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,mt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(sr.POINTS,1,Te.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){var e;return{cachedWebGLObjects:(e=this._indexBuffer)!=null&&e.glName?1:0}}},Lhe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ee.ONE,dstRGB:Ee.ZERO,srcAlpha:Ee.ONE,dstAlpha:Ee.ZERO},this.blendEquation={mode:wm.ADD,modeAlpha:wm.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=np.BACK,this.frontFace=cE.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Qr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:np.FRONT_AND_BACK,func:Qr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:np.FRONT_AND_BACK,fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},l2t=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<ks.COUNT;)this._current.push(0)}increment(e,r,i=1){var s;this._current[e]+=i,(s=this._allocations)==null||s.add(r)}decrement(e,r,i=1){var s;this._current[e]-=i,(s=this._allocations)==null||s.remove(r)}get current(){return this._current}get total(){return this.current.reduce((e,r,i)=>e+(i<ks.UNCOUNTED?r:0),0)}get resourceInformation(){var r;let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<ks.COUNT;++i){const s=this._current[i];s>0&&(e+=`${ks[i]}: ${s}
`)}}return e+=(r=this._allocations)==null?void 0:r.resetLog(),e}},c2t=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)}};const u2t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Dhe,vOe={exports:{}};(Dhe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(vOe.exports=Dhe);const h2t=ER(vOe.exports);var Nhe,bOe={exports:{}};Nhe=bOe,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Nhe.exports=e)}();const Fhe=ER(bOe.exports);var wOe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(wOe);const d2t=ER(wOe.exports);var md=999,khe=9999,FB=0,kB=1,Uhe=2,zhe=3,Bhe=4,jL=5,p2t=6,f2t=7,m2t=8,Vhe=9,g2t=10,Ghe=11,y2t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function _2t(){var t,e,r,i=0,s=0,n=md,o=[],a=[],l=1,c=0,u=0,h=!1,p=!1,f="";return function(z){return a=[],z!==null?_(z.replace?z.replace(/\r\n/g,`
`):z):v()};function g(z){z.length&&a.push({type:y2t[n],data:z,position:u,line:l,column:c})}function _(z){var Z;for(i=0,r=(f+=z).length;t=f[i],i<r;){switch(Z=i,n){case FB:i=C();break;case kB:i=S();break;case Uhe:i=T();break;case zhe:i=P();break;case Bhe:i=F();break;case Ghe:i=L();break;case jL:i=U();break;case khe:i=j();break;case Vhe:i=w();break;case md:i=b()}Z!==i&&(f[Z]===`
`?(c=0,++l):++c)}return s+=i,f=f.slice(i),a}function v(z){return o.length&&g(o.join("")),n=g2t,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+i-1,n=FB,e=t,i+1):e==="/"&&t==="/"?(u=s+i-1,n=kB,e=t,i+1):t==="#"?(n=Uhe,u=s+i,i):/\s/.test(t)?(n=Vhe,u=s+i,i):(h=/\d/.test(t),p=/[^\w_]/.test(t),u=s+i,n=h?Bhe:p?zhe:khe,i)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(g(o.join("")),n=md,i)}function S(){return T()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=md,i+1):(o.push(t),e=t,i+1)}function P(){if(e==="."&&/\d/.test(t))return n=jL,i;if(e==="/"&&t==="*")return n=FB,i;if(e==="/"&&t==="/")return n=kB,i;if(t==="."&&o.length){for(;R(o););return n=jL,i}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return g(t),n=md,i+1}var z=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||z){for(;R(o););return n=md,i}return o.push(t),e=t,i+1}function R(z){for(var Z,W,Y=0;;){if(Z=Fhe.indexOf(z.slice(0,z.length+Y).join("")),W=Fhe[Z],Z===-1){if(Y--+z.length>0)continue;W=z.slice(0,1).join("")}return g(W),u+=W.length,(o=o.slice(W.length)).length}}function L(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function F(){return t==="."||/[eE]/.test(t)?(o.push(t),n=jL,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Ghe,o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function U(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),n=md,i):(o.push(t),e=t,i+1)}function j(){if(/[^\d\w_]/.test(t)){var z=o.join("");return n=h2t.indexOf(z)>-1?m2t:d2t.indexOf(z)>-1?f2t:p2t,g(o.join("")),n=md,i}return o.push(t),e=t,i+1}}function v2t(t){var e=_2t(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function b2t(t){return v2t(t)}function w2t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const UB=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function x2t(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function T2t(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function wP(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,wP(t,e,i+"_"+e[i],i);return r}function xOe(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function s(l){let c=-1,u=0,h=-1;for(let p=0;p<l.length;p++){const f=l[p];if(f.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(f.data)?++u:/\#endif\s*.*/.test(f.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||f.type==="preprocessor"&&f.data.startsWith("#version")&&(h=Math.max(h,p)),r==="afterPrecision"&&f.type==="keyword"&&f.data==="precision"){const g=i(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function S2t(t,e,r,i="lowp"){xOe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function E2t(t,e,r,i,s="lowp"){xOe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function C2t(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function jhe(t,e){if(t.startsWith("#version 300"))return t;const r=b2t(t);if(x2t(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===ou.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===ou.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===ou.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=wP(r,n,"fragColor"),S2t(r,i,"vec4")),l.data=i),e===ou.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=C2t(r,a+1),u=wP(r,n,"fragData");E2t(r,u,"vec4",c,"mediump"),l.data=u}else e===ou.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=wP(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(u2t.includes(l.data)){if(e===ou.VERTEX_SHADER&&T2t(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=wP(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&UB.has(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&UB.has(u[1].trim())&&(l.data="#if 1");const h=l.data.match(/\#ifndef\s+(.*)/);h&&h[1]&&UB.has(h[1].trim())&&(l.data="#if 0")}}return A2t(t,w2t(r))}function A2t(t,e){return e}const P2t=4294967295;let M2t=class{constructor(e,r,i,s,n=new Map,o=[]){var c;this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),r=jhe(r,ou.VERTEX_SHADER),i=jhe(i,ou.FRAGMENT_SHADER),this._vShader=Hhe(this._context,ou.VERTEX_SHADER,r),this._fShader=Hhe(this._context,ou.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(ks.Shader,this),Fj()&&(this.vertexShader=r,this.fragmentShader=i),this.usedMemory=r.length+i.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((u,h)=>a.bindAttribLocation(l,u,h)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),Fj()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,h]of this._uniformBlockBindings){const p=a.getUniformBlockIndex(l,u);p<P2t&&a.uniformBlockBinding(l,p,h)}this._glName=l,this._context.instanceCounter.increment(ks.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,r=this._context.instanceCounter;this._nameToUniformLocation.forEach(i=>i&&r.decrement(ks.Uniform,i)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(r.decrement(ks.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,r.decrement(ks.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,r.decrement(ks.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const r=this._nameToUniformLocation.get(e);if(r!==void 0)return r;if(this.glName){const i=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,i),i&&this._context.instanceCounter.increment(ks.Uniform,i),i}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1iv(e,r){af(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){af(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){af(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){af(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1fv(e,r){af(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){af(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){const i=this._getUniformLocation(e);i!=null&&af(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(i,r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){const i=this._getUniformLocation(e);i!=null&&af(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(i,r)}setUniformMatrix3fv(e,r,i=!1){const s=this._getUniformLocation(e);s!=null&&af(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(s,i,r)}setUniformMatrix4fv(e,r,i=!1){const s=this._getUniformLocation(e);s!=null&&af(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(s,i,r)}stop(){}};function Hhe(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),Fj()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===ou.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(O2t(r))),s}function O2t(t){let e=2;return t.replaceAll(`
`,()=>`
`+R2t(e++)+":")}function R2t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function af(t,e,r){const i=t.get(e);if(!i)return t.set(e,Array.from(r)),!0;const s=r.length;if(i.length!==s)return t.set(e,Array.from(r)),!0;for(let n=0;n<s;++n){const o=r[n];if(i[n]!==o){for(i[n]=o;n<s;++n)i[n]=r[n];return!0}}return!1}let $2t=class{constructor(e){this._rctx=e,this._store=new t1}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new M2t(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},qR=class{constructor(){this._result=!1}dispose(){this._program=ft(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},I2t=class extends qR{constructor(e){super(),this._rctx=e,this._helperProgram=null,se("mac")&&se("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx,i=r.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=r.getViewport();r.resetState();const l=new oi(1);l.wrapMode=Xt.CLAMP_TO_EDGE,l.samplingMode=Gt.NEAREST;const c=new Np(r,l),u=qr.createIndex(this._rctx,Pr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(c),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(u,mt.ELEMENT_ARRAY_BUFFER),r.drawElements(sr.POINTS,1,Te.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(sr.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,wt.RGBA,An.UNSIGNED_BYTE,h),r.setViewport(s,n,o,a),r.bindFramebuffer(i),c.dispose(),u.dispose(),h[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${x.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${x.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=yOe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},L2t=class extends qR{constructor(e){super(),this._rctx=e,this._program=qhe(this._rctx,!1),this._obfuscated=qhe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=ft(this._obfuscated)}_test(e){if(se("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._rctx,i=r.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=r.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return r.setViewport(s,n,o,a),r.bindFramebuffer(i),l!==0&&(c===0||l/c>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new oi(1);i.wrapMode=Xt.CLAMP_TO_EDGE,i.samplingMode=Gt.NEAREST;const s=new Np(r,i),n=qr.createVertex(r,Pr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Bh(r,new Map([["position",0]]),{geometry:[new hi("position",2,Te.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Pe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Pe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);Hj(a,c,3);const u=new Float32Array(6);Hj(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);s.readPixels(0,0,1,1,wt.RGBA,An.UNSIGNED_BYTE,h),o.dispose(),s.dispose();const p=(a[2]-l[2])/25,f=KJ(h);return Math.abs(p-f)}};function qhe(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(r,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let D2t=class extends qR{constructor(e){var s,n;if(super(),this._rctx=e,!e.gl||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat&&((n=e.capabilities.colorBufferFloat)!=null&&n.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new oi(1);i.wrapMode=Xt.CLAMP_TO_EDGE,i.dataType=An.FLOAT,i.internalFormat=tt.RGBA32F,i.samplingMode=Gt.NEAREST;const s=new Np(r,i),n=qr.createVertex(r,Pr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Bh(r,new Map([["a_pos",0]]),{geometry:[new hi("a_pos",2,Te.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const p=Nt({blending:uTe});r.setPipelineState(p),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const f=r.gl.getError();return r.setViewport(l,c,u,h),r.bindFramebuffer(a),o.dispose(),s.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},N2t=class extends qR{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new oi(1);i.wrapMode=Xt.CLAMP_TO_EDGE,i.samplingMode=Gt.NEAREST;const s=new Np(r,i),n=new Uint8Array(4),o=qr.createVertex(r,Pr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Bh(r,new Map([["a_position",0]]),{geometry:[new hi("a_position",2,Te.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Sr(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:u,y:h,width:p,height:f}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(sr.TRIANGLE_STRIP,0,4),r.setViewport(u,h,p,f),s.readPixels(0,0,1,1,wt.RGBA,An.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const g=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return g&&ae.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),g}};new hi("a_pos",2,Te.BYTE,0,2);new hi("a_pos",2,Te.BYTE,0,4),new hi("a_tex",2,Te.BYTE,2,4);const F2t={geometry:[new hi("a_pos",2,Te.UNSIGNED_SHORT,0,4)]};let k2t=class extends qR{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new oi(1);i.wrapMode=Xt.CLAMP_TO_EDGE,i.samplingMode=Gt.NEAREST;const s=new Np(r,i),n=qr.createVertex(r,Pr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Bh(r,new Map([["a_pos",0]]),F2t,{geometry:n}),a=new oi;a.samplingMode=Gt.LINEAR,a.wrapMode=Xt.CLAMP_TO_EDGE;const l=new Sr(r,a,xP);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:h,width:p,height:f}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Si.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,wt.RGBA,An.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),r.setViewport(u,h,p,f),r.bindFramebuffer(c),g[0]!==255}};const xP=new Image;xP.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",xP.width=5,xP.height=5,xP.decode();let U2t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new D2t(e),this.svgPremultipliesAlpha=new k2t(e),this.doublePrecisionRequiresObfuscation=new L2t(e),this.ignoresSamplerPrecision=new N2t(e),this.drawArraysRequiresIndicesTypeReset=new I2t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function z2t(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function B2t(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function V2t(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function G2t(t,e){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function Whe(t,e,r,i,s){if(i)return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function j2t(t,e){if(e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function H2t(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}let q2t=class{constructor(e,r){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=z2t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=B2t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=V2t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=t2t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){if(!this._textureFloat){const{textureFloatLinear:e}=this._disabledExtensions;this._textureFloat={textureFloatLinear:!e&&!!this._gl.getExtension("OES_texture_float_linear")}}return this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=G2t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Whe(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=H2t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=j2t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Whe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},W2t=class{constructor(e,r){this.gl=e,this.instanceCounter=new l2t,this.programCache=new $2t(this),this._transformFeedbackRequestInfo=null,this._state=new Lhe,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(r)}configure(e){this._capabilities=new q2t(this.gl,e),this._parameters=new c2t(this.gl,this._capabilities,e),Sr.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Lhe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new iWe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)},setDrawBuffers:i=>{const{gl:s}=this;if(i)s.drawBuffers(i.buffers);else{const{drawFramebuffer:n}=this._state;n===null||n.colorAttachments.length===0?s.drawBuffers([Dj.BACK]):s.drawBuffers([Ua.COLOR_ATTACHMENT0])}}}),this.enforceState(),ft(this._driverTest),this._driverTest=new U2t(this)}dispose(){ft(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(mt.ARRAY_BUFFER),this.unbindBuffer(mt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(mt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(mt.PIXEL_PACK_BUFFER),this.unbindBuffer(mt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(mt.COPY_READ_BUFFER),this.unbindBuffer(mt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,zd()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=np.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===np.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=np.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(GU+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Si.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Si.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Si.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}clearFramebuffer(e,r=!1,i=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=Si.COLOR_BUFFER_BIT}r&&(s|=Si.DEPTH_BUFFER_BIT),i===!1?i=0:(i===!0&&(i=255),s|=Si.STENCIL_BUFFER_BIT),s&&this.clearSafe(s,i)}drawArrays(e,r,i){var s,n;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((s=this._state.program)==null?void 0:s.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(zd()){this._numOfDrawCalls++,this._numOfTriangles+=Yhe(e,i);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((n=this._state.drawFramebuffer)==null?void 0:n.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,r,i),zf(this.gl)}drawArraysInstanced(e,r,i,s){this.gl.drawArraysInstanced(e,r,i,s),zf(this.gl)}drawElements(e,r,i,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(zd()&&(this._numOfDrawCalls++,this._numOfTriangles+=Yhe(e,r)),this.gl.drawElements(e,r,i,s),zd()){const n=iwe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:s},h=(a==null?void 0:a.size)??0,p=s+r,f=h<p?`. Buffer is too small. Attempted to draw index ${p} of ${h}`:"";console.error(`drawElements: ${n}${f}`,{args:u,vao:c})}}}logInfo(){zd()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){zd()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:r,width:i,height:s}){this.setViewport(e,r,i,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return(e==null?void 0:e.glName)==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(na.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(na.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===na.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,h=Si.COLOR_BUFFER_BIT,p=Gt.NEAREST){this.bindFramebufferSeparate(e,na.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,na.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,u,h,p)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case mt.ARRAY_BUFFER:this._state.vertexBuffer=hl(this.gl,e,r,this._state.vertexBuffer);break;case mt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=hl(this.gl,e,r,this._state.indexBuffer);break;case mt.UNIFORM_BUFFER:this._state.uniformBuffer=hl(this.gl,e,r,this._state.uniformBuffer);break;case mt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=hl(this.gl,e,r,this._state.pixelPackBuffer);break;case mt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=hl(this.gl,e,r,this._state.pixelUnpackBuffer);break;case mt.COPY_READ_BUFFER:this._state.copyReadBuffer=hl(this.gl,e,r,this._state.copyReadBuffer);break;case mt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=hl(this.gl,e,r,this._state.copyWriteBuffer);break;case mt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=hl(this.gl,e,r,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=e===mt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);o!=null&&(o.buffer===i&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,r,i,s){r!=null?(zd()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(mt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(mt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(mt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(mt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case mt.ARRAY_BUFFER:this._state.vertexBuffer=hl(this.gl,null,e,this._state.vertexBuffer);break;case mt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=hl(this.gl,null,e,this._state.indexBuffer);break;case mt.UNIFORM_BUFFER:this._state.uniformBuffer=hl(this.gl,null,e,this._state.uniformBuffer);break;case mt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=hl(this.gl,null,e,this._state.pixelPackBuffer);break;case mt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=hl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case mt.COPY_READ_BUFFER:this._state.copyReadBuffer=hl(this.gl,null,e,this._state.copyReadBuffer);break;case mt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=hl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,r){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName),i.beginTransformFeedback(r),this._transformFeedbackRequestInfo={primitiveType:r}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:r}=this,i=r.fenceSync(Nj.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(ks.Sync,i),r.flush();do await LM(e),s=r.clientWaitSync(i,0,0);while(s===C5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(ks.Sync,i),r.deleteSync(i),s===C5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=na.FRAMEBUFFER){return e===na.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(mt.ARRAY_BUFFER),this.unbindBuffer(mt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(mt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(mt.PIXEL_PACK_BUFFER),this.unbindBuffer(mt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(mt.COPY_READ_BUFFER),this.unbindBuffer(mt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ee.ONE,Ee.ZERO),this.setBlendEquation(wm.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(np.BACK),this.setFrontFace(cE.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Qr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Qr.ALWAYS,0,0),this.setStencilOp(ss.KEEP,ss.KEEP,ss.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var i,s,n;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(mt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(mt.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:u}=a;l!==null?c===0&&u===0?e.bindBufferBase(mt.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(mt.UNIFORM_BUFFER,o,l.glName,c,u):e.bindBufferBase(mt.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(mt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(mt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(mt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(mt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(na.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(na.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Ua.COLOR_ATTACHMENT0)),e.bindFramebuffer(na.DRAW_FRAMEBUFFER,((i=this._state.drawFramebuffer)==null?void 0:i.glName)??null),this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((s=this._state.program)==null?void 0:s.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((n=this._state.renderbuffer)==null?void 0:n.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(GU+o),e.bindTexture(_s.TEXTURE_2D,null),e.bindTexture(_s.TEXTURE_CUBE_MAP,null),e.bindTexture(_s.TEXTURE_3D,null),e.bindTexture(_s.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(GU+this._state.activeTexture);const r=this._state.viewport;e.viewport(r.x,r.y,r.width,r.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function hl(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Yhe(t,e){switch(t){case sr.POINTS:return 2*e;case sr.TRIANGLES:return e/3;case sr.TRIANGLE_STRIP:case sr.TRIANGLE_FAN:return e-2;default:return 0}}let Y2t=class extends W2t{constructor(e,r,i){super(e,r),this.gl=e,this.newCache=i,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new o2t(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,r,i,s,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(i,r),s&&e.program.bindDraw(s,r,i),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new yOe(this)),this._appleAmdDriverHelper.run())}get test(){var e;return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(((e=this._appleAmdDriverHelper)==null?void 0:e.test.cachedWebGLObjects)??0)}}};function Xhe(t){return!!t.frameUpdate}let lT=class extends Me{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Gs,this._frameTask=e.view.resourceController.scheduler.registerTask(yt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(vs.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(oK,new aK)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",Os.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return ht(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new X2t(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture?(this._updateGLTexture(s,r.glTexture),Xhe(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),Xhe(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,ns(l)||ae.getLogger(this).error(l),null);return Rc(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",Os.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([m()],lT.prototype,"_loadingCount",void 0),d([m()],lT.prototype,"_frameTask",void 0),d([m()],lT.prototype,"updating",null),lT=d([V("esri.views.3d.webgl-engine.lib.TextureRepository")],lT);let X2t=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ae.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function Z2t(t,e){return new fEe(r=>Rnt(r,t),r=>r,e)}let TP=class extends Me{constructor(){super(...arguments),this._passParameters=new J2t,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Ja(this._resourcesTask),this._passParameters.waveNormal=ft(this._passParameters.waveNormal),this._passParameters.wavePerturbation=ft(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=Am(async r=>{await Promise.allSettled([this._loadImageResource(e,ai("esri/images/materials/water/normals.jpg"),i=>this._passParameters.waveNormal=i,r),this._loadImageResource(e,ai("esri/images/materials/water/perturbation.jpg"),i=>this._passParameters.wavePerturbation=i,r)])})),this._resourcesTask.finished?X_.LOADED:X_.LOADING}async _loadImageResource(e,r,i,s){try{const n=await d0(r,{signal:s});vt(s);const o=new oi(n.width,n.height);o.pixelFormat=wt.RGB,o.samplingMode=Gt.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,i(new Sr(e,o,n))}catch(n){ae.getLogger(this).error("Failed to load water material normal texture.",n)}}};d([m()],TP.prototype,"_resourcesTask",void 0),d([m({type:Boolean,readOnly:!0})],TP.prototype,"updating",null),TP=d([V("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],TP);let J2t=class extends Ci{};const Zhe=2048,K2t=1.5,Q2t=8;function eTt(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=xQ(t,e.padding),a=aTt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=oTt(t,a),u=uTt(r),h=mTt[u];return{format:u,quality:we(i??h,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function tTt(t,e){const r=eTt(t,e),i=r.area,s=r.width/i.width,n=xQ(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),h=Math.floor(c*s+a),p=(t==null?void 0:t.layers)??[],f=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:f,ignorePadding:g,objectAndLayerIdColor:!1}}function zB(t,e,r){const{ctx:i,canvas:s}=TOe(t,r),n=i.getImageData(0,0,t.width,t.height),o=iTt(s,e);return SOe(s),{dataUrl:o,data:n}}function BB(t,e){const{ctx:r,canvas:i}=TOe(t,e),s=r.getImageData(0,0,t.width,t.height);return SOe(i),s}function TOe(t,e){const r=rTt();e.premultipliedAlpha&&dTt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&hTt(i),{ctx:i,canvas:r}}function SOe(t){t.width=0,t.height=0}function rTt(){return VB==null&&(VB=document.createElement("canvas")),VB}let VB=null;function iTt(t,e){const r=pTt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function sTt(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:h}=e,p=n/c,f=o/u,g=Math.ceil(p/2),_=Math.ceil(f/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const T=4*(w+(a?u-b-1:b)*c);let S=0,C=0,P=0,R=0,L=0,F=0;const U=(b+.5)*f;for(let j=Math.floor(b*f);j<(b+1)*f;j++){const z=Math.abs(U-(j+.5))/_,Z=(w+.5)*p,W=z*z;for(let Y=Math.floor(w*p);Y<(w+1)*p;Y++){const le=Math.abs(Z-(Y+.5))/g,I=Math.sqrt(W+le*le);if(I>=1)continue;let N=2*I*I*I-3*I*I+1;const B=4*(i+Y+(s+j)*v);F+=N*l[B+3],C+=N,P+=N*l[B],R+=N*l[B+1],L+=N*l[B+2],S+=N}}h[T]=P/S,h[T+1]=R/S,h[T+2]=L/S,h[T+3]=F/C}return e}function nTt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=xQ(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,h=s-c,p=Math.min(Q2t,Math.min((Zhe-l)/u,(Zhe-c)/h));return p<K2t?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:s}}}function oTt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function aTt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return lTt(cTt(r,t),e)}function lTt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function cTt(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function xQ(t,e){return!e||t&&t.ignorePadding?gTt:e}function uTt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return fTt}}function hTt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function dTt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const pTt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Jhe=98,fTt="png",mTt={png:100,jpg:Jhe,jpeg:Jhe},gTt={top:0,right:0,bottom:0,left:0};let yTt=class{constructor(e,r,i){this.parameters=e,this.frameHasDecorations=r,this.fbos=i}},_Tt=class{constructor(e,r,i){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Os.BACKGROUND);const r=Wo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,i.disableDecorations?Cl.OFF:Cl.ON,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=Pz(i,s,a);this._rctx.gl.readPixels(0,0,i,s,wt.RGBA,Te.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=Pz(n.width,n.height,a);return sTt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=Pz(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,wt.RGBA,Te.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){const s=e.parameters.camera,n={width:r.framebufferWidth,height:r.framebufferHeight};kb(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=r.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=r.ignorePadding&&s.pixelRatio!==r.pixelRatio,u=l||a||c||r.objectAndLayerIdColor;let h=null,p=null;if(u){const v=s.clone();if(r.ignorePadding){const C=uR(v.padding);for(let P=0;P<4;P++)C[P]=Math.round(C[P]/v.pixelRatio*r.pixelRatio);v.padding=C}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=r.pixelRatio;const b=s.fovX-v.fovX,w=s.fovY-v.fovY;b<0&&b<w?v.fovX=s.fovX:w<0&&w<b&&(v.fovY=s.fovY);const T={camera:v,contentCamera:v,mode:Br.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),o=!0;const S=this._renderFunctions.renderScene(T,i,r.objectAndLayerIdColor?Wd.ObjectAndLayerID:Wd.Screenshot,r.disableDecorations?Cl.OFF:Cl.ON);p=S.screen,h=S.oid}const f=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo);const g=this._readbackScreenshot(r,f);let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h==null||h.release()};this._rctx.bindFramebuffer(h==null?void 0:h.fbo),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function vW(t,e={}){return t.getContext("webgl2",e)||null}let _o=class extends Me{constructor(e){super({}),this.events=new Gs,this.waterTextures=new TP,this._magnifierHelper=new sT,this.objectAndLayerIdRenderHelper=se("enable-feature:objectAndLayerId-rendering")?new Bwt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(s){return void console.error("Failed to initialize context",s)}this.addHandles([he(()=>{var s;return(s=this.waterTextures)==null?void 0:s.updating},()=>this.requestRender(),ui),he(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeatures(s)},si),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextures=zst(this._rctx,r),this.markerTextures=Z2t(this._rctx,r),this._shaderTechniques=new lEe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextures,waterTextureRepository:this.waterTextures,markerTextureRepository:this.markerTextures}),this._textures=new lT(e,this._shaderTechniques,this._rctx),this.addHandles(this._textures.events.on("changed",s=>this.requestRender(s))),this._materialRepository=new cEe(this._textures,this._shaderTechniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new vwt(this._rctx,this._shaderTechniques),this.renderer=new aT(e,this._materialRepository,this._textures,this._shaderTechniques,this._rctx,this._compositingHelper,this._magnifierHelper,s=>this.requestRender(s));const i={renderScene:(s,n,o,a)=>this.renderer.render(s,n,o,a),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new _Tt(this._rctx,i,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=wi(this._frameTask),this._shaderTechniques=Ae(this._shaderTechniques),this._componentObjects=Ae(this._componentObjects),this._screenshotManager=Ae(this._screenshotManager),Ae(this.renderer),this._textures=Ae(this._textures),Ae(this._magnifierHelper),Ae(this.waterTextures),Ae(this.markerTextures),Ae(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Ae(this._rctx)}requestRender(e=Os.UPDATE){this._needsRender=!0,e===Os.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating||this._magnifierHelper.updating}get textureRepository(){return this._textures}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const h=Swt(4*u,l,s.nearFar);c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}if(e){const u=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){vPe(),await this._shaderTechniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=Os.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?Os.UPDATE:Os.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new Y2e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(Os.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(r,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(Os.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new yTt(r,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(r.mode===Br.IDLE?s:Os.UPDATE),n=!1)}};this._frameTask=yw(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=vW(this._canvas,i);s!=null?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&ae.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&se("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ae.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new Y2t(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new pwt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};d([m({type:Boolean,readOnly:!0})],_o.prototype,"updating",null),d([m()],_o.prototype,"_rctx",void 0),d([m()],_o.prototype,"_container",void 0),d([m()],_o.prototype,"_canvas",void 0),d([m()],_o.prototype,"stippleTextures",void 0),d([m()],_o.prototype,"markerTextures",void 0),d([m()],_o.prototype,"waterTextures",void 0),d([m()],_o.prototype,"_magnifierHelper",void 0),d([m({readOnly:!0})],_o.prototype,"objectAndLayerIdRenderHelper",void 0),d([m()],_o.prototype,"_textures",void 0),d([m({readOnly:!0})],_o.prototype,"renderer",void 0),d([m()],_o.prototype,"_screenshotManager",void 0),d([m()],_o.prototype,"componentObjectCollection",null),d([m()],_o.prototype,"_componentObjects",void 0),d([m()],_o.prototype,"_needsUpdate",void 0),d([m()],_o.prototype,"_needsWaterReflectionUpdate",void 0),_o=d([V("esri.views.3d.webgl-engine.parts.RenderView")],_o);let Xc=class extends Me{constructor(e){super(e),this._model=new HN,this._layers=new kt,this._asyncChangeSet=new dq,this._syncChangeSet=new dq,this._layerSyncSet=new Set}initialize(){this._set("renderView",new _o(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),lF(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(lF(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return Ao}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===P_.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?Wa:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wa),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==P_.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{this._layerSyncSet.has(r.id)||r.updatePolicy===P_.SYNC?(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id)):e.commitSyncUpdates(r.id,this._syncChangeSet)});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wa),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wa),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Wa))}addRenderPlugin(e,r){const i=this.renderer.plugins.add(e,r),s=()=>{Wce(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Rc(i))return i.then(s);s()}removeRenderPlugin(e){this.destroyed||(Wce(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Xc.DebugSettings={endFrameContentValidation:!1},d([m({constructOnly:!0})],Xc.prototype,"view",void 0),d([m({constructOnly:!0})],Xc.prototype,"options",void 0),d([m({readOnly:!0})],Xc.prototype,"viewingMode",null),d([m({constructOnly:!0})],Xc.prototype,"container",void 0),d([m({readOnly:!0})],Xc.prototype,"updating",null),d([m({constructOnly:!0})],Xc.prototype,"_model",void 0),d([m()],Xc.prototype,"renderView",void 0),d([m({readOnly:!0})],Xc.prototype,"renderer",null),d([m({readOnly:!0})],Xc.prototype,"running",null),Xc=d([V("esri.views.3d.webgl-engine.Stage")],Xc);function YGt(t){return t&&typeof t.highlight=="function"}function vTt(t){return t&&typeof t.maskOccludee=="function"}function XGt(t,e,r){return t==null||t>r&&(e===0||t<e)}function ZGt(t,e){return t!=null&&t>0||e!=null&&e>0}function JGt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let GB;function bW(){return GB||(GB=xTt()),GB}let bTt=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function wTt(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let r=vW(e,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=vW(e),r!=null&&(t.majorPerformanceCaveat=!0)),r==null)return r;t.available=!0,t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const i=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return i&&(t.supportsHighPrecisionFragment=i.precision>0),r}function xTt(){const t=new bTt,e=wTt(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function TTt(t){const e=bW();return e.available?t==="3d"&&e.majorPerformanceCaveat?new J("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new J("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new J("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new J("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function STt(t){return t&&"nodeType"in t}function ETt(t){return t&&typeof t.render=="function"}const Khe={component:"esri-component"};let ab=class extends Me{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,r;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((r=this.node)==null?void 0:r.id)}set id(e){this._set("id",e)}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Khe.component),r&&r.classList.remove(Khe.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||STt(e)?(this._set("widget",null),R6(e)):(ETt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m()],ab.prototype,"id",null),d([m()],ab.prototype,"node",null),d([zi("node")],ab.prototype,"castNode",null),d([m({readOnly:!0})],ab.prototype,"widget",void 0),ab=d([V("esri.views.ui.Component")],ab);const QN=ab,EOe="calcite-mode-";function CTt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function ATt(){return CTt().startsWith("dark")}function PTt(){return`${EOe}${ATt()?"dark":"light"}`}function MTt(t){OTt(t),t.classList.add(PTt())}function OTt(t){Array.from(t.classList).forEach(e=>{e.startsWith(EOe)&&t.classList.remove(e)})}const RTt={left:0,top:0,bottom:0,right:0},COe={bottom:30,top:15,right:15,left:15},rg="esri-ui",Xl={ui:rg,corner:`${rg}-corner`,innerContainer:`${rg}-inner-container`,manualContainer:`${rg}-manual-container`,cornerContainer:`${rg}-corner-container`,topLeft:`${rg}-top-left`,topRight:`${rg}-top-right`,bottomLeft:`${rg}-bottom-left`,bottomRight:`${rg}-bottom-right`};function $Tt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function HL(t){return t===0?"0":`${t}px`}function jB(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function HB(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let Pf=class extends Gs.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=gu(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&HB(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&HB(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([he(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,ui),he(()=>this.padding,this._applyUIPadding,ui),he(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},ui),NY(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Xl.ui),MTt(e),this._attachContainers(e)),r&&(r.classList.remove(Xl.ui),HB(r,{top:"",bottom:"",left:"",right:""}),hge(r)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:s}=r;return Math.max(e-i-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...COe,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:s}=r;return Math.max(e-i-s,0)}add(e,r){let i,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=jB(e);o&&({index:i,position:r,component:e,key:s}=o),r&&typeof r=="object"&&({index:i,key:s,position:r,internal:n}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,s,n)}remove(e,r){var s;if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,r));const i=this._find(e);if(i){if(this._componentMap.has(i)&&((s=this._componentMap.get(i))==null?void 0:s.key)!==r)return;const n=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(i),this._components.splice(n,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,r);return}const i=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||r.removeInternal});for(const n of s)this.remove(n)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const s=jB(e)||jB(r);if(s&&(i=s.index,r=s.position,e=s.component||e),r&&!this._isValidPosition(r))return;const n=this.remove(e);n&&this.add(n,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,r)):this._getComponentsAtPosition(e,r):this._components.filter(i=>{var s;return r.includeInternal||!((s=this._componentMap.get(i))!=null&&s.internal)}).map(({widget:i,node:s})=>i??s)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,s,n){e instanceof QN||(e=new QN({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof QN?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??RTt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Xl.innerContainer,Xl.cornerContainer);const r=document.createElement("div");r.classList.add(Xl.innerContainer,Xl.manualContainer);const i=document.createElement("div");i.classList.add(Xl.topLeft,Xl.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Xl.topRight,Xl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Xl.bottomLeft,Xl.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Xl.bottomRight,Xl.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=R9e();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:s}=e,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if($Tt(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?Xee(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):Xee(i.node,a[s])}_toPixelPosition(e){return{top:HL(e.top),left:HL(e.left),right:HL(e.right),bottom:HL(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(kE).filter(s=>{var n;return r.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};d([m()],Pf.prototype,"_locale",void 0),d([m()],Pf.prototype,"container",null),d([m()],Pf.prototype,"height",null),d([m({value:COe})],Pf.prototype,"padding",null),d([zi("padding")],Pf.prototype,"castPadding",null),d([m()],Pf.prototype,"view",void 0),d([m()],Pf.prototype,"width",null),Pf=d([V("esri.views.ui.UI")],Pf);const ITt=Pf,LTt="randomUUID"in crypto;function TQ(){if(LTt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function t7t(){return`{${TQ().toUpperCase()}}`}function r7t(){return`{${TQ()}}`}const DTt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},NTt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}},FTt=t=>({...NTt,...t}),kTt=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},UTt=(t,e)=>t.find(e),Qhe=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i!=null&&i.children?UTt(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},zTt=t=>{let e;const r={...DTt,...t},i=FTt(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,f,g)=>{var b;let _;i.eventHandlerInterceptor=(w,T,S,C)=>function(P){let R;s("domEvent",P);const L=kTt(P.currentTarget,_.domNode),F=L.some(j=>{var z;return customElements.get((z=j==null?void 0:j.tagName)==null?void 0:z.toLowerCase())});if(P.eventPhase===Event.CAPTURING_PHASE||!F)L.reverse(),R=Qhe(_.getLastRender(),L);else{const j=P.composedPath(),z=j.slice(j.indexOf(P.currentTarget),j.indexOf(_.domNode)).reverse();R=Qhe(_.getLastRender(),z,!0)}let U;return R&&(U=r.handleInterceptedEvent(e,R,this,P)),s("domEventProcessed",P),U},(b=r.postProcessProjectionOptions)==null||b.call(r,i);const v=g();_=p(f,v,i),i.eventHandlerInterceptor=void 0,l.push(_),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let h=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const f=c[p]();s("rendered",void 0),l[p].update(f),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,l,c)),e={renderNow:h,scheduleRender:()=>{n||a||(n=requestAnimationFrame(h))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,f)=>{u(f_.append,p,f)},insertBefore:(p,f)=>{u(f_.insertBefore,p,f)},merge:(p,f)=>{u(f_.merge,p,f)},replace:(p,f)=>{u(f_.replace,p,f)},detach:p=>{for(let f=0;f<c.length;f++)if(c[f]===p)return c.splice(f,1),l.splice(f,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.9.0
 */const AOe="calcite-mode-auto",POe="calcite-mode-dark",BTt="calcite-mode-light",i7t={autoMode:AOe,darkMode:POe,lightMode:BTt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};var Dg={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},VTt=Object.defineProperty,GTt=(t,e)=>{for(var r in e)VTt(t,r,{get:e[r],enumerable:!0})},jTt=t=>{const e=new URL(t,Xo.$resourcesUrl$);return e.origin!==YR.location.origin?e.href:e.pathname},HTt=t=>Xo.$resourcesUrl$=t,ede={},qTt="http://www.w3.org/2000/svg",WTt="http://www.w3.org/1999/xhtml",YTt=t=>t!=null,SQ=t=>(t=typeof t,t==="object"||t==="function");function XTt(t){var e,r,i;return(i=(r=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:r.getAttribute("content"))!=null?i:void 0}var ZTt={};GTt(ZTt,{err:()=>MOe,map:()=>JTt,ok:()=>wW,unwrap:()=>KTt,unwrapErr:()=>QTt});var wW=t=>({isOk:!0,isErr:!1,value:t}),MOe=t=>({isOk:!1,isErr:!0,value:t});function JTt(t,e){if(t.isOk){const r=e(t.value);return r instanceof Promise?r.then(i=>wW(i)):wW(r)}if(t.isErr){const r=t.value;return MOe(r)}throw"should never get here"}var KTt=t=>{if(t.isOk)return t.value;throw t.value},QTt=t=>{if(t.isErr)return t.value;throw t.value},Ww=(t,e="")=>()=>{},eSt="slot-fb{display:contents}slot-fb[hidden]{display:none}",tde="http://www.w3.org/1999/xlink",OOe=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=h=>{for(let p=0;p<h.length;p++)i=h[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!SQ(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?BF(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,iSt);const u=BF(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},BF=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},tSt={},rSt=t=>t&&t.$tag$===tSt,iSt={forEach:(t,e)=>t.map(rde).forEach(e),map:(t,e)=>t.map(rde).map(e).map(sSt)},rde=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),sSt=t=>{if(typeof t.vtag=="function"){const r={...t.vattrs};return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),OOe(t.vtag,r,...t.vchildren||[])}const e=BF(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},nSt=t=>LSt.map(e=>e(t)).find(e=>!!e),oSt=(t,e)=>t!=null&&!SQ(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,aSt=t=>t,s7t=(t,e,r)=>{const i=aSt(t);return{emit:s=>lSt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},lSt=(t,e,r)=>{const i=Xo.ce(e,r);return t.dispatchEvent(i),i},ide=new WeakMap,cSt=(t,e,r)=>{let i=jF.get(t);FSt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,jF.set(t,i)},uSt=(t,e,r)=>{var i;const s=ROe(e,r),n=jF.get(s);if(t=t.nodeType===11?t:vp,n)if(typeof n=="string"){t=t.head||t;let o=ide.get(t),a;if(o||ide.set(t,o=new Set),!o.has(s)){{a=vp.createElement("style"),a.innerHTML=n;const l=(i=Xo.$nonce$)!=null?i:XTt(vp);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=eSt),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},hSt=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=Ww("attachStyles",e.$tagName$),n=uSt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},ROe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),sde=(t,e,r,i,s,n)=>{if(r!==i){let o=hde(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=nde(r),u=nde(i);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):hde(YR,a)?e=a.slice(2):e=a[2]+e.slice(3),r||i){const l=e.endsWith($Oe);e=e.replace(pSt,""),r&&Xo.rel(t,e,r,l),i&&Xo.ael(t,e,i,l)}}else{const l=SQ(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(tde,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(tde,e,i):t.setAttribute(e,i))}}},dSt=/\s/,nde=t=>t?t.split(dSt):[],$Oe="Capture",pSt=new RegExp($Oe+"$"),IOe=(t,e,r)=>{const i=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||ede,n=e.$attrs$||ede;for(const o of ode(Object.keys(s)))o in n||sde(i,o,s[o],void 0,r,e.$flags$);for(const o of ode(Object.keys(n)))sde(i,o,s[o],n[o],r,e.$flags$)};function ode(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var cT,xW,OE,EQ=!1,VF=!1,CQ=!1,su=!1,GF=(t,e,r,i)=>{var s;const n=e.$children$[r];let o=0,a,l,c;if(EQ||(CQ=!0,n.$tag$==="slot"&&(cT&&i.classList.add(cT+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=vp.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=vp.createTextNode("");else{if(su||(su=n.$tag$==="svg"),a=n.$elm$=vp.createElementNS(su?qTt:WTt,n.$flags$&2?"slot-fb":n.$tag$),su&&n.$tag$==="foreignObject"&&(su=!1),IOe(null,n,su),YTt(cT)&&a["s-si"]!==cT&&a.classList.add(a["s-si"]=cT),n.$children$)for(o=0;o<n.$children$.length;++o)l=GF(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?su=!1:a.tagName==="foreignObject"&&(su=!0)}return a["s-hn"]=OE,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=xW,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[r],c&&c.$tag$===n.$tag$&&t.$elm$&&zO(t.$elm$,!1)),a},zO=(t,e)=>{Xo.$flags$|=1;const r=Array.from(t.childNodes);if(t["s-sr"]&&Dg.experimentalSlotFixes){let i=t;for(;i=i.nextSibling;)i&&i["s-sn"]===t["s-sn"]&&i["s-sh"]===OE&&r.push(i)}for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==OE&&s["s-ol"]&&(R_(NOe(s),s,AQ(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,CQ=!0),e&&zO(s,e)}Xo.$flags$&=-2},LOe=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===OE&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=GF(null,r,s,t),a&&(i[s].$elm$=a,R_(o,a,AQ(e))))},DOe=(t,e,r)=>{for(let i=e;i<=r;++i){const s=t[i];if(s){const n=s.$elm$;UOe(s),n&&(VF=!0,n["s-ol"]?n["s-ol"].remove():zO(n,!0),n.remove())}}},fSt=(t,e,r,i,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],h=e[c],p=i.length-1,f=i[0],g=i[p],_,v;for(;n<=c&&o<=p;)if(u==null)u=e[++n];else if(h==null)h=e[--c];else if(f==null)f=i[++o];else if(g==null)g=i[--p];else if(qL(u,f,s))uT(u,f,s),u=e[++n],f=i[++o];else if(qL(h,g,s))uT(h,g,s),h=e[--c],g=i[--p];else if(qL(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&zO(u.$elm$.parentNode,!1),uT(u,g,s),R_(t,u.$elm$,h.$elm$.nextSibling),u=e[++n],g=i[--p];else if(qL(h,f,s))(u.$tag$==="slot"||g.$tag$==="slot")&&zO(h.$elm$.parentNode,!1),uT(h,f,s),R_(t,h.$elm$,u.$elm$),h=e[--c],f=i[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===f.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==f.$tag$?_=GF(e&&e[o],r,a,t):(uT(v,f,s),e[a]=void 0,_=v.$elm$),f=i[++o]):(_=GF(e&&e[o],r,o,t),f=i[++o]),_&&R_(NOe(u.$elm$),_,AQ(u.$elm$))}n>c?LOe(t,i[p+1]==null?null:i[p+1].$elm$,r,i,o,p):o>p&&DOe(e,n,c)},qL=(t,e,r=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:r?!0:t.$key$===e.$key$:!1,AQ=t=>t&&t["s-ol"]||t,NOe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,uT=(t,e,r=!1)=>{const i=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(su=o==="svg"?!0:o==="foreignObject"?!1:su,o==="slot"&&!EQ||IOe(t,e,su),s!==null&&n!==null?fSt(i,s,e,n,r):n!==null?(t.$text$!==null&&(i.textContent=""),LOe(i,null,e,n,0,n.length-1)):s!==null&&DOe(s,0,s.length-1),su&&o==="svg"&&(su=!1)):(l=i["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(i.data=a)},FOe=t=>{const e=t.childNodes;for(const r of e)if(r.nodeType===1){if(r["s-sr"]){const i=r["s-sn"];r.hidden=!1;for(const s of e)if(s!==r){if(s["s-hn"]!==r["s-hn"]||i!==""){if(s.nodeType===1&&(i===s.getAttribute("slot")||i===s["s-sn"])||s.nodeType===3&&i===s["s-sn"]){r.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){r.hidden=!0;break}}}FOe(r)}},Rg=[],kOe=t=>{let e,r,i;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){r=e.parentNode.childNodes;const n=s["s-sn"];for(i=r.length-1;i>=0;i--)if(e=r[i],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!Dg.experimentalSlotFixes)if(ade(e,n)){let o=Rg.find(a=>a.$nodeToRelocate$===e);VF=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],Rg.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&Rg.map(a=>{ade(a.$nodeToRelocate$,e["s-sn"])&&(o=Rg.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else Rg.some(o=>o.$nodeToRelocate$===e)||Rg.push({$nodeToRelocate$:e})}s.nodeType===1&&kOe(s)}},ade=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",UOe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(UOe)},R_=(t,e,r)=>{const i=t==null?void 0:t.insertBefore(e,r);return mSt(e,t),i},zOe=t=>t?t["s-rsc"]||t["s-si"]||t["s-sc"]||zOe(t.parentElement):void 0,mSt=(t,e)=>{var r,i,s;if(t&&e){const n=t["s-rsc"],o=zOe(e);n&&((r=t.classList)!=null&&r.contains(n))&&t.classList.remove(n),o&&(t["s-rsc"]=o,!((i=t.classList)!=null&&i.contains(o))&&((s=t.classList)==null||s.add(o)))}},gSt=(t,e,r=!1)=>{var i,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||BF(null,null),h=rSt(e)?e:OOe(null,null,e);if(OE=l.tagName,c.$attrsToReflect$&&(h.$attrs$=h.$attrs$||{},c.$attrsToReflect$.map(([p,f])=>h.$attrs$[f]=l[p])),r&&h.$attrs$)for(const p of Object.keys(h.$attrs$))l.hasAttribute(p)&&!["key","ref","style","class"].includes(p)&&(h.$attrs$[p]=l[p]);h.$tag$=null,h.$flags$|=4,t.$vnode$=h,h.$elm$=u.$elm$=l.shadowRoot||l,cT=l["s-sc"],EQ=(c.$flags$&1)!==0,xW=l["s-cr"],VF=!1,uT(u,h,r);{if(Xo.$flags$|=1,CQ){kOe(h.$elm$);for(const p of Rg){const f=p.$nodeToRelocate$;if(!f["s-ol"]){const g=vp.createTextNode("");g["s-nr"]=f,R_(f.parentNode,f["s-ol"]=g,f)}}for(const p of Rg){const f=p.$nodeToRelocate$,g=p.$slotRefNode$;if(g){const _=g.parentNode;let v=g.nextSibling;{let b=(i=f["s-ol"])==null?void 0:i.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===f["s-sn"]&&_===w.parentNode){for(w=w.nextSibling;w===f||w!=null&&w["s-sr"];)w=w==null?void 0:w.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&_!==f.parentNode||f.nextSibling!==v)&&f!==v&&(!f["s-hn"]&&f["s-ol"]&&(f["s-hn"]=f["s-ol"].parentNode.nodeName),R_(_,f,v),f.nodeType===1&&(f.hidden=(n=f["s-ih"])!=null?n:!1)),f&&typeof g["s-rf"]=="function"&&g["s-rf"](f)}else f.nodeType===1&&(r&&(f["s-ih"]=(o=f.hidden)!=null?o:!1),f.hidden=!0)}}VF&&FOe(h.$elm$),Xo.$flags$&=-2,Rg.length=0}if(Dg.experimentalScopedSlotChanges&&c.$flags$&2)for(const p of h.$elm$.childNodes)p["s-hn"]!==OE&&!p["s-sh"]&&(r&&p["s-ih"]==null&&(p["s-ih"]=(a=p.hidden)!=null?a:!1),p.hidden=!0);xW=void 0},ySt=(t,e)=>{},PQ=(t,e)=>(t.$flags$|=16,ySt(t,t.$ancestorComponent$),USt(()=>_St(t,e))),_St=(t,e)=>{const r=t.$hostElement$,i=Ww("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;if(!s)throw new Error(`Can't render component <${r.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let n;return e?n=xS(s,"componentWillLoad"):n=xS(s,"componentWillUpdate"),n=lde(n,()=>xS(s,"componentWillRender")),i(),lde(n,()=>bSt(t,s,e))},lde=(t,e)=>vSt(t)?t.then(e):e(),vSt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",bSt=async(t,e,r)=>{const i=t.$hostElement$,s=Ww("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&hSt(t);const n=Ww("render",t.$cmpMeta$.$tagName$);wSt(t,e,i,r),n(),s(),xSt(t)},cde=null,wSt=(t,e,r,i)=>{try{cde=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Dg.hasRenderFn||Dg.reflect)&&(Dg.vdomRender||Dg.reflect)&&(Dg.hydrateServerSide||gSt(t,e,i))}catch(l){WR(l,t.$hostElement$)}return cde=null,null},xSt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=Ww("postUpdate",e),s=r;t.$ancestorComponent$,xS(s,"componentDidRender"),t.$flags$&64?(xS(s,"componentDidUpdate"),i()):(t.$flags$|=64,xS(s,"componentDidLoad"),i())},n7t=t=>{{const e=mC(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&PQ(e,!1),r}},xS=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){WR(i)}},TSt=(t,e)=>mC(t).$instanceValues$.get(e),SSt=(t,e,r,i)=>{const s=mC(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=oSt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const h=i.$watchers$[e];h&&h.map(p=>{try{l[p](r,o,e)}catch(f){WR(f,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;PQ(s,!1)}}}},ESt=(t,e,r)=>{var i;const s=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const n=Object.entries(e.$members$);n.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(s,o,{get(){return TSt(this,o)},set(l){SSt(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;s.attributeChangedCallback=function(a,l,c){Xo.jmp(()=>{var u;const h=o.get(a);if(this.hasOwnProperty(h))c=this[h],delete this[h];else{if(s.hasOwnProperty(h)&&typeof this[h]=="number"&&this[h]==c)return;if(h==null){const p=mC(this),f=p==null?void 0:p.$flags$;if(f&&!(f&8)&&f&128&&c!==l){const _=this,v=(u=e.$watchers$)==null?void 0:u[a];v==null||v.forEach(b=>{_[b]!=null&&_[b].call(_,c,l,a)})}return}}this[h]=c===null&&typeof this[h]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((i=e.$watchers$)!=null?i:{}),...n.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)==null||c.push([a,u])),u})]))}}return t},CSt=async(t,e,r,i)=>{let s;if(!(e.$flags$&32)){e.$flags$|=32,r.$lazyBundleId$;{s=t.constructor;const o=t.localName;customElements.whenDefined(o).then(()=>e.$flags$|=128)}if(s&&s.style){let o=s.style;typeof o!="string"&&(e.$modeName$=nSt(t),e.$modeName$&&(o=o[e.$modeName$]));const a=ROe(r,e.$modeName$);if(!jF.has(a)){const l=Ww("registerStyles",r.$tagName$);cSt(a,o,!!(r.$flags$&1)),l()}}}e.$ancestorComponent$,PQ(e,!0)},ude=t=>{},ASt=t=>{if(!(Xo.$flags$&1)){const e=mC(t),r=e.$cmpMeta$,i=Ww("connectedCallback",r.$tagName$);e.$flags$&1?(BOe(t,e,r.$listeners$),e!=null&&e.$lazyInstance$?ude(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>ude(e.$lazyInstance$))):(e.$flags$|=1,r.$flags$&12&&PSt(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),CSt(t,e,r)),i()}},PSt=t=>{const e=t["s-cr"]=vp.createComment("");e["s-cn"]=!0,R_(t,e,t.firstChild)},MSt=async t=>{if(!(Xo.$flags$&1)){const e=mC(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},o7t=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){ISt(this,r)},connectedCallback(){ASt(this),i&&i.call(this)},disconnectedCallback(){MSt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,ESt(t,r)},a7t=(t,e)=>e,BOe=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=RSt(t,s),l=OSt(e,o),c=$St(s);Xo.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Xo.rel(a,n,l,c))})},OSt=(t,e)=>r=>{try{Dg.lazyLoad||t.$hostElement$[e](r)}catch(i){WR(i)}},RSt=(t,e)=>e&4?vp:e&8?YR:e&16?vp.body:t,$St=t=>DSt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,VOe=new WeakMap,mC=t=>VOe.get(t),ISt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return BOe(t,r,e.$listeners$),VOe.set(t,r)},hde=(t,e)=>e in t,WR=(t,e)=>(0,console.error)(t,e),jF=new Map,LSt=[],YR=typeof window<"u"?window:{},vp=YR.document||{head:{}},l7t=YR.HTMLElement||class{},Xo={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},DSt=(()=>{let t=!1;try{vp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),NSt=t=>Promise.resolve(t),FSt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),TW=!1,SW=[],GOe=[],jOe=(t,e)=>r=>{t.push(r),TW||(TW=!0,e&&Xo.$flags$&4?kSt(EW):Xo.raf(EW))},dde=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){WR(r)}t.length=0},EW=()=>{dde(SW),dde(GOe),(TW=SW.length>0)&&Xo.raf(EW)},kSt=t=>NSt().then(t),c7t=jOe(SW,!1),USt=jOe(GOe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.9.0
 */function pde(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(POe)||t.contains(AOe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function zSt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?pde():document.addEventListener("DOMContentLoaded",()=>pde(),{once:!0}))}const BSt=zSt;BSt();let HOe;function VSt(){try{jTt(".")}catch{HTt(au(ai(HOe)))}}function MQ(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return e.length>0?Promise.all(e):null}HOe="components/assets";const qOe=Symbol("widget"),WOe=Symbol("widget-test-data"),GSt=[],jSt={},HF=new WeakMap;function YOe(t,e){let r=e.children;if(r!=null&&r.length)for(let s=0;s<r.length;++s)r[s]=YOe(t,r[s]);else r=GSt;const i=e.vnodeSelector;if(qF(i)){const s=e.properties||jSt,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:HSt,afterUpdate:qSt,afterRemoved:XOe,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function HSt(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,HF.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i.addHandles(Yr(()=>XOe(t))),queueMicrotask(()=>{o[WOe].projector.renderNow()})}function qSt(t,e,r,{widgetProperties:i}){var n;const s=HF.get(t);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,t))}function XOe(t){var r;const e=HF.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),HF.delete(t))}function qF(t){return typeof t=="function"&&t[qOe]}const XR={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},fde=new Set;function WSt(t){fde.add(t),t.finally(()=>fde.delete(t))}var ZOe;const YSt="esri.widgets.Widget";let XSt=0;const ZSt={widgetIcon:XR.checkboxUnchecked};function JOe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?JOe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const JSt=zTt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e==null?void 0:e(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),u=f=>a==null?void 0:a.call(n,f);n.addEventListener(c,u,l);const h=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=f=>{p==null||p(f),h()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(y_e(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let qB=!1,Qn=class extends UX(Gs.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._projector=JSt,this._readyForTrueRender=!1,this.iconClass=ZSt.widgetIcon,this.icon=null,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=afe(async()=>{var a;if((a=this._messageBundleProps)!=null&&a.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:u})=>{if(this.destroyed)return;let h=await YY(c);this.uiStrings&&Object.keys(this.uiStrings)&&(h=JOe(ge(h),this.uiStrings)),this[u]=h}));if(this.destroyed)return;for(const c of l)c.status==="rejected"&&ae.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),VSt();const i="esri-widget-uid-"+TQ(),s=this.render.bind(this);this._trackingTarget=new p6(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;const a=s();let l=a.properties;l||(a.properties=l={});const{key:c}=l;if(c||(l.key=i),qF(a.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?l.styles||(l.styles={}):(l.class="",l.styles={display:"none"}),l.styles.display||(l.styles.display="");let u=0;return(h=a.children)==null||h.forEach(p=>{if(qF(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${u++}`)}),YOe(this,a)};this.render=()=>{if(qB)return n();let a=A9e(this)??null;if(a)return a;this._trackingTarget.clear(),qB=!0;try{a=r0(this._trackingTarget,n)}catch(l){throw console.error(l),l}finally{qB=!1}return a&&P9e(this,a),a};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),WSt(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){var r;const e=this.loadDependencies();return(r=this._messageBundleProps)!=null&&r.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(mee):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Ae(this._trackingTarget),Ae(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,vU(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return R6(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+XSt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(ZOe=qOe,WOe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(vU(this),this._projector.scheduleRender())}own(e){Ape(ae.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return O9e.apply(this,e)}renderNow(){vU(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this.addHandles(he(()=>this.viewModel,(i,s)=>{s&&this.removeHandles("delegated-events"),i&&u6(i)&&this.addHandles(this._delegatedEventNames.map(n=>UE(i,n,o=>{this.emit(n,o)})),"delegated-events")},si)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(mee),this.scheduleRender()};this.addHandles([NY(e),he(()=>this.uiStrings,e),Ih(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Qn[ZOe]=!0,d([m()],Qn.prototype,"_readyForTrueRender",void 0),d([m({value:null})],Qn.prototype,"container",null),d([zi("container")],Qn.prototype,"castContainer",null),d([m()],Qn.prototype,"iconClass",void 0),d([m()],Qn.prototype,"icon",void 0),d([m()],Qn.prototype,"id",null),d([m()],Qn.prototype,"label",null),d([m()],Qn.prototype,"renderable",null),d([m()],Qn.prototype,"uiStrings",void 0),d([m()],Qn.prototype,"viewModel",void 0),d([m({value:!0})],Qn.prototype,"visible",null),d([m()],Qn.prototype,"key",void 0),d([m()],Qn.prototype,"children",void 0),d([m()],Qn.prototype,"afterCreate",void 0),d([m()],Qn.prototype,"afterUpdate",void 0),d([m()],Qn.prototype,"afterRemoved",void 0),Qn=d([V(YSt)],Qn);const I8=Qn;let e4,t4=null;const TS=new Map;async function h7t(t){t4==null&&(e4==null&&(e4=me(()=>import("./Lyr3DWasmPerSceneView-BPxog9d7.js"),__vite__mapDeps([210,67,68,156]))),t4=await e4);const e=t.view;let r=TS.get(e);return r||(r=new t4.default({view:e}),TS.set(e,r)),await r.initializeWasm(),r.add3DTilesLayerView(t)}function KSt(t){return TS.get(t)}function d7t(t){const e=t.view,r=TS.get(e);r&&r.remove3DTilesLayerView(t)<1&&(TS.delete(e),TS.size===0&&(e4=null,t4=null))}function mde(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function QSt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function A3(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function eEt(t){return t.type==="bing-maps"}const ig=[];let hT=class extends Me{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Mt,this.view=null,this._allLayerViewsChange=r=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=(s=this.view)==null?void 0:s.allLayerViews;i&&(this.addHandles(i.map(n=>he(()=>{var o;return[n.suspended,(o=n.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),r!=null&&r.removed&&r.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([Ho(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Ih(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;if(ig.length=0,!e||!r)return void this._clear();r.forEach(s=>{var a,l;if(s.suspended||!((a=s.layer)!=null&&a.attributionVisible))return;const n=s.layer;if(mde(n,"user"))return void A3(ig,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const c=this._fetchedAttributionData.get(s);return void(c?A3(ig,s,this._getDynamicAttribution(c,e,n)):mde(n)&&A3(ig,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?(l=n.portalItem)==null?void 0:l.accessInformation:void 0;A3(ig,s,o||n.copyright)});const i=r.find(s=>{var n;return((n=s.layer)==null?void 0:n.type)==="integrated-mesh-3dtiles"});if(this.view&&i){const s=KSt(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)A3(ig,i,n[o])}}QSt(this.items,ig)&&(this.items.removeAll(),this.items.addMany(ig)),ig.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await xp(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,eEt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,s={};if(!i)return s;for(let n=0;n<i.length;n++){const o=i[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(r&&l.zoomMin?1:0),h=l.zoomMax-(r&&l.zoomMax?1:0),p=new $r({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Xe.WGS84}),f={extent:rm(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=u;g<=h;g++)s[g]??(s[g]=[]),s[g].push(f)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,r,i){var u;const{extent:s,scale:n}=r;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=KO(s.center.clone().normalize(),r.spatialReference),c=new Set;return a?a.filter(h=>{const p=h.id,f=!c.has(p)&&l&&h.extent&&CY(h.extent,l);return f&&c.add(p),f}).sort((h,p)=>p.score-h.score||h.objectId-p.objectId).map(h=>h.attribution).join(", "):""}};d([m({readOnly:!0,type:Mt})],hT.prototype,"items",void 0),d([m({readOnly:!0})],hT.prototype,"state",null),d([m()],hT.prototype,"view",void 0),hT=d([V("esri.widgets.Attribution.AttributionViewModel")],hT);const KOe=hT,fm={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function tEt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:iEt(t[e])}}}function rEt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function iEt(t){return function(e,...r){rEt(e)?D9e(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function L8(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var sEt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},QOe=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?QOe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=sEt(s)),e.push(s))}},nEt=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return QOe(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function xc(t,e,...r){return typeof t!="function"||qF(t)?nEt(t,e,...r):t(e,...r)}function f7t(...t){return t}const E2="esri-attribution",gv={base:E2,poweredBy:`${E2}__powered-by`,sources:`${E2}__sources`,open:`${E2}--open`,sourcesOpen:`${E2}__sources--open`,link:`${E2}__link`,widgetIcon:XR.description};let Na=class extends I8{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=gv.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new KOe}initialize(){this.addHandles(Ho(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[gv.open]:this._isOpen};return xc("div",{bind:this,class:this.classes(gv.base,fm.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return xc("div",{class:gv.poweredBy},"Powered by"," ",xc("a",{class:gv.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?0:void 0,{attributionText:s}=this,n={[gv.sourcesOpen]:e,[fm.interactive]:r};return xc("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(gv.sources,n),innerHTML:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],Na.prototype,"_isOpen",void 0),d([m()],Na.prototype,"_isInteractive",null),d([m()],Na.prototype,"_attributionTextOverflowed",void 0),d([m()],Na.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Na.prototype,"attributionText",null),d([m()],Na.prototype,"iconClass",void 0),d([m()],Na.prototype,"icon",void 0),d([m()],Na.prototype,"itemDelimiter",void 0),d([m()],Na.prototype,"label",null),d([m(),L8("esri/widgets/Attribution/t9n/Attribution")],Na.prototype,"messages",void 0),d([m()],Na.prototype,"view",null),d([m({type:KOe})],Na.prototype,"viewModel",void 0),d([tEt()],Na.prototype,"_toggleState",null),Na=d([V("esri.widgets.Attribution")],Na);const oEt=Na;function aEt(t){var e,r;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((r=t==null?void 0:t.spatialReference)==null?void 0:r.isGeographic)||!1}const lEt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return l6(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return d([m()],e.prototype,"goToOverride",void 0),d([m()],e.prototype,"view",void 0),e=d([V("esri.widgets.support.GoTo")],e),e},cEt="esri.widgets.CompassViewModel";let lb=class extends lEt(Me){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(he(()=>this.view,this._updateRotationWatcher,ui))}destroy(){this.view=null}get canShowNorth(){return aEt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var r,i;if(!((r=this.view)!=null&&r.ready))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?he(()=>e==null?void 0:e.rotation,this._updateForRotation,ui):he(()=>e==null?void 0:e.camera,this._updateForCamera,ui))}};d([m({readOnly:!0})],lb.prototype,"canShowNorth",null),d([m()],lb.prototype,"orientation",void 0),d([m({readOnly:!0})],lb.prototype,"state",null),d([m()],lb.prototype,"view",void 0),lb=d([V(cEt)],lb);const eRe=lb,gde="esri-compass",WB={base:gde,widgetIcon:XR.locateCircled,iconContainer:`${gde}__icon-container`};let Mf=class extends I8{constructor(e,r){super(e,r),this.iconClass=WB.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new eRe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return MQ({button:()=>me(()=>import("./calcite-button-OAaA1yER.js"),__vite__mapDeps([211,212,213,214,215,216,217,218,219,220,221,222])),icon:()=>me(()=>import("./calcite-icon-WalIfmVe.js"),__vite__mapDeps([223,221,213,214,220]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="rotation"?"arrow-up":"compass-needle",s=this.icon??i,{messages:n}=this;return xc("div",{class:this.classes(WB.base,fm.widget)},xc("calcite-button",{class:fm.widgetButton,disabled:r==="disabled",kind:"neutral",label:n.reset,onclick:this._reset,round:!0,scale:"s",title:n.reset},xc("div",{"aria-hidden":"true",class:WB.iconContainer,title:n.reset},xc("calcite-icon",{icon:s,scale:"m",styles:this._toRotationTransform(e)}))))}};d([m()],Mf.prototype,"goToOverride",null),d([m()],Mf.prototype,"iconClass",void 0),d([m()],Mf.prototype,"icon",void 0),d([m()],Mf.prototype,"label",null),d([m(),L8("esri/widgets/Compass/t9n/Compass")],Mf.prototype,"messages",void 0),d([m()],Mf.prototype,"view",null),d([m({type:eRe})],Mf.prototype,"viewModel",void 0),Mf=d([V("esri.widgets.Compass")],Mf);const uEt=Mf,yde="esri-navigation-toggle",YB={base:yde,widgetIcon:XR.pan2,isLayoutHorizontal:`${yde}--horizontal`};let dT=class extends Me{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(Ih(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,r;return(e=this.view)!=null&&e.ready&&((r=this.view)==null?void 0:r.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){var r;const e=(r=this.view)==null?void 0:r.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};d([m({readOnly:!0})],dT.prototype,"state",null),d([m()],dT.prototype,"navigationMode",void 0),d([m()],dT.prototype,"view",void 0),dT=d([V("esri.widgets.NavigationToggleViewModel")],dT);const tRe=dT;let Of=class extends I8{constructor(e,r){super(e,r),this.iconClass=YB.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new tRe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const i=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;i==null||i.setFocus(),this.toggle()}}loadDependencies(){return MQ({button:()=>me(()=>import("./calcite-button-OAaA1yER.js"),__vite__mapDeps([211,212,213,214,215,216,217,218,219,220,221,222]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var s,n;const e=((s=this.viewModel)==null?void 0:s.state)==="disabled",r=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan",i=this.messages.toggle;return xc("div",{class:this.classes(YB.base,fm.widget,{[YB.isLayoutHorizontal]:this.layout==="horizontal"})},xc("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:r?"outline-fill":"solid",class:fm.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:r?void 0:-1,title:i}),xc("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:r?"solid":"outline-fill",class:fm.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:r?-1:void 0,title:i}))}};d([m()],Of.prototype,"iconClass",void 0),d([m()],Of.prototype,"icon",void 0),d([m()],Of.prototype,"label",null),d([m({value:"vertical"})],Of.prototype,"layout",null),d([m(),L8("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Of.prototype,"messages",void 0),d([m()],Of.prototype,"view",null),d([m({type:tRe})],Of.prototype,"viewModel",void 0),Of=d([V("esri.widgets.NavigationToggle")],Of);const hEt=Of;let cb=class extends Me{get canZoomIn(){var i,s,n;if(!((i=this.view)==null?void 0:i.ready))return!1;const r=(n=(s=this.view)==null?void 0:s.constraints)==null?void 0:n.effectiveMaxScale;return r===0||this._scale>r}get canZoomOut(){var s;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const i=(s=e.constraints)==null?void 0:s.effectiveMinScale;return i===0||this._scale<i}get _scale(){var r,i,s;const e=(i=(r=this.view)==null?void 0:r.animation)==null?void 0:i.target;return(e&&"then"in e||e==null?void 0:e.scale)??((s=this.view)==null?void 0:s.scale)??0}};d([m({readOnly:!0})],cb.prototype,"canZoomIn",null),d([m({readOnly:!0})],cb.prototype,"canZoomOut",null),d([m()],cb.prototype,"view",void 0),d([m()],cb.prototype,"_scale",null),cb=d([V("esri.widgets.Zoom.ZoomConditions2D")],cb);const dEt=cb;let pT=class extends Me{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],pT.prototype,"canZoomIn",null),d([m({readOnly:!0})],pT.prototype,"canZoomOut",null),d([m()],pT.prototype,"view",void 0),pT=d([V("esri.widgets.Zoom.ZoomConditions3D")],pT);const pEt=pT;let Vy=class extends Me{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new dEt({view:e}):e.type==="3d"&&(this._zoomConditions=new pEt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():IM(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():IM(e.goTo({zoomFactor:.5}))}};d([m()],Vy.prototype,"_zoomConditions",void 0),d([m()],Vy.prototype,"canZoomIn",null),d([m()],Vy.prototype,"canZoomOut",null),d([m({readOnly:!0})],Vy.prototype,"state",null),d([m()],Vy.prototype,"view",null),Vy=d([V("esri.widgets.Zoom.ZoomViewModel")],Vy);const rRe=Vy,XB={base:"esri-zoom",widgetIcon:XR.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let Rf=class extends I8{constructor(e,r){super(e,r),this.iconClass=XB.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new rRe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return MQ({button:()=>me(()=>import("./calcite-button-OAaA1yER.js"),__vite__mapDeps([211,212,213,214,215,216,217,218,219,220,221,222]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[XB.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return xc("div",{class:this.classes(XB.base,fm.widget,e)},xc("calcite-button",{class:fm.widgetButton,disabled:!r,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),xc("calcite-button",{class:fm.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};d([m()],Rf.prototype,"iconClass",void 0),d([m()],Rf.prototype,"icon",void 0),d([m()],Rf.prototype,"label",null),d([m({value:"vertical"})],Rf.prototype,"layout",null),d([m(),L8("esri/widgets/Zoom/t9n/Zoom")],Rf.prototype,"messages",void 0),d([m()],Rf.prototype,"view",null),d([m({type:rRe})],Rf.prototype,"viewModel",void 0),Rf=d([V("esri.widgets.Zoom")],Rf);const fEt=Rf;function mEt(t){return(t==null?void 0:t.view)!==void 0}let r4=class extends ITt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const s=this._find(i),n=s==null?void 0:s.widget;mEt(n)&&(n.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([he(()=>this.components,this._componentsWatcher,ui),he(()=>this.view,this._updateViewAwareWidgets,ui)])}_add(e,r,i,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,s,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new QN({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new oEt({view:r});case"compass":return new uEt({view:r});case"navigation-toggle":return new hEt({view:r});case"zoom":return new fEt({view:r})}}};d([m()],r4.prototype,"components",void 0),r4=d([V("esri.views.ui.DefaultUI")],r4);const iRe=r4;let i4=class extends iRe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],i4.prototype,"components",void 0),i4=d([V("esri.views.ui.3d.DefaultUI3D")],i4);const sRe=i4;let Ye=class extends LUe(PVe(Z9e(wHe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new l0({slicePlane:Dye},this),this._resourceController=Y0t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new tq({view:this}),this.labeler=new tb({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new eE,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new gb,this.environment=new X2,this.environmentManager=new Sd,this.floors=new Mt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new SHe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Zgt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new sRe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new iPe,V6e();const r=(i=null)=>{i!=null&&i.type===vi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async s=>{try{await s.when()}catch{}this._updatingChanged()}))};this.addHandles([Ho(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>r(i),{onListenerAdd:()=>r(),onListenerRemove:()=>r(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),he(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new wQe({view:this}),this.stateManager=new Hs({view:this})}initialize(){this.groundView=new mVe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.addHandles(Ho(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,r=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=r)},ui),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,r=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=r)},ui),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,r=>UIe(r>0?1e3/Math.ceil(r):0),ui),this.updatingHandles.add(()=>{var r;return(r=this.map)==null?void 0:r.ground},e,si),this.updatingHandles.add(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),si),this.addHandles(he(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ti))}destroy(){var e;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ae(this.sharedSymbolResources),this._set("labeler",Ae(this.labeler)),this._set("deconflictor",Ae(this.deconflictor)),this._resourceController=Ae(this._resourceController),this._set("stateManager",Ae(this.stateManager)),this._set("inputManager",Ae(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Ae(this.environmentManager)),this._set("environment",Ae(this.environment)),this.groundView=Ae(this.groundView),this._exitBasemapTerrain(),(e=this._stage)==null||e.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}get animation(){var e;return(e=this.state)==null?void 0:e.animation}get camera(){var e;return(e=this.stateManager)==null?void 0:e.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){var e;return(e=this.stateManager)==null?void 0:e.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){var e;return(e=this.stateManager)==null?void 0:e.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;const e=this.map;let r=this._userClippingArea||oee(e,"clippingArea");return!this._userClippingArea&&!oee(e,"clippingEnabled")||r==null?(this._clippingArea=null,null):r instanceof $r?this.spatialReference&&(r=WL(r,this.spatialReference),r==null)?(ae.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(r=r.clone(),r.intersection(this._groundAndLayersExtent)==null&&(r.xmin=r.xmax,r.ymin=r.ymax),r.zmin=void 0,r.zmax=void 0,r.equals(this._clippingArea)||(this._clippingArea=r),this._clippingArea):(ae.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?ae.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ne.Global)return null;const e=this.renderSpatialReference,r=this.dataExtent;return r==null||e==null||r.spatialReference.equals(e)?r:WL(r,e)}get dataExtent(){let e=this._groundAndLayersExtent;const r=this.spatialReference||Xe.WGS84,i=WL(this.clippingArea,r);i!=null&&(e=e!=null?e.intersection(i):i);const s=this._get("dataExtent");return e!=null&&e.equals(s)?s:e}get _groundAndLayersExtent(){const e=this.spatialReference||Xe.WGS84;let r;const i=o=>{const a=WL(o,e);a!=null&&(r!=null?r.union(a):r=a.clone())},s=this.basemapTerrain;if(s!=null&&s.spatialReference){const o=s.groundExtent;i(new $r({xmin:o[0],ymin:o[1],zmin:0,xmax:o[2],ymax:o[3],zmax:0,spatialReference:s.spatialReference}))}if(this.map){const o=a=>{a.fullExtent==null||a.type==="graphics"&&a.internal||i(a.fullExtent)};this.map.allLayers.forEach(a=>o(a))}if(r==null)return null;r.hasZ?(r.zmin=Math.min(0,r.zmin??0),r.zmax=Math.max(0,r.zmax??0)):(r.zmin=0,r.zmax=0);const n=this._get("_groundAndLayersExtent");return r.equals(n)?n:r}castEnvironment(e){var r;return e?e instanceof X2?e:e instanceof Sbe?((r=this.environment)==null?void 0:r.cloneWithWebsceneEnvironment(e))??X2.fromWebsceneEnvironment(e):ma(X2,e):new X2}get extent(){var e;return(e=this.stateManager)==null?void 0:e.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){var e;return(e=this.stateManager)==null?void 0:e.screenCenter}get frustum(){var e;return(e=this.stateManager)==null?void 0:e.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var e;return this.navigating||(((e=this.toolViewManager)==null?void 0:e.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var e;return((e=this.state)==null?void 0:e.navigating)??!1}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){DN.isValidProfile(e)&&(DN.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||DN.getDefaultProfile()}set slicePlane(e){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:e}),e==null)return void this._set("slicePlane",null);const r=this._propertiesPool.get("slicePlane");tx(e,r),this._set("slicePlane",r)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&this.stateManager.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?bUe(this.scale,this.spatialReference):0}get scale(){var e;return(e=this.stateManager)==null?void 0:e.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?oR.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var n,o,a,l;if(this.destroyed)return!1;let e=0,r=this.layerViewManager.updating,i=r?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(c=>{if(c.isFulfilled()){if(c.updating){if(r=!0,c.suspended||Zq(c))return;++i,e+=c.updatingProgress}}else++i});for(const c of this._updatingObjects)c!=null&&c.updating&&(i+=.1,e+=.5*.1);for(const c of this._updatingObjectsWithProgress)c!=null&&c.updating&&(++i,e+=c.updatingProgress);const s=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(r=!!(r||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||s||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(a=(o=this.map)==null?void 0:o.allLayers)!=null&&a.some(c=>!c.isFulfilled())||(l=this.textures)!=null&&l.updating),r?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=r?0:1,this._get("updatingProgress")!==e){const c=performance.now();if(e<1){const u=Math.min((c-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-u)+e*u}this._set("updatingProgress",e),this._lastUpdateTime=r&&e<1?c:0}return r}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(e!=null)return xU(e);const r=this.spatialReference;return r?((i=this.defaultsFromMap)==null?void 0:i.viewingMode)!=null&&r.equals(this.defaultsFromMap.spatialReference)?xU(this.defaultsFromMap.viewingMode):LG(r,Ne.Global)?"global":"local":"global"}set viewingMode(e){this.ready?ae.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){var e;return(e=this.stateManager)==null?void 0:e.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get quality(){var e,r;return((r=(e=this._resourceController)==null?void 0:e.memoryController)==null?void 0:r.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new J0t(this)}on(e,r,i,s){return this.viewEvents.on(e,r,i,s)||super.on(e,r)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,r){if(!this.ready)return ae.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=gie(e)?mie(this,e):e;return h0t(this,i,r,this._defaultToMapOptions)}toScreen(e){if(!this.ready)return ae.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const r=(e.z==null?Wf(this.elevationProvider,e):null)??0;return Qa(e,YL,this.renderSpatialReference,r),this.state.camera.projectToScreen(YL,ZB),Lh(ZB[0],ZB[1])}pixelSizeAt(e){return this.ready?e?(Qa(e,YL,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(YL)):0:(ae.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const r=this.basemapTerrain.overlayManager;return r?r.overlayPixelSizeInMapUnits(e,()=>this.pixelSizeAt(e)):1}hitTest(e,r){if(!this.ready)return ae.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=gie(e)?mie(this,e):e;return u0t(this,i,r,this._defaultHitTestOptions)}async popupHitTest(e){return P0t(this,e)}goTo(e,r){return this.updatingHandles.addPromise(this.stateManager.goTo(e,r))}async whenAnalysisView(e){if(e.parent==null)throw new J("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const r=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(r);return zB(i,r,this._pixelFormat())}async _takeScreenshot(e){const r=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(r);return BB(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const r=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(r);return[BB(i[0],this._pixelFormat()),BB(i[1],this._pixelFormat())]}_completeSettings(e){const r=tTt(e,this);return r.pixelRatio/=this.state.pixelRatio,nTt(r,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e),takeScreenshotWithObjectAndLayerId:e=>this._takeScreenshotWithObjectAndLayerId(e)}}async takeScreenshotWithObjectAndLayerId(e){if(!se("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const r=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(r),s=zB(i[0],r,this._pixelFormat()),n=this._completeSettings(e);return n.format="png",[s,zB(i[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Sie.importLayerView(e)}hasLayerViewModule(e){return Sie.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=this.map.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=TTt(this.type);const r=se("safari");if(r&&r<9&&(e=new J("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:r})),e!=null)throw ae.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){var r;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(r=this.map.initialViewProperties)==null?void 0:r.viewingMode:null)??null;return e!=null?fre(e):null}getSpatialReferenceSupport({spatialReference:e,layer:r}){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(e,r,i)?{constraints:this._makeSpatialReferenceConstraints(e,r,i)}:null;const s=this._validateSpatialReferenceForViewingMode(e,r,Ne.Local),n=this._validateSpatialReferenceForViewingMode(e,r,Ne.Global);return s||n?s&&n?{constraints:this._makeSpatialReferenceConstraints(e,r,null)}:s?{constraints:this._makeSpatialReferenceConstraints(e,r,Ne.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,r,Ne.Global)}:null}_validateSpatialReferenceForViewingMode(e,r,i){return!!LG(e,i)&&(r==null||!!rre(r)||(!VP(r)||M8(r,e,i)!=null)&&(!tre(r)||i!==Ne.Global))}_makeSpatialReferenceConstraints(e,r,i){if(r==null)return[{spatialReference:e,viewingMode:i}];const s=e.isWebMercator,n=e.isWGS84;return rre(r)&&(s||n)?!n||i===Ne.Local||jK(r.tileInfo,r.fullExtent,e,Ne.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:Xe.WebMercator,viewingMode:i}]:[{spatialReference:s?Xe.WGS84:Xe.WebMercator,viewingMode:i}]:VP(r)||tre(r)||!s&&!n?VP(r)&&s&&i!==Ne.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Xe.WGS84,viewingMode:Ne.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:s?Xe.WGS84:Xe.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const r=this.getSpatialReferenceSupport({spatialReference:e})!=null,i=this._predeterminedViewingMode;return r||(i!=null?ae.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${xU(i)} viewing mode.`):e.isGeographic&&ae.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),r}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}trackGraphicState(e){if(!e.graphic)return ae.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const r=this.getViewForGraphic(e.graphic);let i=null,s=!1;const n=o=>{var a;!s&&o!=null&&"processor"in o&&((a=o.processor)==null?void 0:a.type)==="graphics-3d"&&o.processor.graphicsCore&&(i=o.processor.graphicsCore.trackGraphicState(e))};return r!=null?n(r):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(o=>n(o),()=>{}).catch(()=>{}),Yr(()=>{s=!0,i!=null&&(i.remove(),i=null)})}highlight(e){if(Array.isArray(e))return mw(e.map(i=>this.highlight(i)));if(Mt.isCollection(e))return mw(e.toArray().map(i=>this.highlight(i)));const r=this.getViewForGraphic(e);return r&&"highlight"in r?r.highlight(e):Yr()}maskOccludee(e){if(!e)return ae.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const r=this.getViewForGraphic(e);let i=null,s=!1;const n=o=>{!s&&o!=null&&vTt(o)&&(i=o.maskOccludee(e))};return r!=null?n(r):this.whenViewForGraphic(e,{waitForLayer:!0}).then(o=>n(o),()=>{}).catch(()=>{}),Yr(()=>{s=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(r=>r.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,r){if(e.layer===this)return await GS(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new J("no-view-for-graphic");return r&&r.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,s)=>{const n=this.map.allLayers.on("change",o=>{o.added.includes(e.layer)&&(n.remove(),this.whenLayerView(e.layer).then(i,s))})}):this.whenLayerView(e.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new Yvt({view:this})),this._set("elevationProvider",new hP({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new bl({view:this})),this._set("featureTiles",new vo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const r=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||r)if(r&&this.basemapTerrain.spatialReference){const s=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?p1(C6(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(s):this.featureTiles.filterExtent=s}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>yi.FEATURE_TILE_TREE_SHOW_TILES,r=>{r&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(me(()=>import("./FeatureTileTree3DDebugger-CNYtCSV7.js"),__vite__mapDeps([224,209]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&yi.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):r||!this._featureTreeDebugger||yi.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},si),this.updatingHandles.add(()=>this.clippingArea,e,si),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,si)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new E0t(this.map,e));const r=this.state.isGlobal,i=vUe(r,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",$0t.create(this.state.viewingMode,i)),r||this.addHandles(he(()=>{var s;return(s=this.basemapTerrain)==null?void 0:s.extent},s=>{const n=this.renderCoordsHelper.spatialReference;s==null||s[0]===0&&s[1]===0&&s[2]===0&&s[3]===0||!G6(s,this.basemapTerrain.spatialReference,_de,n)||(this.renderCoordsHelper.extent=_de)},ti),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(iE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===vi.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(r=>{r.destroyed||(this.addHandles(he(()=>[r.updating,r.updatingProgress],()=>this._updatingChanged(),ti),"updatingMonitors"),r.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,r,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const s=e.getContext("2d");return s.putImageData(i,0,0),this.overlay.renderCanvas(e,{disableDecorations:r===Cl.OFF}),s.getImageData(0,0,i.width,i.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n,o)=>this._renderScreenshotOverlay(s,n,o)}},r=new f0t(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",r);const i=R6(this.surface);this._stage=new Xc({view:this,options:e,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),ui),he(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,si),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()}),UE(this._stage.renderView.canvas,"webglcontextlost",s=>{this.fatalError=new J("webgl-context-lost",s.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(iE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ae(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new eyt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const r=(await me(async()=>{const{default:i}=await import("./GraphicsView3D-Dki-6eUM.js");return{default:i}},__vite__mapDeps([225,163,41,150,74,52,57,73,23,21,4,24,16,17,124]))).default;vt(e),await GS(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new r({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var s;const e=fre(this.viewingMode);e===Ne.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles(Ho(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const r=this.map&&"initialViewProperties"in this.map?(s=this.map.initialViewProperties)==null?void 0:s.environment:void 0;r&&P0e(this.environment,r),this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new UT(this._stage,this.resourceController.scheduler));const i=this._resolveWhenReady;this._resolveWhenReady=[],i.forEach(n=>n(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Ae(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(G_);for(const e of this.map.allLayers.items)KM(e.type)&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(G_);for(const e of this.map.allLayers.items)KM(e.type)&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}};function WL(t,e){return t!=null&&Dh(t.spatialReference,e)?p1(t,e):null}Ye.type="3d",d([m()],Ye.prototype,"_userClippingArea",void 0),d([m()],Ye.prototype,"_resourceController",void 0),d([m()],Ye.prototype,"_stage",void 0),d([m({readOnly:!0})],Ye.prototype,"deconflictor",void 0),d([m({readOnly:!0})],Ye.prototype,"labeler",void 0),d([m(Z4(eE,"analyses"))],Ye.prototype,"analyses",void 0),d([m({type:lE,readOnly:!0})],Ye.prototype,"animation",null),d([m({readOnly:!0})],Ye.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],Ye.prototype,"elevationProvider",void 0),d([m()],Ye.prototype,"camera",null),d([m({type:xu})],Ye.prototype,"contentCamera",null),d([m({readOnly:!0})],Ye.prototype,"canvas",void 0),d([m({type:Ke})],Ye.prototype,"center",null),d([m({type:$r})],Ye.prototype,"clippingArea",null),d([m({type:gb})],Ye.prototype,"constraints",void 0),d([m({type:$r,readOnly:!0})],Ye.prototype,"renderDataExtent",null),d([m({type:$r,readOnly:!0})],Ye.prototype,"dataExtent",null),d([m({type:$r,readOnly:!0})],Ye.prototype,"_groundAndLayersExtent",null),d([m({type:X2})],Ye.prototype,"environment",void 0),d([zi("environment")],Ye.prototype,"castEnvironment",null),d([m({readOnly:!0})],Ye.prototype,"environmentManager",void 0),d([m({type:$r})],Ye.prototype,"extent",null),d([m()],Ye.prototype,"floors",void 0),d([m()],Ye.prototype,"screenCenter",null),d([m()],Ye.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],Ye.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],Ye.prototype,"graphicsView",void 0),d([m({readOnly:!0})],Ye.prototype,"analysisViewManager",void 0),d([m()],Ye.prototype,"groundView",void 0),d([m({type:Boolean})],Ye.prototype,"initialExtentRequired",null),d([m()],Ye.prototype,"_defaultsFromMapSettings",null),d([m()],Ye.prototype,"interacting",null),d([m()],Ye.prototype,"stationary",null),d([m()],Ye.prototype,"navigating",null),d([m()],Ye.prototype,"map",void 0),d([m({readOnly:!0})],Ye.prototype,"mapCoordsHelper",void 0),d([m()],Ye.prototype,"padding",null),d([m({type:bl,readOnly:!0})],Ye.prototype,"pointsOfInterest",void 0),d([m({type:vo,readOnly:!0})],Ye.prototype,"featureTiles",void 0),d([m()],Ye.prototype,"_featureTreeDebugger",void 0),d([m({type:Boolean})],Ye.prototype,"screenSizePerspectiveEnabled",void 0),d([m({constructOnly:!0})],Ye.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],Ye.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],Ye.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],Ye.prototype,"state",void 0),d([m({readOnly:!0})],Ye.prototype,"inputManager",void 0),d([m({readOnly:!0})],Ye.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],Ye.prototype,"qualityProfile",null),d([m({type:Yce,get(){let t=this._get("qualitySettings");return t||(t=new Yce,DN.apply(this.qualityProfile,t)),t}})],Ye.prototype,"qualitySettings",void 0),d([m()],Ye.prototype,"slicePlane",null),d([m({readOnly:!0})],Ye.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],Ye.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],Ye.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ye.prototype,"resolution",null),d([m({type:Number})],Ye.prototype,"scale",null),d([m()],Ye.prototype,"heightModelInfo",null),d([m()],Ye.prototype,"spatialReference",void 0),d([m({type:Boolean,constructOnly:!0})],Ye.prototype,"alphaCompositingEnabled",void 0),d([m({constructOnly:!0})],Ye.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],Ye.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],Ye.prototype,"type",void 0),d([m(),zi(t=>t instanceof iRe?t:_w(sRe,t))],Ye.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Ye.prototype,"updating",null),d([m()],Ye.prototype,"_updatingObjects",null),d([m()],Ye.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],Ye.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],Ye.prototype,"viewingMode",null),d([m({type:wp})],Ye.prototype,"viewpoint",null),d([m({type:Number})],Ye.prototype,"zoom",null),d([m({type:iPe})],Ye.prototype,"highlightOptions",void 0),d([m({readOnly:!0})],Ye.prototype,"quality",null),d([m({readOnly:!0})],Ye.prototype,"resolutionScale",null),d([m()],Ye.prototype,"textures",void 0),Ye=d([V("esri.views.SceneView")],Ye);const YL=E(),ZB=us(),_de=jt(),gEt=Ye,vde={read:{reader:nut},write:{allowNull:!0,writer:out}},nRe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([m({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),d([m({json:{read:!1,write:!1,origins:{"web-map":vde,"portal-item":vde}}})],e.prototype,"effect",void 0),e=d([V("esri.layers.mixins.BlendLayer")],e),e},oRe=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&yEt(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),d([m({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=d([V("esri.layers.mixins.ScaleRangeLayer")],e),e};function yEt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var CW;let SP=CW=class extends We{constructor(t){super(t)}async collectRequiredFields(t,e){return q_(t,e,this.expression)}clone(){return new CW({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([m({type:String,json:{write:!0}})],SP.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],SP.prototype,"title",void 0),SP=CW=d([V("esri.layers.support.FeatureExpressionInfo")],SP);const bde=SP;var AW;const XL=Ul()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),wde=new Yo({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let bg=AW=class extends We{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new AW({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&tIe(this.featureExpressionInfo,t.featureExpressionInfo)}};d([m({type:bde,json:{write:!0}})],bg.prototype,"featureExpressionInfo",void 0),d([Tr("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],bg.prototype,"readFeatureExpressionInfo",null),d([lr("featureExpressionInfo",{featureExpressionInfo:{type:bde},"featureExpression.value":{type:[0]}})],bg.prototype,"writeFeatureExpressionInfo",null),d([m({type:XL.apiValues,nonNullable:!0,json:{type:XL.jsonValues,read:XL.read,write:{writer:XL.write,isRequired:!0}}})],bg.prototype,"mode",null),d([m({type:Number,json:{write:!0}})],bg.prototype,"offset",void 0),d([m({type:Stt,json:{type:String,read:wde.read,write:wde.write}})],bg.prototype,"unit",null),bg=AW=d([V("esri.layers.support.ElevationInfo")],bg);const aRe=bg;let wg=class extends nRe(oRe(qX)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new iw,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};d([m({type:aRe})],wg.prototype,"elevationInfo",void 0),d([m(Z4(iw,"graphics"))],wg.prototype,"graphics",void 0),d([m({type:["show","hide"]})],wg.prototype,"listMode",void 0),d([m()],wg.prototype,"screenSizePerspectiveEnabled",void 0),d([m({readOnly:!0})],wg.prototype,"type",void 0),d([m({constructOnly:!0})],wg.prototype,"internal",void 0),wg=d([V("esri.layers.GraphicsLayer")],wg);const _Et=wg;var xde={},JB={},KB=34,P3=10,QB=13;function lRe(t){return new Function("d","return {"+t.map(function(e,r){return JSON.stringify(e)+": d["+r+'] || ""'}).join(",")+"}")}function vEt(t,e){var r=lRe(t);return function(i,s){return e(r(i),s,t)}}function Tde(t){var e=Object.create(null),r=[];return t.forEach(function(i){for(var s in i)s in e||r.push(e[s]=s)}),r}function rc(t,e){var r=t+"",i=r.length;return i<e?new Array(e-i+1).join(0)+r:r}function bEt(t){return t<0?"-"+rc(-t,6):t>9999?"+"+rc(t,6):rc(t,4)}function wEt(t){var e=t.getUTCHours(),r=t.getUTCMinutes(),i=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":bEt(t.getUTCFullYear())+"-"+rc(t.getUTCMonth()+1,2)+"-"+rc(t.getUTCDate(),2)+(s?"T"+rc(e,2)+":"+rc(r,2)+":"+rc(i,2)+"."+rc(s,3)+"Z":i?"T"+rc(e,2)+":"+rc(r,2)+":"+rc(i,2)+"Z":r||e?"T"+rc(e,2)+":"+rc(r,2)+"Z":"")}function xEt(t){var e=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function i(h,p){var f,g,_=s(h,function(v,b){if(f)return f(v,b-1);g=v,f=p?vEt(v,p):lRe(v)});return _.columns=g||[],_}function s(h,p){var f=[],g=h.length,_=0,v=0,b,w=g<=0,T=!1;h.charCodeAt(g-1)===P3&&--g,h.charCodeAt(g-1)===QB&&--g;function S(){if(w)return JB;if(T)return T=!1,xde;var P,R=_,L;if(h.charCodeAt(R)===KB){for(;_++<g&&h.charCodeAt(_)!==KB||h.charCodeAt(++_)===KB;);return(P=_)>=g?w=!0:(L=h.charCodeAt(_++))===P3?T=!0:L===QB&&(T=!0,h.charCodeAt(_)===P3&&++_),h.slice(R+1,P-1).replace(/""/g,'"')}for(;_<g;){if((L=h.charCodeAt(P=_++))===P3)T=!0;else if(L===QB)T=!0,h.charCodeAt(_)===P3&&++_;else if(L!==r)continue;return h.slice(R,P)}return w=!0,h.slice(R,g)}for(;(b=S())!==JB;){for(var C=[];b!==xde&&b!==JB;)C.push(b),b=S();p&&(C=p(C,v++))==null||f.push(C)}return f}function n(h,p){return h.map(function(f){return p.map(function(g){return u(f[g])}).join(t)})}function o(h,p){return p==null&&(p=Tde(h)),[p.map(u).join(t)].concat(n(h,p)).join(`
`)}function a(h,p){return p==null&&(p=Tde(h)),n(h,p).join(`
`)}function l(h){return h.map(c).join(`
`)}function c(h){return h.map(u).join(t)}function u(h){return h==null?"":h instanceof Date?wEt(h):e.test(h+="")?'"'+h.replace(/"/g,'""')+'"':h}return{parse:i,parseRows:s,format:o,formatBody:a,formatRows:l,formatRow:c,formatValue:u}}var TEt=xEt(","),SEt=TEt.parse;function EEt(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function CEt(t,e){return fetch(t,e).then(EEt)}function AEt(t){return function(e,r,i){return arguments.length===2&&typeof r=="function"&&(i=r,r=void 0),CEt(e,r).then(function(s){return t(s,i)})}}var PEt=AEt(SEt);let MEt=class cRe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(fV),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new cRe,i=this._originStores[xr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,ge(s),xr.DEFAULTS)});for(let s=xr.SERVICE;s<fV;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,ge(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=xr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=xr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i==null?void 0:i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||xr.DEFAULTS}forEach(e){this._values.forEach(e)}};const uRe=t=>{let e=class extends t{constructor(...r){super(...r);const i=Nl(this),s=i.store,n=new MEt;i.store=n,Xfe(i,s,n)}read(r,i){Jfe(this,r,i)}getAtOrigin(r,i){const s=eV(this),n=a_(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return p4(this.originIdOf(r))}originIdOf(r){return eV(this).originOf(r)}revert(r,i){const s=eV(this),n=a_(i),o=Nl(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=d([V("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function eV(t){return Nl(t).store}let Sde=class extends uRe(Me){};Sde=d([V("esri.core.ReadOnlyMultiOriginJSONSupport")],Sde);const OEt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return tV(this).delete(r,a_(i))}write(r,i){return Qfe(this,r=r||{},i),r}setAtOrigin(r,i,s){Nl(this).setAtOrigin(r,i,a_(s))}removeOrigin(r){const i=tV(this),s=a_(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),xr.USER)}updateOrigin(r,i){const s=tV(this),n=a_(i),o=up(this,r);for(let a=n+1;a<fV;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=d([V("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function tV(t){return Nl(t).store}const hRe=t=>{let e=class extends OEt(uRe(t)){constructor(...r){super(...r)}};return e=d([V("esri.core.MultiOriginJSONSupport")],e),e};let Ede=class extends hRe(Me){};Ede=d([V("esri.core.MultiOriginJSONSupport")],Ede);function REt(t){return"portalItem"in t}const $Et=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):REt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return d([m({type:String})],e.prototype,"apiKey",null),e=d([V("esri.layers.mixins.APIKeyMixin")],e),e};let IEt=class{constructor(e,r=0,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=r,this.maxLOD=i,e.lodAt(r)||(this.minLOD=e.lods[0].level),e.lodAt(i)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,r,i){var n;const s=(n=this.tileInfo)==null?void 0:n.lodAt(e);return!s||e<this.minLOD||e>this.maxLOD?"unavailable":s.cols&&s.rows?i>=s.cols[0]&&i<=s.cols[1]&&r>=s.rows[0]&&r<=s.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,r,i,s){await g4(s);const n=this.getAvailability(e,r,i);if(n==="unavailable")throw new J("tile-map:tile-unavailable","Tile is not available",{level:e,row:r,col:i});return n}async fetchAvailabilityUpsample(e,r,i,s,n){await g4(n),s.level=e,s.row=r,s.col=i;const o=this.tileInfo;return o.updateTileInfo(s),this.fetchAvailability(e,r,i,n).catch(a=>{if(ns(a))throw a;if(o.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,n);throw a})}};function LEt(t,e=!1){return t<=Cc?e?new Array(t).fill(0):new Array(t):new Uint32Array(t)}let Cde=class PW{constructor(e){this._validateJSON(e);const{location:r,data:i}=e;this.location=Object.freeze(ge(r));const s=this.location.width,n=this.location.height;let o=!0,a=!0;const l=Math.ceil(s*n/32),c=LEt(l);let u=0;for(let h=0;h<i.length;h++){const p=h%32;i[h]?(a=!1,c[u]|=1<<p):o=!1,p===31&&++u}a?(this._availability="unavailable",this.byteSize=40):o?(this._availability="available",this.byteSize=40):(this._availability=c,this.byteSize=40+t0(c))}getAvailability(e,r){if(this._availability==="unavailable"||this._availability==="available")return this._availability;const i=(e-this.location.top)*this.location.width+(r-this.location.left),s=i%32,n=i>>5,o=this._availability;return n<0||n>o.length?"unknown":o[n]&1<<s?"available":"unavailable"}static fromDefinition(e,r){const i=e.service.request||Wr,{row:s,col:n,width:o,height:a}=e,l={query:{f:"json"}};return r=r?{...l,...r}:l,i(DEt(e),r).then(c=>c.data).catch(c=>{if(c&&c.details&&c.details.httpStatus===422)return{location:{top:s,left:n,width:o,height:a},valid:!0,data:F$e(o*a,0)};throw c}).then(c=>{if(c.location&&(c.location.top!==s||c.location.left!==n||c.location.width!==o||c.location.height!==a))throw new J("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:s,left:n,width:o,height:a}});return PW.fromJSON(c)})}static fromJSON(e){return Object.freeze(new PW(e))}_validateJSON(e){if(!(e!=null&&e.location))throw new J("tilemap:missing-location","Location missing from tilemap response");if(e.valid===!1)throw new J("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new J("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new J("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new J("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}};function Ade(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function DEt(t){var i;let e;if((i=t.service.tileServers)!=null&&i.length){const s=t.service.tileServers;e=`${s&&s.length?s[t.row%s.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else e=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;const r=t.service.query;return r&&(e=`${e}?${r}`),e}var Pb;let ih=Pb=class extends Me{constructor(t){super(t),this._pendingTilemapRequests={},this.request=Wr,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new QCe(2*AF.MEGABYTES),this.addHandles(he(()=>{const{layer:t}=this;return[t==null?void 0:t.parsedUrl,t==null?void 0:t.tileServers,t==null?void 0:t.apiKey,t==null?void 0:t.customParameters]},()=>this._initializeTilemapDefinition(),ui))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}fetchTilemap(t,e,r,i){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return Promise.reject(new J("tilemap-cache:level-unavailable",`Level ${t} is unavailable in the service`));const s=this._tmpTilemapDefinition,n=this._tilemapFromCache(t,e,r,s);if(n)return Promise.resolve(n);const o=i==null?void 0:i.signal;return i={...i,signal:null},new Promise((a,l)=>{lo(o,()=>l(hr()));const c=Ade(s);let u=this._pendingTilemapRequests[c];if(!u){u=Cde.fromDefinition(s,i).then(p=>(this._tilemapCache.put(c,p,p.byteSize),p));const h=()=>{delete this._pendingTilemapRequests[c]};this._pendingTilemapRequests[c]=u,u.then(h,h)}u.then(a,l)})}getAvailability(t,e,r){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return"unavailable";const i=this._tilemapFromCache(t,e,r,this._tmpTilemapDefinition);return i?i.getAvailability(e,r):"unknown"}fetchAvailability(t,e,r,i){return!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD?Promise.reject(new J("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:r})):this.fetchTilemap(t,e,r,i).catch(s=>s).then(s=>{if(s instanceof Cde){const n=s.getAvailability(e,r);if(n==="unavailable")throw new J("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:r});return n}if(ns(s))throw s;return"unknown"})}fetchAvailabilityUpsample(t,e,r,i,s){i.level=t,i.row=e,i.col=r;const n=this.layer.tileInfo;n.updateTileInfo(i);const o=this.fetchAvailability(t,e,r,s).catch(a=>{if(ns(a))throw a;if(n.upsampleTile(i))return this.fetchAvailabilityUpsample(i.level,i.row,i.col,i,s);throw a});return this._fetchAvailabilityUpsamplePrefetch(i.id,t,e,r,s,o),o}async _fetchAvailabilityUpsamplePrefetch(t,e,r,i,s,n){if(!this._prefetchingEnabled||t==null)return;const o=`prefetch-${t}`;if(this.hasHandles(o))return;const a=new AbortController;n.then(()=>a.abort(),()=>a.abort());let l=!1;const c=Yr(()=>{l||(l=!0,a.abort())});if(this.addHandles(c,o),await BIe(10,a.signal).catch(()=>{}),l||(l=!0,this.removeHandles(o)),Zs(a))return;const u=new E1e(t,e,r,i),h={...s,signal:a.signal},p=this.layer.tileInfo;for(let f=0;Pb._prefetches.length<Pb._maxPrefetch&&p.upsampleTile(u);++f){const g=this.fetchAvailability(u.level,u.row,u.col,h);Pb._prefetches.push(g);const _=()=>{Pb._prefetches.removeUnordered(g)};g.then(_,_)}}_initializeTilemapDefinition(){var i;if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:e,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:xw({...t.query,...r,token:e??((i=t.query)==null?void 0:i.token)}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(t,e,r,i){i.level=t,i.row=e-e%this.size,i.col=r-r%this.size;const s=Ade(i);return this._tilemapCache.get(s)}get test(){const t=this;return{get prefetchingEnabled(){return t._prefetchingEnabled},set prefetchingEnabled(e){t._prefetchingEnabled=e},hasTilemap:(e,r,i)=>!!t._tilemapFromCache(e,r,i,t._tmpTilemapDefinition)}}};ih._maxPrefetch=4,ih._prefetches=new kt({initialSize:Pb._maxPrefetch}),d([m({constructOnly:!0})],ih.prototype,"layer",void 0),d([m({constructOnly:!0})],ih.prototype,"minLOD",void 0),d([m({constructOnly:!0})],ih.prototype,"maxLOD",void 0),d([m({constructOnly:!0})],ih.prototype,"request",void 0),d([m({constructOnly:!0})],ih.prototype,"size",void 0),ih=Pb=d([V("esri.layers.support.TilemapCache")],ih);const NEt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){var r,i;(i=(r=this.tilemapCache)==null?void 0:r.destroy)==null||i.call(r)}readMinScale(r,i){return i.minLOD!=null&&i.maxLOD!=null?r:0}readMaxScale(r,i){return i.minLOD!=null&&i.maxLOD!=null?r:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(r,i,s){var u;const n=(u=i.capabilities)==null?void 0:u.includes("Tilemap");let{minLOD:o,maxLOD:a,minScale:l,maxScale:c}=i;if(o==null&&a==null&&l!==0&&c!==0){const h=p=>Math.round(1e4*p)/1e4;l=h(l||i.tileInfo.lods[0].scale),c=h(c||i.tileInfo.lods[i.tileInfo.lods.length-1].scale);for(const p of i.tileInfo.lods){const f=h(p.scale);o=f>=l?p.level:o,a=f>=c?p.level:a}}if(n)return new ih({layer:this,minLOD:o,maxLOD:a});if(i.tileInfo){const h=new sm;return h.read(i.tileInfo,s),new IEt(h,o,a)}return null}};return d([m({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),d([m()],e.prototype,"minScale",void 0),d([Tr("service","minScale")],e.prototype,"readMinScale",null),d([m()],e.prototype,"maxScale",void 0),d([Tr("service","maxScale")],e.prototype,"readMaxScale",null),d([m({type:Xe})],e.prototype,"spatialReference",void 0),d([m({readOnly:!0})],e.prototype,"supportsBlankTile",null),d([m({type:sm})],e.prototype,"tileInfo",void 0),d([m()],e.prototype,"tilemapCache",void 0),d([Tr("service","tilemapCache",["capabilities","tileInfo"])],e.prototype,"readTilemapCache",null),d([m()],e.prototype,"version",void 0),e=d([V("esri.layers.mixins.ArcGISCachedService")],e),e},FEt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=Ak(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",fHe(r,ae.getLogger(this)))}};return d([m()],e.prototype,"title",null),d([m({type:String})],e.prototype,"url",null),e=d([V("esri.layers.mixins.ArcGISService")],e),e},kEt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return d([m({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=d([V("esri.layers.mixins.CustomParametersMixin")],e),e},Pde={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Mde={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},Ode={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},UEt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0,IntegratedMesh3DTilesLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":Pde,"web-map/basemap":Mde,"web-map/tables":Ode,"link-chart/operational-layers":{...Pde,LinkChartLayer:!0},"link-chart/basemap":Mde,"link-chart/tables":Ode,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISImageServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,IntegratedMesh3DTilesLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0}};function zEt(t){if(!t)return t;const{start:e,end:r}=t;return new pR({start:e!=null?tw(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?tw(r,-r.getTimezoneOffset(),"minutes"):r})}function BEt(t){if(!t)return t;const{start:e,end:r}=t;return new pR({start:e!=null?tw(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?tw(r,r.getTimezoneOffset(),"minutes"):r})}const R7t={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Hh}}},$7t={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},I7t={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Hh}}},L7t={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:H_}}},D7t={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Hh}}},N7t={value:null,type:aRe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Hh}}};function F7t(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const dRe={write:{enabled:!0,layerContainerTypes:Hh},read:!0},MW={type:Number,json:{origins:{"web-document":dRe,"portal-item":{write:!0}}}},k7t={...MW,json:{...MW.json,origins:{"web-document":{...dRe,write:{enabled:!0,layerContainerTypes:Hh,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>{var i;return r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(i=e.layerDefinition)!=null&&i.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?m5(e.layerDefinition.drawingInfo.transparency):void 0:m5(e.drawingInfo.transparency)}}}},U7t={type:pR,readOnly:!0,get(){var l,c,u;const t=((l=this.layer)==null?void 0:l.timeInfo)!=null?this.layer:((c=this.i3slayer)==null?void 0:c.timeInfo)!=null?this.i3slayer:null;if(t==null)return null;const{datesInUnknownTimezone:e,timeOffset:r,useViewTime:i}=t,s=(u=this.view)==null?void 0:u.timeExtent;let n=t.timeExtent;e&&(n=BEt(n));let o=i?s&&n?s.intersection(n):s||n:n;if(!o||o.isEmpty||o.isAllTime)return o;r&&(o=o.offset(-r.value,r.unit)),e&&(o=zEt(o));const a=this._get("timeExtent");return o.equals(a)?a:o}},z7t={type:$r,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=$r.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=Xe.fromJSON(e.spatialReference)),r}}}},read:!1}},B7t={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},V7t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:Hh}}},name:"layerDefinition.minScale",write:!0}},G7t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:Hh}}},name:"layerDefinition.maxScale",write:!0}},VEt={json:{write:{ignoreOrigin:!0,layerContainerTypes:Hh},origins:{"web-map":{read:!1,write:!1}}}},GEt=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(r,i,s){var n;return((n=s==null?void 0:s.portalItem)==null?void 0:n.type)==="Group Layer"?void 0:r}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&gDe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){r&&(n==null?void 0:n.layerContainerType)!=="tables"&&(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),pDe(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(!this.persistenceEnabled)return null;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=UEt[l];let u=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=i.messages)==null||o.push(new J("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof J&&l.name==="web-document-write:property-required").length;return DS(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new J("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return d([m({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),d([Tr("id",["id"])],e.prototype,"readId",null),d([m(VEt)],e.prototype,"listMode",void 0),d([lr("listMode")],e.prototype,"writeListMode",null),d([m({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Hh}}}}})],e.prototype,"operationalLayerType",void 0),d([lr("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),d([m(MW)],e.prototype,"opacity",void 0),d([m({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),d([m({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),d([lr("title"),lr(["web-scene"],"title")],e.prototype,"writeTitle",null),d([m({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:Hh}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=d([V("esri.layers.mixins.OperationalLayer")],e),e};async function jEt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return _T(t);const r=Xe.WGS84;return await aR(e,r),p1(t,r)}function HEt(t,e){if(!pRe(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function pRe(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function j7t(t){return pRe(t,WEt.HOSTED_SERVICE)}function qEt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}function H7t(t,e,r){r?HEt(t,e):qEt(t,e)}async function q7t(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return jEt(r)}const WEt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function Rde(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const YEt=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ae(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new jP({id:i.itemId,portal:s==null?void 0:s.portal})}writePortalItem(r,i){r!=null&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){var s;if((s=this.portalItem)!=null&&s.id)try{const{load:n}=await me(()=>import("./layersLoader-CYBOe_9H.js"),__vite__mapDeps([226,112,110,108,109,107,103]));return vt(i),await n({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(n){throw ns(n)||ae.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Uo(i),!0)))}async setUserPrivileges(r,i){if(!ii.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Uo(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return Rde(s);let o,a;if(n)o=s.portal.url;else try{o=await PUe(this.url,i)}catch(h){Uo(h)}if(!o||!kDe(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const h=i!=null?i.signal:null;a=await(Jr==null?void 0:Jr.getCredential(`${o}/sharing`,{prompt:!1,signal:h}))}catch(h){Uo(h)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(n?await s.reload():(s=new jP({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return Rde(s)}catch(h){Uo(h)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Uo(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Jr==null?void 0:Jr.findCredential(this.url):null;if(!i)return!0;const s=ZL.credential===i?ZL.user:await this._fetchEditingUser(r);return ZL.credential=i,ZL.user=s,(s==null?void 0:s.privileges)==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var u,h;const i=(h=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:h.user;if(i)return i;const s=Jr.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=kl.getDefault();if(o&&o.loaded&&mu(o.restUrl)===mu(n))return o.user;const a=`${n}/community/self`,l=r!=null?r.signal:null,c=await xp(Wr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?zX.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){var o;const s=i==null?void 0:i.portal,n=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||kl.getDefault());return s&&n&&!nme(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new J("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return d([m({type:jP})],e.prototype,"portalItem",null),d([Tr("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),d([lr("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),d([m({clonable:!1})],e.prototype,"resourceReferences",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=d([V("esri.layers.mixins.PortalLayer")],e),e},ZL={credential:null,user:null};let JL=null;function XEt(t){if(JL)return JL;const e={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return JL=new Promise(r=>{const i=new Image;i.onload=()=>{i.onload=i.onerror=null,r(i.width>0&&i.height>0)},i.onerror=()=>{i.onload=i.onerror=null,r(!1)},i.src="data:image/webp;base64,"+e[t]}),JL}const $de=1.15;let Ide=class{constructor(e,r){this._spriteSource=e,this._maxTextureSize=r,this.devicePixelRatio=1,this._spriteImageFormat="png",this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded",e.type==="url"&&e.spriteFormat&&(this._spriteImageFormat=e.spriteFormat),e.pixelRatio&&(this.devicePixelRatio=e.pixelRatio),this.baseURL=e.spriteUrl}get spriteNames(){const e=[];for(const r in this._spritesData)e.push(r);return e.sort(),e}getSpriteInfo(e){return this._spritesData?this._spritesData[e]:null}async load(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}async _loadSprites(e){this._isRetina=this.devicePixelRatio>$de;const{width:r,height:i,data:s,json:n}=await this._getSpriteData(this._spriteSource,e),o=Object.keys(n);if(!o||o.length===0||!s)return this._spritesData=this.image=null,void(this.width=this.height=0);this._spritesData=n,this.width=r,this.height=i;const a=Math.max(this._maxTextureSize,4096);if(r>a||i>a){const c=`Sprite resource for style ${this.baseURL} is bigger than the maximum allowed of ${a} pixels}`;throw ae.getLogger("esri.layers.support.SpriteSource").error(c),new J("SpriteSource",c)}let l;for(let c=0;c<s.length;c+=4)l=s[c+3]/255,s[c]=s[c]*l,s[c+1]=s[c+1]*l,s[c+2]=s[c+2]*l;this.image=s}async _getSpriteData(e,r){if(e.type==="image"){let u,h;if(this.devicePixelRatio<$de){if(!e.spriteSource1x)throw new J("SpriteSource","no image data provided for low resolution sprites!");u=e.spriteSource1x.image,h=e.spriteSource1x.json}else{if(!e.spriteSource2x)throw new J("SpriteSource","no image data provided for high resolution sprites!");u=e.spriteSource2x.image,h=e.spriteSource2x.json}return"width"in u&&"height"in u&&"data"in u&&(gT(u.data)||HW(u.data))?{width:u.width,height:u.height,data:new Uint8Array(u.data),json:h}:{...Lde(u),json:h}}const i=$s(this.baseURL),s=i.query?"?"+xw(i.query):"",n=this._isRetina?"@2x":"",o=`${i.path}${n}.${this._spriteImageFormat}${s}`,a=`${i.path}${n}.json${s}`,[l,c]=await Promise.all([Wr(a,r),Wr(o,{responseType:"image",...r})]);return{...Lde(c.data),json:l.data}}};function Lde(t){const e=document.createElement("canvas"),r=e.getContext("2d");e.width=t.width,e.height=t.height,r.drawImage(t,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height);return{width:t.width,height:t.height,data:new Uint8Array(i.data)}}let ZEt=class{constructor(e){this.url=e}destroy(){this._tileIndexPromise=null}async fetchTileIndex(){return this._tileIndexPromise||(this._tileIndexPromise=Wr(this.url).then(e=>e.data.index)),this._tileIndexPromise}async dataKey(e,r){const i=await this.fetchTileIndex();return vt(r),this._getIndexedDataKey(i,e)}_getIndexedDataKey(e,r){const i=[r];if(r.level<0||r.row<0||r.col<0||r.row>>r.level>0||r.col>>r.level>0)return null;let s=r;for(;s.level!==0;)s=new Ip(s.level-1,s.row>>1,s.col>>1,s.world),i.push(s);let n,o,a=e,l=i.pop();if(a===1)return l;for(;i.length;)if(n=i.pop(),o=(1&n.col)+((1&n.row)<<1),a){if(a[o]===0){l=null;break}if(a[o]===1){l=n;break}l=n,a=a[o]}return l}},JEt=class{constructor(e,r){this._tilemap=e,this._tileIndexUrl=r}destroy(){this._tilemap=Ae(this._tilemap),this._tileIndexPromise=null}async fetchTileIndex(e){return this._tileIndexPromise||(this._tileIndexPromise=Wr(this._tileIndexUrl,{query:{...e==null?void 0:e.query}}).then(r=>r.data.index)),this._tileIndexPromise}dataKey(e,r){const{level:i,row:s,col:n}=e,o=new Ip(e);return this._tilemap.fetchAvailabilityUpsample(i,s,n,o,r).then(()=>(o.world=e.world,o)).catch(a=>{if(ns(a))throw a;return null})}},KEt=class{constructor(e){this._tileUrl=e,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(e){var i;(this._promise==null||Zs((i=this._abortController)==null?void 0:i.signal))&&(this._promise=this._makeRequest(this._tileUrl));const r=this._abortOptions;return r.push(e),lo(e,()=>{r.every(s=>Zs(s))&&this._abortController.abort()}),this._promise.then(s=>ge(s))}async _makeRequest(e){this._abortController=new AbortController;const{data:r}=await Wr(e,{responseType:"array-buffer",signal:this._abortController.signal});return r}};const Dde=new Map;function QEt(t,e,r,i,s){const n=$s(t),o=n.query;if(o)for(const[l,c]of Object.entries(o))switch(c){case"{x}":o[l]=i.toString();break;case"{y}":o[l]=r.toString();break;case"{z}":o[l]=e.toString()}const a=n.path;return eCt(em(a.replaceAll(/\{z\}/gi,e.toString()).replaceAll(/\{y\}/gi,r.toString()).replaceAll(/\{x\}/gi,i.toString()),{...n.query}),s)}function eCt(t,e){return f6(Dde,t,()=>new KEt(t)).getData(e).finally(()=>Dde.delete(t))}let tCt=class{constructor(e,r,i){this.tilemap=null,this.tileInfo=null,this.capabilities=null,this.fullExtent=null,this.initialExtent=null,this.name=e,this.sourceUrl=r;const s=$s(this.sourceUrl),n=ge(i),o=n.tiles;if(s)for(let p=0;p<o.length;p++){const f=$s(o[p]);f&&(Rl(f.path)||(f.path=Tw(s.path,f.path)),o[p]=em(f.path,{...s.query,...f.query}))}this.tileServers=o;const a=i.capabilities&&i.capabilities.split(",").map(p=>p.toLowerCase().trim()),l=(i==null?void 0:i.exportTilesAllowed)===!0,c=(a==null?void 0:a.includes("tilemap"))===!0,u=l&&i.hasOwnProperty("maxExportTilesCount")?i.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:l,supportsTileMap:c},exportTiles:l?{maxExportTilesCount:+u}:null},this.tileInfo=sm.fromJSON(n.tileInfo);const h=i.tileMap?em(Tw(s.path,i.tileMap),s.query??{}):null;c?(this.type="vector-tile",this.tilemap=new JEt(new ih({layer:{parsedUrl:s,tileInfo:this.tileInfo},minLOD:n.minLOD??this.tileInfo.lods[0].level,maxLOD:n.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}),h)):h&&(this.tilemap=new ZEt(h)),this.fullExtent=$r.fromJSON(i.fullExtent),this.initialExtent=$r.fromJSON(i.initialExtent)}destroy(){var e;(e=this.tilemap)==null||e.destroy()}async getRefKey(e,r){var i;return await((i=this.tilemap)==null?void 0:i.dataKey(e,r))??e}requestTile(e,r,i,s){const n=this.tileServers[r%this.tileServers.length];return QEt(n,e,r,i,s)}isCompatibleWith(e){const r=this.tileInfo,i=e.tileInfo;if(!r.spatialReference.equals(i.spatialReference)||!r.origin.equals(i.origin)||Math.round(r.dpi)!==Math.round(i.dpi))return!1;const s=r.lods,n=i.lods,o=Math.min(s.length,n.length);for(let a=0;a<o;a++){const l=s[a],c=n[a];if(l.level!==c.level||Math.round(l.scale)!==Math.round(c.scale))return!1}return!0}};async function rCt(t,e){const r={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[i,s]=typeof t=="string"?[t,null]:[null,t.jsonUrl];return await jb(r,"esri",t,s,e),{layerDefinition:r.validatedSource,url:i,serviceUrl:r.sourceUrl,style:r.style,styleUrl:r.styleUrl,spriteUrl:r.style.sprite&&RE(r.styleBase,r.style.sprite),spriteFormat:r.spriteFormat,glyphsUrl:r.style.glyphs&&RE(r.styleBase,r.style.glyphs),sourceNameToSource:r.sourceNameToSource,primarySourceName:r.primarySourceName}}function RE(...t){let e;for(const r of t)r!=null&&($h(r)?e&&(e=e.split("://")[0]+":"+r.trim()):e=Rl(r)?r:Tw(e,r));return e?b6(e):void 0}async function jb(t,e,r,i,s){let n,o,a;if(vt(s),typeof r=="string"){const c=mu(r);a=await Wr(c,{...s,responseType:"json",query:{f:"json",...s==null?void 0:s.query}}),a.ssl&&(n&&(n=n.replace(/^http:/i,"https:")),o&&(o=o.replace(/^http:/i,"https:"))),n=c,o=c}else r!=null&&(a={data:r},n=r.jsonUrl||null,o=i);const l=a==null?void 0:a.data;if(mRe(l))return t.styleUrl=n||null,sCt(t,l,o,s);if(iCt(l))return t.sourceUrl?Nde(t,l,o,!1,e,s):(t.sourceUrl=n||null,Nde(t,l,o,!0,e,s));throw new Error("You must specify the URL or the JSON for a service or for a style.")}function fRe(t){return typeof t=="object"&&!!t&&"tilejson"in t&&t.tilejson!=null}function mRe(t){return!!t&&"sources"in t&&!!t.sources}function iCt(t){return!mRe(t)}async function sCt(t,e,r,i){const s=r?v6(r):ime();t.styleBase=s,t.style=e,e["sprite-format"]&&e["sprite-format"].toLowerCase()==="webp"&&(t.spriteFormat="webp");const n=[];if(e.sources&&e.sources.esri){const o=e.sources.esri;o.url?await jb(t,"esri",RE(s,o.url),void 0,i):n.push(jb(t,"esri",o,s,i))}for(const o of Object.keys(e.sources))o!=="esri"&&e.sources[o].type==="vector"&&(e.sources[o].url?n.push(jb(t,o,RE(s,e.sources[o].url),void 0,i)):e.sources[o].tiles&&n.push(jb(t,o,e.sources[o],s,i)));await Promise.all(n)}async function Nde(t,e,r,i,s,n){const o=r?b6(r)+"/":ime(),a=nCt(e),l=new tCt(s,em(o,(n==null?void 0:n.query)??{}),a);if(!i&&t.primarySourceName in t.sourceNameToSource){const c=t.sourceNameToSource[t.primarySourceName];if(!c.isCompatibleWith(l))return;l.fullExtent!=null&&(c.fullExtent!=null?c.fullExtent.union(l.fullExtent):c.fullExtent=l.fullExtent.clone()),c.tileInfo&&l.tileInfo&&c.tileInfo.lods.length<l.tileInfo.lods.length&&(c.tileInfo=l.tileInfo)}if(i&&(t.sourceBase=o,t.source=e,t.validatedSource=a,t.primarySourceName=s),t.sourceNameToSource[s]=l,!fRe(t)&&"defaultStyles"in e&&!t.style){if(e.defaultStyles==null)throw new Error;return typeof e.defaultStyles=="string"?jb(t,"",RE(o,e.defaultStyles,"root.json"),void 0,n):jb(t,"",e.defaultStyles,RE(o,"root.json"),n)}}function nCt(t){if(t.hasOwnProperty("tileInfo"))return t;const e={xmin:-20037507067161843e-9,ymin:-20037507067161843e-9,xmax:20037507067161843e-9,ymax:20037507067161843e-9,spatialReference:{wkid:102100,latestWkid:3857}};let r=null;if(fRe(t)){const{bounds:u}=t;if(u){const h=rm({x:u[0],y:u[1],spatialReference:ge(F4)}),p=rm({x:u[2],y:u[3],spatialReference:ge(F4)});r={xmin:h.x,ymin:h.y,xmax:p.x,ymax:p.y,spatialReference:ge(k4)}}}r===null&&(r=e);const i=512;let s=78271.51696400007,n=2958287637957775e-7;const o=[],a=t.hasOwnProperty("maxzoom")&&t.maxzoom!=null?+t.maxzoom:22,l=0,c=0;for(let u=0;u<=a;u++)o.push({level:u,scale:n,resolution:s}),s/=2,n/=2;return{capabilities:"TilesOnly",initialExtent:r,fullExtent:e,minScale:l,maxScale:c,tiles:t.tiles,tileInfo:{rows:i,cols:i,dpi:96,format:"pbf",origin:{x:-20037508342787e-6,y:20037508342787e-6},lods:o,spatialReference:ge(k4)}}}function oCt(t,e){return{...gRe(t,e),readResourcePaths:[]}}function K7t(t,e,r){const i=$s(t.itemUrl);return{...gRe(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function gRe(t,e){return{origin:e,url:$s(t.itemUrl),portal:t.portal||kl.getDefault(),portalItem:t}}const KL=1e-6;function aCt(t,e){if(t===e)return!0;if(t==null&&e!=null||t!=null&&e==null||t==null||e==null||!t.spatialReference.equals(e.spatialReference)||t.dpi!==e.dpi)return!1;const r=t.origin,i=e.origin;if(Math.abs(r.x-i.x)>=KL||Math.abs(r.y-i.y)>=KL)return!1;let s,n;t.lods[0].scale>e.lods[0].scale?(s=t,n=e):(n=t,s=e);for(let o=s.lods[0].scale;o>=n.lods[n.lods.length-1].scale-KL;o/=2)if(Math.abs(o-n.lods[0].scale)<KL)return!0;return!1}function lCt(t,e){if(t===e)return t;if(t==null&&e!=null)return e;if(t!=null&&e==null)return t;if(t==null||e==null)return null;const r=t.size[0],i=t.format,s=t.dpi,n=new Ke({x:t.origin.x,y:t.origin.y}),o=t.spatialReference,a=t.lods[0].scale>e.lods[0].scale?t.lods[0]:e.lods[0],l=t.lods[t.lods.length-1].scale<=e.lods[e.lods.length-1].scale?t.lods[t.lods.length-1]:e.lods[e.lods.length-1],c=a.scale,u=a.resolution,h=l.scale,p=[];let f=c,g=u,_=0;for(;f>h;)p.push(new hh({level:_,resolution:g,scale:f})),_++,f/=2,g/=2;return new sm({size:[r,r],dpi:s,format:i||"pbf",origin:n,lods:p,spatialReference:o})}let cCt=class{constructor(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,r){return 65535&e|r<<16}static i8888to32(e,r,i,s){return 255&e|(255&r)<<8|(255&i)<<16|s<<24}static i8816to32(e,r,i){return 255&e|(255&r)<<8|i<<16}};var _t,Mb;(function(t){t[t.R8_SIGNED=0]="R8_SIGNED",t[t.R8_UNSIGNED=1]="R8_UNSIGNED",t[t.R16_SIGNED=2]="R16_SIGNED",t[t.R16_UNSIGNED=3]="R16_UNSIGNED",t[t.R8G8_SIGNED=4]="R8G8_SIGNED",t[t.R8G8_UNSIGNED=5]="R8G8_UNSIGNED",t[t.R16G16_SIGNED=6]="R16G16_SIGNED",t[t.R16G16_UNSIGNED=7]="R16G16_UNSIGNED",t[t.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED",t[t.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED",t[t.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR",t[t.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY",t[t.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(_t||(_t={})),function(t){t[t.UNIFORM=0]="UNIFORM",t[t.DATA_DRIVEN=1]="DATA_DRIVEN",t[t.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN",t[t.UNUSED=3]="UNUSED"}(Mb||(Mb={}));let S1=class OW{constructor(e){this._locations=new Map,this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._locations.size===0&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,r,i,s,n){const o=this.getUniforms();for(const a of o){const{name:l,type:c,getValue:u}=a,h=u(i,r,s,n);if(h!==null)switch(c){case"float":e.setUniform1f(l,h);break;case"vec2":e.setUniform2fv(l,h);break;case"vec4":e.setUniform4fv(l,h)}}}encodeAttributes(e,r,i,s){var u;const n=this.attributesInfo(),o=this.getEncodingInfos(),a=[];let l=0,c=0;for(const h of Object.keys(o)){const p=o[h],{type:f,precisionFactor:g,isLayout:_}=n[h],v=_?i.getLayoutProperty(h):i.getPaintProperty(h),b=(u=v.interpolator)==null?void 0:u.getInterpolationRange(r);let w=0;for(const T of p){const{offset:S,bufferElementsToAdd:C}=T;if(C>0){for(let R=0;R<C;R++)a.push(0);l+=c,c=T.bufferElementsToAdd}const P=s??v.getValue(b?b[w]:r,e);switch(f){case _t.R8_SIGNED:case _t.R8_UNSIGNED:a[l]|=this._encodeByte(P*(g||1),8*S);break;case _t.R16_SIGNED:case _t.R16_UNSIGNED:a[l]|=this._encodeShort(P*(g||1),8*S);break;case _t.R8G8_SIGNED:case _t.R8G8_UNSIGNED:a[l]|=this._encodeByte(P*(g||1),8*S),a[l]|=this._encodeByte(P*(g||1),8*S+8);break;case _t.R16G16_SIGNED:case _t.R16G16_UNSIGNED:a[l]|=this._encodeShort(P*(g||1),8*S),a[l]|=this._encodeShort(P*(g||1),8*S+16);break;case _t.R8G8B8A8_SIGNED:case _t.R8G8B8A8_UNSIGNED:a[l]|=this._encodeByte(P*(g||1),8*S),a[l]|=this._encodeByte(P*(g||1),8*S+8),a[l]|=this._encodeByte(P*(g||1),8*S+16),a[l]|=this._encodeByte(P*(g||1),8*S+24);break;case _t.R8G8B8A8_COLOR:a[l]=this._encodeColor(P);break;case _t.R16G16B16A16_DASHARRAY:case _t.R16G16B16A16_PATTERN:this._encodePattern(l,a,P);break;default:throw new Error("Unsupported encoding type")}w++}}return a}getAtributeState(e){let r=0;const i=3+2*e;return r|=this._bit(i),r|=this._bit(i+1)<<1,r}_buildAttributesInfo(){const e=[],r={},i={};let s=-1;const n=this.attributesInfo(),o=this.attributes();let a=-1;for(const h of o){a++;const p=this.getAtributeState(a);if(p===Mb.UNIFORM||p===Mb.UNUSED)continue;const f=n[h],g=[];r[h]=g;const _=f.type;for(let v=0;v<p;v++){const{dataType:b,bytesPerElement:w,count:T,normalized:S}=OW._encodingInfo[_],C=w*T,P=`${b}-${S===!0}`;let R=i[P],L=0;if(!R||R.count+T>4)s++,R={dataIndex:s,count:0,offset:0},T!==4&&(i[P]=R),e.push({location:-1,name:"a_data_"+s,count:T,type:b,normalized:S}),L=Math.ceil(Math.max(C/4,1));else{const F=e[R.dataIndex];F.count+=T,L=Math.ceil(Math.max(F.count*w/4,1))-Math.ceil(Math.max(R.offset/4,1))}g.push({dataIndex:R.dataIndex,offset:R.offset,bufferElementsToAdd:L}),R.offset+=C,R.count+=T}}for(const h of e)switch(h.type){case Te.BYTE:case Te.UNSIGNED_BYTE:h.count=4;break;case Te.SHORT:case Te.UNSIGNED_SHORT:h.count+=h.count%2}this._buildVertexBufferLayout(e);let l=0;const c=this._layoutInfo.geometry;for(const h of c)this._locations.set(h.name,l++);const u=this._layoutInfo.opacity;if(u)for(const h of u)this._locations.set(h.name,l++);this._buildShaderInfo(e,r),this._propertyEncodingInfo=r}_buildVertexBufferLayout(e){const r={},i=this.geometryInfo();let s=i[0].stride;if(e.length===0)r.geometry=i;else{const n=[];let o=s;for(const a of e)s+=Fde(a.type)*a.count;for(const a of i)n.push(new hi(a.name,a.count,a.type,a.offset,s,a.normalized));for(const a of e)n.push(new hi(a.name,a.count,a.type,o,s,a.normalized)),o+=Fde(a.type)*a.count;r.geometry=n}this.opacityInfo()&&(r.opacity=this.opacityInfo()),this._layoutInfo=r,this._stride=s}_buildShaderInfo(e,r){let i=`
`,s=`
`;const n=[];for(const c of e)i+=`attribute ${this._getType(c.count)} ${c.name};
`;const o=this.attributes(),a=this.attributesInfo();let l=-1;for(const c of o){l++;const{name:u,type:h,precisionFactor:p,isLayout:f}=a[c],g=p&&p!==1?" * "+1/p:"",{bytesPerElement:_,count:v}=OW._encodingInfo[h],b=w=>`a_data_${w.dataIndex}${uCt(v,w.offset,_)}`;switch(this.getAtributeState(l)){case Mb.UNIFORM:{const w=this._getType(v),T=`u_${u}`;n.push({name:T,type:w,getValue:(S,C,P,R)=>{const L=f?S.getLayoutValue(c,C):S.getPaintValue(c,C);if(h===_t.R16G16B16A16_DASHARRAY){const F=S.getDashKey(L,S.getLayoutValue("line-cap",C)),U=R.getMosaicItemPosition(F,!1);if(U==null)return null;const{tl:j,br:z}=U;return[j[0],z[1],z[0],j[1]]}if(h===_t.R16G16B16A16_PATTERN){const F=R.getMosaicItemPosition(L,!c.includes("line-"));if(F==null)return null;const{tl:U,br:j}=F;return[U[0],j[1],j[0],U[1]]}if(h===_t.R8G8B8A8_COLOR){const F=L[3];return[F*L[0],F*L[1],F*L[2],F]}return L}}),i+=`uniform ${w} ${T};
`,s+=`${w} ${u} = ${T};
`}break;case Mb.DATA_DRIVEN:{const w=b(r[c][0]);s+=`${this._getType(v)} ${u} = ${w}${g};
`}break;case Mb.INTERPOLATED_DATA_DRIVEN:{const w=`u_t_${u}`;n.push({name:w,type:"float",getValue:(C,P,R,L)=>(f?C.getLayoutProperty(c):C.getPaintProperty(c)).interpolator.interpolationUniformValue(R,P)}),i+=`uniform float ${w};
`;const T=b(r[c][0]),S=b(r[c][1]);s+=`${this._getType(v)} ${u} = mix(${T}${g}, ${S}${g}, ${w});
`}}}this._shaderHeader=i,this._shaderMain=s,this._uniforms=n}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const r=255*e[3];return cCt.i8888to32(e[0]*r,e[1]*r,e[2]*r,r)}_encodePattern(e,r,i){if(!(i!=null&&i.rect))return;const s=2,n=i.rect,o=i.width,a=i.height;r[e]=this._encodeShort(n.x+s,0),r[e]|=this._encodeShort(n.y+s+a,16),r[e+1]=this._encodeShort(n.x+s+o,0),r[e+1]|=this._encodeShort(n.y+s,16)}_encodeByte(e,r){return(255&e)<<r}_encodeShort(e,r){return(65535&e)<<r}};S1._encodingInfo={[_t.R8_SIGNED]:{dataType:Te.BYTE,bytesPerElement:1,count:1,normalized:!1},[_t.R8_UNSIGNED]:{dataType:Te.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[_t.R16_SIGNED]:{dataType:Te.SHORT,bytesPerElement:2,count:1,normalized:!1},[_t.R16_UNSIGNED]:{dataType:Te.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[_t.R8G8_SIGNED]:{dataType:Te.BYTE,bytesPerElement:1,count:2,normalized:!1},[_t.R8G8_UNSIGNED]:{dataType:Te.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[_t.R16G16_SIGNED]:{dataType:Te.SHORT,bytesPerElement:2,count:2,normalized:!1},[_t.R16G16_UNSIGNED]:{dataType:Te.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[_t.R8G8B8A8_SIGNED]:{dataType:Te.BYTE,bytesPerElement:1,count:4,normalized:!1},[_t.R8G8B8A8_UNSIGNED]:{dataType:Te.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[_t.R8G8B8A8_COLOR]:{dataType:Te.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[_t.R16G16B16A16_DASHARRAY]:{dataType:Te.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[_t.R16G16B16A16_PATTERN]:{dataType:Te.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const Fde=t=>{switch(t){case Te.FLOAT:case Te.INT:case Te.UNSIGNED_INT:return 4;case Te.SHORT:case Te.UNSIGNED_SHORT:return 2;case Te.BYTE:case Te.UNSIGNED_BYTE:return 1}},uCt=(t,e,r)=>{const i=e/r;if(t===1)switch(i){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(t===2)switch(i){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(t===3)switch(i){case 0:return".xyz";case 1:return".yzw"}return""};let SS=class s4 extends S1{constructor(e){super(e)}geometryInfo(){return s4.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return s4.ATTRIBUTES}attributesInfo(){return s4.ATTRIBUTES_INFO}};SS.ATTRIBUTES=[],SS.GEOMETRY_LAYOUT=[new hi("a_pos",2,Te.BYTE,0,2)],SS.ATTRIBUTES_INFO={};let ES=class n4 extends S1{constructor(e){super(e)}geometryInfo(){return n4.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return n4.ATTRIBUTES}attributesInfo(){return n4.ATTRIBUTES_INFO}};ES.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],ES.GEOMETRY_LAYOUT=[new hi("a_pos",2,Te.SHORT,0,4)],ES.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:_t.R8_UNSIGNED},"circle-color":{name:"color",type:_t.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:_t.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:_t.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:_t.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",type:_t.R8_UNSIGNED,precisionFactor:32}};let CS=class o4 extends S1{constructor(e){super(e)}geometryInfo(){return o4.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return o4.ATTRIBUTES}attributesInfo(){return o4.ATTRIBUTES_INFO}};CS.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"],CS.GEOMETRY_LAYOUT=[new hi("a_pos",2,Te.SHORT,0,4)],CS.ATTRIBUTES_INFO={"fill-color":{name:"color",type:_t.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:_t.R16G16B16A16_PATTERN,isOptional:!0}};let Hf=class fT extends S1{constructor(e,r){super(e),this._usefillColor=r}geometryInfo(){return fT.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?fT.ATTRIBUTES_FILL:fT.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?fT.ATTRIBUTES_INFO_FILL:fT.ATTRIBUTES_INFO_OUTLINE}};Hf.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],Hf.ATTRIBUTES_FILL=["fill-color","fill-opacity"],Hf.GEOMETRY_LAYOUT=[new hi("a_pos",2,Te.SHORT,0,8),new hi("a_offset",2,Te.BYTE,4,8),new hi("a_xnormal",2,Te.BYTE,6,8)],Hf.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:_t.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100}},Hf.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:_t.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100}};let AS=class a4 extends S1{constructor(e){super(e)}geometryInfo(){return a4.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return a4.ATTRIBUTES}attributesInfo(){return a4.ATTRIBUTES_INFO}};AS.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"],AS.GEOMETRY_LAYOUT=[new hi("a_pos",2,Te.SHORT,0,16),new hi("a_extrude_offset",4,Te.BYTE,4,16),new hi("a_dir_normal",4,Te.BYTE,8,16),new hi("a_accumulatedDistance",2,Te.UNSIGNED_SHORT,12,16)],AS.ATTRIBUTES_INFO={"line-width":{name:"width",type:_t.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:_t.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:_t.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:_t.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:_t.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:_t.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:_t.R16G16B16A16_DASHARRAY,isOptional:!0}};const yRe=[new hi("a_pos",2,Te.SHORT,0,16),new hi("a_vertexOffset",2,Te.SHORT,4,16),new hi("a_texAngleRange",4,Te.UNSIGNED_BYTE,8,16),new hi("a_levelInfo",4,Te.UNSIGNED_BYTE,12,16)],_Re=[new hi("a_opacityInfo",1,Te.UNSIGNED_BYTE,0,1)];let PM=class RW extends S1{constructor(e){super(e)}geometryInfo(){return yRe}opacityInfo(){return _Re}attributes(){return RW.ATTRIBUTES}attributesInfo(){return RW.ATTRIBUTES_INFO}};PM.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],PM.ATTRIBUTES_INFO={"icon-color":{name:"color",type:_t.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:_t.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:_t.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:_t.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:_t.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};let MM=class $W extends S1{constructor(e){super(e)}geometryInfo(){return yRe}opacityInfo(){return _Re}attributes(){return $W.ATTRIBUTES}attributesInfo(){return $W.ATTRIBUTES_INFO}};MM.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],MM.ATTRIBUTES_INFO={"text-color":{name:"color",type:_t.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:_t.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:_t.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:_t.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:_t.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:_t.R8_UNSIGNED,isLayout:!0}};function hCt(t,e,r,i){const s=3*t,n=3*(r-t)-s,o=1-s-n,a=3*e,l=3*(i-e)-a,c=1-a-l;function u(g){return((o*g+n)*g+s)*g}function h(g){return((c*g+l)*g+a)*g}function p(g){return(3*o*g+2*n)*g+s}function f(g,_){let v,b,w,T,S,C;for(w=g,C=0;C<8;C++){if(T=u(w)-g,Math.abs(T)<_)return w;if(S=p(w),Math.abs(S)<1e-6)break;w-=T/S}if(v=0,b=1,w=g,w<v)return v;if(w>b)return b;for(;v<b;){if(T=u(w),Math.abs(T-g)<_)return w;g>T?v=w:b=w,w=.5*(b-v)+v}return w}return function(g,_=1e-6){return h(f(g,_))}}const vRe={kind:"null"},ln={kind:"number"},Cu={kind:"string"},ba={kind:"boolean"},f0={kind:"color"},D8={kind:"object"},Qg={kind:"value"};function ZR(t,e){return{kind:"array",itemType:t,n:e}}const dCt=[vRe,ln,Cu,ba,f0,D8,ZR(Qg)];function $E(t){if(t.kind==="array"){const e=$E(t.itemType);return typeof t.n=="number"?`array<${e}, ${t.n}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}function N8(t){if(t===null)return vRe;if(typeof t=="string")return Cu;if(typeof t=="boolean")return ba;if(typeof t=="number")return ln;if(t instanceof Fe)return f0;if(Array.isArray(t)){let e;for(const r of t){const i=N8(r);if(e){if(e!==i){e=Qg;break}}else e=i}return ZR(e||Qg,t.length)}return typeof t=="object"?D8:Qg}function IW(t,e){if(e.kind==="array")return t.kind==="array"&&(t.n===0&&t.itemType.kind==="value"||IW(t.itemType,e.itemType))&&(typeof e.n!="number"||e.n===t.n);if(e.kind==="value"){for(const r of dCt)if(IW(t,r))return!0}return e.kind===t.kind}function LW(t){if(t===null)return"";const e=typeof t;return e==="string"?t:e==="number"||e==="boolean"?String(t):t instanceof Fe?t.toString():JSON.stringify(t)}let pCt=class{constructor(e){this._parent=e,this._vars={}}add(e,r){this._vars[e]=r}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}},fCt=class bRe{constructor(){this.type=Qg}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new bRe}evaluate(e,r){return e==null?void 0:e.id}};class OQ{constructor(){this.type=Cu}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new OQ}evaluate(e,r){if(!e)return null;switch(e.type){case uc.Point:return"Point";case uc.LineString:return"LineString";case uc.Polygon:return"Polygon";default:return null}}}let mCt=class wRe{constructor(){this.type=D8}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new wRe}evaluate(e,r){return e==null?void 0:e.values}},xRe=class TRe{constructor(){this.type=ln}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new TRe}evaluate(e,r){return r}},qh=class SRe{constructor(e,r,i){this._lhs=e,this._rhs=r,this._compare=i,this.type=ba}static parse(e,r,i){if(e.length!==3&&e.length!==4)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(e.length===4)throw new Error(`"${e[0]}" collator not supported`);return new SRe(Zt(e[1],r),Zt(e[2],r),i)}evaluate(e,r){return this._compare(this._lhs.evaluate(e,r),this._rhs.evaluate(e,r))}};class gCt extends qh{static parse(e,r){return qh.parse(e,r,(i,s)=>i===s)}}class yCt extends qh{static parse(e,r){return qh.parse(e,r,(i,s)=>i!==s)}}class _Ct extends qh{static parse(e,r){return qh.parse(e,r,(i,s)=>i<s)}}let vCt=class extends qh{static parse(e,r){return qh.parse(e,r,(i,s)=>i<=s)}};class bCt extends qh{static parse(e,r){return qh.parse(e,r,(i,s)=>i>s)}}class wCt extends qh{static parse(e,r){return qh.parse(e,r,(i,s)=>i>=s)}}let xCt=class ERe{constructor(e){this._arg=e,this.type=ba}static parse(e,r){if(e.length!==2)throw new Error('"!" expects 1 argument');return new ERe(Zt(e[1],r))}evaluate(e,r){return!this._arg.evaluate(e,r)}},TCt=class CRe{constructor(e){this._args=e,this.type=ba}static parse(e,r){const i=[];for(let s=1;s<e.length;s++)i.push(Zt(e[s],r));return new CRe(i)}evaluate(e,r){for(const i of this._args)if(!i.evaluate(e,r))return!1;return!0}},SCt=class ARe{constructor(e){this._args=e,this.type=ba}static parse(e,r){const i=[];for(let s=1;s<e.length;s++)i.push(Zt(e[s],r));return new ARe(i)}evaluate(e,r){for(const i of this._args)if(i.evaluate(e,r))return!0;return!1}};class RQ{constructor(e){this._args=e,this.type=ba}static parse(e,r){const i=[];for(let s=1;s<e.length;s++)i.push(Zt(e[s],r));return new RQ(i)}evaluate(e,r){for(const i of this._args)if(i.evaluate(e,r))return!1;return!0}}let ECt=class PRe{constructor(e,r,i){this.type=e,this._args=r,this._fallback=i}static parse(e,r,i){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let s;const n=[];for(let a=1;a<e.length-1;a+=2){const l=Zt(e[a],r),c=Zt(e[a+1],r,i);s||(s=c.type),n.push({condition:l,output:c})}const o=Zt(e[e.length-1],r,i);return s||(s=o.type),new PRe(s,n,o)}evaluate(e,r){for(const i of this._args)if(i.condition.evaluate(e,r))return i.output.evaluate(e,r);return this._fallback.evaluate(e,r)}};class $Q{constructor(e,r){this.type=e,this._args=r}static parse(e,r){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let i;const s=[];for(let n=1;n<e.length;n++){const o=Zt(e[n],r);i||(i=o.type),s.push(o)}return new $Q(i,s)}evaluate(e,r){for(const i of this._args){const s=i.evaluate(e,r);if(s!==null)return s}return null}}let CCt=class MRe{constructor(e,r,i,s,n){this.type=e,this._input=r,this._labels=i,this._outputs=s,this._fallback=n}static parse(e,r){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let i;const s=Zt(e[1],r),n=[],o={};let a;for(let l=2;l<e.length-1;l+=2){let c=e[l];Array.isArray(c)||(c=[c]);for(const h of c){const p=typeof h;if(p!=="string"&&p!=="number")throw new Error('"match" requires string or number literal as labels');if(a){if(p!==a)throw new Error('"match" requires labels to have the same type')}else a=p;o[h]=n.length}const u=Zt(e[l+1],r);i||(i=u.type),n.push(u)}return new MRe(i,s,o,n,Zt(e[e.length-1],r))}evaluate(e,r){const i=this._input.evaluate(e,r);return(this._outputs[this._labels[i]]||this._fallback).evaluate(e,r)}};class Yd{constructor(e,r,i,s,n){this._operator=e,this.type=r,this.interpolation=i,this.input=s,this._stops=n}static parse(e,r,i){const s=e[0];if(e.length<5)throw new Error(`"${s}" expects at least 4 arguments`);const n=e[1];if(!Array.isArray(n)||n.length===0)throw new Error(`"${n}" is not a valid interpolation`);switch(n[0]){case"linear":if(n.length!==1)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(n.length!==2||typeof n[1]!="number")throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(n.length!==5)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let c=1;c<5;c++){const u=n[c];if(typeof u!="number"||u<0||u>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${n[0]}"`)}if(e.length%2!=1)throw new Error(`"${s}" expects an even number of arguments`);const o=Zt(e[2],r,ln);let a;s==="interpolate-hcl"||s==="interpolate-lab"?a=f0:i&&i.kind!=="value"&&(a=i);const l=[];for(let c=3;c<e.length;c+=2){const u=e[c];if(typeof u!="number")throw new Error(`"${s}" requires stop inputs as literal numbers`);if(l.length&&l[l.length-1][0]>=u)throw new Error(`"${s}" requires strictly ascending stop inputs`);const h=Zt(e[c+1],r,a);a||(a=h.type),l.push([u,h])}if(a&&a!==f0&&a!==ln&&(a.kind!=="array"||a.itemType!==ln))throw new Error(`"${s}" cannot interpolate type ${$E(a)}`);return new Yd(s,a,n,o,l)}evaluate(e,r){const i=this._stops;if(i.length===1)return i[0][1].evaluate(e,r);const s=this.input.evaluate(e,r);if(s<=i[0][0])return i[0][1].evaluate(e,r);if(s>=i[i.length-1][0])return i[i.length-1][1].evaluate(e,r);let n=0;for(;++n<i.length&&!(s<i[n][0]););const o=i[n-1][0],a=i[n][0],l=Yd.interpolationRatio(this.interpolation,s,o,a),c=i[n-1][1].evaluate(e,r),u=i[n][1].evaluate(e,r);if(this._operator==="interpolate"){if(this.type.kind==="array"&&Array.isArray(c)&&Array.isArray(u))return c.map((h,p)=>vl(h,u[p],l));if(this.type.kind==="color"&&c instanceof Fe&&u instanceof Fe){const h=new Fe(c),p=new Fe(u);return new Fe([vl(h.r,p.r,l),vl(h.g,p.g,l),vl(h.b,p.b,l),vl(h.a,p.a,l)])}if(this.type.kind==="number"&&typeof c=="number"&&typeof u=="number")return vl(c,u,l);throw new Error(`"${this._operator}" cannot interpolate type ${$E(this.type)}`)}if(this._operator==="interpolate-hcl"){const h=Rie(c),p=Rie(u),f=p.h-h.h,g=cO({h:h.h+l*(f>180||f<-180?f-360*Math.round(f/360):f),c:vl(h.c,p.c,l),l:vl(h.l,p.l,l)});return new Fe({a:vl(c.a,u.a,l),...g})}if(this._operator==="interpolate-lab"){const h=Oie(c),p=Oie(u),f=cO({l:vl(h.l,p.l,l),a:vl(h.a,p.a,l),b:vl(h.b,p.b,l)});return new Fe({a:vl(c.a,u.a,l),...f})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(e,r){const i=this._stops;if(i.length===1||e>=i[i.length-1][0])return 0;let s=0;for(;++s<i.length&&!(e<i[s][0]););const n=i[s-1][0],o=i[s][0];return Yd.interpolationRatio(this.interpolation,r,n,o)}getInterpolationRange(e){const r=this._stops;if(r.length===1){const n=r[0][0];return[n,n]}const i=r[r.length-1][0];if(e>=i)return[i,i];let s=0;for(;++s<r.length&&!(e<r[s][0]););return[r[s-1][0],r[s][0]]}static interpolationRatio(e,r,i,s){let n=0;return e[0]==="linear"?n=Yd._exponentialInterpolationRatio(r,1,i,s):e[0]==="exponential"?n=Yd._exponentialInterpolationRatio(r,e[1],i,s):e[0]==="cubic-bezier"&&(n=hCt(e[1],e[2],e[3],e[4])(Yd._exponentialInterpolationRatio(r,1,i,s),1e-5)),n<0?n=0:n>1&&(n=1),n}static _exponentialInterpolationRatio(e,r,i,s){const n=s-i;if(n===0)return 0;const o=e-i;return r===1?o/n:(r**o-1)/(r**n-1)}}class IQ{constructor(e,r,i){this.type=e,this._input=r,this._stops=i}static parse(e,r){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const i=Zt(e[1],r,ln);let s;const n=[];n.push([-1/0,Zt(e[2],r)]);for(let o=3;o<e.length;o+=2){const a=e[o];if(typeof a!="number")throw new Error('"step" requires stop inputs as literal numbers');if(n.length&&n[n.length-1][0]>=a)throw new Error('"step" requires strictly ascending stop inputs');const l=Zt(e[o+1],r);s||(s=l.type),n.push([a,l])}return new IQ(s,i,n)}evaluate(e,r){const i=this._stops;if(i.length===1)return i[0][1].evaluate(e,r);const s=this._input.evaluate(e,r);let n=0;for(;++n<i.length&&!(s<i[n][0]););return this._stops[n-1][1].evaluate(e,r)}}let ACt=class ORe{constructor(e,r){this.type=e,this._output=r}static parse(e,r,i){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const s=new pCt(r);for(let o=1;o<e.length-1;o+=2){const a=e[o];if(typeof a!="string")throw new Error(`"let" requires a string to define variable names - found ${a}`);s.add(a,Zt(e[o+1],r))}const n=Zt(e[e.length-1],s,i);return new ORe(n.type,n)}evaluate(e,r){return this._output.evaluate(e,r)}},PCt=class RRe{constructor(e,r){this.type=e,this.output=r}static parse(e,r,i){if(e.length!==2||typeof e[1]!="string")throw new Error('"var" requires just one literal string argument');const s=r.get(e[1]);if(!s)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new RRe(i||Qg,s)}evaluate(e,r){return this.output.evaluate(e,r)}},MCt=class $Re{constructor(e,r,i){this.type=e,this._index=r,this._array=i}static parse(e,r){if(e.length!==3)throw new Error('"at" expects 2 arguments');const i=Zt(e[1],r,ln),s=Zt(e[2],r);return new $Re(s.type.itemType,i,s)}evaluate(e,r){const i=this._index.evaluate(e,r),s=this._array.evaluate(e,r);if(i<0||i>=s.length)throw new Error('"at" index out of bounds');if(i!==Math.floor(i))throw new Error('"at" index must be an integer');return s[i]}};class WF{constructor(e,r){this._key=e,this._obj=r,this.type=Qg}static parse(e,r){let i,s;switch(e.length){case 2:return i=Zt(e[1],r),new WF(i);case 3:return i=Zt(e[1],r),s=Zt(e[2],r),new WF(i,s);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,r){const i=this._key.evaluate(e,r);return this._obj?this._obj.evaluate(e,r)[i]:e==null?void 0:e.values[i]}}class YF{constructor(e,r){this._key=e,this._obj=r,this.type=ba}static parse(e,r){let i,s;switch(e.length){case 2:return i=Zt(e[1],r),new YF(i);case 3:return i=Zt(e[1],r),s=Zt(e[2],r),new YF(i,s);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,r){const i=this._key.evaluate(e,r);return this._obj?i in this._obj.evaluate(e,r):!!(e!=null&&e.values[i])}}let OCt=class IRe{constructor(e,r){this._key=e,this._vals=r,this.type=ba}static parse(e,r){if(e.length!==3)throw new Error('"in" expects 2 arguments');return new IRe(Zt(e[1],r),Zt(e[2],r))}evaluate(e,r){const i=this._key.evaluate(e,r);return this._vals.evaluate(e,r).includes(i)}},RCt=class DW{constructor(e,r,i){this._item=e,this._array=r,this._from=i,this.type=ln}static parse(e,r){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const i=Zt(e[1],r),s=Zt(e[2],r);if(e.length===4){const n=Zt(e[3],r,ln);return new DW(i,s,n)}return new DW(i,s)}evaluate(e,r){const i=this._item.evaluate(e,r),s=this._array.evaluate(e,r);if(this._from){const n=this._from.evaluate(e,r);if(n!==Math.floor(n))throw new Error('"index-of" index must be an integer');return s.indexOf(i,n)}return s.indexOf(i)}};class LQ{constructor(e){this._arg=e,this.type=ln}static parse(e,r){if(e.length!==2)throw new Error('"length" expects 2 arguments');const i=Zt(e[1],r);return new LQ(i)}evaluate(e,r){const i=this._arg.evaluate(e,r);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Error('"length" expects string or array')}}class XF{constructor(e,r,i,s){this.type=e,this._array=r,this._from=i,this._to=s}static parse(e,r){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const i=Zt(e[1],r),s=Zt(e[2],r,ln);if(s.type!==ln)throw new Error('"slice" index must return a number');if(e.length===4){const n=Zt(e[3],r,ln);if(n.type!==ln)throw new Error('"slice" index must return a number');return new XF(i.type,i,s,n)}return new XF(i.type,i,s)}evaluate(e,r){const i=this._array.evaluate(e,r);if(!Array.isArray(i)&&typeof i!="string")throw new Error('"slice" input must be an array or a string');const s=this._from.evaluate(e,r);if(s<0||s>=i.length)throw new Error('"slice" index out of bounds');if(s!==Math.floor(s))throw new Error('"slice" index must be an integer');if(this._to){const n=this._to.evaluate(e,r);if(n<0||n>=i.length)throw new Error('"slice" index out of bounds');if(n!==Math.floor(n))throw new Error('"slice" index must be an integer');return i.slice(s,n)}return i.slice(s)}}class DQ{constructor(){this.type=ba}static parse(e){if(e.length!==1)throw new Error('"has-id" expects no arguments');return new DQ}evaluate(e,r){return(e==null?void 0:e.id)!==void 0}}class Dl{constructor(e,r){this._args=e,this._calculate=r,this.type=ln}static parse(e,r,i){const s=e.slice(1).map(n=>Zt(n,r));return new Dl(s,i)}evaluate(e,r){let i;return this._args&&(i=this._args.map(s=>s.evaluate(e,r))),this._calculate(i)}}class $Ct extends Dl{static parse(e,r){switch(e.length){case 2:return Dl.parse(e,r,i=>-i[0]);case 3:return Dl.parse(e,r,i=>i[0]-i[1]);default:throw new Error('"-" expects 1 or 2 arguments')}}}class ICt extends Dl{static parse(e,r){return Dl.parse(e,r,i=>{let s=1;for(const n of i)s*=n;return s})}}class LCt extends Dl{static parse(e,r){if(e.length===3)return Dl.parse(e,r,i=>i[0]/i[1]);throw new Error('"/" expects 2 arguments')}}class DCt extends Dl{static parse(e,r){if(e.length===3)return Dl.parse(e,r,i=>i[0]%i[1]);throw new Error('"%" expects 2 arguments')}}class NCt extends Dl{static parse(e,r){if(e.length===3)return Dl.parse(e,r,i=>i[0]**i[1]);throw new Error('"^" expects 1 or 2 arguments')}}class FCt extends Dl{static parse(e,r){return Dl.parse(e,r,i=>{let s=0;for(const n of i)s+=n;return s})}}class en{constructor(e,r){this._args=e,this._calculate=r,this.type=ln}static parse(e,r){const i=e.slice(1).map(s=>Zt(s,r));return new en(i,en.ops[e[0]])}evaluate(e,r){let i;return this._args&&(i=this._args.map(s=>s.evaluate(e,r))),this._calculate(i)}}en.ops={abs:t=>Math.abs(t[0]),acos:t=>Math.acos(t[0]),asin:t=>Math.asin(t[0]),atan:t=>Math.atan(t[0]),ceil:t=>Math.ceil(t[0]),cos:t=>Math.cos(t[0]),e:()=>Math.E,floor:t=>Math.floor(t[0]),ln:t=>Math.log(t[0]),ln2:()=>Math.LN2,log10:t=>Math.log(t[0])/Math.LN10,log2:t=>Math.log(t[0])/Math.LN2,max:t=>Math.max(...t),min:t=>Math.min(...t),pi:()=>Math.PI,round:t=>Math.round(t[0]),sin:t=>Math.sin(t[0]),sqrt:t=>Math.sqrt(t[0]),tan:t=>Math.tan(t[0])};class NQ{constructor(e){this._args=e,this.type=Cu}static parse(e,r){return new NQ(e.slice(1).map(i=>Zt(i,r)))}evaluate(e,r){return this._args.map(i=>i.evaluate(e,r)).join("")}}class IE{constructor(e,r){this._arg=e,this._calculate=r,this.type=Cu}static parse(e,r){if(e.length!==2)throw new Error(`${e[0]} expects 1 argument`);const i=Zt(e[1],r);return new IE(i,IE.ops[e[0]])}evaluate(e,r){return this._calculate(this._arg.evaluate(e,r))}}IE.ops={downcase:t=>t.toLowerCase(),upcase:t=>t.toUpperCase()};class FQ{constructor(e){this._args=e,this.type=f0}static parse(e,r){if(e.length!==4)throw new Error('"rgb" expects 3 arguments');const i=e.slice(1).map(s=>Zt(s,r));return new FQ(i)}evaluate(e,r){const i=this._validate(this._args[0].evaluate(e,r)),s=this._validate(this._args[1].evaluate(e,r)),n=this._validate(this._args[2].evaluate(e,r));return new Fe({r:i,g:s,b:n})}_validate(e){if(typeof e!="number"||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class kQ{constructor(e){this._args=e,this.type=f0}static parse(e,r){if(e.length!==5)throw new Error('"rgba" expects 4 arguments');const i=e.slice(1).map(s=>Zt(s,r));return new kQ(i)}evaluate(e,r){const i=this._validate(this._args[0].evaluate(e,r)),s=this._validate(this._args[1].evaluate(e,r)),n=this._validate(this._args[2].evaluate(e,r)),o=this._validateAlpha(this._args[3].evaluate(e,r));return new Fe({r:i,g:s,b:n,a:o})}_validate(e){if(typeof e!="number"||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if(typeof e!="number"||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class UQ{constructor(e){this._color=e,this.type=ZR(ln,4)}static parse(e,r){if(e.length!==2)throw new Error('"to-rgba" expects 1 argument');const i=Zt(e[1],r);return new UQ(i)}evaluate(e,r){return new Fe(this._color.evaluate(e,r)).toRgba()}}class Ob{constructor(e,r){this.type=e,this._args=r}static parse(e,r){const i=e[0];if(e.length<2)throw new Error(`${i} expects at least one argument`);let s,n=1;if(i==="array"){if(e.length>2){switch(e[1]){case"string":s=Cu;break;case"number":s=ln;break;case"boolean":s=ba;break;default:throw new Error('"array" type argument must be string, number or boolean')}n++}else s=Qg;let a;if(e.length>3){if(a=e[2],a!==null&&(typeof a!="number"||a<0||a!==Math.floor(a)))throw new Error('"array" length argument must be a positive integer literal');n++}s=ZR(s,a)}else switch(i){case"string":s=Cu;break;case"number":s=ln;break;case"boolean":s=ba;break;case"object":s=D8}const o=[];for(;n<e.length;n++){const a=Zt(e[n],r);o.push(a)}return new Ob(s,o)}evaluate(e,r){let i;for(const s of this._args){const n=s.evaluate(e,r);if(i=N8(n),IW(i,this.type))return n}throw new Error(`Expected ${$E(this.type)} but got ${$E(i)}`)}}class Eh{constructor(e,r){this.type=e,this._args=r}static parse(e,r){const i=e[0],s=Eh.types[i];if(s===ba||s===Cu){if(e.length!==2)throw new Error(`${i} expects one argument`)}else if(e.length<2)throw new Error(`${i} expects at least one argument`);const n=[];for(let o=1;o<e.length;o++){const a=Zt(e[o],r);n.push(a)}return new Eh(s,n)}evaluate(e,r){if(this.type===ba)return!!this._args[0].evaluate(e,r);if(this.type===Cu)return LW(this._args[0].evaluate(e,r));if(this.type===ln){for(const i of this._args){const s=Number(i.evaluate(e,r));if(!isNaN(s))return s}return null}if(this.type===f0){for(const i of this._args)try{const s=Eh.toColor(i.evaluate(e,r));if(s instanceof Fe)return s}catch{}return null}}static toBoolean(e){return!!e}static toString(e){return LW(e)}static toNumber(e){const r=Number(e);if(isNaN(r))throw new Error(`"${e}" is not a number`);return r}static toColor(e){if(e instanceof Fe)return e;if(typeof e=="string"){const r=Fe.fromString(e);if(r)return r;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return Fe.fromArray(e);throw new Error(`"${e}" is not a color`)}}Eh.types={"to-boolean":ba,"to-color":f0,"to-number":ln,"to-string":Cu};class zQ{constructor(e){this._val=e,this.type=N8(e)}static parse(e){if(e.length!==2)throw new Error('"literal" expects 1 argument');return new zQ(e[1])}evaluate(e,r){return this._val}}class BQ{constructor(e){this._arg=e,this.type=Cu}static parse(e,r){if(e.length!==2)throw new Error('"typeof" expects 1 argument');return new BQ(Zt(e[1],r))}evaluate(e,r){return $E(N8(this._arg.evaluate(e,r)))}}function Zt(t,e,r){const i=typeof t;if(i==="string"||i==="boolean"||i==="number"||t===null){if(r)switch(r.kind){case"string":i!=="string"&&(t=Eh.toString(t));break;case"number":i!=="number"&&(t=Eh.toNumber(t));break;case"color":t=Eh.toColor(t)}t=["literal",t]}if(!Array.isArray(t)||t.length===0)throw new Error("Expression must be a non empty array");const s=t[0];if(typeof s!="string")throw new Error("First element of expression must be a string");const n=LRe[s];if(n===void 0)throw new Error(`Invalid expression operator "${s}"`);if(!n)throw new Error(`Unimplemented expression operator "${s}"`);return n.parse(t,e,r)}const LRe={array:Ob,boolean:Ob,collator:null,format:null,image:null,literal:zQ,number:Ob,"number-format":null,object:Ob,string:Ob,"to-boolean":Eh,"to-color":Eh,"to-number":Eh,"to-string":Eh,typeof:BQ,accumulated:null,"feature-state":null,"geometry-type":OQ,id:fCt,"line-progress":null,properties:mCt,at:MCt,get:WF,has:YF,in:OCt,"index-of":RCt,length:LQ,slice:XF,"!":xCt,"!=":yCt,"<":_Ct,"<=":vCt,"==":gCt,">":bCt,">=":wCt,all:TCt,any:SCt,case:ECt,coalesce:$Q,match:CCt,within:null,interpolate:Yd,"interpolate-hcl":Yd,"interpolate-lab":Yd,step:IQ,let:ACt,var:PCt,concat:NQ,downcase:IE,"is-supported-script":null,"resolved-locale":null,upcase:IE,rgb:FQ,rgba:kQ,"to-rgba":UQ,"-":$Ct,"*":ICt,"/":LCt,"%":DCt,"^":NCt,"+":FCt,abs:en,acos:en,asin:en,atan:en,ceil:en,cos:en,e:en,floor:en,ln:en,ln2:en,log10:en,log2:en,max:en,min:en,pi:en,round:en,sin:en,sqrt:en,tan:en,zoom:xRe,"heatmap-density":null,"has-id":DQ,none:RQ};class ec{constructor(e){this._expression=e}filter(e,r){if(!this._expression)return!0;try{return this._expression.evaluate(e,r)}catch(i){return console.log(i.message),!0}}static createFilter(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{const r=Zt(e,null,ba);return new ec(r)}catch(r){return console.log(r.message),null}}static isLegacyFilter(e){if(!Array.isArray(e)||e.length===0)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return e.length===3&&typeof e[1]=="string"&&!Array.isArray(e[2]);case"in":return e.length>=3&&typeof e[1]=="string"&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let r=1;r<e.length;r++)if(this.isLegacyFilter(e[r]))return!0;return!1;case"has":return e.length===2&&(e[1]==="$id"||e[1]==="$type");default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||e.length===0)return!0;const r=e[0];if(e.length===1)return r!=="any";switch(r){case"==":return ec.convertComparison("==",e[1],e[2]);case"!=":return ec.negate(ec.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return ec.convertComparison(r,e[1],e[2]);case"in":return ec.convertIn(e[1],e.slice(2));case"!in":return ec.negate(ec.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return ec.convertCombining(r,e.slice(1));case"has":return ec.convertHas(e[1]);case"!has":return ec.negate(ec.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,r,i){switch(r){case"$type":return[e,["geometry-type"],i];case"$id":return[e,["id"],i];default:return[e,["get",r],i]}}static convertIn(e,r){switch(e){case"$type":return["in",["geometry-type"],["literal",r]];case"$id":return["in",["id"],["literal",r]];default:return["in",["get",e],["literal",r]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,r){return[e].concat(r.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}class ZF{constructor(e,r){let i;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":i=!0;break;case"array":i=e.value==="number";break;default:i=!1}if(r==null&&(r=e.default),Array.isArray(r)&&r.length>0&&LRe[r[0]]){const n={number:ln,color:f0,string:Cu,boolean:ba,enum:Cu};try{const o=e.type==="array"?ZR(n[e.value]||Qg,e.length):n[e.type],a=Zt(r,null,o);this.getValue=this._buildExpression(a,e),this.isDataDriven=!0,a instanceof Yd&&a.input instanceof xRe&&(this.interpolator=a)}catch(o){console.log(o.message),this.getValue=this._buildSimple(e.default)}return}i&&r.type==="interval"&&(i=!1);const s=(r==null?void 0:r.stops)&&r.stops.length>0;if(s)for(const n of r.stops)n[1]=this._validate(n[1],e);if(this.isDataDriven=!!r&&!!r.property,this.isDataDriven)if(r.default!==void 0&&(r.default=this._validate(r.default,e)),s)switch(r.type){case"identity":this.getValue=this._buildIdentity(r,e);break;case"categorical":this.getValue=this._buildCategorical(r,e);break;default:this.getValue=i?this._buildInterpolate(r,e):this._buildInterval(r,e)}else this.getValue=this._buildIdentity(r,e);else s?this.getValue=i?this._buildZoomInterpolate(r):this._buildZoomInterval(r):(r=this._validate(r,e),this.getValue=this._buildSimple(r))}_validate(e,r){if(r.type==="number"){if(r.minimum!=null&&e<r.minimum)return r.minimum;if(r.maximum!=null&&e>r.maximum)return r.maximum}else r.type==="color"?e=ZF._parseColor(e):r.type==="enum"?typeof e=="string"&&(e=r.values.indexOf(e)):r.type==="array"&&r.value==="enum"?e=e.map(i=>typeof i=="string"?r.values.indexOf(i):i):r.type==="string"&&(e=LW(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,r){return(i,s)=>{try{const n=e.evaluate(s,i);return n===void 0?r.default:this._validate(n,r)}catch(n){return console.log(n.message),r.default}}}_buildIdentity(e,r){return(i,s)=>{let n;return s&&(n=s.values[e.property]),n!==void 0&&(n=this._validate(n,r)),n??(e.default!==void 0?e.default:r.default)}}_buildCategorical(e,r){return(i,s)=>{let n;return s&&(n=s.values[e.property]),n=this._categorical(n,e.stops),n!==void 0?n:e.default!==void 0?e.default:r.default}}_buildInterval(e,r){return(i,s)=>{let n;return s&&(n=s.values[e.property]),typeof n=="number"?this._interval(n,e.stops):e.default!==void 0?e.default:r.default}}_buildInterpolate(e,r){return(i,s)=>{let n;return s&&(n=s.values[e.property]),typeof n=="number"?this._interpolate(n,e.stops,e.base||1):e.default!==void 0?e.default:r.default}}_buildZoomInterpolate(e){return r=>this._interpolate(r,e.stops,e.base||1)}_buildZoomInterval(e){return r=>this._interval(r,e.stops)}_categorical(e,r){const i=r.length;for(let s=0;s<i;s++)if(r[s][0]===e)return r[s][1]}_interval(e,r){const i=r.length;let s=0;for(let n=0;n<i&&r[n][0]<=e;n++)s=n;return r[s][1]}_interpolate(e,r,i){let s,n;const o=r.length;for(let a=0;a<o;a++){const l=r[a];if(!(l[0]<=e)){n=l;break}s=l}if(s&&n){const a=n[0]-s[0],l=e-s[0],c=i===1?l/a:(i**l-1)/(i**a-1);if(Array.isArray(s[1])){const u=s[1],h=n[1],p=[];for(let f=0;f<u.length;f++)p.push(vl(u[f],h[f],c));return p}return vl(s[1],n[1],c)}return s?s[1]:n?n[1]:void 0}static _isEmpty(e){for(const r in e)if(e.hasOwnProperty(r))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:(typeof e=="string"&&(e=new Fe(e)),e instanceof Fe&&!this._isEmpty(e)?Fe.toUnitRGBA(e):void 0)}}const LE=8;var OM;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(OM||(OM={}));class JR{constructor(e,r,i,s){switch(this.type=e,this.typeName=r.type,this.id=r.id,this.source=r.source,this.sourceLayer=r["source-layer"],this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,this.filter=r.filter,this.layout=r.layout,this.paint=r.paint,this.z=i,this.uid=s,e){case tn.BACKGROUND:this._layoutDefinition=In.backgroundLayoutDefinition,this._paintDefinition=In.backgroundPaintDefinition;break;case tn.FILL:this._layoutDefinition=In.fillLayoutDefinition,this._paintDefinition=In.fillPaintDefinition;break;case tn.LINE:this._layoutDefinition=In.lineLayoutDefinition,this._paintDefinition=In.linePaintDefinition;break;case tn.SYMBOL:this._layoutDefinition=In.symbolLayoutDefinition,this._paintDefinition=In.symbolPaintDefinition;break;case tn.CIRCLE:this._layoutDefinition=In.circleLayoutDefinition,this._paintDefinition=In.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return this._featureFilter!==void 0?this._featureFilter:this._featureFilter=ec.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,r,i){let s;const n=this._layoutProperties[e];return n&&(s=n.getValue(r,i)),s===void 0&&(s=this._layoutDefinition[e].default),s}getPaintValue(e,r,i){let s;const n=this._paintProperties[e];return n&&(s=n.getValue(r,i)),s===void 0&&(s=this._paintDefinition[e].default),s}isPainterDataDriven(){const e=this._paintProperties;if(e){for(const r in e)if(e[r].isDataDriven)return!0}return!1}isIntersectingFeature(e,r,i,s,n,o,a){return!1}getFeatureInflatedBounds(e,r,i,s){return null}_parseLayout(e){const r={};for(const i in e){const s=this._layoutDefinition[i];s&&(r[i]=new ZF(s,e[i]))}return r}_parsePaint(e){const r={};for(const i in e){const s=this._paintDefinition[i];s&&(r[i]=new ZF(s,e[i]))}return r}computeAttributesKey(e,r,i,s){let n=0,o=0;for(const a of r){let l=3;if(!a||a!==s){const c=i[a],{isLayout:u,isOptional:h}=c,p=u?this.getLayoutProperty(a):this.getPaintProperty(a);l=p!=null&&p.interpolator?2:p!=null&&p.isDataDriven?1:h&&!p?3:0}o|=l<<n,n+=2}return o<<3|e}}class kde extends JR{constructor(e,r,i,s){super(e,r,i,s),this.backgroundMaterial=new SS(this.computeAttributesKey(p0.BACKGROUND,SS.ATTRIBUTES,SS.ATTRIBUTES_INFO))}}class Ude extends JR{constructor(e,r,i,s){super(e,r,i,s);const n=this.getPaintProperty("fill-color"),o=this.getPaintProperty("fill-opacity"),a=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=n==null?void 0:n.isDataDriven,this.hasDataDrivenOpacity=o==null?void 0:o.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||(a==null?void 0:a.isDataDriven);const l=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!l,this.hasDataDrivenOutlineColor=l==null?void 0:l.isDataDriven,this.hasDataDrivenOutline=l?l.isDataDriven:!!n&&n.isDataDriven,this.hasDataDrivenOutline=(l?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new CS(this.computeAttributesKey(p0.FILL,CS.ATTRIBUTES,CS.ATTRIBUTES_INFO)),this.outlineMaterial=new Hf(this.computeAttributesKey(p0.OUTLINE,this.outlineUsesFillColor?Hf.ATTRIBUTES_FILL:Hf.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?Hf.ATTRIBUTES_INFO_FILL:Hf.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,r,i,s){const n=VQ(e);if(!n)return null;const o=this.getPaintValue("fill-translate",r,e),a=s*Math.max(o[0],o[1]);return n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a,n}isIntersectingFeature(e,r,i,s,n,o,a){const l=s.getGeometry();if(!l)return!1;const c=LE/a.normalizationRatio;e=e/a.normalizationRatio+a.normalizationOffsetX,r=r/a.normalizationRatio+a.normalizationOffsetY;const u=yK(this.getPaintValue("fill-translate",n,s),this.getPaintValue("fill-translate-anchor",n,s),o,LE);return e-=c*u.x,r-=c*u.y,!!xct(e,r,l)||jCe(e,r,l,c*i)}}class zde extends JR{constructor(e,r,i,s){var o,a,l,c,u,h,p,f,g;super(e,r,i,s);const n=this.getPaintProperty("line-pattern");if(this.lineMaterial=new AS(this.computeAttributesKey(p0.LINE,AS.ATTRIBUTES,AS.ATTRIBUTES_INFO,n?"line-dasharray":"")),this.hasDataDrivenLine=((o=this.getPaintProperty("line-blur"))==null?void 0:o.isDataDriven)||((a=this.getPaintProperty("line-color"))==null?void 0:a.isDataDriven)||((l=this.getPaintProperty("line-gap-width"))==null?void 0:l.isDataDriven)||((c=this.getPaintProperty("line-offset"))==null?void 0:c.isDataDriven)||((u=this.getPaintProperty("line-opacity"))==null?void 0:u.isDataDriven)||((h=this.getPaintProperty("line-pattern"))==null?void 0:h.isDataDriven)||((p=this.getPaintProperty("line-dasharray"))==null?void 0:p.isDataDriven)||((f=this.getLayoutProperty("line-cap"))==null?void 0:f.isDataDriven)||((g=this.getPaintProperty("line-width"))==null?void 0:g.isDataDriven),this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const _=this.getPaintProperty("line-width");if(!_||typeof _=="number"&&.5*_<Ilt){const v=this.getPaintProperty("line-offset");(!v||typeof v=="number"&&v===0)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,r){let i;switch(r){case OM.BUTT:i="Butt";break;case OM.ROUND:i="Round";break;case OM.SQUARE:i="Square";break;default:i="Butt"}return`dasharray-[${e.toString()}]-${i}`}getFeatureInflatedBounds(e,r,i,s){const n=VQ(e);if(!n)return null;const o=this.getPaintValue("line-translate",r,e),a=s*Math.max(o[0],o[1]);n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a;const l=s*Math.abs(this.getPaintValue("line-offset",r,e)||0),c=s*(this.getPaintValue("line-width",r,e)/2);return n[0]-=l+c,n[1]-=l+c,n[2]+=l+c,n[3]+=l+c,n}isIntersectingFeature(e,r,i,s,n,o,a){let l=s.getGeometry();if(!l)return!1;const c=LE/a.normalizationRatio;e=e/a.normalizationRatio+a.normalizationOffsetX,r=r/a.normalizationRatio+a.normalizationOffsetY;const u=yK(this.getPaintValue("line-translate",n,s),this.getPaintValue("line-translate-anchor",n,s),o,LE);e-=c*u.x,r-=c*u.y;const h=c*this.getPaintValue("line-offset",n,s)||0;h!==0&&(l=Sct(l,-h));const p=this.getPaintValue("line-width",n,s);return jCe(e,r,l,c*(i+p/2))}}class Bde extends JR{constructor(e,r,i,s){var n,o,a,l,c,u,h,p,f,g,_,v;super(e,r,i,s),this.iconMaterial=new PM(this.computeAttributesKey(p0.ICON,PM.ATTRIBUTES,PM.ATTRIBUTES_INFO)),this.textMaterial=new MM(this.computeAttributesKey(p0.TEXT,MM.ATTRIBUTES,MM.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=((n=this.getPaintProperty("icon-color"))==null?void 0:n.isDataDriven)||((o=this.getPaintProperty("icon-halo-blur"))==null?void 0:o.isDataDriven)||((a=this.getPaintProperty("icon-halo-color"))==null?void 0:a.isDataDriven)||((l=this.getPaintProperty("icon-halo-width"))==null?void 0:l.isDataDriven)||((c=this.getPaintProperty("icon-opacity"))==null?void 0:c.isDataDriven)||((u=this.getLayoutProperty("icon-size"))==null?void 0:u.isDataDriven),this.hasDataDrivenText=((h=this.getPaintProperty("text-color"))==null?void 0:h.isDataDriven)||((p=this.getPaintProperty("text-halo-blur"))==null?void 0:p.isDataDriven)||((f=this.getPaintProperty("text-halo-color"))==null?void 0:f.isDataDriven)||((g=this.getPaintProperty("text-halo-width"))==null?void 0:g.isDataDriven)||((_=this.getPaintProperty("text-opacity"))==null?void 0:_.isDataDriven)||((v=this.getLayoutProperty("text-size"))==null?void 0:v.isDataDriven)}}let Vde=class extends JR{constructor(e,r,i,s){super(e,r,i,s),this.circleMaterial=new ES(this.computeAttributesKey(p0.CIRCLE,ES.ATTRIBUTES,ES.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,r,i,s){const n=VQ(e);if(!n)return null;const o=this.getPaintValue("circle-translate",r,e),a=Math.max(o[0],o[1]);n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a;const l=s*(LE*(this.getPaintValue("circle-radius",r,e)+this.getPaintValue("circle-stroke-width",r,e))/2);return n[0]-=l,n[1]-=l,n[2]+=l,n[3]+=l,n}isIntersectingFeature(e,r,i,s,n,o,a){const l=s.getGeometry();if(!l)return!1;const c=LE/a.normalizationRatio;e=e/a.normalizationRatio+a.normalizationOffsetX,r=r/a.normalizationRatio+a.normalizationOffsetY,i*=c;const u=yK(this.getPaintValue("circle-translate",n,s),this.getPaintValue("circle-translate-anchor",n,s),o,c),h=c*(this.getPaintValue("circle-radius",n,s)+this.getPaintValue("circle-stroke-width",n,s));let p,f;for(const g of l)if(g){for(const _ of g)if(p=_.x+u.x,f=_.y+u.y,Math.sqrt((e-p)*(e-p)+(r-f)*(r-f))-i<=h)return!0}return!1}};class ijt{constructor(e,r,i){let s;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",r),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",r),this.keepUpright=e.getLayoutValue("icon-keep-upright",r),this.optional=e.getLayoutValue("icon-optional",r),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",r),this.rotationAlignment===hm.AUTO&&(this.rotationAlignment=i?hm.MAP:hm.VIEWPORT),s=e.getLayoutProperty("icon-anchor"),s!=null&&s.isDataDriven?this._anchorProp=s:this.anchor=e.getLayoutValue("icon-anchor",r),s=e.getLayoutProperty("icon-offset"),s!=null&&s.isDataDriven?this._offsetProp=s:this.offset=e.getLayoutValue("icon-offset",r),s=e.getLayoutProperty("icon-padding"),s!=null&&s.isDataDriven?this._paddingProp=s:this.padding=e.getLayoutValue("icon-padding",r),s=e.getLayoutProperty("icon-rotate"),s!=null&&s.isDataDriven?this._rotateProp=s:this.rotate=e.getLayoutValue("icon-rotate",r),s=e.getLayoutProperty("icon-size"),s!=null&&s.isDataDriven?this._sizeProp=s:this.size=e.getLayoutValue("icon-size",r)}update(e,r){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,r)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,r)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,r)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,r)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,r))}}class sjt{constructor(e,r,i){let s;this.allowOverlap=e.getLayoutValue("text-allow-overlap",r),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",r),this.keepUpright=e.getLayoutValue("text-keep-upright",r),this.optional=e.getLayoutValue("text-optional",r),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",r),this.rotationAlignment===hm.AUTO&&(this.rotationAlignment=i?hm.MAP:hm.VIEWPORT),s=e.getLayoutProperty("text-anchor"),s!=null&&s.isDataDriven?this._anchorProp=s:this.anchor=e.getLayoutValue("text-anchor",r),s=e.getLayoutProperty("text-justify"),s!=null&&s.isDataDriven?this._justifyProp=s:this.justify=e.getLayoutValue("text-justify",r),s=e.getLayoutProperty("text-letter-spacing"),s!=null&&s.isDataDriven?this._letterSpacingProp=s:this.letterSpacing=e.getLayoutValue("text-letter-spacing",r),s=e.getLayoutProperty("text-line-height"),s!=null&&s.isDataDriven?this._lineHeightProp=s:this.lineHeight=e.getLayoutValue("text-line-height",r),s=e.getLayoutProperty("text-max-angle"),s!=null&&s.isDataDriven?this._maxAngleProp=s:this.maxAngle=e.getLayoutValue("text-max-angle",r),s=e.getLayoutProperty("text-max-width"),s!=null&&s.isDataDriven?this._maxWidthProp=s:this.maxWidth=e.getLayoutValue("text-max-width",r),s=e.getLayoutProperty("text-offset"),s!=null&&s.isDataDriven?this._offsetProp=s:this.offset=e.getLayoutValue("text-offset",r),s=e.getLayoutProperty("text-padding"),s!=null&&s.isDataDriven?this._paddingProp=s:this.padding=e.getLayoutValue("text-padding",r),s=e.getLayoutProperty("text-rotate"),s!=null&&s.isDataDriven?this._rotateProp=s:this.rotate=e.getLayoutValue("text-rotate",r),s=e.getLayoutProperty("text-size"),s!=null&&s.isDataDriven?this._sizeProp=s:this.size=e.getLayoutValue("text-size",r),s=e.getLayoutProperty("text-writing-mode"),s!=null&&s.isDataDriven?this._writingModeProp=s:this.writingMode=e.getLayoutValue("text-writing-mode",r)}update(e,r){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,r)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,r)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,r)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,r)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,r)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,r)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,r)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,r)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,r)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,r)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,r))}}function VQ(t){const e=t==null?void 0:t.getGeometry();if(e==null)return null;let r=1/0,i=1/0,s=-1/0,n=-1/0;for(const o of e)if(o)for(const a of o)r=Math.min(r,a.x),i=Math.min(i,a.y),s=Math.max(s,a.x),n=Math.max(n,a.y);return QO(r,i,s,n)}class jT{constructor(e){if(this._style=e,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.layers=e.layers.map((r,i,s)=>this._create(r,i,s)).filter(r=>!!r),this.layers)for(let r=0;r<this.layers.length;r++){const i=this.layers[r];this._layerByName[i.id]=i,this._uidToLayer.set(i.uid,i),i.type===tn.BACKGROUND&&this.backgroundBucketIds.push(i.id)}this._identifyRefLayers()}isPainterDataDriven(e){const r=this._layerByName[e];return!!r&&r.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){const r=this._layerByName[e];return r?this.layers.indexOf(r):-1}setStyleLayer(e,r){if(!(e!=null&&e.id))return;const i=this._style;r!=null&&r>=this.layers.length&&(r=this.layers.length-1);let s,n=!0;const o=this._layerByName[e.id];if(o){const a=this.layers.indexOf(o);r||(r=a),r===a?(n=!1,s=jT._recreateLayer(e,o),this.layers[r]=s,i.layers[r]=e):(this.layers.splice(a,1),i.layers.splice(a,1),s=this._create(e,r,this.layers),this.layers.splice(r,0,s),i.layers.splice(r,0,e))}else s=this._create(e,r,this.layers),!r||r>=this.layers.length?(this.layers.push(s),i.layers.push(e)):(this.layers.splice(r,0,s),i.layers.splice(r,0,e));this._layerByName[e.id]=s,this._uidToLayer.set(s.uid,s),n&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const r=this._layerByName[e];return r?{type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:r.paint}:null}deleteStyleLayer(e){const r=this._layerByName[e];if(r){delete this._layerByName[e],this._uidToLayer.delete(r.uid);const i=this.layers.indexOf(r);this.layers.splice(i,1),this._style.layers.splice(i,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){const r=this._layerByName[e];return r?r.layout:null}getPaintProperties(e){const r=this._layerByName[e];return r?r.paint:null}setPaintProperties(e,r){const i=this._layerByName[e];if(!i)return;const s={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:i.layout,paint:r},n=jT._recreateLayer(s,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].paint=r,this._layerByName[i.id]=n,this._uidToLayer.set(i.uid,n)}setLayoutProperties(e,r){const i=this._layerByName[e];if(!i)return;const s={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:r,paint:i.paint},n=jT._recreateLayer(s,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].layout=r,this._layerByName[i.id]=n,this._uidToLayer.set(i.uid,n)}setStyleLayerVisibility(e,r){const i=this._layerByName[e];if(!i)return;const s=i.layout||{};s.visibility=r;const n={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:s,paint:i.paint},o=jT._recreateLayer(n,i),a=this.layers.indexOf(i);this.layers[a]=o,this._style.layers[a].layout=s,this._layerByName[i.id]=o,this._uidToLayer.set(i.uid,o)}getStyleLayerVisibility(e){const r=this._layerByName[e];if(!r)return"none";const i=r.layout;return(i==null?void 0:i.visibility)??"visible"}_recomputeZValues(){const e=this.layers,r=1/(e.length+1);for(let i=0;i<e.length;i++)e[i].z=1-(1+i)*r}_identifyRefLayers(){const e=[],r=[];let i=0;for(const s of this.layers){const n=s.layout;if(s.type===tn.FILL){const o=s;let a=s.source+"|"+s.sourceLayer;a+="|"+((n==null?void 0:n.visibility)??""),a+="|"+s.minzoom,a+="|"+s.maxzoom,a+="|"+JSON.stringify(s.filter),(o.hasDataDrivenFill||o.hasDataDrivenOutline)&&(a+="|"+i),e.push({key:a,layer:s})}else if(s.type===tn.LINE){const o=s,a=s.paint,l=a!=null&&(a["line-pattern"]!=null||a["line-dasharray"]!=null);let c=s.source+"|"+s.sourceLayer;c+="|"+((n==null?void 0:n.visibility)??""),c+="|"+s.minzoom,c+="|"+s.maxzoom,c+="|"+JSON.stringify(s.filter),c+="|"+(n!==void 0?n["line-cap"]:""),c+="|"+(n!==void 0?n["line-join"]:""),(o.hasDataDrivenLine||l)&&(c+="|"+i),r.push({key:c,layer:s})}++i}this._assignRefLayers(e),this._assignRefLayers(r)}_assignRefLayers(e){let r,i;e.sort((n,o)=>n.key<o.key?-1:n.key>o.key?1:0);const s=e.length;for(let n=0;n<s;n++){const o=e[n];if(o.key===r)o.layer.refLayerId=i;else if(r=o.key,i=o.layer.id,o.layer.type===tn.FILL){if(!o.layer.getPaintProperty("fill-outline-color"))for(let a=n+1;a<s;a++){const l=e[a];if(l.key!==r)break;if(l.layer.getPaintProperty("fill-outline-color")){e[n]=l,e[a]=o,i=l.layer.id;break}}}else if(o.layer.type===tn.LINE){let a=o.layer;for(let l=n+1;l<s;l++){const c=e[l];if(c.key!==r)break;const u=c.layer;(a.canUseThinTessellation&&!u.canUseThinTessellation||!a.canUseThinTessellation&&(u.getPaintProperty("line-pattern")||u.getPaintProperty("line-dasharray")))&&(a=u,e[n]=c,e[l]=o,i=c.layer.id)}}}}_create(e,r,i){const s=1-(1+r)*(1/(i.length+1)),n=this._runningId++;switch(e.type){case"background":return new kde(tn.BACKGROUND,e,s,n);case"fill":return new Ude(tn.FILL,e,s,n);case"line":return new zde(tn.LINE,e,s,n);case"symbol":return new Bde(tn.SYMBOL,e,s,n);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new Vde(tn.CIRCLE,e,s,n)}return null}static _recreateLayer(e,r){switch(e.type){case"background":return new kde(tn.BACKGROUND,e,r.z,r.uid);case"fill":return new Ude(tn.FILL,e,r.z,r.uid);case"line":return new zde(tn.LINE,e,r.z,r.uid);case"symbol":return new Bde(tn.SYMBOL,e,r.z,r.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new Vde(tn.CIRCLE,e,r.z,r.uid)}return null}}let Zi=class extends nRe(oRe(NEt(FEt(GEt(YEt(kEt($Et(hRe(qX))))))))){constructor(...t){super(...t),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.style=null,this.tilemapCache=null,this.type="vector-tile",this.url=null,this.path=null}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){var t;if(this.sourceNameToSource)for(const e of Object.values(this.sourceNameToSource))e==null||e.destroy();(t=this.primarySource)==null||t.destroy(),this._spriteSourceMap.clear()}async prefetchResources(t){await this.loadSpriteSource(globalThis.devicePixelRatio||1,t)}load(t){const e=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},t).catch(Uo).then(async()=>{var i;if(!((i=this.portalItem)!=null&&i.id))return;const r=`${this.portalItem.itemCdnUrl}/resources/styles/root.json`;(await Wr(r,{...t,query:{f:"json",...this.customParameters,token:this.apiKey}})).data&&this.read({url:r},oCt(this.portalItem,"portal-item"))}).catch(Uo).then(()=>this._loadStyle(t));return this.addResolvingPromise(e),Promise.resolve(this)}get attributionDataUrl(){const t=this.currentStyleInfo,e=(t==null?void 0:t.serviceUrl)&&$s(t.serviceUrl);if(!e)return null;const r=this._getDefaultAttribution(e.path);return r?em(r,{...this.customParameters,token:this.apiKey}):null}get capabilities(){const t=this.primarySource;return t?t.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){var t;return((t=this.primarySource)==null?void 0:t.fullExtent)||null}get initialExtent(){var t;return((t=this.primarySource)==null?void 0:t.initialExtent)||null}get parsedUrl(){return this.serviceUrl?$s(this.serviceUrl):null}get serviceUrl(){var t;return((t=this.currentStyleInfo)==null?void 0:t.serviceUrl)||null}get spatialReference(){var t;return((t=this.tileInfo)==null?void 0:t.spatialReference)??null}get styleUrl(){var t;return((t=this.currentStyleInfo)==null?void 0:t.styleUrl)||null}writeStyleUrl(t,e){t&&$h(t)&&(t=`https:${t}`);const r=DV(t);e.styleUrl=VX(t,r)}get tileInfo(){var r;const t=[];for(const i in this.sourceNameToSource)t.push(this.sourceNameToSource[i]);let e=((r=this.primarySource)==null?void 0:r.tileInfo)||new sm;if(t.length>1)for(let i=0;i<t.length;i++)aCt(e,t[i].tileInfo)&&(e=lCt(e,t[i].tileInfo));return e}readTilemapCache(t,e){var i;return((i=e.capabilities)==null?void 0:i.includes("Tilemap"))?new ih({layer:this}):null}readVersion(t,e){return e.version?parseFloat(e.version):parseFloat(e.currentVersion)}async loadSpriteSource(t=1,e){var r,i;if(!this._spriteSourceMap.has(t)){const s=bW().maxTextureSize,n=(r=this.currentStyleInfo)!=null&&r.spriteUrl?em(this.currentStyleInfo.spriteUrl,{...this.customParameters,token:this.apiKey}):null,o=new Ide({type:"url",spriteUrl:n,pixelRatio:t,spriteFormat:(i=this.currentStyleInfo)==null?void 0:i.spriteFormat},s);await o.load(e),this._spriteSourceMap.set(t,o)}return this._spriteSourceMap.get(t)}async setSpriteSource(t,e){if(!t)return null;const r=bW().maxTextureSize,i=t.spriteUrl,s=i?em(i,{...this.customParameters,token:this.apiKey}):null;if(!s&&t.type==="url")return null;const n=new Ide(t,r);try{await n.load(e);const o=t.pixelRatio||1;return this._spriteSourceMap.clear(),this._spriteSourceMap.set(o,n),s&&this.currentStyleInfo&&(this.currentStyleInfo.spriteUrl=s),this.emit("spriteSource-change",{spriteSource:n}),n}catch(o){Uo(o)}return null}async loadStyle(t,e){var i;const r=t||this.style||this.url;return this._loadingTask&&typeof r=="string"&&this.url===r||((i=this._loadingTask)==null||i.abort(),this._loadingTask=Am(s=>(this._spriteSourceMap.clear(),this._getSourceAndStyle(r,{signal:s})),e)),this._loadingTask.promise}getStyleLayerId(t){return this.styleRepository.getStyleLayerId(t)}getStyleLayerIndex(t){return this.styleRepository.getStyleLayerIndex(t)}getPaintProperties(t){var e;return ge((e=this.styleRepository)==null?void 0:e.getPaintProperties(t))}setPaintProperties(t,e){const r=this.styleRepository.isPainterDataDriven(t);this.styleRepository.setPaintProperties(t,e);const i=this.styleRepository.isPainterDataDriven(t);this.emit("paint-change",{layer:t,paint:e,isDataDriven:r||i})}getStyleLayer(t){return ge(this.styleRepository.getStyleLayer(t))}setStyleLayer(t,e){this.styleRepository.setStyleLayer(t,e),this.emit("style-layer-change",{layer:t,index:e})}deleteStyleLayer(t){this.styleRepository.deleteStyleLayer(t),this.emit("delete-style-layer",{layer:t})}getLayoutProperties(t){return ge(this.styleRepository.getLayoutProperties(t))}setLayoutProperties(t,e){this.styleRepository.setLayoutProperties(t,e),this.emit("layout-change",{layer:t,layout:e})}setStyleLayerVisibility(t,e){this.styleRepository.setStyleLayerVisibility(t,e),this.emit("style-layer-visibility-change",{layer:t,visibility:e})}getStyleLayerVisibility(t){return this.styleRepository.getStyleLayerVisibility(t)}write(t,e){return e!=null&&e.origin&&!this.styleUrl?(e.messages&&e.messages.push(new J("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(t,e)}getTileUrl(t,e,r){return null}async _getSourceAndStyle(t,e){if(!t)throw new Error("invalid style!");const r=await rCt(t,{...e,query:{...this.customParameters,token:this.apiKey}});r.spriteFormat==="webp"&&(await XEt("lossy")||(r.spriteFormat="png")),this._set("currentStyleInfo",{...r}),typeof t=="string"?(this.url=t,this.style=null):(this.url=null,this.style=t),this._set("sourceNameToSource",r.sourceNameToSource),this._set("primarySource",r.sourceNameToSource[r.primarySourceName]),this._set("styleRepository",new jT(r.style)),this.read(r.layerDefinition,{origin:"service"}),this.emit("load-style")}_getDefaultAttribution(t){const e=t.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i),r=["OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2"];if(!e)return;const i=e[2]&&e[2].toLowerCase();if(!i)return;const s=e[1]||"";for(const n of r)if(n.toLowerCase().includes(i))return mu(`//static.arcgis.com/attribution/Vector${s}/${n}`)}async _loadStyle(t){var e;return((e=this._loadingTask)==null?void 0:e.promise)??this.loadStyle(null,t)}};d([m({readOnly:!0})],Zi.prototype,"attributionDataUrl",null),d([m({type:["show","hide"]})],Zi.prototype,"listMode",void 0),d([m({json:{read:!0,write:!0}})],Zi.prototype,"blendMode",void 0),d([m({readOnly:!0,json:{read:!1}})],Zi.prototype,"capabilities",null),d([m({readOnly:!0})],Zi.prototype,"currentStyleInfo",void 0),d([m({json:{read:!1},readOnly:!0,type:$r})],Zi.prototype,"fullExtent",null),d([m({json:{read:!1},readOnly:!0,type:$r})],Zi.prototype,"initialExtent",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Zi.prototype,"isReference",void 0),d([m({type:["VectorTileLayer"]})],Zi.prototype,"operationalLayerType",void 0),d([m({readOnly:!0})],Zi.prototype,"parsedUrl",null),d([m()],Zi.prototype,"style",void 0),d([m({readOnly:!0})],Zi.prototype,"serviceUrl",null),d([m({type:Xe,readOnly:!0})],Zi.prototype,"spatialReference",null),d([m({readOnly:!0})],Zi.prototype,"styleRepository",void 0),d([m({readOnly:!0})],Zi.prototype,"sourceNameToSource",void 0),d([m({readOnly:!0})],Zi.prototype,"primarySource",void 0),d([m({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],Zi.prototype,"styleUrl",null),d([lr(["portal-item","web-document"],"styleUrl")],Zi.prototype,"writeStyleUrl",null),d([m({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:sm})],Zi.prototype,"tileInfo",null),d([m()],Zi.prototype,"tilemapCache",void 0),d([Tr("service","tilemapCache",["capabilities","tileInfo"])],Zi.prototype,"readTilemapCache",null),d([m({json:{read:!1},readOnly:!0,value:"vector-tile"})],Zi.prototype,"type",void 0),d([m({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],Zi.prototype,"url",void 0),d([m({readOnly:!0})],Zi.prototype,"version",void 0),d([Tr("version",["version","currentVersion"])],Zi.prototype,"readVersion",null),d([m({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Zi.prototype,"path",void 0),Zi=d([V("esri.layers.VectorTileLayer")],Zi);const DRe=Zi,njt=Object.freeze(Object.defineProperty({__proto__:null,default:DRe},Symbol.toStringTag,{value:"Module"})),kCt=Math.sqrt(50),UCt=Math.sqrt(10),zCt=Math.sqrt(2);function JF(t,e,r){const i=(e-t)/Math.max(0,r),s=Math.floor(Math.log10(i)),n=i/Math.pow(10,s),o=n>=kCt?10:n>=UCt?5:n>=zCt?2:1;let a,l,c;return s<0?(c=Math.pow(10,-s)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,s)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=r&&r<2?JF(t,e,r*2):[a,l,c]}function BCt(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const i=e<t,[s,n,o]=i?JF(e,t,r):JF(t,e,r);if(!(n>=s))return[];const a=n-s+1,l=new Array(a);if(i)if(o<0)for(let c=0;c<a;++c)l[c]=(n-c)/-o;else for(let c=0;c<a;++c)l[c]=(n-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(s+c)/-o;else for(let c=0;c<a;++c)l[c]=(s+c)*o;return l}function NW(t,e,r){return e=+e,t=+t,r=+r,JF(t,e,r)[2]}function VCt(t,e,r){e=+e,t=+t,r=+r;const i=e<t,s=i?NW(e,t,r):NW(t,e,r);return(i?-1:1)*(s<0?1/-s:s)}function F8(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function GQ(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function gC(){}var Yw=.7,DE=1/Yw,PS="\\s*([+-]?\\d+)\\s*",BO="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",mm="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",GCt=/^#([0-9a-f]{3,8})$/,jCt=new RegExp(`^rgb\\(${PS},${PS},${PS}\\)$`),HCt=new RegExp(`^rgb\\(${mm},${mm},${mm}\\)$`),qCt=new RegExp(`^rgba\\(${PS},${PS},${PS},${BO}\\)$`),WCt=new RegExp(`^rgba\\(${mm},${mm},${mm},${BO}\\)$`),YCt=new RegExp(`^hsl\\(${BO},${mm},${mm}\\)$`),XCt=new RegExp(`^hsla\\(${BO},${mm},${mm},${BO}\\)$`),Gde={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};F8(gC,NE,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:jde,formatHex:jde,formatHex8:ZCt,formatHsl:JCt,formatRgb:Hde,toString:Hde});function jde(){return this.rgb().formatHex()}function ZCt(){return this.rgb().formatHex8()}function JCt(){return FRe(this).formatHsl()}function Hde(){return this.rgb().formatRgb()}function NE(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=GCt.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?qde(e):r===3?new Xa(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?QL(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?QL(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=jCt.exec(t))?new Xa(e[1],e[2],e[3],1):(e=HCt.exec(t))?new Xa(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=qCt.exec(t))?QL(e[1],e[2],e[3],e[4]):(e=WCt.exec(t))?QL(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=YCt.exec(t))?Xde(e[1],e[2]/100,e[3]/100,1):(e=XCt.exec(t))?Xde(e[1],e[2]/100,e[3]/100,e[4]):Gde.hasOwnProperty(t)?qde(Gde[t]):t==="transparent"?new Xa(NaN,NaN,NaN,0):null}function qde(t){return new Xa(t>>16&255,t>>8&255,t&255,1)}function QL(t,e,r,i){return i<=0&&(t=e=r=NaN),new Xa(t,e,r,i)}function NRe(t){return t instanceof gC||(t=NE(t)),t?(t=t.rgb(),new Xa(t.r,t.g,t.b,t.opacity)):new Xa}function FW(t,e,r,i){return arguments.length===1?NRe(t):new Xa(t,e,r,i??1)}function Xa(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}F8(Xa,FW,GQ(gC,{brighter(t){return t=t==null?DE:Math.pow(DE,t),new Xa(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Yw:Math.pow(Yw,t),new Xa(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Xa(pw(this.r),pw(this.g),pw(this.b),KF(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Wde,formatHex:Wde,formatHex8:KCt,formatRgb:Yde,toString:Yde}));function Wde(){return`#${Hb(this.r)}${Hb(this.g)}${Hb(this.b)}`}function KCt(){return`#${Hb(this.r)}${Hb(this.g)}${Hb(this.b)}${Hb((isNaN(this.opacity)?1:this.opacity)*255)}`}function Yde(){const t=KF(this.opacity);return`${t===1?"rgb(":"rgba("}${pw(this.r)}, ${pw(this.g)}, ${pw(this.b)}${t===1?")":`, ${t})`}`}function KF(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function pw(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Hb(t){return t=pw(t),(t<16?"0":"")+t.toString(16)}function Xde(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new ep(t,e,r,i)}function FRe(t){if(t instanceof ep)return new ep(t.h,t.s,t.l,t.opacity);if(t instanceof gC||(t=NE(t)),!t)return new ep;if(t instanceof ep)return t;t=t.rgb();var e=t.r/255,r=t.g/255,i=t.b/255,s=Math.min(e,r,i),n=Math.max(e,r,i),o=NaN,a=n-s,l=(n+s)/2;return a?(e===n?o=(r-i)/a+(r<i)*6:r===n?o=(i-e)/a+2:o=(e-r)/a+4,a/=l<.5?n+s:2-n-s,o*=60):a=l>0&&l<1?0:o,new ep(o,a,l,t.opacity)}function QCt(t,e,r,i){return arguments.length===1?FRe(t):new ep(t,e,r,i??1)}function ep(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}F8(ep,QCt,GQ(gC,{brighter(t){return t=t==null?DE:Math.pow(DE,t),new ep(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Yw:Math.pow(Yw,t),new ep(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,s=2*r-i;return new Xa(rV(t>=240?t-240:t+120,s,i),rV(t,s,i),rV(t<120?t+240:t-120,s,i),this.opacity)},clamp(){return new ep(Zde(this.h),eD(this.s),eD(this.l),KF(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=KF(this.opacity);return`${t===1?"hsl(":"hsla("}${Zde(this.h)}, ${eD(this.s)*100}%, ${eD(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Zde(t){return t=(t||0)%360,t<0?t+360:t}function eD(t){return Math.max(0,Math.min(1,t||0))}function rV(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const e3t=Math.PI/180,t3t=180/Math.PI;var kRe=-.14861,jQ=1.78277,HQ=-.29227,k8=-.90649,VO=1.97294,Jde=VO*k8,Kde=VO*jQ,Qde=jQ*HQ-k8*kRe;function r3t(t){if(t instanceof fw)return new fw(t.h,t.s,t.l,t.opacity);t instanceof Xa||(t=NRe(t));var e=t.r/255,r=t.g/255,i=t.b/255,s=(Qde*i+Jde*e-Kde*r)/(Qde+Jde-Kde),n=i-s,o=(VO*(r-s)-HQ*n)/k8,a=Math.sqrt(o*o+n*n)/(VO*s*(1-s)),l=a?Math.atan2(o,n)*t3t-120:NaN;return new fw(l<0?l+360:l,a,s,t.opacity)}function l1(t,e,r,i){return arguments.length===1?r3t(t):new fw(t,e,r,i??1)}function fw(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}F8(fw,l1,GQ(gC,{brighter(t){return t=t==null?DE:Math.pow(DE,t),new fw(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Yw:Math.pow(Yw,t),new fw(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*e3t,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),s=Math.sin(t);return new Xa(255*(e+r*(kRe*i+jQ*s)),255*(e+r*(HQ*i+k8*s)),255*(e+r*(VO*i)),this.opacity)}}));const U8=t=>()=>t;function URe(t,e){return function(r){return t+r*e}}function i3t(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function s3t(t,e){var r=e-t;return r?URe(t,r>180||r<-180?r-360*Math.round(r/360):r):U8(isNaN(t)?e:t)}function n3t(t){return(t=+t)==1?MS:function(e,r){return r-e?i3t(e,r,t):U8(isNaN(e)?r:e)}}function MS(t,e){var r=e-t;return r?URe(t,r):U8(isNaN(t)?e:t)}const epe=function t(e){var r=n3t(e);function i(s,n){var o=r((s=FW(s)).r,(n=FW(n)).r),a=r(s.g,n.g),l=r(s.b,n.b),c=MS(s.opacity,n.opacity);return function(u){return s.r=o(u),s.g=a(u),s.b=l(u),s.opacity=c(u),s+""}}return i.gamma=t,i}(1);function o3t(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,i=e.slice(),s;return function(n){for(s=0;s<r;++s)i[s]=t[s]*(1-n)+e[s]*n;return i}}function a3t(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function l3t(t,e){var r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),n=new Array(r),o;for(o=0;o<i;++o)s[o]=qQ(t[o],e[o]);for(;o<r;++o)n[o]=e[o];return function(a){for(o=0;o<i;++o)n[o]=s[o](a);return n}}function c3t(t,e){var r=new Date;return t=+t,e=+e,function(i){return r.setTime(t*(1-i)+e*i),r}}function kW(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function u3t(t,e){var r={},i={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?r[s]=qQ(t[s],e[s]):i[s]=e[s];return function(n){for(s in r)i[s]=r[s](n);return i}}var UW=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,iV=new RegExp(UW.source,"g");function h3t(t){return function(){return t}}function d3t(t){return function(e){return t(e)+""}}function p3t(t,e){var r=UW.lastIndex=iV.lastIndex=0,i,s,n,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=UW.exec(t))&&(s=iV.exec(e));)(n=s.index)>r&&(n=e.slice(r,n),a[o]?a[o]+=n:a[++o]=n),(i=i[0])===(s=s[0])?a[o]?a[o]+=s:a[++o]=s:(a[++o]=null,l.push({i:o,x:kW(i,s)})),r=iV.lastIndex;return r<e.length&&(n=e.slice(r),a[o]?a[o]+=n:a[++o]=n),a.length<2?l[0]?d3t(l[0].x):h3t(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}function qQ(t,e){var r=typeof e,i;return e==null||r==="boolean"?U8(e):(r==="number"?kW:r==="string"?(i=NE(e))?(e=i,epe):p3t:e instanceof NE?epe:e instanceof Date?c3t:a3t(e)?o3t:Array.isArray(e)?l3t:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?u3t:kW)(t,e)}function f3t(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function zRe(t){return function e(r){r=+r;function i(s,n){var o=t((s=l1(s)).h,(n=l1(n)).h),a=MS(s.s,n.s),l=MS(s.l,n.l),c=MS(s.opacity,n.opacity);return function(u){return s.h=o(u),s.s=a(u),s.l=l(Math.pow(u,r)),s.opacity=c(u),s+""}}return i.gamma=e,i}(1)}zRe(s3t);var BRe=zRe(MS);function m3t(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function QF(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,i=t.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+t.slice(r+1)]}function FE(t){return t=QF(Math.abs(t)),t?t[1]:NaN}function g3t(t,e){return function(r,i){for(var s=r.length,n=[],o=0,a=t[0],l=0;s>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),n.push(r.substring(s-=a,s+a)),!((l+=a+1)>i));)a=t[o=(o+1)%t.length];return n.reverse().join(e)}}function y3t(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var _3t=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function e6(t){if(!(e=_3t.exec(t)))throw new Error("invalid format: "+t);var e;return new WQ({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}e6.prototype=WQ.prototype;function WQ(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}WQ.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function v3t(t){e:for(var e=t.length,r=1,i=-1,s;r<e;++r)switch(t[r]){case".":i=s=r;break;case"0":i===0&&(i=r),s=r;break;default:if(!+t[r])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(s+1):t}var VRe;function b3t(t,e){var r=QF(t,e);if(!r)return t+"";var i=r[0],s=r[1],n=s-(VRe=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=i.length;return n===o?i:n>o?i+new Array(n-o+1).join("0"):n>0?i.slice(0,n)+"."+i.slice(n):"0."+new Array(1-n).join("0")+QF(t,Math.max(0,e+n-1))[0]}function tpe(t,e){var r=QF(t,e);if(!r)return t+"";var i=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const rpe={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:m3t,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>tpe(t*100,e),r:tpe,s:b3t,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function ipe(t){return t}var spe=Array.prototype.map,npe=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function w3t(t){var e=t.grouping===void 0||t.thousands===void 0?ipe:g3t(spe.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",n=t.numerals===void 0?ipe:y3t(spe.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"âˆ’":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(h){h=e6(h);var p=h.fill,f=h.align,g=h.sign,_=h.symbol,v=h.zero,b=h.width,w=h.comma,T=h.precision,S=h.trim,C=h.type;C==="n"?(w=!0,C="g"):rpe[C]||(T===void 0&&(T=12),S=!0,C="g"),(v||p==="0"&&f==="=")&&(v=!0,p="0",f="=");var P=_==="$"?r:_==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",R=_==="$"?i:/[%p]/.test(C)?o:"",L=rpe[C],F=/[defgprs%]/.test(C);T=T===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,T)):Math.max(0,Math.min(20,T));function U(j){var z=P,Z=R,W,Y,le;if(C==="c")Z=L(j)+Z,j="";else{j=+j;var I=j<0||1/j<0;if(j=isNaN(j)?l:L(Math.abs(j),T),S&&(j=v3t(j)),I&&+j==0&&g!=="+"&&(I=!1),z=(I?g==="("?g:a:g==="-"||g==="("?"":g)+z,Z=(C==="s"?npe[8+VRe/3]:"")+Z+(I&&g==="("?")":""),F){for(W=-1,Y=j.length;++W<Y;)if(le=j.charCodeAt(W),48>le||le>57){Z=(le===46?s+j.slice(W+1):j.slice(W))+Z,j=j.slice(0,W);break}}}w&&!v&&(j=e(j,1/0));var N=z.length+j.length+Z.length,B=N<b?new Array(b-N+1).join(p):"";switch(w&&v&&(j=e(B+j,B.length?b-Z.length:1/0),B=""),f){case"<":j=z+j+Z+B;break;case"=":j=z+B+j+Z;break;case"^":j=B.slice(0,N=B.length>>1)+z+j+Z+B.slice(N);break;default:j=B+z+j+Z;break}return n(j)}return U.toString=function(){return h+""},U}function u(h,p){var f=c((h=e6(h),h.type="f",h)),g=Math.max(-8,Math.min(8,Math.floor(FE(p)/3)))*3,_=Math.pow(10,-g),v=npe[8+g/3];return function(b){return f(_*b)+v}}return{format:c,formatPrefix:u}}var tD,GRe,jRe;x3t({thousands:",",grouping:[3],currency:["$",""]});function x3t(t){return tD=w3t(t),GRe=tD.format,jRe=tD.formatPrefix,tD}function T3t(t){return Math.max(0,-FE(Math.abs(t)))}function S3t(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(FE(e)/3)))*3-FE(Math.abs(t)))}function E3t(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,FE(e)-FE(t))+1}function C3t(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function HRe(t){return t}function A3t(t,e,r,i){var s=VCt(t,e,r),n;switch(i=e6(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(n=S3t(s,o))&&(i.precision=n),jRe(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(n=E3t(s,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=n-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(n=T3t(s))&&(i.precision=n-(i.type==="%")*2);break}}return GRe(i)}function P3t(t){var e=t.domain;return t.ticks=function(r){var i=e();return BCt(i[0],i[i.length-1],r??10)},t.tickFormat=function(r,i){var s=e();return A3t(s[0],s[s.length-1],r??10,i)},t.nice=function(r){r==null&&(r=10);var i=e(),s=0,n=i.length-1,o=i[s],a=i[n],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=s,s=n,n=c);u-- >0;){if(c=NW(o,a,r),c===l)return i[s]=o,i[n]=a,e(i);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return t},t}function M3t(){var t=0,e=1,r,i,s,n,o=HRe,a=!1,l;function c(h){return h==null||isNaN(h=+h)?l:o(s===0?.5:(h=(n(h)-r)*s,a?Math.max(0,Math.min(1,h)):h))}c.domain=function(h){return arguments.length?([t,e]=h,r=n(t=+t),i=n(e=+e),s=r===i?0:1/(i-r),c):[t,e]},c.clamp=function(h){return arguments.length?(a=!!h,c):a},c.interpolator=function(h){return arguments.length?(o=h,c):o};function u(h){return function(p){var f,g;return arguments.length?([f,g]=p,o=h(f,g),c):[o(0),o(1)]}}return c.range=u(qQ),c.rangeRound=u(f3t),c.unknown=function(h){return arguments.length?(l=h,c):l},function(h){return n=h,r=h(t),i=h(e),s=r===i?0:1/(i-r),c}}function O3t(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function YQ(){var t=P3t(M3t()(HRe));return t.copy=function(){return O3t(t,YQ())},C3t.apply(t,arguments)}BRe(l1(-100,.75,.35),l1(80,1.5,.8));var qRe=BRe(l1(260,.75,.35),l1(80,1.5,.8));l1();function EP(t,e,r){this.k=t,this.x=e,this.y=r}EP.prototype={constructor:EP,scale:function(t){return t===1?this:new EP(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new EP(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};EP.prototype;const R3t="https://gitkubikon.github.io/STEMGlobe/assets/Mapdata-VcK69DVa.csv";function $3t(t,e,r,i,s){WRe(t,e,r||0,i||t.length-1,s||I3t)}function WRe(t,e,r,i,s){for(;i>r;){if(i-r>600){var n=i-r+1,o=e-r+1,a=Math.log(n),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(n-l)/n)*(o-n/2<0?-1:1),u=Math.max(r,Math.floor(e-o*l/n+c)),h=Math.min(i,Math.floor(e+(n-o)*l/n+c));WRe(t,e,u,h,s)}var p=t[e],f=r,g=i;for(M3(t,r,e),s(t[i],p)>0&&M3(t,r,i);f<g;){for(M3(t,f,g),f++,g--;s(t[f],p)<0;)f++;for(;s(t[g],p)>0;)g--}s(t[r],p)===0?M3(t,r,g):(g++,M3(t,g,i)),g<=e&&(r=g+1),e<=g&&(i=g-1)}}function M3(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function I3t(t,e){return t<e?-1:t>e?1:0}class L3t{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let r=this.data;const i=[];if(!iD(e,r))return i;const s=this.toBBox,n=[];for(;r;){for(let o=0;o<r.children.length;o++){const a=r.children[o],l=r.leaf?s(a):a;iD(e,l)&&(r.leaf?i.push(a):nV(e,l)?this._all(a,i):n.push(a))}r=n.pop()}return i}collides(e){let r=this.data;if(!iD(e,r))return!1;const i=[];for(;r;){for(let s=0;s<r.children.length;s++){const n=r.children[s],o=r.leaf?this.toBBox(n):n;if(iD(e,o)){if(r.leaf||nV(e,o))return!0;i.push(n)}}r=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let r=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){const i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=mT([]),this}remove(e,r){if(!e)return this;let i=this.data;const s=this.toBBox(e),n=[],o=[];let a,l,c;for(;i||n.length;){if(i||(i=n.pop(),l=n[n.length-1],a=o.pop(),c=!0),i.leaf){const u=D3t(e,i.children,r);if(u!==-1)return i.children.splice(u,1),n.push(i),this._condense(n),this}!c&&!i.leaf&&nV(i,s)?(n.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],c=!1):i=null}return this}toBBox(e){return e}compareMinX(e,r){return e.minX-r.minX}compareMinY(e,r){return e.minY-r.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,r){const i=[];for(;e;)e.leaf?r.push(...e.children):i.push(...e.children),e=i.pop();return r}_build(e,r,i,s){const n=i-r+1;let o=this._maxEntries,a;if(n<=o)return a=mT(e.slice(r,i+1)),C2(a,this.toBBox),a;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),a=mT([]),a.leaf=!1,a.height=s;const l=Math.ceil(n/o),c=l*Math.ceil(Math.sqrt(o));ope(e,r,i,c,this.compareMinX);for(let u=r;u<=i;u+=c){const h=Math.min(u+c-1,i);ope(e,u,h,l,this.compareMinY);for(let p=u;p<=h;p+=l){const f=Math.min(p+l-1,h);a.children.push(this._build(e,p,f,s-1))}}return C2(a,this.toBBox),a}_chooseSubtree(e,r,i,s){for(;s.push(r),!(r.leaf||s.length-1===i);){let n=1/0,o=1/0,a;for(let l=0;l<r.children.length;l++){const c=r.children[l],u=sV(c),h=k3t(e,c)-u;h<o?(o=h,n=u<n?u:n,a=c):h===o&&u<n&&(n=u,a=c)}r=a||r.children[0]}return r}_insert(e,r,i){const s=i?e:this.toBBox(e),n=[],o=this._chooseSubtree(s,this.data,r,n);for(o.children.push(e),AP(o,s);r>=0&&n[r].children.length>this._maxEntries;)this._split(n,r),r--;this._adjustParentBBoxes(s,n,r)}_split(e,r){const i=e[r],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const o=this._chooseSplitIndex(i,n,s),a=mT(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,C2(i,this.toBBox),C2(a,this.toBBox),r?e[r-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,r){this.data=mT([e,r]),this.data.height=e.height+1,this.data.leaf=!1,C2(this.data,this.toBBox)}_chooseSplitIndex(e,r,i){let s,n=1/0,o=1/0;for(let a=r;a<=i-r;a++){const l=CP(e,0,a,this.toBBox),c=CP(e,a,i,this.toBBox),u=U3t(l,c),h=sV(l)+sV(c);u<n?(n=u,s=a,o=h<o?h:o):u===n&&h<o&&(o=h,s=a)}return s||i-r}_chooseSplitAxis(e,r,i){const s=e.leaf?this.compareMinX:N3t,n=e.leaf?this.compareMinY:F3t,o=this._allDistMargin(e,r,i,s),a=this._allDistMargin(e,r,i,n);o<a&&e.children.sort(s)}_allDistMargin(e,r,i,s){e.children.sort(s);const n=this.toBBox,o=CP(e,0,r,n),a=CP(e,i-r,i,n);let l=rD(o)+rD(a);for(let c=r;c<i-r;c++){const u=e.children[c];AP(o,e.leaf?n(u):u),l+=rD(o)}for(let c=i-r-1;c>=r;c--){const u=e.children[c];AP(a,e.leaf?n(u):u),l+=rD(a)}return l}_adjustParentBBoxes(e,r,i){for(let s=i;s>=0;s--)AP(r[s],e)}_condense(e){for(let r=e.length-1,i;r>=0;r--)e[r].children.length===0?r>0?(i=e[r-1].children,i.splice(i.indexOf(e[r]),1)):this.clear():C2(e[r],this.toBBox)}}function D3t(t,e,r){if(!r)return e.indexOf(t);for(let i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function C2(t,e){CP(t,0,t.children.length,e,t)}function CP(t,e,r,i,s){s||(s=mT(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let n=e;n<r;n++){const o=t.children[n];AP(s,t.leaf?i(o):o)}return s}function AP(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function N3t(t,e){return t.minX-e.minX}function F3t(t,e){return t.minY-e.minY}function sV(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function rD(t){return t.maxX-t.minX+(t.maxY-t.minY)}function k3t(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function U3t(t,e){const r=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-r)*Math.max(0,n-i)}function nV(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function iD(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function mT(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ope(t,e,r,i,s){const n=[e,r];for(;n.length;){if(r=n.pop(),e=n.pop(),r-e<=i)continue;const o=e+Math.ceil((r-e)/i/2)*i;$3t(t,o,e,r,s),n.push(e,o,o,r)}}function z3t(t){let e;return{c(){e=As("div"),Xs(e,"id",t[0]),Xs(e,"class","map svelte-1olttu1")},m(r,i){jO(r,e,i),t[2](e)},p(r,[i]){i&1&&Xs(e,"id",r[0])},i:Tc,o:Tc,d(r){r&&Zw(e),t[2](null)}}}const B3t="AAPKfb786cc2758148739175c3ec34911c15ZmP9fvQ4IkY-MIc7PqC8pirSsJPVFRXx68tuu71NEskmmiWOCf2EEhMHvilOFZlQ",V3t="84090feab9024ce2bb8bcf850e75573d",ape=.3;function G3t(t,e,r){let{id:i="university-stem-map"}=e,s,n,o,a=new _Et,l=[];const c=YQ(qRe).domain([0,100]);ii.apiKey=B3t;const u=async()=>{try{l=await PEt(R3t)}catch(w){console.error("Error loading CSV data:",w)}},h=(w,T)=>{const S=Array.from({length:6},(C,P)=>{const R=Math.PI/3*P;return[w.longitude+T*Math.cos(R),w.latitude+T*Math.sin(R)]});return S.push(S[0]),S},p=(w,T,S,C,P,R)=>{const L=[],F=C/S;for(let U=0;U<S;U++){const j=T*(1+U),z=new bp({rings:[h(w,j)],spatialReference:{wkid:4326}}),Z=new yR({symbolLayers:[new eZ({material:{color:[P.r,P.g,P.b,.6]},size:C-U*F})]});L.push(new W_({geometry:z,symbol:Z,attributes:R}))}return L},f=(w,T)=>{const S=new L3t,C=[];return w.forEach(P=>{const{Latitude:R,Longitude:L}=P,F={minX:L-T,minY:R-T,maxX:L+T,maxY:R+T,data:P},U=S.search(F);if(U.length>0){const j=U[0].data.cluster;j.points.push(P),j.latitude=(j.latitude*j.points.length+R)/(j.points.length+1),j.longitude=(j.longitude*j.points.length+L)/(j.points.length+1)}else{const j={latitude:R,longitude:L,points:[P]};F.data={cluster:j},C.push(j),S.insert(F)}}),C},g=async()=>{const w=[];return f(l,1).forEach(S=>{const{latitude:C,longitude:P,points:R}=S,L=new Ke({longitude:P,latitude:C,spatialReference:{wkid:4326}}),F=R.reduce((I,N)=>I+parseFloat(N.Estimated_Student_Count),0),U=R.reduce((I,N)=>I+parseFloat(N.Female_STEM_Graduates_Percentage),0)/R.length,j=F*20,z=NE(c(U)).rgb(),le=p(L,1,1,j,z,{points:R});w.push(...le)}),w},_=async w=>{for(let S=0;S<w.length;S+=1){const C=w.slice(S,S+1);a.addMany(C),await new Promise(P=>requestAnimationFrame(P))}},v=async()=>{try{const w=new oS({baseLayers:[new DRe({portalItem:{id:V3t}})]});n=new W1e({basemap:w,layers:[a]}),o=new gEt({container:s,map:n,environment:{starsEnabled:!0,atmosphereEnabled:!0},ui:{components:[]}}),o.when(()=>{o.on("mouse-wheel",T=>{T.stopPropagation();const S=o.zoom+(T.deltaY>0?-ape:ape);o.zoom=S})})}catch(w){console.error("Error initializing map:",w)}};h$e(async()=>{await u(),await v();const w=await g();await _(w)}),d$e(()=>{o==null||o.destroy()});function b(w){u4[w?"unshift":"push"](()=>{s=w,r(1,s)})}return t.$$set=w=>{"id"in w&&r(0,i=w.id)},[i,s,b]}let j3t=class extends r6{constructor(e){super(),t6(this,e,G3t,z3t,GO,{id:0})}};function H3t(t){const e=t-1;return e*e*e+1}function lpe(t,{delay:e=0,duration:r=400,easing:i=vpe}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:r,easing:i,css:n=>`opacity: ${n*s}`}}function cpe(t,{delay:e=0,duration:r=400,easing:i=H3t,x:s=0,y:n=0,opacity:o=0}={}){const a=getComputedStyle(t),l=+a.opacity,c=a.transform==="none"?"":a.transform,u=l*(1-o),[h,p]=KQ(s),[f,g]=KQ(n);return{delay:e,duration:r,easing:i,css:(_,v)=>`
			transform: ${c} translate(${(1-_)*h}${p}, ${(1-_)*f}${g});
			opacity: ${l-u*v}`}}function upe(t){let e,r,i,s,n,o,a,l,c,u,h,p,f,g,_,v,b,w,T,S;return{c(){e=As("div"),r=As("div"),i=As("div"),s=Va(),n=As("button"),n.textContent="Ã—",o=Va(),a=As("h2"),a.textContent="University STEM Map Project",l=Va(),c=As("div"),c.innerHTML='<p class="svelte-14gqb70">This project visualizes estimated student counts and the percentage of female STEM graduates for universities worldwide. Built with Svelte, TypeScript, and Vite, it leverages the ArcGIS API for JavaScript to render a detailed and interactive map. The primary focus of this project is to provide insightful visualizations while maintaining optimal performance even with large datasets.</p>',u=Va(),h=As("div"),h.innerHTML=`<h3 class="svelte-14gqb70">Data Gathering</h3> <p class="svelte-14gqb70">The data for this project is sourced from 
          <a href="https://ourworldindata.org/grapher/share-graduates-stem-female" target="_blank" class="svelte-14gqb70">Our World in Data</a>. This dataset includes the share of female STEM graduates over time for various countries. For countries missing data, estimations were made based on a machine learning model trained on known data. The model considers the following factors:</p> <ul class="svelte-14gqb70"><li class="svelte-14gqb70">Gross Domestic Product (GDP)</li> <li class="svelte-14gqb70">Education Expenditure</li> <li class="svelte-14gqb70">Internet Penetration Rate</li> <li class="svelte-14gqb70">Urbanization Rate</li> <li class="svelte-14gqb70">Gender Parity Index in Education</li></ul> <p class="svelte-14gqb70">The machine learning model was trained using a dataset of countries with complete information on these factors. It uses regression techniques to estimate the percentage of female STEM graduates for countries with missing data. This approach ensures a comprehensive dataset for visualizing global trends in STEM education.</p>`,p=Va(),f=As("div"),f.innerHTML='<h3 class="svelte-14gqb70">Key Features</h3> <ul class="svelte-14gqb70"><li class="svelte-14gqb70"><strong>Data Loading:</strong> Efficient loading and processing of data from CSV files.</li> <li class="svelte-14gqb70"><strong>Hexagon Visualization:</strong> Utilizes hexagons to represent data points, with size and color denoting different metrics.</li> <li class="svelte-14gqb70"><strong>Clustering:</strong> Implements spatial indexing to cluster nearby data points, improving rendering performance.</li> <li class="svelte-14gqb70"><strong>Batch Processing:</strong> Adds graphics to the map in batches to prevent main thread blocking.</li> <li class="svelte-14gqb70"><strong>Optimized Rendering:</strong> Simplifies symbols and geometries to reduce rendering overhead.</li></ul>',g=Va(),_=As("div"),_.innerHTML='<h3 class="svelte-14gqb70">Connect with Me</h3> <p class="svelte-14gqb70">For more information about this project or to connect with me, visit my profiles:</p> <div class="connect svelte-14gqb70"><a href="https://github.com/Gitkubikon" target="_blank" class="svelte-14gqb70">GitHub: Gitkubikon</a> <a href="https://www.linkedin.com/in/nikita-friesen/" target="_blank" class="svelte-14gqb70">LinkedIn: Nikita Friesen</a></div>',Xs(i,"class","modal-background svelte-14gqb70"),Xs(n,"class","close-button svelte-14gqb70"),Xs(a,"class","svelte-14gqb70"),Xs(c,"class","section svelte-14gqb70"),Xs(h,"class","section svelte-14gqb70"),Xs(f,"class","section svelte-14gqb70"),Xs(_,"class","section svelte-14gqb70"),Xs(r,"class","modal fly-in-out svelte-14gqb70"),Xs(e,"class","modal-overlay svelte-14gqb70")},m(C,P){jO(C,e,P),Zr(e,r),Zr(r,i),Zr(r,s),Zr(r,n),Zr(r,o),Zr(r,a),Zr(r,l),Zr(r,c),Zr(r,u),Zr(r,h),Zr(r,p),Zr(r,f),Zr(r,g),Zr(r,_),w=!0,T||(S=[sD(n,"click",t[1]),sD(r,"click",s$e(t[3])),sD(e,"click",t[1])],T=!0)},p:Tc,i(C){w||(C&&OS(()=>{w&&(v||(v=QR(r,cpe,{y:20,duration:500},!0)),v.run(1))}),C&&OS(()=>{w&&(b||(b=QR(e,lpe,{},!0)),b.run(1))}),w=!0)},o(C){C&&(v||(v=QR(r,cpe,{y:20,duration:500},!1)),v.run(0)),C&&(b||(b=QR(e,lpe,{},!1)),b.run(0)),w=!1},d(C){C&&Zw(e),C&&v&&v.end(),C&&b&&b.end(),T=!1,Xw(S)}}}function q3t(t){let e,r=t[0]&&upe(t);return{c(){r&&r.c(),e=i$e()},m(i,s){r&&r.m(i,s),jO(i,e,s)},p(i,[s]){i[0]?r?(r.p(i,s),s&1&&qb(r,1)):(r=upe(i),r.c(),qb(r,1),r.m(e.parentNode,e)):r&&(b$e(),MP(r,1,1,()=>{r=null}),w$e())},i(i){qb(r)},o(i){MP(r)},d(i){i&&Zw(e),r&&r.d(i)}}}function W3t(t,e,r){let{show:i=!1}=e,{onClose:s=()=>{}}=e;const n=()=>{s()};function o(a){p$e.call(this,t,a)}return t.$$set=a=>{"show"in a&&r(0,i=a.show),"onClose"in a&&r(2,s=a.onClose)},[i,n,s,o]}class Y3t extends r6{constructor(e){super(),t6(this,e,W3t,q3t,GO,{show:0,onClose:2})}}const A2=[];function X3t(t,e=Tc){let r;const i=new Set;function s(a){if(GO(t,a)&&(t=a,r)){const l=!A2.length;for(const c of i)c[1](),A2.push(c,t);if(l){for(let c=0;c<A2.length;c+=2)A2[c][0](A2[c+1]);A2.length=0}}}function n(a){s(a(t))}function o(a,l=Tc){const c=[a,l];return i.add(c),i.size===1&&(r=e(s,n)||Tc),a(t),()=>{i.delete(c),i.size===0&&r&&(r(),r=null)}}return{set:s,update:n,subscribe:o}}function Z3t(t){let e,r,i,s,n,o,a,l,c,u,h,p,f;i=new P$e({props:{colorScale:t[2]}}),a=new j3t({});function g(v){t[5](v)}let _={onClose:t[4]};return t[0]!==void 0&&(_.show=t[0]),c=new Y3t({props:_}),u4.push(()=>T$e(c,"show",g)),{c(){e=As("main"),r=As("div"),j8(i.$$.fragment),s=Va(),n=As("button"),n.textContent="About this Project",o=Va(),j8(a.$$.fragment),l=Va(),j8(c.$$.fragment),Xs(n,"class","svelte-99j1dk"),Xs(r,"class","controls svelte-99j1dk"),Xs(e,"class","svelte-99j1dk")},m(v,b){jO(v,e,b),Zr(e,r),oD(i,r,null),Zr(r,s),Zr(r,n),Zr(e,o),oD(a,e,null),Zr(e,l),oD(c,e,null),h=!0,p||(f=sD(n,"click",t[3]),p=!0)},p(v,[b]){const w={};!u&&b&1&&(u=!0,w.show=v[0],g$e(()=>u=!1)),c.$set(w)},i(v){h||(qb(i.$$.fragment,v),qb(a.$$.fragment,v),qb(c.$$.fragment,v),h=!0)},o(v){MP(i.$$.fragment,v),MP(a.$$.fragment,v),MP(c.$$.fragment,v),h=!1},d(v){v&&Zw(e),aD(i),aD(a),aD(c),p=!1,f()}}}function J3t(t,e,r){let i,s=X3t(!1);KRe(t,s,c=>r(0,i=c));const n=YQ(qRe).domain([0,100]),o=()=>{s.update(c=>!c)},a=()=>s.set(!1);function l(c){i=c,s.set(i)}return[i,s,n,o,a,l]}class K3t extends r6{constructor(e){super(),t6(this,e,J3t,Z3t,GO,{})}}new K3t({target:document.getElementById("app")});const Q3t=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:aS,build:Hbe},Symbol.toStringTag,{value:"Module"})),eAt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:xZ,build:lwe},Symbol.toStringTag,{value:"Module"})),tAt=Object.freeze(Object.defineProperty({__proto__:null,build:gwe},Symbol.toStringTag,{value:"Module"})),rAt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:PZ,build:Twe},Symbol.toStringTag,{value:"Module"})),iAt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:MZ,build:Cwe},Symbol.toStringTag,{value:"Module"})),sAt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:RZ,build:Gwe},Symbol.toStringTag,{value:"Module"})),nAt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:LZ,SimpleAtmospherePassParameters:Lk,build:Kwe},Symbol.toStringTag,{value:"Module"})),oAt=Object.freeze(Object.defineProperty({__proto__:null,build:Sxe},Symbol.toStringTag,{value:"Module"})),aAt=Object.freeze(Object.defineProperty({__proto__:null,build:Axe},Symbol.toStringTag,{value:"Module"})),lAt=Object.freeze(Object.defineProperty({__proto__:null,build:lTe,calculateAnchorPosForRendering:bO},Symbol.toStringTag,{value:"Module"})),cAt=Object.freeze(Object.defineProperty({__proto__:null,build:rSe},Symbol.toStringTag,{value:"Module"})),uAt=Object.freeze(Object.defineProperty({__proto__:null,build:nSe,getRadius:c8},Symbol.toStringTag,{value:"Module"})),hAt=Object.freeze(Object.defineProperty({__proto__:null,build:cSe},Symbol.toStringTag,{value:"Module"})),dAt=Object.freeze(Object.defineProperty({__proto__:null,build:hSe},Symbol.toStringTag,{value:"Module"})),pAt=Object.freeze(Object.defineProperty({__proto__:null,build:CSe},Symbol.toStringTag,{value:"Module"})),fAt=Object.freeze(Object.defineProperty({__proto__:null,build:REe,ribbonlineNumRoundJoinSubdivisions:AO},Symbol.toStringTag,{value:"Module"})),mAt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:JJ,build:aEe},Symbol.toStringTag,{value:"Module"})),gAt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:lK,build:jEe},Symbol.toStringTag,{value:"Module"})),yAt=Object.freeze(Object.defineProperty({__proto__:null,build:l3e},Symbol.toStringTag,{value:"Module"})),_At=Object.freeze(Object.defineProperty({__proto__:null,build:I3e},Symbol.toStringTag,{value:"Module"})),vAt=Object.freeze(Object.defineProperty({__proto__:null,build:pAe},Symbol.toStringTag,{value:"Module"})),bAt=Object.freeze(Object.defineProperty({__proto__:null,build:bAe},Symbol.toStringTag,{value:"Module"})),wAt=Object.freeze(Object.defineProperty({__proto__:null,build:TAe},Symbol.toStringTag,{value:"Module"})),xAt=Object.freeze(Object.defineProperty({__proto__:null,build:LAe},Symbol.toStringTag,{value:"Module"})),TAt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:JK,build:IPe},Symbol.toStringTag,{value:"Module"})),SAt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a1},build:tMe},Symbol.toStringTag,{value:"Module"})),EAt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:RPe,ColorizerStretchUniforms:OPe,ColorizerUniforms:GR,build:$Pe},Symbol.toStringTag,{value:"Module"})),CAt=Object.freeze(Object.defineProperty({__proto__:null,build:yMe},Symbol.toStringTag,{value:"Module"})),AAt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:$8,build:CMe},Symbol.toStringTag,{value:"Module"})),PAt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:fQ,build:PMe},Symbol.toStringTag,{value:"Module"})),MAt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:mQ,build:RMe},Symbol.toStringTag,{value:"Module"})),OAt=Object.freeze(Object.defineProperty({__proto__:null,build:UMe},Symbol.toStringTag,{value:"Module"})),RAt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:_Q,build:VMe},Symbol.toStringTag,{value:"Module"})),$At=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:gQ,blurSize:yQ,build:kMe,gridCellPixelSize:Nd,outlineSize:kO},Symbol.toStringTag,{value:"Module"})),IAt=Object.freeze(Object.defineProperty({__proto__:null,build:WMe},Symbol.toStringTag,{value:"Module"})),LAt=Object.freeze(Object.defineProperty({__proto__:null,build:ZMe},Symbol.toStringTag,{value:"Module"})),DAt=Object.freeze(Object.defineProperty({__proto__:null,build:QMe},Symbol.toStringTag,{value:"Module"})),NAt=Object.freeze(Object.defineProperty({__proto__:null,build:rOe},Symbol.toStringTag,{value:"Module"})),FAt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:bQ,build:oOe},Symbol.toStringTag,{value:"Module"})),kAt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:HR,build:nOe},Symbol.toStringTag,{value:"Module"})),UAt=Object.freeze(Object.defineProperty({__proto__:null,build:dOe},Symbol.toStringTag,{value:"Module"}));export{Xe as $,si as A,C6 as B,P_ as C,mw as D,Ji as E,Hpe as F,Rc as G,Dh as H,un as I,O as J,qe as K,EE as L,Tn as M,cK as N,o1 as O,ui as P,Xt as Q,xi as R,Me as S,co as T,zDt as U,Mt as V,vO as W,BDt as X,Ri as Y,ya as Z,me as _,J as a,xp as a$,Ep as a0,Ze as a1,fe as a2,te as a3,ae as a4,E as a5,XGt as a6,sO as a7,ns as a8,J5t as a9,Nl as aA,FRt as aB,rve as aC,Ka as aD,on as aE,hX as aF,Yt as aG,we as aH,kt as aI,hV as aJ,Mpe as aK,v7e as aL,cve as aM,qRt as aN,WRt as aO,BRt as aP,XM as aQ,qY as aR,Ya as aS,f6 as aT,Sp as aU,HRt as aV,LV as aW,PRt as aX,u6e as aY,ER as aZ,rR as a_,K5t as aa,qX as ab,Het as ac,c0 as ad,cie as ae,A4t as af,Nkt as ag,x8t as ah,yt as ai,tR as aj,Ot as ak,b8t as al,OUe as am,RRt as an,A7e as ao,$r as ap,xa as aq,_R as ar,Fe as as,g_ as at,uZ as au,zve as av,Pje as aw,ax,tC as ay,Pt as az,M0e as b,jK as b$,vt as b0,vw as b1,Ak as b2,jP as b3,kl as b4,Uo as b5,Wr as b6,Jr as b7,Ke as b8,tp as b9,ORt as bA,X1e as bB,rY as bC,S$t as bD,TMt as bE,PUe as bF,Au as bG,Vje as bH,J$t as bI,G7e as bJ,hve as bK,kRt as bL,KRt as bM,O7e as bN,b5 as bO,v5 as bP,$Rt as bQ,URt as bR,HM as bS,tke as bT,Jw as bU,nut as bV,out as bW,yHe as bX,GS as bY,tIt as bZ,Lzt as b_,VE as ba,XW as bb,a6 as bc,w6e as bd,U6 as be,GRt as bf,jRt as bg,LMt as bh,_6e as bi,FMt as bj,NMt as bk,DMt as bl,Sg as bm,lr as bn,ma as bo,We as bp,ge as bq,sPe as br,qo as bs,Yo as bt,Tr as bu,sbe as bv,O6 as bw,Mw as bx,yc as by,pR as bz,V as c,j0e as c$,UX as c0,Gs as c1,xr as c2,KO as c3,T0t as c4,DVe as c5,Rt as c6,pke as c7,CF as c8,Xye as c9,Mn as cA,kE as cB,m$t as cC,V5t as cD,jt as cE,Tu as cF,U7t as cG,ERt as cH,fOt as cI,Sw as cJ,NL as cK,VS as cL,Jb as cM,Xd as cN,Zd as cO,T4e as cP,nMe as cQ,uMt as cR,Gb as cS,WE as cT,YS as cU,p1 as cV,BV as cW,Fs as cX,zV as cY,GV as cZ,D4 as c_,zt as ca,Tfe as cb,c6 as cc,BX as cd,nE as ce,iO as cf,a_ as cg,Rl as ch,jVe as ci,DS as cj,HVe as ck,TQ as cl,Tw as cm,BPt as cn,HPt as co,fRt as cp,Ole as cq,e0 as cr,nm as cs,vi as ct,hD as cu,wNe as cv,pp as cw,x5t as cx,Yre as cy,YX as cz,he as d,gT as d$,AUe as d0,pHe as d1,jPt as d2,$s as d3,gOt as d4,NEt as d5,FEt as d6,GEt as d7,YEt as d8,hRe as d9,fx as dA,C3e as dB,F4 as dC,Gje as dD,VRt as dE,Pit as dF,Mit as dG,eR as dH,XSe as dI,N5t as dJ,D5t as dK,VM as dL,xE as dM,jh as dN,b7e as dO,ZRt as dP,_7e as dQ,XRt as dR,qf as dS,nDe as dT,YSe as dU,ga as dV,Kr as dW,au as dX,em as dY,F5t as dZ,hit as d_,Tyt as da,er as db,xyt as dc,xw as dd,oR as de,L7t as df,oCt as dg,pRe as dh,OOe as di,o7t as dj,l7t as dk,tSt as dl,jTt as dm,lct as dn,cct as dp,uct as dq,gu as dr,XAt as ds,owt as dt,awt as du,Qbt as dv,gGt as dw,DF as dx,_Vt as dy,cwt as dz,d as e,Cme as e$,k_e as e0,Wi as e1,Uj as e2,S_ as e3,lc as e4,$c as e5,gc as e6,K4 as e7,GAt as e8,VDe as e9,oRe as eA,B7t as eB,D7t as eC,Pu as eD,b0 as eE,Sk as eF,eC as eG,$Et as eH,kEt as eI,pOt as eJ,N4 as eK,M1e as eL,IMt as eM,an as eN,T_ as eO,ake as eP,Zb as eQ,eG as eR,_Et as eS,sm as eT,hh as eU,zi as eV,Pe as eW,ye as eX,pe as eY,Ge as eZ,ce as e_,LS as ea,wY as eb,$$e as ec,aR as ed,age as ee,X$t as ef,ai as eg,hPt as eh,SDt as ei,QCe as ej,H$ as ek,pje as el,cPt as em,KW as en,ii as eo,pme as ep,Wo as eq,$Ue as er,D_ as es,t7t as et,lvt as eu,YRt as ev,TY as ew,JO as ex,nRe as ey,szt as ez,ti as f,r7t as f$,Vfe as f0,Gfe as f1,Hi as f2,e9t as f3,JUt as f4,QUt as f5,N7t as f6,zE as f7,n7t as f8,c7t as f9,UPt as fA,YPt as fB,hr as fC,ZM as fD,U0e as fE,eke as fF,K as fG,Se as fH,Hte as fI,Gyt as fJ,zh as fK,Co as fL,KY as fM,Q6e as fN,Ni as fO,bT as fP,HS as fQ,Lt as fR,K_t as fS,bW as fT,WV as fU,ro as fV,AF as fW,RNe as fX,$Ne as fY,INe as fZ,LNe as f_,s7t as fa,G6e as fb,VAt as fc,uV as fd,q7t as fe,qEt as ff,H7t as fg,WEt as fh,yOt as fi,HEt as fj,K7t as fk,v0t as fl,b0t as fm,_w as fn,xke as fo,xe as fp,ZUt as fq,$Ie as fr,gV as fs,Lkt as ft,$M as fu,d1 as fv,zK as fw,oPe as fx,_T as fy,rm as fz,se as g,Hyt as g$,ett as g0,Js as g1,E$t as g2,A$t as g3,S8t as g4,EUe as g5,bkt as g6,v4t as g7,vTe as g8,EJ as g9,cn as gA,AY as gB,sBe as gC,J8e as gD,F7t as gE,Ede as gF,j_ as gG,aRe as gH,$7t as gI,E4t as gJ,S4t as gK,m1 as gL,qUt as gM,Q4 as gN,r1 as gO,tF as gP,RR as gQ,Bo as gR,Uh as gS,cr as gT,tE as gU,tze as gV,CX as gW,Hme as gX,hY as gY,jd as gZ,bw as g_,b4t as ga,w4t as gb,fa as gc,Pl as gd,oDt as ge,P6 as gf,ao as gg,hs as gh,$6 as gi,yi as gj,lo as gk,s0 as gl,rn as gm,ZGt as gn,KV as go,$l as gp,Vr as gq,qW as gr,WW as gs,jtt as gt,U$e as gu,HAt as gv,Fh as gw,Jtt as gx,Sn as gy,Gtt as gz,mp as h,vkt as h$,jOt as h0,l6 as h1,E1e as h2,Wee as h3,yT as h4,yG as h5,C5t as h6,uit as h7,goe as h8,gRt as h9,K$t as hA,Q$t as hB,UP as hC,YV as hD,qPt as hE,LM as hF,Kkt as hG,H_ as hH,MRt as hI,I7t as hJ,MW as hK,R7t as hL,NGe as hM,DGe as hN,RGe as hO,Gre as hP,Dw as hQ,Nw as hR,d$t as hS,Qgt as hT,vMt as hU,XT as hV,WDe as hW,$h as hX,mu as hY,G7t as hZ,V7t as h_,T5t as ha,fu as hb,Ilt as hc,yq as hd,_q as he,kn as hf,$i as hg,Vs as hh,op as hi,Lp as hj,ew as hk,QMt as hl,nUe as hm,qi as hn,uPe as ho,yw as hp,ETe as hq,Ykt as hr,yat as hs,D6t as ht,nP as hu,Ez as hv,sct as hw,Qv as hx,Z$t as hy,fbe as hz,lq as i,d7t as i$,mct as i0,_kt as i1,k7t as i2,QDe as i3,vh as i4,_Rt as i5,Cn as i6,yxe as i7,WNe as i8,US as i9,vUe as iA,t_ as iB,xn as iC,$X as iD,n9t as iE,G0e as iF,iie as iG,yMt as iH,aE as iI,g$t as iJ,ZAt as iK,E8 as iL,j7t as iM,tY as iN,Fw as iO,V2 as iP,p4 as iQ,eIt as iR,gDe as iS,wi as iT,Hxt as iU,sr as iV,gi as iW,Ei as iX,a9t as iY,h7t as iZ,KSt as i_,M5t as ia,t0 as ib,n0t as ic,JE as id,Ul as ie,TRt as ig,I5t as ih,NT as ii,IN as ij,tDt as ik,Rp as il,h8 as im,tIe as io,ZW as ip,ux as iq,ue as ir,ki as is,Qr as it,np as iu,ss as iv,st as iw,ci as ix,$0t as iy,Ne as iz,bp as j,dPt as j$,la as j0,kh as j1,ix as j2,Qw as j3,Fl as j4,e5 as j5,rs as j6,Nbt as j7,iet as j8,Nn as j9,V3e as jA,Pht as jB,ku as jC,mM as jD,gM as jE,g3e as jF,qdt as jG,wht as jH,Fit as jI,a0 as jJ,KSe as jK,$Pt as jL,Uit as jM,bdt as jN,fdt as jO,mdt as jP,xdt as jQ,ydt as jR,_dt as jS,gdt as jT,wdt as jU,kit as jV,vdt as jW,Vh as jX,bS as jY,r2 as jZ,lfe as j_,nVt as ja,jg as jb,Ap as jc,_a as jd,xR as je,zn as jf,kk as jg,zk as jh,lx as ji,u6t as jj,nxe as jk,Bk as jl,Uk as jm,Eme as jn,T6 as jo,QO as jp,K8 as jq,iZ as jr,cge as js,hZ as jt,Hh as ju,L1e as jv,VEt as jw,Qt as jx,mse as jy,z3e as jz,W_ as k,hfe as k$,zRt as k0,DRt as k1,mee as k2,z_ as k3,Wf as k4,Bs as k5,dEe as k6,P0 as k7,RT as k8,Ur as k9,IRt as kA,LRt as kB,NRt as kC,gk as kD,JRt as kE,cit as kF,gTe as kG,Un as kH,Jd as kI,MMt as kJ,JMt as kK,rJ as kL,ex as kM,G_ as kN,us as kO,L8 as kP,I8 as kQ,MQ as kR,xc as kS,PTt as kT,X$e as kU,mY as kV,zPt as kW,UE as kX,SDe as kY,_6 as kZ,WPt as k_,cR as ka,uR as kb,Vkt as kc,$q as kd,nF as ke,vs as kf,xh as kg,fce as kh,To as ki,lDt as kj,ze as kk,lR as kl,KUt as km,m5 as kn,D as ko,JPt as kp,IEt as kq,i7t as kr,YAt as ks,bUe as kt,nO as ku,sMt as kv,nMt as kw,Cc as kx,HIe as ky,P5t as kz,jyt as l,Tht as l$,yPt as l0,gPt as l1,U5t as l2,k5t as l3,jIe as l4,$pe as l5,H$e as l6,pMt as l7,a7t as l8,T$t as l9,f8e as lA,F_ as lB,A3e as lC,Ove as lD,pu as lE,r8t as lF,Qa as lG,M3e as lH,SK as lI,v6 as lJ,_Y as lK,S8 as lL,x0 as lM,Qkt as lN,tO as lO,kj as lP,rLt as lQ,wke as lR,kg as lS,ri as lT,tye as lU,qLe as lV,eLt as lW,Sht as lX,b3e as lY,T3e as lZ,Eht as l_,y0 as la,Fye as lb,L8e as lc,Tl as ld,SUe as le,IM as lf,bYe as lg,D7e as lh,iMt as li,GMt as lj,HMt as lk,jMt as ll,Lh as lm,Uf as ln,hO as lo,XUt as lp,mge as lq,c1 as lr,Ud as ls,_c as lt,mZ as lu,fZ as lv,Go as lw,li as lx,re as ly,sOt as lz,Am as m,moe as m$,Cht as m0,Su as m1,iX as m2,y3e as m3,tLt as m4,eFt as m5,Ape as m6,t8t as m7,e8t as m8,zP as m9,G6 as mA,mMt as mB,fMt as mC,fIt as mD,_It as mE,nDt as mF,fie as mG,die as mH,vf as mI,WUt as mJ,YUt as mK,vve as mL,z7t as mM,Te as mN,Dze as mO,Lke as mP,ts as mQ,E3e as mR,Mht as mS,VW as mT,Eze as mU,GPt as mV,G5t as mW,L5t as mX,HSe as mY,WSe as mZ,GSe as m_,cqe as ma,dh as mb,je as mc,ar as md,OPt as me,g6 as mf,vRt as mg,Cm as mh,VPt as mi,ofe as mj,t4e as mk,CRt as ml,ww as mm,uOt as mn,So as mo,C8 as mp,s5 as mq,o0t as mr,Xnt as ms,c9t as mt,Iye as mu,hE as mv,h9t as mw,u9t as mx,Vg as my,t0t as mz,Ow as n,ARt as n$,B5t as n0,$P as n1,fD as n2,woe as n3,Bit as n4,w5t as n5,nge as n6,_Mt as n7,Vme as n8,hMt as n9,dO as nA,GM as nB,k_ as nC,T4t as nD,Iwe as nE,de as nF,ctt as nG,U_e as nH,nc as nI,Yke as nJ,kM as nK,y_ as nL,X8e as nM,pa as nN,$we as nO,jf as nP,vYe as nQ,fre as nR,zAe as nS,qee as nT,JGt as nU,L0t as nV,Xce as nW,Rpe as nX,GW as nY,XPt as nZ,elt as n_,KNe as na,n4e as nb,CY as nc,cMt as nd,BEe as ne,sot as nf,h6 as ng,bk as nh,Wa as ni,Zje as nj,HTe as nk,$J as nl,gWe as nm,$3e as nn,fme as no,Yye as np,fq as nq,w8t as nr,Iw as ns,oUe as nt,G4t as nu,a8 as nv,Q5 as nw,SMt as nx,d6 as ny,uPt as nz,Wre as o,Dbe as o$,nle as o0,vk as o1,q_ as o2,cLe as o3,n_ as o4,Bpe as o5,B$e as o6,RPt as o7,Pre as o8,i9t as o9,hc as oA,pc as oB,TE as oC,sW as oD,rW as oE,ijt as oF,sjt as oG,nW as oH,iW as oI,uc as oJ,Ckt as oK,vl as oL,qot as oM,Akt as oN,Eat as oO,v6t as oP,tn as oQ,tue as oR,jT as oS,Y_ as oT,cye as oU,Vn as oV,kbe as oW,sX as oX,$w as oY,iqe as oZ,vn as o_,yL as oa,_Ee as ob,Ic as oc,Dke as od,qMt as oe,rDt as of,lm as og,JS as oh,es as oi,QE as oj,Wt as ok,QSe as ol,eEe as om,P4t as on,Gg as oo,oa as op,hm as oq,Tkt as or,Mzt as os,gK as ot,$F as ou,wkt as ov,Skt as ow,GCe as ox,xkt as oy,cCt as oz,Ih as p,uk as p$,zr as p0,m0 as p1,X6 as p2,Eo as p3,hR as p4,bi as p5,BP as p6,Z6 as p7,$ye as p8,aOt as p9,ip as pA,nu as pB,$5t as pC,qte as pD,ft as pE,E5t as pF,Mtt as pG,wk as pH,rC as pI,Lmt as pJ,PJ as pK,zs as pL,qme as pM,Zmt as pN,$yt as pO,fHe as pP,n5e as pQ,ZPt as pR,ih as pS,$kt as pT,est as pU,Ikt as pV,tEe as pW,SPt as pX,b6 as pY,up as pZ,VLe as p_,lOt as pa,dqe as pb,bpt as pc,p3 as pd,xk as pe,yR as pf,Tk as pg,fR as ph,VCe as pi,Y7e as pj,ykt as pk,H0e as pl,Imt as pm,Krt as pn,Zrt as po,wqe as pp,c5t as pq,l5t as pr,l0 as ps,q5t as pt,no as pu,Vo as pv,m9t as pw,iK as px,Ao as py,wPt as pz,Ja as q,R9e as q$,E4 as q0,y6 as q1,Bje as q2,_ve as q3,gm as q4,jit as q5,Vit as q6,Git as q7,X5t as q8,aa as q9,nB as qA,Eyt as qB,um as qC,Gt as qD,skt as qE,qr as qF,Pr as qG,Bh as qH,okt as qI,PPt as qJ,vSe as qK,ph as qL,nkt as qM,p0 as qN,Ee as qO,d_t as qP,p_t as qQ,gD as qR,V4 as qS,nme as qT,oMt as qU,Xje as qV,_Le as qW,kMt as qX,fm as qY,wOt as qZ,bOt as q_,T8t as qa,C$t as qb,Q$e as qc,P$t as qd,X3e as qe,Oie as qf,pIt as qg,Rie as qh,cO as qi,Wb as qj,oi as qk,wt as ql,Sr as qm,CO as qn,Ip as qo,bzt as qp,Ozt as qq,Syt as qr,Cb as qs,iue as qt,Tzt as qu,vzt as qv,xzt as qw,Eb as qx,yzt as qy,hzt as qz,Zs as r,CMt as r$,XR as r0,O9e as r1,Okt as r2,s6 as r3,R7e as r4,ATt as r5,M7e as r6,w5 as r7,T5 as r8,JAt as r9,ZWe as rA,wLt as rB,vLt as rC,bLt as rD,eOt as rE,i0t as rF,SRt as rG,E_ as rH,s0t as rI,bTe as rJ,w_ as rK,wa as rL,fqe as rM,cOt as rN,iOt as rO,C4 as rP,n0 as rQ,T8e as rR,Pye as rS,eUe as rT,Rh as rU,S5 as rV,$S as rW,ha as rX,W8e as rY,wX as rZ,mOt as r_,ym as ra,f7t as rb,hre as rc,Dkt as rd,Rkt as re,KX as rf,k7e as rg,U7e as rh,lEt as ri,YGt as rj,IV as rk,j8e as rl,dOt as rm,rMt as rn,kHe as ro,QPt as rp,KPt as rq,ls as rr,Yet as rs,V4e as rt,mIt as ru,pie as rv,Mnt as rw,Nh as rx,Rk as ry,eS as rz,HX as s,ckt as s$,uqe as s0,kke as s1,L_ as s2,oDe as s3,RS as s4,Wkt as s5,YW as s6,B$t as s7,XO as s8,sht as s9,ekt as sA,Rr as sB,ht as sC,An as sD,M2t as sE,jAt as sF,BAt as sG,Mlt as sH,N6t as sI,dkt as sJ,pkt as sK,rkt as sL,ikt as sM,xPt as sN,vae as sO,akt as sP,Flt as sQ,eve as sR,Qet as sS,ltt as sT,aje as sU,Tlt as sV,j5t as sW,X9 as sX,Z9 as sY,EY as sZ,bit as s_,jw as sa,_u as sb,NY as sc,YY as sd,ukt as se,hkt as sf,Qd as sg,FCe as sh,zlt as si,LCe as sj,ect as sk,Ny as sl,fK as sm,pK as sn,Q6t as so,Pkt as sp,Plt as sq,Pat as sr,Pn as ss,S6 as st,Sh as su,Kf as sv,lkt as sw,Llt as sx,Ekt as sy,tkt as sz,U9t as t,Dp as t$,dle as t0,z5t as t1,r5e as t2,KD as t3,Yje as t4,Or as t5,Sc as t6,Ol as t7,x as t8,Rs as t9,t8 as tA,qht as tB,SZ as tC,uC as tD,Dk as tE,n4t as tF,vJ as tG,p$t as tH,oje as tI,F5 as tJ,Ci as tK,y$t as tL,o4t as tM,Wwe as tN,is as tO,tSe as tP,ni as tQ,bu as tR,zw as tS,Ik as tT,Yh as tU,w1 as tV,Mr as tW,hi as tX,Ixe as tY,Ave as tZ,rZ as t_,Oc as ta,at as tb,Ie as tc,k as td,Lm as te,dt as tf,Lr as tg,Pc as th,G as ti,Gr as tj,Dr as tk,Nt as tl,A0 as tm,Ok as tn,x1 as to,Mc as tp,e8 as tq,qt as tr,Sm as ts,s1 as tt,T1 as tu,i8 as tv,Za as tw,IK as tx,qg as ty,IYe as tz,Ae as u,tx as u$,t9t as u0,GUt as u1,Vq as u2,tbe as u3,cA as u4,Rye as u5,nOt as u6,UHe as u7,V_ as u8,oOt as u9,ZU as uA,B2e as uB,Yi as uC,Q2e as uD,bJ as uE,f$t as uF,oX as uG,yIt as uH,aO as uI,gIt as uJ,zl as uK,JM as uL,fX as uM,ZS as uN,PMt as uO,FJe as uP,mX as uQ,Q0e as uR,XS as uS,Oye as uT,k8e as uU,o0 as uV,K6 as uW,Fze as uX,jke as uY,vse as uZ,aDt as u_,rOt as ua,YYe as ub,wr as uc,Po as ud,_1 as ue,uO as uf,Mj as ug,MPt as uh,tMt as ui,eMt as uj,Je as uk,_4t as ul,aX as um,AMt as un,tOt as uo,VAe as up,Pm as uq,JY as ur,I_e as us,Cp as ut,dE as uu,Dt as uv,xo as uw,wu as ux,r8 as uy,b1 as uz,aM as v,kDt as v0,yke as v1,O5t as v2,gMt as v3,WAt as v4,Yzt as v5,dMt as v6,R5t as v7,mc as v8,lPt as v9,i8t as vA,v8t as vB,njt as vC,Ta as va,ert as vb,Zc as vc,Np as vd,Im as ve,Si as vf,Hg as vg,wm as vh,tt as vi,cx as vj,bm as vk,l8 as vl,wc as vm,Oxe as vn,KMt as vo,KQe as vp,Eu as vq,qke as vr,bnt as vs,wnt as vt,vE as vu,RH as vv,tK as vw,WMt as vx,XMt as vy,Z5t as vz,afe as w,Yr as x,m as y,Ho as z};
